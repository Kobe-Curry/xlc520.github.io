{
  "version": "https://jsonfeed.org/version/1.1",
  "title": "StudyNote",
  "home_page_url": "https://blog.ciberviler.top/",
  "feed_url": "https://blog.ciberviler.top/feed.json",
  "description": "个人学习的笔记，记录学习过程遇到的问题，学到的知识，收集各种学习工具，各种技巧，各种使用教程。",
  "items": [
    {
      "title": "SpringBoot中如何优雅的使用多线程",
      "url": "https://blog.ciberviler.top/dev/SpringBoot%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E4%BD%BF%E7%94%A8%E5%A4%9A%E7%BA%BF%E7%A8%8B.html",
      "id": "https://blog.ciberviler.top/dev/SpringBoot%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E4%BD%BF%E7%94%A8%E5%A4%9A%E7%BA%BF%E7%A8%8B.html",
      "content_html": "<h1 id=\"springboot中如何优雅的使用多线程\" tabindex=\"-1\"> SpringBoot中如何优雅的使用多线程</h1>\n<blockquote>\n<p>本文带你快速了解@Async注解的用法，包括异步方法无返回值、有返回值，最后总结了@Async注解失效的几个坑。</p>\n</blockquote>\n<p>在 SpringBoot 应用中，经常会遇到在一个接口中，同时做事情1，事情2，事情3，如果同步执行的话，则本次接口时间取决于事情1 2 3执行时间之和；如果三件事同时执行，则本次接口时间取决于事情1 2 3执行时间最长的那个，合理使用多线程，可以大大缩短接口时间。那么在 SpringBoot 应用中如何优雅的使用多线程呢？</p>\n<h2 id=\"快速使用\" tabindex=\"-1\"> 快速使用</h2>\n<p>SpringBoot应用中需要添加<code>@EnableAsync</code>注解，来开启异步调用，一般还会配置一个线程池，异步的方法交给特定的线程池完成，如下：</p>\n<div><pre><code><span>@Configuration</span>\n<span>@EnableAsync</span>\n<span>public</span> <span>class</span> <span>AsyncConfiguration</span> <span>{</span>\n\n    <span>@Bean</span><span>(</span><span>\"doSomethingExecutor\"</span><span>)</span>\n    <span>public</span> <span>Executor</span> <span>doSomethingExecutor</span><span>(</span><span>)</span> <span>{</span>\n        <span>ThreadPoolTaskExecutor</span> executor <span>=</span> <span>new</span> <span>ThreadPoolTaskExecutor</span><span>(</span><span>)</span><span>;</span>\n        <span>// 核心线程数：线程池创建时候初始化的线程数</span>\n        executor<span>.</span><span>setCorePoolSize</span><span>(</span><span>10</span><span>)</span><span>;</span>\n        <span>// 最大线程数：线程池最大的线程数，只有在缓冲队列满了之后才会申请超过核心线程数的线程</span>\n        executor<span>.</span><span>setMaxPoolSize</span><span>(</span><span>20</span><span>)</span><span>;</span>\n        <span>// 缓冲队列：用来缓冲执行任务的队列</span>\n        executor<span>.</span><span>setQueueCapacity</span><span>(</span><span>500</span><span>)</span><span>;</span>\n        <span>// 允许线程的空闲时间60秒：当超过了核心线程之外的线程在空闲时间到达之后会被销毁</span>\n        executor<span>.</span><span>setKeepAliveSeconds</span><span>(</span><span>60</span><span>)</span><span>;</span>\n        <span>// 线程池名的前缀：设置好了之后可以方便我们定位处理任务所在的线程池</span>\n        executor<span>.</span><span>setThreadNamePrefix</span><span>(</span><span>\"do-something-\"</span><span>)</span><span>;</span>\n        <span>// 缓冲队列满了之后的拒绝策略：由调用线程处理（一般是主线程）</span>\n        executor<span>.</span><span>setRejectedExecutionHandler</span><span>(</span><span>new</span> <span>ThreadPoolExecutor<span>.</span>DiscardPolicy</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        executor<span>.</span><span>initialize</span><span>(</span><span>)</span><span>;</span>\n        <span>return</span> executor<span>;</span>\n    <span>}</span>\n    \n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>使用的方式非常简单，在需要异步的方法上加<code>@Async</code>注解</p>\n<div><pre><code><span>@RestController</span>\n<span>public</span> <span>class</span> <span>AsyncController</span> <span>{</span>\n\n    <span>@Autowired</span>\n    <span>private</span> <span>AsyncService</span> asyncService<span>;</span>\n\n    <span>@GetMapping</span><span>(</span><span>\"/open/something\"</span><span>)</span>\n    <span>public</span> <span>String</span> <span>something</span><span>(</span><span>)</span> <span>{</span>\n        <span>int</span> count <span>=</span> <span>10</span><span>;</span>\n        <span>for</span> <span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> count<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            asyncService<span>.</span><span>doSomething</span><span>(</span><span>\"index = \"</span> <span>+</span> i<span>)</span><span>;</span>\n        <span>}</span>\n        <span>return</span> <span>\"success\"</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n\n\n<span>@Slf4j</span>\n<span>@Service</span>\n<span>public</span> <span>class</span> <span>AsyncService</span> <span>{</span>\n\n    <span>// 指定使用beanname为doSomethingExecutor的线程池</span>\n    <span>@Async</span><span>(</span><span>\"doSomethingExecutor\"</span><span>)</span>\n    <span>public</span> <span>String</span> <span>doSomething</span><span>(</span><span>String</span> message<span>)</span> <span>{</span>\n        log<span>.</span><span>info</span><span>(</span><span>\"do something, message={}\"</span><span>,</span> message<span>)</span><span>;</span>\n        <span>try</span> <span>{</span>\n            <span>Thread</span><span>.</span><span>sleep</span><span>(</span><span>1000</span><span>)</span><span>;</span>\n        <span>}</span> <span>catch</span> <span>(</span><span>InterruptedException</span> e<span>)</span> <span>{</span>\n            log<span>.</span><span>error</span><span>(</span><span>\"do something error: \"</span><span>,</span> e<span>)</span><span>;</span>\n        <span>}</span>\n        <span>return</span> message<span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>访问：127.0.0.1:8080/open/something，日志如下</p>\n<div><pre><code>2020-04-19 23:42:42.486  INFO 21168 --- [io-8200-exec-17] x.g.b.system.controller.AsyncController  : do something end, time 8 milliseconds\n<span>2020-04-19 23:42:42.488  INFO 21168 --- [ do-something-1] x.gits.boot.system.service.AsyncService  : do something, message</span><span>=</span><span>index = 0</span>\n<span>2020-04-19 23:42:42.488  INFO 21168 --- [ do-something-5] x.gits.boot.system.service.AsyncService  : do something, message</span><span>=</span><span>index = 4</span>\n<span>2020-04-19 23:42:42.488  INFO 21168 --- [ do-something-4] x.gits.boot.system.service.AsyncService  : do something, message</span><span>=</span><span>index = 3</span>\n<span>2020-04-19 23:42:42.488  INFO 21168 --- [ do-something-6] x.gits.boot.system.service.AsyncService  : do something, message</span><span>=</span><span>index = 5</span>\n<span>2020-04-19 23:42:42.488  INFO 21168 --- [ do-something-9] x.gits.boot.system.service.AsyncService  : do something, message</span><span>=</span><span>index = 8</span>\n<span>2020-04-19 23:42:42.488  INFO 21168 --- [ do-something-8] x.gits.boot.system.service.AsyncService  : do something, message</span><span>=</span><span>index = 7</span>\n<span>2020-04-19 23:42:42.488  INFO 21168 --- [do-something-10] x.gits.boot.system.service.AsyncService  : do something, message</span><span>=</span><span>index = 9</span>\n<span>2020-04-19 23:42:42.488  INFO 21168 --- [ do-something-7] x.gits.boot.system.service.AsyncService  : do something, message</span><span>=</span><span>index = 6</span>\n<span>2020-04-19 23:42:42.488  INFO 21168 --- [ do-something-2] x.gits.boot.system.service.AsyncService  : do something, message</span><span>=</span><span>index = 1</span>\n<span>2020-04-19 23:42:42.488  INFO 21168 --- [ do-something-3] x.gits.boot.system.service.AsyncService  : do something, message</span><span>=</span><span>index = 2</span>\n复制代码\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>由此可见已经达到异步执行的效果了，并且使用到了咱们配置的线程池。</p>\n<h2 id=\"获取异步方法返回值\" tabindex=\"-1\"> 获取异步方法返回值</h2>\n<p>当异步方法有返回值时，如何获取异步方法执行的返回结果呢？这时需要异步调用的方法带有返回值CompletableFuture。</p>\n<p>CompletableFuture是对Feature的增强，Feature只能处理简单的异步任务，而CompletableFuture可以将多个异步任务进行复杂的组合。如下：</p>\n<div><pre><code><span>@RestController</span>\n<span>public</span> <span>class</span> <span>AsyncController</span> <span>{</span>\n\n    <span>@Autowired</span>\n    <span>private</span> <span>AsyncService</span> asyncService<span>;</span>\n\n    <span>@SneakyThrows</span>\n    <span>@ApiOperation</span><span>(</span><span>\"异步 有返回值\"</span><span>)</span>\n    <span>@GetMapping</span><span>(</span><span>\"/open/somethings\"</span><span>)</span>\n    <span>public</span> <span>String</span> <span>somethings</span><span>(</span><span>)</span> <span>{</span>\n        <span>CompletableFuture</span><span><span>&lt;</span><span>String</span><span>></span></span> createOrder <span>=</span> asyncService<span>.</span><span>doSomething1</span><span>(</span><span>\"create order\"</span><span>)</span><span>;</span>\n        <span>CompletableFuture</span><span><span>&lt;</span><span>String</span><span>></span></span> reduceAccount <span>=</span> asyncService<span>.</span><span>doSomething2</span><span>(</span><span>\"reduce account\"</span><span>)</span><span>;</span>\n        <span>CompletableFuture</span><span><span>&lt;</span><span>String</span><span>></span></span> saveLog <span>=</span> asyncService<span>.</span><span>doSomething3</span><span>(</span><span>\"save log\"</span><span>)</span><span>;</span>\n        \n        <span>// 等待所有任务都执行完</span>\n        <span>CompletableFuture</span><span>.</span><span>allOf</span><span>(</span>createOrder<span>,</span> reduceAccount<span>,</span> saveLog<span>)</span><span>.</span><span>join</span><span>(</span><span>)</span><span>;</span>\n        <span>// 获取每个任务的返回结果</span>\n        <span>String</span> result <span>=</span> createOrder<span>.</span><span>get</span><span>(</span><span>)</span> <span>+</span> reduceAccount<span>.</span><span>get</span><span>(</span><span>)</span> <span>+</span> saveLog<span>.</span><span>get</span><span>(</span><span>)</span><span>;</span>\n        <span>return</span> result<span>;</span>\n    <span>}</span>\n<span>}</span>\n\n\n<span>@Slf4j</span>\n<span>@Service</span>\n<span>public</span> <span>class</span> <span>AsyncService</span> <span>{</span>\n\n    <span>@Async</span><span>(</span><span>\"doSomethingExecutor\"</span><span>)</span>\n    <span>public</span> <span>CompletableFuture</span><span><span>&lt;</span><span>String</span><span>></span></span> <span>doSomething1</span><span>(</span><span>String</span> message<span>)</span> <span>throws</span> <span>InterruptedException</span> <span>{</span>\n        log<span>.</span><span>info</span><span>(</span><span>\"do something1: {}\"</span><span>,</span> message<span>)</span><span>;</span>\n        <span>Thread</span><span>.</span><span>sleep</span><span>(</span><span>1000</span><span>)</span><span>;</span>\n        <span>return</span> <span>CompletableFuture</span><span>.</span><span>completedFuture</span><span>(</span><span>\"do something1: \"</span> <span>+</span> message<span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>@Async</span><span>(</span><span>\"doSomethingExecutor\"</span><span>)</span>\n    <span>public</span> <span>CompletableFuture</span><span><span>&lt;</span><span>String</span><span>></span></span> <span>doSomething2</span><span>(</span><span>String</span> message<span>)</span> <span>throws</span> <span>InterruptedException</span> <span>{</span>\n        log<span>.</span><span>info</span><span>(</span><span>\"do something2: {}\"</span><span>,</span> message<span>)</span><span>;</span>\n        <span>Thread</span><span>.</span><span>sleep</span><span>(</span><span>1000</span><span>)</span><span>;</span>\n        <span>return</span> <span>CompletableFuture</span><span>.</span><span>completedFuture</span><span>(</span><span>\"; do something2: \"</span> <span>+</span> message<span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>@Async</span><span>(</span><span>\"doSomethingExecutor\"</span><span>)</span>\n    <span>public</span> <span>CompletableFuture</span><span><span>&lt;</span><span>String</span><span>></span></span> <span>doSomething3</span><span>(</span><span>String</span> message<span>)</span> <span>throws</span> <span>InterruptedException</span> <span>{</span>\n        log<span>.</span><span>info</span><span>(</span><span>\"do something3: {}\"</span><span>,</span> message<span>)</span><span>;</span>\n        <span>Thread</span><span>.</span><span>sleep</span><span>(</span><span>1000</span><span>)</span><span>;</span>\n        <span>return</span> <span>CompletableFuture</span><span>.</span><span>completedFuture</span><span>(</span><span>\"; do something3: \"</span> <span>+</span> message<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>访问接口</p>\n<div><pre><code>C<span>:</span>\\Users\\Administrator<span>></span>curl <span>-</span>X <span>GET</span> <span>\"http://localhost:8200/open/somethings\"</span> <span>-</span>H <span>\"accept: */*\"</span>\n<span>do</span> something1<span>:</span> create order<span>;</span> <span>do</span> something2<span>:</span> reduce account<span>;</span> <span>do</span> something3<span>:</span> save <span>log</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>控制台上关键日志如下：</p>\n<div><pre><code>2020-04-20 00:27:42.238  INFO 5672 --- [ do-something-3] x.gits.boot.system.service.AsyncService  : do something3: save log\n2020-04-20 00:27:42.238  INFO 5672 --- [ do-something-2] x.gits.boot.system.service.AsyncService  : do something2: reduce account\n2020-04-20 00:27:42.238  INFO 5672 --- [ do-something-1] x.gits.boot.system.service.AsyncService  : do something1: create order\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h2 id=\"注意事项\" tabindex=\"-1\"> 注意事项</h2>\n<p><code>@Async</code>注解会在以下几个场景失效，也就是说明明使用了<code>@Async</code>注解，但就没有走多线程。</p>\n<ul>\n<li>异步方法使用static关键词修饰；</li>\n<li>异步类不是一个Spring容器的bean（一般使用注解<code>@Component</code>和<code>@Service</code>，并且能被Spring扫描到）；</li>\n<li>SpringBoot应用中没有添加<code>@EnableAsync</code>注解；</li>\n<li>在同一个类中，一个方法调用另外一个有@Async注解的方法，注解不会生效。原因是@Async注解的方法，是在代理类中执行的。</li>\n</ul>\n<p>需要注意的是： 异步方法使用注解@Async的返回值只能为void或者Future及其子类，当返回结果为其他类型时，方法还是会异步执行，但是返回值都是null，部分源码如下：</p>\n<p>AsyncExecutionInterceptor#invoke</p>\n<p><img src=\"https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/5/28/1725ba6de41fa8b1~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp\" alt=\"image.png\"></p>\n<p>通过上边几个示例，@Async实际还是通过Future或CompletableFuture来异步执行的，Spring又封装了一下，让我们使用的更方便。</p>\n",
      "image": "https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/5/28/1725ba6de41fa8b1~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp",
      "date_published": "2022-08-09T00:00:00.000Z",
      "date_modified": "2022-07-20T03:04:00.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "logback - 自定义日志脱敏组件",
      "url": "https://blog.ciberviler.top/dev/logback%E8%87%AA%E5%AE%9A%E4%B9%89%E6%97%A5%E5%BF%97%E8%84%B1%E6%95%8F%E7%BB%84%E4%BB%B6.html",
      "id": "https://blog.ciberviler.top/dev/logback%E8%87%AA%E5%AE%9A%E4%B9%89%E6%97%A5%E5%BF%97%E8%84%B1%E6%95%8F%E7%BB%84%E4%BB%B6.html",
      "content_html": "<h1 id=\"logback-自定义日志脱敏组件\" tabindex=\"-1\"> logback - 自定义日志脱敏组件</h1>\n<h2 id=\"前言\" tabindex=\"-1\"> 前言</h2>\n<p>在我们书写代码的时候，会书写许多日志代码，但是有些敏感数据是需要进行安全脱敏处理的。</p>\n<p>对于日志脱敏的方式有很多，常见的有<strong>①使用conversionRule标签，继承MessageConverter②书写一个脱敏工具类，在打印日志的时候对特定特字段进行脱敏返回。</strong></p>\n<p>两种方式各有优缺点：</p>\n<p>第一种方式需要修改代码，不符合开闭原则。</p>\n<p>第二种方式，需要在日志方法的参数进行脱敏，对原生日志有入侵行为。</p>\n<h2 id=\"自定义脱敏组件-slf4j-logback\" tabindex=\"-1\"> 自定义脱敏组件（slf4j+logback）</h2>\n<p>一个项目在书写了很多打印日志的代码，但是后面有了脱敏需求，如果我们去手动改动代码，会花费大量时间。如果引入本组件，完成配置即可轻松完成脱敏。（仅需三步可轻松配置）</p>\n<h3 id=\"一、自定义脱敏组件-脱敏效果演示\" tabindex=\"-1\"> 一、自定义脱敏组件 - 脱敏效果演示</h3>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210129141855313.png\" alt=\"需要脱敏的日志\">\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210129141946269.png\" alt=\"控制台脱敏结果\"></p>\n<h3 id=\"二、自定义脱敏组件-使用方式\" tabindex=\"-1\"> 二、自定义脱敏组件 - 使用方式</h3>\n<h5 id=\"_1、引入jar包依赖\" tabindex=\"-1\"> 1、引入Jar包依赖</h5>\n<p>前提是你将Jar包打入本地仓库，Jar包地址见后文。</p>\n<div><pre><code><span><span><span>&lt;</span>dependency</span><span>></span></span>\n    <span><span><span>&lt;</span>groupId</span><span>></span></span>pers.liuchengyin<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n    <span><span><span>&lt;</span>artifactId</span><span>></span></span>logback-desensitization<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n    <span><span><span>&lt;</span>version</span><span>></span></span>1.0.0<span><span><span>&lt;/</span>version</span><span>></span></span>\n<span><span><span>&lt;/</span>dependency</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><h5 id=\"_2、替换日志文件配置类-logback-xml\" tabindex=\"-1\"> 2、替换日志文件配置类(logback.xml)</h5>\n<p>日志打印方式都只需要替换成脱敏的类即可，如果你的业务不需要，则无需替换。\n①ConsoleAppender - 控制台脱敏</p>\n<div><pre><code><span>// 原类</span>\n<span><span>ch<span>.</span>qos<span>.</span>logback<span>.</span>core<span>.</span></span>ConsoleAppender</span>\n<span>// 替换类</span>\n<span><span>pers<span>.</span>liuchengyin<span>.</span>logbackadvice<span>.</span></span>LcyConsoleAppender</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>②RollingFileAppender - 滚动文件</p>\n<div><pre><code><span>// 原类</span>\n<span><span>ch<span>.</span>qos<span>.</span>logback<span>.</span>core<span>.</span>rolling<span>.</span></span>RollingFileAppender</span>\n<span>// 替换类</span>\n<span><span>pers<span>.</span>liuchengyin<span>.</span>logbackadvice<span>.</span></span>LcyRollingFileAppender</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>③FileAppender - 文件</p>\n<div><pre><code><span>// 原类</span>\n<span><span>ch<span>.</span>qos<span>.</span>logback<span>.</span>core<span>.</span></span>FileAppender</span>\n<span>// 替换类</span>\n<span><span>pers<span>.</span>liuchengyin<span>.</span>logbackadvice<span>.</span></span>LcyFileAppender</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p><strong>替换示例：</strong></p>\n<div><pre><code><span><span><span>&lt;</span>property</span> <span>name</span><span><span>=</span><span>\"</span>CONSOLE_LOG_PATTERN<span>\"</span></span>\n          <span>value</span><span><span>=</span><span>\"</span>%yellow(%date{yyyy-MM-dd HH:mm:ss}) |%highlight(%-5level) |%blue(%thread) |%blue(%file:%line) |%green(%logger) |%cyan(%msg%n)<span>\"</span></span><span>/></span></span>\n\n<span>&lt;!-- ConsoleAppender 控制台输出日志 --></span>\n<span><span><span>&lt;</span>appender</span> <span>name</span><span><span>=</span><span>\"</span>CONSOLE<span>\"</span></span> <span>class</span><span><span>=</span><span>\"</span>pers.liuchengyin.logbackadvice.LcyConsoleAppender<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>encoder</span><span>></span></span>\n        <span><span><span>&lt;</span>pattern</span><span>></span></span>\n            ${CONSOLE_LOG_PATTERN}\n        <span><span><span>&lt;/</span>pattern</span><span>></span></span>\n    <span><span><span>&lt;/</span>encoder</span><span>></span></span>\n<span><span><span>&lt;/</span>appender</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h5 id=\"_3、添加脱敏配置文件-logback-desensitize-yml\" tabindex=\"-1\"> 3、添加脱敏配置文件(logback-desensitize.yml)</h5>\n<p>该配置文件应该放在resources文件下\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210129150716849.png\" alt=\"图片\"></p>\n<h3 id=\"三、自定义脱敏组件-脱敏规范\" tabindex=\"-1\"> 三、自定义脱敏组件 - 脱敏规范</h3>\n<h5 id=\"_1、支持数据类型\" tabindex=\"-1\"> 1、支持数据类型</h5>\n<p>八大基本类型及其包装类型、Map、List、业务里的Pojo对象、List&lt;业务里的Pojo对象&gt;、JSON字符串。\n注：在配置文件中配置的时候，只需要配置对象里的属性值就行。</p>\n<h5 id=\"_2、不支持的数据类型\" tabindex=\"-1\"> 2、不支持的数据类型</h5>\n<p>List&lt;八大基本类型及包装类型&gt;，因为不知道脱敏的数据源具体是哪一个。</p>\n<h5 id=\"_3、匹配规则\" tabindex=\"-1\"> 3、匹配规则</h5>\n<p><code>key + 分割符 + value</code>，目前仅支持冒号(<code>:</code>)和等号(<code>=</code>)，示例如下：</p>\n<div><pre><code>log<span>.</span><span>info</span><span>(</span><span>\"your email:{}, your phone:{}\"</span><span>,</span> <span>\"123456789@qq.com\"</span><span>,</span><span>\"15310763497\"</span><span>)</span><span>;</span>\nlog<span>.</span><span>info</span><span>(</span><span>\"your email={}, your cellphone={}\"</span><span>,</span> <span>\"123456789@qq.com\"</span><span>,</span><span>\"15310763497\"</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>key：定义了对应需要脱敏的关键字，如上诉的email、phone等以及业务对象中的字段、Map中的Key、JSON中的Key\nvalue：需要脱敏的值，如上诉的<code>123456789@qq.com</code>、<code>15310763497</code>。</p>\n<h5 id=\"_4、日志规范\" tabindex=\"-1\"> 4、日志规范</h5>\n<p>建议书写日志的时候尽量规范，对于key为中文的是没有办法脱敏的，规范程度可以见脱敏效果演示里的代码。</p>\n<h3 id=\"四、logback-desensitize-yml配置说明\" tabindex=\"-1\"> 四、logback-desensitize.yml配置说明</h3>\n<div><pre><code><span># 日志脱敏</span>\n<span>log-desensitize</span><span>:</span>\n  <span># 是否忽略大小写匹配，默认为true</span>\n  <span>ignore</span><span>:</span> <span>true</span>\n  <span># 是否开启脱敏，默认为false</span>\n  <span>open</span><span>:</span> <span>true</span>\n  <span># pattern下的key/value为固定脱敏规则</span>\n  <span>pattern</span><span>:</span>\n    <span># 邮箱 - @前第4-7位脱敏</span>\n    <span>email</span><span>:</span> <span>\"@>(4,7)\"</span>\n    <span># qq邮箱 - @后1-3位脱敏</span>\n    <span>qqemail</span><span>:</span> <span>\"@&lt;(1,3)\"</span>\n    <span># 姓名 - 姓脱敏，如*杰伦</span>\n    <span>name</span><span>:</span> <span>1</span><span>,</span><span>1</span>\n    <span># 密码 - 所有需要完全脱敏的都可以使用内置的password</span>\n    <span>password</span><span>:</span> password\n  <span>patterns</span><span>:</span>\n    <span># 身份证号，key后面的字段都可以匹配以下规则(用逗号分隔)</span>\n    <span>-</span> <span>key</span><span>:</span> identity<span>,</span>idcard\n      <span># 定义规则的标识</span>\n      <span>custom</span><span>:</span>\n        <span># defaultRegex表示使用组件内置的规则：identity表示身份证号 - 内置的18/15位</span>\n        <span>-</span> <span>defaultRegex</span><span>:</span> identity\n          <span>position</span><span>:</span> <span>9</span><span>,</span><span>13</span>\n        <span># 内置的other表示如果其他规则都无法匹配到，则按该规则处理</span>\n        <span>-</span> <span>defaultRegex</span><span>:</span> other\n          <span>position</span><span>:</span> <span>9</span><span>,</span><span>10</span>\n    <span># 电话号码，key后面的字段都可以匹配以下规则(用逗号分隔)</span>\n    <span>-</span> <span>key</span><span>:</span> phone<span>,</span>cellphone<span>,</span>mobile\n      <span>custom</span><span>:</span>\n        <span># 手机号 - 内置的11位手机匹配规则</span>\n        <span>-</span> <span>defaultRegex</span><span>:</span> phone\n          <span>position</span><span>:</span> <span>4</span><span>,</span><span>7</span>\n        <span># 自定义正则匹配表达式：座机号(带区号，号码七位|八位)</span>\n        <span>-</span> <span>customRegex</span><span>:</span> <span>\"^0[0-9]{2,3}-[0-9]{7,8}\"</span>\n        <span># -后面的1-4位脱敏</span>\n          <span>position</span><span>:</span> <span>\"-&lt;(1,4)\"</span>\n        <span># 自定义正则匹配表达式：座机号(不带区号)</span>\n        <span>-</span> <span>customRegex</span><span>:</span> <span>\"^[0-9]{7,8}\"</span>\n          <span>position</span><span>:</span> <span>3</span><span>,</span><span>5</span>\n        <span># 内置的other表示如果其他规则都无法匹配到，则按该规则处理</span>\n        <span>-</span> <span>defaultRegex</span><span>:</span> other\n          <span>position</span><span>:</span> <span>1</span><span>,</span><span>3</span>\n    <span># 这种方式不太推荐 - 一旦匹配不上，就不会脱敏</span>\n    <span>-</span> <span>key</span><span>:</span> localMobile\n      <span>custom</span><span>:</span>\n          <span>customRegex</span><span>:</span> <span>\"^0[0-9]{2,3}-[0-9]{7,8}\"</span>\n          <span>position</span><span>:</span> <span>1</span><span>,</span><span>3</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>上面这个配置是相对完整的，一定要严格遵守层级配置格式。</p>\n<h4 id=\"自定义脱敏支持的方式\" tabindex=\"-1\"> 自定义脱敏支持的方式</h4>\n<p><strong>1、key:value的方式</strong>\n<code>phone:4,7</code>，表示phone属性的4-7位进行脱敏\n原始数据：13610357861\n脱敏后：136****7861</p>\n<p><strong>2、以符号作为起始、结束节点作为脱敏标志</strong>\n<code>emai:&quot;@&gt;(4,7)&quot;</code>，<code>@</code>为脱敏标志，<code>&gt;</code>表示其为结束节点，<code>&lt;</code>表示其为开始节点。即@&gt;表示对@之前的进行脱敏，@&lt;表示对@之后的进行脱敏。这个示例就是@前的数据的第4-7位进行脱敏。<code>注意：这种规则里的双引号、括号不能省略</code>，<code>其次:和=不能作为标志符号，因为和匹配规则有冲突</code>\n原始数据：<code>123456789@qq.com</code>\n<code>&quot;@&gt;(4,7)&quot;</code>脱敏后：<code>123****89@qq.com</code>\n<code>&quot;@&lt;(1,3)&quot;</code>脱敏后：<code>123456789@***com</code></p>\n<p><strong>3、自定义正则脱敏</strong></p>\n<div><pre><code>  <span>patterns</span><span>:</span>\n    <span># 手机号</span>\n    <span>-</span> <span>key</span><span>:</span> phone<span>,</span>mobile\n      <span>custom</span><span>:</span>\n        <span># 手机号的正则</span>\n        <span>-</span> <span>customRegex</span><span>:</span> <span>\"^1[0-9]{10}\"</span>\n          <span># 脱敏范围</span>\n          <span>position</span><span>:</span> <span>4</span><span>,</span><span>7</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>customRegex：正则表达式，如果符合该表达式，则使用其对应的脱敏规则(position)</p>\n<p><strong>4、一个字段，根据多种值含义进行自定义脱敏</strong>\n比如说，username字段的值可以是手机号、也可以是邮箱，这个值动态改变的，前面几种方式都没办法解决，可以使用该方式。</p>\n<div><pre><code><span>patterns</span><span>:</span>\n  <span>-</span> <span>key</span><span>:</span> username\n    <span>custom</span><span>:</span>\n      <span># 手机号 - 11位</span>\n      <span>-</span> <span>defaultRegex</span><span>:</span> phone\n        <span>position</span> <span>:</span> <span>4</span><span>,</span><span>7</span>\n      <span># 邮箱 - @</span>\n\t  <span>-</span> <span>defaultRegex</span><span>:</span> email\n\t    <span>position</span> <span>:</span> <span>\"@>(3,12)\"</span>\n\t  <span># 身份证 - 15/18位</span>\n\t  <span>-</span> <span>defaultRegex</span><span>:</span> identity\n\t    <span>position</span> <span>:</span> <span>1</span><span>,</span><span>3</span>\n\t  <span># 自定义正则</span>\n\t  <span>-</span> <span>customRegex</span><span>:</span> <span>\"^1[0-9]{10}\"</span>\n\t    <span>position</span> <span>:</span> <span>1</span><span>,</span><span>3</span>\n\t  <span># 都匹配不到时，按照这种规则来</span>\n\t  <span>-</span> <span>defaultRegex</span><span>:</span> other\n\t    <span>position</span> <span>:</span> <span>1</span><span>,</span><span>3</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><code>注意：上面示例中匹配规则里的 双引号和括号 都不能省略</code>\n该组件内置四种匹配规则：手机号、身份证号、邮箱、other(其他匹配不到时用的)，内置一种脱敏方式：password，表示完全脱敏，可用于pattren下的。</p>\n<div><pre><code>注：当pattern和patterns下的key有重复的时候，只会使用pattern下指定的方式进行脱敏。\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h3 id=\"jar包地址和源码地址\" tabindex=\"-1\"> Jar包地址和源码地址</h3>\n<p><a href=\"https://github.com/liuchengyin01/LogbackDesensitization/tree/master/repo/pers/liuchengyin/logback-desensitization/1.0.0\" target=\"_blank\" rel=\"noopener noreferrer\">Jar包Github地址 - logback-desensitization-1.0.0.jar</a></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210129201007764.png\" alt=\"图片\"></p>\n<p>Github地址：<a href=\"https://github.com/liuchengyin01/LogbackDesensitization\" target=\"_blank\" rel=\"noopener noreferrer\">Logback和slf4j的日志脱敏组件Demo</a></p>\n<p>Gitee地址：<a href=\"https://gitee.com/liuchengyin_vae/LogbackDesensitization\" target=\"_blank\" rel=\"noopener noreferrer\">Logback和slf4j的日志脱敏组件Demo</a></p>\n<h4 id=\"jar包打入maven本地仓库的方式\" tabindex=\"-1\"> Jar包打入Maven本地仓库的方式</h4>\n<p>1、下载Jar包，放在一个文件夹里</p>\n<p>2、在这个文件夹里打开cmd(打开cmd，进入到这个文件夹)</p>\n<p>3、执行命令(前提保证maven配置正常，使用mvn -v命令查看是否正常，如果显示版本号表示正常)</p>\n<div><pre><code>mvn install<span>:</span>install<span>-</span>file <span>-</span><span>DgroupId</span><span>=</span>pers<span>.</span>liuchengyin <span>-</span><span>DartifactId</span><span>=</span>logback<span>-</span>desensitization <span>-</span><span>Dversion</span><span>=</span><span>1.0</span><span>.0</span> <span>-</span><span>Dpackaging</span><span>=</span>jar <span>-</span><span>Dfile</span><span>=</span>logback<span>-</span>desensitization<span>-</span><span>1.0</span><span>.0</span><span>.</span>jar\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p><strong>命令说明：</strong></p>\n<div><pre><code> <span>-</span><span>DgroupId</span>\n\t表示jar对应的groupId  \n\t<span><span>&lt;</span>groupId<span>></span></span>pers<span>.</span>liuchengyin<span>&lt;</span><span>/</span>groupId<span>></span>\n <span>-</span><span>DartifactId</span><span>:</span>\n\t表示jar对应的artifactId\n\t<span><span>&lt;</span>artifactId<span>></span></span>logback<span>-</span>desensitization<span>&lt;</span><span>/</span>artifactId<span>></span>\n <span>-</span><span>Dversion</span>\n\t表示jar对应的 version\n\t<span><span>&lt;</span>version<span>></span></span><span>1.0</span><span>.0</span><span>&lt;</span><span>/</span>version<span>></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210129141855313.png",
      "date_published": "2022-08-08T00:00:00.000Z",
      "date_modified": "2022-07-14T01:51:57.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "通过注解实现接口返回数据脱敏",
      "url": "https://blog.ciberviler.top/dev/%E9%80%9A%E8%BF%87%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F.html",
      "id": "https://blog.ciberviler.top/dev/%E9%80%9A%E8%BF%87%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E%E6%95%B0%E6%8D%AE%E8%84%B1%E6%95%8F.html",
      "content_html": "<h1 id=\"通过注解实现接口返回数据脱敏\" tabindex=\"-1\"> 通过注解实现接口返回数据脱敏</h1>\n<h3 id=\"思路\" tabindex=\"-1\"> 思路</h3>\n<p>1.要做成可配置多策略的脱敏操作，要不然一个个接口进行脱敏操作，重复的工作量太多，很显然违背了“多写一行算我输”的程序员规范，思来想去，定义数据脱敏注解和数据脱敏逻辑的接口， 在返回类上，对需要进行脱敏的属性加上，并指定对应的脱敏策略操作</p>\n<p>2.接下来我只需要拦截控制器返回的数据，找到带有脱敏注解的属性操作即可，一开始打算用@ControllerAdvice去实现，但发现需要自己去反射类获取注解，当返回对象比较复杂，需要递归去反射，性能一下子就会降低，于是换种思路，我想到平时使用的@JsonFormat，跟我现在的场景很类似，通过自定义注解跟字段解析器，对字段进行自定义解析，tql</p>\n<h3 id=\"代码\" tabindex=\"-1\"> 代码</h3>\n<h4 id=\"_1-自定义数据注解-并可以配置数据脱敏策略\" tabindex=\"-1\"> 1. 自定义数据注解，并可以配置数据脱敏策略</h4>\n<div><pre><code><span>@Target</span><span>(</span><span>{</span><span>ElementType</span><span>.</span>FIELD<span>,</span> <span>ElementType</span><span>.</span>TYPE<span>}</span><span>)</span>\n<span>@Retention</span><span>(</span><span>RetentionPolicy</span><span>.</span>RUNTIME<span>)</span>\n<span>@Documented</span>\n<span>public</span> <span>@interface</span> <span>DataMasking</span> <span>{</span>\n\n    <span>DataMaskingFunc</span> <span>maskFunc</span><span>(</span><span>)</span> <span>default</span> <span>DataMaskingFunc</span><span>.</span>NO_MASK<span>;</span>\n\n<span>}</span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_2-自定义serializer-参考jackson的stringserializer-下面的示例只针对string类型进行脱敏\" tabindex=\"-1\"> 2. 自定义Serializer，参考jackson的StringSerializer，下面的示例只针对String类型进行脱敏</h4>\n<div><pre><code><span>public</span> <span>interface</span> <span>DataMaskingOperation</span> <span>{</span>\n\n    <span>String</span> MASK_CHAR <span>=</span> <span>\"*\"</span><span>;</span>\n    \n    <span>String</span> <span>mask</span><span>(</span><span>String</span> content<span>,</span> <span>String</span> maskChar<span>)</span><span>;</span>\n\n<span>}</span>\n\n\n<span>public</span> <span>enum</span> <span>DataMaskingFunc</span> <span>{</span>\n\n     <span>/**\n     *  脱敏转换器\n     */</span>\n     <span>NO_MASK</span><span>(</span><span>(</span>str<span>,</span> maskChar<span>)</span> <span>-></span> <span>{</span>\n        <span>return</span> str<span>;</span>\n     <span>}</span><span>)</span><span>,</span>\n     <span>ALL_MASK</span><span>(</span><span>(</span>str<span>,</span> maskChar<span>)</span> <span>-></span> <span>{</span>\n        <span>if</span> <span>(</span><span>StringUtils</span><span>.</span><span>hasLength</span><span>(</span>str<span>)</span><span>)</span> <span>{</span>\n            <span>StringBuilder</span> sb <span>=</span> <span>new</span> <span>StringBuilder</span><span>(</span><span>)</span><span>;</span>\n            <span>for</span> <span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> str<span>.</span><span>length</span><span>(</span><span>)</span><span>;</span> i<span>++</span><span>)</span> <span>{</span>\n                sb<span>.</span><span>append</span><span>(</span><span>StringUtils</span><span>.</span><span>hasLength</span><span>(</span>maskChar<span>)</span> <span>?</span> maskChar <span>:</span> <span>DataMaskingOperation</span><span>.</span>MASK_CHAR<span>)</span><span>;</span>\n            <span>}</span>\n            <span>return</span> sb<span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span>\n        <span>}</span> <span>else</span> <span>{</span>\n            <span>return</span> str<span>;</span>\n        <span>}</span>\n    <span>}</span><span>)</span><span>;</span>\n\n    <span>private</span> <span>final</span> <span>DataMaskingOperation</span> operation<span>;</span>\n\n    <span>private</span> <span>DataMaskingFunc</span><span>(</span><span>DataMaskingOperation</span> operation<span>)</span> <span>{</span>\n        <span>this</span><span>.</span>operation <span>=</span> operation<span>;</span>\n    <span>}</span>\n\n    <span>public</span> <span>DataMaskingOperation</span> <span>operation</span><span>(</span><span>)</span> <span>{</span>\n        <span>return</span> <span>this</span><span>.</span>operation<span>;</span>\n    <span>}</span>\n\n<span>}</span>\n\n\n<span>public</span> <span>final</span> <span>class</span> <span>DataMaskingSerializer</span> <span>extends</span> <span>StdScalarSerializer</span><span><span>&lt;</span><span>Object</span><span>></span></span> <span>{</span>\n    <span>private</span> <span>final</span> <span>DataMaskingOperation</span> operation<span>;</span>\n\n    <span>public</span> <span>DataMaskingSerializer</span><span>(</span><span>)</span> <span>{</span>\n        <span>super</span><span>(</span><span>String</span><span>.</span><span>class</span><span>,</span> <span>false</span><span>)</span><span>;</span>\n        <span>this</span><span>.</span>operation <span>=</span> <span>null</span><span>;</span>\n    <span>}</span>\n\n    <span>public</span> <span>DataMaskingSerializer</span><span>(</span><span>DataMaskingOperation</span> operation<span>)</span> <span>{</span>\n        <span>super</span><span>(</span><span>String</span><span>.</span><span>class</span><span>,</span> <span>false</span><span>)</span><span>;</span>\n        <span>this</span><span>.</span>operation <span>=</span> operation<span>;</span>\n    <span>}</span>\n\n\n    <span>public</span> <span>boolean</span> <span>isEmpty</span><span>(</span><span>SerializerProvider</span> prov<span>,</span> <span>Object</span> value<span>)</span> <span>{</span>\n        <span>String</span> str <span>=</span> <span>(</span><span>String</span><span>)</span>value<span>;</span>\n        <span>return</span> str<span>.</span><span>isEmpty</span><span>(</span><span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>public</span> <span>void</span> <span>serialize</span><span>(</span><span>Object</span> value<span>,</span> <span>JsonGenerator</span> gen<span>,</span> <span>SerializerProvider</span> provider<span>)</span> <span>throws</span> <span>IOException</span> <span>{</span>\n        <span>if</span> <span>(</span><span>Objects</span><span>.</span><span>isNull</span><span>(</span>operation<span>)</span><span>)</span> <span>{</span>\n            <span>String</span> content <span>=</span> <span>DataMaskingFunc</span><span>.</span>ALL_MASK<span>.</span><span>operation</span><span>(</span><span>)</span><span>.</span><span>mask</span><span>(</span><span>(</span><span>String</span><span>)</span> value<span>,</span> <span>null</span><span>)</span><span>;</span>\n            gen<span>.</span><span>writeString</span><span>(</span>content<span>)</span><span>;</span>\n        <span>}</span> <span>else</span> <span>{</span>\n            <span>String</span> content <span>=</span> operation<span>.</span><span>mask</span><span>(</span><span>(</span><span>String</span><span>)</span> value<span>,</span> <span>null</span><span>)</span><span>;</span>\n            gen<span>.</span><span>writeString</span><span>(</span>content<span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n\n    <span>public</span> <span>final</span> <span>void</span> <span>serializeWithType</span><span>(</span><span>Object</span> value<span>,</span> <span>JsonGenerator</span> gen<span>,</span> <span>SerializerProvider</span> provider<span>,</span> <span>TypeSerializer</span> typeSer<span>)</span> <span>throws</span> <span>IOException</span> <span>{</span>\n        <span>this</span><span>.</span><span>serialize</span><span>(</span>value<span>,</span> gen<span>,</span> provider<span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>public</span> <span>JsonNode</span> <span>getSchema</span><span>(</span><span>SerializerProvider</span> provider<span>,</span> <span>Type</span> typeHint<span>)</span> <span>{</span>\n        <span>return</span> <span>this</span><span>.</span><span>createSchemaNode</span><span>(</span><span>\"string\"</span><span>,</span> <span>true</span><span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>public</span> <span>void</span> <span>acceptJsonFormatVisitor</span><span>(</span><span>JsonFormatVisitorWrapper</span> visitor<span>,</span> <span>JavaType</span> typeHint<span>)</span> <span>throws</span> <span>JsonMappingException</span> <span>{</span>\n        <span>this</span><span>.</span><span>visitStringFormat</span><span>(</span>visitor<span>,</span> typeHint<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_3-自定义annotationintrospector-适配我们自定义注解返回相应的serializer\" tabindex=\"-1\"> 3. 自定义AnnotationIntrospector，适配我们自定义注解返回相应的Serializer</h4>\n<div><pre><code><span>@Slf4j</span>\n<span>public</span> <span>class</span> <span>DataMaskingAnnotationIntrospector</span> <span>extends</span> <span>NopAnnotationIntrospector</span> <span>{</span>\n\n    <span>@Override</span>\n    <span>public</span> <span>Object</span> <span>findSerializer</span><span>(</span><span>Annotated</span> am<span>)</span> <span>{</span>\n        <span>DataMasking</span> annotation <span>=</span> am<span>.</span><span>getAnnotation</span><span>(</span><span>DataMasking</span><span>.</span><span>class</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span>annotation <span>!=</span> <span>null</span><span>)</span> <span>{</span>\n            <span>return</span> <span>new</span> <span>DataMaskingSerializer</span><span>(</span>annotation<span>.</span><span>maskFunc</span><span>(</span><span>)</span><span>.</span><span>operation</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>}</span>\n        <span>return</span> <span>null</span><span>;</span>\n    <span>}</span>\n\n<span>}</span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_4-覆盖objectmapper\" tabindex=\"-1\"> 4. 覆盖ObjectMapper</h4>\n<div><pre><code><span>@Configuration</span><span>(</span>\n        proxyBeanMethods <span>=</span> <span>false</span>\n<span>)</span>\n<span>public</span> <span>class</span> <span>DataMaskConfiguration</span> <span>{</span>\n\n    <span>@Configuration</span><span>(</span>\n            proxyBeanMethods <span>=</span> <span>false</span>\n    <span>)</span>\n    <span>@ConditionalOnClass</span><span>(</span><span>{</span><span>Jackson2ObjectMapperBuilder</span><span>.</span><span>class</span><span>}</span><span>)</span>\n    <span>static</span> <span>class</span> <span>JacksonObjectMapperConfiguration</span> <span>{</span>\n        <span>JacksonObjectMapperConfiguration</span><span>(</span><span>)</span> <span>{</span>\n        <span>}</span>\n\n        <span>@Bean</span>\n        <span>@Primary</span>\n        <span>ObjectMapper</span> <span>jacksonObjectMapper</span><span>(</span><span>Jackson2ObjectMapperBuilder</span> builder<span>)</span> <span>{</span>\n            <span>ObjectMapper</span> objectMapper <span>=</span> builder<span>.</span><span>createXmlMapper</span><span>(</span><span>false</span><span>)</span><span>.</span><span>build</span><span>(</span><span>)</span><span>;</span>\n            <span>AnnotationIntrospector</span> ai <span>=</span> objectMapper<span>.</span><span>getSerializationConfig</span><span>(</span><span>)</span><span>.</span><span>getAnnotationIntrospector</span><span>(</span><span>)</span><span>;</span>\n            <span>AnnotationIntrospector</span> newAi <span>=</span> <span>AnnotationIntrospectorPair</span><span>.</span><span>pair</span><span>(</span>ai<span>,</span> <span>new</span> <span>DataMaskingAnnotationIntrospector</span><span>(</span><span>)</span><span>)</span><span>;</span>\n            objectMapper<span>.</span><span>setAnnotationIntrospector</span><span>(</span>newAi<span>)</span><span>;</span>\n            <span>return</span> objectMapper<span>;</span>\n        <span>}</span>\n    <span>}</span>\n\n<span>}</span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_5-返回对象加上注解\" tabindex=\"-1\"> 5. 返回对象加上注解</h4>\n<div><pre><code><span>public</span> <span>class</span> <span>User</span> <span>implements</span> <span>Serializable</span> <span>{</span>\n    <span>/**\n     * 主键ID\n     */</span>\n    <span>private</span> <span>Long</span> id<span>;</span>\n\n    <span>/**\n     * 姓名\n     */</span>\n    <span>@DataMasking</span><span>(</span>maskFunc <span>=</span> <span>DataMaskingFunc</span><span>.</span>ALL_MASK<span>)</span>\n    <span>private</span> <span>String</span> name<span>;</span>\n\n    <span>/**\n     * 年龄\n     */</span>\n    <span>private</span> <span>Integer</span> age<span>;</span>\n\n    <span>/**\n     * 邮箱\n     */</span>\n    <span>@DataMasking</span><span>(</span>maskFunc <span>=</span> <span>DataMaskingFunc</span><span>.</span>ALL_MASK<span>)</span>\n    <span>private</span> <span>String</span> email<span>;</span>\n\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "date_published": "2022-08-07T00:00:00.000Z",
      "date_modified": "2022-07-14T01:51:48.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "sql语句优化的30种方法",
      "url": "https://blog.ciberviler.top/dev/sql%E8%AF%AD%E5%8F%A5%E4%BC%98%E5%8C%96%E7%9A%8430%E7%A7%8D%E6%96%B9%E6%B3%95.html",
      "id": "https://blog.ciberviler.top/dev/sql%E8%AF%AD%E5%8F%A5%E4%BC%98%E5%8C%96%E7%9A%8430%E7%A7%8D%E6%96%B9%E6%B3%95.html",
      "content_html": "<h1 id=\"sql语句优化的30种方法\" tabindex=\"-1\"> sql语句优化的30种方法</h1>\n<h5 id=\"_1-对查询进行优化-应尽量避免全表扫描-首先应考虑在-where-及-order-by-涉及的列上建立索引。\" tabindex=\"-1\"> 1.对查询进行优化，应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引。</h5>\n<h5 id=\"_2-应尽量避免在-where-子句中使用-或-操作符-否则将引擎放弃使用索引而进行全表扫描。\" tabindex=\"-1\"> 2.应尽量避免在 where 子句中使用!=或&lt;&gt;操作符，否则将引擎放弃使用索引而进行全表扫描。</h5>\n<h5 id=\"_3-应尽量避免在-where-子句中对字段进行-null-值判断-否则将导致引擎放弃使用索引而进行全表扫描-如\" tabindex=\"-1\"> 3.应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如：</h5>\n<div><pre><code><span>select</span> id <span>from</span> t <span>where</span> num <span>is</span> <span>null</span> \n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>可以在num上设置默认值0，确保表中num列没有null值，然后这样查询：</p>\n<div><pre><code><span>select</span> id <span>from</span> t <span>where</span> num<span>=</span><span>0</span> \n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h5 id=\"_4-应尽量避免在-where-子句中使用-or-来连接条件-否则将导致引擎放弃使用索引而进行全表扫描-如\" tabindex=\"-1\"> 4.应尽量避免在 where 子句中使用 or 来连接条件，否则将导致引擎放弃使用索引而进行全表扫描，如：</h5>\n<div><pre><code><span>select</span> id <span>from</span> t <span>where</span> num<span>=</span><span>10</span> <span>or</span> num<span>=</span><span>20</span> \n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>可以这样查询：</p>\n<div><pre><code><span>select</span> id <span>from</span> t <span>where</span> num<span>=</span><span>10</span> \n<span>union</span> <span>all</span> \n<span>select</span> id <span>from</span> t <span>where</span> num<span>=</span><span>20</span> \n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h5 id=\"_5-下面的查询也将导致全表扫描\" tabindex=\"-1\"> 5.下面的查询也将导致全表扫描：</h5>\n<div><pre><code><span>select</span> id <span>from</span> t <span>where</span> name <span>like</span> <span>'%abc%'</span> \n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>若要提高效率，可以考虑全文检索。</p>\n<h5 id=\"_6-in-和-not-in-也要慎用-否则会导致全表扫描-如\" tabindex=\"-1\"> <a href=\"http://6.in\" target=\"_blank\" rel=\"noopener noreferrer\">6.in</a> 和 not in 也要慎用，否则会导致全表扫描，如：</h5>\n<div><pre><code><span>select</span> id <span>from</span> t <span>where</span> num <span>in</span><span>(</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>)</span> \n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>对于连续的数值，能用 between 就不要用 in 了：</p>\n<div><pre><code><span>select</span> id <span>from</span> t <span>where</span> num <span>between</span> <span>1</span> <span>and</span> <span>3</span> \n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h5 id=\"_7-如果在-where-子句中使用参数-也会导致全表扫描。因为sql只有在运行时才会解析局部变量-但优化程序不能将访问计划的选择推迟到运行时-它必须在编译时进行选择。然而-如果在编译时建立访问计划-变量的值还是未知的-因而无法作为索引选择的输入项。如下面语句将进行全表扫描\" tabindex=\"-1\"> 7.如果在 where 子句中使用参数，也会导致全表扫描。因为SQL只有在运行时才会解析局部变量，但优化程序不能将访问计划的选择推迟到运行时；它必须在编译时进行选择。然而，如果在编译时建立访问计划，变量的值还是未知的，因而无法作为索引选择的输入项。如下面语句将进行全表扫描：</h5>\n<div><pre><code><span>select</span> id <span>from</span> t <span>where</span> num<span>=</span><span>@num</span> \n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>可以改为强制查询使用索引：</p>\n<div><pre><code><span>select</span> id <span>from</span> t <span>with</span><span>(</span><span>index</span><span>(</span>索引名<span>)</span><span>)</span> <span>where</span> num<span>=</span><span>@num</span> \n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h5 id=\"_8-应尽量避免在-where-子句中对字段进行表达式操作-这将导致引擎放弃使用索引而进行全表扫描。如\" tabindex=\"-1\"> 8.应尽量避免在 where 子句中对字段进行表达式操作，这将导致引擎放弃使用索引而进行全表扫描。如：</h5>\n<div><pre><code><span>select</span> id <span>from</span> t <span>where</span> num<span>/</span><span>2</span><span>=</span><span>100</span> \n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>应改为:</p>\n<div><pre><code><span>select</span> id <span>from</span> t <span>where</span> num<span>=</span><span>100</span><span>*</span><span>2</span> \n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h5 id=\"_9-应尽量避免在where子句中对字段进行函数操作-这将导致引擎放弃使用索引而进行全表扫描。如\" tabindex=\"-1\"> 9.应尽量避免在where子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。如：</h5>\n<div><pre><code><span>select</span> id <span>from</span> t <span>where</span> substring<span>(</span>name<span>,</span><span>1</span><span>,</span><span>3</span><span>)</span><span>=</span><span>'abc'</span><span>--name以abc开头的id </span>\n<span>select</span> id <span>from</span> t <span>where</span> datediff<span>(</span><span>day</span><span>,</span>createdate<span>,</span><span>'2005-11-30'</span><span>)</span><span>=</span><span>0</span><span>--'2005-11-30'生成的id </span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>应改为:</p>\n<div><pre><code><span>select</span> id <span>from</span> t <span>where</span> name <span>like</span> <span>'abc%'</span> \n<span>select</span> id <span>from</span> t <span>where</span> createdate<span>>=</span><span>'2005-11-30'</span> <span>and</span> createdate<span>&lt;</span><span>'2005-12-1'</span> \n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h5 id=\"_10-不要在-where-子句中的-左边进行函数、算术运算或其他表达式运算-否则系统将可能无法正确使用索引。\" tabindex=\"-1\"> 10.不要在 where 子句中的“=”左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。</h5>\n<h5 id=\"_11-在使用索引字段作为条件时-如果该索引是复合索引-那么必须使用到该索引中的第一个字段作为条件时才能保证系统使用该索引-否则该索引将不会被使用-并且应尽可能的让字段顺序与索引顺序相一致。\" tabindex=\"-1\"> 11.在使用索引字段作为条件时，如果该索引是复合索引，那么必须使用到该索引中的第一个字段作为条件时才能保证系统使用该索引，否则该索引将不会被使用，并且应尽可能的让字段顺序与索引顺序相一致。</h5>\n<h5 id=\"_12-不要写一些没有意义的查询-如需要生成一个空表结构\" tabindex=\"-1\"> 12.不要写一些没有意义的查询，如需要生成一个空表结构：</h5>\n<div><pre><code><span>select</span> col1<span>,</span>col2 <span>into</span> <span>#t from t where 1=0 </span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>这类代码不会返回任何结果集，但是会消耗系统资源的，应改成这样：</p>\n<div><pre><code><span>create</span> <span>table</span> <span>#t(...) </span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h5 id=\"_13-很多时候用-exists-代替-in-是一个好的选择\" tabindex=\"-1\"> 13.很多时候用 exists 代替 in 是一个好的选择：</h5>\n<div><pre><code><span>select</span> num <span>from</span> a <span>where</span> num <span>in</span><span>(</span><span>select</span> num <span>from</span> b<span>)</span> \n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>用下面的语句替换：</p>\n<div><pre><code><span>select</span> num <span>from</span> a <span>where</span> <span>exists</span><span>(</span><span>select</span> <span>1</span> <span>from</span> b <span>where</span> num<span>=</span>a<span>.</span>num<span>)</span> \n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h5 id=\"_14-并不是所有索引对查询都有效-sql是根据表中数据来进行查询优化的-当索引列有大量数据重复时-sql查询可能不会去利用索引-如一表中有字段sex-male、female几乎各一半-那么即使在sex上建了索引也对查询效率起不了作用。\" tabindex=\"-1\"> 14.并不是所有索引对查询都有效，SQL是根据表中数据来进行查询优化的，当索引列有大量数据重复时，SQL查询可能不会去利用索引，如一表中有字段sex，male、female几乎各一半，那么即使在sex上建了索引也对查询效率起不了作用。</h5>\n<h5 id=\"_15-索引并不是越多越好-索引固然可以提高相应的-select-的效率-但同时也降低了-insert-及-update-的效率-因为-insert-或-update-时有可能会重建索引-所以怎样建索引需要慎重考虑-视具体情况而定。一个表的索引数最好不要超过6个-若太多则应考虑一些不常使用到的列上建的索引是否有必要。\" tabindex=\"-1\"> 15.索引并不是越多越好，索引固然可以提高相应的 select 的效率，但同时也降低了 insert 及 update 的效率，因为 insert 或 update 时有可能会重建索引，所以怎样建索引需要慎重考虑，视具体情况而定。一个表的索引数最好不要超过6个，若太多则应考虑一些不常使用到的列上建的索引是否有必要。</h5>\n<h5 id=\"_16-应尽可能的避免更新-clustered-索引数据列-因为-clustered-索引数据列的顺序就是表记录的物理存储顺序-一旦该列值改变将导致整个表记录的顺序的调整-会耗费相当大的资源。若应用系统需要频繁更新-clustered-索引数据列-那么需要考虑是否应将该索引建为-clustered-索引。\" tabindex=\"-1\"> 16.应尽可能的避免更新 clustered 索引数据列，因为 clustered 索引数据列的顺序就是表记录的物理存储顺序，一旦该列值改变将导致整个表记录的顺序的调整，会耗费相当大的资源。若应用系统需要频繁更新 clustered 索引数据列，那么需要考虑是否应将该索引建为 clustered 索引。</h5>\n<h5 id=\"_17-尽量使用数字型字段-若只含数值信息的字段尽量不要设计为字符型-这会降低查询和连接的性能-并会增加存储开销。这是因为引擎在处理查询和连接时会逐个比较字符串中每一个字符-而对于数字型而言只需要比较一次就够了。\" tabindex=\"-1\"> 17.尽量使用数字型字段，若只含数值信息的字段尽量不要设计为字符型，这会降低查询和连接的性能，并会增加存储开销。这是因为引擎在处理查询和连接时会逐个比较字符串中每一个字符，而对于数字型而言只需要比较一次就够了。</h5>\n<h5 id=\"_18-尽可能的使用-varchar-nvarchar-代替-char-nchar-因为首先变长字段存储空间小-可以节省存储空间-其次对于查询来说-在一个相对较小的字段内搜索效率显然要高些。\" tabindex=\"-1\"> 18.尽可能的使用 varchar/nvarchar 代替 char/nchar ，因为首先变长字段存储空间小，可以节省存储空间，其次对于查询来说，在一个相对较小的字段内搜索效率显然要高些。</h5>\n<h5 id=\"_19-任何地方都不要使用-select-from-t-用具体的字段列表代替-不要返回用不到的任何字段。\" tabindex=\"-1\"> 19.任何地方都不要使用 select * from t ，用具体的字段列表代替“*”，不要返回用不到的任何字段。</h5>\n<h5 id=\"_20-尽量使用表变量来代替临时表。如果表变量包含大量数据-请注意索引非常有限-只有主键索引-。\" tabindex=\"-1\"> 20.尽量使用表变量来代替临时表。如果表变量包含大量数据，请注意索引非常有限（只有主键索引）。</h5>\n<h5 id=\"_21-避免频繁创建和删除临时表-以减少系统表资源的消耗。\" tabindex=\"-1\"> 21.避免频繁创建和删除临时表，以减少系统表资源的消耗。</h5>\n<h5 id=\"_22-临时表并不是不可使用-适当地使用它们可以使某些例程更有效-例如-当需要重复引用大型表或常用表中的某个数据集时。但是-对于一次性事件-最好使用导出表。\" tabindex=\"-1\"> 22.临时表并不是不可使用，适当地使用它们可以使某些例程更有效，例如，当需要重复引用大型表或常用表中的某个数据集时。但是，对于一次性事件，最好使用导出表。</h5>\n<h5 id=\"_23-在新建临时表时-如果一次性插入数据量很大-那么可以使用-select-into-代替-create-table-避免造成大量-log-以提高速度-如果数据量不大-为了缓和系统表的资源-应先create-table-然后insert。\" tabindex=\"-1\"> 23.在新建临时表时，如果一次性插入数据量很大，那么可以使用 select into 代替 create table，避免造成大量 log ，以提高速度；如果数据量不大，为了缓和系统表的资源，应先create table，然后insert。</h5>\n<h5 id=\"_24-如果使用到了临时表-在存储过程的最后务必将所有的临时表显式删除-先-truncate-table-然后-drop-table-这样可以避免系统表的较长时间锁定。\" tabindex=\"-1\"> 24.如果使用到了临时表，在存储过程的最后务必将所有的临时表显式删除，先 truncate table ，然后 drop table ，这样可以避免系统表的较长时间锁定。</h5>\n<h5 id=\"_25-尽量避免使用游标-因为游标的效率较差-如果游标操作的数据超过1万行-那么就应该考虑改写。\" tabindex=\"-1\"> 25.尽量避免使用游标，因为游标的效率较差，如果游标操作的数据超过1万行，那么就应该考虑改写。</h5>\n<h5 id=\"_26-使用基于游标的方法或临时表方法之前-应先寻找基于集的解决方案来解决问题-基于集的方法通常更有效。\" tabindex=\"-1\"> 26.使用基于游标的方法或临时表方法之前，应先寻找基于集的解决方案来解决问题，基于集的方法通常更有效。</h5>\n<h5 id=\"_27-与临时表一样-游标并不是不可使用。对小型数据集使用-fast-forward-游标通常要优于其他逐行处理方法-尤其是在必须引用几个表才能获得所需的数据时。在结果集中包括-合计-的例程通常要比使用游标执行的速度快。如果开发时间允许-基于游标的方法和基于集的方法都可以尝试一下-看哪一种方法的效果更好。\" tabindex=\"-1\"> 27.与临时表一样，游标并不是不可使用。对小型数据集使用 FAST_FORWARD 游标通常要优于其他逐行处理方法，尤其是在必须引用几个表才能获得所需的数据时。在结果集中包括“合计”的例程通常要比使用游标执行的速度快。如果开发时间允许，基于游标的方法和基于集的方法都可以尝试一下，看哪一种方法的效果更好。</h5>\n<h5 id=\"_28-在所有的存储过程和触发器的开始处设置-set-nocount-on-在结束时设置-set-nocount-off-。无需在执行存储过程和触发器的每个语句后向客户端发送-done-in-proc-消息。\" tabindex=\"-1\"> 28.在所有的存储过程和触发器的开始处设置 SET NOCOUNT ON ，在结束时设置 SET NOCOUNT OFF 。无需在执行存储过程和触发器的每个语句后向客户端发送 DONE_IN_PROC 消息。</h5>\n<h5 id=\"_29-尽量避免向客户端返回大数据量-若数据量过大-应该考虑相应需求是否合理。\" tabindex=\"-1\"> 29.尽量避免向客户端返回大数据量，若数据量过大，应该考虑相应需求是否合理。</h5>\n<h5 id=\"_30-尽量避免大事务操作-提高系统并发能力。\" tabindex=\"-1\"> 30.尽量避免大事务操作，提高系统并发能力。</h5>\n",
      "date_published": "2022-08-06T00:00:00.000Z",
      "date_modified": "2022-07-14T01:51:39.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "SpringBoot+Kafka+ELK 完成海量日志收集",
      "url": "https://blog.ciberviler.top/dev/SpringBoot+Kafka+ELK%E5%AE%8C%E6%88%90%E6%B5%B7%E9%87%8F%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86.html",
      "id": "https://blog.ciberviler.top/dev/SpringBoot+Kafka+ELK%E5%AE%8C%E6%88%90%E6%B5%B7%E9%87%8F%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86.html",
      "content_html": "<h1 id=\"springboot-kafka-elk-完成海量日志收集\" tabindex=\"-1\"> SpringBoot+Kafka+ELK 完成海量日志收集</h1>\n<p>整体流程大概如下：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16577076343400.png\" alt=\"SpringBoot+Kafka+ELK\"></p>\n<h3 id=\"服务器准备\" tabindex=\"-1\"> 服务器准备</h3>\n<p>在这先列出各服务器节点，方便同学们在下文中对照节点查看相应内容</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16577076343401.png\" alt=\"SpringBoot+Kafka+ELK\"></p>\n<h3 id=\"springboot项目准备\" tabindex=\"-1\"> SpringBoot项目准备</h3>\n<p>引入log4j2替换SpringBoot默认log，demo项目结构如下：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220713182137039.png\" alt=\"SpringBoot+Kafka+ELK\"></p>\n<p><strong>pom</strong></p>\n<div><pre><code><span><span><span>&lt;</span>dependencies</span><span>></span></span>\n    <span><span><span>&lt;</span>dependency</span><span>></span></span>\n        <span><span><span>&lt;</span>groupId</span><span>></span></span>org.springframework.boot<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n        <span><span><span>&lt;</span>artifactId</span><span>></span></span>spring-boot-starter-web<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n        <span>&lt;!--  排除spring-boot-starter-logging --></span>\n        <span><span><span>&lt;</span>exclusions</span><span>></span></span>\n            <span><span><span>&lt;</span>exclusion</span><span>></span></span>\n                <span><span><span>&lt;</span>groupId</span><span>></span></span>org.springframework.boot<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n                <span><span><span>&lt;</span>artifactId</span><span>></span></span>spring-boot-starter-logging<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n            <span><span><span>&lt;/</span>exclusion</span><span>></span></span>\n        <span><span><span>&lt;/</span>exclusions</span><span>></span></span>\n    <span><span><span>&lt;/</span>dependency</span><span>></span></span> \n <span>&lt;!-- log4j2 --></span>\n <span><span><span>&lt;</span>dependency</span><span>></span></span>\n     <span><span><span>&lt;</span>groupId</span><span>></span></span>org.springframework.boot<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n     <span><span><span>&lt;</span>artifactId</span><span>></span></span>spring-boot-starter-log4j2<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n <span><span><span>&lt;/</span>dependency</span><span>></span></span> \n   <span><span><span>&lt;</span>dependency</span><span>></span></span>\n     <span><span><span>&lt;</span>groupId</span><span>></span></span>com.lmax<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n     <span><span><span>&lt;</span>artifactId</span><span>></span></span>disruptor<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n     <span><span><span>&lt;</span>version</span><span>></span></span>3.3.4<span><span><span>&lt;/</span>version</span><span>></span></span>\n   <span><span><span>&lt;/</span>dependency</span><span>></span></span> \n<span><span><span>&lt;/</span>dependencies</span><span>></span></span> \n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>log4j2.xml</strong></p>\n<div><pre><code><span>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span>\n<span><span><span>&lt;</span>Configuration</span> <span>status</span><span><span>=</span><span>\"</span>INFO<span>\"</span></span> <span>schema</span><span><span>=</span><span>\"</span>Log4J-V2.0.xsd<span>\"</span></span> <span>monitorInterval</span><span><span>=</span><span>\"</span>600<span>\"</span></span> <span>></span></span>\n    <span><span><span>&lt;</span>Properties</span><span>></span></span>\n        <span><span><span>&lt;</span>Property</span> <span>name</span><span><span>=</span><span>\"</span>LOG_HOME<span>\"</span></span><span>></span></span>logs<span><span><span>&lt;/</span>Property</span><span>></span></span>\n        <span><span><span>&lt;</span>property</span> <span>name</span><span><span>=</span><span>\"</span>FILE_NAME<span>\"</span></span><span>></span></span>collector<span><span><span>&lt;/</span>property</span><span>></span></span>\n        <span><span><span>&lt;</span>property</span> <span>name</span><span><span>=</span><span>\"</span>patternLayout<span>\"</span></span><span>></span></span>[%d{yyyy-MM-dd'T'HH:mm:ss.SSSZZ}] [%level{length=5}] [%thread-%tid] [%logger] [%X{hostName}] [%X{ip}] [%X{applicationName}] [%F,%L,%C,%M] [%m] ## '%ex'%n<span><span><span>&lt;/</span>property</span><span>></span></span>\n    <span><span><span>&lt;/</span>Properties</span><span>></span></span>\n    <span><span><span>&lt;</span>Appenders</span><span>></span></span>\n        <span><span><span>&lt;</span>Console</span> <span>name</span><span><span>=</span><span>\"</span>CONSOLE<span>\"</span></span> <span>target</span><span><span>=</span><span>\"</span>SYSTEM_OUT<span>\"</span></span><span>></span></span>\n            <span><span><span>&lt;</span>PatternLayout</span> <span>pattern</span><span><span>=</span><span>\"</span>${patternLayout}<span>\"</span></span><span>/></span></span>\n        <span><span><span>&lt;/</span>Console</span><span>></span></span>  \n        <span><span><span>&lt;</span>RollingRandomAccessFile</span> <span>name</span><span><span>=</span><span>\"</span>appAppender<span>\"</span></span> <span>fileName</span><span><span>=</span><span>\"</span>${LOG_HOME}/app-${FILE_NAME}.log<span>\"</span></span> <span>filePattern</span><span><span>=</span><span>\"</span>${LOG_HOME}/app-${FILE_NAME}-%d{yyyy-MM-dd}-%i.log<span>\"</span></span> <span>></span></span>\n          <span><span><span>&lt;</span>PatternLayout</span> <span>pattern</span><span><span>=</span><span>\"</span>${patternLayout}<span>\"</span></span> <span>/></span></span>\n          <span><span><span>&lt;</span>Policies</span><span>></span></span>\n              <span><span><span>&lt;</span>TimeBasedTriggeringPolicy</span> <span>interval</span><span><span>=</span><span>\"</span>1<span>\"</span></span><span>/></span></span>\n              <span><span><span>&lt;</span>SizeBasedTriggeringPolicy</span> <span>size</span><span><span>=</span><span>\"</span>500MB<span>\"</span></span><span>/></span></span>\n          <span><span><span>&lt;/</span>Policies</span><span>></span></span>\n          <span><span><span>&lt;</span>DefaultRolloverStrategy</span> <span>max</span><span><span>=</span><span>\"</span>20<span>\"</span></span><span>/></span></span>         \n        <span><span><span>&lt;/</span>RollingRandomAccessFile</span><span>></span></span>\n        <span><span><span>&lt;</span>RollingRandomAccessFile</span> <span>name</span><span><span>=</span><span>\"</span>errorAppender<span>\"</span></span> <span>fileName</span><span><span>=</span><span>\"</span>${LOG_HOME}/error-${FILE_NAME}.log<span>\"</span></span> <span>filePattern</span><span><span>=</span><span>\"</span>${LOG_HOME}/error-${FILE_NAME}-%d{yyyy-MM-dd}-%i.log<span>\"</span></span> <span>></span></span>\n          <span><span><span>&lt;</span>PatternLayout</span> <span>pattern</span><span><span>=</span><span>\"</span>${patternLayout}<span>\"</span></span> <span>/></span></span>\n          <span><span><span>&lt;</span>Filters</span><span>></span></span>\n              <span><span><span>&lt;</span>ThresholdFilter</span> <span>level</span><span><span>=</span><span>\"</span>warn<span>\"</span></span> <span>onMatch</span><span><span>=</span><span>\"</span>ACCEPT<span>\"</span></span> <span>onMismatch</span><span><span>=</span><span>\"</span>DENY<span>\"</span></span><span>/></span></span>\n          <span><span><span>&lt;/</span>Filters</span><span>></span></span>              \n          <span><span><span>&lt;</span>Policies</span><span>></span></span>\n              <span><span><span>&lt;</span>TimeBasedTriggeringPolicy</span> <span>interval</span><span><span>=</span><span>\"</span>1<span>\"</span></span><span>/></span></span>\n              <span><span><span>&lt;</span>SizeBasedTriggeringPolicy</span> <span>size</span><span><span>=</span><span>\"</span>500MB<span>\"</span></span><span>/></span></span>\n          <span><span><span>&lt;/</span>Policies</span><span>></span></span>\n          <span><span><span>&lt;</span>DefaultRolloverStrategy</span> <span>max</span><span><span>=</span><span>\"</span>20<span>\"</span></span><span>/></span></span>         \n        <span><span><span>&lt;/</span>RollingRandomAccessFile</span><span>></span></span>            \n    <span><span><span>&lt;/</span>Appenders</span><span>></span></span>\n    <span><span><span>&lt;</span>Loggers</span><span>></span></span>\n        <span>&lt;!-- 业务相关 异步logger --></span>\n        <span><span><span>&lt;</span>AsyncLogger</span> <span>name</span><span><span>=</span><span>\"</span>com.bfxy.*<span>\"</span></span> <span>level</span><span><span>=</span><span>\"</span>info<span>\"</span></span> <span>includeLocation</span><span><span>=</span><span>\"</span>true<span>\"</span></span><span>></span></span>\n          <span><span><span>&lt;</span>AppenderRef</span> <span>ref</span><span><span>=</span><span>\"</span>appAppender<span>\"</span></span><span>/></span></span>\n        <span><span><span>&lt;/</span>AsyncLogger</span><span>></span></span>\n        <span><span><span>&lt;</span>AsyncLogger</span> <span>name</span><span><span>=</span><span>\"</span>com.bfxy.*<span>\"</span></span> <span>level</span><span><span>=</span><span>\"</span>info<span>\"</span></span> <span>includeLocation</span><span><span>=</span><span>\"</span>true<span>\"</span></span><span>></span></span>\n          <span><span><span>&lt;</span>AppenderRef</span> <span>ref</span><span><span>=</span><span>\"</span>errorAppender<span>\"</span></span><span>/></span></span>\n        <span><span><span>&lt;/</span>AsyncLogger</span><span>></span></span>       \n        <span><span><span>&lt;</span>Root</span> <span>level</span><span><span>=</span><span>\"</span>info<span>\"</span></span><span>></span></span>\n            <span><span><span>&lt;</span>Appender-Ref</span> <span>ref</span><span><span>=</span><span>\"</span>CONSOLE<span>\"</span></span><span>/></span></span>\n            <span><span><span>&lt;</span>Appender-Ref</span> <span>ref</span><span><span>=</span><span>\"</span>appAppender<span>\"</span></span><span>/></span></span>\n            <span><span><span>&lt;</span>AppenderRef</span> <span>ref</span><span><span>=</span><span>\"</span>errorAppender<span>\"</span></span><span>/></span></span>\n        <span><span><span>&lt;/</span>Root</span><span>></span></span>         \n    <span><span><span>&lt;/</span>Loggers</span><span>></span></span>\n<span><span><span>&lt;/</span>Configuration</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>IndexController</strong></p>\n<p>测试Controller，用以打印日志进行调试</p>\n<div><pre><code><span>@Slf4j</span>\n<span>@RestController</span>\n<span>public</span> <span>class</span> <span>IndexController</span> <span>{</span>\n\n <span>@RequestMapping</span><span>(</span>value <span>=</span> <span>\"/index\"</span><span>)</span>\n <span>public</span> <span>String</span> <span>index</span><span>(</span><span>)</span> <span>{</span>\n  <span>InputMDC</span><span>.</span><span>putMDC</span><span>(</span><span>)</span><span>;</span>\n  \n  log<span>.</span><span>info</span><span>(</span><span>\"我是一条info日志\"</span><span>)</span><span>;</span>\n  \n  log<span>.</span><span>warn</span><span>(</span><span>\"我是一条warn日志\"</span><span>)</span><span>;</span>\n\n  log<span>.</span><span>error</span><span>(</span><span>\"我是一条error日志\"</span><span>)</span><span>;</span>\n  \n  <span>return</span> <span>\"idx\"</span><span>;</span>\n <span>}</span>\n\n\n <span>@RequestMapping</span><span>(</span>value <span>=</span> <span>\"/err\"</span><span>)</span>\n <span>public</span> <span>String</span> <span>err</span><span>(</span><span>)</span> <span>{</span>\n  <span>InputMDC</span><span>.</span><span>putMDC</span><span>(</span><span>)</span><span>;</span>\n  <span>try</span> <span>{</span>\n   <span>int</span> a <span>=</span> <span>1</span><span>/</span><span>0</span><span>;</span>\n  <span>}</span> <span>catch</span> <span>(</span><span>Exception</span> e<span>)</span> <span>{</span>\n   log<span>.</span><span>error</span><span>(</span><span>\"算术异常\"</span><span>,</span> e<span>)</span><span>;</span>\n  <span>}</span>\n  <span>return</span> <span>\"err\"</span><span>;</span>\n <span>}</span>\n \n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>InputMDC</strong></p>\n<p>用以获取log中的<code>[%X{hostName}]</code>、<code>[%X{ip}]</code>、<code>[%X{applicationName}]</code>三个字段值</p>\n<div><pre><code><span>@Component</span>\n<span>public</span> <span>class</span> <span>InputMDC</span> <span>implements</span> <span>EnvironmentAware</span> <span>{</span>\n\n <span>private</span> <span>static</span> <span>Environment</span> environment<span>;</span>\n \n <span>@Override</span>\n <span>public</span> <span>void</span> <span>setEnvironment</span><span>(</span><span>Environment</span> environment<span>)</span> <span>{</span>\n  <span>InputMDC</span><span>.</span>environment <span>=</span> environment<span>;</span>\n <span>}</span>\n \n <span>public</span> <span>static</span> <span>void</span> <span>putMDC</span><span>(</span><span>)</span> <span>{</span>\n  MDC<span>.</span><span>put</span><span>(</span><span>\"hostName\"</span><span>,</span> <span>NetUtil</span><span>.</span><span>getLocalHostName</span><span>(</span><span>)</span><span>)</span><span>;</span>\n  MDC<span>.</span><span>put</span><span>(</span><span>\"ip\"</span><span>,</span> <span>NetUtil</span><span>.</span><span>getLocalIp</span><span>(</span><span>)</span><span>)</span><span>;</span>\n  MDC<span>.</span><span>put</span><span>(</span><span>\"applicationName\"</span><span>,</span> environment<span>.</span><span>getProperty</span><span>(</span><span>\"spring.application.name\"</span><span>)</span><span>)</span><span>;</span>\n <span>}</span>\n\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>NetUtil</strong></p>\n<div><pre><code><span>public</span> <span>class</span> <span>NetUtil</span> <span>{</span>   \n \n <span>public</span> <span>static</span> <span>String</span> <span>normalizeAddress</span><span>(</span><span>String</span> address<span>)</span><span>{</span>\n  <span>String</span><span>[</span><span>]</span> blocks <span>=</span> address<span>.</span><span>split</span><span>(</span><span>\"[:]\"</span><span>)</span><span>;</span>\n  <span>if</span><span>(</span>blocks<span>.</span>length <span>></span> <span>2</span><span>)</span><span>{</span>\n   <span>throw</span> <span>new</span> <span>IllegalArgumentException</span><span>(</span>address <span>+</span> <span>\" is invalid\"</span><span>)</span><span>;</span>\n  <span>}</span>\n  <span>String</span> host <span>=</span> blocks<span>[</span><span>0</span><span>]</span><span>;</span>\n  <span>int</span> port <span>=</span> <span>80</span><span>;</span>\n  <span>if</span><span>(</span>blocks<span>.</span>length <span>></span> <span>1</span><span>)</span><span>{</span>\n   port <span>=</span> <span>Integer</span><span>.</span><span>valueOf</span><span>(</span>blocks<span>[</span><span>1</span><span>]</span><span>)</span><span>;</span>\n  <span>}</span> <span>else</span> <span>{</span>\n   address <span>+=</span> <span>\":\"</span><span>+</span>port<span>;</span> <span>//use default 80</span>\n  <span>}</span> \n  <span>String</span> serverAddr <span>=</span> <span>String</span><span>.</span><span>format</span><span>(</span><span>\"%s:%d\"</span><span>,</span> host<span>,</span> port<span>)</span><span>;</span>\n  <span>return</span> serverAddr<span>;</span>\n <span>}</span>\n \n <span>public</span> <span>static</span> <span>String</span> <span>getLocalAddress</span><span>(</span><span>String</span> address<span>)</span><span>{</span>\n  <span>String</span><span>[</span><span>]</span> blocks <span>=</span> address<span>.</span><span>split</span><span>(</span><span>\"[:]\"</span><span>)</span><span>;</span>\n  <span>if</span><span>(</span>blocks<span>.</span>length <span>!=</span> <span>2</span><span>)</span><span>{</span>\n   <span>throw</span> <span>new</span> <span>IllegalArgumentException</span><span>(</span>address <span>+</span> <span>\" is invalid address\"</span><span>)</span><span>;</span>\n  <span>}</span> \n  <span>String</span> host <span>=</span> blocks<span>[</span><span>0</span><span>]</span><span>;</span>\n  <span>int</span> port <span>=</span> <span>Integer</span><span>.</span><span>valueOf</span><span>(</span>blocks<span>[</span><span>1</span><span>]</span><span>)</span><span>;</span>\n  \n  <span>if</span><span>(</span><span>\"0.0.0.0\"</span><span>.</span><span>equals</span><span>(</span>host<span>)</span><span>)</span><span>{</span>\n   <span>return</span> <span>String</span><span>.</span><span>format</span><span>(</span><span>\"%s:%d\"</span><span>,</span><span>NetUtil</span><span>.</span><span>getLocalIp</span><span>(</span><span>)</span><span>,</span> port<span>)</span><span>;</span>\n  <span>}</span>\n  <span>return</span> address<span>;</span>\n <span>}</span>\n \n <span>private</span> <span>static</span> <span>int</span> <span>matchedIndex</span><span>(</span><span>String</span> ip<span>,</span> <span>String</span><span>[</span><span>]</span> prefix<span>)</span><span>{</span>\n  <span>for</span><span>(</span><span>int</span> i<span>=</span><span>0</span><span>;</span> i<span>&lt;</span>prefix<span>.</span>length<span>;</span> i<span>++</span><span>)</span><span>{</span>\n   <span>String</span> p <span>=</span> prefix<span>[</span>i<span>]</span><span>;</span>\n   <span>if</span><span>(</span><span>\"*\"</span><span>.</span><span>equals</span><span>(</span>p<span>)</span><span>)</span><span>{</span> <span>//*, assumed to be IP</span>\n    <span>if</span><span>(</span>ip<span>.</span><span>startsWith</span><span>(</span><span>\"127.\"</span><span>)</span> <span>||</span>\n       ip<span>.</span><span>startsWith</span><span>(</span><span>\"10.\"</span><span>)</span> <span>||</span> \n       ip<span>.</span><span>startsWith</span><span>(</span><span>\"172.\"</span><span>)</span> <span>||</span>\n       ip<span>.</span><span>startsWith</span><span>(</span><span>\"192.\"</span><span>)</span><span>)</span><span>{</span>\n     <span>continue</span><span>;</span>\n    <span>}</span>\n    <span>return</span> i<span>;</span>\n   <span>}</span> <span>else</span> <span>{</span>\n    <span>if</span><span>(</span>ip<span>.</span><span>startsWith</span><span>(</span>p<span>)</span><span>)</span><span>{</span>\n     <span>return</span> i<span>;</span>\n    <span>}</span>\n   <span>}</span> \n  <span>}</span>\n  \n  <span>return</span> <span>-</span><span>1</span><span>;</span>\n <span>}</span>\n \n <span>public</span> <span>static</span> <span>String</span> <span>getLocalIp</span><span>(</span><span>String</span> ipPreference<span>)</span> <span>{</span>\n  <span>if</span><span>(</span>ipPreference <span>==</span> <span>null</span><span>)</span><span>{</span>\n   ipPreference <span>=</span> <span>\"*>10>172>192>127\"</span><span>;</span>\n  <span>}</span>\n  <span>String</span><span>[</span><span>]</span> prefix <span>=</span> ipPreference<span>.</span><span>split</span><span>(</span><span>\"[> ]+\"</span><span>)</span><span>;</span>\n  <span>try</span> <span>{</span>\n   <span>Pattern</span> pattern <span>=</span> <span>Pattern</span><span>.</span><span>compile</span><span>(</span><span>\"[0-9]+\\\\.[0-9]+\\\\.[0-9]+\\\\.[0-9]+\"</span><span>)</span><span>;</span>\n   <span>Enumeration</span><span><span>&lt;</span><span>NetworkInterface</span><span>></span></span> interfaces <span>=</span> <span>NetworkInterface</span><span>.</span><span>getNetworkInterfaces</span><span>(</span><span>)</span><span>;</span>\n   <span>String</span> matchedIp <span>=</span> <span>null</span><span>;</span>\n   <span>int</span> matchedIdx <span>=</span> <span>-</span><span>1</span><span>;</span>\n   <span>while</span> <span>(</span>interfaces<span>.</span><span>hasMoreElements</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n    <span>NetworkInterface</span> ni <span>=</span> interfaces<span>.</span><span>nextElement</span><span>(</span><span>)</span><span>;</span>\n    <span>Enumeration</span><span><span>&lt;</span><span>InetAddress</span><span>></span></span> en <span>=</span> ni<span>.</span><span>getInetAddresses</span><span>(</span><span>)</span><span>;</span> \n    <span>while</span> <span>(</span>en<span>.</span><span>hasMoreElements</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n     <span>InetAddress</span> addr <span>=</span> en<span>.</span><span>nextElement</span><span>(</span><span>)</span><span>;</span>\n     <span>String</span> ip <span>=</span> addr<span>.</span><span>getHostAddress</span><span>(</span><span>)</span><span>;</span>  \n     <span>Matcher</span> matcher <span>=</span> pattern<span>.</span><span>matcher</span><span>(</span>ip<span>)</span><span>;</span>\n     <span>if</span> <span>(</span>matcher<span>.</span><span>matches</span><span>(</span><span>)</span><span>)</span> <span>{</span>  \n      <span>int</span> idx <span>=</span> <span>matchedIndex</span><span>(</span>ip<span>,</span> prefix<span>)</span><span>;</span>\n      <span>if</span><span>(</span>idx <span>==</span> <span>-</span><span>1</span><span>)</span> <span>continue</span><span>;</span>\n      <span>if</span><span>(</span>matchedIdx <span>==</span> <span>-</span><span>1</span><span>)</span><span>{</span>\n       matchedIdx <span>=</span> idx<span>;</span>\n       matchedIp <span>=</span> ip<span>;</span>\n      <span>}</span> <span>else</span> <span>{</span>\n       <span>if</span><span>(</span>matchedIdx<span>></span>idx<span>)</span><span>{</span>\n        matchedIdx <span>=</span> idx<span>;</span>\n        matchedIp <span>=</span> ip<span>;</span>\n       <span>}</span>\n      <span>}</span>\n     <span>}</span> \n    <span>}</span> \n   <span>}</span> \n   <span>if</span><span>(</span>matchedIp <span>!=</span> <span>null</span><span>)</span> <span>return</span> matchedIp<span>;</span>\n   <span>return</span> <span>\"127.0.0.1\"</span><span>;</span>\n  <span>}</span> <span>catch</span> <span>(</span><span>Exception</span> e<span>)</span> <span>{</span> \n   <span>return</span> <span>\"127.0.0.1\"</span><span>;</span>\n  <span>}</span>\n <span>}</span>\n \n <span>public</span> <span>static</span> <span>String</span> <span>getLocalIp</span><span>(</span><span>)</span> <span>{</span>\n  <span>return</span> <span>getLocalIp</span><span>(</span><span>\"*>10>172>192>127\"</span><span>)</span><span>;</span>\n <span>}</span>\n \n <span>public</span> <span>static</span> <span>String</span> <span>remoteAddress</span><span>(</span><span>SocketChannel</span> channel<span>)</span><span>{</span>\n  <span>SocketAddress</span> addr <span>=</span> channel<span>.</span><span>socket</span><span>(</span><span>)</span><span>.</span><span>getRemoteSocketAddress</span><span>(</span><span>)</span><span>;</span>\n  <span>String</span> res <span>=</span> <span>String</span><span>.</span><span>format</span><span>(</span><span>\"%s\"</span><span>,</span> addr<span>)</span><span>;</span>\n  <span>return</span> res<span>;</span>\n <span>}</span>\n \n <span>public</span> <span>static</span> <span>String</span> <span>localAddress</span><span>(</span><span>SocketChannel</span> channel<span>)</span><span>{</span>\n  <span>SocketAddress</span> addr <span>=</span> channel<span>.</span><span>socket</span><span>(</span><span>)</span><span>.</span><span>getLocalSocketAddress</span><span>(</span><span>)</span><span>;</span>\n  <span>String</span> res <span>=</span> <span>String</span><span>.</span><span>format</span><span>(</span><span>\"%s\"</span><span>,</span> addr<span>)</span><span>;</span>\n  <span>return</span> addr<span>==</span><span>null</span><span>?</span> res<span>:</span> res<span>.</span><span>substring</span><span>(</span><span>1</span><span>)</span><span>;</span>\n <span>}</span>\n \n <span>public</span> <span>static</span> <span>String</span> <span>getPid</span><span>(</span><span>)</span><span>{</span>\n  <span>RuntimeMXBean</span> runtime <span>=</span> <span>ManagementFactory</span><span>.</span><span>getRuntimeMXBean</span><span>(</span><span>)</span><span>;</span>\n        <span>String</span> name <span>=</span> runtime<span>.</span><span>getName</span><span>(</span><span>)</span><span>;</span>\n        <span>int</span> index <span>=</span> name<span>.</span><span>indexOf</span><span>(</span><span>\"@\"</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span>index <span>!=</span> <span>-</span><span>1</span><span>)</span> <span>{</span>\n            <span>return</span> name<span>.</span><span>substring</span><span>(</span><span>0</span><span>,</span> index<span>)</span><span>;</span>\n        <span>}</span>\n  <span>return</span> <span>null</span><span>;</span>\n <span>}</span>\n \n <span>public</span> <span>static</span> <span>String</span> <span>getLocalHostName</span><span>(</span><span>)</span> <span>{</span>\n        <span>try</span> <span>{</span>\n            <span>return</span> <span>(</span><span>InetAddress</span><span>.</span><span>getLocalHost</span><span>(</span><span>)</span><span>)</span><span>.</span><span>getHostName</span><span>(</span><span>)</span><span>;</span>\n        <span>}</span> <span>catch</span> <span>(</span><span>UnknownHostException</span> uhe<span>)</span> <span>{</span>\n            <span>String</span> host <span>=</span> uhe<span>.</span><span>getMessage</span><span>(</span><span>)</span><span>;</span>\n            <span>if</span> <span>(</span>host <span>!=</span> <span>null</span><span>)</span> <span>{</span>\n                <span>int</span> colon <span>=</span> host<span>.</span><span>indexOf</span><span>(</span><span>':'</span><span>)</span><span>;</span>\n                <span>if</span> <span>(</span>colon <span>></span> <span>0</span><span>)</span> <span>{</span>\n                    <span>return</span> host<span>.</span><span>substring</span><span>(</span><span>0</span><span>,</span> colon<span>)</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n            <span>return</span> <span>\"UnknownHost\"</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>启动项目，访问<code>/index</code>和<code>/ero</code>接口，可以看到项目中生成了<code>app-collector.log</code>和<code>error-collector.log</code>两个日志文件</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220713182234947.png\" alt=\"SpringBoot+Kafka+ELK\"></p>\n<p>我们将Springboot服务部署在192.168.11.31这台机器上。</p>\n<h3 id=\"kafka安装和启用\" tabindex=\"-1\"> Kafka安装和启用</h3>\n<p>kafka下载地址：</p>\n<blockquote>\n<p><a href=\"http://kafka.apache.org/downloads.html\" target=\"_blank\" rel=\"noopener noreferrer\">http://kafka.apache.org/downloads.html</a></p>\n</blockquote>\n<p>kafka安装步骤：首先kafka安装需要依赖与zookeeper，所以小伙伴们先准备好zookeeper环境（三个节点即可），然后我们来一起构建kafka broker。</p>\n<div><pre><code><span>## 解压命令：</span>\n<span>tar</span> -zxvf kafka_2.12-2.1.0.tgz -C /usr/local/\n<span>## 改名命令：</span>\n<span>mv</span> kafka_2.12-2.1.0/ kafka_2.12\n<span>## 进入解压后的目录，修改server.properties文件：</span>\n<span>vim</span> /usr/local/kafka_2.12/config/server.properties\n<span>## 修改配置：</span>\nbroker.id<span>=</span><span>0</span>\n<span>port</span><span>=</span><span>9092</span>\nhost.name<span>=</span><span>192.168</span>.11.51\nadvertised.host.name<span>=</span><span>192.168</span>.11.51\nlog.dirs<span>=</span>/usr/local/kafka_2.12/kafka-logs\nnum.partitions<span>=</span><span>2</span>\nzookeeper.connect<span>=</span><span>192.168</span>.11.111:2181,192.168.11.112:2181,192.168.11.113:2181\n\n<span>## 建立日志文件夹：</span>\n<span>mkdir</span> /usr/local/kafka_2.12/kafka-logs\n\n<span>##启动kafka：</span>\n/usr/local/kafka_2.12/bin/kafka-server-start.sh /usr/local/kafka_2.12/config/server.properties <span>&amp;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>创建两个topic</p>\n<div><pre><code><span>## 创建topic</span>\nkafka-topics.sh --zookeeper <span>192.168</span>.11.111:2181 --create --topic app-log-collector --partitions <span>1</span>  --replication-factor <span>1</span>\nkafka-topics.sh --zookeeper <span>192.168</span>.11.111:2181 --create --topic error-log-collector --partitions <span>1</span>  --replication-factor <span>1</span> \n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>我们可以查看一下topic情况</p>\n<div><pre><code>kafka-topics.sh --zookeeper <span>192.168</span>.11.111:2181 --topic app-log-test --describe\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>可以看到已经成功启用了<code>app-log-collector</code>和<code>error-log-collector</code>两个topic</p>\n<p><img src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" alt=\"SpringBoot+Kafka+ELK\"></p>\n<h3 id=\"filebeat安装和启用\" tabindex=\"-1\"> filebeat安装和启用</h3>\n<p><strong>filebeat下载</strong></p>\n<div><pre><code><span>cd</span> /usr/local/software\n<span>tar</span> -zxvf filebeat-6.6.0-linux-x86_64.tar.gz -C /usr/local/\n<span>cd</span> /usr/local\n<span>mv</span> filebeat-6.6.0-linux-x86_64/ filebeat-6.6.0\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>配置filebeat，可以参考下方yml配置文件</p>\n<div><pre><code>vim /usr/local/filebeat<span>-</span>5.6.2/filebeat.yml\n<span>###################### Filebeat Configuration Example #########################</span>\n<span>filebeat.prospectors</span><span>:</span>\n\n<span>-</span> <span>input_type</span><span>:</span> log\n\n  <span>paths</span><span>:</span>\n    <span>## app-服务名称.log, 为什么写死，防止发生轮转抓取历史数据</span>\n    <span>-</span> /usr/local/logs/app<span>-</span>collector.log\n  <span>#定义写入 ES 时的 _type 值</span>\n  <span>document_type</span><span>:</span> <span>\"app-log\"</span>\n  <span>multiline</span><span>:</span>\n    <span>#pattern: '^\\s*(\\d{4}|\\d{2})\\-(\\d{2}|[a-zA-Z]{3})\\-(\\d{2}|\\d{4})'   # 指定匹配的表达式（匹配以 2017-11-15 08:04:23:889 时间格式开头的字符串）</span>\n    <span>pattern</span><span>:</span> <span>'^\\['</span>                              <span># 指定匹配的表达式（匹配以 \"{ 开头的字符串）</span>\n    <span>negate</span><span>:</span> <span>true</span>                                <span># 是否匹配到</span>\n    <span>match</span><span>:</span> after                                <span># 合并到上一行的末尾</span>\n    <span>max_lines</span><span>:</span> <span>2000</span>                             <span># 最大的行数</span>\n    <span>timeout</span><span>:</span> 2s                                 <span># 如果在规定时间没有新的日志事件就不等待后面的日志</span>\n  <span>fields</span><span>:</span>\n    <span>logbiz</span><span>:</span> collector\n    <span>logtopic</span><span>:</span> app<span>-</span>log<span>-</span>collector   <span>## 按服务划分用作kafka topic</span>\n    <span>evn</span><span>:</span> dev\n\n<span>-</span> <span>input_type</span><span>:</span> log\n\n  <span>paths</span><span>:</span>\n    <span>-</span> /usr/local/logs/error<span>-</span>collector.log\n  <span>document_type</span><span>:</span> <span>\"error-log\"</span>\n  <span>multiline</span><span>:</span>\n    <span>#pattern: '^\\s*(\\d{4}|\\d{2})\\-(\\d{2}|[a-zA-Z]{3})\\-(\\d{2}|\\d{4})'   # 指定匹配的表达式（匹配以 2017-11-15 08:04:23:889 时间格式开头的字符串）</span>\n    <span>pattern</span><span>:</span> <span>'^\\['</span>                              <span># 指定匹配的表达式（匹配以 \"{ 开头的字符串）</span>\n    <span>negate</span><span>:</span> <span>true</span>                                <span># 是否匹配到</span>\n    <span>match</span><span>:</span> after                                <span># 合并到上一行的末尾</span>\n    <span>max_lines</span><span>:</span> <span>2000</span>                             <span># 最大的行数</span>\n    <span>timeout</span><span>:</span> 2s                                 <span># 如果在规定时间没有新的日志事件就不等待后面的日志</span>\n  <span>fields</span><span>:</span>\n    <span>logbiz</span><span>:</span> collector\n    <span>logtopic</span><span>:</span> error<span>-</span>log<span>-</span>collector   <span>## 按服务划分用作kafka topic</span>\n    <span>evn</span><span>:</span> dev\n    \n<span>output.kafka</span><span>:</span>\n  <span>enabled</span><span>:</span> <span>true</span>\n  <span>hosts</span><span>:</span> <span>[</span><span>\"192.168.11.51:9092\"</span><span>]</span>\n  <span>topic</span><span>:</span> <span>'%{[fields.logtopic]}'</span>\n  <span>partition.hash</span><span>:</span>\n    <span>reachable_only</span><span>:</span> <span>true</span>\n  <span>compression</span><span>:</span> gzip\n  <span>max_message_bytes</span><span>:</span> <span>1000000</span>\n  <span>required_acks</span><span>:</span> <span>1</span>\n<span>logging.to_files</span><span>:</span> <span>true</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>filebeat启动：</strong></p>\n<p>检查配置是否正确</p>\n<div><pre><code><span>cd</span> /usr/local/filebeat-6.6.0\n./filebeat -c filebeat.yml -configtest\n<span>## Config OK</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>启动filebeat</p>\n<div><pre><code>/usr/local/filebeat-6.6.0/filebeat <span>&amp;</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>检查是否启动成功</p>\n<div><pre><code><span>ps</span> -ef <span>|</span> <span>grep</span> filebeat\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>可以看到filebeat已经启动成功</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220713182332234.png\" alt=\"SpringBoot+Kafka+ELK\"></p>\n<p>然后我们访问192.168.11.31:8001/index和192.168.11.31:8001/err，再查看kafka的logs文件，可以看到已经生成了app-log-collector-0和error-log-collector-0文件，说明filebeat已经帮我们把数据收集好放到了kafka上。</p>\n<h3 id=\"logstash安装\" tabindex=\"-1\"> logstash安装</h3>\n<p>我们在logstash的安装目录下新建一个文件夹</p>\n<div><pre><code><span>mkdir</span> scrpit\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>然后cd进该文件，创建一个<code>logstash-script.conf</code>文件</p>\n<div><pre><code><span>cd</span> <span>scrpit</span>\n<span>vim</span> <span>logstash-script.conf</span>\n<span>## multiline 插件也可以用于其他类似的堆栈式信息，比如 linux 的内核日志。</span>\n<span>input</span> <span>{</span>\n<span>  kafka</span> <span>{</span>\n<span>    ## app-log-服务名称</span>\n<span>    topics_pattern</span> <span>=</span><span>> \"app-log-.*\"</span>\n<span>    bootstrap_servers</span> <span>=</span><span>> \"192.168.11.51:9092\"</span>\n<span> codec</span> <span>=</span><span>> json</span>\n<span> consumer_threads</span> <span>=</span><span>> 1 ## 增加consumer的并行消费线程数</span>\n<span> decorate_events</span> <span>=</span><span>> true</span>\n<span>    #auto_offset_rest => \"latest\"</span>\n<span> group_id</span> <span>=</span><span>> \"app-log-group\"</span>\n   }\n   \n<span>   kafka</span> <span>{</span>\n<span>    ## error-log-服务名称</span>\n<span>    topics_pattern</span> <span>=</span><span>> \"error-log-.*\"</span>\n<span>    bootstrap_servers</span> <span>=</span><span>> \"192.168.11.51:9092\"</span>\n<span> codec</span> <span>=</span><span>> json</span>\n<span> consumer_threads</span> <span>=</span><span>> 1</span>\n<span> decorate_events</span> <span>=</span><span>> true</span>\n<span>    #auto_offset_rest => \"latest\"</span>\n<span> group_id</span> <span>=</span><span>> \"error-log-group\"</span>\n   }\n   \n}\n\n<span>filter</span> <span>{</span>\n  \n<span>  ## 时区转换</span>\n<span>  ruby</span> <span>{</span>\n<span> code</span> <span>=</span><span>> \"event.set('index_time',event.timestamp.time.localtime.strftime('%Y.%m.%d'))\"</span>\n  }\n\n<span>  if</span> <span>\"app-log\" in [fields][logtopic]{</span>\n<span>    grok</span> <span>{</span>\n<span>        ## 表达式,这里对应的是Springboot输出的日志格式</span>\n<span>        match</span> <span>=</span><span>> [\"message\", \"\\[%{NOTSPACE:currentDateTime}\\] \\[%{NOTSPACE:level}\\] \\[%{NOTSPACE:thread-id}\\] \\[%{NOTSPACE:class}\\] \\[%{DATA:hostName}\\] \\[%{DATA:ip}\\] \\[%{DATA:applicationName}\\] \\[%{DATA:location}\\] \\[%{DATA:messageInfo}\\] ## (\\'\\'|%{QUOTEDSTRING:throwable})\"]</span>\n    }\n  }\n\n<span>  if</span> <span>\"error-log\" in [fields][logtopic]{</span>\n<span>    grok</span> <span>{</span>\n<span>        ## 表达式</span>\n<span>        match</span> <span>=</span><span>> [\"message\", \"\\[%{NOTSPACE:currentDateTime}\\] \\[%{NOTSPACE:level}\\] \\[%{NOTSPACE:thread-id}\\] \\[%{NOTSPACE:class}\\] \\[%{DATA:hostName}\\] \\[%{DATA:ip}\\] \\[%{DATA:applicationName}\\] \\[%{DATA:location}\\] \\[%{DATA:messageInfo}\\] ## (\\'\\'|%{QUOTEDSTRING:throwable})\"]</span>\n    }\n  }\n  \n}\n\n<span>## 测试输出到控制台：</span>\n<span>output</span> <span>{</span>\n<span>  stdout</span> <span>{ codec => rubydebug }</span>\n}\n\n\n<span>## elasticsearch：</span>\n<span>output</span> <span>{</span>\n\n<span>  if</span> <span>\"app-log\" in [fields][logtopic]{</span>\n<span> ## es插件</span>\n<span> elasticsearch</span> <span>{</span>\n<span>       # es服务地址</span>\n<span>        hosts</span> <span>=</span><span>> [\"192.168.11.35:9200\"]</span>\n<span>        # 用户名密码      </span>\n<span>        user</span> <span>=</span><span>> \"elastic\"</span>\n<span>        password</span> <span>=</span><span>> \"123456\"</span>\n<span>        ## 索引名，+ 号开头的，就会自动认为后面是时间格式：</span>\n<span>        ## javalog-app-service-2019.01.23 </span>\n<span>        index</span> <span>=</span><span>> \"app-log-%{[fields][logbiz]}-%{index_time}\"</span>\n<span>        # 是否嗅探集群ip：一般设置true；http://192.168.11.35:9200/_nodes/http?pretty</span>\n<span>        # 通过嗅探机制进行es集群负载均衡发日志消息</span>\n<span>        sniffing</span> <span>=</span><span>> true</span>\n<span>        # logstash默认自带一个mapping模板，进行模板覆盖</span>\n<span>        template_overwrite</span> <span>=</span><span>> true</span>\n<span>    }</span> \n  }\n  \n<span>  if</span> <span>\"error-log\" in [fields][logtopic]{</span>\n<span> elasticsearch</span> <span>{</span>\n<span>        hosts</span> <span>=</span><span>> [\"192.168.11.35:9200\"]    </span>\n<span>        user</span> <span>=</span><span>> \"elastic\"</span>\n<span>        password</span> <span>=</span><span>> \"123456\"</span>\n<span>        index</span> <span>=</span><span>> \"error-log-%{[fields][logbiz]}-%{index_time}\"</span>\n<span>        sniffing</span> <span>=</span><span>> true</span>\n<span>        template_overwrite</span> <span>=</span><span>> true</span>\n<span>    }</span> \n  }\n  \n\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>启动logstash</p>\n<div><pre><code>/usr/local/logstash-6.6.0/bin/logstash -f /usr/local/logstash-6.6.0/script/logstash-script.conf <span>&amp;</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>等待启动成功，我们再次访问<code>192.168.11.31:8001/err</code></p>\n<p>可以看到控制台开始打印日志</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16577076343402.png\" alt=\"SpringBoot+Kafka+ELK\"></p>\n<h3 id=\"elasticsearch与kibana\" tabindex=\"-1\"> ElasticSearch与Kibana</h3>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16577076343403.png\" alt=\"SpringBoot+Kafka+ELK\"></p>\n<p>ES和Kibana的搭建之前没写过博客，网上资料也比较多，大家可以自行搜索。</p>\n<p>搭建完成后，访问Kibana的管理页面<code>192.168.11.35:5601</code>，选择Management -&gt; Kinaba - Index Patterns</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16577076343404.png\" alt=\"SpringBoot+Kafka+ELK\"></p>\n<p>然后Create index pattern</p>\n<ul>\n<li>index pattern 输入 <code>app-log-*</code></li>\n<li>Time Filter field name 选择 currentDateTime</li>\n</ul>\n<p>这样我们就成功创建了索引。</p>\n<p>我们再次访问<code>192.168.11.31:8001/err</code>，这个时候就可以看到我们已经命中了一条log信息</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16577076343405.png\" alt=\"SpringBoot+Kafka+ELK\"></p>\n<p>里面展示了日志的全量信息</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16577076343406.png\" alt=\"SpringBoot+Kafka+ELK\"></p>\n<p>到这里，我们完整的日志收集及可视化就搭建完成了！</p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16577076343400.png",
      "date_published": "2022-08-05T00:00:00.000Z",
      "date_modified": "2022-07-13T10:48:15.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "Vue开发报错问题解决",
      "url": "https://blog.ciberviler.top/dev/Vue%E5%BC%80%E5%8F%91%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3.html",
      "id": "https://blog.ciberviler.top/dev/Vue%E5%BC%80%E5%8F%91%E6%8A%A5%E9%94%99%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3.html",
      "content_html": "<h1 id=\"vue开发报错问题解决\" tabindex=\"-1\"> Vue开发报错问题解决</h1>\n<h2 id=\"_2-同组件新增修改出现数据查询是上一次\" tabindex=\"-1\"> 2.同组件新增修改出现数据查询是上一次</h2>\n<blockquote>\n<p>2022年7月5日09:22:16</p>\n</blockquote>\n<p>关闭组件时清空数据，新增时最好也清空,methods方法中可以添加该方法，下半部分IDE插件可能会报错，但不影响使用，也可以使用上半部分，但是效果不好。如果tab中有列表，有列表的那项可以设置lazy为true，方法中不清空数据。</p>\n<div><pre><code><span>clearData</span><span>(</span><span>)</span><span>{</span>\n    <span>// this.$refs.basic.dataForm={};</span>\n    <span>// this.$refs.idsgmt.dataForm={};</span>\n    <span>// this.$refs.fcsinfsgmt.dataForm={};</span>\n    <span>// //this.$refs.mnmmbinfsgmt.dataForm={};</span>\n    <span>// this.$refs.regcap.dataForm={};</span>\n    <span>// this.$refs.sharhodinf.dataForm={};</span>\n    <span>// this.$refs.actucotrlinfsg.dataForm={};</span>\n    <span>// this.$refs.spvsgathrtyinfsgmt.dataForm={};</span>\n    <span>// // this.$refs.cotainfsgmt.dataForm={};</span>\n    <span>// this.$refs.enctfitginf.dataForm={};</span>\n    <span>// // this.$refs.enicdnrltpinf.dataForm={};</span>\n    <span>this</span><span>.</span>dataForm<span>.</span>id<span>=</span><span>''</span><span>;</span>\n    <span>this</span><span>.</span>dataForm<span>.</span>custId<span>=</span><span>''</span><span>;</span>\n    <span>this</span><span>.</span>dataForm<span>.</span>bssgmt<span>=</span><span>{</span><span>}</span><span>;</span>\n    <span>this</span><span>.</span>dataForm<span>.</span>idsgmt<span>=</span><span>{</span><span>}</span><span>;</span>\n    <span>this</span><span>.</span>dataForm<span>.</span>fcsinfsgmt<span>=</span><span>{</span><span>}</span><span>;</span>\n    <span>this</span><span>.</span>dataForm<span>.</span>regCap<span>=</span><span>{</span><span>}</span><span>;</span>\n    <span>//this.dataForm.mnmmbinfsgmt={};</span>\n    <span>this</span><span>.</span>dataForm<span>.</span>sharhodInf<span>=</span><span>{</span><span>}</span><span>;</span>\n    <span>this</span><span>.</span>dataForm<span>.</span>actucotrlinfsg<span>=</span><span>{</span><span>}</span><span>;</span>\n    <span>this</span><span>.</span>dataForm<span>.</span>spvsgathrtyinfsgmt<span>=</span><span>{</span><span>}</span><span>;</span>\n    <span>//this.dataForm.cotainfsgmt={};</span>\n    <span>this</span><span>.</span>dataForm<span>.</span>enctfitginf<span>=</span><span>{</span><span>}</span><span>;</span>\n    <span>//this.dataForm.enicdnrltpinf={};</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_1-tab中表单也有列表-列表显示和查询问题\" tabindex=\"-1\"> 1.tab中表单也有列表，列表显示和查询问题</h2>\n<blockquote>\n<p>2022年7月4日14:41:48</p>\n</blockquote>\n<p><code>el-tab-pane</code>设置<code>lazy=&quot;true&quot;</code>,否则页面在数据加载完之前渲染完毕就无法查询该id的数据，也不需要新增时置空<code>this.$refs.basic.dataForm={};</code></p>\n<div><pre><code><span><span><span>&lt;</span>el-dialog</span> <span>v-model</span><span><span>=</span><span>\"</span>visible<span>\"</span></span> <span>v-if</span><span><span>=</span><span>\"</span>visible<span>\"</span></span> <span>:visible.sync</span><span><span>=</span><span>\"</span>visible<span>\"</span></span> <span>destroy-on-close</span> <span>@closed</span><span><span>=</span><span>\"</span>onClosed<span>\"</span></span> <span>:title</span><span><span>=</span><span>\"</span>!addDisable?$t(<span>'</span>add<span>'</span>):$t(<span>'</span>update<span>'</span>)<span>\"</span></span> <span>:close-on-click-modal</span><span><span>=</span><span>\"</span>false<span>\"</span></span> <span>:close-on-press-escape</span><span><span>=</span><span>\"</span>true<span>\"</span></span> <span>:fullscreen</span><span><span>=</span><span>\"</span>true<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>el-tabs</span> <span>v-model</span><span><span>=</span><span>\"</span>activeName<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>border-card<span>\"</span></span> <span>tab-position</span><span><span>=</span><span>\"</span>left<span>\"</span></span><span>></span></span>\n      <span><span><span>&lt;</span>el-tab-pane</span> <span>label</span><span><span>=</span><span>\"</span>基本信息<span>\"</span></span> <span>name</span><span><span>=</span><span>\"</span>one<span>\"</span></span> <span>:lazy</span><span><span>=</span><span>\"</span>false<span>\"</span></span><span>></span></span>\n        <span><span><span>&lt;</span>basic</span> <span>:dataForm</span><span><span>=</span><span>\"</span>dataForm<span>\"</span></span> <span>ref</span><span><span>=</span><span>\"</span>basic<span>\"</span></span><span>/></span></span>\n      <span><span><span>&lt;/</span>el-tab-pane</span><span>></span></span>\n      <span><span><span>&lt;</span>el-tab-pane</span> <span>label</span><span><span>=</span><span>\"</span>其它<span>\"</span></span> <span>name</span><span><span>=</span><span>\"</span>two<span>\"</span></span> <span>:lazy</span><span><span>=</span><span>\"</span>true<span>\"</span></span><span>></span></span>\n        <span><span><span>&lt;</span>eibcidsgmt</span> <span>:dataForm</span><span><span>=</span><span>\"</span>{id:dataForm.id}<span>\"</span></span> <span>ref</span><span><span>=</span><span>\"</span>eibcidsgmt<span>\"</span></span><span>/></span></span>\n      <span><span><span>&lt;/</span>el-tab-pane</span><span>></span></span>\n    <span><span><span>&lt;/</span>el-tabs</span><span>></span></span>\n<span><span><span>&lt;/</span>el-dialog</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>如果列表页面需要查询指定id，在新增时不显示可以设置列表组件创建时：</p>\n<div><pre><code><span>created</span><span>(</span><span>)</span><span>{</span>\n    <span>if</span><span>(</span><span>this</span><span>.</span>dataForm<span>.</span>custId<span>==</span><span>''</span><span>)</span><span>{</span>\n      <span>this</span><span>.</span>dataForm<span>.</span>custId<span>=</span><span>'-'</span>\n    <span>}</span>\n  <span>}</span><span>,</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div>",
      "date_published": "2022-07-17T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "Vue3+TS 快速上手",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/",
      "summary": "Vue3+TS 快速上手",
      "content_html": "<p align=\"center\"> \n  <img src=\"https://metrics.lecoq.io/xlc520?template=classic&isocalendar=1&languages=1&people=1&activity=1&achievements=1&lines=1&repositories=1&notable=1&introduction=1&pagespeed=1&repositories=100&repositories.batch=100&repositories.forks=false&repositories.affiliations=owner&isocalendar.duration=full-year&languages.limit=8&languages.threshold=0%&languages.colors=github&languages.sections=most-used&languages.indepth=false&languages.analysis.timeout=15&languages.categories=markup%2C programming&languages.recent.categories=markup%2C programming&languages.recent.load=300&languages.recent.days=14&people.limit=24&people.identicons=false&people.identicons.hide=false&people.size=28&people.types=followers%2C following&people.shuffle=false&activity.limit=5&activity.load=300&activity.days=14&activity.visibility=all&activity.timestamps=false&activity.filter=all&achievements.threshold=C&achievements.secrets=true&achievements.display=detailed&achievements.limit=0&notable.from=organization&notable.repositories=false&notable.indepth=false&notable.types=commit&repositories.featured= xlc520%2Fxlc520.github.io&introduction.title=true&pagespeed.url=xlc520.github.io&pagespeed.detailed=false&pagespeed.screenshot=false&config.timezone=Asia%2FShanghai\" /> \n</p>\n<p align=\"center\"> \n  您是第  <img src=\"https://profile-counter.glitch.me/xlc520/count.svg\" />  位访问者\n</p>",
      "date_published": "2022-07-17T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "初识 TypeScript",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter1/01_%E5%88%9D%E8%AF%86TS.html",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter1/01_%E5%88%9D%E8%AF%86TS.html",
      "content_html": "<h1 id=\"_1-初识-typescript\" tabindex=\"-1\"> 1. 初识 TypeScript</h1>\n<p><img src=\"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/28ca61cc160c417c8497a00defdca5f0~tplv-k3u1fbpfcp-watermark.image\" alt=\"TS与JS.png\"></p>\n<h2 id=\"typescript-的介绍\" tabindex=\"-1\"> TypeScript 的介绍</h2>\n<p>TypeScript是一种由微软开发的开源、跨平台的编程语言。它是JavaScript的超集，最终会被编译为JavaScript代码。</p>\n<p>2012年10月，微软发布了首个公开版本的TypeScript，2013年6月19日，在经历了一个预览版之后微软正式发布了正式版TypeScript</p>\n<p>TypeScript的作者是安德斯·海尔斯伯格，C#的首席架构师。它是开源和跨平台的编程语言。</p>\n<p>TypeScript扩展了JavaScript的语法，所以任何现有的JavaScript程序可以运行在TypeScript环境中。</p>\n<p>TypeScript是为大型应用的开发而设计，并且可以编译为JavaScript。</p>\n<p>TypeScript 是 JavaScript 的一个超集，主要提供了类型系统和对 ES6+ 的支持**，它由 Microsoft 开发，代码开源于 GitHub 上</p>\n<p><strong>TypeScript 是 JavaScript 的一个超集</strong>，主要提供了<strong>类型系统</strong>和<strong>对 ES6+ 的支持</strong>，它由 Microsoft 开发，代码<a href=\"https://github.com/Microsoft/TypeScript\" target=\"_blank\" rel=\"noopener noreferrer\">开源于 GitHub</a> 上</p>\n<h2 id=\"typescript-的特点\" tabindex=\"-1\"> TypeScript 的特点</h2>\n<p>TypeScript 主要有 3 大特点：</p>\n<ul>\n<li><strong>始于JavaScript，归于JavaScript</strong></li>\n</ul>\n<p>TypeScript 可以编译出纯净、 简洁的 JavaScript 代码，并且可以运行在任何浏览器上、Node.js 环境中和任何支持 ECMAScript 3（或更高版本）的JavaScript 引擎中。</p>\n<ul>\n<li><strong>强大的类型系统</strong></li>\n</ul>\n<p><strong>类型系统</strong>允许 JavaScript 开发者在开发 JavaScript 应用程序时使用高效的开发工具和常用操作比如静态检查和代码重构。</p>\n<ul>\n<li><strong>先进的 JavaScript</strong></li>\n</ul>\n<p>TypeScript 提供最新的和不断发展的 JavaScript 特性，包括那些来自 2015 年的 ECMAScript 和未来的提案中的特性，比如异步功能和 Decorators，以帮助建立健壮的组件。</p>\n<h2 id=\"总结\" tabindex=\"-1\"> 总结</h2>\n<p>TypeScript 在社区的流行度越来越高，它非常适用于一些大型项目，也非常适用于一些基础库，极大地帮助我们提升了开发效率和体验。</p>\n",
      "image": "https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/28ca61cc160c417c8497a00defdca5f0~tplv-k3u1fbpfcp-watermark.image",
      "date_published": "2022-07-18T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "安装 TypeScript",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter1/02_%E5%AE%89%E8%A3%85TS.html",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter1/02_%E5%AE%89%E8%A3%85TS.html",
      "content_html": "<h1 id=\"_2-安装-typescript\" tabindex=\"-1\"> 2. 安装 TypeScript</h1>\n<p>命令行运行如下命令，全局安装 TypeScript：</p>\n<div><pre><code><span>npm</span> <span>install</span> -g typescript\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>安装完成后，在控制台运行如下命令，检查安装是否成功(3.x)：</p>\n<div><pre><code>tsc -V \n</code></pre><div aria-hidden=\"true\"><div></div></div></div>",
      "date_published": "2022-07-19T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "第一个 TypeScript 程序",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter1/03_HelloWorld.html",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter1/03_HelloWorld.html",
      "content_html": "<h1 id=\"_3-第一个-typescript-程序\" tabindex=\"-1\"> 3. 第一个 TypeScript 程序</h1>\n<h2 id=\"编写-ts-程序\" tabindex=\"-1\"> 编写 TS 程序</h2>\n<p>src/helloworld.ts</p>\n<div><pre><code><span>function</span> <span>greeter</span> <span>(</span>person<span>)</span> <span>{</span>\n  <span>return</span> <span>'Hello, '</span> <span>+</span> person\n<span>}</span>\n\n<span>let</span> user <span>=</span> <span>'Yee'</span>\n\n<span>console</span><span>.</span><span>log</span><span>(</span><span>greeter</span><span>(</span>user<span>)</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"手动编译代码\" tabindex=\"-1\"> 手动编译代码</h2>\n<p>我们使用了 <code>.ts</code> 扩展名，但是这段代码仅仅是 JavaScript 而已。</p>\n<p>在命令行上，运行 TypeScript 编译器：</p>\n<div><pre><code>tsc helloworld.ts\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>输出结果为一个 <code>helloworld.js</code> 文件，它包含了和输入文件中相同的 JavsScript 代码。</p>\n<p>在命令行上，通过 Node.js 运行这段代码：</p>\n<div><pre><code><span>node</span> helloworld.js\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>控制台输出：</p>\n<div><pre><code>Hello, Yee\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h2 id=\"vscode自动编译\" tabindex=\"-1\"> vscode自动编译</h2>\n<pre><code>1). 生成配置文件tsconfig.json\n    tsc --init\n2). 修改tsconfig.json配置\n    &quot;outDir&quot;: &quot;./js&quot;,\n    &quot;strict&quot;: false,    \n3). 启动监视任务: \n    终端 -&gt; 运行任务 -&gt; 监视tsconfig.json\n</code></pre>\n<h2 id=\"类型注解\" tabindex=\"-1\"> 类型注解</h2>\n<p>接下来让我们看看 TypeScript 工具带来的高级功能。 给  <code>person</code> 函数的参数添加 <code>: string</code> 类型注解，如下：</p>\n<div><pre><code><span>function</span> <span>greeter</span> <span>(</span>person<span>:</span> <span>string</span><span>)</span> <span>{</span>\n  <span>return</span> <span>'Hello, '</span> <span>+</span> person\n<span>}</span>\n\n<span>let</span> user <span>=</span> <span>'Yee'</span>\n\n<span>console</span><span>.</span><span>log</span><span>(</span><span>greeter</span><span>(</span>user<span>)</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>TypeScript 里的类型注解是一种轻量级的为函数或变量添加约束的方式。 在这个例子里，我们希望 <code>greeter</code> 函数接收一个字符串参数。 然后尝试把 <code>greeter</code> 的调用改成传入一个数组：</p>\n<div><pre><code><span>function</span> <span>greeter</span> <span>(</span>person<span>:</span> <span>string</span><span>)</span> <span>{</span>\n  <span>return</span> <span>'Hello, '</span> <span>+</span> person\n<span>}</span>\n\n<span>let</span> user <span>=</span> <span>[</span><span>0</span><span>,</span> <span>1</span><span>,</span> <span>2</span><span>]</span>\n\n<span>console</span><span>.</span><span>log</span><span>(</span><span>greeter</span><span>(</span>user<span>)</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>重新编译，你会看到产生了一个错误：</p>\n<div><pre><code>error TS2345: Argument of type 'number[]' is not assignable to parameter of type 'string'.\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>类似地，尝试删除 <code>greeter</code> 调用的所有参数。 TypeScript 会告诉你使用了非期望个数的参数调用了这个函数。 在这两种情况中，TypeScript提供了静态的代码分析，它可以分析代码结构和提供的类型注解。</p>\n<p>要注意的是尽管有错误，<code>greeter.js</code> 文件还是被创建了。 就算你的代码里有错误，你仍然可以使用 TypeScript。但在这种情况下，TypeScript 会警告你代码可能不会按预期执行。</p>\n<h2 id=\"接口\" tabindex=\"-1\"> 接口</h2>\n<p>让我们继续扩展这个示例应用。这里我们使用接口来描述一个拥有 <code>firstName</code> 和 <code>lastName</code> 字段的对象。 在 <code>TypeScript</code> 里，只在两个类型内部的结构兼容，那么这两个类型就是兼容的。 这就允许我们在实现接口时候只要保证包含了接口要求的结构就可以，而不必明确地使用 <code>implements</code> 语句。</p>\n<div><pre><code><span>interface</span> <span>Person</span> <span>{</span>\n  firstName<span>:</span> <span>string</span>\n  lastName<span>:</span> <span>string</span>\n<span>}</span>\n\n<span>function</span> <span>greeter</span> <span>(</span>person<span>:</span> Person<span>)</span> <span>{</span>\n  <span>return</span> <span>'Hello, '</span> <span>+</span> person<span>.</span>firstName <span>+</span> <span>' '</span> <span>+</span> person<span>.</span>lastName\n<span>}</span>\n\n<span>let</span> user <span>=</span> <span>{</span>\n  firstName<span>:</span> <span>'Yee'</span><span>,</span>\n  lastName<span>:</span> <span>'Huang'</span>\n<span>}</span>\n\n<span>console</span><span>.</span><span>log</span><span>(</span><span>greeter</span><span>(</span>user<span>)</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"类\" tabindex=\"-1\"> 类</h2>\n<p>最后，让我们使用类来改写这个例子。 TypeScript 支持 JavaScript 的新特性，比如支持基于类的面向对象编程。</p>\n<p>让我们创建一个 <code>User</code> 类，它带有一个构造函数和一些公共字段。因为类的字段包含了接口所需要的字段，所以他们能很好的兼容。</p>\n<p>还要注意的是，我在类的声明上会注明所有的成员变量，这样比较一目了然。</p>\n<div><pre><code><span>class</span> <span>User</span> <span>{</span>\n  fullName<span>:</span> <span>string</span>\n  firstName<span>:</span> <span>string</span>\n  lastName<span>:</span> <span>string</span>\n\n  <span>constructor</span> <span>(</span>firstName<span>:</span> <span>string</span><span>,</span> lastName<span>:</span> <span>string</span><span>)</span> <span>{</span>\n    <span>this</span><span>.</span>firstName <span>=</span> firstName\n    <span>this</span><span>.</span>lastName <span>=</span> lastName\n    <span>this</span><span>.</span>fullName <span>=</span> firstName <span>+</span> <span>' '</span> <span>+</span> lastName\n  <span>}</span>\n<span>}</span>\n\n<span>interface</span> <span>Person</span> <span>{</span>\n  firstName<span>:</span> <span>string</span>\n  lastName<span>:</span> <span>string</span>\n<span>}</span>\n\n<span>function</span> <span>greeter</span> <span>(</span>person<span>:</span> Person<span>)</span> <span>{</span>\n  <span>return</span> <span>'Hello, '</span> <span>+</span> person<span>.</span>firstName <span>+</span> <span>' '</span> <span>+</span> person<span>.</span>lastName\n<span>}</span>\n\n<span>let</span> user <span>=</span> <span>new</span> <span>User</span><span>(</span><span>'Yee'</span><span>,</span> <span>'Huang'</span><span>)</span>\n\n<span>console</span><span>.</span><span>log</span><span>(</span><span>greeter</span><span>(</span>user<span>)</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>重新运行 <code>tsc greeter.ts</code>，你会看到 TypeScript 里的类只是一个语法糖，本质上还是 <code>JavaScript</code> 函数的实现。</p>\n<h2 id=\"总结\" tabindex=\"-1\"> 总结</h2>\n<p>到这里，你已经对 TypeScript 有了一个大致的印象，那么下一章让我们来一起学习 TypeScript 的一些常用语法吧。</p>\n",
      "date_published": "2022-07-20T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "使用webpack打包TS",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter1/04_webpack%E6%89%93%E5%8C%85.html",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter1/04_webpack%E6%89%93%E5%8C%85.html",
      "content_html": "<h1 id=\"_4-使用webpack打包ts\" tabindex=\"-1\"> 4. 使用webpack打包TS</h1>\n<h2 id=\"下载依赖\" tabindex=\"-1\"> 下载依赖</h2>\n<div><pre><code>yarn add -D typescript\nyarn add -D webpack webpack-cli\nyarn add -D webpack-dev-server\nyarn add -D html-webpack-plugin clean-webpack-plugin\nyarn add -D ts-loader\nyarn add -D cross-env\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"入口js-src-main-ts\" tabindex=\"-1\"> 入口JS: src/main.ts</h2>\n<div><pre><code><span>// import './01_helloworld'</span>\n\ndocument<span>.</span><span>write</span><span>(</span><span>'Hello Webpack TS!'</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h2 id=\"index页面-public-index-html\" tabindex=\"-1\"> index页面: public/index.html</h2>\n<div><pre><code><span><span>&lt;!</span><span>DOCTYPE</span> <span>html</span><span>></span></span>\n<span><span><span>&lt;</span>html</span> <span>lang</span><span><span>=</span><span>\"</span>en<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;</span>head</span><span>></span></span>\n  <span><span><span>&lt;</span>meta</span> <span>charset</span><span><span>=</span><span>\"</span>UTF-8<span>\"</span></span><span>></span></span>\n  <span><span><span>&lt;</span>meta</span> <span>name</span><span><span>=</span><span>\"</span>viewport<span>\"</span></span> <span>content</span><span><span>=</span><span>\"</span>width=device-width, initial-scale=1.0<span>\"</span></span><span>></span></span>\n  <span><span><span>&lt;</span>meta</span> <span>http-equiv</span><span><span>=</span><span>\"</span>X-UA-Compatible<span>\"</span></span> <span>content</span><span><span>=</span><span>\"</span>ie=edge<span>\"</span></span><span>></span></span>\n  <span><span><span>&lt;</span>title</span><span>></span></span>webpack &amp; TS<span><span><span>&lt;/</span>title</span><span>></span></span>\n<span><span><span>&lt;/</span>head</span><span>></span></span>\n<span><span><span>&lt;</span>body</span><span>></span></span>\n  \n<span><span><span>&lt;/</span>body</span><span>></span></span>\n<span><span><span>&lt;/</span>html</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"build-webpack-config-js\" tabindex=\"-1\"> build/webpack.config.js</h2>\n<div><pre><code><span>const</span> <span>{</span>CleanWebpackPlugin<span>}</span> <span>=</span> <span>require</span><span>(</span><span>'clean-webpack-plugin'</span><span>)</span>\n<span>const</span> HtmlWebpackPlugin <span>=</span> <span>require</span><span>(</span><span>'html-webpack-plugin'</span><span>)</span>\n<span>const</span> path <span>=</span> <span>require</span><span>(</span><span>'path'</span><span>)</span>\n\n<span>const</span> isProd <span>=</span> process<span>.</span>env<span>.</span><span>NODE_ENV</span> <span>===</span> <span>'production'</span> <span>// 是否生产环境</span>\n\n<span>function</span> <span>resolve</span> <span>(</span><span>dir</span><span>)</span> <span>{</span>\n  <span>return</span> path<span>.</span><span>resolve</span><span>(</span>__dirname<span>,</span> <span>'..'</span><span>,</span> dir<span>)</span>\n<span>}</span>\n\nmodule<span>.</span>exports <span>=</span> <span>{</span>\n  <span>mode</span><span>:</span> isProd <span>?</span> <span>'production'</span> <span>:</span> <span>'development'</span><span>,</span>\n  <span>entry</span><span>:</span> <span>{</span>\n    <span>app</span><span>:</span> <span>'./src/main.ts'</span>\n  <span>}</span><span>,</span>\n\n  <span>output</span><span>:</span> <span>{</span>\n    <span>path</span><span>:</span> <span>resolve</span><span>(</span><span>'dist'</span><span>)</span><span>,</span>\n    <span>filename</span><span>:</span> <span>'[name].[contenthash:8].js'</span>\n  <span>}</span><span>,</span>\n\n  <span>module</span><span>:</span> <span>{</span>\n    <span>rules</span><span>:</span> <span>[</span>\n      <span>{</span>\n        <span>test</span><span>:</span> <span><span>/</span><span>\\.tsx?$</span><span>/</span></span><span>,</span>\n        <span>use</span><span>:</span> <span>'ts-loader'</span><span>,</span>\n        <span>include</span><span>:</span> <span>[</span><span>resolve</span><span>(</span><span>'src'</span><span>)</span><span>]</span>\n      <span>}</span>\n    <span>]</span>\n  <span>}</span><span>,</span>\n\n  <span>plugins</span><span>:</span> <span>[</span>\n    <span>new</span> <span>CleanWebpackPlugin</span><span>(</span><span>{</span>\n    <span>}</span><span>)</span><span>,</span>\n\n    <span>new</span> <span>HtmlWebpackPlugin</span><span>(</span><span>{</span>\n      <span>template</span><span>:</span> <span>'./public/index.html'</span>\n    <span>}</span><span>)</span>\n  <span>]</span><span>,</span>\n\n  <span>resolve</span><span>:</span> <span>{</span>\n    <span>extensions</span><span>:</span> <span>[</span><span>'.ts'</span><span>,</span> <span>'.tsx'</span><span>,</span> <span>'.js'</span><span>]</span>\n  <span>}</span><span>,</span>\n\n  <span>devtool</span><span>:</span> isProd <span>?</span> <span>'cheap-module-source-map'</span> <span>:</span> <span>'cheap-module-eval-source-map'</span><span>,</span>\n\n  <span>devServer</span><span>:</span> <span>{</span>\n    <span>host</span><span>:</span> <span>'localhost'</span><span>,</span> <span>// 主机名</span>\n    <span>stats</span><span>:</span> <span>'errors-only'</span><span>,</span> <span>// 打包日志输出输出错误信息</span>\n    <span>port</span><span>:</span> <span>8081</span><span>,</span>\n    <span>open</span><span>:</span> <span>true</span>\n  <span>}</span><span>,</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"配置打包命令\" tabindex=\"-1\"> 配置打包命令</h2>\n<div><pre><code>\"dev\": \"cross-env NODE_ENV=development webpack-dev-server --config build/webpack.config.js\",\n\"build\": \"cross-env NODE_ENV=production webpack --config build/webpack.config.js\"\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h2 id=\"运行与打包\" tabindex=\"-1\"> 运行与打包</h2>\n<div><pre><code>yarn dev\nyarn build\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div>",
      "date_published": "2022-07-21T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "1.初识 TypeScript",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter1/",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter1/",
      "summary": "初识 TypeScript",
      "content_html": "<p align=\"center\"> \n  <img src=\"https://metrics.lecoq.io/xlc520?template=classic&isocalendar=1&languages=1&people=1&activity=1&achievements=1&lines=1&repositories=1&notable=1&introduction=1&pagespeed=1&repositories=100&repositories.batch=100&repositories.forks=false&repositories.affiliations=owner&isocalendar.duration=full-year&languages.limit=8&languages.threshold=0%&languages.colors=github&languages.sections=most-used&languages.indepth=false&languages.analysis.timeout=15&languages.categories=markup%2C programming&languages.recent.categories=markup%2C programming&languages.recent.load=300&languages.recent.days=14&people.limit=24&people.identicons=false&people.identicons.hide=false&people.size=28&people.types=followers%2C following&people.shuffle=false&activity.limit=5&activity.load=300&activity.days=14&activity.visibility=all&activity.timestamps=false&activity.filter=all&achievements.threshold=C&achievements.secrets=true&achievements.display=detailed&achievements.limit=0&notable.from=organization&notable.repositories=false&notable.indepth=false&notable.types=commit&repositories.featured= xlc520%2Fxlc520.github.io&introduction.title=true&pagespeed.url=xlc520.github.io&pagespeed.detailed=false&pagespeed.screenshot=false&config.timezone=Asia%2FShanghai\" /> \n</p>\n<p align=\"center\"> \n  您是第  <img src=\"https://profile-counter.glitch.me/xlc520/count.svg\" />  位访问者\n</p>",
      "date_published": "2022-07-17T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "基础类型",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter2/1_type.html",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter2/1_type.html",
      "content_html": "<h1 id=\"_1-基础类型\" tabindex=\"-1\"> 1. 基础类型</h1>\n<p>TypeScript 支持与 JavaScript 几乎相同的数据类型，此外还提供了实用的枚举类型方便我们使用。</p>\n<h2 id=\"布尔值\" tabindex=\"-1\"> 布尔值</h2>\n<p>最基本的数据类型就是简单的 true/false 值，在JavaScript 和 TypeScript 里叫做 <code>boolean</code>（其它语言中也一样）。</p>\n<div><pre><code><span>let</span> isDone<span>:</span> <span>boolean</span> <span>=</span> <span>false</span><span>;</span>\nisDone <span>=</span> <span>true</span><span>;</span>\n<span>// isDone = 2 // error</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h2 id=\"数字\" tabindex=\"-1\"> 数字</h2>\n<p>和 JavaScript 一样，TypeScript 里的所有数字都是浮点数。 这些浮点数的类型是 number。 除了支持十进制和十六进制字面量，TypeScript 还支持 ECMAScript 2015中引入的二进制和八进制字面量。</p>\n<div><pre><code><span>let</span> a1<span>:</span> <span>number</span> <span>=</span> <span>10</span> <span>// 十进制</span>\n<span>let</span> a2<span>:</span> <span>number</span> <span>=</span> <span>0b1010</span>  <span>// 二进制</span>\n<span>let</span> a3<span>:</span> <span>number</span> <span>=</span> <span>0o12</span> <span>// 八进制</span>\n<span>let</span> a4<span>:</span> <span>number</span> <span>=</span> <span>0xa</span> <span>// 十六进制</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><h2 id=\"字符串\" tabindex=\"-1\"> 字符串</h2>\n<p>JavaScript 程序的另一项基本操作是处理网页或服务器端的文本数据。 像其它语言里一样，我们使用 <code>string</code> 表示文本数据类型。 和 JavaScript 一样，可以使用双引号（<code>&quot;</code>）或单引号（<code>'</code>）表示字符串。</p>\n<div><pre><code><span>let</span> name<span>:</span><span>string</span> <span>=</span> <span>'tom'</span>\nname <span>=</span> <span>'jack'</span>\n<span>// name = 12 // error</span>\n<span>let</span> age<span>:</span><span>number</span> <span>=</span> <span>12</span>\n<span>const</span> info <span>=</span> <span><span>`</span><span>My name is </span><span><span>${</span>name<span>}</span></span><span>, I am </span><span><span>${</span>age<span>}</span></span><span> years old!</span><span>`</span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"undefined-和-null\" tabindex=\"-1\"> undefined 和 null</h2>\n<p>TypeScript 里，<code>undefined</code> 和 <code>null</code> 两者各自有自己的类型分别叫做 <code>undefined</code> 和 <code>null</code>。 它们的本身的类型用处不是很大：</p>\n<div><pre><code><span>let</span> u<span>:</span> <span>undefined</span> <span>=</span> <span>undefined</span>\n<span>let</span> n<span>:</span> <span>null</span> <span>=</span> <span>null</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>默认情况下 <code>null</code> 和 <code>undefined</code> 是所有类型的子类型。 就是说你可以把 <code>null</code> 和 <code>undefined</code> 赋值给 <code>number</code> 类型的变量。</p>\n<h2 id=\"数组\" tabindex=\"-1\"> 数组</h2>\n<p>TypeScript 像 JavaScript 一样可以操作数组元素。 有两种方式可以定义数组。 第一种，可以在<code>元素类型后面接上[]</code>，表示由此类型元素组成的一个数组：</p>\n<div><pre><code><span>let</span> list1<span>:</span> <span>number</span><span>[</span><span>]</span> <span>=</span> <span>[</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>第二种方式是使用数组泛型，<code>Array&lt;元素类型&gt;</code>：</p>\n<div><pre><code><span>let</span> list2<span>:</span> <span>Array</span><span>&lt;</span><span>number</span><span>></span> <span>=</span> <span>[</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h2 id=\"元组-tuple\" tabindex=\"-1\"> 元组 Tuple</h2>\n<p>元组类型允许表示一个已知元素数量和类型的数组，<code>各元素的类型不必相同</code>。 比如，你可以定义一对值分别为 <code>string</code> 和 <code>number</code> 类型的元组。</p>\n<div><pre><code><span>let</span> t1<span>:</span> <span>[</span><span>string</span><span>,</span> <span>number</span><span>]</span>\nt1 <span>=</span> <span>[</span><span>'hello'</span><span>,</span> <span>10</span><span>]</span> <span>// OK</span>\nt1 <span>=</span> <span>[</span><span>10</span><span>,</span> <span>'hello'</span><span>]</span> <span>// Error</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>当访问一个已知索引的元素，会得到正确的类型：</p>\n<div><pre><code><span>console</span><span>.</span><span>log</span><span>(</span>t1<span>[</span><span>0</span><span>]</span><span>.</span><span>substring</span><span>(</span><span>1</span><span>)</span><span>)</span> <span>// OK</span>\n<span>console</span><span>.</span><span>log</span><span>(</span>t1<span>[</span><span>1</span><span>]</span><span>.</span><span>substring</span><span>(</span><span>1</span><span>)</span><span>)</span> <span>// Error, 'number' 不存在 'substring' 方法</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h2 id=\"枚举\" tabindex=\"-1\"> 枚举</h2>\n<p><code>enum</code> 类型是对 JavaScript 标准数据类型的一个补充。 使用枚举类型可以<code>为一组数值赋予友好的名字</code>。</p>\n<div><pre><code><span>enum</span> Color <span>{</span>\n  Red<span>,</span>\n  Green<span>,</span>\n  Blue\n<span>}</span>\n\n<span>// 枚举数值默认从0开始依次递增</span>\n<span>// 根据特定的名称得到对应的枚举数值</span>\n<span>let</span> myColor<span>:</span> Color <span>=</span> Color<span>.</span>Green  <span>// 0</span>\n<span>console</span><span>.</span><span>log</span><span>(</span>myColor<span>,</span> Color<span>.</span>Red<span>,</span> Color<span>.</span>Blue<span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>默认情况下，从 <code>0</code> 开始为元素编号。 你也可以手动的指定成员的数值。 例如，我们将上面的例子改成从 <code>1</code> 开始编号：</p>\n<div><pre><code><span>enum</span> Color <span>{</span>Red <span>=</span> <span>1</span><span>,</span> Green<span>,</span> Blue<span>}</span>\n<span>let</span> c<span>:</span> Color <span>=</span> Color<span>.</span>Green\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>或者，全部都采用手动赋值：</p>\n<div><pre><code><span>enum</span> Color <span>{</span>Red <span>=</span> <span>1</span><span>,</span> Green <span>=</span> <span>2</span><span>,</span> Blue <span>=</span> <span>4</span><span>}</span>\n<span>let</span> c<span>:</span> Color <span>=</span> Color<span>.</span>Green\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>枚举类型提供的一个便利是你可以由枚举的值得到它的名字。 例如，我们知道数值为 2，但是不确定它映射到 Color 里的哪个名字，我们可以查找相应的名字：</p>\n<div><pre><code><span>enum</span> Color <span>{</span>Red <span>=</span> <span>1</span><span>,</span> Green<span>,</span> Blue<span>}</span>\n<span>let</span> colorName<span>:</span> <span>string</span> <span>=</span> Color<span>[</span><span>2</span><span>]</span>\n\n<span>console</span><span>.</span><span>log</span><span>(</span>colorName<span>)</span>  <span>// 'Green'</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><h2 id=\"any\" tabindex=\"-1\"> any</h2>\n<p>有时候，我们会想要为那些在编程阶段还不清楚类型的变量指定一个类型。 这些值可能来自于动态的内容，比如来自用户输入或第三方代码库。 这种情况下，我们不希望类型检查器对这些值进行检查而是直接让它们通过编译阶段的检查。 那么我们可以使用 <code>any</code> 类型来标记这些变量：</p>\n<div><pre><code><span>let</span> notSure<span>:</span> <span>any</span> <span>=</span> <span>4</span>\nnotSure <span>=</span> <span>'maybe a string'</span>\nnotSure <span>=</span> <span>false</span> <span>// 也可以是个 boolean</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>在对现有代码进行改写的时候，<code>any</code> 类型是十分有用的，它允许你在编译时可选择地包含或移除类型检查。并且当你只知道一部分数据的类型时，<code>any</code> 类型也是有用的。 比如，你有一个数组，它包含了不同的类型的数据：</p>\n<div><pre><code><span>let</span> list<span>:</span> <span>any</span><span>[</span><span>]</span> <span>=</span> <span>[</span><span>1</span><span>,</span> <span>true</span><span>,</span> <span>'free'</span><span>]</span>\n\nlist<span>[</span><span>1</span><span>]</span> <span>=</span> <span>100</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h2 id=\"void\" tabindex=\"-1\"> void</h2>\n<p>某种程度上来说，<code>void</code> 类型像是与 <code>any</code> 类型相反，它<code>表示没有任何类型</code>。 当一个函数没有返回值时，你通常会见到其返回值类型是 <code>void</code>：</p>\n<div><pre><code><span>/* 表示没有任何类型, 一般用来说明函数的返回值不能是undefined和null之外的值 */</span>\n<span>function</span> <span>fn</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>\n  <span>console</span><span>.</span><span>log</span><span>(</span><span>'fn()'</span><span>)</span>\n  <span>// return undefined</span>\n  <span>// return null</span>\n  <span>// return 1 // error</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>声明一个 <code>void</code> 类型的变量没有什么大用，因为你只能为它赋予 <code>undefined</code> 和 <code>null</code>：</p>\n<div><pre><code><span>let</span> unusable<span>:</span> <span>void</span> <span>=</span> <span>undefined</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h2 id=\"object\" tabindex=\"-1\"> object</h2>\n<p><code>object</code> 表示非原始类型，也就是除 <code>number</code>，<code>string</code>，<code>boolean</code>之外的类型。</p>\n<p>使用 <code>object</code> 类型，就可以更好的表示像 <code>Object.create</code> 这样的 <code>API</code>。例如：</p>\n<div><pre><code><span>function</span> <span>fn2</span><span>(</span>obj<span>:</span>object<span>)</span><span>:</span>object <span>{</span>\n  <span>console</span><span>.</span><span>log</span><span>(</span><span>'fn2()'</span><span>,</span> obj<span>)</span>\n  <span>return</span> <span>{</span><span>}</span>\n  <span>// return undefined</span>\n  <span>// return null</span>\n<span>}</span>\n<span>console</span><span>.</span><span>log</span><span>(</span><span>fn2</span><span>(</span><span>new</span> <span>String</span><span>(</span><span>'abc'</span><span>)</span><span>)</span><span>)</span>\n<span>// console.log(fn2('abc') // error</span>\n<span>console</span><span>.</span><span>log</span><span>(</span><span>fn2</span><span>(</span>String<span>)</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"联合类型\" tabindex=\"-1\"> 联合类型</h2>\n<p>联合类型（Union Types）表示取值可以为多种类型中的一种<br>\n需求1: 定义一个一个函数得到一个数字或字符串值的字符串形式值</p>\n<div><pre><code><span>function</span> <span>toString2</span><span>(</span>x<span>:</span> <span>number</span> <span>|</span> <span>string</span><span>)</span> <span>:</span> <span>string</span> <span>{</span>\n  <span>return</span> x<span>.</span><span>toString</span><span>(</span><span>)</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>需求2: 定义一个一个函数得到一个数字或字符串值的长度</p>\n<div><pre><code><span>function</span> <span>getLength</span><span>(</span>x<span>:</span> <span>number</span> <span>|</span> <span>string</span><span>)</span> <span>{</span>\n\n  <span>// return x.length // error</span>\n\n  <span>if</span> <span>(</span>x<span>.</span>length<span>)</span> <span>{</span> <span>// error</span>\n    <span>return</span> x<span>.</span>length\n  <span>}</span> <span>else</span> <span>{</span>\n    <span>return</span> x<span>.</span><span>toString</span><span>(</span><span>)</span><span>.</span>length\n  <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"类型断言\" tabindex=\"-1\"> 类型断言</h2>\n<p>通过类型断言这种方式可以告诉编译器，“相信我，我知道自己在干什么”。 类型断言好比其它语言里的类型转换，但是不进行特殊的数据检查和解构。 它没有运行时的影响，只是在编译阶段起作用。 TypeScript 会假设你，程序员，已经进行了必须的检查。</p>\n<p>类型断言有两种形式。 其一是“尖括号”语法, 另一个为 <code>as</code> 语法</p>\n<div><pre><code><span>/* \n类型断言(Type Assertion): 可以用来手动指定一个值的类型\n语法:\n    方式一: &lt;类型>值\n    方式二: 值 as 类型  tsx中只能用这种方式\n*/</span>\n\n<span>/* 需求: 定义一个函数得到一个字符串或者数值数据的长度 */</span>\n<span>function</span> <span>getLength</span><span>(</span>x<span>:</span> <span>number</span> <span>|</span> <span>string</span><span>)</span> <span>{</span>\n  <span>if</span> <span>(</span><span>(</span><span>&lt;</span><span>string</span><span>></span>x<span>)</span><span>.</span>length<span>)</span> <span>{</span>\n    <span>return</span> <span>(</span>x <span>as</span> <span>string</span><span>)</span><span>.</span>length\n  <span>}</span> <span>else</span> <span>{</span>\n    <span>return</span> x<span>.</span><span>toString</span><span>(</span><span>)</span><span>.</span>length\n  <span>}</span>\n<span>}</span>\n<span>console</span><span>.</span><span>log</span><span>(</span><span>getLength</span><span>(</span><span>'abcd'</span><span>)</span><span>,</span> <span>getLength</span><span>(</span><span>1234</span><span>)</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"类型推断\" tabindex=\"-1\"> 类型推断</h2>\n<p>类型推断: TS会在没有明确的指定类型的时候推测出一个类型<br>\n有下面2种情况: 1. 定义变量时赋值了, 推断为对应的类型. 2. 定义变量时没有赋值, 推断为any类型</p>\n<div><pre><code><span>/* 定义变量时赋值了, 推断为对应的类型 */</span>\n<span>let</span> b9 <span>=</span> <span>123</span> <span>// number</span>\n<span>// b9 = 'abc' // error</span>\n\n<span>/* 定义变量时没有赋值, 推断为any类型 */</span>\n<span>let</span> b10  <span>// any类型</span>\nb10 <span>=</span> <span>123</span>\nb10 <span>=</span> <span>'abc'</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "date_published": "2022-07-22T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "接口",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter2/2_interface.html",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter2/2_interface.html",
      "content_html": "<h1 id=\"_2-接口\" tabindex=\"-1\"> 2. 接口</h1>\n<p>TypeScript 的核心原则之一是对值所具有的结构进行类型检查。我们使用接口（Interfaces）来定义对象的类型。<code>接口是对象的状态(属性)和行为(方法)的抽象(描述)</code></p>\n<h2 id=\"接口初探\" tabindex=\"-1\"> 接口初探</h2>\n<p>需求: 创建人的对象, 需要对人的属性进行一定的约束</p>\n<div><pre><code>id是number类型, 必须有, 只读的\nname是string类型, 必须有\nage是number类型, 必须有\nsex是string类型, 可以没有\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>下面通过一个简单示例来观察接口是如何工作的：</p>\n<div><pre><code><span>/* \n在 TypeScript 中，我们使用接口（Interfaces）来定义对象的类型\n接口: 是对象的状态(属性)和行为(方法)的抽象(描述)\n接口类型的对象\n    多了或者少了属性是不允许的\n    可选属性: ?\n    只读属性: readonly\n*/</span>\n\n<span>/* \n需求: 创建人的对象, 需要对人的属性进行一定的约束\n  id是number类型, 必须有, 只读的\n  name是string类型, 必须有\n  age是number类型, 必须有\n  sex是string类型, 可以没有\n*/</span>\n\n<span>// 定义人的接口</span>\n<span>interface</span> <span>IPerson</span> <span>{</span>\n  id<span>:</span> <span>number</span>\n  name<span>:</span> <span>string</span>\n  age<span>:</span> <span>number</span>\n  sex<span>:</span> <span>string</span>\n<span>}</span>\n\n<span>const</span> person1<span>:</span> IPerson <span>=</span> <span>{</span>\n  id<span>:</span> <span>1</span><span>,</span>\n  name<span>:</span> <span>'tom'</span><span>,</span>\n  age<span>:</span> <span>20</span><span>,</span>\n  sex<span>:</span> <span>'男'</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>类型检查器会查看对象内部的属性是否与IPerson接口描述一致, 如果不一致就会提示类型错误。</p>\n<h2 id=\"可选属性\" tabindex=\"-1\"> 可选属性</h2>\n<p>接口里的属性不全都是必需的。 有些是只在某些条件下存在，或者根本不存在。</p>\n<div><pre><code><span>interface</span> <span>IPerson</span> <span>{</span>\n  id<span>:</span> <span>number</span>\n  name<span>:</span> <span>string</span>\n  age<span>:</span> <span>number</span>\n  sex<span>?</span><span>:</span> <span>string</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>带有可选属性的接口与普通的接口定义差不多，只是在可选属性名字定义的后面加一个 <code>?</code> 符号。</p>\n<p>可选属性的好处之一是可以对可能存在的属性进行预定义，好处之二是可以捕获引用了不存在的属性时的错误。</p>\n<div><pre><code><span>const</span> person2<span>:</span> IPerson <span>=</span> <span>{</span>\n  id<span>:</span> <span>1</span><span>,</span>\n  name<span>:</span> <span>'tom'</span><span>,</span>\n  age<span>:</span> <span>20</span><span>,</span>\n  <span>// sex: '男' // 可以没有</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"只读属性\" tabindex=\"-1\"> 只读属性</h2>\n<p>一些对象属性只能在对象刚刚创建的时候修改其值。 你可以在属性名前用 <code>readonly</code> 来指定只读属性:</p>\n<div><pre><code><span>interface</span> <span>IPerson</span> <span>{</span>\n  <span>readonly</span> id<span>:</span> <span>number</span>\n  name<span>:</span> <span>string</span>\n  age<span>:</span> <span>number</span>\n  sex<span>?</span><span>:</span> <span>string</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>一旦赋值后再也不能被改变了。</p>\n<div><pre><code><span>const</span> person2<span>:</span> IPerson <span>=</span> <span>{</span>\n  id<span>:</span> <span>2</span><span>,</span>\n  name<span>:</span> <span>'tom'</span><span>,</span>\n  age<span>:</span> <span>20</span><span>,</span>\n  <span>// sex: '男' // 可以没有</span>\n  <span>// xxx: 12 // error 没有在接口中定义, 不能有</span>\n<span>}</span>\nperson2<span>.</span>id <span>=</span> <span>2</span> <span>// error</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"readonly-vs-const\" tabindex=\"-1\"> readonly vs const</h3>\n<p>最简单判断该用 <code>readonly</code> 还是 <code>const</code> 的方法是看要把它做为变量使用还是做为一个属性。 做为变量使用的话用 <code>const</code>，若做为属性则使用 <code>readonly</code>。</p>\n<h2 id=\"函数类型\" tabindex=\"-1\"> 函数类型</h2>\n<p>接口能够描述 JavaScript 中对象拥有的各种各样的外形。 除了描述带有属性的普通对象外，接口也可以描述函数类型。</p>\n<p>为了使用接口表示函数类型，我们需要给接口定义一个调用签名。它就像是一个只有参数列表和返回值类型的函数定义。参数列表里的每个参数都需要名字和类型。</p>\n<div><pre><code><span>/* \n接口可以描述函数类型(参数的类型与返回的类型)\n*/</span>\n\n<span>interface</span> <span>SearchFunc</span> <span>{</span>\n  <span>(</span>source<span>:</span> <span>string</span><span>,</span> subString<span>:</span> <span>string</span><span>)</span><span>:</span> <span>boolean</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>这样定义后，我们可以像使用其它接口一样使用这个函数类型的接口。 下例展示了如何创建一个函数类型的变量，并将一个同类型的函数赋值给这个变量。</p>\n<div><pre><code><span>const</span> mySearch<span>:</span> <span>SearchFunc</span> <span>=</span> <span>function</span> <span>(</span>source<span>:</span> <span>string</span><span>,</span> sub<span>:</span> <span>string</span><span>)</span><span>:</span> <span>boolean</span> <span>{</span>\n  <span>return</span> source<span>.</span><span>search</span><span>(</span>sub<span>)</span> <span>></span> <span>-</span><span>1</span>\n<span>}</span>\n\n<span>console</span><span>.</span><span>log</span><span>(</span><span>mySearch</span><span>(</span><span>'abcd'</span><span>,</span> <span>'bc'</span><span>)</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"类类型\" tabindex=\"-1\"> 类类型</h2>\n<h3 id=\"类实现接口\" tabindex=\"-1\"> 类实现接口</h3>\n<p>与 C# 或 Java 里接口的基本作用一样，TypeScript 也能够用它来明确的强制一个类去符合某种契约。</p>\n<div><pre><code><span>/* \n类类型: 实现接口\n1. 一个类可以实现多个接口\n2. 一个接口可以继承多个接口\n*/</span>\n\n<span>interface</span> <span>Alarm</span> <span>{</span>\n  <span>alert</span><span>(</span><span>)</span><span>:</span> <span>any</span><span>;</span>\n<span>}</span>\n\n<span>interface</span> <span>Light</span> <span>{</span>\n  <span>lightOn</span><span>(</span><span>)</span><span>:</span> <span>void</span><span>;</span>\n  <span>lightOff</span><span>(</span><span>)</span><span>:</span> <span>void</span><span>;</span>\n<span>}</span>\n\n<span>class</span> <span>Car</span> <span>implements</span> <span>Alarm</span> <span>{</span>\n  <span>alert</span><span>(</span><span>)</span> <span>{</span>\n      <span>console</span><span>.</span><span>log</span><span>(</span><span>'Car alert'</span><span>)</span><span>;</span>\n  <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"一个类可以实现多个接口\" tabindex=\"-1\"> 一个类可以实现多个接口</h2>\n<div><pre><code><span>class</span> <span>Car2</span> <span>implements</span> <span>Alarm</span><span>,</span> Light <span>{</span>\n  <span>alert</span><span>(</span><span>)</span> <span>{</span>\n    <span>console</span><span>.</span><span>log</span><span>(</span><span>'Car alert'</span><span>)</span><span>;</span>\n  <span>}</span>\n  <span>lightOn</span><span>(</span><span>)</span> <span>{</span>\n    <span>console</span><span>.</span><span>log</span><span>(</span><span>'Car light on'</span><span>)</span><span>;</span>\n  <span>}</span>\n  <span>lightOff</span><span>(</span><span>)</span> <span>{</span>\n    <span>console</span><span>.</span><span>log</span><span>(</span><span>'Car light off'</span><span>)</span><span>;</span>\n  <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"接口继承接口\" tabindex=\"-1\"> 接口继承接口</h2>\n<p>和类一样，接口也可以相互继承。 这让我们能够从一个接口里复制成员到另一个接口里，可以更灵活地将接口分割到可重用的模块里。</p>\n<div><pre><code><span>interface</span> <span>LightableAlarm</span> <span>extends</span> <span>Alarm</span><span>,</span> Light <span>{</span>\n\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div>",
      "date_published": "2022-07-23T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "类",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter2/3_class.html",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter2/3_class.html",
      "content_html": "<h1 id=\"_3-类\" tabindex=\"-1\"> 3. 类</h1>\n<p>对于传统的 JavaScript 程序我们会使用<code>函数</code>和<code>基于原型的继承</code>来创建可重用的组件，但对于熟悉使用面向对象方式的程序员使用这些语法就有些棘手，因为他们用的是<code>基于类的继承</code>并且对象是由类构建出来的。 从 ECMAScript 2015，也就是 ES6 开始， JavaScript 程序员将能够使用基于类的面向对象的方式。 使用 TypeScript，我们允许开发者现在就使用这些特性，并且编译后的 JavaScript 可以在所有主流浏览器和平台上运行，而不需要等到下个 JavaScript 版本。</p>\n<h2 id=\"基本示例\" tabindex=\"-1\"> 基本示例</h2>\n<p>下面看一个使用类的例子：</p>\n<div><pre><code><span>/* \n类的基本定义与使用\n*/</span>\n\n<span>class</span> <span>Greeter</span> <span>{</span>\n  <span>// 声明属性</span>\n  message<span>:</span> <span>string</span>\n\n  <span>// 构造方法</span>\n  <span>constructor</span> <span>(</span>message<span>:</span> <span>string</span><span>)</span> <span>{</span>\n    <span>this</span><span>.</span>message <span>=</span> message\n  <span>}</span>\n\n  <span>// 一般方法</span>\n  <span>greet</span> <span>(</span><span>)</span><span>:</span> <span>string</span> <span>{</span>\n    <span>return</span> <span>'Hello '</span> <span>+</span> <span>this</span><span>.</span>message\n  <span>}</span>\n<span>}</span>\n\n<span>// 创建类的实例</span>\n<span>const</span> greeter <span>=</span> <span>new</span> <span>Greeter</span><span>(</span><span>'world'</span><span>)</span>\n<span>// 调用实例的方法</span>\n<span>console</span><span>.</span><span>log</span><span>(</span>greeter<span>.</span><span>greet</span><span>(</span><span>)</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>如果你使用过 C# 或 Java，你会对这种语法非常熟悉。 我们声明一个 <code>Greeter</code> 类。这个类有 3 个成员：一个叫做 <code>message</code> 的属性，一个构造函数和一个 <code>greet</code> 方法。</p>\n<p>你会注意到，我们在引用任何一个类成员的时候都用了 <code>this</code>。 它表示我们访问的是类的成员。</p>\n<p>后面一行，我们使用 <code>new</code> 构造了 <code>Greeter</code> 类的一个实例。它会调用之前定义的构造函数，创建一个 <code>Greeter</code> 类型的新对象，并执行构造函数初始化它。</p>\n<p>最后一行通过 <code>greeter</code> 对象调用其 <code>greet</code> 方法</p>\n<h2 id=\"继承\" tabindex=\"-1\"> 继承</h2>\n<p>在 TypeScript 里，我们可以使用常用的面向对象模式。 基于类的程序设计中一种最基本的模式是允许使用继承来扩展现有的类。</p>\n<p>看下面的例子：</p>\n<div><pre><code><span>/* \n类的继承\n*/</span>\n\n<span>class</span> <span>Animal</span> <span>{</span>\n  <span>run</span> <span>(</span>distance<span>:</span> <span>number</span><span>)</span> <span>{</span>\n    <span>console</span><span>.</span><span>log</span><span>(</span><span><span>`</span><span>Animal run </span><span><span>${</span>distance<span>}</span></span><span>m</span><span>`</span></span><span>)</span>\n  <span>}</span>\n<span>}</span>\n\n<span>class</span> <span>Dog</span> <span>extends</span> <span>Animal</span> <span>{</span>\n  <span>cry</span> <span>(</span><span>)</span> <span>{</span>\n    <span>console</span><span>.</span><span>log</span><span>(</span><span>'wang! wang!'</span><span>)</span>\n  <span>}</span>\n<span>}</span>\n\n<span>const</span> dog <span>=</span> <span>new</span> <span>Dog</span><span>(</span><span>)</span>\ndog<span>.</span><span>cry</span><span>(</span><span>)</span> \ndog<span>.</span><span>run</span><span>(</span><span>100</span><span>)</span> <span>// 可以调用从父中继承得到的方法</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>这个例子展示了最基本的继承：类从基类中继承了属性和方法。 这里，<code>Dog</code> 是一个 派生类，它派生自 <code>Animal</code> 基类，通过 <code>extends</code> 关键字。 派生类通常被称作<em>子类</em>，基类通常被称作<em>超类</em>。</p>\n<p>因为 <code>Dog</code> 继承了 <code>Animal</code> 的功能，因此我们可以创建一个 <code>Dog</code> 的实例，它能够 <code>cry()</code> 和 <code>run()</code>。</p>\n<p>下面我们来看个更加复杂的例子。</p>\n<div><pre><code><span>class</span> <span>Animal</span> <span>{</span>\n  name<span>:</span> <span>string</span>\n  \n  <span>constructor</span> <span>(</span>name<span>:</span> <span>string</span><span>)</span> <span>{</span>\n    <span>this</span><span>.</span>name <span>=</span> name\n  <span>}</span>\n\n  <span>run</span> <span>(</span>distance<span>:</span> <span>number</span><span>=</span><span>0</span><span>)</span> <span>{</span>\n    <span>console</span><span>.</span><span>log</span><span>(</span><span><span>`</span><span><span>${</span><span>this</span><span>.</span>name<span>}</span></span><span> run </span><span><span>${</span>distance<span>}</span></span><span>m</span><span>`</span></span><span>)</span>\n  <span>}</span>\n\n<span>}</span>\n\n<span>class</span> <span>Snake</span> <span>extends</span> <span>Animal</span> <span>{</span>\n  <span>constructor</span> <span>(</span>name<span>:</span> <span>string</span><span>)</span> <span>{</span>\n    <span>// 调用父类型构造方法</span>\n    <span>super</span><span>(</span>name<span>)</span>\n  <span>}</span>\n\n  <span>// 重写父类型的方法</span>\n  <span>run</span> <span>(</span>distance<span>:</span> <span>number</span><span>=</span><span>5</span><span>)</span> <span>{</span>\n    <span>console</span><span>.</span><span>log</span><span>(</span><span>'sliding...'</span><span>)</span>\n    <span>super</span><span>.</span><span>run</span><span>(</span>distance<span>)</span>\n  <span>}</span>\n<span>}</span>\n\n<span>class</span> <span>Horse</span> <span>extends</span> <span>Animal</span> <span>{</span>\n  <span>constructor</span> <span>(</span>name<span>:</span> <span>string</span><span>)</span> <span>{</span>\n    <span>// 调用父类型构造方法</span>\n    <span>super</span><span>(</span>name<span>)</span>\n  <span>}</span>\n\n  <span>// 重写父类型的方法</span>\n  <span>run</span> <span>(</span>distance<span>:</span> <span>number</span><span>=</span><span>50</span><span>)</span> <span>{</span>\n    <span>console</span><span>.</span><span>log</span><span>(</span><span>'dashing...'</span><span>)</span>\n    <span>// 调用父类型的一般方法</span>\n    <span>super</span><span>.</span><span>run</span><span>(</span>distance<span>)</span>\n  <span>}</span>\n\n  <span>xxx</span> <span>(</span><span>)</span> <span>{</span>\n    <span>console</span><span>.</span><span>log</span><span>(</span><span>'xxx()'</span><span>)</span>\n  <span>}</span>\n<span>}</span>\n\n<span>const</span> snake <span>=</span> <span>new</span> <span>Snake</span><span>(</span><span>'sn'</span><span>)</span>\nsnake<span>.</span><span>run</span><span>(</span><span>)</span>\n\n<span>const</span> horse <span>=</span> <span>new</span> <span>Horse</span><span>(</span><span>'ho'</span><span>)</span>\nhorse<span>.</span><span>run</span><span>(</span><span>)</span>\n\n<span>// 父类型引用指向子类型的实例 ==> 多态</span>\n<span>const</span> tom<span>:</span> Animal <span>=</span> <span>new</span> <span>Horse</span><span>(</span><span>'ho22'</span><span>)</span>\ntom<span>.</span><span>run</span><span>(</span><span>)</span>\n\n<span>/* 如果子类型没有扩展的方法, 可以让子类型引用指向父类型的实例 */</span>\n<span>const</span> tom3<span>:</span> Snake <span>=</span> <span>new</span> <span>Animal</span><span>(</span><span>'tom3'</span><span>)</span>\ntom3<span>.</span><span>run</span><span>(</span><span>)</span>\n<span>/* 如果子类型有扩展的方法, 不能让子类型引用指向父类型的实例 */</span>\n<span>// const tom2: Horse = new Animal('tom2')</span>\n<span>// tom2.run()</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>这个例子展示了一些上面没有提到的特性。 这一次，我们使用 <code>extends</code> 关键字创建了 Animal的两个子类：<code>Horse</code> 和 <code>Snake</code>。</p>\n<p>与前一个例子的不同点是，派生类包含了一个构造函数，它 必须调用 <code>super()</code>，它会执行基类的构造函数。 而且，在构造函数里访问 <code>this</code> 的属性之前，我们 一定要调用 <code>super()</code>。 这个是 TypeScript 强制执行的一条重要规则。</p>\n<p>这个例子演示了如何在子类里可以重写父类的方法。<code>Snake</code>类和 <code>Horse</code> 类都创建了 <code>run</code> 方法，它们重写了从 <code>Animal</code> 继承来的 <code>run</code> 方法，使得 <code>run</code> 方法根据不同的类而具有不同的功能。注意，即使 <code>tom</code> 被声明为 <code>Animal</code> 类型，但因为它的值是 <code>Horse</code>，调用 <code>tom.run(34)</code> 时，它会调用 <code>Horse</code> 里重写的方法。</p>\n<div><pre><code>sliding...\nsn run 5m\ndashing...\nho run 50m\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><h2 id=\"公共-私有与受保护的修饰符\" tabindex=\"-1\"> 公共，私有与受保护的修饰符</h2>\n<h3 id=\"默认为-public\" tabindex=\"-1\"> 默认为 public</h3>\n<p>在上面的例子里，我们可以自由的访问程序里定义的成员。 如果你对其它语言中的类比较了解，就会注意到我们在之前的代码里并没有使用 <code>public</code> 来做修饰；例如，C# 要求必须明确地使用 <code>public</code> 指定成员是可见的。 在 TypeScript 里，成员都默认为 <code>public</code>。</p>\n<p>你也可以明确的将一个成员标记成 <code>public</code>。 我们可以用下面的方式来重写上面的 <code>Animal</code> 类：</p>\n<h3 id=\"理解-private\" tabindex=\"-1\"> 理解 private</h3>\n<p>当成员被标记成 <code>private</code> 时，它就不能在声明它的类的外部访问。</p>\n<h3 id=\"理解-protected\" tabindex=\"-1\"> 理解 protected</h3>\n<p><code>protected</code> 修饰符与 <code>private</code> 修饰符的行为很相似，但有一点不同，<code>protected</code>成员在派生类中仍然可以访问。例如：</p>\n<div><pre><code><span>/* \n访问修饰符: 用来描述类内部的属性/方法的可访问性\n  public: 默认值, 公开的外部也可以访问\n  private: 只能类内部可以访问\n  protected: 类内部和子类可以访问\n*/</span>\n\n<span>class</span> <span>Animal</span> <span>{</span>\n  <span>public</span> name<span>:</span> <span>string</span>\n\n  <span>public</span> <span>constructor</span> <span>(</span>name<span>:</span> <span>string</span><span>)</span> <span>{</span>\n    <span>this</span><span>.</span>name <span>=</span> name\n  <span>}</span>\n\n  <span>public</span> <span>run</span> <span>(</span>distance<span>:</span> <span>number</span><span>=</span><span>0</span><span>)</span> <span>{</span>\n    <span>console</span><span>.</span><span>log</span><span>(</span><span><span>`</span><span><span>${</span><span>this</span><span>.</span>name<span>}</span></span><span> run </span><span><span>${</span>distance<span>}</span></span><span>m</span><span>`</span></span><span>)</span>\n  <span>}</span>\n<span>}</span>\n\n<span>class</span> <span>Person</span> <span>extends</span> <span>Animal</span> <span>{</span>\n  <span>private</span> age<span>:</span> <span>number</span> <span>=</span> <span>18</span>\n  <span>protected</span> sex<span>:</span> <span>string</span> <span>=</span> <span>'男'</span>\n\n  <span>run</span> <span>(</span>distance<span>:</span> <span>number</span><span>=</span><span>5</span><span>)</span> <span>{</span>\n    <span>console</span><span>.</span><span>log</span><span>(</span><span>'Person jumping...'</span><span>)</span>\n    <span>super</span><span>.</span><span>run</span><span>(</span>distance<span>)</span>\n  <span>}</span>\n<span>}</span>\n\n<span>class</span> <span>Student</span> <span>extends</span> <span>Person</span> <span>{</span>\n  <span>run</span> <span>(</span>distance<span>:</span> <span>number</span><span>=</span><span>6</span><span>)</span> <span>{</span>\n    <span>console</span><span>.</span><span>log</span><span>(</span><span>'Student jumping...'</span><span>)</span>\n\n    <span>console</span><span>.</span><span>log</span><span>(</span><span>this</span><span>.</span>sex<span>)</span> <span>// 子类能看到父类中受保护的成员</span>\n    <span>// console.log(this.age) //  子类看不到父类中私有的成员</span>\n\n    <span>super</span><span>.</span><span>run</span><span>(</span>distance<span>)</span>\n  <span>}</span>\n<span>}</span>\n\n<span>console</span><span>.</span><span>log</span><span>(</span><span>new</span> <span>Person</span><span>(</span><span>'abc'</span><span>)</span><span>.</span>name<span>)</span> <span>// 公开的可见</span>\n<span>// console.log(new Person('abc').sex) // 受保护的不可见</span>\n<span>// console.log(new Person('abc').age) //  私有的不可见</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"readonly-修饰符\" tabindex=\"-1\"> readonly 修饰符</h2>\n<p>你可以使用 <code>readonly</code> 关键字将属性设置为只读的。 只读属性必须在声明时或构造函数里被初始化。</p>\n<div><pre><code><span>class</span> <span>Person</span> <span>{</span>\n  <span>readonly</span> name<span>:</span> <span>string</span> <span>=</span> <span>'abc'</span>\n  <span>constructor</span><span>(</span>name<span>:</span> <span>string</span><span>)</span> <span>{</span>\n    <span>this</span><span>.</span>name <span>=</span> name\n  <span>}</span>\n<span>}</span>\n\n<span>let</span> john <span>=</span> <span>new</span> <span>Person</span><span>(</span><span>'John'</span><span>)</span>\n<span>// john.name = 'peter' // error</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"参数属性\" tabindex=\"-1\"> 参数属性</h3>\n<p>在上面的例子中，我们必须在 <code>Person</code> 类里定义一个只读成员 <code>name</code> 和一个参数为 <code>name</code> 的构造函数，并且立刻将 <code>name</code> 的值赋给 <code>this.name</code>，这种情况经常会遇到。 参数属性可以方便地让我们在一个地方定义并初始化一个成员。 下面的例子是对之前 <code>Person</code> 类的修改版，使用了参数属性：</p>\n<div><pre><code><span>class</span> <span>Person2</span> <span>{</span>\n  <span>constructor</span><span>(</span><span>readonly</span> name<span>:</span> <span>string</span><span>)</span> <span>{</span>\n  <span>}</span>\n<span>}</span>\n\n<span>const</span> p <span>=</span> <span>new</span> <span>Person2</span><span>(</span><span>'jack'</span><span>)</span>\n<span>console</span><span>.</span><span>log</span><span>(</span>p<span>.</span>name<span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>注意看我们是如何舍弃参数 <code>name</code>，仅在构造函数里使用 <code>readonly name: string</code> 参数来创建和初始化 <code>name</code> 成员。 我们把声明和赋值合并至一处。</p>\n<p>参数属性通过给构造函数参数前面添加一个访问限定符来声明。使用 <code>private</code> 限定一个参数属性会声明并初始化一个私有成员；对于 <code>public</code> 和 <code>protected</code> 来说也是一样。</p>\n<h2 id=\"存取器\" tabindex=\"-1\"> 存取器</h2>\n<p><code>TypeScript</code> 支持通过 <code>getters/setters</code> 来截取对对象成员的访问。 它能帮助你有效的控制对对象成员的访问。</p>\n<p>下面来看如何把一个简单的类改写成使用 <code>get</code> 和 <code>set</code>。 首先，我们从一个没有使用存取器的例子开始。</p>\n<div><pre><code><span>class</span> <span>Person</span> <span>{</span>\n  firstName<span>:</span> <span>string</span> <span>=</span> <span>'A'</span>\n  lastName<span>:</span> <span>string</span> <span>=</span> <span>'B'</span>\n  <span>get</span> <span>fullName</span> <span>(</span><span>)</span> <span>{</span>\n    <span>return</span> <span>this</span><span>.</span>firstName <span>+</span> <span>'-'</span> <span>+</span> <span>this</span><span>.</span>lastName\n  <span>}</span>\n  <span>set</span> <span>fullName</span> <span>(</span>value<span>)</span> <span>{</span>\n    <span>const</span> names <span>=</span> value<span>.</span><span>split</span><span>(</span><span>'-'</span><span>)</span>\n    <span>this</span><span>.</span>firstName <span>=</span> names<span>[</span><span>0</span><span>]</span>\n    <span>this</span><span>.</span>lastName <span>=</span> names<span>[</span><span>1</span><span>]</span>\n  <span>}</span>\n<span>}</span>\n\n<span>const</span> p <span>=</span> <span>new</span> <span>Person</span><span>(</span><span>)</span>\n<span>console</span><span>.</span><span>log</span><span>(</span>p<span>.</span>fullName<span>)</span>\n\np<span>.</span>firstName <span>=</span> <span>'C'</span>\np<span>.</span>lastName <span>=</span>  <span>'D'</span>\n<span>console</span><span>.</span><span>log</span><span>(</span>p<span>.</span>fullName<span>)</span>\n\np<span>.</span>fullName <span>=</span> <span>'E-F'</span>\n<span>console</span><span>.</span><span>log</span><span>(</span>p<span>.</span>firstName<span>,</span> p<span>.</span>lastName<span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"静态属性\" tabindex=\"-1\"> 静态属性</h2>\n<p>到目前为止，我们只讨论了类的实例成员，那些仅当类被实例化的时候才会被初始化的属性。 我们也可以创建类的静态成员，这些属性存在于类本身上面而不是类的实例上。 在这个例子里，我们使用 <code>static</code> 定义 <code>origin</code>，因为它是所有网格都会用到的属性。 每个实例想要访问这个属性的时候，都要在 <code>origin</code> 前面加上类名。 如同在实例属性上使用 <code>this.xxx</code> 来访问属性一样，这里我们使用 <code>Grid.xxx</code> 来访问静态属性。</p>\n<div><pre><code><span>/* \n静态属性, 是类对象的属性\n非静态属性, 是类的实例对象的属性\n*/</span>\n\n<span>class</span> <span>Person</span> <span>{</span>\n  name1<span>:</span> <span>string</span> <span>=</span> <span>'A'</span>\n  <span>static</span> name2<span>:</span> <span>string</span> <span>=</span> <span>'B'</span>\n<span>}</span>\n\n<span>console</span><span>.</span><span>log</span><span>(</span>Person<span>.</span>name2<span>)</span>\n<span>console</span><span>.</span><span>log</span><span>(</span><span>new</span> <span>Person</span><span>(</span><span>)</span><span>.</span>name1<span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"抽象类\" tabindex=\"-1\"> 抽象类</h2>\n<p>抽象类做为其它派生类的基类使用。 它们不能被实例化。不同于接口，抽象类可以包含成员的实现细节。 <code>abstract</code> 关键字是用于定义抽象类和在抽象类内部定义抽象方法。</p>\n<div><pre><code><span>/* \n抽象类\n  不能创建实例对象, 只有实现类才能创建实例\n  可以包含未实现的抽象方法\n*/</span>\n\n<span>abstract</span> <span>class</span> <span>Animal</span> <span>{</span>\n\n  <span>abstract</span> <span>cry</span> <span>(</span><span>)</span>\n\n  <span>run</span> <span>(</span><span>)</span> <span>{</span>\n    <span>console</span><span>.</span><span>log</span><span>(</span><span>'run()'</span><span>)</span>\n  <span>}</span>\n<span>}</span>\n\n<span>class</span> <span>Dog</span> <span>extends</span> <span>Animal</span> <span>{</span>\n  <span>cry</span> <span>(</span><span>)</span> <span>{</span>\n    <span>console</span><span>.</span><span>log</span><span>(</span><span>' Dog cry()'</span><span>)</span>\n  <span>}</span>\n<span>}</span>\n\n<span>const</span> dog <span>=</span> <span>new</span> <span>Dog</span><span>(</span><span>)</span>\ndog<span>.</span><span>cry</span><span>(</span><span>)</span>\ndog<span>.</span><span>run</span><span>(</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "date_published": "2022-07-24T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "函数",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter2/4_function.html",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter2/4_function.html",
      "content_html": "<h1 id=\"_4-函数\" tabindex=\"-1\"> 4. 函数</h1>\n<p>函数是 JavaScript 应用程序的基础，它帮助你实现抽象层，模拟类，信息隐藏和模块。在 TypeScript 里，虽然已经支持类，命名空间和模块，但函数仍然是主要的定义行为的地方。TypeScript 为 JavaScript 函数添加了额外的功能，让我们可以更容易地使用。</p>\n<h2 id=\"基本示例\" tabindex=\"-1\"> 基本示例</h2>\n<p>和 JavaScript 一样，TypeScript 函数可以创建有名字的函数和匿名函数。你可以随意选择适合应用程序的方式，不论是定义一系列 API 函数还是只使用一次的函数。</p>\n<p>通过下面的例子可以迅速回想起这两种 JavaScript 中的函数：</p>\n<div><pre><code><span>// 命名函数</span>\n<span>function</span> <span>add</span><span>(</span><span>x<span>,</span> y</span><span>)</span> <span>{</span>\n  <span>return</span> x <span>+</span> y\n<span>}</span>\n\n<span>// 匿名函数</span>\n<span>let</span> <span>myAdd</span> <span>=</span> <span>function</span><span>(</span><span>x<span>,</span> y</span><span>)</span> <span>{</span> \n  <span>return</span> x <span>+</span> y<span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"函数类型\" tabindex=\"-1\"> 函数类型</h2>\n<h3 id=\"为函数定义类型\" tabindex=\"-1\"> 为函数定义类型</h3>\n<p>让我们为上面那个函数添加类型：</p>\n<div><pre><code><span>function</span> <span>add</span><span>(</span>x<span>:</span> <span>number</span><span>,</span> y<span>:</span> <span>number</span><span>)</span><span>:</span> <span>number</span> <span>{</span>\n  <span>return</span> x <span>+</span> y\n<span>}</span>\n\n<span>let</span> <span>myAdd</span> <span>=</span> <span>function</span><span>(</span>x<span>:</span> <span>number</span><span>,</span> y<span>:</span> <span>number</span><span>)</span><span>:</span> <span>number</span> <span>{</span> \n  <span>return</span> x <span>+</span> y\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>我们可以给每个参数添加类型之后再为函数本身添加返回值类型。TypeScript 能够根据返回语句自动推断出返回值类型。</p>\n<h3 id=\"书写完整函数类型\" tabindex=\"-1\"> 书写完整函数类型</h3>\n<p>现在我们已经为函数指定了类型，下面让我们写出函数的完整类型。</p>\n<div><pre><code><span>let</span> <span>myAdd2</span><span>:</span> <span>(</span>x<span>:</span> <span>number</span><span>,</span> y<span>:</span> <span>number</span><span>)</span> <span>=></span> <span>number</span> <span>=</span> \n<span>function</span><span>(</span>x<span>:</span> <span>number</span><span>,</span> y<span>:</span> <span>number</span><span>)</span><span>:</span> <span>number</span> <span>{</span>\n  <span>return</span> x <span>+</span> y\n<span>}</span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"可选参数和默认参数\" tabindex=\"-1\"> 可选参数和默认参数</h2>\n<p>TypeScript 里的每个函数参数都是必须的。 这不是指不能传递 <code>null</code> 或 <code>undefined</code> 作为参数，而是说编译器检查用户是否为每个参数都传入了值。编译器还会假设只有这些参数会被传递进函数。 简短地说，传递给一个函数的参数个数必须与函数期望的参数个数一致。</p>\n<p>JavaScript 里，每个参数都是可选的，可传可不传。 没传参的时候，它的值就是 <code>undefined</code>。 在TypeScript 里我们可以在参数名旁使用 <code>?</code> 实现可选参数的功能。 比如，我们想让 <code>lastName</code> 是可选的：</p>\n<p>在 TypeScript 里，我们也可以为参数提供一个默认值当用户没有传递这个参数或传递的值是 <code>undefined</code> 时。 它们叫做有默认初始化值的参数。 让我们修改上例，把<code>firstName</code> 的默认值设置为 <code>&quot;A&quot;</code>。</p>\n<div><pre><code><span>function</span> <span>buildName</span><span>(</span>firstName<span>:</span> <span>string</span><span>=</span><span>'A'</span><span>,</span> lastName<span>?</span><span>:</span> <span>string</span><span>)</span><span>:</span> <span>string</span> <span>{</span>\n  <span>if</span> <span>(</span>lastName<span>)</span> <span>{</span>\n    <span>return</span> firstName <span>+</span> <span>'-'</span> <span>+</span> lastName\n  <span>}</span> <span>else</span> <span>{</span>\n    <span>return</span> firstName\n  <span>}</span>\n<span>}</span>\n\n<span>console</span><span>.</span><span>log</span><span>(</span><span>buildName</span><span>(</span><span>'C'</span><span>,</span> <span>'D'</span><span>)</span><span>)</span>\n<span>console</span><span>.</span><span>log</span><span>(</span><span>buildName</span><span>(</span><span>'C'</span><span>)</span><span>)</span>\n<span>console</span><span>.</span><span>log</span><span>(</span><span>buildName</span><span>(</span><span>)</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"剩余参数\" tabindex=\"-1\"> 剩余参数</h3>\n<p>必要参数，默认参数和可选参数有个共同点：它们表示某一个参数。 有时，你想同时操作多个参数，或者你并不知道会有多少参数传递进来。 在 JavaScript 里，你可以使用 <code>arguments</code> 来访问所有传入的参数。</p>\n<p>在 TypeScript 里，你可以把所有参数收集到一个变量里：<br>\n剩余参数会被当做个数不限的可选参数。 可以一个都没有，同样也可以有任意个。 编译器创建参数数组，名字是你在省略号（ <code>...</code>）后面给定的名字，你可以在函数体内使用这个数组。</p>\n<div><pre><code><span>function</span> <span>info</span><span>(</span>x<span>:</span> <span>string</span><span>,</span> <span>...</span>args<span>:</span> <span>string</span><span>[</span><span>]</span><span>)</span> <span>{</span>\n  <span>console</span><span>.</span><span>log</span><span>(</span>x<span>,</span> args<span>)</span>\n<span>}</span>\n<span>info</span><span>(</span><span>'abc'</span><span>,</span> <span>'c'</span><span>,</span> <span>'b'</span><span>,</span> <span>'a'</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><h2 id=\"函数重载\" tabindex=\"-1\"> 函数重载</h2>\n<p>函数重载: 函数名相同, 而形参不同的多个函数<br>\n在JS中, 由于弱类型的特点和形参与实参可以不匹配, 是没有函数重载这一说的\n但在TS中, 与其它面向对象的语言(如Java)就存在此语法</p>\n<div><pre><code><span>/* \n函数重载: 函数名相同, 而形参不同的多个函数\n需求: 我们有一个add函数，它可以接收2个string类型的参数进行拼接，也可以接收2个number类型的参数进行相加 \n*/</span>\n\n<span>// 重载函数声明</span>\n<span>function</span> <span>add</span> <span>(</span>x<span>:</span> <span>string</span><span>,</span> y<span>:</span> <span>string</span><span>)</span><span>:</span> <span>string</span>\n<span>function</span> <span>add</span> <span>(</span>x<span>:</span> <span>number</span><span>,</span> y<span>:</span> <span>number</span><span>)</span><span>:</span> <span>number</span>\n\n<span>// 定义函数实现</span>\n<span>function</span> <span>add</span><span>(</span>x<span>:</span> <span>string</span> <span>|</span> <span>number</span><span>,</span> y<span>:</span> <span>string</span> <span>|</span> <span>number</span><span>)</span><span>:</span> <span>string</span> <span>|</span> <span>number</span> <span>{</span>\n  <span>// 在实现上我们要注意严格判断两个参数的类型是否相等，而不能简单的写一个 x + y</span>\n  <span>if</span> <span>(</span><span>typeof</span> x <span>===</span> <span>'string'</span> <span>&amp;&amp;</span> <span>typeof</span> y <span>===</span> <span>'string'</span><span>)</span> <span>{</span>\n    <span>return</span> x <span>+</span> y\n  <span>}</span> <span>else</span> <span>if</span> <span>(</span><span>typeof</span> x <span>===</span> <span>'number'</span> <span>&amp;&amp;</span> <span>typeof</span> y <span>===</span> <span>'number'</span><span>)</span> <span>{</span>\n    <span>return</span> x <span>+</span> y\n  <span>}</span>\n<span>}</span>\n\n<span>console</span><span>.</span><span>log</span><span>(</span><span>add</span><span>(</span><span>1</span><span>,</span> <span>2</span><span>)</span><span>)</span>\n<span>console</span><span>.</span><span>log</span><span>(</span><span>add</span><span>(</span><span>'a'</span><span>,</span> <span>'b'</span><span>)</span><span>)</span>\n<span>// console.log(add(1, 'a')) // error</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "date_published": "2022-07-25T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "泛型",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter2/5_generic.html",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter2/5_generic.html",
      "content_html": "<h1 id=\"_5-泛型\" tabindex=\"-1\"> 5. 泛型</h1>\n<p>指在定义函数、接口或类的时候，不预先指定具体的类型，而在使用的时候再指定具体类型的一种特性。</p>\n<h2 id=\"引入\" tabindex=\"-1\"> 引入</h2>\n<p>下面创建一个函数, 实现功能: 根据指定的数量 <code>count</code> 和数据 <code>value</code> , 创建一个包含 <code>count</code> 个 <code>value</code> 的数组\n不用泛型的话，这个函数可能是下面这样：</p>\n<div><pre><code><span>function</span> <span>createArray</span><span>(</span>value<span>:</span> <span>any</span><span>,</span> count<span>:</span> <span>number</span><span>)</span><span>:</span> <span>any</span><span>[</span><span>]</span> <span>{</span>\n  <span>const</span> arr<span>:</span> <span>any</span><span>[</span><span>]</span> <span>=</span> <span>[</span><span>]</span>\n  <span>for</span> <span>(</span><span>let</span> index <span>=</span> <span>0</span><span>;</span> index <span>&lt;</span> count<span>;</span> index<span>++</span><span>)</span> <span>{</span>\n    arr<span>.</span><span>push</span><span>(</span>value<span>)</span>\n  <span>}</span>\n  <span>return</span> arr\n<span>}</span>\n\n<span>const</span> arr1 <span>=</span> <span>createArray</span><span>(</span><span>11</span><span>,</span> <span>3</span><span>)</span>\n<span>const</span> arr2 <span>=</span> <span>createArray</span><span>(</span><span>'aa'</span><span>,</span> <span>3</span><span>)</span>\n<span>console</span><span>.</span><span>log</span><span>(</span>arr1<span>[</span><span>0</span><span>]</span><span>.</span><span>toFixed</span><span>(</span><span>)</span><span>,</span> arr2<span>[</span><span>0</span><span>]</span><span>.</span><span>split</span><span>(</span><span>''</span><span>)</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"使用函数泛型\" tabindex=\"-1\"> 使用函数泛型</h2>\n<div><pre><code><span>function</span> <span><span>createArray2</span> <span><span>&lt;</span><span>T</span><span>></span></span></span> <span>(</span>value<span>:</span> <span>T</span><span>,</span> count<span>:</span> <span>number</span><span>)</span> <span>{</span>\n  <span>const</span> arr<span>:</span> <span>Array</span><span>&lt;</span><span>T</span><span>></span> <span>=</span> <span>[</span><span>]</span>\n  <span>for</span> <span>(</span><span>let</span> index <span>=</span> <span>0</span><span>;</span> index <span>&lt;</span> count<span>;</span> index<span>++</span><span>)</span> <span>{</span>\n    arr<span>.</span><span>push</span><span>(</span>value<span>)</span>\n  <span>}</span>\n  <span>return</span> arr\n<span>}</span>\n<span>const</span> arr3 <span>=</span> <span><span>createArray2</span><span><span>&lt;</span><span>number</span><span>></span></span></span><span>(</span><span>11</span><span>,</span> <span>3</span><span>)</span>\n<span>console</span><span>.</span><span>log</span><span>(</span>arr3<span>[</span><span>0</span><span>]</span><span>.</span><span>toFixed</span><span>(</span><span>)</span><span>)</span>\n<span>// console.log(arr3[0].split('')) // error</span>\n<span>const</span> arr4 <span>=</span> <span><span>createArray2</span><span><span>&lt;</span><span>string</span><span>></span></span></span><span>(</span><span>'aa'</span><span>,</span> <span>3</span><span>)</span>\n<span>console</span><span>.</span><span>log</span><span>(</span>arr4<span>[</span><span>0</span><span>]</span><span>.</span><span>split</span><span>(</span><span>''</span><span>)</span><span>)</span>\n<span>// console.log(arr4[0].toFixed()) // error</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"多个泛型参数的函数\" tabindex=\"-1\"> 多个泛型参数的函数</h2>\n<p>一个函数可以定义多个泛型参数</p>\n<div><pre><code><span>function</span> <span><span>swap</span> <span><span>&lt;</span><span>K</span><span>,</span> <span>V</span><span>></span></span></span> <span>(</span>a<span>:</span> <span>K</span><span>,</span> b<span>:</span> <span>V</span><span>)</span><span>:</span> <span>[</span><span>K</span><span>,</span> <span>V</span><span>]</span> <span>{</span>\n  <span>return</span> <span>[</span>a<span>,</span> b<span>]</span>\n<span>}</span>\n<span>const</span> result <span>=</span> <span><span>swap</span><span><span>&lt;</span><span>string</span><span>,</span> <span>number</span><span>></span></span></span><span>(</span><span>'abc'</span><span>,</span> <span>123</span><span>)</span>\n<span>console</span><span>.</span><span>log</span><span>(</span>result<span>[</span><span>0</span><span>]</span><span>.</span>length<span>,</span> result<span>[</span><span>1</span><span>]</span><span>.</span><span>toFixed</span><span>(</span><span>)</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"泛型接口\" tabindex=\"-1\"> 泛型接口</h2>\n<p>在定义接口时, 为接口中的属性或方法定义泛型类型<br>\n在使用接口时, 再指定具体的泛型类型</p>\n<div><pre><code><span>interface</span> <span>IbaseCRUD <span>&lt;</span><span>T</span><span>></span></span> <span>{</span>\n  data<span>:</span> <span>T</span><span>[</span><span>]</span>\n  <span>add</span><span>:</span> <span>(</span>t<span>:</span> <span>T</span><span>)</span> <span>=></span> <span>void</span>\n  <span>getById</span><span>:</span> <span>(</span>id<span>:</span> <span>number</span><span>)</span> <span>=></span> <span>T</span>\n<span>}</span>\n\n<span>class</span> <span>User</span> <span>{</span>\n  id<span>?</span><span>:</span> <span>number</span><span>;</span> <span>//id主键自增</span>\n  name<span>:</span> <span>string</span><span>;</span> <span>//姓名</span>\n  age<span>:</span> <span>number</span><span>;</span> <span>//年龄</span>\n\n  <span>constructor</span> <span>(</span>name<span>,</span> age<span>)</span> <span>{</span>\n    <span>this</span><span>.</span>name <span>=</span> name\n    <span>this</span><span>.</span>age <span>=</span> age\n  <span>}</span>\n<span>}</span>\n\n<span>class</span> <span>UserCRUD</span> <span>implements</span> <span>IbaseCRUD <span>&lt;</span>User<span>></span></span> <span>{</span>\n  data<span>:</span> User<span>[</span><span>]</span> <span>=</span> <span>[</span><span>]</span>\n  \n  <span>add</span><span>(</span>user<span>:</span> User<span>)</span><span>:</span> <span>void</span> <span>{</span>\n    user <span>=</span> <span>{</span><span>...</span>user<span>,</span> id<span>:</span> Date<span>.</span><span>now</span><span>(</span><span>)</span><span>}</span>\n    <span>this</span><span>.</span>data<span>.</span><span>push</span><span>(</span>user<span>)</span>\n    <span>console</span><span>.</span><span>log</span><span>(</span><span>'保存user'</span><span>,</span> user<span>.</span>id<span>)</span>\n  <span>}</span>\n\n  <span>getById</span><span>(</span>id<span>:</span> <span>number</span><span>)</span><span>:</span> User <span>{</span>\n    <span>return</span> <span>this</span><span>.</span>data<span>.</span><span>find</span><span>(</span>item <span>=></span> item<span>.</span>id<span>===</span>id<span>)</span>\n  <span>}</span>\n<span>}</span>\n\n\n<span>const</span> userCRUD <span>=</span> <span>new</span> <span>UserCRUD</span><span>(</span><span>)</span>\nuserCRUD<span>.</span><span>add</span><span>(</span><span>new</span> <span>User</span><span>(</span><span>'tom'</span><span>,</span> <span>12</span><span>)</span><span>)</span>\nuserCRUD<span>.</span><span>add</span><span>(</span><span>new</span> <span>User</span><span>(</span><span>'tom2'</span><span>,</span> <span>13</span><span>)</span><span>)</span>\n<span>console</span><span>.</span><span>log</span><span>(</span>userCRUD<span>.</span>data<span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"泛型类\" tabindex=\"-1\"> 泛型类</h2>\n<p>在定义类时, 为类中的属性或方法定义泛型类型\n在创建类的实例时, 再指定特定的泛型类型</p>\n<div><pre><code><span>class</span> <span>GenericNumber<span>&lt;</span><span>T</span><span>></span></span> <span>{</span>\n  zeroValue<span>:</span> <span>T</span>\n  <span>add</span><span>:</span> <span>(</span>x<span>:</span> <span>T</span><span>,</span> y<span>:</span> <span>T</span><span>)</span> <span>=></span> <span>T</span>\n<span>}</span>\n\n<span>let</span> myGenericNumber <span>=</span> <span>new</span> <span>GenericNumber<span>&lt;</span><span>number</span><span>></span></span><span>(</span><span>)</span>\nmyGenericNumber<span>.</span>zeroValue <span>=</span> <span>0</span>\nmyGenericNumber<span>.</span><span>add</span> <span>=</span> <span>function</span><span>(</span>x<span>,</span> y<span>)</span> <span>{</span>\n  <span>return</span> x <span>+</span> y \n<span>}</span>\n\n<span>let</span> myGenericString <span>=</span> <span>new</span> <span>GenericNumber<span>&lt;</span><span>string</span><span>></span></span><span>(</span><span>)</span>\nmyGenericString<span>.</span>zeroValue <span>=</span> <span>'abc'</span>\nmyGenericString<span>.</span><span>add</span> <span>=</span> <span>function</span><span>(</span>x<span>,</span> y<span>)</span> <span>{</span> \n  <span>return</span> x <span>+</span> y\n<span>}</span>\n\n<span>console</span><span>.</span><span>log</span><span>(</span>myGenericString<span>.</span><span>add</span><span>(</span>myGenericString<span>.</span>zeroValue<span>,</span> <span>'test'</span><span>)</span><span>)</span>\n<span>console</span><span>.</span><span>log</span><span>(</span>myGenericNumber<span>.</span><span>add</span><span>(</span>myGenericNumber<span>.</span>zeroValue<span>,</span> <span>12</span><span>)</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"泛型约束\" tabindex=\"-1\"> 泛型约束</h2>\n<p>如果我们直接对一个泛型参数取 <code>length</code> 属性, 会报错, 因为这个泛型根本就不知道它有这个属性</p>\n<div><pre><code><span>// 没有泛型约束</span>\n<span>function</span> <span><span>fn</span> <span><span>&lt;</span><span>T</span><span>></span></span></span><span>(</span>x<span>:</span> <span>T</span><span>)</span><span>:</span> <span>void</span> <span>{</span>\n  <span>// console.log(x.length)  // error</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>我们可以使用泛型约束来实现</p>\n<div><pre><code><span>interface</span> <span>Lengthwise</span> <span>{</span>\n  length<span>:</span> <span>number</span><span>;</span>\n<span>}</span>\n\n<span>// 指定泛型约束</span>\n<span>function</span> <span><span>fn2</span> <span><span>&lt;</span><span>T</span> <span>extends</span> Lengthwise<span>></span></span></span><span>(</span>x<span>:</span> <span>T</span><span>)</span><span>:</span> <span>void</span> <span>{</span>\n  <span>console</span><span>.</span><span>log</span><span>(</span>x<span>.</span>length<span>)</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>我们需要传入符合约束类型的值，必须包含必须 <code>length</code> 属性：</p>\n<div><pre><code><span>fn2</span><span>(</span><span>'abc'</span><span>)</span>\n<span>// fn2(123) // error  number没有length属性</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div>",
      "date_published": "2022-07-26T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "声明",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter2/6_other.html",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter2/6_other.html",
      "content_html": "<h1 id=\"_6-其它\" tabindex=\"-1\"> 6. 其它</h1>\n<h2 id=\"声明文件\" tabindex=\"-1\"> 声明文件</h2>\n<p>当使用第三方库时，我们需要引用它的声明文件，才能获得对应的代码补全、接口提示等功能</p>\n<p>什么是声明语句</p>\n<p>假如我们想使用第三方库 jQuery，一种常见的方式是在 html 中通过 <code>&lt;script&gt;</code> 标签引入 <code>jQuery</code>，然后就可以使用全局变量 <code>$</code> 或 <code>jQuery</code> 了。</p>\n<p>但是在 ts 中，编译器并不知道 $ 或 jQuery 是什么东西</p>\n<div><pre><code><span>/* \n当使用第三方库时，我们需要引用它的声明文件，才能获得对应的代码补全、接口提示等功能。\n声明语句: 如果需要ts对新的语法进行检查, 需要要加载了对应的类型说明代码\n  declare var jQuery: (selector: string) => any;\n声明文件: 把声明语句放到一个单独的文件（jQuery.d.ts）中, ts会自动解析到项目中所有声明文件\n下载声明文件: npm install @types/jquery --save-dev\n*/</span>\n\n<span>jQuery</span><span>(</span><span>'#foo'</span><span>)</span><span>;</span>\n<span>// ERROR: Cannot find name 'jQuery'.</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>这时，我们需要使用 declare var 来定义它的类型</p>\n<div><pre><code><span>declare</span> <span>var</span> <span>jQuery</span><span>:</span> <span>(</span>selector<span>:</span> <span>string</span><span>)</span> <span>=></span> <span>any</span><span>;</span>\n\n<span>jQuery</span><span>(</span><span>'#foo'</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>declare var 并没有真的定义一个变量，只是定义了全局变量 jQuery 的类型，仅仅会用于编译时的检查，在编译结果中会被删除。它编译结果是：</p>\n<div><pre><code><span>jQuery</span><span>(</span><span>'#foo'</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>一般声明文件都会单独写成一个 <code>xxx.d.ts</code> 文件</p>\n<p>创建 <code>01_jQuery.d.ts</code>, 将声明语句定义其中, TS编译器会扫描并加载项目中所有的TS声明文件</p>\n<div><pre><code><span>declare</span> <span>var</span> <span>jQuery</span><span>:</span> <span>(</span>selector<span>:</span> <span>string</span><span>)</span> <span>=></span> <span>any</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>很多的第三方库都定义了对应的声明文件库, 库文件名一般为 <code>@types/xxx</code>, 可以在 <code>https://www.npmjs.com/package/package</code> 进行搜索</p>\n<p>有的第三库在下载时就会自动下载对应的声明文件库(比如: webpack),有的可能需要单独下载(比如jQuery/react)</p>\n<h2 id=\"内置对象\" tabindex=\"-1\"> 内置对象</h2>\n<p>JavaScript 中有很多内置对象，它们可以直接在 TypeScript 中当做定义好了的类型。</p>\n<p>内置对象是指根据标准在全局作用域（Global）上存在的对象。这里的标准是指 ECMAScript 和其他环境（比如 DOM）的标准。</p>\n<ol>\n<li>ECMAScript 的内置对象</li>\n</ol>\n<blockquote>\n<p>Boolean<br>\nNumber<br>\nString<br>\nDate<br>\nRegExp<br>\nError</p>\n</blockquote>\n<div><pre><code><span>/* 1. ECMAScript 的内置对象 */</span>\n<span>let</span> b<span>:</span> Boolean <span>=</span> <span>new</span> <span>Boolean</span><span>(</span><span>1</span><span>)</span>\n<span>let</span> n<span>:</span> Number <span>=</span> <span>new</span> <span>Number</span><span>(</span><span>true</span><span>)</span>\n<span>let</span> s<span>:</span> String <span>=</span> <span>new</span> <span>String</span><span>(</span><span>'abc'</span><span>)</span>\n<span>let</span> d<span>:</span> Date <span>=</span> <span>new</span> <span>Date</span><span>(</span><span>)</span>\n<span>let</span> r<span>:</span> RegExp <span>=</span> <span><span>/</span><span>^1</span><span>/</span></span>\n<span>let</span> e<span>:</span> Error <span>=</span> <span>new</span> <span>Error</span><span>(</span><span>'error message'</span><span>)</span>\nb <span>=</span> <span>true</span>\n<span>// let bb: boolean = new Boolean(2)  // error</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><ol start=\"2\">\n<li>BOM 和 DOM 的内置对象</li>\n</ol>\n<blockquote>\n<p>Window<br>\nDocument<br>\nHTMLElement<br>\nDocumentFragment<br>\nEvent<br>\nNodeList</p>\n</blockquote>\n<div><pre><code><span>const</span> div<span>:</span> HTMLElement <span>=</span> document<span>.</span><span>getElementById</span><span>(</span><span>'test'</span><span>)</span>\n<span>const</span> divs<span>:</span> NodeList <span>=</span> document<span>.</span><span>querySelectorAll</span><span>(</span><span>'div'</span><span>)</span>\ndocument<span>.</span><span>addEventListener</span><span>(</span><span>'click'</span><span>,</span> <span>(</span>event<span>:</span> MouseEvent<span>)</span> <span>=></span> <span>{</span>\n  <span>console</span><span>.</span><span>dir</span><span>(</span>event<span>.</span>target<span>)</span>\n<span>}</span><span>)</span>\n<span>const</span> fragment<span>:</span> DocumentFragment <span>=</span> document<span>.</span><span>createDocumentFragment</span><span>(</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "date_published": "2022-07-27T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "2.TypeScript 常用语法",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter2/",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter2/",
      "summary": "TypeScript 常用语法",
      "content_html": "<p align=\"center\"> \n  <img src=\"https://metrics.lecoq.io/xlc520?template=classic&isocalendar=1&languages=1&people=1&activity=1&achievements=1&lines=1&repositories=1&notable=1&introduction=1&pagespeed=1&repositories=100&repositories.batch=100&repositories.forks=false&repositories.affiliations=owner&isocalendar.duration=full-year&languages.limit=8&languages.threshold=0%&languages.colors=github&languages.sections=most-used&languages.indepth=false&languages.analysis.timeout=15&languages.categories=markup%2C programming&languages.recent.categories=markup%2C programming&languages.recent.load=300&languages.recent.days=14&people.limit=24&people.identicons=false&people.identicons.hide=false&people.size=28&people.types=followers%2C following&people.shuffle=false&activity.limit=5&activity.load=300&activity.days=14&activity.visibility=all&activity.timestamps=false&activity.filter=all&achievements.threshold=C&achievements.secrets=true&achievements.display=detailed&achievements.limit=0&notable.from=organization&notable.repositories=false&notable.indepth=false&notable.types=commit&repositories.featured= xlc520%2Fxlc520.github.io&introduction.title=true&pagespeed.url=xlc520.github.io&pagespeed.detailed=false&pagespeed.screenshot=false&config.timezone=Asia%2FShanghai\" /> \n</p>\n<p align=\"center\"> \n  您是第  <img src=\"https://profile-counter.glitch.me/xlc520/count.svg\" />  位访问者\n</p>",
      "date_published": "2022-07-17T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "认识Vue3",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter3/01_%E8%AE%A4%E8%AF%86Vue3.html",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter3/01_%E8%AE%A4%E8%AF%86Vue3.html",
      "content_html": "<h1 id=\"_1-认识vue3\" tabindex=\"-1\"> 1. 认识Vue3</h1>\n<h2 id=\"_1-了解相关信息\" tabindex=\"-1\"> 1) 了解相关信息</h2>\n<ul>\n<li>Vue.js 3.0 &quot;One Piece&quot; 正式版在今年9月份发布</li>\n<li>2年多开发, 100+位贡献者, 2600+次提交, 600+次PR</li>\n<li><strong>Vue3支持vue2的大多数特性</strong></li>\n<li><strong>更好的支持Typescript</strong></li>\n</ul>\n<h2 id=\"_2-性能提升\" tabindex=\"-1\"> 2) 性能提升:</h2>\n<ul>\n<li>打包大小减少41%</li>\n<li>初次渲染快55%, 更新渲染快133%</li>\n<li>内存减少54%</li>\n<li><strong>使用Proxy代替defineProperty实现数据响应式</strong></li>\n<li><strong>重写虚拟DOM的实现和Tree-Shaking</strong></li>\n</ul>\n<h2 id=\"_3-新增特性\" tabindex=\"-1\"> 3) 新增特性</h2>\n<ul>\n<li>\n<p><strong>Composition (组合) API</strong></p>\n</li>\n<li>\n<p>setup</p>\n<ul>\n<li>ref 和 reactive</li>\n<li>computed 和 watch</li>\n<li>新的生命周期函数</li>\n<li>provide与inject</li>\n<li>...</li>\n</ul>\n</li>\n<li>\n<p>新组件</p>\n<ul>\n<li>Fragment - 文档碎片</li>\n<li>Teleport - 瞬移组件的位置</li>\n<li>Suspense - 异步加载组件的loading界面</li>\n</ul>\n</li>\n<li>\n<p>其它API更新</p>\n<ul>\n<li>全局API的修改</li>\n<li>将原来的全局API转移到应用对象</li>\n<li>模板语法变化</li>\n</ul>\n</li>\n</ul>\n",
      "date_published": "2022-07-28T00:00:00.000Z",
      "date_modified": "2022-07-13T10:25:31.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "创建vue3项目",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter3/02_%E5%88%9B%E5%BB%BAvue3%E9%A1%B9%E7%9B%AE.html",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter3/02_%E5%88%9B%E5%BB%BAvue3%E9%A1%B9%E7%9B%AE.html",
      "content_html": "<h1 id=\"_2-创建vue3项目\" tabindex=\"-1\"> 2. 创建vue3项目</h1>\n<h2 id=\"_1-使用-vue-cli-创建\" tabindex=\"-1\"> 1) 使用 vue-cli 创建</h2>\n<p>文档: <a href=\"https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create\" target=\"_blank\" rel=\"noopener noreferrer\">https://cli.vuejs.org/zh/guide/creating-a-project.html#vue-create</a></p>\n<div><pre><code><span>## 安装或者升级</span>\n<span>npm</span> <span>install</span> -g @vue/cli\n<span>## 保证 vue cli 版本在 4.5.0 以上</span>\nvue --version\n<span>## 创建项目</span>\nvue create my-project\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>然后的步骤</p>\n<ul>\n<li>Please pick a preset - 选择 <em><strong>Manually select features</strong></em></li>\n<li>Check the features needed for your project - 选择上 <em><strong>TypeScript</strong></em> ，特别注意点空格是选择，点回车是下一步</li>\n<li>Choose a version of Vue.js that you want to start the project with - 选择 <em><strong>3.x (Preview)</strong></em></li>\n<li>Use class-style component syntax - 直接回车</li>\n<li>Use Babel alongside TypeScript - 直接回车</li>\n<li>Pick a linter / formatter config - 直接回车</li>\n<li>Use history mode for router? - 直接回车</li>\n<li>Pick a linter / formatter config - 直接回车</li>\n<li>Pick additional lint features - 直接回车</li>\n<li>Where do you prefer placing config for Babel, ESLint, etc.? - 直接回车</li>\n<li>Save this as a preset for future projects? - 直接回车</li>\n</ul>\n<h2 id=\"_2-使用-vite-创建\" tabindex=\"-1\"> 2) 使用 vite 创建</h2>\n<ul>\n<li>\n<p>文档: <a href=\"https://v3.cn.vuejs.org/guide/installation.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://v3.cn.vuejs.org/guide/installation.html</a></p>\n</li>\n<li>\n<p>vite 是一个由原生 ESM 驱动的 Web 开发构建工具。在开发环境下基于浏览器原生 ES imports 开发，</p>\n</li>\n<li>\n<p>它做到了<em><strong>本地快速开发启动</strong></em>, 在生产环境下基于 Rollup 打包。</p>\n<ul>\n<li>快速的冷启动，不需要等待打包操作；</li>\n<li>即时的热模块更新，替换性能和模块数量的解耦让更新飞起；</li>\n<li>真正的按需编译，不再等待整个应用编译完成，这是一个巨大的改变。</li>\n</ul>\n</li>\n</ul>\n<div><pre><code><span>npm</span> init vite-app <span>&lt;</span>project-name<span>></span>\n<span>cd</span> <span>&lt;</span>project-name<span>></span>\n<span>npm</span> <span>install</span>\n<span>npm</span> run dev\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div>",
      "date_published": "2022-07-29T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "3.Vue3快速上手",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter3/",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter3/",
      "summary": "Vue3快速上手",
      "content_html": "<p align=\"center\"> \n  <img src=\"https://metrics.lecoq.io/xlc520?template=classic&isocalendar=1&languages=1&people=1&activity=1&achievements=1&lines=1&repositories=1&notable=1&introduction=1&pagespeed=1&repositories=100&repositories.batch=100&repositories.forks=false&repositories.affiliations=owner&isocalendar.duration=full-year&languages.limit=8&languages.threshold=0%&languages.colors=github&languages.sections=most-used&languages.indepth=false&languages.analysis.timeout=15&languages.categories=markup%2C programming&languages.recent.categories=markup%2C programming&languages.recent.load=300&languages.recent.days=14&people.limit=24&people.identicons=false&people.identicons.hide=false&people.size=28&people.types=followers%2C following&people.shuffle=false&activity.limit=5&activity.load=300&activity.days=14&activity.visibility=all&activity.timestamps=false&activity.filter=all&achievements.threshold=C&achievements.secrets=true&achievements.display=detailed&achievements.limit=0&notable.from=organization&notable.repositories=false&notable.indepth=false&notable.types=commit&repositories.featured= xlc520%2Fxlc520.github.io&introduction.title=true&pagespeed.url=xlc520.github.io&pagespeed.detailed=false&pagespeed.screenshot=false&config.timezone=Asia%2FShanghai\" /> \n</p>\n<p align=\"center\"> \n  您是第  <img src=\"https://profile-counter.glitch.me/xlc520/count.svg\" />  位访问者\n</p>",
      "date_published": "2022-07-17T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "Composition API",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter4/01_Composition%20API_%E5%B8%B8%E7%94%A8%E9%83%A8%E5%88%86.html",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter4/01_Composition%20API_%E5%B8%B8%E7%94%A8%E9%83%A8%E5%88%86.html",
      "content_html": "<h1 id=\"_1-composition-api-常用部分\" tabindex=\"-1\"> 1. Composition API(常用部分)</h1>\n<p>文档:</p>\n<p>​\t<a href=\"https://composition-api.vuejs.org/zh/api.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://composition-api.vuejs.org/zh/api.html</a></p>\n<h2 id=\"_1-setup\" tabindex=\"-1\"> 1) setup</h2>\n<ul>\n<li>新的option, 所有的组合API函数都在此使用, 只在初始化时执行一次</li>\n<li>函数如果返回对象, 对象中的属性或方法, 模板中可以直接使用</li>\n</ul>\n<h2 id=\"_2-ref\" tabindex=\"-1\"> 2) ref</h2>\n<ul>\n<li>作用: 定义一个数据的响应式</li>\n<li>语法: const xxx = ref(initValue):\n<ul>\n<li>创建一个包含响应式数据的引用(reference)对象</li>\n<li>js中操作数据: xxx.value</li>\n<li>模板中操作数据: 不需要.value</li>\n</ul>\n</li>\n<li>一般用来定义一个基本类型的响应式数据</li>\n</ul>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>{{count}}<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span><span><span>&lt;</span>hr</span><span>></span></span>\n  <span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>update<span>\"</span></span><span>></span></span>更新<span><span><span>&lt;/</span>button</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span><span>></span></span><span><span>\n<span>import</span> <span>{</span>\n  ref\n<span>}</span> <span>from</span> <span>'vue'</span>\n<span>export</span> <span>default</span> <span>{</span>\n\n  <span>/* 在Vue3中依然可以使用data和methods配置, 但建议使用其新语法实现 */</span>\n  <span>// data () {</span>\n  <span>//   return {</span>\n  <span>//     count: 0</span>\n  <span>//   }</span>\n  <span>// },</span>\n  <span>// methods: {</span>\n  <span>//   update () {</span>\n  <span>//     this.count++</span>\n  <span>//   }</span>\n  <span>// }</span>\n\n  <span>/* 使用vue3的composition API */</span>\n  <span>setup</span> <span>(</span><span>)</span> <span>{</span>\n\n    <span>// 定义响应式数据 ref对象</span>\n    <span>const</span> count <span>=</span> <span>ref</span><span>(</span><span>1</span><span>)</span>\n    console<span>.</span><span>log</span><span>(</span>count<span>)</span>\n\n    <span>// 更新响应式数据的函数</span>\n    <span>function</span> <span>update</span> <span>(</span><span>)</span> <span>{</span>\n      <span>// alert('update')</span>\n      count<span>.</span>value <span>=</span> count<span>.</span>value <span>+</span> <span>1</span>\n    <span>}</span>\n\n    <span>return</span> <span>{</span>\n      count<span>,</span>\n      update\n    <span>}</span>\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_3-reactive\" tabindex=\"-1\"> 3) reactive</h2>\n<ul>\n<li>作用: 定义多个数据的响应式</li>\n<li>const proxy = reactive(obj): 接收一个普通对象然后返回该普通对象的响应式代理器对象</li>\n<li>响应式转换是“深层的”：会影响对象内部所有嵌套的属性</li>\n<li>内部基于 ES6 的 Proxy 实现，通过代理对象操作源对象内部数据都是响应式的</li>\n</ul>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>name: {{state.name}}<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>age: {{state.age}}<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>wife: {{state.wife}}<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span><span><span>&lt;</span>hr</span><span>></span></span>\n  <span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>update<span>\"</span></span><span>></span></span>更新<span><span><span>&lt;/</span>button</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span><span>></span></span><span><span>\n<span>/* \nreactive: \n    作用: 定义多个数据的响应式\n    const proxy = reactive(obj): 接收一个普通对象然后返回该普通对象的响应式代理器对象\n    响应式转换是“深层的”：会影响对象内部所有嵌套的属性\n    内部基于 ES6 的 Proxy 实现，通过代理对象操作源对象内部数据都是响应式的\n*/</span>\n<span>import</span> <span>{</span>\n  reactive<span>,</span>\n<span>}</span> <span>from</span> <span>'vue'</span>\n<span>export</span> <span>default</span> <span>{</span>\n  <span>setup</span> <span>(</span><span>)</span> <span>{</span>\n    <span>/* \n    定义响应式数据对象\n    */</span>\n    <span>const</span> state <span>=</span> <span>reactive</span><span>(</span><span>{</span>\n      <span>name</span><span>:</span> <span>'tom'</span><span>,</span>\n      <span>age</span><span>:</span> <span>25</span><span>,</span>\n      <span>wife</span><span>:</span> <span>{</span>\n        <span>name</span><span>:</span> <span>'marry'</span><span>,</span>\n        <span>age</span><span>:</span> <span>22</span>\n      <span>}</span><span>,</span>\n    <span>}</span><span>)</span>\n    console<span>.</span><span>log</span><span>(</span>state<span>,</span> state<span>.</span>wife<span>)</span>\n\n    <span>const</span> <span>update</span> <span>=</span> <span>(</span><span>)</span> <span>=></span> <span>{</span>\n      state<span>.</span>name <span>+=</span> <span>'--'</span>\n      state<span>.</span>age <span>+=</span> <span>1</span>\n      state<span>.</span>wife<span>.</span>name <span>+=</span> <span>'++'</span>\n      state<span>.</span>wife<span>.</span>age <span>+=</span> <span>2</span>\n    <span>}</span>\n\n    <span>return</span> <span>{</span>\n      state<span>,</span>\n      update<span>,</span>\n    <span>}</span>\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_4-比较vue2与vue3的响应式-重要\" tabindex=\"-1\"> 4) 比较Vue2与Vue3的响应式(重要)</h2>\n<h2 id=\"vue2的响应式\" tabindex=\"-1\"> vue2的响应式</h2>\n<ul>\n<li>核心:\n<ul>\n<li>对象: 通过defineProperty对对象的已有属性值的读取和修改进行劫持(监视/拦截)</li>\n<li>数组: 通过重写数组更新数组一系列更新元素的方法来实现元素修改的劫持</li>\n</ul>\n</li>\n</ul>\n<div><pre><code>Object<span>.</span><span>defineProperty</span><span>(</span>data<span>,</span> <span>'count'</span><span>,</span> <span>{</span>\n    <span>get</span> <span>(</span><span>)</span> <span>{</span><span>}</span><span>,</span> \n    <span>set</span> <span>(</span><span>)</span> <span>{</span><span>}</span>\n<span>}</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><ul>\n<li>问题\n<ul>\n<li>对象直接新添加的属性或删除已有属性, 界面不会自动更新</li>\n<li>直接通过下标替换元素或更新length, 界面不会自动更新   arr[1] = {}</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"vue3的响应式\" tabindex=\"-1\"> Vue3的响应式</h2>\n<ul>\n<li>核心:\n<ul>\n<li>通过Proxy(代理):  拦截对data任意属性的任意(13种)操作, 包括属性值的读写, 属性的添加, 属性的删除等...</li>\n<li>通过 Reflect(反射):  动态对被代理对象的相应属性进行特定的操作</li>\n<li>文档:\n<ul>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy\" target=\"_blank\" rel=\"noopener noreferrer\">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy</a></li>\n<li><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect\" target=\"_blank\" rel=\"noopener noreferrer\">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div><pre><code><span>new</span> <span>Proxy</span><span>(</span>data<span>,</span> <span>{</span>\n\t<span>// 拦截读取属性值</span>\n    <span>get</span> <span>(</span>target<span>,</span> prop<span>)</span> <span>{</span>\n    \t<span>return</span> Reflect<span>.</span><span>get</span><span>(</span>target<span>,</span> prop<span>)</span>\n    <span>}</span><span>,</span>\n    <span>// 拦截设置属性值或添加新属性</span>\n    <span>set</span> <span>(</span>target<span>,</span> prop<span>,</span> value<span>)</span> <span>{</span>\n    \t<span>return</span> Reflect<span>.</span><span>set</span><span>(</span>target<span>,</span> prop<span>,</span> value<span>)</span>\n    <span>}</span><span>,</span>\n    <span>// 拦截删除属性</span>\n    <span>deleteProperty</span> <span>(</span><span>target<span>,</span> prop</span><span>)</span> <span>{</span>\n    \t<span>return</span> Reflect<span>.</span><span>deleteProperty</span><span>(</span>target<span>,</span> prop<span>)</span>\n    <span>}</span>\n<span>}</span><span>)</span>\n\nproxy<span>.</span>name <span>=</span> <span>'tom'</span>   \n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span><span>&lt;!</span><span>DOCTYPE</span> <span>html</span><span>></span></span>\n<span><span><span>&lt;</span>html</span> <span>lang</span><span><span>=</span><span>\"</span>en<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;</span>head</span><span>></span></span>\n  <span><span><span>&lt;</span>meta</span> <span>charset</span><span><span>=</span><span>\"</span>UTF-8<span>\"</span></span><span>></span></span>\n  <span><span><span>&lt;</span>meta</span> <span>name</span><span><span>=</span><span>\"</span>viewport<span>\"</span></span> <span>content</span><span><span>=</span><span>\"</span>width=device-width, initial-scale=1.0<span>\"</span></span><span>></span></span>\n  <span><span><span>&lt;</span>title</span><span>></span></span>Proxy 与 Reflect<span><span><span>&lt;/</span>title</span><span>></span></span>\n<span><span><span>&lt;/</span>head</span><span>></span></span>\n<span><span><span>&lt;</span>body</span><span>></span></span>\n  <span><span><span>&lt;</span>script</span><span>></span></span><span><span>\n    \n    <span>const</span> user <span>=</span> <span>{</span>\n      <span>name</span><span>:</span> <span>\"John\"</span><span>,</span>\n      <span>age</span><span>:</span> <span>12</span>\n    <span>}</span><span>;</span>\n\n    <span>/* \n    proxyUser是代理对象, user是被代理对象\n    后面所有的操作都是通过代理对象来操作被代理对象内部属性\n    */</span>\n    <span>const</span> proxyUser <span>=</span> <span>new</span> <span>Proxy</span><span>(</span>user<span>,</span> <span>{</span>\n\n      <span>get</span><span>(</span>target<span>,</span> prop<span>)</span> <span>{</span>\n        console<span>.</span><span>log</span><span>(</span><span>'劫持get()'</span><span>,</span> prop<span>)</span>\n        <span>return</span> Reflect<span>.</span><span>get</span><span>(</span>target<span>,</span> prop<span>)</span>\n      <span>}</span><span>,</span>\n\n      <span>set</span><span>(</span>target<span>,</span> prop<span>,</span> val<span>)</span> <span>{</span>\n        console<span>.</span><span>log</span><span>(</span><span>'劫持set()'</span><span>,</span> prop<span>,</span> val<span>)</span>\n        <span>return</span> Reflect<span>.</span><span>set</span><span>(</span>target<span>,</span> prop<span>,</span> val<span>)</span><span>;</span> <span>// (2)</span>\n      <span>}</span><span>,</span>\n\n      <span>deleteProperty</span> <span>(</span><span>target<span>,</span> prop</span><span>)</span> <span>{</span>\n        console<span>.</span><span>log</span><span>(</span><span>'劫持delete属性'</span><span>,</span> prop<span>)</span>\n        <span>return</span> Reflect<span>.</span><span>deleteProperty</span><span>(</span>target<span>,</span> prop<span>)</span>\n      <span>}</span>\n    <span>}</span><span>)</span><span>;</span>\n    <span>// 读取属性值</span>\n    console<span>.</span><span>log</span><span>(</span>proxyUser<span>===</span>user<span>)</span>\n    console<span>.</span><span>log</span><span>(</span>proxyUser<span>.</span>name<span>,</span> proxyUser<span>.</span>age<span>)</span>\n    <span>// 设置属性值</span>\n    proxyUser<span>.</span>name <span>=</span> <span>'bob'</span>\n    proxyUser<span>.</span>age <span>=</span> <span>13</span>\n    console<span>.</span><span>log</span><span>(</span>user<span>)</span>\n    <span>// 添加属性</span>\n    proxyUser<span>.</span>sex <span>=</span> <span>'男'</span>\n    console<span>.</span><span>log</span><span>(</span>user<span>)</span>\n    <span>// 删除属性</span>\n    <span>delete</span> proxyUser<span>.</span>sex\n    console<span>.</span><span>log</span><span>(</span>user<span>)</span>\n  </span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n<span><span><span>&lt;/</span>body</span><span>></span></span>\n<span><span><span>&lt;/</span>html</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_5-setup细节\" tabindex=\"-1\"> 5) setup细节</h2>\n<ul>\n<li>\n<p>setup执行的时机</p>\n<ul>\n<li>在beforeCreate之前执行(一次), 此时组件对象还没有创建</li>\n<li>this是undefined, 不能通过this来访问data/computed/methods / props</li>\n<li>其实所有的composition API相关回调函数中也都不可以</li>\n</ul>\n</li>\n<li>\n<p>setup的返回值</p>\n<ul>\n<li>一般都返回一个对象: 为模板提供数据, 也就是模板中可以直接使用此对象中的所有属性/方法</li>\n<li>返回对象中的属性会与data函数返回对象的属性合并成为组件对象的属性</li>\n<li>返回对象中的方法会与methods中的方法合并成功组件对象的方法</li>\n<li>如果有重名, setup优先</li>\n<li>注意:</li>\n<li>一般不要混合使用: methods中可以访问setup提供的属性和方法, 但在setup方法中不能访问data和methods</li>\n<li>setup不能是一个async函数: 因为返回值不再是return的对象, 而是promise, 模板看不到return对象中的属性数据</li>\n</ul>\n</li>\n<li>\n<p>setup的参数</p>\n<ul>\n<li>setup(props, context) / setup(props, {attrs, slots, emit})</li>\n<li>props: 包含props配置声明且传入了的所有属性的对象</li>\n<li>attrs: 包含没有在props配置中声明的属性的对象, 相当于 this.$attrs</li>\n<li>slots: 包含所有传入的插槽内容的对象, 相当于 this.$slots</li>\n<li>emit: 用来分发自定义事件的函数, 相当于 this.$emit</li>\n</ul>\n</li>\n</ul>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>App<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span><span><span>&lt;</span>p</span><span>></span></span>msg: {{msg}}<span><span><span>&lt;/</span>p</span><span>></span></span>\n  <span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>fn(<span>'</span>--<span>'</span>)<span>\"</span></span><span>></span></span>更新<span><span><span>&lt;/</span>button</span><span>></span></span>\n\n  <span><span><span>&lt;</span>child</span> <span>:msg</span><span><span>=</span><span>\"</span>msg<span>\"</span></span> <span>msg2</span><span><span>=</span><span>\"</span>cba<span>\"</span></span> <span>@fn</span><span><span>=</span><span>\"</span>fn<span>\"</span></span><span>/></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>import</span> <span>{</span>\n  reactive<span>,</span>\n  ref<span>,</span>\n<span>}</span> <span>from</span> <span>'vue'</span>\n<span>import</span> child <span>from</span> <span>'./child.vue'</span>\n\n<span>export</span> <span>default</span> <span>{</span>\n\n  <span>components</span><span>:</span> <span>{</span>\n    child\n  <span>}</span><span>,</span>\n\n  <span>setup</span> <span>(</span><span>)</span> <span>{</span>\n    <span>const</span> msg <span>=</span> <span>ref</span><span>(</span><span>'abc'</span><span>)</span>\n\n    <span>function</span> <span>fn</span> <span>(</span><span><span>content</span><span>:</span> string</span><span>)</span> <span>{</span>\n      msg<span>.</span>value <span>+=</span> content\n    <span>}</span>\n    <span>return</span> <span>{</span>\n      msg<span>,</span>\n      fn\n    <span>}</span>\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>div</span><span>></span></span>\n    <span><span><span>&lt;</span>h3</span><span>></span></span>{{n}}<span><span><span>&lt;/</span>h3</span><span>></span></span>\n    <span><span><span>&lt;</span>h3</span><span>></span></span>{{m}}<span><span><span>&lt;/</span>h3</span><span>></span></span>\n\n    <span><span><span>&lt;</span>h3</span><span>></span></span>msg: {{msg}}<span><span><span>&lt;/</span>h3</span><span>></span></span>\n    <span><span><span>&lt;</span>h3</span><span>></span></span>msg2: {{$attrs.msg2}}<span><span><span>&lt;/</span>h3</span><span>></span></span>\n\n    <span><span><span>&lt;</span>slot</span> <span>name</span><span><span>=</span><span>\"</span>xxx<span>\"</span></span><span>></span></span><span><span><span>&lt;/</span>slot</span><span>></span></span>\n\n    <span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>update<span>\"</span></span><span>></span></span>更新<span><span><span>&lt;/</span>button</span><span>></span></span>\n  <span><span><span>&lt;/</span>div</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n\n<span>import</span> <span>{</span>\n  ref<span>,</span>\n  defineComponent\n<span>}</span> <span>from</span> <span>'vue'</span>\n\n<span>export</span> <span>default</span> <span>defineComponent</span><span>(</span><span>{</span>\n  <span>name</span><span>:</span> <span>'child'</span><span>,</span>\n\n  <span>props</span><span>:</span> <span>[</span><span>'msg'</span><span>]</span><span>,</span>\n\n  <span>emits</span><span>:</span> <span>[</span><span>'fn'</span><span>]</span><span>,</span> <span>// 可选的, 声明了更利于程序员阅读, 且可以对分发的事件数据进行校验</span>\n\n  <span>data</span> <span>(</span><span>)</span> <span>{</span>\n    console<span>.</span><span>log</span><span>(</span><span>'data'</span><span>,</span> <span>this</span><span>)</span>\n    <span>return</span> <span>{</span>\n      <span>// n: 1</span>\n    <span>}</span>\n  <span>}</span><span>,</span>\n\n  <span>beforeCreate</span> <span>(</span><span>)</span> <span>{</span>\n    console<span>.</span><span>log</span><span>(</span><span>'beforeCreate'</span><span>,</span> <span>this</span><span>)</span>\n  <span>}</span><span>,</span>\n\n  <span>methods</span><span>:</span> <span>{</span>\n    <span>// update () {</span>\n    <span>//   this.n++</span>\n    <span>//   this.m++</span>\n    <span>// }</span>\n  <span>}</span><span>,</span>\n\n  <span>// setup (props, context) {</span>\n  <span>setup</span> <span>(</span><span>props<span>,</span> <span>{</span>attrs<span>,</span> emit<span>,</span> slots<span>}</span></span><span>)</span> <span>{</span>\n\n    console<span>.</span><span>log</span><span>(</span><span>'setup'</span><span>,</span> <span>this</span><span>)</span>\n    console<span>.</span><span>log</span><span>(</span>props<span>.</span>msg<span>,</span> attrs<span>.</span>msg2<span>,</span> slots<span>,</span> emit<span>)</span>\n\n    <span>const</span> m <span>=</span> <span>ref</span><span>(</span><span>2</span><span>)</span>\n    <span>const</span> n <span>=</span> <span>ref</span><span>(</span><span>3</span><span>)</span>\n\n    <span>function</span> <span>update</span> <span>(</span><span>)</span> <span>{</span>\n      <span>// console.log('--', this)</span>\n      <span>// this.n += 2 </span>\n      <span>// this.m += 2</span>\n\n      m<span>.</span>value <span>+=</span> <span>2</span>\n      n<span>.</span>value <span>+=</span> <span>2</span>\n\n      <span>// 分发自定义事件</span>\n      <span>emit</span><span>(</span><span>'fn'</span><span>,</span> <span>'++'</span><span>)</span>\n    <span>}</span>\n\n    <span>return</span> <span>{</span>\n      m<span>,</span>\n      n<span>,</span>\n      update<span>,</span>\n    <span>}</span>\n  <span>}</span><span>,</span>\n<span>}</span><span>)</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_6-reactive与ref-细节\" tabindex=\"-1\"> 6) reactive与ref-细节</h2>\n<ul>\n<li>是Vue3的 composition API中2个最重要的响应式API</li>\n<li>ref用来处理基本类型数据, reactive用来处理对象(递归深度响应式)</li>\n<li>如果用ref对象/数组, 内部会自动将对象/数组转换为reactive的代理对象</li>\n<li>ref内部: 通过给value属性添加getter/setter来实现对数据的劫持</li>\n<li>reactive内部: 通过使用Proxy来实现对对象内部所有数据的劫持, 并通过Reflect操作对象内部数据</li>\n<li>ref的数据操作: 在js中要.value, 在模板中不需要(内部解析模板时会自动添加.value)</li>\n</ul>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>App<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span><span><span>&lt;</span>p</span><span>></span></span>m1: {{m1}}<span><span><span>&lt;/</span>p</span><span>></span></span>\n  <span><span><span>&lt;</span>p</span><span>></span></span>m2: {{m2}}<span><span><span>&lt;/</span>p</span><span>></span></span>\n  <span><span><span>&lt;</span>p</span><span>></span></span>m3: {{m3}}<span><span><span>&lt;/</span>p</span><span>></span></span>\n  <span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>update<span>\"</span></span><span>></span></span>更新<span><span><span>&lt;/</span>button</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>import</span> <span>{</span>\n  reactive<span>,</span>\n  ref\n<span>}</span> <span>from</span> <span>'vue'</span>\n\n<span>export</span> <span>default</span> <span>{</span>\n\n  <span>setup</span> <span>(</span><span>)</span> <span>{</span>\n    <span>const</span> m1 <span>=</span> <span>ref</span><span>(</span><span>'abc'</span><span>)</span>\n    <span>const</span> m2 <span>=</span> <span>reactive</span><span>(</span><span>{</span><span>x</span><span>:</span> <span>1</span><span>,</span> <span>y</span><span>:</span> <span>{</span><span>z</span><span>:</span> <span>'abc'</span><span>}</span><span>}</span><span>)</span>\n\n    <span>// 使用ref处理对象  ==> 对象会被自动reactive为proxy对象</span>\n    <span>const</span> m3 <span>=</span> <span>ref</span><span>(</span><span>{</span><span>a1</span><span>:</span> <span>2</span><span>,</span> <span>a2</span><span>:</span> <span>{</span><span>a3</span><span>:</span> <span>'abc'</span><span>}</span><span>}</span><span>)</span>\n    console<span>.</span><span>log</span><span>(</span>m1<span>,</span> m2<span>,</span> m3<span>)</span>\n    console<span>.</span><span>log</span><span>(</span>m3<span>.</span>value<span>.</span>a2<span>)</span> <span>// 也是一个proxy对象</span>\n\n    <span>function</span> <span>update</span><span>(</span><span>)</span> <span>{</span>\n      m1<span>.</span>value <span>+=</span> <span>'--'</span>\n      m2<span>.</span>x <span>+=</span> <span>1</span>\n      m2<span>.</span>y<span>.</span>z <span>+=</span> <span>'++'</span>\n\n      m3<span>.</span>value <span>=</span> <span>{</span><span>a1</span><span>:</span> <span>3</span><span>,</span> <span>a2</span><span>:</span> <span>{</span><span>a3</span><span>:</span> <span>'abc---'</span><span>}</span><span>}</span>\n      m3<span>.</span>value<span>.</span>a2<span>.</span>a3 <span>+=</span> <span>'=='</span> <span>// reactive对对象进行了深度数据劫持</span>\n      console<span>.</span><span>log</span><span>(</span>m3<span>.</span>value<span>.</span>a2<span>)</span>\n    <span>}</span>\n\n    <span>return</span> <span>{</span>\n      m1<span>,</span>\n      m2<span>,</span>\n      m3<span>,</span>\n      update\n    <span>}</span>\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_7-计算属性与监视\" tabindex=\"-1\"> 7) 计算属性与监视</h2>\n<ul>\n<li>\n<p>computed函数:</p>\n<ul>\n<li>与computed配置功能一致</li>\n<li>只有getter</li>\n<li>有getter和setter</li>\n</ul>\n</li>\n<li>\n<p>watch函数</p>\n<ul>\n<li>与watch配置功能一致</li>\n<li>监视指定的一个或多个响应式数据, 一旦数据变化, 就自动执行监视回调</li>\n<li>默认初始时不执行回调, 但可以通过配置immediate为true, 来指定初始时立即执行第一次</li>\n<li>通过配置deep为true, 来指定深度监视</li>\n</ul>\n</li>\n<li>\n<p>watchEffect函数</p>\n<ul>\n<li>不用直接指定要监视的数据, 回调函数中使用的哪些响应式数据就监视哪些响应式数据</li>\n<li>默认初始时就会执行第一次, 从而可以收集需要监视的数据</li>\n<li>监视数据发生变化时回调</li>\n</ul>\n</li>\n</ul>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>App<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  fistName: <span><span><span>&lt;</span>input</span> <span>v-model</span><span><span>=</span><span>\"</span>user.firstName<span>\"</span></span><span>/></span></span><span><span><span>&lt;</span>br</span><span>></span></span>\n  lastName: <span><span><span>&lt;</span>input</span> <span>v-model</span><span><span>=</span><span>\"</span>user.lastName<span>\"</span></span><span>/></span></span><span><span><span>&lt;</span>br</span><span>></span></span>\n  fullName1: <span><span><span>&lt;</span>input</span> <span>v-model</span><span><span>=</span><span>\"</span>fullName1<span>\"</span></span><span>/></span></span><span><span><span>&lt;</span>br</span><span>></span></span>\n  fullName2: <span><span><span>&lt;</span>input</span> <span>v-model</span><span><span>=</span><span>\"</span>fullName2<span>\"</span></span><span>></span></span><span><span><span>&lt;</span>br</span><span>></span></span>\n  fullName3: <span><span><span>&lt;</span>input</span> <span>v-model</span><span><span>=</span><span>\"</span>fullName3<span>\"</span></span><span>></span></span><span><span><span>&lt;</span>br</span><span>></span></span>\n\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>/*\n计算属性与监视\n1. computed函数: \n  与computed配置功能一致\n  只有getter\n  有getter和setter\n2. watch函数\n  与watch配置功能一致\n  监视指定的一个或多个响应式数据, 一旦数据变化, 就自动执行监视回调\n  默认初始时不执行回调, 但可以通过配置immediate为true, 来指定初始时立即执行第一次\n  通过配置deep为true, 来指定深度监视\n3. watchEffect函数\n  不用直接指定要监视的数据, 回调函数中使用的哪些响应式数据就监视哪些响应式数据\n  默认初始时就会执行第一次, 从而可以收集需要监视的数据\n  监视数据发生变化时回调\n*/</span>\n\n<span>import</span> <span>{</span>\n  reactive<span>,</span>\n  ref<span>,</span>\n  computed<span>,</span>\n  watch<span>,</span>\n  watchEffect\n<span>}</span> <span>from</span> <span>'vue'</span>\n\n<span>export</span> <span>default</span> <span>{</span>\n\n  <span>setup</span> <span>(</span><span>)</span> <span>{</span>\n    <span>const</span> user <span>=</span> <span>reactive</span><span>(</span><span>{</span>\n      <span>firstName</span><span>:</span> <span>'A'</span><span>,</span>\n      <span>lastName</span><span>:</span> <span>'B'</span>\n    <span>}</span><span>)</span>\n\n    <span>// 只有getter的计算属性</span>\n    <span>const</span> fullName1 <span>=</span> <span>computed</span><span>(</span><span>(</span><span>)</span> <span>=></span> <span>{</span>\n      console<span>.</span><span>log</span><span>(</span><span>'fullName1'</span><span>)</span>\n      <span>return</span> user<span>.</span>firstName <span>+</span> <span>'-'</span> <span>+</span> user<span>.</span>lastName\n    <span>}</span><span>)</span>\n\n    <span>// 有getter与setter的计算属性</span>\n    <span>const</span> fullName2 <span>=</span> <span>computed</span><span>(</span><span>{</span>\n      <span>get</span> <span>(</span><span>)</span> <span>{</span>\n        console<span>.</span><span>log</span><span>(</span><span>'fullName2 get'</span><span>)</span>\n        <span>return</span> user<span>.</span>firstName <span>+</span> <span>'-'</span> <span>+</span> user<span>.</span>lastName\n      <span>}</span><span>,</span>\n\n      <span>set</span> <span>(</span>value<span>:</span> string<span>)</span> <span>{</span>\n        console<span>.</span><span>log</span><span>(</span><span>'fullName2 set'</span><span>)</span>\n        <span>const</span> names <span>=</span> value<span>.</span><span>split</span><span>(</span><span>'-'</span><span>)</span>\n        user<span>.</span>firstName <span>=</span> names<span>[</span><span>0</span><span>]</span>\n        user<span>.</span>lastName <span>=</span> names<span>[</span><span>1</span><span>]</span>\n      <span>}</span>\n    <span>}</span><span>)</span>\n\n    <span>const</span> fullName3 <span>=</span> <span>ref</span><span>(</span><span>''</span><span>)</span>\n\n    <span>/* \n    watchEffect: 监视所有回调中使用的数据\n    */</span>\n    <span>/* \n    watchEffect(() => {\n      console.log('watchEffect')\n      fullName3.value = user.firstName + '-' + user.lastName\n    }) \n    */</span>\n\n    <span>/* \n    使用watch的2个特性:\n      深度监视\n      初始化立即执行\n    */</span>\n    <span>watch</span><span>(</span>user<span>,</span> <span>(</span><span>)</span> <span>=></span> <span>{</span>\n      fullName3<span>.</span>value <span>=</span> user<span>.</span>firstName <span>+</span> <span>'-'</span> <span>+</span> user<span>.</span>lastName\n    <span>}</span><span>,</span> <span>{</span>\n      <span>immediate</span><span>:</span> <span>true</span><span>,</span>  <span>// 是否初始化立即执行一次, 默认是false</span>\n      <span>deep</span><span>:</span> <span>true</span><span>,</span> <span>// 是否是深度监视, 默认是false</span>\n    <span>}</span><span>)</span>\n\n    <span>/* \n    watch一个数据\n      默认在数据发生改变时执行回调\n    */</span>\n    <span>watch</span><span>(</span>fullName3<span>,</span> <span>(</span><span>value</span><span>)</span> <span>=></span> <span>{</span>\n      console<span>.</span><span>log</span><span>(</span><span>'watch'</span><span>)</span>\n      <span>const</span> names <span>=</span> value<span>.</span><span>split</span><span>(</span><span>'-'</span><span>)</span>\n      user<span>.</span>firstName <span>=</span> names<span>[</span><span>0</span><span>]</span>\n      user<span>.</span>lastName <span>=</span> names<span>[</span><span>1</span><span>]</span>\n    <span>}</span><span>)</span>\n\n    <span>/* \n    watch多个数据: \n      使用数组来指定\n      如果是ref对象, 直接指定\n      如果是reactive对象中的属性,  必须通过函数来指定\n    */</span>\n    <span>watch</span><span>(</span><span>[</span><span>(</span><span>)</span> <span>=></span> user<span>.</span>firstName<span>,</span> <span>(</span><span>)</span> <span>=></span> user<span>.</span>lastName<span>,</span> fullName3<span>]</span><span>,</span> <span>(</span><span>values</span><span>)</span> <span>=></span> <span>{</span>\n      console<span>.</span><span>log</span><span>(</span><span>'监视多个数据'</span><span>,</span> values<span>)</span>\n    <span>}</span><span>)</span>\n\n    <span>return</span> <span>{</span>\n      user<span>,</span>\n      fullName1<span>,</span>\n      fullName2<span>,</span>\n      fullName3\n    <span>}</span>\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_8-生命周期\" tabindex=\"-1\"> 8) 生命周期</h2>\n<p><strong>vue2.x的生命周期</strong></p>\n<p><img src=\"https://vipkshttps3.wiz.cn/ks/note/view/49c30824-dcdf-4bd0-af2a-708f490b44a1/10311b3b-496c-41f1-8df3-c87572008080/index_files/1604629129730-y1h.png\" alt=\"lifecycle_2\"></p>\n<p><strong>vue3的生命周期</strong></p>\n<p><img src=\"https://vipkshttps3.wiz.cn/ks/note/view/49c30824-dcdf-4bd0-af2a-708f490b44a1/10311b3b-496c-41f1-8df3-c87572008080/index_files/1604629129585-tqn.png\" alt=\"lifecycle_3\"></p>\n<p><strong>与 2.x 版本生命周期相对应的组合式 API</strong></p>\n<ul>\n<li><code>beforeCreate</code> -&gt; 使用 <code>setup()</code></li>\n<li><code>created</code> -&gt; 使用 <code>setup()</code></li>\n<li><code>beforeMount</code> -&gt; <code>onBeforeMount</code></li>\n<li><code>mounted</code> -&gt; <code>onMounted</code></li>\n<li><code>beforeUpdate</code> -&gt; <code>onBeforeUpdate</code></li>\n<li><code>updated</code> -&gt; <code>onUpdated</code></li>\n<li><code>beforeDestroy</code> -&gt; <code>onBeforeUnmount</code></li>\n<li><code>destroyed</code> -&gt; <code>onUnmounted</code></li>\n<li><code>errorCaptured</code> -&gt; <code>onErrorCaptured</code></li>\n</ul>\n<p><strong>新增的钩子函数</strong></p>\n<p>组合式 API 还提供了以下调试钩子函数：</p>\n<ul>\n<li>onRenderTracked</li>\n<li>onRenderTriggered</li>\n</ul>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n<span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>\"</span>about<span>\"</span></span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>msg: {{msg}}<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span><span><span>&lt;</span>hr</span><span>></span></span>\n  <span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>update<span>\"</span></span><span>></span></span>更新<span><span><span>&lt;/</span>button</span><span>></span></span>\n<span><span><span>&lt;/</span>div</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>import</span> <span>{</span>\n  ref<span>,</span>\n  onMounted<span>,</span>\n  onUpdated<span>,</span>\n  onUnmounted<span>,</span> \n  onBeforeMount<span>,</span> \n  onBeforeUpdate<span>,</span>\n  onBeforeUnmount\n<span>}</span> <span>from</span> <span>\"vue\"</span>\n\n<span>export</span> <span>default</span> <span>{</span>\n  <span>beforeCreate</span> <span>(</span><span>)</span> <span>{</span>\n    console<span>.</span><span>log</span><span>(</span><span>'beforeCreate()'</span><span>)</span>\n  <span>}</span><span>,</span>\n\n  <span>created</span> <span>(</span><span>)</span> <span>{</span>\n    console<span>.</span><span>log</span><span>(</span><span>'created'</span><span>)</span>\n  <span>}</span><span>,</span>\n\n  <span>beforeMount</span> <span>(</span><span>)</span> <span>{</span>\n    console<span>.</span><span>log</span><span>(</span><span>'beforeMount'</span><span>)</span>\n  <span>}</span><span>,</span>\n\n  <span>mounted</span> <span>(</span><span>)</span> <span>{</span>\n    console<span>.</span><span>log</span><span>(</span><span>'mounted'</span><span>)</span>\n  <span>}</span><span>,</span>\n\n  <span>beforeUpdate</span> <span>(</span><span>)</span> <span>{</span>\n    console<span>.</span><span>log</span><span>(</span><span>'beforeUpdate'</span><span>)</span>\n  <span>}</span><span>,</span>\n\n  <span>updated</span> <span>(</span><span>)</span> <span>{</span>\n    console<span>.</span><span>log</span><span>(</span><span>'updated'</span><span>)</span>\n  <span>}</span><span>,</span>\n\n  <span>beforeUnmount</span> <span>(</span><span>)</span> <span>{</span>\n    console<span>.</span><span>log</span><span>(</span><span>'beforeUnmount'</span><span>)</span>\n  <span>}</span><span>,</span>\n\n  <span>unmounted</span> <span>(</span><span>)</span> <span>{</span>\n     console<span>.</span><span>log</span><span>(</span><span>'unmounted'</span><span>)</span>\n  <span>}</span><span>,</span>\n  \n\n  <span>setup</span><span>(</span><span>)</span> <span>{</span>\n    \n    <span>const</span> msg <span>=</span> <span>ref</span><span>(</span><span>'abc'</span><span>)</span>\n\n    <span>const</span> <span>update</span> <span>=</span> <span>(</span><span>)</span> <span>=></span> <span>{</span>\n      msg<span>.</span>value <span>+=</span> <span>'--'</span>\n    <span>}</span>\n\n    <span>onBeforeMount</span><span>(</span><span>(</span><span>)</span> <span>=></span> <span>{</span>\n      console<span>.</span><span>log</span><span>(</span><span>'--onBeforeMount'</span><span>)</span>\n    <span>}</span><span>)</span>\n\n    <span>onMounted</span><span>(</span><span>(</span><span>)</span> <span>=></span> <span>{</span>\n      console<span>.</span><span>log</span><span>(</span><span>'--onMounted'</span><span>)</span>\n    <span>}</span><span>)</span>\n\n    <span>onBeforeUpdate</span><span>(</span><span>(</span><span>)</span> <span>=></span> <span>{</span>\n      console<span>.</span><span>log</span><span>(</span><span>'--onBeforeUpdate'</span><span>)</span>\n    <span>}</span><span>)</span>\n\n    <span>onUpdated</span><span>(</span><span>(</span><span>)</span> <span>=></span> <span>{</span>\n      console<span>.</span><span>log</span><span>(</span><span>'--onUpdated'</span><span>)</span>\n    <span>}</span><span>)</span>\n\n    <span>onBeforeUnmount</span><span>(</span><span>(</span><span>)</span> <span>=></span> <span>{</span>\n      console<span>.</span><span>log</span><span>(</span><span>'--onBeforeUnmount'</span><span>)</span>\n    <span>}</span><span>)</span>\n\n    <span>onUnmounted</span><span>(</span><span>(</span><span>)</span> <span>=></span> <span>{</span>\n      console<span>.</span><span>log</span><span>(</span><span>'--onUnmounted'</span><span>)</span>\n    <span>}</span><span>)</span>\n    \n    <span>return</span> <span>{</span>\n      msg<span>,</span>\n      update\n    <span>}</span>\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>App<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>isShow=!isShow<span>\"</span></span><span>></span></span>切换<span><span><span>&lt;/</span>button</span><span>></span></span>\n  <span><span><span>&lt;</span>hr</span><span>></span></span>\n  <span><span><span>&lt;</span>Child</span> <span>v-if</span><span><span>=</span><span>\"</span>isShow<span>\"</span></span><span>/></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>import</span> Child <span>from</span> <span>'./Child.vue'</span>\n<span>export</span> <span>default</span> <span>{</span>\n\n  <span>data</span> <span>(</span><span>)</span> <span>{</span>\n    <span>return</span> <span>{</span>\n      <span>isShow</span><span>:</span> <span>true</span>\n    <span>}</span>\n  <span>}</span><span>,</span>\n\n  <span>components</span><span>:</span> <span>{</span>\n    Child\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_09-自定义hook函数\" tabindex=\"-1\"> 09) 自定义hook函数</h2>\n<ul>\n<li>\n<p>使用Vue3的组合API封装的可复用的功能函数</p>\n</li>\n<li>\n<p>自定义hook的作用类似于vue2中的mixin技术</p>\n</li>\n<li>\n<p>自定义Hook的优势: 很清楚复用功能代码的来源, 更清楚易懂</p>\n</li>\n<li>\n<p>需求1: 收集用户鼠标点击的页面坐标</p>\n<p>hooks/useMousePosition.ts</p>\n</li>\n</ul>\n<div><pre><code><span>import</span> <span>{</span> ref<span>,</span> onMounted<span>,</span> onUnmounted <span>}</span> <span>from</span> <span>'vue'</span>\n<span>/* \n收集用户鼠标点击的页面坐标\n*/</span>\n<span>export</span> <span>default</span> <span>function</span> <span>useMousePosition</span> <span>(</span><span>)</span> <span>{</span>\n  <span>// 初始化坐标数据</span>\n  <span>const</span> x <span>=</span> <span>ref</span><span>(</span><span>-</span><span>1</span><span>)</span>\n  <span>const</span> y <span>=</span> <span>ref</span><span>(</span><span>-</span><span>1</span><span>)</span>\n\n  <span>// 用于收集点击事件坐标的函数</span>\n  <span>const</span> <span>updatePosition</span> <span>=</span> <span>(</span><span><span>e</span><span>:</span> MouseEvent</span><span>)</span> <span>=></span> <span>{</span>\n    x<span>.</span>value <span>=</span> e<span>.</span>pageX\n    y<span>.</span>value <span>=</span> e<span>.</span>pageY\n  <span>}</span>\n\n  <span>// 挂载后绑定点击监听</span>\n  <span>onMounted</span><span>(</span><span>(</span><span>)</span> <span>=></span> <span>{</span>\n    document<span>.</span><span>addEventListener</span><span>(</span><span>'click'</span><span>,</span> updatePosition<span>)</span>\n  <span>}</span><span>)</span>\n\n  <span>// 卸载前解绑点击监听</span>\n  <span>onUnmounted</span><span>(</span><span>(</span><span>)</span> <span>=></span> <span>{</span>\n    document<span>.</span><span>removeEventListener</span><span>(</span><span>'click'</span><span>,</span> updatePosition<span>)</span>\n  <span>}</span><span>)</span>\n\n  <span>return</span> <span>{</span>x<span>,</span> y<span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n<span><span><span>&lt;</span>div</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>x: {{x}}, y: {{y}}<span><span><span>&lt;/</span>h2</span><span>></span></span>\n<span><span><span>&lt;/</span>div</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span><span>></span></span><span><span>\n\n<span>import</span> <span>{</span>\n  ref\n<span>}</span> <span>from</span> <span>\"vue\"</span>\n<span>/* \n在组件中引入并使用自定义hook\n自定义hook的作用类似于vue2中的mixin技术\n自定义Hook的优势: 很清楚复用功能代码的来源, 更清楚易懂\n*/</span>\n<span>import</span> useMousePosition <span>from</span> <span>'./hooks/useMousePosition'</span>\n\n<span>export</span> <span>default</span> <span>{</span>\n  <span>setup</span><span>(</span><span>)</span> <span>{</span>\n\n    <span>const</span> <span>{</span>x<span>,</span> y<span>}</span> <span>=</span> <span>useMousePosition</span><span>(</span><span>)</span>\n\n    <span>return</span> <span>{</span>\n      x<span>,</span>\n      y<span>,</span>\n    <span>}</span>\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><ul>\n<li>\n<p>利用TS泛型强化类型检查</p>\n</li>\n<li>\n<p>需求2: 封装发ajax请求的hook函数</p>\n<p>hooks/useRequest.ts</p>\n</li>\n</ul>\n<div><pre><code><span>import</span> <span>{</span> ref <span>}</span> <span>from</span> <span>'vue'</span>\n<span>import</span> axios <span>from</span> <span>'axios'</span>\n\n<span>/* \n使用axios发送异步ajax请求\n*/</span>\n<span>export</span> <span>default</span> <span>function</span> <span><span>useUrlLoader</span><span><span>&lt;</span><span>T</span><span>></span></span></span><span>(</span>url<span>:</span> <span>string</span><span>)</span> <span>{</span>\n\n  <span>const</span> result <span>=</span> <span><span>ref</span><span><span>&lt;</span><span>T</span> <span>|</span> <span>null</span><span>></span></span></span><span>(</span><span>null</span><span>)</span>\n  <span>const</span> loading <span>=</span> <span>ref</span><span>(</span><span>true</span><span>)</span>\n  <span>const</span> errorMsg <span>=</span> <span>ref</span><span>(</span><span>null</span><span>)</span>\n\n  axios<span>.</span><span>get</span><span>(</span>url<span>)</span>\n    <span>.</span><span>then</span><span>(</span>response <span>=></span> <span>{</span>\n      loading<span>.</span>value <span>=</span> <span>false</span>\n      result<span>.</span>value <span>=</span> response<span>.</span>data\n    <span>}</span><span>)</span>\n    <span>.</span><span>catch</span><span>(</span>e <span>=></span> <span>{</span>\n      loading<span>.</span>value <span>=</span> <span>false</span>\n      errorMsg<span>.</span>value <span>=</span> e<span>.</span>message <span>||</span> <span>'未知错误'</span>\n    <span>}</span><span>)</span>\n\n  <span>return</span> <span>{</span>\n    loading<span>,</span>\n    result<span>,</span>\n    errorMsg<span>,</span>\n  <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n<span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>\"</span>about<span>\"</span></span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span> <span>v-if</span><span><span>=</span><span>\"</span>loading<span>\"</span></span><span>></span></span>LOADING...<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span> <span>v-else-if</span><span><span>=</span><span>\"</span>errorMsg<span>\"</span></span><span>></span></span>{{errorMsg}}<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span>&lt;!-- &lt;ul v-else>\n    &lt;li>id: {{result.id}}&lt;/li>\n    &lt;li>name: {{result.name}}&lt;/li>\n    &lt;li>distance: {{result.distance}}&lt;/li>\n  &lt;/ul> --></span>\n\n  <span><span><span>&lt;</span>ul</span> <span>v-for</span><span><span>=</span><span>\"</span>p in result<span>\"</span></span> <span>:key</span><span><span>=</span><span>\"</span>p.id<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>li</span><span>></span></span>id: {{p.id}}<span><span><span>&lt;/</span>li</span><span>></span></span>\n    <span><span><span>&lt;</span>li</span><span>></span></span>title: {{p.title}}<span><span><span>&lt;/</span>li</span><span>></span></span>\n    <span><span><span>&lt;</span>li</span><span>></span></span>price: {{p.price}}<span><span><span>&lt;/</span>li</span><span>></span></span>\n  <span><span><span>&lt;/</span>ul</span><span>></span></span>\n  <span>&lt;!-- &lt;img v-if=\"result\" :src=\"result[0].url\" alt=\"\"> --></span>\n<span><span><span>&lt;/</span>div</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>import</span> <span>{</span>\n  watch\n<span>}</span> <span>from</span> <span>\"vue\"</span>\n<span>import</span> useRequest <span>from</span> <span>'./hooks/useRequest'</span>\n\n<span>// 地址数据接口</span>\n<span>interface</span> <span>AddressResult</span> <span>{</span>\n  <span>id</span><span>:</span> number<span>;</span>\n  <span>name</span><span>:</span> string<span>;</span>\n  <span>distance</span><span>:</span> string<span>;</span>\n<span>}</span>\n\n<span>// 产品数据接口</span>\n<span>interface</span> <span>ProductResult</span> <span>{</span>\n  <span>id</span><span>:</span> string<span>;</span>\n  <span>title</span><span>:</span> string<span>;</span>\n  <span>price</span><span>:</span> number<span>;</span>\n<span>}</span>\n\n<span>export</span> <span>default</span> <span>{</span>\n  <span>setup</span><span>(</span><span>)</span> <span>{</span>\n\n    <span>// const {loading, result, errorMsg} = useRequest&lt;AddressResult>('/data/address.json')</span>\n    <span>const</span> <span>{</span>loading<span>,</span> result<span>,</span> errorMsg<span>}</span> <span>=</span> useRequest<span>&lt;</span>ProductResult<span>[</span><span>]</span><span>></span><span>(</span><span>'/data/products.json'</span><span>)</span>\n\n    <span>watch</span><span>(</span>result<span>,</span> <span>(</span><span>)</span> <span>=></span> <span>{</span>\n      <span>if</span> <span>(</span>result<span>.</span>value<span>)</span> <span>{</span>\n        console<span>.</span><span>log</span><span>(</span>result<span>.</span>value<span>.</span>length<span>)</span> <span>// 有提示</span>\n      <span>}</span>\n    <span>}</span><span>)</span>\n\n    <span>return</span> <span>{</span>\n      loading<span>,</span>\n      result<span>,</span> \n      errorMsg\n    <span>}</span>\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_10-torefs\" tabindex=\"-1\"> 10) toRefs</h2>\n<p>把一个响应式对象转换成普通对象，该普通对象的每个 property 都是一个 ref</p>\n<p>应用: 当从合成函数返回响应式对象时，toRefs 非常有用，这样消费组件就可以在不丢失响应式的情况下对返回的对象进行分解使用</p>\n<p>问题: reactive 对象取出的所有属性值都是非响应式的</p>\n<p>解决: 利用 toRefs 可以将一个响应式 reactive 对象的所有原始属性转换为响应式的 ref 属性</p>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>App<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span><span><span>&lt;</span>h3</span><span>></span></span>foo: {{foo}}<span><span><span>&lt;/</span>h3</span><span>></span></span>\n  <span><span><span>&lt;</span>h3</span><span>></span></span>bar: {{bar}}<span><span><span>&lt;/</span>h3</span><span>></span></span>\n  <span><span><span>&lt;</span>h3</span><span>></span></span>foo2: {{foo2}}<span><span><span>&lt;/</span>h3</span><span>></span></span>\n  <span><span><span>&lt;</span>h3</span><span>></span></span>bar2: {{bar2}}<span><span><span>&lt;/</span>h3</span><span>></span></span>\n\n\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>import</span> <span>{</span> reactive<span>,</span> toRefs <span>}</span> <span>from</span> <span>'vue'</span>\n<span>/*\ntoRefs:\n  将响应式对象中所有属性包装为ref对象, 并返回包含这些ref对象的普通对象\n  应用: 当从合成函数返回响应式对象时，toRefs 非常有用，\n        这样消费组件就可以在不丢失响应式的情况下对返回的对象进行分解使用\n*/</span>\n<span>export</span> <span>default</span> <span>{</span>\n\n  <span>setup</span> <span>(</span><span>)</span> <span>{</span>\n\n    <span>const</span> state <span>=</span> <span>reactive</span><span>(</span><span>{</span>\n      <span>foo</span><span>:</span> <span>'a'</span><span>,</span>\n      <span>bar</span><span>:</span> <span>'b'</span><span>,</span>\n    <span>}</span><span>)</span>\n\n    <span>const</span> stateAsRefs <span>=</span> <span>toRefs</span><span>(</span>state<span>)</span>\n\n    <span>setTimeout</span><span>(</span><span>(</span><span>)</span> <span>=></span> <span>{</span>\n      state<span>.</span>foo <span>+=</span> <span>'++'</span>\n      state<span>.</span>bar <span>+=</span> <span>'++'</span>\n    <span>}</span><span>,</span> <span>2000</span><span>)</span><span>;</span>\n\n    <span>const</span> <span>{</span>foo2<span>,</span> bar2<span>}</span> <span>=</span> <span>useReatureX</span><span>(</span><span>)</span>\n\n    <span>return</span> <span>{</span>\n      <span>// ...state,</span>\n      <span>...</span>stateAsRefs<span>,</span>\n      foo2<span>,</span> \n      bar2\n    <span>}</span>\n  <span>}</span><span>,</span>\n<span>}</span>\n\n<span>function</span> <span>useReatureX</span><span>(</span><span>)</span> <span>{</span>\n  <span>const</span> state <span>=</span> <span>reactive</span><span>(</span><span>{</span>\n    <span>foo2</span><span>:</span> <span>'a'</span><span>,</span>\n    <span>bar2</span><span>:</span> <span>'b'</span><span>,</span>\n  <span>}</span><span>)</span>\n\n  <span>setTimeout</span><span>(</span><span>(</span><span>)</span> <span>=></span> <span>{</span>\n    state<span>.</span>foo2 <span>+=</span> <span>'++'</span>\n    state<span>.</span>bar2 <span>+=</span> <span>'++'</span>\n  <span>}</span><span>,</span> <span>2000</span><span>)</span><span>;</span>\n\n  <span>return</span> <span>toRefs</span><span>(</span>state<span>)</span>\n<span>}</span>\n\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_11-ref获取元素\" tabindex=\"-1\"> 11) ref获取元素</h2>\n<p>利用ref函数获取组件中的标签元素</p>\n<p>功能需求: 让输入框自动获取焦点</p>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>App<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span><span><span>&lt;</span>input</span> <span>type</span><span><span>=</span><span>\"</span>text<span>\"</span></span><span>></span></span>---\n  <span><span><span>&lt;</span>input</span> <span>type</span><span><span>=</span><span>\"</span>text<span>\"</span></span> <span>ref</span><span><span>=</span><span>\"</span>inputRef<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>import</span> <span>{</span> onMounted<span>,</span> ref <span>}</span> <span>from</span> <span>'vue'</span>\n<span>/* \nref获取元素: 利用ref函数获取组件中的标签元素\n功能需求: 让输入框自动获取焦点\n*/</span>\n<span>export</span> <span>default</span> <span>{</span>\n  <span>setup</span><span>(</span><span>)</span> <span>{</span>\n    <span>const</span> inputRef <span>=</span> ref<span>&lt;</span>HTMLElement<span>|</span><span>null</span><span>></span><span>(</span><span>null</span><span>)</span>\n\n    <span>onMounted</span><span>(</span><span>(</span><span>)</span> <span>=></span> <span>{</span>\n      inputRef<span>.</span>value <span>&amp;&amp;</span> inputRef<span>.</span>value<span>.</span><span>focus</span><span>(</span><span>)</span>\n    <span>}</span><span>)</span>\n\n    <span>return</span> <span>{</span>\n      inputRef\n    <span>}</span>\n  <span>}</span><span>,</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "image": "https://vipkshttps3.wiz.cn/ks/note/view/49c30824-dcdf-4bd0-af2a-708f490b44a1/10311b3b-496c-41f1-8df3-c87572008080/index_files/1604629129730-y1h.png",
      "date_published": "2022-07-30T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "Composition API",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter4/02_Composition%20API_%E5%85%B6%E5%AE%83%E9%83%A8%E5%88%86.html",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter4/02_Composition%20API_%E5%85%B6%E5%AE%83%E9%83%A8%E5%88%86.html",
      "content_html": "<h1 id=\"_2-composition-api-其它部分\" tabindex=\"-1\"> 2. Composition API(其它部分)</h1>\n<h2 id=\"_1-shallowreactive-与-shallowref\" tabindex=\"-1\"> 1) shallowReactive 与 shallowRef</h2>\n<ul>\n<li>\n<p>shallowReactive : 只处理了对象内最外层属性的响应式(也就是浅响应式)</p>\n</li>\n<li>\n<p>shallowRef: 只处理了value的响应式, 不进行对象的reactive处理</p>\n</li>\n<li>\n<p>什么时候用浅响应式呢?</p>\n<ul>\n<li>一般情况下使用ref和reactive即可</li>\n<li>如果有一个对象数据, 结构比较深, 但变化时只是外层属性变化 ===&gt; shallowReactive</li>\n<li>如果有一个对象数据, 后面会产生新的对象来替换 ===&gt; shallowRef</li>\n</ul>\n</li>\n</ul>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>App<span><span><span>&lt;/</span>h2</span><span>></span></span>\n\n  <span><span><span>&lt;</span>h3</span><span>></span></span>m1: {{m1}}<span><span><span>&lt;/</span>h3</span><span>></span></span>\n  <span><span><span>&lt;</span>h3</span><span>></span></span>m2: {{m2}}<span><span><span>&lt;/</span>h3</span><span>></span></span>\n  <span><span><span>&lt;</span>h3</span><span>></span></span>m3: {{m3}}<span><span><span>&lt;/</span>h3</span><span>></span></span>\n  <span><span><span>&lt;</span>h3</span><span>></span></span>m4: {{m4}}<span><span><span>&lt;/</span>h3</span><span>></span></span>\n\n  <span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>update<span>\"</span></span><span>></span></span>更新<span><span><span>&lt;/</span>button</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>import</span> <span>{</span> reactive<span>,</span> ref<span>,</span> shallowReactive<span>,</span> shallowRef <span>}</span> <span>from</span> <span>'vue'</span>\n<span>/* \nshallowReactive与shallowRef\n  shallowReactive: 只处理了对象内最外层属性的响应式(也就是浅响应式)\n  shallowRef: 只处理了value的响应式, 不进行对象的reactive处理\n总结:\n  reactive与ref实现的是深度响应式, 而shallowReactive与shallowRef是浅响应式\n  什么时候用浅响应式呢?\n    一般情况下使用ref和reactive即可,\n    如果有一个对象数据, 结构比较深, 但变化时只是外层属性变化 ===> shallowReactive\n    如果有一个对象数据, 后面会产生新的对象来替换 ===> shallowRef\n*/</span>\n\n<span>export</span> <span>default</span> <span>{</span>\n\n  <span>setup</span> <span>(</span><span>)</span> <span>{</span>\n\n    <span>const</span> m1 <span>=</span> <span>reactive</span><span>(</span><span>{</span><span>a</span><span>:</span> <span>1</span><span>,</span> <span>b</span><span>:</span> <span>{</span><span>c</span><span>:</span> <span>2</span><span>}</span><span>}</span><span>)</span>\n    <span>const</span> m2 <span>=</span> <span>shallowReactive</span><span>(</span><span>{</span><span>a</span><span>:</span> <span>1</span><span>,</span> <span>b</span><span>:</span> <span>{</span><span>c</span><span>:</span> <span>2</span><span>}</span><span>}</span><span>)</span>\n\n    <span>const</span> m3 <span>=</span> <span>ref</span><span>(</span><span>{</span><span>a</span><span>:</span> <span>1</span><span>,</span> <span>b</span><span>:</span> <span>{</span><span>c</span><span>:</span> <span>2</span><span>}</span><span>}</span><span>)</span>\n    <span>const</span> m4 <span>=</span> <span>shallowRef</span><span>(</span><span>{</span><span>a</span><span>:</span> <span>1</span><span>,</span> <span>b</span><span>:</span> <span>{</span><span>c</span><span>:</span> <span>2</span><span>}</span><span>}</span><span>)</span>\n\n    <span>const</span> <span>update</span> <span>=</span> <span>(</span><span>)</span> <span>=></span> <span>{</span>\n      <span>// m1.b.c += 1</span>\n      <span>// m2.b.c += 1</span>\n\n      <span>// m3.value.a += 1</span>\n      m4<span>.</span>value<span>.</span>a <span>+=</span> <span>1</span>\n    <span>}</span>\n\n    <span>return</span> <span>{</span>\n      m1<span>,</span>\n      m2<span>,</span>\n      m3<span>,</span>\n      m4<span>,</span>\n      update<span>,</span>\n    <span>}</span>\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_2-readonly-与-shallowreadonly\" tabindex=\"-1\"> 2) readonly 与 shallowReadonly</h2>\n<ul>\n<li>readonly:\n<ul>\n<li>深度只读数据</li>\n<li>获取一个对象 (响应式或纯对象) 或 ref 并返回原始代理的只读代理。</li>\n<li>只读代理是深层的：访问的任何嵌套 property 也是只读的。</li>\n</ul>\n</li>\n<li>shallowReadonly\n<ul>\n<li>浅只读数据</li>\n<li>创建一个代理，使其自身的 property 为只读，但不执行嵌套对象的深度只读转换</li>\n</ul>\n</li>\n<li>应用场景:\n<ul>\n<li>在某些特定情况下, 我们可能不希望对数据进行更新的操作, 那就可以包装生成一个只读代理对象来读取数据, 而不能修改或删除</li>\n</ul>\n</li>\n</ul>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>App<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span><span><span>&lt;</span>h3</span><span>></span></span>{{state}}<span><span><span>&lt;/</span>h3</span><span>></span></span>\n  <span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>update<span>\"</span></span><span>></span></span>更新<span><span><span>&lt;/</span>button</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>import</span> <span>{</span> reactive<span>,</span> readonly<span>,</span> shallowReadonly <span>}</span> <span>from</span> <span>'vue'</span>\n<span>/*\nreadonly: 深度只读数据\n  获取一个对象 (响应式或纯对象) 或 ref 并返回原始代理的只读代理。\n  只读代理是深层的：访问的任何嵌套 property 也是只读的。\nshallowReadonly: 浅只读数据\n  创建一个代理，使其自身的 property 为只读，但不执行嵌套对象的深度只读转换 \n应用场景: \n  在某些特定情况下, 我们可能不希望对数据进行更新的操作, 那就可以包装生成一个只读代理对象来读取数据, 而不能修改或删除\n*/</span>\n\n<span>export</span> <span>default</span> <span>{</span>\n\n  <span>setup</span> <span>(</span><span>)</span> <span>{</span>\n\n    <span>const</span> state <span>=</span> <span>reactive</span><span>(</span><span>{</span>\n      <span>a</span><span>:</span> <span>1</span><span>,</span>\n      <span>b</span><span>:</span> <span>{</span>\n        <span>c</span><span>:</span> <span>2</span>\n      <span>}</span>\n    <span>}</span><span>)</span>\n\n    <span>// const rState1 = readonly(state)</span>\n    <span>const</span> rState2 <span>=</span> <span>shallowReadonly</span><span>(</span>state<span>)</span>\n\n    <span>const</span> <span>update</span> <span>=</span> <span>(</span><span>)</span> <span>=></span> <span>{</span>\n      <span>// rState1.a++ // error</span>\n      <span>// rState1.b.c++ // error</span>\n\n      <span>// rState2.a++ // error</span>\n      rState2<span>.</span>b<span>.</span>c<span>++</span>\n    <span>}</span>\n    \n    <span>return</span> <span>{</span>\n      state<span>,</span>\n      update\n    <span>}</span>\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_3-toraw-与-markraw\" tabindex=\"-1\"> 3) toRaw 与 markRaw</h2>\n<ul>\n<li>toRaw\n<ul>\n<li>返回由 <code>reactive</code> 或 <code>readonly</code> 方法转换成响应式代理的普通对象。</li>\n<li>这是一个还原方法，可用于临时读取，访问不会被代理/跟踪，写入时也不会触发界面更新。</li>\n</ul>\n</li>\n<li>markRaw\n<ul>\n<li>标记一个对象，使其永远不会转换为代理。返回对象本身</li>\n<li>应用场景:\n<ul>\n<li>有些值不应被设置为响应式的，例如复杂的第三方类实例或 Vue 组件对象。</li>\n<li>当渲染具有不可变数据源的大列表时，跳过代理转换可以提高性能。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>{{state}}<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>testToRaw<span>\"</span></span><span>></span></span>测试toRaw<span><span><span>&lt;/</span>button</span><span>></span></span>\n  <span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>testMarkRaw<span>\"</span></span><span>></span></span>测试markRaw<span><span><span>&lt;/</span>button</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>/* \ntoRaw: 得到reactive代理对象的目标数据对象\n*/</span>\n<span>import</span> <span>{</span>\n  markRaw<span>,</span>\n  reactive<span>,</span> toRaw<span>,</span>\n<span>}</span> <span>from</span> <span>'vue'</span>\n<span>export</span> <span>default</span> <span>{</span>\n  <span>setup</span> <span>(</span><span>)</span> <span>{</span>\n    <span>const</span> state <span>=</span> reactive<span>&lt;</span>any<span>></span><span>(</span><span>{</span>\n      <span>name</span><span>:</span> <span>'tom'</span><span>,</span>\n      <span>age</span><span>:</span> <span>25</span><span>,</span>\n    <span>}</span><span>)</span>\n\n    <span>const</span> <span>testToRaw</span> <span>=</span> <span>(</span><span>)</span> <span>=></span> <span>{</span>\n      <span>const</span> user <span>=</span> <span>toRaw</span><span>(</span>state<span>)</span>\n      user<span>.</span>age<span>++</span>  <span>// 界面不会更新</span>\n\n    <span>}</span>\n\n    <span>const</span> <span>testMarkRaw</span> <span>=</span> <span>(</span><span>)</span> <span>=></span> <span>{</span>\n      <span>const</span> likes <span>=</span> <span>[</span><span>'a'</span><span>,</span> <span>'b'</span><span>]</span>\n      <span>// state.likes = likes</span>\n      state<span>.</span>likes <span>=</span> <span>markRaw</span><span>(</span>likes<span>)</span> <span>// likes数组就不再是响应式的了</span>\n      <span>setTimeout</span><span>(</span><span>(</span><span>)</span> <span>=></span> <span>{</span>\n        state<span>.</span>likes<span>[</span><span>0</span><span>]</span> <span>+=</span> <span>'--'</span>\n      <span>}</span><span>,</span> <span>1000</span><span>)</span>\n    <span>}</span>\n\n    <span>return</span> <span>{</span>\n      state<span>,</span>\n      testToRaw<span>,</span>\n      testMarkRaw<span>,</span>\n    <span>}</span>\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_4-toref\" tabindex=\"-1\"> 4) toRef</h2>\n<ul>\n<li>为源响应式对象上的某个属性创建一个 ref对象, 二者内部操作的是同一个数据值, 更新时二者是同步的</li>\n<li>区别ref: 拷贝了一份新的数据值单独操作, 更新时相互不影响</li>\n<li>应用: 当要将 某个prop 的 ref 传递给复合函数时，toRef 很有用</li>\n</ul>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>App<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span><span><span>&lt;</span>p</span><span>></span></span>{{state}}<span><span><span>&lt;/</span>p</span><span>></span></span>\n  <span><span><span>&lt;</span>p</span><span>></span></span>{{foo}}<span><span><span>&lt;/</span>p</span><span>></span></span>\n  <span><span><span>&lt;</span>p</span><span>></span></span>{{foo2}}<span><span><span>&lt;/</span>p</span><span>></span></span>\n\n  <span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>update<span>\"</span></span><span>></span></span>更新<span><span><span>&lt;/</span>button</span><span>></span></span>\n\n  <span><span><span>&lt;</span>Child</span> <span>:foo</span><span><span>=</span><span>\"</span>foo<span>\"</span></span><span>/></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>/*\ntoRef:\n  为源响应式对象上的某个属性创建一个 ref对象, 二者内部操作的是同一个数据值, 更新时二者是同步的\n  区别ref: 拷贝了一份新的数据值单独操作, 更新时相互不影响\n  应用: 当要将某个 prop 的 ref 传递给复合函数时，toRef 很有用\n*/</span>\n\n<span>import</span> <span>{</span>\n  reactive<span>,</span>\n  toRef<span>,</span>\n  ref<span>,</span>\n<span>}</span> <span>from</span> <span>'vue'</span>\n<span>import</span> Child <span>from</span> <span>'./Child.vue'</span>\n\n<span>export</span> <span>default</span> <span>{</span>\n\n  <span>setup</span> <span>(</span><span>)</span> <span>{</span>\n\n    <span>const</span> state <span>=</span> <span>reactive</span><span>(</span><span>{</span>\n      <span>foo</span><span>:</span> <span>1</span><span>,</span>\n      <span>bar</span><span>:</span> <span>2</span>\n    <span>}</span><span>)</span>\n\n    <span>const</span> foo <span>=</span> <span>toRef</span><span>(</span>state<span>,</span> <span>'foo'</span><span>)</span>\n    <span>const</span> foo2 <span>=</span> <span>ref</span><span>(</span>state<span>.</span>foo<span>)</span>\n\n    <span>const</span> <span>update</span> <span>=</span> <span>(</span><span>)</span> <span>=></span> <span>{</span>\n      state<span>.</span>foo<span>++</span>\n      <span>// foo.value++</span>\n      <span>// foo2.value++  // foo和state中的数据不会更新</span>\n    <span>}</span>\n\n    <span>return</span> <span>{</span>\n      state<span>,</span>\n      foo<span>,</span>\n      foo2<span>,</span>\n      update<span>,</span>\n    <span>}</span>\n  <span>}</span><span>,</span>\n\n  <span>components</span><span>:</span> <span>{</span>\n    Child\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>Child<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span><span><span>&lt;</span>h3</span><span>></span></span>{{foo}}<span><span><span>&lt;/</span>h3</span><span>></span></span>\n  <span><span><span>&lt;</span>h3</span><span>></span></span>{{length}}<span><span><span>&lt;/</span>h3</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>import</span> <span>{</span> computed<span>,</span> defineComponent<span>,</span> Ref<span>,</span> toRef <span>}</span> <span>from</span> <span>'vue'</span>\n\n<span>const</span> component <span>=</span> <span>defineComponent</span><span>(</span><span>{</span>\n  <span>props</span><span>:</span> <span>{</span>\n    <span>foo</span><span>:</span> <span>{</span>\n      <span>type</span><span>:</span> Number<span>,</span>\n      <span>require</span><span>:</span> <span>true</span>\n    <span>}</span>\n  <span>}</span><span>,</span>\n\n  <span>setup</span> <span>(</span><span>props<span>,</span> context</span><span>)</span> <span>{</span>\n    <span>const</span> length <span>=</span> <span>useFeatureX</span><span>(</span><span>toRef</span><span>(</span>props<span>,</span> <span>'foo'</span><span>)</span><span>)</span>\n\n    <span>return</span> <span>{</span>\n      length\n    <span>}</span>\n  <span>}</span>\n<span>}</span><span>)</span>\n\n<span>function</span> <span>useFeatureX</span><span>(</span><span><span>foo</span><span>:</span> Ref</span><span>)</span> <span>{</span>\n  <span>const</span> lenth <span>=</span> <span>computed</span><span>(</span><span>(</span><span>)</span> <span>=></span> foo<span>.</span>value<span>.</span>length<span>)</span>\n\n  <span>return</span> lenth\n<span>}</span>\n\n<span>export</span> <span>default</span> component\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_5-customref\" tabindex=\"-1\"> 5) customRef</h2>\n<ul>\n<li>创建一个自定义的 ref，并对其依赖项跟踪和更新触发进行显式控制</li>\n<li>需求: 使用 customRef 实现 debounce 的示例</li>\n</ul>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>App<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span><span><span>&lt;</span>input</span> <span>v-model</span><span><span>=</span><span>\"</span>keyword<span>\"</span></span> <span>placeholder</span><span><span>=</span><span>\"</span>搜索关键字<span>\"</span></span><span>/></span></span>\n  <span><span><span>&lt;</span>p</span><span>></span></span>{{keyword}}<span><span><span>&lt;/</span>p</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>/*\ncustomRef:\n  创建一个自定义的 ref，并对其依赖项跟踪和更新触发进行显式控制\n\n需求: \n  使用 customRef 实现 debounce 的示例\n*/</span>\n\n<span>import</span> <span>{</span>\n  ref<span>,</span>\n  customRef\n<span>}</span> <span>from</span> <span>'vue'</span>\n\n<span>export</span> <span>default</span> <span>{</span>\n\n  <span>setup</span> <span>(</span><span>)</span> <span>{</span>\n    <span>const</span> keyword <span>=</span> <span>useDebouncedRef</span><span>(</span><span>''</span><span>,</span> <span>500</span><span>)</span>\n    console<span>.</span><span>log</span><span>(</span>keyword<span>)</span>\n    <span>return</span> <span>{</span>\n      keyword\n    <span>}</span>\n  <span>}</span><span>,</span>\n<span>}</span>\n\n<span>/* \n实现函数防抖的自定义ref\n*/</span>\n<span>function</span> useDebouncedRef<span>&lt;</span><span>T</span><span>></span><span>(</span>value<span>:</span> <span>T</span><span>,</span> delay <span>=</span> <span>200</span><span>)</span> <span>{</span>\n  <span>let</span> <span>timeout</span><span>:</span> number\n  <span>return</span> <span>customRef</span><span>(</span><span>(</span><span>track<span>,</span> trigger</span><span>)</span> <span>=></span> <span>{</span>\n    <span>return</span> <span>{</span>\n      <span>get</span><span>(</span><span>)</span> <span>{</span>\n        <span>// 告诉Vue追踪数据</span>\n        <span>track</span><span>(</span><span>)</span>\n        <span>return</span> value\n      <span>}</span><span>,</span>\n      <span>set</span><span>(</span>newValue<span>:</span> <span>T</span><span>)</span> <span>{</span>\n        <span>clearTimeout</span><span>(</span>timeout<span>)</span>\n        timeout <span>=</span> <span>setTimeout</span><span>(</span><span>(</span><span>)</span> <span>=></span> <span>{</span>\n          value <span>=</span> newValue\n          <span>// 告诉Vue去触发界面更新</span>\n          <span>trigger</span><span>(</span><span>)</span>\n        <span>}</span><span>,</span> delay<span>)</span>\n      <span>}</span>\n    <span>}</span>\n  <span>}</span><span>)</span>\n<span>}</span>\n\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_6-provide-与-inject\" tabindex=\"-1\"> 6) provide 与 inject</h2>\n<ul>\n<li>\n<p>provide<code>和</code>inject<code>提供依赖注入，功能类似 2.x 的</code>provide/inject</p>\n</li>\n<li>\n<p>实现跨层级组件(祖孙)间通信</p>\n</li>\n</ul>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>h1</span><span>></span></span>父组件<span><span><span>&lt;/</span>h1</span><span>></span></span>\n  <span><span><span>&lt;</span>p</span><span>></span></span>当前颜色: {{color}}<span><span><span>&lt;/</span>p</span><span>></span></span>\n  <span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>color=<span>'</span>red<span>'</span><span>\"</span></span><span>></span></span>红<span><span><span>&lt;/</span>button</span><span>></span></span>\n  <span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>color=<span>'</span>yellow<span>'</span><span>\"</span></span><span>></span></span>黄<span><span><span>&lt;/</span>button</span><span>></span></span>\n  <span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>color=<span>'</span>blue<span>'</span><span>\"</span></span><span>></span></span>蓝<span><span><span>&lt;/</span>button</span><span>></span></span>\n  \n  <span><span><span>&lt;</span>hr</span><span>></span></span>\n  <span><span><span>&lt;</span>Son</span> <span>/></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>import</span> <span>{</span> provide<span>,</span> ref <span>}</span> <span>from</span> <span>'vue'</span>\n<span>/* \n- provide` 和 `inject` 提供依赖注入，功能类似 2.x 的 `provide/inject\n- 实现跨层级组件(祖孙)间通信\n*/</span>\n\n<span>import</span> Son <span>from</span> <span>'./Son.vue'</span>\n<span>export</span> <span>default</span> <span>{</span>\n  <span>name</span><span>:</span> <span>'ProvideInject'</span><span>,</span>\n  <span>components</span><span>:</span> <span>{</span>\n    Son\n  <span>}</span><span>,</span>\n  <span>setup</span><span>(</span><span>)</span> <span>{</span>\n    \n    <span>const</span> color <span>=</span> <span>ref</span><span>(</span><span>'red'</span><span>)</span>\n\n    <span>provide</span><span>(</span><span>'color'</span><span>,</span> color<span>)</span>\n\n    <span>return</span> <span>{</span>\n      color\n    <span>}</span>\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>div</span><span>></span></span>\n    <span><span><span>&lt;</span>h2</span><span>></span></span>子组件<span><span><span>&lt;/</span>h2</span><span>></span></span>\n    <span><span><span>&lt;</span>hr</span><span>></span></span>\n    <span><span><span>&lt;</span>GrandSon</span> <span>/></span></span>\n  <span><span><span>&lt;/</span>div</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>import</span> GrandSon <span>from</span> <span>'./GrandSon.vue'</span>\n<span>export</span> <span>default</span> <span>{</span>\n  <span>components</span><span>:</span> <span>{</span>\n    GrandSon\n  <span>}</span><span>,</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>h3</span> <span>:style</span><span><span>=</span><span>\"</span>{color}<span>\"</span></span><span>></span></span>孙子组件: {{color}}<span><span><span>&lt;/</span>h3</span><span>></span></span>\n  \n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>import</span> <span>{</span> inject <span>}</span> <span>from</span> <span>'vue'</span>\n<span>export</span> <span>default</span> <span>{</span>\n  <span>setup</span><span>(</span><span>)</span> <span>{</span>\n    <span>const</span> color <span>=</span> <span>inject</span><span>(</span><span>'color'</span><span>)</span>\n\n    <span>return</span> <span>{</span>\n      color\n    <span>}</span>\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_7-响应式数据的判断\" tabindex=\"-1\"> 7) 响应式数据的判断</h2>\n<ul>\n<li>isRef: 检查一个值是否为一个 ref 对象</li>\n<li>isReactive: 检查一个对象是否是由 <code>reactive</code> 创建的响应式代理</li>\n<li>isReadonly: 检查一个对象是否是由 <code>readonly</code> 创建的只读代理</li>\n<li>isProxy: 检查一个对象是否是由 <code>reactive</code> 或者 <code>readonly</code> 方法创建的代理</li>\n</ul>\n",
      "date_published": "2022-07-31T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "手写组合API",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter4/03_%E6%89%8B%E5%86%99%E7%BB%84%E5%90%88API.html",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter4/03_%E6%89%8B%E5%86%99%E7%BB%84%E5%90%88API.html",
      "content_html": "<h1 id=\"_3-手写组合api\" tabindex=\"-1\"> 3. 手写组合API</h1>\n<h2 id=\"_1-shallowreactive-与-reactive\" tabindex=\"-1\"> 1) shallowReactive 与 reactive</h2>\n<div><pre><code><span>const</span> reactiveHandler <span>=</span> <span>{</span>\n  <span>get</span> <span>(</span>target<span>,</span> key<span>)</span> <span>{</span>\n\n    <span>if</span> <span>(</span>key<span>===</span><span>'_is_reactive'</span><span>)</span> <span>return</span> <span>true</span>\n\n    <span>return</span> Reflect<span>.</span><span>get</span><span>(</span>target<span>,</span> key<span>)</span>\n  <span>}</span><span>,</span>\n\n  <span>set</span> <span>(</span>target<span>,</span> key<span>,</span> value<span>)</span> <span>{</span>\n    <span>const</span> result <span>=</span> Reflect<span>.</span><span>set</span><span>(</span>target<span>,</span> key<span>,</span> value<span>)</span>\n    console<span>.</span><span>log</span><span>(</span><span>'数据已更新, 去更新界面'</span><span>)</span>\n    <span>return</span> result\n  <span>}</span><span>,</span>\n\n  <span>deleteProperty</span> <span>(</span><span>target<span>,</span> key</span><span>)</span> <span>{</span>\n    <span>const</span> result <span>=</span> Reflect<span>.</span><span>deleteProperty</span><span>(</span>target<span>,</span> key<span>)</span>\n    console<span>.</span><span>log</span><span>(</span><span>'数据已删除, 去更新界面'</span><span>)</span>\n    <span>return</span> result\n  <span>}</span><span>,</span>\n<span>}</span>\n\n<span>/* \n自定义shallowReactive\n*/</span>\n<span>function</span> <span>shallowReactive</span><span>(</span><span>obj</span><span>)</span> <span>{</span>\n  <span>return</span> <span>new</span> <span>Proxy</span><span>(</span>obj<span>,</span> reactiveHandler<span>)</span>\n<span>}</span>\n\n<span>/* \n自定义reactive\n*/</span>\n<span>function</span> <span>reactive</span> <span>(</span><span>target</span><span>)</span> <span>{</span>\n  <span>if</span> <span>(</span>target <span>&amp;&amp;</span> <span>typeof</span> target<span>===</span><span>'object'</span><span>)</span> <span>{</span>\n    <span>if</span> <span>(</span>target <span>instanceof</span> <span>Array</span><span>)</span> <span>{</span> <span>// 数组</span>\n      target<span>.</span><span>forEach</span><span>(</span><span>(</span><span>item<span>,</span> index</span><span>)</span> <span>=></span> <span>{</span>\n        target<span>[</span>index<span>]</span> <span>=</span> <span>reactive</span><span>(</span>item<span>)</span>\n      <span>}</span><span>)</span>\n    <span>}</span> <span>else</span> <span>{</span> <span>// 对象</span>\n      Object<span>.</span><span>keys</span><span>(</span>target<span>)</span><span>.</span><span>forEach</span><span>(</span><span>key</span> <span>=></span> <span>{</span>\n        target<span>[</span>key<span>]</span> <span>=</span> <span>reactive</span><span>(</span>target<span>[</span>key<span>]</span><span>)</span>\n      <span>}</span><span>)</span>\n    <span>}</span>\n\n    <span>const</span> proxy <span>=</span> <span>new</span> <span>Proxy</span><span>(</span>target<span>,</span> reactiveHandler<span>)</span>\n    <span>return</span> proxy\n  <span>}</span>\n\n  <span>return</span> target\n<span>}</span>\n\n\n<span>/* 测试自定义shallowReactive */</span>\n<span>const</span> proxy <span>=</span> <span>shallowReactive</span><span>(</span><span>{</span>\n  <span>a</span><span>:</span> <span>{</span>\n    <span>b</span><span>:</span> <span>3</span>\n  <span>}</span>\n<span>}</span><span>)</span>\n\nproxy<span>.</span>a <span>=</span> <span>{</span><span>b</span><span>:</span> <span>4</span><span>}</span> <span>// 劫持到了</span>\nproxy<span>.</span>a<span>.</span>b <span>=</span> <span>5</span> <span>// 没有劫持到</span>\n\n\n<span>/* 测试自定义reactive */</span>\n<span>const</span> obj <span>=</span> <span>{</span>\n  <span>a</span><span>:</span> <span>'abc'</span><span>,</span>\n  <span>b</span><span>:</span> <span>[</span><span>{</span><span>x</span><span>:</span> <span>1</span><span>}</span><span>]</span><span>,</span>\n  <span>c</span><span>:</span> <span>{</span><span>x</span><span>:</span> <span>[</span><span>11</span><span>]</span><span>}</span><span>,</span>\n<span>}</span>\n\n<span>const</span> proxy <span>=</span> <span>reactive</span><span>(</span>obj<span>)</span>\nconsole<span>.</span><span>log</span><span>(</span>proxy<span>)</span>\nproxy<span>.</span>b<span>[</span><span>0</span><span>]</span><span>.</span>x <span>+=</span> <span>1</span>\nproxy<span>.</span>c<span>.</span>x<span>[</span><span>0</span><span>]</span> <span>+=</span> <span>1</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_2-shallowref-与-ref\" tabindex=\"-1\"> 2) shallowRef 与 ref</h2>\n<div><pre><code><span>/*\n自定义shallowRef\n*/</span>\n<span>function</span> <span>shallowRef</span><span>(</span><span>target</span><span>)</span> <span>{</span>\n  <span>const</span> result <span>=</span> <span>{</span>\n    <span>_value</span><span>:</span> target<span>,</span> <span>// 用来保存数据的内部属性</span>\n    <span>_is_ref</span><span>:</span> <span>true</span><span>,</span> <span>// 用来标识是ref对象</span>\n    <span>get</span> <span>value</span> <span>(</span><span>)</span> <span>{</span>\n      <span>return</span> <span>this</span><span>.</span>_value\n    <span>}</span><span>,</span>\n    <span>set</span> <span>value</span> <span>(</span><span>val</span><span>)</span> <span>{</span>\n      <span>this</span><span>.</span>_value <span>=</span> val\n      console<span>.</span><span>log</span><span>(</span><span>'set value 数据已更新, 去更新界面'</span><span>)</span>\n    <span>}</span>\n  <span>}</span>\n\n  <span>return</span> result\n<span>}</span>\n\n<span>/* \n自定义ref\n*/</span>\n<span>function</span> <span>ref</span><span>(</span><span>target</span><span>)</span> <span>{</span>\n  <span>if</span> <span>(</span>target <span>&amp;&amp;</span> <span>typeof</span> target<span>===</span><span>'object'</span><span>)</span> <span>{</span>\n    target <span>=</span> <span>reactive</span><span>(</span>target<span>)</span>\n  <span>}</span>\n\n  <span>const</span> result <span>=</span> <span>{</span>\n    <span>_value</span><span>:</span> target<span>,</span> <span>// 用来保存数据的内部属性</span>\n    <span>_is_ref</span><span>:</span> <span>true</span><span>,</span> <span>// 用来标识是ref对象</span>\n    <span>get</span> <span>value</span> <span>(</span><span>)</span> <span>{</span>\n      <span>return</span> <span>this</span><span>.</span>_value\n    <span>}</span><span>,</span>\n    <span>set</span> <span>value</span> <span>(</span><span>val</span><span>)</span> <span>{</span>\n      <span>this</span><span>.</span>_value <span>=</span> val\n      console<span>.</span><span>log</span><span>(</span><span>'set value 数据已更新, 去更新界面'</span><span>)</span>\n    <span>}</span>\n  <span>}</span>\n\n  <span>return</span> result\n<span>}</span>\n\n<span>/* 测试自定义shallowRef */</span>\n<span>const</span> ref3 <span>=</span> <span>shallowRef</span><span>(</span><span>{</span>\n  <span>a</span><span>:</span> <span>'abc'</span><span>,</span>\n<span>}</span><span>)</span>\nref3<span>.</span>value <span>=</span> <span>'xxx'</span>\nref3<span>.</span>value<span>.</span>a <span>=</span> <span>'yyy'</span>\n\n\n<span>/* 测试自定义ref */</span>\n<span>const</span> ref1 <span>=</span> <span>ref</span><span>(</span><span>0</span><span>)</span>\n<span>const</span> ref2 <span>=</span> <span>ref</span><span>(</span><span>{</span>\n  <span>a</span><span>:</span> <span>'abc'</span><span>,</span>\n  <span>b</span><span>:</span> <span>[</span><span>{</span><span>x</span><span>:</span> <span>1</span><span>}</span><span>]</span><span>,</span>\n  <span>c</span><span>:</span> <span>{</span><span>x</span><span>:</span> <span>[</span><span>11</span><span>]</span><span>}</span><span>,</span>\n<span>}</span><span>)</span>\nref1<span>.</span>value<span>++</span>\nref2<span>.</span>value<span>.</span>b<span>[</span><span>0</span><span>]</span><span>.</span>x<span>++</span>\nconsole<span>.</span><span>log</span><span>(</span>ref1<span>,</span> ref2<span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_3-shallowreadonly-与-readonly\" tabindex=\"-1\"> 3) shallowReadonly 与 readonly</h2>\n<div><pre><code><span>const</span> readonlyHandler <span>=</span> <span>{</span>\n  <span>get</span> <span>(</span>target<span>,</span> key<span>)</span> <span>{</span>\n    <span>if</span> <span>(</span>key<span>===</span><span>'_is_readonly'</span><span>)</span> <span>return</span> <span>true</span>\n\n    <span>return</span> Reflect<span>.</span><span>get</span><span>(</span>target<span>,</span> key<span>)</span>\n  <span>}</span><span>,</span>\n\n  <span>set</span> <span>(</span><span>)</span> <span>{</span>\n    console<span>.</span><span>warn</span><span>(</span><span>'只读的, 不能修改'</span><span>)</span>\n    <span>return</span> <span>true</span>\n  <span>}</span><span>,</span>\n\n  <span>deleteProperty</span> <span>(</span><span>)</span> <span>{</span>\n    console<span>.</span><span>warn</span><span>(</span><span>'只读的, 不能删除'</span><span>)</span>\n    <span>return</span> <span>true</span>\n  <span>}</span><span>,</span>\n<span>}</span>\n\n<span>/* \n自定义shallowReadonly\n*/</span>\n<span>function</span> <span>shallowReadonly</span><span>(</span><span>obj</span><span>)</span> <span>{</span>\n  <span>return</span> <span>new</span> <span>Proxy</span><span>(</span>obj<span>,</span> readonlyHandler<span>)</span>\n<span>}</span>\n\n<span>/* \n自定义readonly\n*/</span>\n<span>function</span> <span>readonly</span><span>(</span><span>target</span><span>)</span> <span>{</span>\n  <span>if</span> <span>(</span>target <span>&amp;&amp;</span> <span>typeof</span> target<span>===</span><span>'object'</span><span>)</span> <span>{</span>\n    <span>if</span> <span>(</span>target <span>instanceof</span> <span>Array</span><span>)</span> <span>{</span> <span>// 数组</span>\n      target<span>.</span><span>forEach</span><span>(</span><span>(</span><span>item<span>,</span> index</span><span>)</span> <span>=></span> <span>{</span>\n        target<span>[</span>index<span>]</span> <span>=</span> <span>readonly</span><span>(</span>item<span>)</span>\n      <span>}</span><span>)</span>\n    <span>}</span> <span>else</span> <span>{</span> <span>// 对象</span>\n      Object<span>.</span><span>keys</span><span>(</span>target<span>)</span><span>.</span><span>forEach</span><span>(</span><span>key</span> <span>=></span> <span>{</span>\n        target<span>[</span>key<span>]</span> <span>=</span> <span>readonly</span><span>(</span>target<span>[</span>key<span>]</span><span>)</span>\n      <span>}</span><span>)</span>\n    <span>}</span>\n    <span>const</span> proxy <span>=</span> <span>new</span> <span>Proxy</span><span>(</span>target<span>,</span> readonlyHandler<span>)</span>\n\n    <span>return</span> proxy \n  <span>}</span>\n\n  <span>return</span> target\n<span>}</span>\n\n<span>/* 测试自定义readonly */</span>\n<span>/* 测试自定义shallowReadonly */</span>\n<span>const</span> objReadOnly <span>=</span> <span>readonly</span><span>(</span><span>{</span>\n  <span>a</span><span>:</span> <span>{</span>\n    <span>b</span><span>:</span> <span>1</span>\n  <span>}</span>\n<span>}</span><span>)</span>\n<span>const</span> objReadOnly2 <span>=</span> <span>shallowReadonly</span><span>(</span><span>{</span>\n  <span>a</span><span>:</span> <span>{</span>\n    <span>b</span><span>:</span> <span>1</span>\n  <span>}</span>\n<span>}</span><span>)</span>\n\nobjReadOnly<span>.</span>a <span>=</span> <span>1</span>\nobjReadOnly<span>.</span>a<span>.</span>b <span>=</span> <span>2</span>\nobjReadOnly2<span>.</span>a <span>=</span> <span>1</span>\nobjReadOnly2<span>.</span>a<span>.</span>b <span>=</span> <span>2</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_4-isref-isreactive-与-isreadonly\" tabindex=\"-1\"> 4) isRef, isReactive 与 isReadonly</h2>\n<div><pre><code><span>/* \n判断是否是ref对象\n*/</span>\n<span>function</span> <span>isRef</span><span>(</span><span>obj</span><span>)</span> <span>{</span>\n  <span>return</span> obj <span>&amp;&amp;</span> obj<span>.</span>_is_ref\n<span>}</span>\n\n<span>/* \n判断是否是reactive对象\n*/</span>\n<span>function</span> <span>isReactive</span><span>(</span><span>obj</span><span>)</span> <span>{</span>\n  <span>return</span> obj <span>&amp;&amp;</span> obj<span>.</span>_is_reactive\n<span>}</span>\n\n<span>/* \n判断是否是readonly对象\n*/</span>\n<span>function</span> <span>isReadonly</span><span>(</span><span>obj</span><span>)</span> <span>{</span>\n  <span>return</span> obj <span>&amp;&amp;</span> obj<span>.</span>_is_readonly\n<span>}</span>\n\n<span>/* \n是否是reactive或readonly产生的代理对象\n*/</span>\n<span>function</span> <span>isProxy</span> <span>(</span><span>obj</span><span>)</span> <span>{</span>\n  <span>return</span> <span>isReactive</span><span>(</span>obj<span>)</span> <span>||</span> <span>isReadonly</span><span>(</span>obj<span>)</span>\n<span>}</span>\n\n\n<span>/* 测试判断函数 */</span>\nconsole<span>.</span><span>log</span><span>(</span><span>isReactive</span><span>(</span><span>reactive</span><span>(</span><span>{</span><span>}</span><span>)</span><span>)</span><span>)</span>\nconsole<span>.</span><span>log</span><span>(</span><span>isRef</span><span>(</span><span>ref</span><span>(</span><span>{</span><span>}</span><span>)</span><span>)</span><span>)</span>\nconsole<span>.</span><span>log</span><span>(</span><span>isReadonly</span><span>(</span><span>readonly</span><span>(</span><span>{</span><span>}</span><span>)</span><span>)</span><span>)</span>\nconsole<span>.</span><span>log</span><span>(</span><span>isProxy</span><span>(</span><span>reactive</span><span>(</span><span>{</span><span>}</span><span>)</span><span>)</span><span>)</span>\nconsole<span>.</span><span>log</span><span>(</span><span>isProxy</span><span>(</span><span>readonly</span><span>(</span><span>{</span><span>}</span><span>)</span><span>)</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "date_published": "2022-08-01T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "Composition API VS Option API",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter4/04_Composition%20VS%20Option.html",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter4/04_Composition%20VS%20Option.html",
      "content_html": "<h1 id=\"_4-composition-api-vs-option-api\" tabindex=\"-1\"> 4. Composition API VS Option API</h1>\n<h2 id=\"_1-option-api的问题\" tabindex=\"-1\"> 1) Option API的问题</h2>\n<ul>\n<li>在传统的Vue OptionsAPI中，新增或者修改一个需求，就需要分别在data，methods，computed里修改 ，滚动条反复上下移动</li>\n</ul>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f84e4e2c02424d9a99862ade0a2e4114~tplv-k3u1fbpfcp-watermark.image\" alt=\"\"></p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e5ac7e20d1784887a826f6360768a368~tplv-k3u1fbpfcp-watermark.image\" alt=\"\"></p>\n<h2 id=\"_2-使用compisition-api\" tabindex=\"-1\"> 2) 使用Compisition API</h2>\n<p>我们可以更加优雅的组织我们的代码，函数。让相关功能的代码更加有序的组织在一起</p>\n<p><img src=\"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc0be8211fc54b6c941c036791ba4efe~tplv-k3u1fbpfcp-watermark.image\" alt=\"\"></p>\n<p><img src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6cc55165c0e34069a75fe36f8712eb80~tplv-k3u1fbpfcp-watermark.image\" alt=\"\"></p>\n<p><img src=\"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2c421e5392504ecc94c222057dba338a~tplv-k3u1fbpfcp-watermark.image\" alt=\"\"></p>\n",
      "image": "https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f84e4e2c02424d9a99862ade0a2e4114~tplv-k3u1fbpfcp-watermark.image",
      "date_published": "2022-08-02T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "4.Composition API",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter4/",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter4/",
      "summary": "Composition API",
      "content_html": "<p align=\"center\"> \n  <img src=\"https://metrics.lecoq.io/xlc520?template=classic&isocalendar=1&languages=1&people=1&activity=1&achievements=1&lines=1&repositories=1&notable=1&introduction=1&pagespeed=1&repositories=100&repositories.batch=100&repositories.forks=false&repositories.affiliations=owner&isocalendar.duration=full-year&languages.limit=8&languages.threshold=0%&languages.colors=github&languages.sections=most-used&languages.indepth=false&languages.analysis.timeout=15&languages.categories=markup%2C programming&languages.recent.categories=markup%2C programming&languages.recent.load=300&languages.recent.days=14&people.limit=24&people.identicons=false&people.identicons.hide=false&people.size=28&people.types=followers%2C following&people.shuffle=false&activity.limit=5&activity.load=300&activity.days=14&activity.visibility=all&activity.timestamps=false&activity.filter=all&achievements.threshold=C&achievements.secrets=true&achievements.display=detailed&achievements.limit=0&notable.from=organization&notable.repositories=false&notable.indepth=false&notable.types=commit&repositories.featured= xlc520%2Fxlc520.github.io&introduction.title=true&pagespeed.url=xlc520.github.io&pagespeed.detailed=false&pagespeed.screenshot=false&config.timezone=Asia%2FShanghai\" /> \n</p>\n<p align=\"center\"> \n  您是第  <img src=\"https://profile-counter.glitch.me/xlc520/count.svg\" />  位访问者\n</p>",
      "date_published": "2022-07-17T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "新组件",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter5/01_%E6%96%B0%E7%BB%84%E4%BB%B6.html",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter5/01_%E6%96%B0%E7%BB%84%E4%BB%B6.html",
      "content_html": "<h1 id=\"_1-新组件\" tabindex=\"-1\"> 1.  新组件</h1>\n<h2 id=\"_1-fragment-片断\" tabindex=\"-1\"> 1) Fragment(片断)</h2>\n<ul>\n<li>在Vue2中: 组件必须有一个根标签</li>\n<li>在Vue3中: 组件可以没有根标签, 内部会将多个标签包含在一个Fragment虚拟元素中</li>\n<li>好处: 减少标签层级, 减小内存占用</li>\n</ul>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n    <span><span><span>&lt;</span>h2</span><span>></span></span>aaaa<span><span><span>&lt;/</span>h2</span><span>></span></span>\n    <span><span><span>&lt;</span>h2</span><span>></span></span>aaaa<span><span><span>&lt;/</span>h2</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><h2 id=\"_2-teleport-瞬移\" tabindex=\"-1\"> 2) Teleport(瞬移)</h2>\n<ul>\n<li>Teleport 提供了一种干净的方法, 让组件的html在父组件界面外的特定标签(很可能是body)下插入显示</li>\n</ul>\n<p>ModalButton.vue</p>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>modalOpen = true<span>\"</span></span><span>></span></span>\n      Open full screen modal! (With teleport!)\n  <span><span><span>&lt;/</span>button</span><span>></span></span>\n\n  <span><span><span>&lt;</span>teleport</span> <span>to</span><span><span>=</span><span>\"</span>body<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>div</span> <span>v-if</span><span><span>=</span><span>\"</span>modalOpen<span>\"</span></span> <span>class</span><span><span>=</span><span>\"</span>modal<span>\"</span></span><span>></span></span>\n      <span><span><span>&lt;</span>div</span><span>></span></span>\n        I'm a teleported modal! \n        (My parent is \"body\")\n        <span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>modalOpen = false<span>\"</span></span><span>></span></span>\n          Close\n        <span><span><span>&lt;/</span>button</span><span>></span></span>\n      <span><span><span>&lt;/</span>div</span><span>></span></span>\n    <span><span><span>&lt;/</span>div</span><span>></span></span>\n  <span><span><span>&lt;/</span>teleport</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span><span>></span></span><span><span>\n<span>import</span> <span>{</span> ref <span>}</span> <span>from</span> <span>'vue'</span>\n<span>export</span> <span>default</span> <span>{</span>\n  <span>name</span><span>:</span> <span>'modal-button'</span><span>,</span>\n  <span>setup</span> <span>(</span><span>)</span> <span>{</span>\n    <span>const</span> modalOpen <span>=</span> <span>ref</span><span>(</span><span>false</span><span>)</span>\n    <span>return</span> <span>{</span>\n      modalOpen\n    <span>}</span>\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n\n\n<span><span><span>&lt;</span>style</span><span>></span></span><span><span>\n<span>.modal</span> <span>{</span>\n  <span>position</span><span>:</span> absolute<span>;</span>\n  <span>top</span><span>:</span> 0<span>;</span> <span>right</span><span>:</span> 0<span>;</span> <span>bottom</span><span>:</span> 0<span>;</span> <span>left</span><span>:</span> 0<span>;</span>\n  <span>background-color</span><span>:</span> <span>rgba</span><span>(</span>0<span>,</span>0<span>,</span>0<span>,</span>.5<span>)</span><span>;</span>\n  <span>display</span><span>:</span> flex<span>;</span>\n  <span>flex-direction</span><span>:</span> column<span>;</span>\n  <span>align-items</span><span>:</span> center<span>;</span>\n  <span>justify-content</span><span>:</span> center<span>;</span>\n<span>}</span>\n\n<span>.modal div</span> <span>{</span>\n  <span>display</span><span>:</span> flex<span>;</span>\n  <span>flex-direction</span><span>:</span> column<span>;</span>\n  <span>align-items</span><span>:</span> center<span>;</span>\n  <span>justify-content</span><span>:</span> center<span>;</span>\n  <span>background-color</span><span>:</span> white<span>;</span>\n  <span>width</span><span>:</span> 300px<span>;</span>\n  <span>height</span><span>:</span> 300px<span>;</span>\n  <span>padding</span><span>:</span> 5px<span>;</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>style</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>App.vue</p>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>App<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span><span><span>&lt;</span>modal-button</span><span>></span></span><span><span><span>&lt;/</span>modal-button</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>import</span> ModalButton <span>from</span> <span>'./ModalButton.vue'</span>\n\n<span>export</span> <span>default</span> <span>{</span>\n  <span>setup</span><span>(</span><span>)</span> <span>{</span>\n    <span>return</span> <span>{</span>\n    <span>}</span>\n  <span>}</span><span>,</span>\n\n  <span>components</span><span>:</span> <span>{</span>\n    ModalButton\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_3-suspense-不确定的\" tabindex=\"-1\"> 3) Suspense(不确定的)</h2>\n<ul>\n<li>它们允许我们的应用程序在等待异步组件时渲染一些后备内容，可以让我们创建一个平滑的用户体验</li>\n</ul>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>Suspense</span><span>></span></span>\n    <span><span><span>&lt;</span>template</span> <span><span>v-slot:</span>default</span><span>></span></span>\n      <span><span><span>&lt;</span>AsyncComp</span><span>/></span></span>\n      <span>&lt;!-- &lt;AsyncAddress/> --></span>\n    <span><span><span>&lt;/</span>template</span><span>></span></span>\n\n    <span><span><span>&lt;</span>template</span> <span><span>v-slot:</span>fallback</span><span>></span></span>\n      <span><span><span>&lt;</span>h1</span><span>></span></span>LOADING...<span><span><span>&lt;/</span>h1</span><span>></span></span>\n    <span><span><span>&lt;/</span>template</span><span>></span></span>\n  <span><span><span>&lt;/</span>Suspense</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>/* \n异步组件 + Suspense组件\n*/</span>\n<span>// import AsyncComp from './AsyncComp.vue'</span>\n<span>import</span> AsyncAddress <span>from</span> <span>'./AsyncAddress.vue'</span>\n<span>import</span> <span>{</span> defineAsyncComponent <span>}</span> <span>from</span> <span>'vue'</span>\n<span>const</span> AsyncComp <span>=</span> <span>defineAsyncComponent</span><span>(</span><span>(</span><span>)</span> <span>=></span> <span>import</span><span>(</span><span>'./AsyncComp.vue'</span><span>)</span><span>)</span>\n<span>export</span> <span>default</span> <span>{</span>\n  <span>setup</span><span>(</span><span>)</span> <span>{</span>\n    <span>return</span> <span>{</span>\n     \n    <span>}</span>\n  <span>}</span><span>,</span>\n\n  <span>components</span><span>:</span> <span>{</span>\n    AsyncComp<span>,</span>\n    AsyncAddress\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><ul>\n<li>AsyncComp.vue</li>\n</ul>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n  <span><span><span>&lt;</span>h2</span><span>></span></span>AsyncComp22<span><span><span>&lt;/</span>h2</span><span>></span></span>\n  <span><span><span>&lt;</span>p</span><span>></span></span>{{msg}}<span><span><span>&lt;/</span>p</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n\n<span>export</span> <span>default</span> <span>{</span>\n  <span>name</span><span>:</span> <span>'AsyncComp'</span><span>,</span>\n  <span>setup</span> <span>(</span><span>)</span> <span>{</span>\n    <span>// return new Promise((resolve, reject) => {</span>\n    <span>//   setTimeout(() => {</span>\n    <span>//     resolve({</span>\n    <span>//       msg: 'abc'</span>\n    <span>//     })</span>\n    <span>//   }, 2000)</span>\n    <span>// })</span>\n    <span>return</span> <span>{</span>\n      <span>msg</span><span>:</span> <span>'abc'</span>\n    <span>}</span>\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><ul>\n<li>AsyncAddress.vue</li>\n</ul>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n<span><span><span>&lt;</span>h2</span><span>></span></span>{{data}}<span><span><span>&lt;/</span>h2</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>lang</span><span><span>=</span><span>\"</span>ts<span>\"</span></span><span>></span></span><span><span>\n<span>import</span> axios <span>from</span> <span>'axios'</span>\n<span>export</span> <span>default</span> <span>{</span>\n  <span>async</span> <span>setup</span><span>(</span><span>)</span> <span>{</span>\n    <span>const</span> result <span>=</span> <span>await</span> axios<span>.</span><span>get</span><span>(</span><span>'/data/address.json'</span><span>)</span>\n    <span>return</span> <span>{</span>\n      <span>data</span><span>:</span> result<span>.</span>data\n    <span>}</span>\n  <span>}</span>\n<span>}</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "date_published": "2022-08-03T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "其他新的API",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter5/02_%E5%85%B6%E4%BB%96%E6%96%B0API.html",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter5/02_%E5%85%B6%E4%BB%96%E6%96%B0API.html",
      "content_html": "<h1 id=\"_2-其他新的api\" tabindex=\"-1\"> 2. 其他新的API</h1>\n<h2 id=\"全新的全局api\" tabindex=\"-1\"> 全新的全局API</h2>\n<ul>\n<li>createApp()</li>\n<li>defineProperty()</li>\n<li>defineAsyncComponent()</li>\n<li>nextTick()</li>\n</ul>\n<h2 id=\"将原来的全局api转移到应用对象\" tabindex=\"-1\"> 将原来的全局API转移到应用对象</h2>\n<ul>\n<li>app.component()</li>\n<li>app.config()</li>\n<li>app.directive()</li>\n<li>app.mount()</li>\n<li>app.unmount()</li>\n<li>app.use()</li>\n</ul>\n<h2 id=\"模板语法变化\" tabindex=\"-1\"> 模板语法变化</h2>\n<ul>\n<li>v-model的本质变化\n<ul>\n<li>prop：value -&gt; modelValue；</li>\n<li>event：input -&gt; update:modelValue；</li>\n</ul>\n</li>\n<li>.sync修改符已移除, 由v-model代替\n<ul>\n<li><code>&lt;ChildComponent v-model:title=&quot;pageTitle&quot; v-model:content=&quot;pageContent&quot; /&gt;</code></li>\n</ul>\n</li>\n<li>v-if优先v-for解析</li>\n</ul>\n",
      "date_published": "2022-08-04T00:00:00.000Z",
      "date_modified": "2022-07-13T10:34:11.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "5.其它新组合和API",
      "url": "https://blog.ciberviler.top/study/vue3_quick_study/chapter5/",
      "id": "https://blog.ciberviler.top/study/vue3_quick_study/chapter5/",
      "summary": "其它新组合和API",
      "content_html": "<p align=\"center\"> \n  <img src=\"https://metrics.lecoq.io/xlc520?template=classic&isocalendar=1&languages=1&people=1&activity=1&achievements=1&lines=1&repositories=1&notable=1&introduction=1&pagespeed=1&repositories=100&repositories.batch=100&repositories.forks=false&repositories.affiliations=owner&isocalendar.duration=full-year&languages.limit=8&languages.threshold=0%&languages.colors=github&languages.sections=most-used&languages.indepth=false&languages.analysis.timeout=15&languages.categories=markup%2C programming&languages.recent.categories=markup%2C programming&languages.recent.load=300&languages.recent.days=14&people.limit=24&people.identicons=false&people.identicons.hide=false&people.size=28&people.types=followers%2C following&people.shuffle=false&activity.limit=5&activity.load=300&activity.days=14&activity.visibility=all&activity.timestamps=false&activity.filter=all&achievements.threshold=C&achievements.secrets=true&achievements.display=detailed&achievements.limit=0&notable.from=organization&notable.repositories=false&notable.indepth=false&notable.types=commit&repositories.featured= xlc520%2Fxlc520.github.io&introduction.title=true&pagespeed.url=xlc520.github.io&pagespeed.detailed=false&pagespeed.screenshot=false&config.timezone=Asia%2FShanghai\" /> \n</p>\n<p align=\"center\"> \n  您是第  <img src=\"https://profile-counter.glitch.me/xlc520/count.svg\" />  位访问者\n</p>",
      "date_published": "2022-07-17T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Vue"
      ]
    },
    {
      "title": "SpringBoot 并行任务",
      "url": "https://blog.ciberviler.top/dev/SpringBoot%E5%B9%B6%E8%A1%8C%E4%BB%BB%E5%8A%A1.html",
      "id": "https://blog.ciberviler.top/dev/SpringBoot%E5%B9%B6%E8%A1%8C%E4%BB%BB%E5%8A%A1.html",
      "content_html": "<h1 id=\"springboot-并行任务\" tabindex=\"-1\"> SpringBoot 并行任务</h1>\n<h2 id=\"第一种-把参数配置到-properties文件中\" tabindex=\"-1\"> 第一种：把参数配置到.properties文件中：</h2>\n<p>代码：</p>\n<div><pre><code><span>package</span> <span>com<span>.</span>accord<span>.</span>task</span><span>;</span>\n \n<span>import</span> <span><span>java<span>.</span>text<span>.</span></span><span>SimpleDateFormat</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Date</span></span><span>;</span>\n \n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>scheduling<span>.</span>annotation<span>.</span></span><span>Scheduled</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>stereotype<span>.</span></span><span>Component</span></span><span>;</span>\n \n<span>/**\n * 从配置文件加载任务信息\n * <span>@author</span> 王久印\n */</span>\n<span>@Component</span>\n<span>public</span> <span>class</span> <span>ScheduledTask</span> <span>{</span>\n \n  <span>private</span> <span>static</span> <span>final</span> <span>SimpleDateFormat</span> dateFormat <span>=</span> <span>new</span> <span>SimpleDateFormat</span><span>(</span><span>\"HH:mm:ss\"</span><span>)</span><span>;</span>\n \n  <span>//@Scheduled(fixedDelayString = \"${jobs.fixedDelay}\")</span>\n  <span>@Scheduled</span><span>(</span>fixedDelayString <span>=</span> <span>\"2000\"</span><span>)</span>\n  <span>public</span> <span>void</span> <span>getTask1</span><span>(</span><span>)</span> <span>{</span>\n    <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"任务1,从配置文件加载任务信息，当前时间：\"</span> <span>+</span> dateFormat<span>.</span><span>format</span><span>(</span><span>new</span> <span>Date</span><span>(</span><span>)</span><span>)</span><span>)</span><span>;</span>\n  <span>}</span>\n \n  <span>@Scheduled</span><span>(</span>cron <span>=</span> <span>\"${jobs.cron}\"</span><span>)</span>\n  <span>public</span> <span>void</span> <span>getTask2</span><span>(</span><span>)</span> <span>{</span>\n    <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"任务2,从配置文件加载任务信息，当前时间：\"</span> <span>+</span> dateFormat<span>.</span><span>format</span><span>(</span><span>new</span> <span>Date</span><span>(</span><span>)</span><span>)</span><span>)</span><span>;</span>\n  <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>application.properties文件：</p>\n<div><pre><code>jobs.fixedDelay=5000\njobs.cron=0/5 * *  * * ?\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>SpringBootCron2Application.java中：</p>\n<div><pre><code><span>package</span> <span>com<span>.</span>accord</span><span>;</span>\n \n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>boot<span>.</span></span><span>SpringApplication</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>boot<span>.</span>autoconfigure<span>.</span></span><span>SpringBootApplication</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>scheduling<span>.</span>annotation<span>.</span></span><span>EnableScheduling</span></span><span>;</span>\n \n<span>@SpringBootApplication</span>\n<span>@EnableScheduling</span>\n<span>public</span> <span>class</span> <span>SpringBootCron2Application</span> <span>{</span>\n <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>{</span>\n  <span>SpringApplication</span><span>.</span><span>run</span><span>(</span><span>SpringBootCron2Application</span><span>.</span><span>class</span><span>,</span> args<span>)</span><span>;</span>\n <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><blockquote>\n<p>注：@EnableScheduling  这个一定要加上；否则，不会定时启动任务！</p>\n</blockquote>\n<p>@Scheduled中的参数说明：</p>\n<ul>\n<li><code>@Scheduled(fixedRate=2000)</code>：上一次开始执行时间点后2秒再次执行；</li>\n<li><code>@Scheduled(fixedDelay=2000)</code>：上一次执行完毕时间点后2秒再次执行；</li>\n<li><code>@Scheduled(initialDelay=1000, fixedDelay=2000)</code>：第一次延迟1秒执行，然后在上一次执行完毕时间点后2秒再次执行；</li>\n<li><code>@Scheduled(cron=&quot;* * * * * ?&quot;)</code>：按cron规则执行。</li>\n</ul>\n<p>在线Cron表达式生成器：<code>http://cron.qqe2.com/</code></p>\n<h2 id=\"第二种定时任务-单线程和多线程\" tabindex=\"-1\"> 第二种定时任务：单线程和多线程</h2>\n<h3 id=\"_1、创建定时任务\" tabindex=\"-1\"> 1、创建定时任务：</h3>\n<div><pre><code><span>package</span> <span>com<span>.</span>accord<span>.</span>task</span><span>;</span>\n \n<span>import</span> <span><span>org<span>.</span>slf4j<span>.</span></span><span>Logger</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>slf4j<span>.</span></span><span>LoggerFactory</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>scheduling<span>.</span>annotation<span>.</span></span><span>Scheduled</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>stereotype<span>.</span></span><span>Component</span></span><span>;</span>\n \n<span>/**\n * 构建执行定时任务\n * <span>@author</span> 王久印\n * TODO\n */</span>\n<span>@Component</span>\n<span>public</span> <span>class</span> <span>ScheduledTask2</span> <span>{</span>\n \n    <span>private</span> <span>Logger</span> logger <span>=</span> <span>LoggerFactory</span><span>.</span><span>getLogger</span><span>(</span><span>ScheduledTask2</span><span>.</span><span>class</span><span>)</span><span>;</span>\n \n    <span>private</span> <span>int</span> fixedDelayCount <span>=</span> <span>1</span><span>;</span>\n    <span>private</span> <span>int</span> fixedRateCount <span>=</span> <span>1</span><span>;</span>\n    <span>private</span> <span>int</span> initialDelayCount <span>=</span> <span>1</span><span>;</span>\n    <span>private</span> <span>int</span> cronCount <span>=</span> <span>1</span><span>;</span>\n \n    <span>@Scheduled</span><span>(</span>fixedDelay <span>=</span> <span>5000</span><span>)</span>        <span>//fixedDelay = 5000表示当前方法执行完毕5000ms后，Spring scheduling会再次调用该方法</span>\n    <span>public</span> <span>void</span> <span>testFixDelay</span><span>(</span><span>)</span> <span>{</span>\n        logger<span>.</span><span>info</span><span>(</span><span>\"===fixedDelay: 第{}次执行方法\"</span><span>,</span> fixedDelayCount<span>++</span><span>)</span><span>;</span>\n    <span>}</span>\n \n    <span>@Scheduled</span><span>(</span>fixedRate <span>=</span> <span>5000</span><span>)</span>        <span>//fixedRate = 5000表示当前方法开始执行5000ms后，Spring scheduling会再次调用该方法</span>\n    <span>public</span> <span>void</span> <span>testFixedRate</span><span>(</span><span>)</span> <span>{</span>\n        logger<span>.</span><span>info</span><span>(</span><span>\"===fixedRate: 第{}次执行方法\"</span><span>,</span> fixedRateCount<span>++</span><span>)</span><span>;</span>\n    <span>}</span>\n \n    <span>@Scheduled</span><span>(</span>initialDelay <span>=</span> <span>1000</span><span>,</span> fixedRate <span>=</span> <span>5000</span><span>)</span>   <span>//initialDelay = 1000表示延迟1000ms执行第一次任务</span>\n    <span>public</span> <span>void</span> <span>testInitialDelay</span><span>(</span><span>)</span> <span>{</span>\n        logger<span>.</span><span>info</span><span>(</span><span>\"===initialDelay: 第{}次执行方法\"</span><span>,</span> initialDelayCount<span>++</span><span>)</span><span>;</span>\n    <span>}</span>\n \n    <span>@Scheduled</span><span>(</span>cron <span>=</span> <span>\"0 0/1 * * * ?\"</span><span>)</span>  <span>//cron接受cron表达式，根据cron表达式确定定时规则</span>\n    <span>public</span> <span>void</span> <span>testCron</span><span>(</span><span>)</span> <span>{</span>\n        logger<span>.</span><span>info</span><span>(</span><span>\"===initialDelay: 第{}次执行方法\"</span><span>,</span> cronCount<span>++</span><span>)</span><span>;</span>\n    <span>}</span>\n \n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>使用 @Scheduled来创建定时任务 这个注解用来标注一个定时任务方法。</p>\n<p>通过看 @Scheduled源码可以看出它支持多种参数：</p>\n<ul>\n<li>cron：cron表达式，指定任务在特定时间执行；</li>\n<li>fixedDelay：表示上一次任务执行完成后多久再次执行，参数类型为long，单位ms；</li>\n<li>fixedDelayString：与fixedDelay含义一样，只是参数类型变为String；</li>\n<li>fixedRate：表示按一定的频率执行任务，参数类型为long，单位ms；</li>\n<li>fixedRateString: 与fixedRate的含义一样，只是将参数类型变为String；</li>\n<li>initialDelay：表示延迟多久再第一次执行任务，参数类型为long，单位ms；</li>\n<li>initialDelayString：与initialDelay的含义一样，只是将参数类型变为String；</li>\n<li>zone：时区，默认为当前时区，一般没有用到。</li>\n<li></li>\n</ul>\n<h3 id=\"_2、开启定时任务\" tabindex=\"-1\"> 2、开启定时任务：</h3>\n<div><pre><code><span>package</span> <span>com<span>.</span>accord</span><span>;</span>\n \n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>boot<span>.</span></span><span>SpringApplication</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>boot<span>.</span>autoconfigure<span>.</span></span><span>SpringBootApplication</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>scheduling<span>.</span>annotation<span>.</span></span><span>EnableScheduling</span></span><span>;</span>\n \n<span>@SpringBootApplication</span>\n<span>@EnableScheduling</span>\n<span>public</span> <span>class</span> <span>SpringBootCron2Application</span> <span>{</span>\n <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>{</span>\n  <span>SpringApplication</span><span>.</span><span>run</span><span>(</span><span>SpringBootCron2Application</span><span>.</span><span>class</span><span>,</span> args<span>)</span><span>;</span>\n <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><blockquote>\n<p>注：这里的 @EnableScheduling  注解，它的作用是发现注解 @Scheduled的任务并由后台执行。没有它的话将无法执行定时任务。</p>\n</blockquote>\n<p>引用官方文档原文：</p>\n<blockquote>\n<p>@EnableScheduling ensures that a background task executor is created. Without it, nothing gets scheduled.</p>\n</blockquote>\n<h3 id=\"_3、执行结果-单线程\" tabindex=\"-1\"> 3、执行结果（单线程）</h3>\n<p>就完成了一个简单的定时任务模型，下面执行springBoot观察执行结果：</p>\n<p>[<img src=\"https://img-blog.csdn.net/20180301143615719\" alt=\"图片\"></p>\n<p>从控制台输入的结果中我们可以看出所有的定时任务都是在同一个线程池用同一个线程来处理的，那么我们如何来并发的处理各定时任务呢，请继续向下看。</p>\n<h3 id=\"_4、多线程处理定时任务\" tabindex=\"-1\"> 4、多线程处理定时任务：</h3>\n<p>看到控制台输出的结果，所有的定时任务都是通过一个线程来处理的，我估计是在定时任务的配置中设定了一个<code>SingleThreadScheduledExecutor</code>，于是我看了源码，从<code>ScheduledAnnotationBeanPostProcessor</code>类开始一路找下去。果然，在<code>ScheduledTaskRegistrar</code>（定时任务注册类）中的<code>ScheduleTasks</code>中又这样一段判断：</p>\n<div><pre><code><span>if</span> <span>(</span><span>this</span><span>.</span>taskScheduler <span>==</span> <span>null</span><span>)</span> <span>{</span>\n <span>this</span><span>.</span>localExecutor <span>=</span> <span>Executors</span><span>.</span><span>newSingleThreadScheduledExecutor</span><span>(</span><span>)</span><span>;</span>\n <span>this</span><span>.</span>taskScheduler <span>=</span> <span>new</span> <span>ConcurrentTaskScheduler</span><span>(</span><span>this</span><span>.</span>localExecutor<span>)</span><span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>这就说明如果<code>taskScheduler</code>为空，那么就给定时任务做了一个单线程的线程池，正好在这个类中还有一个设置<code>taskScheduler</code>的方法：</p>\n<div><pre><code><span>public</span> <span>void</span> <span>setScheduler</span><span>(</span><span>Object</span> scheduler<span>)</span> <span>{</span>\n <span>Assert</span><span>.</span><span>notNull</span><span>(</span>scheduler<span>,</span> <span>\"Scheduler object must not be null\"</span><span>)</span><span>;</span>\n <span>if</span> <span>(</span>scheduler <span>instanceof</span> <span>TaskScheduler</span><span>)</span> <span>{</span>\n  <span>this</span><span>.</span>taskScheduler <span>=</span> <span>(</span><span>TaskScheduler</span><span>)</span> scheduler<span>;</span>\n <span>}</span>\n <span>else</span> <span>if</span> <span>(</span>scheduler <span>instanceof</span> <span>ScheduledExecutorService</span><span>)</span> <span>{</span>\n  <span>this</span><span>.</span>taskScheduler <span>=</span> <span>new</span> <span>ConcurrentTaskScheduler</span><span>(</span><span>(</span><span>(</span><span>ScheduledExecutorService</span><span>)</span> scheduler<span>)</span><span>)</span><span>;</span>\n <span>}</span>\n <span>else</span> <span>{</span>\n  <span>throw</span> <span>new</span> <span>IllegalArgumentException</span><span>(</span><span>\"Unsupported scheduler type: \"</span> <span>+</span> scheduler<span>.</span><span>getClass</span><span>(</span><span>)</span><span>)</span><span>;</span>\n <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>这样问题就很简单了，我们只需用调用这个方法显式的设置一个<code>ScheduledExecutorService</code>就可以达到并发的效果了。我们要做的仅仅是实现<code>SchedulingConfigurer</code>接口，重写<code>configureTasks</code>方法就OK了；</p>\n<div><pre><code><span>package</span> <span>com<span>.</span>accord<span>.</span>task</span><span>;</span>\n \n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>context<span>.</span>annotation<span>.</span></span><span>Configuration</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>scheduling<span>.</span>annotation<span>.</span></span><span>SchedulingConfigurer</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>scheduling<span>.</span>config<span>.</span></span><span>ScheduledTaskRegistrar</span></span><span>;</span>\n \n<span>import</span> <span><span>java<span>.</span>util<span>.</span>concurrent<span>.</span></span><span>Executors</span></span><span>;</span>\n \n<span>/**\n * 多线程执行定时任务\n * <span>@author</span> 王久印\n */</span>\n<span>@Configuration</span>\n<span>//所有的定时任务都放在一个线程池中，定时任务启动时使用不同都线程。</span>\n<span>public</span> <span>class</span> <span>ScheduleConfig</span> <span>implements</span> <span>SchedulingConfigurer</span> <span>{</span>\n    <span>@Override</span>\n    <span>public</span> <span>void</span> <span>configureTasks</span><span>(</span><span>ScheduledTaskRegistrar</span> taskRegistrar<span>)</span> <span>{</span>\n        <span>//设定一个长度10的定时任务线程池</span>\n        taskRegistrar<span>.</span><span>setScheduler</span><span>(</span><span>Executors</span><span>.</span><span>newScheduledThreadPool</span><span>(</span><span>10</span><span>)</span><span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>通过控制台输出的结果看出每个定时任务都是在通过不同的线程来处理了。</p>\n",
      "image": "https://img-blog.csdn.net/20180301143615719",
      "date_published": "2022-07-16T00:00:00.000Z",
      "date_modified": "2022-07-04T01:01:50.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "金额计算BigDecimal及踩坑",
      "url": "https://blog.ciberviler.top/dev/%E9%87%91%E9%A2%9D%E8%AE%A1%E7%AE%97BigDecimal%E5%8F%8A%E8%B8%A9%E5%9D%91.html",
      "id": "https://blog.ciberviler.top/dev/%E9%87%91%E9%A2%9D%E8%AE%A1%E7%AE%97BigDecimal%E5%8F%8A%E8%B8%A9%E5%9D%91.html",
      "content_html": "<h1 id=\"金额计算bigdecimal及踩坑\" tabindex=\"-1\"> 金额计算BigDecimal及踩坑</h1>\n<p>除非在一些非常简单的场景，结算汇金类的业务也不会直接用<code>BigDecimal</code>来计算金额，原因有两点：</p>\n<ol>\n<li><code>BigDecimal</code>里面还是有很多隐蔽的坑的</li>\n<li><code>BigDecimal</code>没有提供金额的单位</li>\n</ol>\n<h2 id=\"_1-bigdecimal中的五个容易踩的坑\" tabindex=\"-1\"> 1. <code>BigDecimal</code>中的五个容易踩的坑</h2>\n<h3 id=\"_1-1-new-bigdecimal-还是bigdecimal-valueof\" tabindex=\"-1\"> 1.1 <code>new BigDecimal()</code>还是<code>BigDecimal#valueOf()</code>？</h3>\n<p>先看下面这段代码</p>\n<div><pre><code><span>BigDecimal</span> bd1 <span>=</span> <span>new</span> <span>BigDecimal</span><span>(</span><span>0.01</span><span>)</span><span>;</span>\n<span>BigDecimal</span> bd2 <span>=</span> <span>BigDecimal</span><span>.</span><span>valueOf</span><span>(</span><span>0.01</span><span>)</span><span>;</span>\n<span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"bd1 = \"</span> <span>+</span> bd1<span>)</span><span>;</span>\n<span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"bd2 = \"</span> <span>+</span> bd2<span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>输出到控制台的结果是：</p>\n<div><pre><code>bd1 = 0.01000000000000000020816681711721685132943093776702880859375\nbd2 = 0.01\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>造成这种差异的原因是0.1这个数字计算机是无法精确表示的，送给<code>BigDecimal</code>的时候就已经丢精度了，而<code>BigDecimal#valueOf</code>的实现却完全不同</p>\n<div><pre><code><span>public</span> <span>static</span> <span>BigDecimal</span> <span>valueOf</span><span>(</span><span>double</span> val<span>)</span> <span>{</span>\n    <span>// Reminder: a zero double returns '0.0', so we cannot fastpath</span>\n    <span>// to use the constant ZERO.  This might be important enough to</span>\n    <span>// justify a factory approach, a cache, or a few private</span>\n    <span>// constants, later.</span>\n    <span>return</span> <span>new</span> <span>BigDecimal</span><span>(</span><span>Double</span><span>.</span><span>toString</span><span>(</span>val<span>)</span><span>)</span><span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>它使用了浮点数相应的字符串来构造<code>BigDecimal</code>对象，因此避免了精度问题。所以大家要尽量要使用字符串而不是浮点数去构造<code>BigDecimal</code>对象，如果实在不行，就使用<code>BigDecimal#valueOf()</code>方法吧。</p>\n<h3 id=\"_1-2-等值比较\" tabindex=\"-1\"> 1.2 等值比较</h3>\n<div><pre><code><span>BigDecimal</span> bd1 <span>=</span> <span>new</span> <span>BigDecimal</span><span>(</span><span>\"1.0\"</span><span>)</span><span>;</span>\n<span>BigDecimal</span> bd2 <span>=</span> <span>new</span> <span>BigDecimal</span><span>(</span><span>\"1.00\"</span><span>)</span><span>;</span>\n<span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>bd1<span>.</span><span>equals</span><span>(</span>bd2<span>)</span><span>)</span><span>;</span>\n<span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>bd1<span>.</span><span>compareTo</span><span>(</span>bd2<span>)</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>控制台的输出将会是：</p>\n<div><pre><code>false\n0\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>究其原因是，<code>BigDecimal</code>中<code>equals</code>方法的实现会比较两个数字的精度，而<code>compareTo</code>方法则只会比较数值的大小。</p>\n<h3 id=\"_1-3-bigdecimal并不代表无限精度\" tabindex=\"-1\"> 1.3 <code>BigDecimal</code>并不代表无限精度</h3>\n<p>先看这段代码</p>\n<div><pre><code><span>BigDecimal</span> a <span>=</span> <span>new</span> <span>BigDecimal</span><span>(</span><span>\"1.0\"</span><span>)</span><span>;</span>\n<span>BigDecimal</span> b <span>=</span> <span>new</span> <span>BigDecimal</span><span>(</span><span>\"3.0\"</span><span>)</span><span>;</span>\na<span>.</span><span>divide</span><span>(</span>b<span>)</span> <span>// results in the following exception.</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>结果会抛出异常：</p>\n<div><pre><code>java.lang.ArithmeticException: Non-terminating decimal expansion; no exact representable decimal result.\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>关于这个异常，Oracle的官方文档有具体说明</p>\n<p>If the quotient has a nonterminating decimal expansion and the operation is specified to return an exact result, an ArithmeticException is thrown. Otherwise, the exact result of the division is returned, as done for other operations.</p>\n<p>大意是，如果除法的商的结果是一个无限小数但是我们期望返回精确的结果，那程序就会抛出异常。回到我们的这个例子，我们需要告诉<code>JVM</code>我们不需要返回精确的结果就好了</p>\n<div><pre><code><span>BigDecimal</span> a <span>=</span> <span>new</span> <span>BigDecimal</span><span>(</span><span>\"1.0\"</span><span>)</span><span>;</span>\n<span>BigDecimal</span> b <span>=</span> <span>new</span> <span>BigDecimal</span><span>(</span><span>\"3.0\"</span><span>)</span><span>;</span>\na<span>.</span><span>divide</span><span>(</span>b<span>,</span> <span>2</span><span>,</span> <span>RoundingMode</span><span>.</span>HALF_UP<span>)</span><span>// 0.33</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h3 id=\"_1-4-bigdecimal转回string要小心\" tabindex=\"-1\"> 1.4 <code>BigDecimal</code>转回<code>String</code>要小心</h3>\n<div><pre><code><span>BigDecimal</span> d <span>=</span> <span>BigDecimal</span><span>.</span><span>valueOf</span><span>(</span><span>12334535345456700.12345634534534578901</span><span>)</span><span>;</span>\n<span>String</span> out <span>=</span> d<span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span> <span>// Or perform any formatting that needs to be done</span>\n<span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>out<span>)</span><span>;</span> <span>// 1.23345353454567E+16</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>可以看到结果已经被转换成了科学计数法，可能这个并不是预期的结果<code>BigDecimal</code>有三个方法可以转为相应的字符串类型，切记不要用错：</p>\n<div><pre><code><span>String</span> <span>toString</span><span>(</span><span>)</span><span>;</span>     <span>// 有必要时使用科学计数法</span>\n<span>String</span> <span>toPlainString</span><span>(</span><span>)</span><span>;</span>   <span>// 不使用科学计数法</span>\n<span>String</span> <span>toEngineeringString</span><span>(</span><span>)</span><span>;</span>  <span>// 工程计算中经常使用的记录数字的方法，与科学计数法类似，但要求10的幂必须是3的倍数</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h3 id=\"_1-5-执行顺序不能调换-乘法交换律失效\" tabindex=\"-1\"> 1.5 执行顺序不能调换（乘法交换律失效）</h3>\n<p>乘法满足交换律是一个常识，但是在计算机的世界里，会出现不满足乘法交换律的情况</p>\n<div><pre><code><span>BigDecimal</span> a <span>=</span> <span>BigDecimal</span><span>.</span><span>valueOf</span><span>(</span><span>1.0</span><span>)</span><span>;</span>\n<span>BigDecimal</span> b <span>=</span> <span>BigDecimal</span><span>.</span><span>valueOf</span><span>(</span><span>3.0</span><span>)</span><span>;</span>\n<span>BigDecimal</span> c <span>=</span> <span>BigDecimal</span><span>.</span><span>valueOf</span><span>(</span><span>3.0</span><span>)</span><span>;</span>\n<span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>a<span>.</span><span>divide</span><span>(</span>b<span>,</span> <span>2</span><span>,</span> <span>RoundingMode</span><span>.</span>HALF_UP<span>)</span><span>.</span><span>multiply</span><span>(</span>c<span>)</span><span>)</span><span>;</span> <span>// 0.990</span>\n<span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>a<span>.</span><span>multiply</span><span>(</span>c<span>)</span><span>.</span><span>divide</span><span>(</span>b<span>,</span> <span>2</span><span>,</span> <span>RoundingMode</span><span>.</span>HALF_UP<span>)</span><span>)</span><span>;</span> <span>// 1.00</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>别小看这这0.01的差别，在汇金领域，会产生非常大的金额差异。</p>\n<h2 id=\"_2-最佳实践\" tabindex=\"-1\"> 2. 最佳实践</h2>\n<p>关于金额计算，很多业务团队会基于<code>BigDecimal</code>再封装一个<code>Money</code>类，其实我们直接可以用一个半官方的<code>Money</code>类：JSR 354 ,虽然没能在<code>Java 9</code>中成为<code>Java</code>标准，很有可能集成到后续的<code>Java</code>版本中成为官方库。</p>\n<h3 id=\"_2-1-maven坐标\" tabindex=\"-1\"> 2.1 <code>maven</code>坐标</h3>\n<div><pre><code><span><span><span>&lt;</span>dependency</span><span>></span></span>\n    <span><span><span>&lt;</span>groupId</span><span>></span></span>org.javamoney<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n    <span><span><span>&lt;</span>artifactId</span><span>></span></span>moneta<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n    <span><span><span>&lt;</span>version</span><span>></span></span>1.1<span><span><span>&lt;/</span>version</span><span>></span></span>\n<span><span><span>&lt;/</span>dependency</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"_2-2-新建money类\" tabindex=\"-1\"> 2.2 新建<code>Money</code>类</h3>\n<div><pre><code><span>CurrencyUnit</span> cny <span>=</span> <span>Monetary</span><span>.</span><span>getCurrency</span><span>(</span><span>\"CNY\"</span><span>)</span><span>;</span>\n<span>Money</span> money <span>=</span> <span>Money</span><span>.</span><span>of</span><span>(</span><span>1.0</span><span>,</span> cny<span>)</span><span>;</span> \n<span>// 或者 Money money = Money.of(1.0, \"CNY\");</span>\n<span>//System.out.println(money);</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><h3 id=\"_2-3-金额运算\" tabindex=\"-1\"> 2.3 金额运算</h3>\n<div><pre><code><span>CurrencyUnit</span> cny <span>=</span> <span>Monetary</span><span>.</span><span>getCurrency</span><span>(</span><span>\"CNY\"</span><span>)</span><span>;</span>\n<span>Money</span> oneYuan <span>=</span> <span>Money</span><span>.</span><span>of</span><span>(</span><span>1.0</span><span>,</span> cny<span>)</span><span>;</span>\n<span>Money</span> threeYuan <span>=</span> oneYuan<span>.</span><span>add</span><span>(</span><span>Money</span><span>.</span><span>of</span><span>(</span><span>2.0</span><span>,</span> <span>\"CNY\"</span><span>)</span><span>)</span><span>;</span> <span>//CNY 3</span>\n<span>Money</span> tenYuan <span>=</span> oneYuan<span>.</span><span>multiply</span><span>(</span><span>10</span><span>)</span><span>;</span> <span>// CNY 10</span>\n<span>Money</span> fiveFen <span>=</span> oneYuan<span>.</span><span>divide</span><span>(</span><span>2</span><span>)</span><span>;</span> <span>//CNY 0.5</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"_2-4-比较相等\" tabindex=\"-1\"> 2.4 比较相等</h3>\n<div><pre><code><span>Money</span> fiveFen <span>=</span> <span>Money</span><span>.</span><span>of</span><span>(</span><span>0.5</span><span>,</span> <span>\"CNY\"</span><span>)</span><span>;</span> <span>//CNY 0.5</span>\n<span>Money</span> anotherFiveFen <span>=</span> <span>Money</span><span>.</span><span>of</span><span>(</span><span>0.50</span><span>,</span> <span>\"CNY\"</span><span>)</span><span>;</span> <span>// CNY 0.50</span>\n<span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>fiveFen<span>.</span><span>equals</span><span>(</span>anotherFiveFen<span>)</span><span>)</span><span>;</span> <span>// true</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>可以看到，这个类对金额做了显性的抽象，增加了金额的单位，也避免了直接使用<code>BigDecimal</code>的一些坑。</p>\n",
      "date_published": "2022-07-15T00:00:00.000Z",
      "date_modified": "2022-07-03T02:28:49.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "Intellij IDEA 中的各种调试代码技巧",
      "url": "https://blog.ciberviler.top/dev/IDEA%E4%B8%AD%E7%9A%84%E5%90%84%E7%A7%8D%E8%B0%83%E8%AF%95%E4%BB%A3%E7%A0%81%E6%8A%80%E5%B7%A7.html",
      "id": "https://blog.ciberviler.top/dev/IDEA%E4%B8%AD%E7%9A%84%E5%90%84%E7%A7%8D%E8%B0%83%E8%AF%95%E4%BB%A3%E7%A0%81%E6%8A%80%E5%B7%A7.html",
      "content_html": "<h1 id=\"intellij-idea-中的各种调试代码技巧\" tabindex=\"-1\"> Intellij IDEA 中的各种调试代码技巧</h1>\n<p>Debug用来追踪代码的运行流程，通常在程序运行过程中出现异常，启用Debug模式可以分析定位异常发生的位置，以及在运行过程中参数的变化。通常我们也可以启用Debug模式来跟踪代码的运行流程去学习三方框架的源码。</p>\n<p>所以学习下如何在Intellij IDEA中使用好Debug，主要包括如下内容：</p>\n<p>一、Debug开篇</p>\n<p>二、基本用法&amp;快捷键</p>\n<p>三、变量查看</p>\n<p>四、计算表达式</p>\n<p>五、智能步入</p>\n<p>六、断点条件设置</p>\n<p>七、多线程调试</p>\n<p>八、回退断点</p>\n<p>九、中断Debug</p>\n<p>十、附：JRebel激活</p>\n<h2 id=\"一、debug开篇\" tabindex=\"-1\"> 一、Debug开篇</h2>\n<p>首先看下IDEA中Debug模式下的界面。</p>\n<p>如下是在IDEA中启动Debug模式，进入断点后的界面，我这里是Windows，可能和Mac的图标等会有些不一样。就简单说下图中标注的8个地方：</p>\n<p>① 以Debug模式启动服务，左边的一个按钮则是以Run模式启动。在开发中，我一般会直接启动Debug模式，方便随时调试代码。</p>\n<p>② 断点：在左边行号栏单击左键，或者快捷键Ctrl+F8 打上/取消断点，断点行的颜色可自己去设置。</p>\n<p>③ Debug窗口：访问请求到达第一个断点后，会自动激活Debug窗口。如果没有自动激活，可以去设置里设置，如图1.2。</p>\n<p>④ 调试按钮：一共有8个按钮，调试的主要功能就对应着这几个按钮，鼠标悬停在按钮上可以查看对应的快捷键。在菜单栏Run里可以找到同样的对应的功能，如图1.4。</p>\n<p>⑤ 服务按钮：可以在这里关闭/启动服务，设置断点等。</p>\n<p>⑥ 方法调用栈：这里显示了该线程调试所经过的所有方法，勾选右上角的[Show All Frames]按钮，就不会显示其它类库的方法了，否则这里会有一大堆的方法。</p>\n<p>⑦ Variables：在变量区可以查看当前断点之前的当前方法内的变量。</p>\n<p>⑧ Watches：查看变量，可以将Variables区中的变量拖到Watches中查看</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16567524343880.png\" alt=\"IDEA调试\"></p>\n<p>在设置里勾选Show debug window on breakpoint，则请求进入到断点后自动激活Debug</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16567524343881.png\" alt=\"IDEA调试\"></p>\n<p>如果你的IDEA底部没有显示工具栏或状态栏，可以在View里打开，显示出工具栏会方便我们使用。可以自己去尝试下这四个选项。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16567524343882.png\" alt=\"IDEA调试\"></p>\n<p>在菜单栏Run里有调试对应的功能，同时可以查看对应的快捷键。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16567524343883.png\" alt=\"IDEA调试\"></p>\n<h2 id=\"二、基本用法-快捷键\" tabindex=\"-1\"> 二、基本用法&amp;快捷键</h2>\n<p>Debug调试的功能主要对应着图一中4和5两组按钮：</p>\n<p>1、首先说第一组按钮，共8个按钮，从左到右依次如下：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16567524343884.png\" alt=\"IDEA调试\"></p>\n<p>&gt; Show Execution Point (Alt + F10)：如果你的光标在其它行或其它页面，点击这个按钮可跳转到当前代码执行的行。</p>\n<p>&gt; Step Over (F8)：步过，一行一行地往下走，如果这一行上有方法不会进入方法。</p>\n<p>&gt; Step Into (F7)：步入，如果当前行有方法，可以进入方法内部，一般用于进入自定义方法内，不会进入官方类库的方法，如第25行的put方法。</p>\n<p>&gt; Force Step Into (Alt + Shift + F7)：强制步入，能进入任何方法，查看底层源码的时候可以用这个进入官方类库的方法。</p>\n<p>&gt; Step Out (Shift + F8)：步出，从步入的方法内退出到方法调用处，此时方法已执行完毕，只是还没有完成赋值。</p>\n<p>&gt; Drop Frame (默认无)：回退断点，后面章节详细说明。</p>\n<p>&gt; Run to Cursor (Alt + F9)：运行到光标处，你可以将光标定位到你需要查看的那一行，然后使用这个功能，代码会运行至光标行，而不需要打断点。</p>\n<p>&gt; Evaluate Expression (Alt + F8)：计算表达式，后面章节详细说明。</p>\n<p>2、第二组按钮，共7个按钮，从上到下依次如下：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16567524343885.png\" alt=\"IDEA调试\"></p>\n<p>&gt; Rerun 'xxxx'：重新运行程序，会关闭服务后重新启动程序。</p>\n<p>&gt; Update 'tech' application (Ctrl + F5)：更新程序，一般在你的代码有改动后可执行这个功能。而这个功能对应的操作则是在服务配置里，如图2.3。</p>\n<p>&gt; Resume Program (F9)：恢复程序，比如，你在第20行和25行有两个断点，当前运行至第20行，按F9，则运行到下一个断点(即第25行)，再按F9，则运行完整个流程，因为后面已经没有断点了。</p>\n<p>&gt; Pause Program：暂停程序，启用Debug。目前没发现具体用法。</p>\n<p>&gt; Stop 'xxx' (Ctrl + F2)：连续按两下，关闭程序。有时候你会发现关闭服务再启动时，报端口被占用，这是因为没完全关闭服务的原因，你就需要查杀所有JVM进程了。</p>\n<p>&gt; View Breakpoints (Ctrl + Shift + F8)：查看所有断点，后面章节会涉及到。</p>\n<p>&gt; Mute Breakpoints：哑的断点，选择这个后，所有断点变为灰色，断点失效，按F9则可以直接运行完程序。再次点击，断点变为红色，有效。如果只想使某一个断点失效，可以在断点上右键取消Enabled，如图2.4，则该行断点失效。</p>\n<p>[图2.3]：更新程序，On 'Update' actions，执行更新操作时所做的事情，一般选择'Update classes and resources'，即更新类和资源文件。</p>\n<p>一般配合热部署插件会更好用，如JRebel，这样就不用每次更改代码后还要去重新启动服务。如何激活JRebel，在最后章节附上。</p>\n<p>下面的On frame deactivation，在IDEA窗口失去焦点时触发，即一般你从idea切换到浏览器的时候，idea会自动帮你做的事情，一般可以设置Do nothing，频繁切换会比较消耗资源的。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16567524343886.png\" alt=\"IDEA调试\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16567524343887.png\" alt=\"IDEA调试\"></p>\n<h2 id=\"三、变量查看\" tabindex=\"-1\"> 三、变量查看</h2>\n<p>在Debug过程中，跟踪查看变量的变化是非常必要的，这里就简单说下IDEA中可以查看变量的几个地方，相信大部分人都了解。</p>\n<p>1、如下，在IDEA中，参数所在行后面会显示当前变量的值。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16567524343888.png\" alt=\"IDEA调试\"></p>\n<p>2、光标悬停到参数上，显示当前变量信息。点击打开详情如图3.3。我一般会使用这种方式，快捷方便。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16567524343899.png\" alt=\"IDEA调试\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243438910.png\" alt=\"IDEA调试\"></p>\n<p>3、在Variables里查看，这里显示当前方法里的所有变量。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243438911.png\" alt=\"IDEA调试\"></p>\n<p>4、在Watches里，点击New Watch，输入需要查看的变量。或者可以从Variables里拖到Watche里查看。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243438912.png\" alt=\"IDEA调试\"></p>\n<p>如果你发现你没有Watches，可能在下图所在的地方。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243438913.png\" alt=\"IDEA调试\">\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243438914.png\" alt=\"IDEA调试\"></p>\n<h2 id=\"四、计算表达式\" tabindex=\"-1\"> 四、计算表达式</h2>\n<p>在前面提到的计算表达式如图4.1的按钮，Evaluate Expression (Alt + F8) 。可以使用这个操作在调试过程中计算某个表达式的值，而不用再去打印信息。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243438915.png\" alt=\"IDEA调试\"></p>\n<p>1、按Alt + F8或按钮，或者，你可以选中某个表达式再Alt + F8，弹出计算表达式的窗口，如下，回车或点击Evaluate计算表达式的值。</p>\n<p>这个表达式不仅可以是一般变量或参数，也可以是方法，当你的一行代码中调用了几个方法时，就可以通过这种方式查看查看某个方法的返回值。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243438916.png\" alt=\"IDEA调试\"></p>\n<p>2、设置变量，在计算表达式的框里，可以改变变量的值，这样有时候就能很方便我们去调试各种值的情况了不是。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243438917.png\" alt=\"IDEA调试\"></p>\n<h2 id=\"五、智能步入\" tabindex=\"-1\"> 五、智能步入</h2>\n<p>想想，一行代码里有好几个方法，怎么只选择某一个方法进入。之前提到过使用Step Into (Alt + F7) 或者 Force Step Into (Alt + Shift + F7)进入到方法内部，但这两个操作会根据方法调用顺序依次进入，这比较麻烦。</p>\n<p>那么智能步入就很方便了，智能步入，这个功能在Run里可以看到，Smart Step Into (Shift + F7)</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243438918.png\" alt=\"IDEA调试\"></p>\n<p>按Shift + F7，会自动定位到当前断点行，并列出需要进入的方法，如图5.2，点击方法进入方法内部。</p>\n<p>如果只有一个方法，则直接进入，类似Force Step Into。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243438919.png\" alt=\"IDEA调试\"></p>\n<h2 id=\"六、断点条件设置\" tabindex=\"-1\"> 六、断点条件设置</h2>\n<p>通过设置断点条件，在满足条件时，才停在断点处，否则直接运行。</p>\n<p>通常，当我们在遍历一个比较大的集合或数组时，在循环内设置了一个断点，难道我们要一个一个去看变量的值？那肯定很累，说不定你还错过这个值得重新来一次。</p>\n<p>1、在断点上右键直接设置当前断点的条件，如图6.1，我设置exist为true时断点才生效。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243438920.png\" alt=\"IDEA调试\"></p>\n<p>2、点击View Breakpoints (Ctrl + Shift + F8)，查看所有断点。</p>\n<p>Java Line Breakpoints 显示了所有的断点，在右边勾选Condition，设置断点的条件。</p>\n<p>勾选Log message to console，则会将当前断点行输出到控制台，如图6.3</p>\n<p>勾选Evaluate and log，可以在执行这行代码是计算表达式的值，并将结果输出到控制台。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243438921.png\" alt=\"IDEA调试\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243438922.png\" alt=\"IDEA调试\"></p>\n<p>3、再说说右边的Filters过滤，这些一般情况下不常用，简单说下意思。</p>\n<p>Instance filters：实例过滤，输入实例ID(如图6.5中的实例ID)，但是我这里没有成功，不知道什么原因，知道的朋友留个言。</p>\n<p>Class filters：类过滤，根据类名过滤，同样没有成功....</p>\n<p>Pass count：用于循环中，如果断点在循环中，可以设置该值，循环多少次后停在断点处，之后的循环都会停在断点处。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243438923.png\" alt=\"IDEA调试\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243439024.png\" alt=\"IDEA调试\"></p>\n<p>4、异常断点，通过设置异常断点，在程序中出现需要拦截的异常时，会自动定位到异常行。</p>\n<p>如图6.6，点击+号添加Java Exception Breakpoints，添加异常断点。然后输入需要断点的异常类，如图6.7，之后可以在Java Exception Breakpoints里看到添加的异常断点。</p>\n<p>我这里添加了一个NullPointerException异常断点，如图6.8，出现空指针异常后，自动定位在空指针异常行。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243439025.png\" alt=\"IDEA调试\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243439026.png\" alt=\"IDEA调试\">\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243439027.png\" alt=\"IDEA调试\"></p>\n<h2 id=\"七、多线程调试\" tabindex=\"-1\"> 七、多线程调试</h2>\n<p>一般情况下我们调试的时候是在一个线程中的，一步一步往下走。但有时候你会发现在Debug的时候，想发起另外一个请求都无法进行了？</p>\n<p>那是因为IDEA在Debug时默认阻塞级别是ALL，会阻塞其它线程，只有在当前调试线程走完时才会走其它线程。可以在View Breakpoints里选择Thread，如图7.1，然后点击Make Default设置为默认选项。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243439028.png\" alt=\"IDEA调试\"></p>\n<p>切换线程，在图7.2中Frames的下拉列表里，可以切换当前的线程，如下我这里有两个Debug的线程，切换另外一个则进入另一个Debug的线程。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243439029.png\" alt=\"IDEA调试\"></p>\n<h2 id=\"八、回退断点\" tabindex=\"-1\"> 八、回退断点</h2>\n<p>在调试的时候，想要重新走一下流程而不用再次发起一个请求？</p>\n<p>1、首先认识下这个方法调用栈，如图8.1，首先请求进入DemoController的insertDemo方法，然后调用insert方法，其它的invoke我们且先不管，最上面的方法是当前断点所在的方法。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243439030.png\" alt=\"IDEA调试\"></p>\n<p>2、断点回退</p>\n<p>所谓的断点回退，其实就是回退到上一个方法调用的开始处，在IDEA里测试无法一行一行地回退或回到到上一个断点处，而是回到上一个方法。</p>\n<p>回退的方式有两种，一种是Drop Frame按钮(图8.2)，按调用的方法逐步回退，包括三方类库的其它方法(取消Show All Frames按钮会显示三方类库的方法，如图8.3)。</p>\n<p>第二种方式，在调用栈方法上选择要回退的方法，右键选择Drop Frame(图8.4)，回退到该方法的上一个方法调用处，此时再按F9(Resume Program)，可以看到程序进入到该方法的断点处了。</p>\n<p>但有一点需要注意，断点回退只能重新走一下流程，之前的某些参数/数据的状态已经改变了的是无法回退到之前的状态的，如对象、集合、更新了数据库数据等等。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243439031.png\" alt=\"IDEA调试\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243439032.png\" alt=\"IDEA调试\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243439033.png\" alt=\"IDEA调试\"></p>\n<h2 id=\"九、中断debug\" tabindex=\"-1\"> 九、中断Debug</h2>\n<p>想要在Debug的时候，中断请求，不要再走剩余的流程了？</p>\n<p>有些时候，我们看到传入的参数有误后，不想走后面的流程了，怎么中断这次请求呢(后面的流程要删除数据库数据呢....)，难道要关闭服务重新启动程序？嗯，我以前也是这么干的。</p>\n<p>确切的说，我也没发现可以直接中断请求的方式(除了关闭服务)，但可以通过Force Return，即强制返回来避免后续的流程，如图9.1。</p>\n<p>点击Force Return，弹出Return Value的窗口，我这个方法的返回类型为Map，所以，我这里直接返回 results，来强制返回，从而不再进行后续的流程。或者你可以new HashMap&lt;&gt;()。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243439034.png\" alt=\"IDEA调试\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243439035.png\" alt=\"IDEA调试\"></p>\n<h2 id=\"十、附-jrebel激活\" tabindex=\"-1\"> 十、附：JRebel激活</h2>\n<p>目前本人一直使用JRebel做热部署工具，效果还算理想，修改Java代码或者xml等配置文件都能热更新。偶尔服务开久了，或更改的文件较多时，热更新没有生效，需要重新启动服务。</p>\n<p>这里只是简单说下我在网上看到的一种免费获得永久使用权的方式(非破解)，不确定这种方式什么时候不能用。</p>\n<p>① 首先你需要一个Facebook或Twitter的账号(最好Twitter)</p>\n<p>② 进入这个网址：<a href=\"https://my.jrebel.com/%EF%BC%8C%E5%B9%B6%E7%99%BB%E5%BD%95%EF%BC%8C%E5%A6%82%E5%9B%BE10.1\" target=\"_blank\" rel=\"noopener noreferrer\">https://my.jrebel.com/，并登录，如图10.1</a></p>\n<p>③ 然后在Install and Acticate里可以得到你的永久激活码。</p>\n<p>④ 在设置里Jrebel里设置激活码，如图10.3，如果没有安装JRebel插件，先在Plugins里安装搜索安装JRebel插件。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243439036.png\" alt=\"IDEA调试\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243439037.png\" alt=\"IDEA调试\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165675243439038.png\" alt=\"IDEA调试\"></p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16567524343880.png",
      "date_published": "2022-07-14T00:00:00.000Z",
      "date_modified": "2022-07-02T09:03:16.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "SpringCloud Gateway API接口安全设计（加密 、签名）",
      "url": "https://blog.ciberviler.top/dev/SpringCloudGatewayAPI%E6%8E%A5%E5%8F%A3%E5%AE%89%E5%85%A8%E8%AE%BE%E8%AE%A1(%E5%8A%A0%E5%AF%86%E7%AD%BE%E5%90%8D).html",
      "id": "https://blog.ciberviler.top/dev/SpringCloudGatewayAPI%E6%8E%A5%E5%8F%A3%E5%AE%89%E5%85%A8%E8%AE%BE%E8%AE%A1(%E5%8A%A0%E5%AF%86%E7%AD%BE%E5%90%8D).html",
      "content_html": "<h1 id=\"springcloud-gateway-api接口安全设计-加密-、签名\" tabindex=\"-1\"> SpringCloud Gateway API接口安全设计（加密 、签名）</h1>\n<h2 id=\"_1-防止数据抓包窃取\" tabindex=\"-1\"> 1 防止数据抓包窃取</h2>\n<h3 id=\"_1-1-风险简述\" tabindex=\"-1\"> 1.1 风险简述</h3>\n<p>简述：当用户登录时，恶意攻击者可以用抓包工具可以拿到用户提交的表单信息，可以获取用户的账号密码，进而可以恶意访问网站。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1a25b48aa07f4da7adeed28003850f74.png\" alt=\"图片\"></p>\n<h3 id=\"_1-2-rsa-非对称加密\" tabindex=\"-1\"> 1.2 RSA 非对称加密</h3>\n<h4 id=\"_1-2-1-rsa简介4\" tabindex=\"-1\"> 1.2.1 RSA简介4</h4>\n<p>RSA加密算法是一种非对称加密算法。在公开密钥加密和电子商业中RSA被广泛使用。RSA是1977年由罗纳德·李维斯特（Ron Rivest）、阿迪·萨莫尔（Adi Shamir）和伦纳德·阿德曼（Leonard Adleman）一起提出的。当时他们三人都在麻省理工学院工作。RSA就是他们三人姓氏开头字母拼在一起组成的。</p>\n<p>1973年，在英国政府通讯总部工作的数学家克利福德·柯克斯（Clifford Cocks）在一个内部文件中提出了一个相同的算法，但他的发现被列入机密，一直到1997年才被发表。对极大整数做因数分解的难度决定了RSA算法的可靠性。换言之，对一极大整数做因数分解愈困难，RSA算法愈可靠。假如有人找到一种快速因数分解的算法的话，那么用RSA加密的信息的可靠性就肯定会极度下降。但找到这样的算法的可能性是非常小的。今天只有短的RSA钥匙才可能被强力方式解破。到目前为止，世界上还没有任何可靠的攻击RSA算法的方式。只要其钥匙的长度足够长，用RSA加密的信息实际上是不能被解破的。</p>\n<p>1983年麻省理工学院在美国为RSA算法申请了专利。这个专利2000年9月21日失效。由于该算法在申请专利前就已经被发表了，在世界上大多数其它地区这个专利权不被承认。</p>\n<h4 id=\"_1-2-2-rsa应用过程4\" tabindex=\"-1\"> 1.2.2 RSA应用过程4</h4>\n<p>非对称算法的在应用的过程如下:\n(1) 接收方生成公钥和私钥，公钥公开，私钥保留；\n(2) 发送方将要发送的消息采用公钥加密，得到密文，然后将密文发送给接收方；\n(3) 接收方收到密文后，用自己的私钥进行解密，获得明文。</p>\n<h4 id=\"_1-2-3-rsa工具类4\" tabindex=\"-1\"> 1.2.3 RSA工具类4</h4>\n<div><pre><code><span>package</span> <span>com<span>.</span>demo<span>.</span>utils</span><span>;</span>\n\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>excepiton<span>.</span></span><span>RsaException</span></span><span>;</span>\n<span>import</span> <span><span>lombok<span>.</span>extern<span>.</span>slf4j<span>.</span></span><span>Slf4j</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>apache<span>.</span>commons<span>.</span>codec<span>.</span>binary<span>.</span></span><span>Base64</span></span><span>;</span>\n\n<span>import</span> <span><span>javax<span>.</span>crypto<span>.</span></span><span>Cipher</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>nio<span>.</span>charset<span>.</span></span><span>StandardCharsets</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>security<span>.</span></span><span>KeyFactory</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>security<span>.</span></span><span>KeyPair</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>security<span>.</span></span><span>KeyPairGenerator</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>security<span>.</span></span><span>SecureRandom</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>security<span>.</span>interfaces<span>.</span></span><span>RSAPrivateKey</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>security<span>.</span>interfaces<span>.</span></span><span>RSAPublicKey</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>security<span>.</span>spec<span>.</span></span><span>PKCS8EncodedKeySpec</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>security<span>.</span>spec<span>.</span></span><span>X509EncodedKeySpec</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>HashMap</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Map</span></span><span>;</span>\n\n<span>@Slf4j</span>\n<span>public</span> <span>class</span> <span>RSAUtils</span> <span>{</span>\n\n    <span>public</span> <span>static</span> <span>final</span> <span>String</span> PUBLIC_KEY <span>=</span> <span>\"public_key\"</span><span>;</span>\n\n    <span>public</span> <span>static</span> <span>final</span> <span>String</span> PRIVATE_KEY <span>=</span> <span>\"private_key\"</span><span>;</span>\n\n\n    <span>public</span> <span>static</span> <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>String</span><span>></span></span> <span>generateRasKey</span><span>(</span><span>)</span> <span>{</span>\n        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>String</span><span>></span></span> rs <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        <span>try</span> <span>{</span>\n            <span>// KeyPairGenerator类用于生成公钥和私钥对，基于RSA算法生成对象</span>\n            <span>KeyPairGenerator</span> keyPairGen <span>=</span> <span>null</span><span>;</span>\n            keyPairGen <span>=</span> <span>KeyPairGenerator</span><span>.</span><span>getInstance</span><span>(</span><span>\"RSA\"</span><span>)</span><span>;</span>\n            keyPairGen<span>.</span><span>initialize</span><span>(</span><span>1024</span><span>,</span> <span>new</span> <span>SecureRandom</span><span>(</span><span>)</span><span>)</span><span>;</span>\n            <span>// 生成一个密钥对，保存在keyPair中</span>\n            <span>KeyPair</span> keyPair <span>=</span> keyPairGen<span>.</span><span>generateKeyPair</span><span>(</span><span>)</span><span>;</span>\n            <span>// 得到私钥 公钥</span>\n            <span>RSAPrivateKey</span> privateKey <span>=</span> <span>(</span><span>RSAPrivateKey</span><span>)</span> keyPair<span>.</span><span>getPrivate</span><span>(</span><span>)</span><span>;</span>\n            <span>RSAPublicKey</span> publicKey <span>=</span> <span>(</span><span>RSAPublicKey</span><span>)</span> keyPair<span>.</span><span>getPublic</span><span>(</span><span>)</span><span>;</span>\n            <span>String</span> publicKeyString <span>=</span> <span>new</span> <span>String</span><span>(</span><span>Base64</span><span>.</span><span>encodeBase64</span><span>(</span>publicKey<span>.</span><span>getEncoded</span><span>(</span><span>)</span><span>)</span><span>)</span><span>;</span>\n            <span>// 得到私钥字符串</span>\n            <span>String</span> privateKeyString <span>=</span> <span>new</span> <span>String</span><span>(</span><span>Base64</span><span>.</span><span>encodeBase64</span><span>(</span><span>(</span>privateKey<span>.</span><span>getEncoded</span><span>(</span><span>)</span><span>)</span><span>)</span><span>)</span><span>;</span>\n            <span>// 将公钥和私钥保存到Map</span>\n            rs<span>.</span><span>put</span><span>(</span>PUBLIC_KEY<span>,</span> publicKeyString<span>)</span><span>;</span>\n            rs<span>.</span><span>put</span><span>(</span>PRIVATE_KEY<span>,</span> privateKeyString<span>)</span><span>;</span>\n        <span>}</span> <span>catch</span> <span>(</span><span>Exception</span> e<span>)</span> <span>{</span>\n            log<span>.</span><span>error</span><span>(</span><span>\"RsaUtils invoke genKeyPair failed.\"</span><span>,</span> e<span>)</span><span>;</span>\n            <span>throw</span> <span>new</span> <span>RsaException</span><span>(</span><span>\"RsaUtils invoke genKeyPair failed.\"</span><span>)</span><span>;</span>\n        <span>}</span>\n        <span>return</span> rs<span>;</span>\n    <span>}</span>\n\n\n    <span>public</span> <span>static</span> <span>String</span> <span>encrypt</span><span>(</span><span>String</span> str<span>,</span> <span>String</span> publicKey<span>)</span> <span>{</span>\n        <span>try</span> <span>{</span>\n            <span>//base64编码的公钥</span>\n            <span>byte</span><span>[</span><span>]</span> decoded <span>=</span> <span>Base64</span><span>.</span><span>decodeBase64</span><span>(</span>publicKey<span>)</span><span>;</span>\n            <span>RSAPublicKey</span> pubKey <span>=</span> <span>(</span><span>RSAPublicKey</span><span>)</span> <span>KeyFactory</span><span>.</span><span>getInstance</span><span>(</span><span>\"RSA\"</span><span>)</span><span>.</span><span>generatePublic</span><span>(</span><span>new</span> <span>X509EncodedKeySpec</span><span>(</span>decoded<span>)</span><span>)</span><span>;</span>\n            <span>//RSA加密</span>\n            <span>Cipher</span> cipher <span>=</span> <span>Cipher</span><span>.</span><span>getInstance</span><span>(</span><span>\"RSA\"</span><span>)</span><span>;</span>\n            cipher<span>.</span><span>init</span><span>(</span><span>Cipher</span><span>.</span>ENCRYPT_MODE<span>,</span> pubKey<span>)</span><span>;</span>\n            <span>return</span> <span>Base64</span><span>.</span><span>encodeBase64String</span><span>(</span>cipher<span>.</span><span>doFinal</span><span>(</span>str<span>.</span><span>getBytes</span><span>(</span><span>StandardCharsets</span><span>.</span>UTF_8<span>)</span><span>)</span><span>)</span><span>;</span>\n        <span>}</span> <span>catch</span> <span>(</span><span>Exception</span> e<span>)</span> <span>{</span>\n            log<span>.</span><span>error</span><span>(</span><span>\"RsaUtils invoke encrypt failed.\"</span><span>,</span> e<span>)</span><span>;</span>\n            <span>throw</span> <span>new</span> <span>RsaException</span><span>(</span><span>\"RsaUtils invoke encrypt failed.\"</span><span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n\n\n    <span>public</span> <span>static</span> <span>String</span> <span>decrypt</span><span>(</span><span>String</span> str<span>,</span> <span>String</span> privateKey<span>)</span> <span>{</span>\n\n        <span>try</span> <span>{</span>\n            <span>//64位解码加密后的字符串</span>\n            <span>byte</span><span>[</span><span>]</span> inputByte <span>=</span> <span>Base64</span><span>.</span><span>decodeBase64</span><span>(</span>str<span>.</span><span>getBytes</span><span>(</span><span>StandardCharsets</span><span>.</span>UTF_8<span>)</span><span>)</span><span>;</span>\n            <span>//base64编码的私钥</span>\n            <span>byte</span><span>[</span><span>]</span> decoded <span>=</span> <span>Base64</span><span>.</span><span>decodeBase64</span><span>(</span>privateKey<span>)</span><span>;</span>\n            <span>RSAPrivateKey</span> priKey <span>=</span> <span>(</span><span>RSAPrivateKey</span><span>)</span> <span>KeyFactory</span><span>.</span><span>getInstance</span><span>(</span><span>\"RSA\"</span><span>)</span><span>.</span><span>generatePrivate</span><span>(</span><span>new</span> <span>PKCS8EncodedKeySpec</span><span>(</span>decoded<span>)</span><span>)</span><span>;</span>\n            <span>//RSA解密</span>\n            <span>Cipher</span> cipher <span>=</span> <span>Cipher</span><span>.</span><span>getInstance</span><span>(</span><span>\"RSA\"</span><span>)</span><span>;</span>\n            cipher<span>.</span><span>init</span><span>(</span><span>Cipher</span><span>.</span>DECRYPT_MODE<span>,</span> priKey<span>)</span><span>;</span>\n            <span>return</span> <span>new</span> <span>String</span><span>(</span>cipher<span>.</span><span>doFinal</span><span>(</span>inputByte<span>)</span><span>)</span><span>;</span>\n        <span>}</span> <span>catch</span> <span>(</span><span>Exception</span> e<span>)</span> <span>{</span>\n            log<span>.</span><span>error</span><span>(</span><span>\"RsaUtils invoke decrypt failed.\"</span><span>,</span> e<span>)</span><span>;</span>\n            <span>throw</span> <span>new</span> <span>RsaException</span><span>(</span><span>\"RsaUtils invoke decrypt failed.\"</span><span>)</span><span>;</span>\n        <span>}</span>\n\n    <span>}</span>\n\n<span>}</span>\n\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>RsaException:</strong> 是自定义异常</p>\n<div><pre><code><span>@Getter</span>\n<span>public</span> <span>class</span> <span>RsaException</span> <span>extends</span> <span>RuntimeException</span> <span>{</span>\n\n    <span>private</span> <span>final</span> <span>String</span> message<span>;</span>\n\n    <span>public</span> <span>RsaException</span><span>(</span><span>String</span> message<span>)</span> <span>{</span>\n        <span>this</span><span>.</span>message <span>=</span> message<span>;</span>\n    <span>}</span>\n\n<span>}</span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_1-2-4-ut\" tabindex=\"-1\"> 1.2.4 UT</h4>\n<div><pre><code><span>package</span> <span>com<span>.</span>rosh</span><span>;</span>\n\n\n<span>import</span> <span><span>com<span>.</span>alibaba<span>.</span>fastjson<span>.</span></span><span>JSONObject</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>utils<span>.</span></span><span>RSAUtils</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>junit<span>.</span></span><span>Test</span></span><span>;</span>\n\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Map</span></span><span>;</span>\n\n\n<span>/**\n * @Description:\n * @Author: rosh\n * @Date: 2021/10/25 22:30\n */</span>\n<span>public</span> <span>class</span> <span>RsaTest</span> <span>{</span>\n\n    <span>/**\n     *  用测试生成的公钥，私钥赋值\n     */</span>\n    <span>private</span> <span>static</span> <span>final</span> <span>String</span> PUBLIC_KEY <span>=</span> <span>\"MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCFtTlL61IqIGd+fRLUhJ0MjsqFXFJswCohJ45m51WvbxDPRP3gllW0WChk74D5JEOpMDSWo4C7RfoGlBRNW7kQ6qYGukYZ5jgYpzoT0+gp3on96fQXEyQJysv9xiTPIdmSXXVVj1HAOJw29RbzxIVKUSzzPXvEtXRTtCC1+wkAJQIDAQAB\"</span><span>;</span>\n\n    <span>private</span> <span>static</span> <span>final</span> <span>String</span> PRIVATE_KEY <span>=</span> <span>\"MIICdwIBADANBgkqhkiG9w0BAQEFAASCAmEwggJdAgEAAoGBAIW1OUvrUiogZ359EtSEnQyOyoVcUmzAKiEnjmbnVa9vEM9E/eCWVbRYKGTvgPkkQ6kwNJajgLtF+gaUFE1buRDqpga6RhnmOBinOhPT6Cneif3p9BcTJAnKy/3GJM8h2ZJddVWPUcA4nDb1FvPEhUpRLPM9e8S1dFO0ILX7CQAlAgMBAAECgYBC4amtbiKFa/wY61tV7pfYRjzLhKi+OUlZmD3E/4Z+4KGZ7DrJ8qkgMtDR3HO5LAikQrare1HTW2d7juqw32ascu+uDObf4yrYNKin+ZDLUYvIDfLhThPxnZJwQ/trdtfxO3VM//XbwZacmwYbAsYW/3QPUXwwOPAgbC2oth8kqQJBANKLyXcdjZx4cwJVl7xNeC847su8y6bPpcBASsaQloCIPiNBIg1h76dpfEGIQBYWJWbBsxtHe/MhOmz7fNFDS2sCQQCiktYZR0dZNH4eNX329LoRuBiltpr9tf36rVOlKr1GSHkLYEHF2qtyXV2mdrY8ZWpvuo3qm1oSLaqmop2rN9avAkBHk85B+IIUF77BpGeZVJzvMOO9z8lMRHuNCE5jgvQnbinxwkrZUdovh+T+QlvHJnBApslFFOBGn51FP5oHamFRAkEAmwZmPsinkrrpoKjlqz6GyCrC5hKRDWoj/IyXfKKaxpCJTH3HeoIghvfdO8Vr1X/n1Q8SESt+4mLFngznSMQAZQJBAJx07bCFYbA2IocfFV5LTEYTIiUeKdue2NP2yWqZ/+tB5H7jNwQTJmX1mn0W/sZm4+nJM7SjfETpNZhH49+rV6U=\"</span><span>;</span>\n\n\n    <span>/**\n     *  生成公钥私钥\n     */</span>\n    <span>@Test</span>\n    <span>public</span> <span>void</span> <span>generateRsaKey</span><span>(</span><span>)</span> <span>{</span>\n        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>String</span><span>></span></span> map <span>=</span> <span>RSAUtils</span><span>.</span><span>generateRasKey</span><span>(</span><span>)</span><span>;</span>\n        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"随机生成的公钥为:\"</span> <span>+</span> map<span>.</span><span>get</span><span>(</span><span>RSAUtils</span><span>.</span>PUBLIC_KEY<span>)</span><span>)</span><span>;</span>\n        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"随机生成的私钥为:\"</span> <span>+</span> map<span>.</span><span>get</span><span>(</span><span>RSAUtils</span><span>.</span>PRIVATE_KEY<span>)</span><span>)</span><span>;</span>\n\n    <span>}</span>\n\n    <span>/**\n     * 加密: Yeidauky/iN1/whevov2+ntzXJKAp2AHfESu5ixnDqH5iB7ww+TcfqJpDfkPHfb12Y0sVXw0gBHNJ4inkh7l2/SJBze3pKQU/mg3oyDokTia3JZIs+e80/iJcSfN+yA1JaqY+eJPYiBiOGAF2S6x0ynvJg/Wj0fwp2Tq3PDzRMo=\n     */</span>\n    <span>@Test</span>\n    <span>public</span> <span>void</span> <span>testEncrypt</span><span>(</span><span>)</span> <span>{</span>\n        <span>JSONObject</span> jsonObject <span>=</span> <span>new</span> <span>JSONObject</span><span>(</span><span>)</span><span>;</span>\n        jsonObject<span>.</span><span>put</span><span>(</span><span>\"username\"</span><span>,</span> <span>\"rosh\"</span><span>)</span><span>;</span>\n        jsonObject<span>.</span><span>put</span><span>(</span><span>\"password\"</span><span>,</span> <span>\"123456\"</span><span>)</span><span>;</span>\n        <span>String</span> str <span>=</span> jsonObject<span>.</span><span>toJSONString</span><span>(</span><span>)</span><span>;</span>\n        <span>String</span> encrypt <span>=</span> <span>RSAUtils</span><span>.</span><span>encrypt</span><span>(</span>str<span>,</span> PUBLIC_KEY<span>)</span><span>;</span>\n        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>encrypt<span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>@Test</span>\n    <span>public</span> <span>void</span> <span>testDecrypt</span><span>(</span><span>)</span> <span>{</span>\n\n        <span>String</span> decrypt <span>=</span> <span>RSAUtils</span><span>.</span><span>decrypt</span><span>(</span><span>\"Yeidauky/iN1/whevov2+ntzXJKAp2AHfESu5ixnDqH5iB7ww+TcfqJpDfkPHfb12Y0sVXw0gBHNJ4inkh7l2/SJBze3pKQU/mg3oyDokTia3JZIs+e80/iJcSfN+yA1JaqY+eJPYiBiOGAF2S6x0ynvJg/Wj0fwp2Tq3PDzRMo=\"</span><span>,</span>\n                PRIVATE_KEY<span>)</span><span>;</span>\n\n        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>decrypt<span>)</span><span>;</span>\n    <span>}</span>\n\n\n<span>}</span>\n\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/d7432b5d395347cc8f3b204a099006d0.png\" alt=\"图片\"></p>\n<h3 id=\"_1-3-案例\" tabindex=\"-1\"> 1.3 案例</h3>\n<p>SpringCloud Gateway + SpringBoot + Nacos+redis\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/954f481924b640e885c315ac9f33b60e.png\" alt=\"图片\">\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1f7df432d04e4ecebf95161316c4eb8c.png\" alt=\"图片\"></p>\n<h4 id=\"_1-3-1-前端登录代码\" tabindex=\"-1\"> 1.3.1 前端登录代码</h4>\n<p><strong>后端把公钥跟前端约定好：</strong></p>\n<div><pre><code><span><span>&lt;!</span><span>DOCTYPE</span> <span>html</span><span>></span></span>\n<span><span><span>&lt;</span>html</span> <span>lang</span><span><span>=</span><span>\"</span>en<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;</span>head</span><span>></span></span>\n    <span><span><span>&lt;</span>meta</span> <span>charset</span><span><span>=</span><span>\"</span>UTF-8<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>title</span><span>></span></span>登录页面<span><span><span>&lt;/</span>title</span><span>></span></span>\n\n<span><span><span>&lt;/</span>head</span><span>></span></span>\n<span><span><span>&lt;</span>body</span><span>></span></span>\n\n<span><span><span>&lt;</span>h1</span><span>></span></span>登录<span><span><span>&lt;/</span>h1</span><span>></span></span>\n\n\n<span><span><span>&lt;</span>from</span> <span>id</span><span><span>=</span><span>\"</span>from<span>\"</span></span><span>></span></span>\n    账号：<span><span><span>&lt;</span>input</span> <span>id</span><span><span>=</span><span>\"</span>username<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>text<span>\"</span></span><span>/></span></span>\n    <span><span><span>&lt;</span>br</span><span>/></span></span>\n    密码：<span><span><span>&lt;</span>input</span> <span>id</span><span><span>=</span><span>\"</span>password<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>password<span>\"</span></span><span>/></span></span>\n    <span><span><span>&lt;</span>br</span><span>/></span></span>\n    <span><span><span>&lt;</span>input</span> <span>id</span><span><span>=</span><span>\"</span>btn_login<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>button<span>\"</span></span> <span>value</span><span><span>=</span><span>\"</span>登录<span>\"</span></span><span>/></span></span>\n<span><span><span>&lt;/</span>from</span><span>></span></span>\n\n\n\n<span><span><span>&lt;</span>script</span> <span>src</span><span><span>=</span><span>\"</span>js/jquery.min.js<span>\"</span></span><span>></span></span><span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n<span><span><span>&lt;</span>script</span> <span>src</span><span><span>=</span><span>\"</span>js/jsencrypt.js<span>\"</span></span><span>></span></span><span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n\n\n<span><span><span>&lt;</span>script</span> <span>type</span><span><span>=</span><span>\"</span>text/javascript<span>\"</span></span><span>></span></span><span><span>\n    <span>var</span> encrypt <span>=</span> <span>new</span> <span>JSEncrypt</span><span>(</span><span>)</span><span>;</span>\n    encrypt<span>.</span><span>setPublicKey</span><span>(</span><span>\"MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCFtTlL61IqIGd+fRLUhJ0MjsqFXFJswCohJ45m51WvbxDPRP3gllW0WChk74D5JEOpMDSWo4C7RfoGlBRNW7kQ6qYGukYZ5jgYpzoT0+gp3on96fQXEyQJysv9xiTPIdmSXXVVj1HAOJw29RbzxIVKUSzzPXvEtXRTtCC1+wkAJQIDAQAB\"</span><span>)</span><span>;</span>\n    <span>$</span><span>(</span><span>\"#btn_login\"</span><span>)</span><span>.</span><span>click</span><span>(</span><span>function</span> <span>(</span><span>)</span> <span>{</span>\n        <span>const</span> username <span>=</span> <span>$</span><span>(</span><span>\"#username\"</span><span>)</span><span>.</span><span>val</span><span>(</span><span>)</span><span>;</span>\n        <span>const</span> password <span>=</span> <span>$</span><span>(</span><span>\"#password\"</span><span>)</span><span>.</span><span>val</span><span>(</span><span>)</span><span>;</span>\n        <span>const</span> form <span>=</span> <span>{</span><span>}</span><span>;</span>\n        form<span>.</span>username <span>=</span> username<span>;</span>\n        form<span>.</span>password <span>=</span> password<span>;</span>\n        $<span>.</span><span>ajax</span><span>(</span><span>{</span>\n            <span>url</span><span>:</span> <span>\"http://localhost:9000/api/user/login\"</span><span>,</span>\n            <span>data</span><span>:</span> encrypt<span>.</span><span>encrypt</span><span>(</span><span>JSON</span><span>.</span><span>stringify</span><span>(</span>form<span>)</span><span>)</span><span>,</span>\n            <span>type</span><span>:</span> <span>\"POST\"</span><span>,</span>\n            <span>dataType</span><span>:</span> <span>\"json\"</span><span>,</span>\n            <span>contentType</span><span>:</span> <span>\"application/json;charset=utf-8\"</span><span>,</span>\n            <span>success</span><span>:</span> <span>function</span> <span>(</span><span>data</span><span>)</span> <span>{</span>\n                console<span>.</span><span>log</span><span>(</span>data<span>)</span><span>;</span>\n            <span>}</span>\n        <span>}</span><span>)</span><span>;</span>\n    <span>}</span><span>)</span>\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n\n\n<span><span><span>&lt;/</span>body</span><span>></span></span>\n<span><span><span>&lt;/</span>html</span><span>></span></span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_1-3-2-前端查询代码\" tabindex=\"-1\"> 1.3.2 前端查询代码</h4>\n<p><strong>设定公钥、token，token是登录成功后返回的值</strong></p>\n<div><pre><code><span><span>&lt;!</span><span>DOCTYPE</span> <span>html</span><span>></span></span>\n<span><span><span>&lt;</span>html</span> <span>lang</span><span><span>=</span><span>\"</span>en<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;</span>head</span><span>></span></span>\n    <span><span><span>&lt;</span>meta</span> <span>charset</span><span><span>=</span><span>\"</span>UTF-8<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>title</span><span>></span></span>查询测试<span><span><span>&lt;/</span>title</span><span>></span></span>\n<span><span><span>&lt;/</span>head</span><span>></span></span>\n<span><span><span>&lt;</span>body</span><span>></span></span>\n\n\nid：<span><span><span>&lt;</span>input</span> <span>id</span><span><span>=</span><span>\"</span>id_txt<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>text<span>\"</span></span><span>/></span></span>\n<span><span><span>&lt;</span>input</span> <span>id</span><span><span>=</span><span>\"</span>btn_search<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>button<span>\"</span></span> <span>value</span><span><span>=</span><span>\"</span>查询<span>\"</span></span><span>/></span></span>\n\n\n<span><span><span>&lt;</span>script</span> <span>src</span><span><span>=</span><span>\"</span>js/jquery.min.js<span>\"</span></span><span>></span></span><span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n<span><span><span>&lt;</span>script</span> <span>src</span><span><span>=</span><span>\"</span>js/jsencrypt.js<span>\"</span></span><span>></span></span><span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n<span><span><span>&lt;</span>script</span> <span>type</span><span><span>=</span><span>\"</span>text/javascript<span>\"</span></span><span>></span></span><span><span>\n    <span>var</span> encrypt <span>=</span> <span>new</span> <span>JSEncrypt</span><span>(</span><span>)</span><span>;</span>\n    encrypt<span>.</span><span>setPublicKey</span><span>(</span><span>\"MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCFtTlL61IqIGd+fRLUhJ0MjsqFXFJswCohJ45m51WvbxDPRP3gllW0WChk74D5JEOpMDSWo4C7RfoGlBRNW7kQ6qYGukYZ5jgYpzoT0+gp3on96fQXEyQJysv9xiTPIdmSXXVVj1HAOJw29RbzxIVKUSzzPXvEtXRTtCC1+wkAJQIDAQAB\"</span><span>)</span><span>;</span>\n\n    <span>$</span><span>(</span><span>\"#btn_search\"</span><span>)</span><span>.</span><span>click</span><span>(</span><span>function</span> <span>(</span><span>)</span> <span>{</span>\n        <span>const</span> id <span>=</span> <span>$</span><span>(</span><span>\"#id_txt\"</span><span>)</span><span>.</span><span>val</span><span>(</span><span>)</span><span>;</span>\n        <span>const</span> param <span>=</span> <span>\"id=\"</span> <span>+</span> id <span>+</span> <span>\"&amp;requestId=\"</span> <span>+</span> <span>getUuid</span><span>(</span><span>)</span><span>;</span>\n        encrypt<span>.</span><span>encrypt</span><span>(</span>param<span>)</span><span>;</span>\n        <span>const</span> url <span>=</span> <span>\"http://localhost:9000/api/user/detail?param=\"</span> <span>+</span> encrypt<span>.</span><span>encrypt</span><span>(</span>param<span>)</span><span>;</span>\n        $<span>.</span><span>ajax</span><span>(</span><span>{</span>\n            <span>url</span><span>:</span> url<span>,</span>\n            <span>beforeSend</span><span>:</span> <span>function</span> <span>(</span><span>XMLHttpRequest</span><span>)</span> <span>{</span>\n                XMLHttpRequest<span>.</span><span>setRequestHeader</span><span>(</span><span>\"token\"</span><span>,</span> <span>\"eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIzYzE1ODczYS1iMGUxLTQyNzctYTRjOS1kYTMwNjdiYmE0NWIiLCJpYXQiOjE2MzUzMDYwMDAsInN1YiI6IntcInBhc3N3b3JkXCI6XCIxMjM0NTZcIixcInVzZXJJZFwiOjEsXCJ1c2VybmFtZVwiOlwiYWRtaW5cIn0iLCJleHAiOjE2MzU1NjUyMDB9.fIQi_cV2ZMszBVFV4GoIpGhCSENQKrDi8DsbArk7mGk\"</span><span>)</span><span>;</span>\n            <span>}</span><span>,</span>\n            <span>type</span><span>:</span> <span>\"GET\"</span><span>,</span>\n            <span>success</span><span>:</span> <span>function</span> <span>(</span><span>data</span><span>)</span> <span>{</span>\n                console<span>.</span><span>log</span><span>(</span>data<span>)</span><span>;</span>\n            <span>}</span>\n        <span>}</span><span>)</span><span>;</span>\n    <span>}</span><span>)</span><span>;</span>\n\n\n    <span>function</span> <span>getUuid</span><span>(</span><span>)</span> <span>{</span>\n        <span>var</span> s <span>=</span> <span>[</span><span>]</span><span>;</span>\n        <span>var</span> hexDigits <span>=</span> <span>\"0123456789abcdef\"</span><span>;</span>\n        <span>for</span> <span>(</span><span>var</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> <span>32</span><span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            s<span>[</span>i<span>]</span> <span>=</span> hexDigits<span>.</span><span>substr</span><span>(</span>Math<span>.</span><span>floor</span><span>(</span>Math<span>.</span><span>random</span><span>(</span><span>)</span> <span>*</span> <span>0x10</span><span>)</span><span>,</span> <span>1</span><span>)</span><span>;</span>\n        <span>}</span>\n        s<span>[</span><span>14</span><span>]</span> <span>=</span> <span>\"4\"</span><span>;</span> <span>// bits 12-15 of the time_hi_and_version field to 0010</span>\n        s<span>[</span><span>19</span><span>]</span> <span>=</span> hexDigits<span>.</span><span>substr</span><span>(</span><span>(</span>s<span>[</span><span>19</span><span>]</span> <span>&amp;</span> <span>0x3</span><span>)</span> <span>|</span> <span>0x8</span><span>,</span> <span>1</span><span>)</span><span>;</span> <span>// bits 6-7 of the clock_seq_hi_and_reserved to 01</span>\n        s<span>[</span><span>8</span><span>]</span> <span>=</span> s<span>[</span><span>13</span><span>]</span> <span>=</span> s<span>[</span><span>18</span><span>]</span> <span>=</span> s<span>[</span><span>23</span><span>]</span><span>;</span>\n        <span>var</span> uuid <span>=</span> s<span>.</span><span>join</span><span>(</span><span>\"\"</span><span>)</span><span>;</span>\n        <span>return</span> uuid<span>;</span>\n    <span>}</span>\n\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n\n\n<span><span><span>&lt;/</span>body</span><span>></span></span>\n<span><span><span>&lt;/</span>html</span><span>></span></span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_1-3-3-gatewayfilterconfig\" tabindex=\"-1\"> 1.3.3 GatewayFilterConfig</h4>\n<p><strong>解密前端传来的参数并修改传参</strong></p>\n<div><pre><code><span>package</span> <span>com<span>.</span>demo<span>.</span>gateway<span>.</span>config</span><span>;</span>\n\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>constant<span>.</span></span><span>UserConstant</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>excepiton<span>.</span></span><span>RSAException</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>utils<span>.</span></span><span>RSAUtils</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>utils<span>.</span></span><span>TokenUtils</span></span><span>;</span>\n<span>import</span> <span><span>io<span>.</span>jsonwebtoken<span>.</span></span><span>Claims</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>apache<span>.</span>commons<span>.</span>lang3<span>.</span></span><span>StringUtils</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>cloud<span>.</span>gateway<span>.</span>filter<span>.</span></span><span>GatewayFilterChain</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>cloud<span>.</span>gateway<span>.</span>filter<span>.</span></span><span>GlobalFilter</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>cloud<span>.</span>gateway<span>.</span>filter<span>.</span>factory<span>.</span>rewrite<span>.</span></span><span>CachedBodyOutputMessage</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>cloud<span>.</span>gateway<span>.</span>support<span>.</span></span><span>BodyInserterContext</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>context<span>.</span>annotation<span>.</span></span><span>Configuration</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>core<span>.</span></span><span>Ordered</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>core<span>.</span>io<span>.</span>buffer<span>.</span></span><span>DataBuffer</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>http<span>.</span></span><span>HttpHeaders</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>http<span>.</span></span><span>ReactiveHttpOutputMessage</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>http<span>.</span>server<span>.</span>reactive<span>.</span></span><span>ServerHttpRequest</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>http<span>.</span>server<span>.</span>reactive<span>.</span></span><span>ServerHttpRequestDecorator</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>stereotype<span>.</span></span><span>Component</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>util<span>.</span></span><span>AntPathMatcher</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>reactive<span>.</span>function<span>.</span></span><span>BodyInserter</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>reactive<span>.</span>function<span>.</span></span><span>BodyInserters</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>reactive<span>.</span>function<span>.</span>server<span>.</span></span><span>HandlerStrategies</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>reactive<span>.</span>function<span>.</span>server<span>.</span></span><span>ServerRequest</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>server<span>.</span></span><span>ServerWebExchange</span></span><span>;</span>\n<span>import</span> <span><span>reactor<span>.</span>core<span>.</span>publisher<span>.</span></span><span>Flux</span></span><span>;</span>\n<span>import</span> <span><span>reactor<span>.</span>core<span>.</span>publisher<span>.</span></span><span>Mono</span></span><span>;</span>\n\n<span>import</span> <span><span>java<span>.</span>lang<span>.</span>reflect<span>.</span></span><span>Field</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>net<span>.</span></span><span>URI</span></span><span>;</span>\n\n\n<span>/**\n * @Description:\n * @Author: rosh\n * @Date: 2021/10/26 22:24\n */</span>\n<span>@Configuration</span>\n<span>@Component</span>\n<span>public</span> <span>class</span> <span>GatewayFilterConfig</span> <span>implements</span> <span>GlobalFilter</span><span>,</span> <span>Ordered</span> <span>{</span>\n\n\n    <span>@Override</span>\n    <span>public</span> <span>Mono</span><span><span>&lt;</span><span>Void</span><span>></span></span> <span>filter</span><span>(</span><span>ServerWebExchange</span> exchange<span>,</span> <span>GatewayFilterChain</span> chain<span>)</span> <span>{</span>\n        <span>//1 如果是登录不校验Token</span>\n        <span>String</span> requestUrl <span>=</span> exchange<span>.</span><span>getRequest</span><span>(</span><span>)</span><span>.</span><span>getPath</span><span>(</span><span>)</span><span>.</span><span>value</span><span>(</span><span>)</span><span>;</span>\n        <span>AntPathMatcher</span> pathMatcher <span>=</span> <span>new</span> <span>AntPathMatcher</span><span>(</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span><span>!</span>pathMatcher<span>.</span><span>match</span><span>(</span><span>\"/user/login\"</span><span>,</span> requestUrl<span>)</span><span>)</span> <span>{</span>\n            <span>String</span> token <span>=</span> exchange<span>.</span><span>getRequest</span><span>(</span><span>)</span><span>.</span><span>getHeaders</span><span>(</span><span>)</span><span>.</span><span>getFirst</span><span>(</span><span>UserConstant</span><span>.</span>TOKEN<span>)</span><span>;</span>\n            <span>Claims</span> claim <span>=</span> <span>TokenUtils</span><span>.</span><span>getClaim</span><span>(</span>token<span>)</span><span>;</span>\n            <span>if</span> <span>(</span><span>StringUtils</span><span>.</span><span>isBlank</span><span>(</span>token<span>)</span> <span>||</span> claim <span>==</span> <span>null</span><span>)</span> <span>{</span>\n                <span>return</span> <span>FilterUtils</span><span>.</span><span>invalidToken</span><span>(</span>exchange<span>)</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n        <span>//2 修改请求参数,并获取请求参数</span>\n        <span>try</span> <span>{</span>\n            <span>updateRequestParam</span><span>(</span>exchange<span>)</span><span>;</span>\n        <span>}</span> <span>catch</span> <span>(</span><span>Exception</span> e<span>)</span> <span>{</span>\n            <span>return</span> <span>FilterUtils</span><span>.</span><span>invalidUrl</span><span>(</span>exchange<span>)</span><span>;</span>\n        <span>}</span>\n        <span>//3 获取请求体,修改请求体</span>\n        <span>ServerRequest</span> serverRequest <span>=</span> <span>ServerRequest</span><span>.</span><span>create</span><span>(</span>exchange<span>,</span> <span>HandlerStrategies</span><span>.</span><span>withDefaults</span><span>(</span><span>)</span><span>.</span><span>messageReaders</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>Mono</span><span><span>&lt;</span><span>String</span><span>></span></span> modifiedBody <span>=</span> serverRequest<span>.</span><span>bodyToMono</span><span>(</span><span>String</span><span>.</span><span>class</span><span>)</span><span>.</span><span>flatMap</span><span>(</span>body <span>-></span> <span>{</span>\n            <span>String</span> encrypt <span>=</span> <span>RSAUtils</span><span>.</span><span>decrypt</span><span>(</span>body<span>,</span> <span>RSAConstant</span><span>.</span>PRIVATE_KEY<span>)</span><span>;</span>\n            <span>return</span> <span>Mono</span><span>.</span><span>just</span><span>(</span>encrypt<span>)</span><span>;</span>\n        <span>}</span><span>)</span><span>;</span>\n\n        <span>//创建BodyInserter修改请求体</span>\n        <span>BodyInserter</span><span><span>&lt;</span><span>Mono</span><span>&lt;</span><span>String</span><span>></span><span>,</span> <span>ReactiveHttpOutputMessage</span><span>></span></span> bodyInserter <span>=</span> <span>BodyInserters</span><span>.</span><span>fromPublisher</span><span>(</span>modifiedBody<span>,</span> <span>String</span><span>.</span><span>class</span><span>)</span><span>;</span>\n        <span>HttpHeaders</span> headers <span>=</span> <span>new</span> <span>HttpHeaders</span><span>(</span><span>)</span><span>;</span>\n        headers<span>.</span><span>putAll</span><span>(</span>exchange<span>.</span><span>getRequest</span><span>(</span><span>)</span><span>.</span><span>getHeaders</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        headers<span>.</span><span>remove</span><span>(</span><span>HttpHeaders</span><span>.</span>CONTENT_LENGTH<span>)</span><span>;</span>\n        <span>//创建CachedBodyOutputMessage并且把请求param加入</span>\n        <span>CachedBodyOutputMessage</span> outputMessage <span>=</span> <span>new</span> <span>CachedBodyOutputMessage</span><span>(</span>exchange<span>,</span> headers<span>)</span><span>;</span>\n        <span>return</span> bodyInserter<span>.</span><span>insert</span><span>(</span>outputMessage<span>,</span> <span>new</span> <span>BodyInserterContext</span><span>(</span><span>)</span><span>)</span><span>.</span><span>then</span><span>(</span><span>Mono</span><span>.</span><span>defer</span><span>(</span><span>(</span><span>)</span> <span>-></span> <span>{</span>\n            <span>ServerHttpRequestDecorator</span> decorator <span>=</span> <span>new</span> <span>ServerHttpRequestDecorator</span><span>(</span>exchange<span>.</span><span>getRequest</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n                <span>@Override</span>\n                <span>public</span> <span>Flux</span><span><span>&lt;</span><span>DataBuffer</span><span>></span></span> <span>getBody</span><span>(</span><span>)</span> <span>{</span>\n                    <span>return</span> outputMessage<span>.</span><span>getBody</span><span>(</span><span>)</span><span>;</span>\n                <span>}</span>\n            <span>}</span><span>;</span>\n            <span>return</span> chain<span>.</span><span>filter</span><span>(</span>exchange<span>.</span><span>mutate</span><span>(</span><span>)</span><span>.</span><span>request</span><span>(</span>decorator<span>)</span><span>.</span><span>build</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>}</span><span>)</span><span>)</span><span>;</span>\n\n    <span>}</span>\n\n    <span>/**\n     * 修改前端传的参数\n     */</span>\n    <span>private</span> <span>void</span> <span>updateRequestParam</span><span>(</span><span>ServerWebExchange</span> exchange<span>)</span> <span>throws</span> <span>NoSuchFieldException</span><span>,</span> <span>IllegalAccessException</span> <span>{</span>\n        <span>ServerHttpRequest</span> request <span>=</span> exchange<span>.</span><span>getRequest</span><span>(</span><span>)</span><span>;</span>\n        <span>URI</span> uri <span>=</span> request<span>.</span><span>getURI</span><span>(</span><span>)</span><span>;</span>\n        <span>String</span> query <span>=</span> uri<span>.</span><span>getQuery</span><span>(</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span><span>StringUtils</span><span>.</span><span>isNotBlank</span><span>(</span>query<span>)</span> <span>&amp;&amp;</span> query<span>.</span><span>contains</span><span>(</span><span>\"param\"</span><span>)</span><span>)</span> <span>{</span>\n            <span>String</span><span>[</span><span>]</span> split <span>=</span> query<span>.</span><span>split</span><span>(</span><span>\"=\"</span><span>)</span><span>;</span>\n            <span>String</span> param <span>=</span> <span>RSAUtils</span><span>.</span><span>decrypt</span><span>(</span>split<span>[</span><span>1</span><span>]</span><span>,</span> <span>RSAConstant</span><span>.</span>PRIVATE_KEY<span>)</span><span>;</span>\n            <span>Field</span> targetQuery <span>=</span> uri<span>.</span><span>getClass</span><span>(</span><span>)</span><span>.</span><span>getDeclaredField</span><span>(</span><span>\"query\"</span><span>)</span><span>;</span>\n            targetQuery<span>.</span><span>setAccessible</span><span>(</span><span>true</span><span>)</span><span>;</span>\n            targetQuery<span>.</span><span>set</span><span>(</span>uri<span>,</span> param<span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n\n\n    <span>@Override</span>\n    <span>public</span> <span>int</span> <span>getOrder</span><span>(</span><span>)</span> <span>{</span>\n        <span>return</span> <span>80</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n\n\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_1-3-4-gateway-统一异常\" tabindex=\"-1\"> 1.3.4 GateWay 统一异常</h4>\n<div><pre><code><span>public</span> <span>abstract</span> <span>class</span> <span>AbstractExceptionHandler</span> <span>{</span>\n    <span>protected</span> <span>JSONObject</span> <span>buildErrorMap</span><span>(</span><span>Throwable</span> ex<span>)</span> <span>{</span>\n        <span>JSONObject</span> json <span>=</span> <span>new</span> <span>JSONObject</span><span>(</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span>ex <span>instanceof</span> <span>RSAException</span> <span>||</span> ex <span>instanceof</span> <span>IllegalArgumentException</span><span>)</span> <span>{</span>\n            json<span>.</span><span>put</span><span>(</span><span>\"code\"</span><span>,</span> <span>HttpStatus</span><span>.</span>BAD_REQUEST<span>.</span><span>value</span><span>(</span><span>)</span><span>)</span><span>;</span>\n            <span>if</span> <span>(</span><span>StringUtils</span><span>.</span><span>isNotBlank</span><span>(</span>ex<span>.</span><span>getMessage</span><span>(</span><span>)</span><span>)</span><span>)</span><span>{</span>\n                json<span>.</span><span>put</span><span>(</span><span>\"msg\"</span><span>,</span> ex<span>.</span><span>getMessage</span><span>(</span><span>)</span><span>)</span><span>;</span>\n            <span>}</span><span>else</span> <span>{</span>\n                json<span>.</span><span>put</span><span>(</span><span>\"msg\"</span><span>,</span> <span>\"无效的请求\"</span><span>)</span><span>;</span>\n            <span>}</span>\n\n        <span>}</span> <span>else</span> <span>{</span>\n            json<span>.</span><span>put</span><span>(</span><span>\"code\"</span><span>,</span> <span>HttpStatus</span><span>.</span>BAD_REQUEST<span>.</span><span>value</span><span>(</span><span>)</span><span>)</span><span>;</span>\n            json<span>.</span><span>put</span><span>(</span><span>\"msg\"</span><span>,</span> <span>\"未知错误联系管理员\"</span><span>)</span><span>;</span>\n        <span>}</span>\n        <span>return</span> json<span>;</span>\n    <span>}</span>\n\n<span>}</span>\n\n<span>@Configuration</span>\n<span>public</span> <span>class</span> <span>GatewayExceptionConfig</span> <span>{</span>\n\n    <span>@Primary</span>\n    <span>@Bean</span>\n    <span>@Order</span><span>(</span><span>Ordered</span><span>.</span>HIGHEST_PRECEDENCE<span>)</span>\n    <span>public</span> <span>ErrorWebExceptionHandler</span> <span>errorWebExceptionHandler</span><span>(</span><span>ObjectProvider</span><span><span>&lt;</span><span>List</span><span>&lt;</span><span>ViewResolver</span><span>></span><span>></span></span> viewResolversProvider<span>,</span>\n                                                             <span>ServerCodecConfigurer</span> serverCodecConfigurer<span>)</span> <span>{</span>\n        <span>GatewayExceptionHandler</span> gatewayExceptionHandler <span>=</span> <span>new</span> <span>GatewayExceptionHandler</span><span>(</span><span>)</span><span>;</span>\n        gatewayExceptionHandler<span>.</span><span>setViewResolvers</span><span>(</span>viewResolversProvider<span>.</span><span>getIfAvailable</span><span>(</span><span>Collections</span><span>::</span><span>emptyList</span><span>)</span><span>)</span><span>;</span>\n        gatewayExceptionHandler<span>.</span><span>setMessageWriters</span><span>(</span>serverCodecConfigurer<span>.</span><span>getWriters</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        gatewayExceptionHandler<span>.</span><span>setMessageReaders</span><span>(</span>serverCodecConfigurer<span>.</span><span>getReaders</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>return</span> gatewayExceptionHandler<span>;</span>\n    <span>}</span>\n<span>}</span>\n\n<span>package</span> <span>com<span>.</span>demo<span>.</span>gateway<span>.</span>exception</span><span>;</span>\n\n<span>import</span> <span><span>com<span>.</span>alibaba<span>.</span>fastjson<span>.</span></span><span>JSONObject</span></span><span>;</span>\n<span>import</span> <span><span>lombok<span>.</span>extern<span>.</span>slf4j<span>.</span></span><span>Slf4j</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>boot<span>.</span>web<span>.</span>reactive<span>.</span>error<span>.</span></span><span>ErrorWebExceptionHandler</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>http<span>.</span></span><span>HttpStatus</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>http<span>.</span></span><span>MediaType</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>http<span>.</span>codec<span>.</span></span><span>HttpMessageReader</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>http<span>.</span>codec<span>.</span></span><span>HttpMessageWriter</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>util<span>.</span></span><span>Assert</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>reactive<span>.</span>function<span>.</span></span><span>BodyInserters</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>reactive<span>.</span>function<span>.</span>server<span>.</span></span><span>RequestPredicates</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>reactive<span>.</span>function<span>.</span>server<span>.</span></span><span>RouterFunctions</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>reactive<span>.</span>function<span>.</span>server<span>.</span></span><span>ServerRequest</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>reactive<span>.</span>function<span>.</span>server<span>.</span></span><span>ServerResponse</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>reactive<span>.</span>result<span>.</span>view<span>.</span></span><span>ViewResolver</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>server<span>.</span></span><span>ServerWebExchange</span></span><span>;</span>\n<span>import</span> <span><span>reactor<span>.</span>core<span>.</span>publisher<span>.</span></span><span>Mono</span></span><span>;</span>\n\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Collections</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>List</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Map</span></span><span>;</span>\n\n\n<span>@Slf4j</span>\n<span>public</span> <span>class</span> <span>GatewayExceptionHandler</span> <span>extends</span> <span>AbstractExceptionHandler</span> <span>implements</span> <span>ErrorWebExceptionHandler</span> <span>{</span>\n\n\n    <span>private</span> <span>List</span><span><span>&lt;</span><span>HttpMessageReader</span><span>&lt;</span><span>?</span><span>></span><span>></span></span> messageReaders <span>=</span> <span>Collections</span><span>.</span><span>emptyList</span><span>(</span><span>)</span><span>;</span>\n\n\n    <span>private</span> <span>List</span><span><span>&lt;</span><span>HttpMessageWriter</span><span>&lt;</span><span>?</span><span>></span><span>></span></span> messageWriters <span>=</span> <span>Collections</span><span>.</span><span>emptyList</span><span>(</span><span>)</span><span>;</span>\n\n\n    <span>private</span> <span>List</span><span><span>&lt;</span><span>ViewResolver</span><span>></span></span> viewResolvers <span>=</span> <span>Collections</span><span>.</span><span>emptyList</span><span>(</span><span>)</span><span>;</span>\n\n\n    <span>private</span> <span>ThreadLocal</span><span><span>&lt;</span><span>JSONObject</span><span>></span></span> exceptionHandlerResult <span>=</span> <span>new</span> <span>ThreadLocal</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n\n\n    <span>public</span> <span>void</span> <span>setMessageReaders</span><span>(</span><span>List</span><span><span>&lt;</span><span>HttpMessageReader</span><span>&lt;</span><span>?</span><span>></span><span>></span></span> messageReaders<span>)</span> <span>{</span>\n        <span>Assert</span><span>.</span><span>notNull</span><span>(</span>messageReaders<span>,</span> <span>\"'messageReaders' must not be null\"</span><span>)</span><span>;</span>\n        <span>this</span><span>.</span>messageReaders <span>=</span> messageReaders<span>;</span>\n    <span>}</span>\n\n\n    <span>public</span> <span>void</span> <span>setViewResolvers</span><span>(</span><span>List</span><span><span>&lt;</span><span>ViewResolver</span><span>></span></span> viewResolvers<span>)</span> <span>{</span>\n        <span>this</span><span>.</span>viewResolvers <span>=</span> viewResolvers<span>;</span>\n    <span>}</span>\n\n\n    <span>public</span> <span>void</span> <span>setMessageWriters</span><span>(</span><span>List</span><span><span>&lt;</span><span>HttpMessageWriter</span><span>&lt;</span><span>?</span><span>></span><span>></span></span> messageWriters<span>)</span> <span>{</span>\n        <span>Assert</span><span>.</span><span>notNull</span><span>(</span>messageWriters<span>,</span> <span>\"'messageWriters' must not be null\"</span><span>)</span><span>;</span>\n        <span>this</span><span>.</span>messageWriters <span>=</span> messageWriters<span>;</span>\n    <span>}</span>\n\n    <span>@Override</span>\n    <span>public</span> <span>Mono</span><span><span>&lt;</span><span>Void</span><span>></span></span> <span>handle</span><span>(</span><span>ServerWebExchange</span> exchange<span>,</span> <span>Throwable</span> ex<span>)</span> <span>{</span>\n        <span>JSONObject</span> errorInfo <span>=</span> <span>super</span><span>.</span><span>buildErrorMap</span><span>(</span>ex<span>)</span><span>;</span>\n        <span>if</span> <span>(</span>exchange<span>.</span><span>getResponse</span><span>(</span><span>)</span><span>.</span><span>isCommitted</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n            <span>return</span> <span>Mono</span><span>.</span><span>error</span><span>(</span>ex<span>)</span><span>;</span>\n        <span>}</span>\n        exceptionHandlerResult<span>.</span><span>set</span><span>(</span>errorInfo<span>)</span><span>;</span>\n        <span>ServerRequest</span> newRequest <span>=</span> <span>ServerRequest</span><span>.</span><span>create</span><span>(</span>exchange<span>,</span> <span>this</span><span>.</span>messageReaders<span>)</span><span>;</span>\n        <span>return</span> <span>RouterFunctions</span><span>.</span><span>route</span><span>(</span><span>RequestPredicates</span><span>.</span><span>all</span><span>(</span><span>)</span><span>,</span> <span>this</span><span>::</span><span>renderErrorResponse</span><span>)</span><span>.</span><span>route</span><span>(</span>newRequest<span>)</span>\n                <span>.</span><span>switchIfEmpty</span><span>(</span><span>Mono</span><span>.</span><span>error</span><span>(</span>ex<span>)</span><span>)</span>\n                <span>.</span><span>flatMap</span><span>(</span>handler <span>-></span> handler<span>.</span><span>handle</span><span>(</span>newRequest<span>)</span><span>)</span>\n                <span>.</span><span>flatMap</span><span>(</span>response <span>-></span> <span>write</span><span>(</span>exchange<span>,</span> response<span>)</span><span>)</span><span>;</span>\n\n    <span>}</span>\n\n\n    <span>protected</span> <span>Mono</span><span><span>&lt;</span><span>ServerResponse</span><span>></span></span> <span>renderErrorResponse</span><span>(</span><span>ServerRequest</span> request<span>)</span> <span>{</span>\n        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> result <span>=</span> exceptionHandlerResult<span>.</span><span>get</span><span>(</span><span>)</span><span>;</span>\n        <span>return</span> <span>ServerResponse</span><span>.</span><span>status</span><span>(</span><span>HttpStatus</span><span>.</span>OK<span>)</span>\n                <span>.</span><span>contentType</span><span>(</span><span>MediaType</span><span>.</span>APPLICATION_JSON<span>)</span>\n                <span>.</span><span>body</span><span>(</span><span>BodyInserters</span><span>.</span><span>fromValue</span><span>(</span>result<span>)</span><span>)</span><span>;</span>\n    <span>}</span>\n\n\n    <span>private</span> <span>Mono</span><span><span>&lt;</span><span>?</span> <span>extends</span> <span>Void</span><span>></span></span> <span>write</span><span>(</span><span>ServerWebExchange</span> exchange<span>,</span>\n                                       <span>ServerResponse</span> response<span>)</span> <span>{</span>\n        exchange<span>.</span><span>getResponse</span><span>(</span><span>)</span><span>.</span><span>getHeaders</span><span>(</span><span>)</span><span>.</span><span>setContentType</span><span>(</span>response<span>.</span><span>headers</span><span>(</span><span>)</span><span>.</span><span>getContentType</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>return</span> response<span>.</span><span>writeTo</span><span>(</span>exchange<span>,</span> <span>new</span> <span>ResponseContext</span><span>(</span><span>)</span><span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>private</span> <span>class</span> <span>ResponseContext</span> <span>implements</span> <span>ServerResponse<span>.</span>Context</span> <span>{</span>\n\n        <span>@Override</span>\n        <span>public</span> <span>List</span><span><span>&lt;</span><span>HttpMessageWriter</span><span>&lt;</span><span>?</span><span>></span><span>></span></span> <span>messageWriters</span><span>(</span><span>)</span> <span>{</span>\n            <span>return</span> <span>GatewayExceptionHandler</span><span>.</span><span>this</span><span>.</span>messageWriters<span>;</span>\n        <span>}</span>\n\n        <span>@Override</span>\n        <span>public</span> <span>List</span><span><span>&lt;</span><span>ViewResolver</span><span>></span></span> <span>viewResolvers</span><span>(</span><span>)</span> <span>{</span>\n            <span>return</span> <span>GatewayExceptionHandler</span><span>.</span><span>this</span><span>.</span>viewResolvers<span>;</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_1-3-5-java业务代码\" tabindex=\"-1\"> 1.3.5 JAVA业务代码</h4>\n<div><pre><code><span>@RestController</span>\n<span>@RequestMapping</span><span>(</span><span>\"/user\"</span><span>)</span>\n<span>public</span> <span>class</span> <span>UserController</span> <span>{</span>\n\n\n    <span>@Autowired</span>\n    <span>private</span> <span>UserService</span> userService<span>;</span>\n\n    <span>@PostMapping</span><span>(</span><span>\"/login\"</span><span>)</span>\n    <span>public</span> <span>String</span> <span>login</span><span>(</span><span>@RequestBody</span> <span>UserForm</span> userForm<span>)</span> <span>{</span>\n\n        <span>return</span> userService<span>.</span><span>login</span><span>(</span>userForm<span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>@GetMapping</span><span>(</span><span>\"/detail\"</span><span>)</span>\n    <span>public</span> <span>JSONObject</span> <span>detail</span><span>(</span><span>@RequestParam</span><span>(</span><span>\"id\"</span><span>)</span> <span>Long</span> id<span>)</span> <span>{</span>\n\n        <span>return</span> userService<span>.</span><span>detail</span><span>(</span>id<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n\n<span>@Service</span>\n<span>public</span> <span>class</span> <span>UserService</span> <span>{</span>\n\n\n    <span>private</span> <span>static</span> <span>final</span> <span>String</span> USERNAME <span>=</span> <span>\"admin\"</span><span>;</span>\n\n    <span>private</span> <span>static</span> <span>final</span> <span>String</span> PASSWORD <span>=</span> <span>\"123456\"</span><span>;</span>\n\n    <span>private</span> <span>static</span> <span>final</span> <span>Long</span> USER_ID <span>=</span> <span>1L</span><span>;</span>\n\n\n    <span>/**\n     * 模拟 登录 username = admin, password =123456,user_id 1L 登录成功 返回token\n     */</span>\n    <span>public</span> <span>String</span> <span>login</span><span>(</span><span>UserForm</span> userForm<span>)</span> <span>{</span>\n\n        <span>String</span> username <span>=</span> userForm<span>.</span><span>getUsername</span><span>(</span><span>)</span><span>;</span>\n        <span>String</span> password <span>=</span> userForm<span>.</span><span>getPassword</span><span>(</span><span>)</span><span>;</span>\n\n        <span>if</span> <span>(</span>USERNAME<span>.</span><span>equals</span><span>(</span>username<span>)</span> <span>&amp;&amp;</span> PASSWORD<span>.</span><span>equals</span><span>(</span>password<span>)</span><span>)</span> <span>{</span>\n            <span>JSONObject</span> userInfo <span>=</span> <span>new</span> <span>JSONObject</span><span>(</span><span>)</span><span>;</span>\n            userInfo<span>.</span><span>put</span><span>(</span><span>\"username\"</span><span>,</span> USERNAME<span>)</span><span>;</span>\n            userInfo<span>.</span><span>put</span><span>(</span><span>\"password\"</span><span>,</span> PASSWORD<span>)</span><span>;</span>\n            userInfo<span>.</span><span>put</span><span>(</span><span>\"userId\"</span><span>,</span> USER_ID<span>)</span><span>;</span>\n            <span>return</span> <span>TokenUtils</span><span>.</span><span>createToken</span><span>(</span>userInfo<span>.</span><span>toJSONString</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>}</span>\n\n        <span>return</span> <span>\"账号密码不正确\"</span><span>;</span>\n    <span>}</span>\n\n\n    <span>public</span> <span>JSONObject</span> <span>detail</span><span>(</span><span>Long</span> id<span>)</span> <span>{</span>\n        <span>JSONObject</span> jsonObject <span>=</span> <span>new</span> <span>JSONObject</span><span>(</span><span>)</span><span>;</span>\n        jsonObject<span>.</span><span>put</span><span>(</span><span>\"id\"</span><span>,</span> id<span>)</span><span>;</span>\n        jsonObject<span>.</span><span>put</span><span>(</span><span>\"name\"</span><span>,</span> <span>\"admin\"</span><span>)</span><span>;</span>\n        <span>return</span> jsonObject<span>;</span>\n    <span>}</span>\n<span>}</span>\n\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_1-3-6-测试\" tabindex=\"-1\"> 1.3.6 测试</h4>\n<p><strong>登录：返回token</strong></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/4b616048f06847b281fa138fee22fce2.png\" alt=\"图片\">\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/9f37befbcec5431f936c0f95a0435e35.png\" alt=\"图片\">\n<strong>查询：</strong></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/cacc9233186d40829f143319b6638f0c.png\" alt=\"图片\"></p>\n<h2 id=\"_2-设置url有效时长\" tabindex=\"-1\"> 2 设置URL有效时长</h2>\n<p><strong>为了增强URL安全性，前端在header中添加时间戳。</strong></p>\n<h3 id=\"_2-1-前端代码\" tabindex=\"-1\"> 2.1 前端代码</h3>\n<p><strong>在header中添加时间戳</strong>\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/c608c6d808fa4d30a5318638e56eb520.png\" alt=\"图片\"></p>\n<h3 id=\"_2-2-后端验证时间戳\" tabindex=\"-1\"> 2.2 后端验证时间戳</h3>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/0cd2632ba1ba4effa0158648c07ce14d.png\" alt=\"图片\"></p>\n<div><pre><code> <span>private</span> <span>Long</span> <span>getDateTimestamp</span><span>(</span><span>HttpHeaders</span> httpHeaders<span>)</span> <span>{</span>\n        <span>List</span><span><span>&lt;</span><span>String</span><span>></span></span> list <span>=</span> httpHeaders<span>.</span><span>get</span><span>(</span><span>\"timestamp\"</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span><span>CollectionUtils</span><span>.</span><span>isEmpty</span><span>(</span>list<span>)</span><span>)</span> <span>{</span>\n            <span>throw</span> <span>new</span> <span>IllegalArgumentException</span><span>(</span><span>\"拒绝服务\"</span><span>)</span><span>;</span>\n        <span>}</span>\n        <span>long</span> timestamp <span>=</span> <span>Long</span><span>.</span><span>parseLong</span><span>(</span>list<span>.</span><span>get</span><span>(</span><span>0</span><span>)</span><span>)</span><span>;</span>\n        <span>long</span> currentTimeMillis <span>=</span> <span>System</span><span>.</span><span>currentTimeMillis</span><span>(</span><span>)</span><span>;</span>\n        <span>//有效时长为5分钟</span>\n        <span>if</span> <span>(</span>currentTimeMillis <span>-</span> timestamp <span>></span> <span>1000</span> <span>*</span> <span>60</span> <span>*</span> <span>5</span><span>)</span> <span>{</span>\n            <span>throw</span> <span>new</span> <span>IllegalArgumentException</span><span>(</span><span>\"拒绝服务\"</span><span>)</span><span>;</span>\n        <span>}</span>\n        <span>return</span> timestamp<span>;</span>\n    <span>}</span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"_2-3-测试不传时间戳\" tabindex=\"-1\"> 2.3 测试不传时间戳</h3>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/34c5e25305384149b8cb25236dcdfe9a.png\" alt=\"图片\"></p>\n<h2 id=\"_3-确保url唯一性\" tabindex=\"-1\"> 3 确保URL唯一性</h2>\n<p><strong>确保URL唯一性，前端请求中增加UUID，后端存入redis，有效时长为5分钟，5分钟重复提交拒绝服务</strong></p>\n<h3 id=\"_3-1-修改前端请求参数\" tabindex=\"-1\"> 3.1 修改前端请求参数</h3>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/a7a2c3ad23d74f6a93a98738776f1568.png\" alt=\"图片\"></p>\n<h3 id=\"_3-2-后端增加验证requestid\" tabindex=\"-1\"> 3.2 后端增加验证RequestId</h3>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/14ff62fc309947d19b859c4311502c0a.png\" alt=\"图片\"></p>\n<div><pre><code><span>private</span> <span>String</span> <span>getRequestId</span><span>(</span><span>HttpHeaders</span> headers<span>)</span> <span>{</span>\n        <span>List</span><span><span>&lt;</span><span>String</span><span>></span></span> list <span>=</span> headers<span>.</span><span>get</span><span>(</span><span>\"requestId\"</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span><span>CollectionUtils</span><span>.</span><span>isEmpty</span><span>(</span>list<span>)</span><span>)</span> <span>{</span>\n            <span>throw</span> <span>new</span> <span>IllegalArgumentException</span><span>(</span>ERROR_MESSAGE<span>)</span><span>;</span>\n        <span>}</span>\n        <span>String</span> requestId <span>=</span> list<span>.</span><span>get</span><span>(</span><span>0</span><span>)</span><span>;</span>\n        <span>//如果requestId存在redis中直接返回</span>\n        <span>String</span> temp <span>=</span> redisTemplate<span>.</span><span>opsForValue</span><span>(</span><span>)</span><span>.</span><span>get</span><span>(</span>requestId<span>)</span><span>;</span>\n        <span>if</span> <span>(</span><span>StringUtils</span><span>.</span><span>isNotBlank</span><span>(</span>temp<span>)</span><span>)</span> <span>{</span>\n            <span>throw</span> <span>new</span> <span>IllegalArgumentException</span><span>(</span>ERROR_MESSAGE<span>)</span><span>;</span>\n        <span>}</span>\n        redisTemplate<span>.</span><span>opsForValue</span><span>(</span><span>)</span><span>.</span><span>set</span><span>(</span>requestId<span>,</span> requestId<span>,</span> <span>5</span><span>,</span> <span>TimeUnit</span><span>.</span>MINUTES<span>)</span><span>;</span>\n        <span>return</span> requestId<span>;</span>\n    <span>}</span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_4-增加签名\" tabindex=\"-1\"> 4 增加签名</h2>\n<p><strong>最后一步，添加签名</strong></p>\n<h3 id=\"_4-1-前端增加签名\" tabindex=\"-1\"> 4.1 前端增加签名</h3>\n<p>跟前端约定好，json数据按照ASCII升序排序。</p>\n<p>登录页面：</p>\n<div><pre><code><span><span>&lt;!</span><span>DOCTYPE</span> <span>html</span><span>></span></span>\n<span><span><span>&lt;</span>html</span> <span>lang</span><span><span>=</span><span>\"</span>en<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;</span>head</span><span>></span></span>\n    <span><span><span>&lt;</span>meta</span> <span>charset</span><span><span>=</span><span>\"</span>UTF-8<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>title</span><span>></span></span>登录页面<span><span><span>&lt;/</span>title</span><span>></span></span>\n\n<span><span><span>&lt;/</span>head</span><span>></span></span>\n<span><span><span>&lt;</span>body</span><span>></span></span>\n\n<span><span><span>&lt;</span>h1</span><span>></span></span>登录<span><span><span>&lt;/</span>h1</span><span>></span></span>\n\n\n<span><span><span>&lt;</span>from</span> <span>id</span><span><span>=</span><span>\"</span>from<span>\"</span></span><span>></span></span>\n    账号：<span><span><span>&lt;</span>input</span> <span>id</span><span><span>=</span><span>\"</span>username<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>text<span>\"</span></span><span>/></span></span>\n    <span><span><span>&lt;</span>br</span><span>/></span></span>\n    密码：<span><span><span>&lt;</span>input</span> <span>id</span><span><span>=</span><span>\"</span>password<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>password<span>\"</span></span><span>/></span></span>\n    <span><span><span>&lt;</span>br</span><span>/></span></span>\n    <span><span><span>&lt;</span>input</span> <span>id</span><span><span>=</span><span>\"</span>btn_login<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>button<span>\"</span></span> <span>value</span><span><span>=</span><span>\"</span>登录<span>\"</span></span><span>/></span></span>\n<span><span><span>&lt;/</span>from</span><span>></span></span>\n\n\n\n\n<span><span><span>&lt;</span>script</span> <span>src</span><span><span>=</span><span>\"</span>js/jquery.min.js<span>\"</span></span><span>></span></span><span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n<span><span><span>&lt;</span>script</span> <span>src</span><span><span>=</span><span>\"</span>js/jsencrypt.js<span>\"</span></span><span>></span></span><span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n<span><span><span>&lt;</span>script</span> <span>src</span><span><span>=</span><span>\"</span>js/md5.min.js<span>\"</span></span><span>></span></span><span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n\n<span><span><span>&lt;</span>script</span> <span>type</span><span><span>=</span><span>\"</span>text/javascript<span>\"</span></span><span>></span></span><span><span>\n    <span>var</span> encrypt <span>=</span> <span>new</span> <span>JSEncrypt</span><span>(</span><span>)</span><span>;</span>\n    encrypt<span>.</span><span>setPublicKey</span><span>(</span><span>\"MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCFtTlL61IqIGd+fRLUhJ0MjsqFXFJswCohJ45m51WvbxDPRP3gllW0WChk74D5JEOpMDSWo4C7RfoGlBRNW7kQ6qYGukYZ5jgYpzoT0+gp3on96fQXEyQJysv9xiTPIdmSXXVVj1HAOJw29RbzxIVKUSzzPXvEtXRTtCC1+wkAJQIDAQAB\"</span><span>)</span><span>;</span>\n    <span>$</span><span>(</span><span>\"#btn_login\"</span><span>)</span><span>.</span><span>click</span><span>(</span><span>function</span> <span>(</span><span>)</span> <span>{</span>\n        <span>//表单</span>\n        <span>const</span> username <span>=</span> <span>$</span><span>(</span><span>\"#username\"</span><span>)</span><span>.</span><span>val</span><span>(</span><span>)</span><span>;</span>\n        <span>const</span> password <span>=</span> <span>$</span><span>(</span><span>\"#password\"</span><span>)</span><span>.</span><span>val</span><span>(</span><span>)</span><span>;</span>\n        <span>const</span> form <span>=</span> <span>{</span><span>}</span><span>;</span>\n        form<span>.</span>username <span>=</span> username<span>;</span>\n        form<span>.</span>password <span>=</span> password<span>;</span>\n        <span>//生成签名，也可以加盐</span>\n        <span>const</span> timestamp <span>=</span> Date<span>.</span><span>parse</span><span>(</span><span>new</span> <span>Date</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>const</span> data <span>=</span> <span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>sort_ASCII</span><span>(</span>form<span>)</span><span>)</span><span>;</span>\n        <span>const</span> requestId <span>=</span> <span>getUuid</span><span>(</span><span>)</span><span>;</span>\n        <span>const</span> sign <span>=</span> <span>MD5</span><span>(</span>data <span>+</span> requestId <span>+</span> timestamp<span>)</span><span>;</span>\n\n\n        $<span>.</span><span>ajax</span><span>(</span><span>{</span>\n            <span>url</span><span>:</span> <span>\"http://localhost:9000/api/user/login\"</span><span>,</span>\n            <span>beforeSend</span><span>:</span> <span>function</span> <span>(</span><span>XMLHttpRequest</span><span>)</span> <span>{</span>\n                XMLHttpRequest<span>.</span><span>setRequestHeader</span><span>(</span><span>\"timestamp\"</span><span>,</span> timestamp<span>)</span><span>;</span>\n                XMLHttpRequest<span>.</span><span>setRequestHeader</span><span>(</span><span>\"requestId\"</span><span>,</span> requestId<span>)</span><span>;</span>\n                XMLHttpRequest<span>.</span><span>setRequestHeader</span><span>(</span><span>\"sign\"</span><span>,</span> sign<span>)</span><span>;</span>\n            <span>}</span><span>,</span>\n            <span>data</span><span>:</span> encrypt<span>.</span><span>encrypt</span><span>(</span>data<span>)</span><span>,</span>\n            <span>type</span><span>:</span> <span>\"POST\"</span><span>,</span>\n            <span>dataType</span><span>:</span> <span>\"json\"</span><span>,</span>\n            <span>contentType</span><span>:</span> <span>\"application/json;charset=utf-8\"</span><span>,</span>\n            <span>success</span><span>:</span> <span>function</span> <span>(</span><span>data</span><span>)</span> <span>{</span>\n                console<span>.</span><span>log</span><span>(</span>data<span>)</span><span>;</span>\n            <span>}</span>\n        <span>}</span><span>)</span><span>;</span>\n    <span>}</span><span>)</span><span>;</span>\n\n\n    <span>function</span> <span>getUuid</span><span>(</span><span>)</span> <span>{</span>\n        <span>var</span> s <span>=</span> <span>[</span><span>]</span><span>;</span>\n        <span>var</span> hexDigits <span>=</span> <span>\"0123456789abcdef\"</span><span>;</span>\n        <span>for</span> <span>(</span><span>var</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> <span>32</span><span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            s<span>[</span>i<span>]</span> <span>=</span> hexDigits<span>.</span><span>substr</span><span>(</span>Math<span>.</span><span>floor</span><span>(</span>Math<span>.</span><span>random</span><span>(</span><span>)</span> <span>*</span> <span>0x10</span><span>)</span><span>,</span> <span>1</span><span>)</span><span>;</span>\n        <span>}</span>\n        s<span>[</span><span>14</span><span>]</span> <span>=</span> <span>\"4\"</span><span>;</span> <span>// bits 12-15 of the time_hi_and_version field to 0010</span>\n        s<span>[</span><span>19</span><span>]</span> <span>=</span> hexDigits<span>.</span><span>substr</span><span>(</span><span>(</span>s<span>[</span><span>19</span><span>]</span> <span>&amp;</span> <span>0x3</span><span>)</span> <span>|</span> <span>0x8</span><span>,</span> <span>1</span><span>)</span><span>;</span> <span>// bits 6-7 of the clock_seq_hi_and_reserved to 01</span>\n        s<span>[</span><span>8</span><span>]</span> <span>=</span> s<span>[</span><span>13</span><span>]</span> <span>=</span> s<span>[</span><span>18</span><span>]</span> <span>=</span> s<span>[</span><span>23</span><span>]</span><span>;</span>\n        <span>var</span> uuid <span>=</span> s<span>.</span><span>join</span><span>(</span><span>\"\"</span><span>)</span><span>;</span>\n        <span>return</span> uuid<span>;</span>\n    <span>}</span>\n\n    <span>function</span> <span>sort_ASCII</span><span>(</span><span>obj</span><span>)</span> <span>{</span>\n        <span>var</span> arr <span>=</span> <span>new</span> <span>Array</span><span>(</span><span>)</span><span>;</span>\n        <span>var</span> num <span>=</span> <span>0</span><span>;</span>\n        <span>for</span> <span>(</span><span>var</span> i <span>in</span> obj<span>)</span> <span>{</span>\n            arr<span>[</span>num<span>]</span> <span>=</span> i<span>;</span>\n            num<span>++</span><span>;</span>\n        <span>}</span>\n        <span>var</span> sortArr <span>=</span> arr<span>.</span><span>sort</span><span>(</span><span>)</span><span>;</span>\n        <span>var</span> sortObj <span>=</span> <span>{</span><span>}</span><span>;</span>\n        <span>for</span> <span>(</span><span>var</span> i <span>in</span> sortArr<span>)</span> <span>{</span>\n            sortObj<span>[</span>sortArr<span>[</span>i<span>]</span><span>]</span> <span>=</span> obj<span>[</span>sortArr<span>[</span>i<span>]</span><span>]</span><span>;</span>\n        <span>}</span>\n        <span>return</span> sortObj<span>;</span>\n    <span>}</span>\n\n</span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n\n\n<span><span><span>&lt;/</span>body</span><span>></span></span>\n<span><span><span>&lt;/</span>html</span><span>></span></span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"_4-2-增强读取body类\" tabindex=\"-1\"> 4.2 增强读取Body类</h3>\n<div><pre><code><span>/**\n * @Description:\n * @Author: Rosh\n * @Date: 2021/10/27 11:03\n */</span>\n<span>public</span> <span>class</span> <span>MyCachedBodyOutputMessage</span> <span>extends</span> <span>CachedBodyOutputMessage</span> <span>{</span>\n\n    <span>private</span> <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> paramMap<span>;</span>\n\n    <span>private</span> <span>Long</span> dateTimestamp<span>;</span>\n\n    <span>private</span> <span>String</span> requestId<span>;</span>\n\n    <span>private</span> <span>String</span> sign<span>;</span>\n\n    <span>public</span> <span>MyCachedBodyOutputMessage</span><span>(</span><span>ServerWebExchange</span> exchange<span>,</span> <span>HttpHeaders</span> httpHeaders<span>)</span> <span>{</span>\n        <span>super</span><span>(</span>exchange<span>,</span> httpHeaders<span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>public</span> <span>void</span> <span>initial</span><span>(</span><span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> paramMap<span>,</span> <span>String</span> requestId<span>,</span> <span>String</span> sign<span>,</span> <span>Long</span> dateTimestamp<span>)</span> <span>{</span>\n        <span>this</span><span>.</span>paramMap <span>=</span> paramMap<span>;</span>\n        <span>this</span><span>.</span>requestId <span>=</span> requestId<span>;</span>\n        <span>this</span><span>.</span>sign <span>=</span> sign<span>;</span>\n        <span>this</span><span>.</span>dateTimestamp <span>=</span> dateTimestamp<span>;</span>\n    <span>}</span>\n\n\n    <span>public</span> <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> <span>getParamMap</span><span>(</span><span>)</span> <span>{</span>\n        <span>return</span> paramMap<span>;</span>\n    <span>}</span>\n\n    <span>public</span> <span>Long</span> <span>getDateTimestamp</span><span>(</span><span>)</span> <span>{</span>\n        <span>return</span> dateTimestamp<span>;</span>\n    <span>}</span>\n\n    <span>public</span> <span>String</span> <span>getRequestId</span><span>(</span><span>)</span> <span>{</span>\n        <span>return</span> requestId<span>;</span>\n    <span>}</span>\n\n    <span>public</span> <span>String</span> <span>getSign</span><span>(</span><span>)</span> <span>{</span>\n        <span>return</span> sign<span>;</span>\n    <span>}</span>\n<span>}</span>\n\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"_4-3-修改gatewayfilterconfig\" tabindex=\"-1\"> 4.3 修改GatewayFilterConfig</h3>\n<div><pre><code><span>package</span> <span>com<span>.</span>demo<span>.</span>gateway<span>.</span>config</span><span>;</span>\n\n<span>import</span> <span><span>com<span>.</span>alibaba<span>.</span>fastjson<span>.</span></span><span>JSON</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>alibaba<span>.</span>fastjson<span>.</span></span><span>JSONObject</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>alibaba<span>.</span>nacos<span>.</span>common<span>.</span>utils<span>.</span></span><span>Md5Utils</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>constant<span>.</span></span><span>UserConstant</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>gateway<span>.</span>pojo<span>.</span></span><span>MyCachedBodyOutputMessage</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>utils<span>.</span></span><span>RSAUtils</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>utils<span>.</span></span><span>TokenUtils</span></span><span>;</span>\n<span>import</span> <span><span>io<span>.</span>jsonwebtoken<span>.</span></span><span>Claims</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>apache<span>.</span>commons<span>.</span>lang3<span>.</span></span><span>StringUtils</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>beans<span>.</span>factory<span>.</span>annotation<span>.</span></span><span>Autowired</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>cloud<span>.</span>gateway<span>.</span>filter<span>.</span></span><span>GatewayFilterChain</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>cloud<span>.</span>gateway<span>.</span>filter<span>.</span></span><span>GlobalFilter</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>cloud<span>.</span>gateway<span>.</span>support<span>.</span></span><span>BodyInserterContext</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>context<span>.</span>annotation<span>.</span></span><span>Configuration</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>core<span>.</span></span><span>Ordered</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>core<span>.</span>io<span>.</span>buffer<span>.</span></span><span>DataBuffer</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>data<span>.</span>redis<span>.</span>core<span>.</span></span><span>RedisTemplate</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>http<span>.</span></span><span>HttpHeaders</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>http<span>.</span></span><span>ReactiveHttpOutputMessage</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>http<span>.</span>server<span>.</span>reactive<span>.</span></span><span>ServerHttpRequest</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>http<span>.</span>server<span>.</span>reactive<span>.</span></span><span>ServerHttpRequestDecorator</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>stereotype<span>.</span></span><span>Component</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>util<span>.</span></span><span>AntPathMatcher</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>util<span>.</span></span><span>CollectionUtils</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>reactive<span>.</span>function<span>.</span></span><span>BodyInserter</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>reactive<span>.</span>function<span>.</span></span><span>BodyInserters</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>reactive<span>.</span>function<span>.</span>server<span>.</span></span><span>HandlerStrategies</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>reactive<span>.</span>function<span>.</span>server<span>.</span></span><span>ServerRequest</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>server<span>.</span></span><span>ServerWebExchange</span></span><span>;</span>\n<span>import</span> <span><span>reactor<span>.</span>core<span>.</span>publisher<span>.</span></span><span>Flux</span></span><span>;</span>\n<span>import</span> <span><span>reactor<span>.</span>core<span>.</span>publisher<span>.</span></span><span>Mono</span></span><span>;</span>\n\n<span>import</span> <span><span>java<span>.</span>lang<span>.</span>reflect<span>.</span></span><span>Field</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>net<span>.</span></span><span>URI</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>List</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Map</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>TreeMap</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span>concurrent<span>.</span></span><span>TimeUnit</span></span><span>;</span>\n\n\n<span>/**\n * @Description:\n * @Author: rosh\n * @Date: 2021/10/26 22:24\n */</span>\n<span>@Configuration</span>\n<span>@Component</span>\n<span>public</span> <span>class</span> <span>GatewayFilterConfig</span> <span>implements</span> <span>GlobalFilter</span><span>,</span> <span>Ordered</span> <span>{</span>\n\n\n    <span>@Autowired</span>\n    <span>private</span> <span>RedisTemplate</span><span><span>&lt;</span><span>String</span><span>,</span> <span>String</span><span>></span></span> redisTemplate<span>;</span>\n\n\n    <span>private</span> <span>static</span> <span>final</span> <span>String</span> ERROR_MESSAGE <span>=</span> <span>\"拒绝服务\"</span><span>;</span>\n\n\n    <span>@Override</span>\n    <span>public</span> <span>Mono</span><span><span>&lt;</span><span>Void</span><span>></span></span> <span>filter</span><span>(</span><span>ServerWebExchange</span> exchange<span>,</span> <span>GatewayFilterChain</span> chain<span>)</span> <span>{</span>\n        <span>//1 获取时间戳</span>\n        <span>Long</span> dateTimestamp <span>=</span> <span>getDateTimestamp</span><span>(</span>exchange<span>.</span><span>getRequest</span><span>(</span><span>)</span><span>.</span><span>getHeaders</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>//2 获取RequestId</span>\n        <span>String</span> requestId <span>=</span> <span>getRequestId</span><span>(</span>exchange<span>.</span><span>getRequest</span><span>(</span><span>)</span><span>.</span><span>getHeaders</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>//3 获取签名</span>\n        <span>String</span> sign <span>=</span> <span>getSign</span><span>(</span>exchange<span>.</span><span>getRequest</span><span>(</span><span>)</span><span>.</span><span>getHeaders</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>//4 如果是登录不校验Token</span>\n        <span>String</span> requestUrl <span>=</span> exchange<span>.</span><span>getRequest</span><span>(</span><span>)</span><span>.</span><span>getPath</span><span>(</span><span>)</span><span>.</span><span>value</span><span>(</span><span>)</span><span>;</span>\n        <span>AntPathMatcher</span> pathMatcher <span>=</span> <span>new</span> <span>AntPathMatcher</span><span>(</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span><span>!</span>pathMatcher<span>.</span><span>match</span><span>(</span><span>\"/user/login\"</span><span>,</span> requestUrl<span>)</span><span>)</span> <span>{</span>\n            <span>String</span> token <span>=</span> exchange<span>.</span><span>getRequest</span><span>(</span><span>)</span><span>.</span><span>getHeaders</span><span>(</span><span>)</span><span>.</span><span>getFirst</span><span>(</span><span>UserConstant</span><span>.</span>TOKEN<span>)</span><span>;</span>\n            <span>Claims</span> claim <span>=</span> <span>TokenUtils</span><span>.</span><span>getClaim</span><span>(</span>token<span>)</span><span>;</span>\n            <span>if</span> <span>(</span><span>StringUtils</span><span>.</span><span>isBlank</span><span>(</span>token<span>)</span> <span>||</span> claim <span>==</span> <span>null</span><span>)</span> <span>{</span>\n                <span>return</span> <span>FilterUtils</span><span>.</span><span>invalidToken</span><span>(</span>exchange<span>)</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n        <span>//5 修改请求参数,并获取请求参数</span>\n        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> paramMap<span>;</span>\n        <span>try</span> <span>{</span>\n            paramMap <span>=</span> <span>updateRequestParam</span><span>(</span>exchange<span>)</span><span>;</span>\n        <span>}</span> <span>catch</span> <span>(</span><span>Exception</span> e<span>)</span> <span>{</span>\n            <span>return</span> <span>FilterUtils</span><span>.</span><span>invalidUrl</span><span>(</span>exchange<span>)</span><span>;</span>\n        <span>}</span>\n        <span>//6 获取请求体,修改请求体</span>\n        <span>ServerRequest</span> serverRequest <span>=</span> <span>ServerRequest</span><span>.</span><span>create</span><span>(</span>exchange<span>,</span> <span>HandlerStrategies</span><span>.</span><span>withDefaults</span><span>(</span><span>)</span><span>.</span><span>messageReaders</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>Mono</span><span><span>&lt;</span><span>String</span><span>></span></span> modifiedBody <span>=</span> serverRequest<span>.</span><span>bodyToMono</span><span>(</span><span>String</span><span>.</span><span>class</span><span>)</span><span>.</span><span>flatMap</span><span>(</span>body <span>-></span> <span>{</span>\n            <span>String</span> encrypt <span>=</span> <span>RSAUtils</span><span>.</span><span>decrypt</span><span>(</span>body<span>,</span> <span>RSAConstant</span><span>.</span>PRIVATE_KEY<span>)</span><span>;</span>\n            <span>JSONObject</span> jsonObject <span>=</span> JSON<span>.</span><span>parseObject</span><span>(</span>encrypt<span>)</span><span>;</span>\n            <span>for</span> <span>(</span><span>Map<span>.</span>Entry</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> entry <span>:</span> jsonObject<span>.</span><span>entrySet</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n                paramMap<span>.</span><span>put</span><span>(</span>entry<span>.</span><span>getKey</span><span>(</span><span>)</span><span>,</span> entry<span>.</span><span>getValue</span><span>(</span><span>)</span><span>)</span><span>;</span>\n            <span>}</span>\n            <span>checkSign</span><span>(</span>sign<span>,</span> dateTimestamp<span>,</span> requestId<span>,</span> paramMap<span>)</span><span>;</span>\n            <span>return</span> <span>Mono</span><span>.</span><span>just</span><span>(</span>encrypt<span>)</span><span>;</span>\n        <span>}</span><span>)</span><span>;</span>\n\n        <span>//创建BodyInserter修改请求体</span>\n\n        <span>BodyInserter</span><span><span>&lt;</span><span>Mono</span><span>&lt;</span><span>String</span><span>></span><span>,</span> <span>ReactiveHttpOutputMessage</span><span>></span></span> bodyInserter <span>=</span> <span>BodyInserters</span><span>.</span><span>fromPublisher</span><span>(</span>modifiedBody<span>,</span> <span>String</span><span>.</span><span>class</span><span>)</span><span>;</span>\n        <span>HttpHeaders</span> headers <span>=</span> <span>new</span> <span>HttpHeaders</span><span>(</span><span>)</span><span>;</span>\n        headers<span>.</span><span>putAll</span><span>(</span>exchange<span>.</span><span>getRequest</span><span>(</span><span>)</span><span>.</span><span>getHeaders</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        headers<span>.</span><span>remove</span><span>(</span><span>HttpHeaders</span><span>.</span>CONTENT_LENGTH<span>)</span><span>;</span>\n        <span>//创建CachedBodyOutputMessage并且把请求param加入,初始化校验信息</span>\n        <span>MyCachedBodyOutputMessage</span> outputMessage <span>=</span> <span>new</span> <span>MyCachedBodyOutputMessage</span><span>(</span>exchange<span>,</span> headers<span>)</span><span>;</span>\n        outputMessage<span>.</span><span>initial</span><span>(</span>paramMap<span>,</span> requestId<span>,</span> sign<span>,</span> dateTimestamp<span>)</span><span>;</span>\n        <span>return</span> bodyInserter<span>.</span><span>insert</span><span>(</span>outputMessage<span>,</span> <span>new</span> <span>BodyInserterContext</span><span>(</span><span>)</span><span>)</span><span>.</span><span>then</span><span>(</span><span>Mono</span><span>.</span><span>defer</span><span>(</span><span>(</span><span>)</span> <span>-></span> <span>{</span>\n            <span>ServerHttpRequestDecorator</span> decorator <span>=</span> <span>new</span> <span>ServerHttpRequestDecorator</span><span>(</span>exchange<span>.</span><span>getRequest</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n                <span>@Override</span>\n                <span>public</span> <span>Flux</span><span><span>&lt;</span><span>DataBuffer</span><span>></span></span> <span>getBody</span><span>(</span><span>)</span> <span>{</span>\n                    <span>Flux</span><span><span>&lt;</span><span>DataBuffer</span><span>></span></span> body <span>=</span> outputMessage<span>.</span><span>getBody</span><span>(</span><span>)</span><span>;</span>\n                    <span>if</span> <span>(</span>body<span>.</span><span>equals</span><span>(</span><span>Flux</span><span>.</span><span>empty</span><span>(</span><span>)</span><span>)</span><span>)</span> <span>{</span>\n                        <span>//验证签名</span>\n                        <span>checkSign</span><span>(</span>outputMessage<span>.</span><span>getSign</span><span>(</span><span>)</span><span>,</span> outputMessage<span>.</span><span>getDateTimestamp</span><span>(</span><span>)</span><span>,</span> outputMessage<span>.</span><span>getRequestId</span><span>(</span><span>)</span><span>,</span> outputMessage<span>.</span><span>getParamMap</span><span>(</span><span>)</span><span>)</span><span>;</span>\n                    <span>}</span>\n                    <span>return</span> outputMessage<span>.</span><span>getBody</span><span>(</span><span>)</span><span>;</span>\n                <span>}</span>\n            <span>}</span><span>;</span>\n            <span>return</span> chain<span>.</span><span>filter</span><span>(</span>exchange<span>.</span><span>mutate</span><span>(</span><span>)</span><span>.</span><span>request</span><span>(</span>decorator<span>)</span><span>.</span><span>build</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>}</span><span>)</span><span>)</span><span>;</span>\n\n    <span>}</span>\n\n    <span>public</span> <span>void</span> <span>checkSign</span><span>(</span><span>String</span> sign<span>,</span> <span>Long</span> dateTimestamp<span>,</span> <span>String</span> requestId<span>,</span> <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> paramMap<span>)</span> <span>{</span>\n        <span>String</span> str <span>=</span> JSON<span>.</span><span>toJSONString</span><span>(</span>paramMap<span>)</span> <span>+</span> requestId <span>+</span> dateTimestamp<span>;</span>\n        <span>String</span> tempSign <span>=</span> <span>Md5Utils</span><span>.</span><span>getMD5</span><span>(</span>str<span>.</span><span>getBytes</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span><span>!</span>tempSign<span>.</span><span>equals</span><span>(</span>sign<span>)</span><span>)</span> <span>{</span>\n            <span>throw</span> <span>new</span> <span>IllegalArgumentException</span><span>(</span>ERROR_MESSAGE<span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n\n    <span>/**\n     * 修改前端传的参数\n     */</span>\n    <span>private</span> <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> <span>updateRequestParam</span><span>(</span><span>ServerWebExchange</span> exchange<span>)</span> <span>throws</span> <span>NoSuchFieldException</span><span>,</span> <span>IllegalAccessException</span> <span>{</span>\n        <span>ServerHttpRequest</span> request <span>=</span> exchange<span>.</span><span>getRequest</span><span>(</span><span>)</span><span>;</span>\n        <span>URI</span> uri <span>=</span> request<span>.</span><span>getURI</span><span>(</span><span>)</span><span>;</span>\n        <span>String</span> query <span>=</span> uri<span>.</span><span>getQuery</span><span>(</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span><span>StringUtils</span><span>.</span><span>isNotBlank</span><span>(</span>query<span>)</span> <span>&amp;&amp;</span> query<span>.</span><span>contains</span><span>(</span><span>\"param\"</span><span>)</span><span>)</span> <span>{</span>\n            <span>String</span><span>[</span><span>]</span> split <span>=</span> query<span>.</span><span>split</span><span>(</span><span>\"=\"</span><span>)</span><span>;</span>\n            <span>String</span> param <span>=</span> <span>RSAUtils</span><span>.</span><span>decrypt</span><span>(</span>split<span>[</span><span>1</span><span>]</span><span>,</span> <span>RSAConstant</span><span>.</span>PRIVATE_KEY<span>)</span><span>;</span>\n            <span>Field</span> targetQuery <span>=</span> uri<span>.</span><span>getClass</span><span>(</span><span>)</span><span>.</span><span>getDeclaredField</span><span>(</span><span>\"query\"</span><span>)</span><span>;</span>\n            targetQuery<span>.</span><span>setAccessible</span><span>(</span><span>true</span><span>)</span><span>;</span>\n            targetQuery<span>.</span><span>set</span><span>(</span>uri<span>,</span> param<span>)</span><span>;</span>\n            <span>return</span> <span>getParamMap</span><span>(</span>param<span>)</span><span>;</span>\n        <span>}</span>\n        <span>return</span> <span>new</span> <span>TreeMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n    <span>}</span>\n\n\n    <span>private</span> <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> <span>getParamMap</span><span>(</span><span>String</span> param<span>)</span> <span>{</span>\n        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> map <span>=</span> <span>new</span> <span>TreeMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        <span>String</span><span>[</span><span>]</span> split <span>=</span> param<span>.</span><span>split</span><span>(</span><span>\"&amp;\"</span><span>)</span><span>;</span>\n        <span>for</span> <span>(</span><span>String</span> str <span>:</span> split<span>)</span> <span>{</span>\n            <span>String</span><span>[</span><span>]</span> params <span>=</span> str<span>.</span><span>split</span><span>(</span><span>\"=\"</span><span>)</span><span>;</span>\n            map<span>.</span><span>put</span><span>(</span>params<span>[</span><span>0</span><span>]</span><span>,</span> params<span>[</span><span>1</span><span>]</span><span>)</span><span>;</span>\n        <span>}</span>\n        <span>return</span> map<span>;</span>\n    <span>}</span>\n\n\n    <span>private</span> <span>String</span> <span>getSign</span><span>(</span><span>HttpHeaders</span> headers<span>)</span> <span>{</span>\n        <span>List</span><span><span>&lt;</span><span>String</span><span>></span></span> list <span>=</span> headers<span>.</span><span>get</span><span>(</span><span>\"sign\"</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span><span>CollectionUtils</span><span>.</span><span>isEmpty</span><span>(</span>list<span>)</span><span>)</span> <span>{</span>\n            <span>throw</span> <span>new</span> <span>IllegalArgumentException</span><span>(</span>ERROR_MESSAGE<span>)</span><span>;</span>\n        <span>}</span>\n        <span>return</span> list<span>.</span><span>get</span><span>(</span><span>0</span><span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>private</span> <span>Long</span> <span>getDateTimestamp</span><span>(</span><span>HttpHeaders</span> httpHeaders<span>)</span> <span>{</span>\n        <span>List</span><span><span>&lt;</span><span>String</span><span>></span></span> list <span>=</span> httpHeaders<span>.</span><span>get</span><span>(</span><span>\"timestamp\"</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span><span>CollectionUtils</span><span>.</span><span>isEmpty</span><span>(</span>list<span>)</span><span>)</span> <span>{</span>\n            <span>throw</span> <span>new</span> <span>IllegalArgumentException</span><span>(</span>ERROR_MESSAGE<span>)</span><span>;</span>\n        <span>}</span>\n        <span>long</span> timestamp <span>=</span> <span>Long</span><span>.</span><span>parseLong</span><span>(</span>list<span>.</span><span>get</span><span>(</span><span>0</span><span>)</span><span>)</span><span>;</span>\n        <span>long</span> currentTimeMillis <span>=</span> <span>System</span><span>.</span><span>currentTimeMillis</span><span>(</span><span>)</span><span>;</span>\n        <span>//有效时长为5分钟</span>\n        <span>if</span> <span>(</span>currentTimeMillis <span>-</span> timestamp <span>></span> <span>1000</span> <span>*</span> <span>60</span> <span>*</span> <span>5</span><span>)</span> <span>{</span>\n            <span>throw</span> <span>new</span> <span>IllegalArgumentException</span><span>(</span>ERROR_MESSAGE<span>)</span><span>;</span>\n        <span>}</span>\n        <span>return</span> timestamp<span>;</span>\n    <span>}</span>\n\n    <span>private</span> <span>String</span> <span>getRequestId</span><span>(</span><span>HttpHeaders</span> headers<span>)</span> <span>{</span>\n        <span>List</span><span><span>&lt;</span><span>String</span><span>></span></span> list <span>=</span> headers<span>.</span><span>get</span><span>(</span><span>\"requestId\"</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span><span>CollectionUtils</span><span>.</span><span>isEmpty</span><span>(</span>list<span>)</span><span>)</span> <span>{</span>\n            <span>throw</span> <span>new</span> <span>IllegalArgumentException</span><span>(</span>ERROR_MESSAGE<span>)</span><span>;</span>\n        <span>}</span>\n        <span>String</span> requestId <span>=</span> list<span>.</span><span>get</span><span>(</span><span>0</span><span>)</span><span>;</span>\n        <span>//如果requestId存在redis中直接返回</span>\n        <span>String</span> temp <span>=</span> redisTemplate<span>.</span><span>opsForValue</span><span>(</span><span>)</span><span>.</span><span>get</span><span>(</span>requestId<span>)</span><span>;</span>\n        <span>if</span> <span>(</span><span>StringUtils</span><span>.</span><span>isNotBlank</span><span>(</span>temp<span>)</span><span>)</span> <span>{</span>\n            <span>throw</span> <span>new</span> <span>IllegalArgumentException</span><span>(</span>ERROR_MESSAGE<span>)</span><span>;</span>\n        <span>}</span>\n        redisTemplate<span>.</span><span>opsForValue</span><span>(</span><span>)</span><span>.</span><span>set</span><span>(</span>requestId<span>,</span> requestId<span>,</span> <span>5</span><span>,</span> <span>TimeUnit</span><span>.</span>MINUTES<span>)</span><span>;</span>\n        <span>return</span> requestId<span>;</span>\n    <span>}</span>\n\n\n    <span>@Override</span>\n    <span>public</span> <span>int</span> <span>getOrder</span><span>(</span><span>)</span> <span>{</span>\n        <span>return</span> <span>80</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"_4-4-测试登录\" tabindex=\"-1\"> 4.4 测试登录</h3>\n<p><strong>发现验签成功</strong>\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/8e17d38de0eb4144980a740cd16b1d99-16540481454245.png\" alt=\"图片\"></p>\n<h3 id=\"_4-5-测试查询\" tabindex=\"-1\"> 4.5 测试查询</h3>\n<p>验签成功</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/4080582e2887418c8cf53cf3e40ce517.png\" alt=\"图片\"></p>\n<h2 id=\"_5-码云地址\" tabindex=\"-1\"> 5 码云地址</h2>\n<p><a href=\"https://gitee.com/zhurongsheng/springcloud-gateway-rsa\" target=\"_blank\" rel=\"noopener noreferrer\">https://gitee.com/zhurongsheng/springcloud-gateway-rsa</a></p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/1a25b48aa07f4da7adeed28003850f74.png",
      "date_published": "2022-07-13T00:00:00.000Z",
      "date_modified": "2022-07-02T08:57:12.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "CNS服务器搭建教程",
      "url": "https://blog.ciberviler.top/linux/CNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B.html",
      "id": "https://blog.ciberviler.top/linux/CNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B.html",
      "content_html": "<h1 id=\"cns服务器搭建教程\" tabindex=\"-1\"> CNS服务器搭建教程</h1>\n<h2 id=\"首先\" tabindex=\"-1\"> 首先</h2>\n<p>1.首先需要一台服务器，腾讯云或者阿里云，下面用腾讯云来举例。</p>\n<p>2.登陆服务器后台</p>\n<p>3.安装CentOS 7.6 64bit</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/0bc8e91b11654c27b036bf749f71064c.jpeg\" alt=\"img\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/f6e7f8face15443aab91a9ddc3c2db31.jpeg\" alt=\"img\"></p>\n<p>4.远程登陆服务器</p>\n<p>可以直接用腾讯自带的登陆，点击登陆即可。<strong>进去首先输入sudo -i</strong> 获取最高管理员权限。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/9e76c679e87942e48aff3fd934cb3575.jpeg\" alt=\"img\"></p>\n<h2 id=\"方法一-一键安装\" tabindex=\"-1\"> 方法一（一键安装）</h2>\n<p>输入Linux一键安装代码，卸载代码也在下面，出现问题卸载重装。</p>\n<p>作者的GITHUB:<a href=\"https://github.com/mmmdbybyd/CNS\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/mmmdbybyd/CNS</a></p>\n<div><pre><code>安装: <span><span>`</span><span>type</span> <span>curl</span> <span>&amp;></span>/dev/null <span>&amp;&amp;</span> <span>echo</span> <span>'curl -O'</span> <span>||</span> <span>echo</span> <span>'wget -O cns.sh'</span><span>`</span></span> http://binary.quicknet.cyou/cns/cns.sh <span>&amp;&amp;</span> <span>sh</span> cns.sh  \n\n卸载: <span><span>`</span><span>type</span> <span>curl</span> <span>&amp;></span>/dev/null <span>&amp;&amp;</span> <span>echo</span> <span>'curl -O'</span> <span>||</span> <span>echo</span> <span>'wget -O cns.sh'</span><span>`</span></span> http://binary.quicknet.cyou/cns/cns.sh <span>&amp;&amp;</span> <span>sh</span> cns.sh uninstall  \n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>需要填写的是两个信息：需要设置的CNS服务器端口和密码。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/fe4adc68df7445f2b98c11de6fd06d76.jpeg\" alt=\"img\"></p>\n<p>如上图，我设置的是6688端口，密码为980829.</p>\n<p>出现以下信息就代表CNS服务器搭建完成。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/f58fbc517c9d453db6d8dffb5a3e538a.jpeg\" alt=\"img\"></p>\n<p>CNS服务器搭建完成后，需要放行相应的端口才可以运行。例如我使用的是6688端口，则需要对防火墙进行如下设置。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/11bda07f400c4bdfaa11124e01e69e1c.jpeg\" alt=\"img\"></p>\n<h2 id=\"方法二-稍微繁琐一点-但是永久有效\" tabindex=\"-1\"> 方法二（稍微繁琐一点，但是永久有效）</h2>\n<p><a href=\"https://github.com/AiziChen/CNS\" target=\"_blank\" rel=\"noopener noreferrer\">作者Github</a></p>\n<p>在下面的链接里下载下载<code>linux-x86_64.zip</code>，目前最新版本0.2.3</p>\n<p><a href=\"https://github.com/AiziChen/CNS/releases\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/AiziChen/CNS/releases</a></p>\n<p>解压到桌面，会有两个文件。cns文件与config.cfg文件</p>\n<p>下载FinalShell服务器管理软件，百度一搜就有！</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/4f37415688f94330bba68a2bb50b80e6.jpeg\" alt=\"img\"></p>\n<p>如上图，依次点击这三个地方。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2eb86558d2384c6094896e0b663c02a4.png\" alt=\"img\"></p>\n<p>填写蓝色圈起来的四项。密码是服务器密码。点击确定。</p>\n<p>会出现以你设置的用户名命名的一行。双击即可。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/3b231c3c7ac94c6ab7501108ccd675b7.png\" alt=\"img\"></p>\n<p>注意：不要开任何代理软件，否则无法连接。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/64e6e716ac4e4109a0b13885fee80d1b.png\" alt=\"img\"></p>\n<p>提示连接成功，即可。</p>\n<p>在下方的root文件夹中新建一个名为CNS的文件夹。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/14c48e106ed94bb39b270dd6ecd9c087.png\" alt=\"img\"></p>\n<p>双击进入CNS文件夹，并把我们解压到桌面的cns文件以及config.cfg文件拖拽到CNS文件夹内。</p>\n<p>双击config.cfg打开config文件</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2c9e02069a23486189b4d0ac88e2a9a6.png\" alt=\"img\"></p>\n<div><pre><code>proxyKey <span>=</span> Meng <span>#随意，但是强烈建议改一下</span>\nudpFlag <span>=</span> httpUDP\nlistenAddr <span>=</span> <span>:</span><span>6688</span>  <span>#端口，需要在防火墙中放行</span>\npassword <span>=</span> <span>123456</span>   <span>#密码，随意</span>\nudpTimeout <span>=</span> <span>30</span>\ntcpKeepAlive <span>=</span> <span>60</span>\npidPath <span>=</span> cns.pid\nenableDnsTcpOverUdp <span>=</span> <span>#t</span>\nenableHttpDNS <span>=</span> <span>#t</span>\nenableTFO <span>=</span> <span>#t</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>对端口和密码进行修改，按下CTRL+S保存后退出。</p>\n<p>在FinalShell中输入cd /root/CNS，进入CNS文件夹，注意大小写。</p>\n<p>给cns文件添加x权限chmod u+x cns</p>\n<p>在输入后台启动cns文件的命令./cns -daemon</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/af4a6ed25d2c4e088f7b35e5d38cfd24.png\" alt=\"img\"></p>\n<p>代码如下，自行复制粘贴。FinalShell中复制为ALT+C,粘贴为ALT+V。</p>\n<div><pre><code><span>cd</span> /root/CNS\n\n<span>chmod</span> u+x cns\n\n./cns -daemon\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>每次重启服务器都要重新运行一次./cns -daemon</p>\n<p>这样cns服务器就搭建完成了。</p>\n<p><strong>手机端配置</strong></p>\n<p>使用龙哥模块的，首先打开ZJL文件，<a href=\"http://xn--715IPtime1-2x2ph47f7fat17dw6z2vm7o8d94vd.cloud.tencent.com\" target=\"_blank\" rel=\"noopener noreferrer\">将715行的IP地址更换为time1.cloud.tencent.com</a>,保存。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/5fa1a096915b40aa96cb84294a9d608b.jpeg\" alt=\"img\"></p>\n<p>打开.conf文件，进行如下修改，服务器IP：端口都按照上面的设置来填写。建议使用最新版的龙哥模块。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/cd9ac3980991433bb140164d4acbfab4.jpeg\" alt=\"img\"></p>\n<p>保存以后，运行一次开启.sh即可。出现如下情况，即是配置成功。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/247457a355504576bd7a3e17dadce2a1.jpeg\" alt=\"img\"></p>\n<p><strong>注意：如果出现UDP连接×，请检查以下两点：</strong></p>\n<p><strong>1.服务器防火墙是否放行CNS服务器端口。</strong></p>\n<p><strong>2.ZJL文件的IP是否修改。</strong></p>\n<p><strong>出现问题，请评论，看到即回。</strong></p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/0bc8e91b11654c27b036bf749f71064c.jpeg",
      "date_published": "2022-07-12T00:00:00.000Z",
      "date_modified": "2022-07-02T08:57:02.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Linux"
      ]
    },
    {
      "title": "Optional非空判断",
      "url": "https://blog.ciberviler.top/dev/Optional%E9%9D%9E%E7%A9%BA%E5%88%A4%E6%96%AD.html",
      "id": "https://blog.ciberviler.top/dev/Optional%E9%9D%9E%E7%A9%BA%E5%88%A4%E6%96%AD.html",
      "content_html": "<h1 id=\"optional非空判断\" tabindex=\"-1\"> Optional非空判断</h1>\n<h2 id=\"_1-前言\" tabindex=\"-1\"> 1.前言</h2>\n<p>相信不少小伙伴已经被java的NPE(Null Pointer Exception)所谓的空指针异常搞的头昏脑涨, 有大佬说过“防止 NPE，是程序员的基本修养。”但是修养归修养，也是我们程序员最头疼的问题之一，那么我们今天就要尽可能的利用Java8的新特性 Optional来尽量简化代码同时高效处理NPE（Null Pointer Exception 空指针异常）</p>\n<h3 id=\"_2-认识optional并使用\" tabindex=\"-1\"> 2.认识Optional并使用</h3>\n<p>简单来说，Opitonal类就是Java提供的为了解决大家平时判断对象是否为空用 会用 null!=obj 这样的方式存在的判断，从而令人头疼导致NPE（Null Pointer Exception 空指针异常），同时Optional的存在可以让代码更加简单，可读性跟高，代码写起来更高效.</p>\n<div><pre><code>   常规判断：\n        <span>//对象 人</span>\n        <span>//属性有 name，age</span>\n        <span>Person</span> person<span>=</span><span>new</span> <span>Person</span><span>(</span><span>)</span><span>;</span>\n       <span>if</span> <span>(</span><span>null</span><span>==</span>person<span>)</span><span>{</span>\n            <span>return</span> <span>\"person为null\"</span><span>;</span>\n        <span>}</span>\n        <span>return</span> person<span>;</span>\n   使用<span>Optional</span>：\n        <span>//对象 人</span>\n        <span>//属性有 name，age</span>\n        <span>Person</span> person<span>=</span><span>new</span> <span>Person</span><span>(</span><span>)</span><span>;</span>\n        <span>return</span> <span>Optional</span><span>.</span><span>ofNullable</span><span>(</span>person<span>)</span><span>.</span><span>orElse</span><span>(</span><span>\"person为null\"</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>测试展示类Person代码(如果有朋友不明白可以看一下这个)：</p>\n<div><pre><code><span>public</span> <span>class</span> <span>Person</span> <span>{</span>\n    <span>private</span> <span>String</span> name<span>;</span>\n    <span>private</span> <span>Integer</span> age<span>;</span>\n\n    <span>public</span> <span>Person</span><span>(</span><span>String</span> name<span>,</span> <span>Integer</span> age<span>)</span> <span>{</span>\n        <span>this</span><span>.</span>name <span>=</span> name<span>;</span>\n        <span>this</span><span>.</span>age <span>=</span> age<span>;</span>\n    <span>}</span>\n\n    <span>public</span> <span>Person</span><span>(</span><span>)</span> <span>{</span>\n    <span>}</span>\n\n    <span>public</span> <span>String</span> <span>getName</span><span>(</span><span>)</span> <span>{</span>\n        <span>return</span> name<span>;</span>\n    <span>}</span>\n\n    <span>public</span> <span>void</span> <span>setName</span><span>(</span><span>String</span> name<span>)</span> <span>{</span>\n        <span>this</span><span>.</span>name <span>=</span> name<span>;</span>\n    <span>}</span>\n\n    <span>public</span> <span>Integer</span> <span>getAge</span><span>(</span><span>)</span> <span>{</span>\n        <span>return</span> age<span>;</span>\n    <span>}</span>\n\n    <span>public</span> <span>void</span> <span>setAge</span><span>(</span><span>Integer</span> age<span>)</span> <span>{</span>\n        <span>this</span><span>.</span>age <span>=</span> age<span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>下面，我们就高效的学习一下神奇的Optional类！</p>\n<h4 id=\"_2-1-optional对象创建\" tabindex=\"-1\"> 2.1 Optional对象创建</h4>\n<p>首先我们先打开Optional的内部,去一探究竟 <strong>先把几个创建Optional对象的方法提取出来</strong></p>\n<div><pre><code><span>public</span> <span>final</span> <span>class</span> <span>Optional</span><span><span>&lt;</span><span>T</span><span>></span></span> <span>{</span>\n   <span>private</span> <span>static</span> <span>final</span> <span>Optional</span><span><span>&lt;</span><span>?</span><span>></span></span> EMPTY <span>=</span> <span>new</span> <span>Optional</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n   <span>private</span> <span>final</span> <span>T</span> value<span>;</span>\n   <span>//我们可以看到两个构造方格都是private 私有的</span>\n   <span>//说明 我们没办法在外面去new出来Optional对象</span>\n   <span>private</span> <span>Optional</span><span>(</span><span>)</span> <span>{</span>\n        <span>this</span><span>.</span>value <span>=</span> <span>null</span><span>;</span>\n    <span>}</span>\n   <span>private</span> <span>Optional</span><span>(</span><span>T</span> value<span>)</span> <span>{</span>\n        <span>this</span><span>.</span>value <span>=</span> <span>Objects</span><span>.</span><span>requireNonNull</span><span>(</span>value<span>)</span><span>;</span>\n    <span>}</span>\n    <span>//这个静态方法大致 是创建出一个包装值为空的一个对象因为没有任何参数赋值</span>\n   <span>public</span> <span>static</span><span><span>&lt;</span><span>T</span><span>></span></span> <span>Optional</span><span><span>&lt;</span><span>T</span><span>></span></span> <span>empty</span><span>(</span><span>)</span> <span>{</span>\n        <span>@SuppressWarnings</span><span>(</span><span>\"unchecked\"</span><span>)</span>\n        <span>Optional</span><span><span>&lt;</span><span>T</span><span>></span></span> t <span>=</span> <span>(</span><span>Optional</span><span><span>&lt;</span><span>T</span><span>></span></span><span>)</span> EMPTY<span>;</span>\n        <span>return</span> t<span>;</span>\n    <span>}</span>\n    <span>//这个静态方法大致 是创建出一个包装值非空的一个对象 因为做了赋值</span>\n   <span>public</span> <span>static</span> <span><span>&lt;</span><span>T</span><span>></span></span> <span>Optional</span><span><span>&lt;</span><span>T</span><span>></span></span> <span>of</span><span>(</span><span>T</span> value<span>)</span> <span>{</span>\n        <span>return</span> <span>new</span> <span>Optional</span><span><span>&lt;</span><span>></span></span><span>(</span>value<span>)</span><span>;</span>\n    <span>}</span>\n    <span>//这个静态方法大致是 如果参数value为空，则创建空对象，如果不为空，则创建有参对象</span>\n   <span>public</span> <span>static</span> <span><span>&lt;</span><span>T</span><span>></span></span> <span>Optional</span><span><span>&lt;</span><span>T</span><span>></span></span> <span>ofNullable</span><span>(</span><span>T</span> value<span>)</span> <span>{</span>\n        <span>return</span> value <span>==</span> <span>null</span> <span>?</span> <span>empty</span><span>(</span><span>)</span> <span>:</span> <span>of</span><span>(</span>value<span>)</span><span>;</span>\n    <span>}</span>\n <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>再做一个简单的实例展示 与上面对应</p>\n<div><pre><code>        <span>// 1、创建一个包装对象值为空的Optional对象</span>\n        <span>Optional</span><span><span>&lt;</span><span>String</span><span>></span></span> optEmpty <span>=</span> <span>Optional</span><span>.</span><span>empty</span><span>(</span><span>)</span><span>;</span>\n        <span>// 2、创建包装对象值非空的Optional对象</span>\n        <span>Optional</span><span><span>&lt;</span><span>String</span><span>></span></span> optOf <span>=</span> <span>Optional</span><span>.</span><span>of</span><span>(</span><span>\"optional\"</span><span>)</span><span>;</span>\n        <span>// 3、创建包装对象值允许为空也可以不为空的Optional对象</span>\n        <span>Optional</span><span><span>&lt;</span><span>String</span><span>></span></span> optOfNullable1 <span>=</span> <span>Optional</span><span>.</span><span>ofNullable</span><span>(</span><span>null</span><span>)</span><span>;</span>\n        <span>Optional</span><span><span>&lt;</span><span>String</span><span>></span></span> optOfNullable2 <span>=</span> <span>Optional</span><span>.</span><span>ofNullable</span><span>(</span><span>\"optional\"</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>我们关于创建Optional对象的内部方法大致分析完毕 接下来也正式的进入Optional的学习与使用中</p>\n<h4 id=\"_2-2-optional-get-方法-返回对象的值\" tabindex=\"-1\"> 2.2 Optional.get()方法(返回对象的值)</h4>\n<p><strong>get()方法是返回一个option的实例值</strong> 源码：</p>\n<div><pre><code>    <span>public</span> <span>T</span> <span>get</span><span>(</span><span>)</span> <span>{</span>\n        <span>if</span> <span>(</span>value <span>==</span> <span>null</span><span>)</span> <span>{</span>\n            <span>throw</span> <span>new</span> <span>NoSuchElementException</span><span>(</span><span>\"No value present\"</span><span>)</span><span>;</span>\n        <span>}</span>\n        <span>return</span> value<span>;</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>也就是如果value不为空则做返回，如果为空则抛出异常 &quot;No value present&quot;</strong> 简单实例展示</p>\n<div><pre><code>        <span>Person</span> person<span>=</span><span>new</span> <span>Person</span><span>(</span><span>)</span><span>;</span>\n        person<span>.</span><span>setAge</span><span>(</span><span>2</span><span>)</span><span>;</span>\n        <span>Optional</span><span>.</span><span>ofNullable</span><span>(</span>person<span>)</span><span>.</span><span>get</span><span>(</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h4 id=\"_2-3-optional-ispresent-方法-判读是否为空\" tabindex=\"-1\"> 2.3 Optional.isPresent()方法(判读是否为空)</h4>\n<p><strong>isPresent()方法就是会返回一个boolean类型值，如果对象不为空则为真，如果为空则false</strong> 源码:</p>\n<div><pre><code> <span>public</span> <span>boolean</span> <span>isPresent</span><span>(</span><span>)</span> <span>{</span>\n        <span>return</span> value <span>!=</span> <span>null</span><span>;</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>简单的实例展示:</p>\n<div><pre><code>        <span>Person</span> person<span>=</span><span>new</span> <span>Person</span><span>(</span><span>)</span><span>;</span>\n        person<span>.</span><span>setAge</span><span>(</span><span>2</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span><span>Optional</span><span>.</span><span>ofNullable</span><span>(</span>person<span>)</span><span>.</span><span>isPresent</span><span>(</span><span>)</span><span>)</span><span>{</span>\n        <span>//写不为空的逻辑</span>\n        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"不为空\"</span><span>)</span><span>;</span>\n        <span>}</span><span>else</span><span>{</span>\n         <span>//写为空的逻辑</span>\n         <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"为空\"</span><span>)</span><span>;</span>\n        <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_2-4-optional-ifpresent-方法-判读是否为空并返回函数\" tabindex=\"-1\"> 2.4 Optional.ifPresent()方法(判读是否为空并返回函数)</h4>\n<p><strong>这个意思是如果对象非空，则运行函数体</strong> 源码:</p>\n<div><pre><code>  <span>public</span> <span>void</span> <span>ifPresent</span><span>(</span><span>Consumer</span><span><span>&lt;</span><span>?</span> <span>super</span> <span>T</span><span>></span></span> consumer<span>)</span> <span>{</span>\n        <span>//如果value不为空，则运行accept方法体</span>\n        <span>if</span> <span>(</span>value <span>!=</span> <span>null</span><span>)</span>\n            consumer<span>.</span><span>accept</span><span>(</span>value<span>)</span><span>;</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>看实例：</p>\n<div><pre><code>        <span>Person</span> person<span>=</span><span>new</span> <span>Person</span><span>(</span><span>)</span><span>;</span>\n        person<span>.</span><span>setAge</span><span>(</span><span>2</span><span>)</span><span>;</span>\n        <span>Optional</span><span>.</span><span>ofNullable</span><span>(</span>person<span>)</span><span>.</span><span>ifPresent</span><span>(</span>p <span>-></span> <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"年龄\"</span><span>+</span>p<span>.</span><span>getAge</span><span>(</span><span>)</span><span>)</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p><strong>如果对象不为空，则会打印这个年龄</strong>，因为内部已经做了NPE（非空判断），所以就不用担心空指针异常了</p>\n<h4 id=\"_2-5-optional-filter-方法-过滤对象\" tabindex=\"-1\"> 2.5 Optional.filter()方法(过滤对象)</h4>\n<p><strong>filter()方法大致意思是，接受一个对象，然后对他进行条件过滤，如果条件符合则返回Optional对象本身，如果不符合则返回空Optional</strong> 源码：</p>\n<div><pre><code>    <span>public</span> <span>Optional</span><span><span>&lt;</span><span>T</span><span>></span></span> <span>filter</span><span>(</span><span>Predicate</span><span><span>&lt;</span><span>?</span> <span>super</span> <span>T</span><span>></span></span> predicate<span>)</span> <span>{</span>\n        <span>Objects</span><span>.</span><span>requireNonNull</span><span>(</span>predicate<span>)</span><span>;</span>\n        <span>//如果为空直接返回this</span>\n        <span>if</span> <span>(</span><span>!</span><span>isPresent</span><span>(</span><span>)</span><span>)</span>\n            <span>return</span> <span>this</span><span>;</span>\n        <span>else</span>\n        <span>//判断返回本身还是空Optional</span>\n            <span>return</span> predicate<span>.</span><span>test</span><span>(</span>value<span>)</span> <span>?</span> <span>this</span> <span>:</span> <span>empty</span><span>(</span><span>)</span><span>;</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>简单实例：</p>\n<div><pre><code>        <span>Person</span> person<span>=</span><span>new</span> <span>Person</span><span>(</span><span>)</span><span>;</span>\n        person<span>.</span><span>setAge</span><span>(</span><span>2</span><span>)</span><span>;</span>\n        <span>Optional</span><span>.</span><span>ofNullable</span><span>(</span>person<span>)</span><span>.</span><span>filter</span><span>(</span>p <span>-></span> p<span>.</span><span>getAge</span><span>(</span><span>)</span><span>></span><span>50</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h4 id=\"_2-6-optional-map-方法-对象进行二次包装\" tabindex=\"-1\"> 2.6 Optional.map()方法(对象进行二次包装)</h4>\n<p><strong>map()方法将对应Funcation函数式接口中的对象，进行二次运算，封装成新的对象然后返回在Optional中</strong> 源码：</p>\n<div><pre><code> <span>public</span><span><span>&lt;</span><span>U</span><span>></span></span> <span>Optional</span><span><span>&lt;</span><span>U</span><span>></span></span> <span>map</span><span>(</span><span>Function</span><span><span>&lt;</span><span>?</span> <span>super</span> <span>T</span><span>,</span> <span>?</span> <span>extends</span> <span>U</span><span>></span></span> mapper<span>)</span> <span>{</span>\n        <span>Objects</span><span>.</span><span>requireNonNull</span><span>(</span>mapper<span>)</span><span>;</span>\n        <span>//如果为空返回自己</span>\n        <span>if</span> <span>(</span><span>!</span><span>isPresent</span><span>(</span><span>)</span><span>)</span>\n            <span>return</span> <span>empty</span><span>(</span><span>)</span><span>;</span>\n        <span>else</span> <span>{</span>\n        <span>//否则返回用方法修饰过的Optional</span>\n            <span>return</span> <span>Optional</span><span>.</span><span>ofNullable</span><span>(</span>mapper<span>.</span><span>apply</span><span>(</span>value<span>)</span><span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>实例展示：</p>\n<div><pre><code>        <span>Person</span> person1<span>=</span><span>new</span> <span>Person</span><span>(</span><span>)</span><span>;</span>\n        person<span>.</span><span>setAge</span><span>(</span><span>2</span><span>)</span><span>;</span>\n        <span>String</span> optName <span>=</span> <span>Optional</span><span>.</span><span>ofNullable</span><span>(</span>person<span>)</span><span>.</span><span>map</span><span>(</span>p <span>-></span> person<span>.</span><span>getName</span><span>(</span><span>)</span><span>)</span><span>.</span><span>orElse</span><span>(</span><span>\"name为空\"</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h4 id=\"_2-7-optional-flatmap-方法-optional对象进行二次包装\" tabindex=\"-1\"> 2.7 Optional.flatMap()方法(Optional对象进行二次包装)</h4>\n<p><strong>map()方法将对应Optional&lt; Funcation &gt;函数式接口中的对象，进行二次运算，封装成新的对象然后返回在Optional中</strong> 源码:</p>\n<div><pre><code>    <span>public</span><span><span>&lt;</span><span>U</span><span>></span></span> <span>Optional</span><span><span>&lt;</span><span>U</span><span>></span></span> <span>flatMap</span><span>(</span><span>Function</span><span><span>&lt;</span><span>?</span> <span>super</span> <span>T</span><span>,</span> <span>Optional</span><span>&lt;</span><span>U</span><span>></span><span>></span></span> mapper<span>)</span> <span>{</span>\n        <span>Objects</span><span>.</span><span>requireNonNull</span><span>(</span>mapper<span>)</span><span>;</span>\n        <span>if</span> <span>(</span><span>!</span><span>isPresent</span><span>(</span><span>)</span><span>)</span>\n            <span>return</span> <span>empty</span><span>(</span><span>)</span><span>;</span>\n        <span>else</span> <span>{</span>\n            <span>return</span> <span>Objects</span><span>.</span><span>requireNonNull</span><span>(</span>mapper<span>.</span><span>apply</span><span>(</span>value<span>)</span><span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>实例：</p>\n<div><pre><code>        <span>Person</span> person<span>=</span><span>new</span> <span>Person</span><span>(</span><span>)</span><span>;</span>\n        person<span>.</span><span>setAge</span><span>(</span><span>2</span><span>)</span><span>;</span>\n        <span>Optional</span><span><span>&lt;</span><span>Object</span><span>></span></span> optName <span>=</span> <span>Optional</span><span>.</span><span>ofNullable</span><span>(</span>person<span>)</span><span>.</span><span>map</span><span>(</span>p <span>-></span> <span>Optional</span><span>.</span><span>ofNullable</span><span>(</span>p<span>.</span><span>getName</span><span>(</span><span>)</span><span>)</span><span>.</span><span>orElse</span><span>(</span><span>\"name为空\"</span><span>)</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h4 id=\"_2-8-optional-orelse-方法-为空返回对象\" tabindex=\"-1\"> 2.8 Optional.orElse()方法(为空返回对象)</h4>\n<p><strong>常用方法之一，这个方法意思是如果包装对象为空的话，就执行orElse方法里的value，如果非空，则返回写入对象</strong> 源码:</p>\n<div><pre><code>    <span>public</span> <span>T</span> <span>orElse</span><span>(</span><span>T</span> other<span>)</span> <span>{</span>\n    <span>//如果非空，返回value，如果为空，返回other</span>\n        <span>return</span> value <span>!=</span> <span>null</span> <span>?</span> value <span>:</span> other<span>;</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>实例：</p>\n<div><pre><code>        <span>Person</span> person1<span>=</span><span>new</span> <span>Person</span><span>(</span><span>)</span><span>;</span>\n        person<span>.</span><span>setAge</span><span>(</span><span>2</span><span>)</span><span>;</span>\n        <span>Optional</span><span>.</span><span>ofNullable</span><span>(</span>person<span>)</span><span>.</span><span>orElse</span><span>(</span><span>new</span> <span>Person</span><span>(</span><span>\"小明\"</span><span>,</span> <span>2</span><span>)</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h4 id=\"_2-9-optional-orelseget-方法-为空返回supplier对象\" tabindex=\"-1\"> 2.9 Optional.orElseGet()方法(为空返回Supplier对象)</h4>\n<p><strong>这个与orElse很相似，入参不一样，入参为Supplier对象，为空返回传入对象的.get()方法，如果非空则返回当前对象</strong> 源码:</p>\n<div><pre><code>    <span>public</span> <span>T</span> <span>orElseGet</span><span>(</span><span>Supplier</span><span><span>&lt;</span><span>?</span> <span>extends</span> <span>T</span><span>></span></span> other<span>)</span> <span>{</span>\n        <span>return</span> value <span>!=</span> <span>null</span> <span>?</span> value <span>:</span> other<span>.</span><span>get</span><span>(</span><span>)</span><span>;</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>实例：</p>\n<div><pre><code>         <span>Optional</span><span><span>&lt;</span><span>Supplier</span><span>&lt;</span><span>Person</span><span>></span><span>></span></span> sup<span>=</span><span>Optional</span><span>.</span><span>ofNullable</span><span>(</span><span>Person</span><span>::</span><span>new</span><span>)</span><span>;</span>\n        <span>//调用get()方法，此时才会调用对象的构造方法，即获得到真正对象</span>\n         <span>Optional</span><span>.</span><span>ofNullable</span><span>(</span>person<span>)</span><span>.</span><span>orElseGet</span><span>(</span>sup<span>.</span><span>get</span><span>(</span><span>)</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p><strong>说真的对于Supplier对象我也懵逼了一下，去网上简单查阅才得知 Supplier也是创建对象的一种方式,简单来说，Suppiler是一个接口，是类似Spring的懒加载，声明之后并不会占用内存，只有执行了get()方法之后，才会调用构造方法创建出对象 创建对象的语法的话就是<code>Supplier&lt;Person&gt; supPerson= Person::new;</code></strong> 需要使用时<code>supPerson.get()</code>即可</p>\n<h4 id=\"_2-10-optional-orelsethrow-方法-为空返回异常\" tabindex=\"-1\"> 2.10 Optional.orElseThrow()方法(为空返回异常)</h4>\n<p><strong>这个我个人在实战中也经常用到这个方法，方法作用的话就是如果为空，就抛出你定义的异常，如果不为空返回当前对象，在实战中所有异常肯定是要处理好的，为了代码的可读性</strong> 源码：</p>\n<div><pre><code>    <span>public</span> <span><span>&lt;</span><span>X</span> <span>extends</span> <span>Throwable</span><span>></span></span> <span>T</span> <span>orElseThrow</span><span>(</span><span>Supplier</span><span><span>&lt;</span><span>?</span> <span>extends</span> <span>X</span><span>></span></span> exceptionSupplier<span>)</span> <span>throws</span> <span>X</span> <span>{</span>\n        <span>if</span> <span>(</span>value <span>!=</span> <span>null</span><span>)</span> <span>{</span>\n            <span>return</span> value<span>;</span>\n        <span>}</span> <span>else</span> <span>{</span>\n            <span>throw</span> exceptionSupplier<span>.</span><span>get</span><span>(</span><span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>实例： 这个就贴实战源码了</p>\n<div><pre><code><span>//简单的一个查询</span>\n        <span>Member</span> member <span>=</span> memberService<span>.</span><span>selectByPhone</span><span>(</span>request<span>.</span><span>getPhone</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>Optional</span><span>.</span><span>ofNullable</span><span>(</span>member<span>)</span><span>.</span><span>orElseThrow</span><span>(</span><span>(</span><span>)</span> <span>-></span> <span>new</span> <span>ServiceException</span><span>(</span><span>\"没有查询的相关数据\"</span><span>)</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h4 id=\"_2-11-相似方法进行对比分析\" tabindex=\"-1\"> 2.11 相似方法进行对比分析</h4>\n<p>可能小伙伴看到这，没用用过的话会觉得orElse()和orElseGet()还有orElseThrow()很相似，map()和flatMap()好相似 哈哈哈不用着急，都是从这一步过来的，我再给大家总结一下不同方法的异同点 <strong>orElse()和orElseGet()和orElseThrow()的异同点</strong></p>\n<blockquote>\n<p>方法效果类似，如果对象不为空，则返回对象，如果为空，则返回方法体中的对应参数，所以可以看出这三个方法体中参数是不一样的 orElse（T 对象） orElseGet（Supplier &lt; T &gt;对象） orElseThrow（异常）</p>\n</blockquote>\n<p><strong>map()和orElseGet的异同点</strong></p>\n<blockquote>\n<p>方法效果类似，对方法参数进行二次包装，并返回,入参不同 map（function函数） flatmap（Optional&lt; function &gt;函数）</p>\n</blockquote>\n<p>具体要怎么用，要根据业务场景以及代码规范来定义，下面可以简单看一下我在实战中怎用使用神奇的Optional</p>\n<h2 id=\"_3-实战场景再现\" tabindex=\"-1\"> 3.实战场景再现</h2>\n<p>场景1： 在service层中 查询一个对象，返回之后判断是否为空并做处理</p>\n<div><pre><code>        <span>//查询一个对象</span>\n        <span>Member</span> member <span>=</span> memberService<span>.</span><span>selectByIdNo</span><span>(</span>request<span>.</span><span>getCertificateNo</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>//使用ofNullable加orElseThrow做判断和操作</span>\n        <span>Optional</span><span>.</span><span>ofNullable</span><span>(</span>member<span>)</span><span>.</span><span>orElseThrow</span><span>(</span><span>(</span><span>)</span> <span>-></span> <span>new</span> <span>ServiceException</span><span>(</span><span>\"没有查询的相关数据\"</span><span>)</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>场景2： 我们可以在dao接口层中定义返回值时就加上Optional 例如： 我使用的是jpa，其他也同理</p>\n<div><pre><code><span>public</span> <span>interface</span> <span>LocationRepository</span> <span>extends</span> <span>JpaRepository</span><span><span>&lt;</span><span>Location</span><span>,</span> <span>String</span><span>></span></span> <span>{</span>\n<span>Optional</span><span><span>&lt;</span><span>Location</span><span>></span></span> <span>findLocationById</span><span>(</span><span>String</span> id<span>)</span><span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>然在是Service中</p>\n<div><pre><code><span>public</span> <span>TerminalVO</span> <span>findById</span><span>(</span><span>String</span> id<span>)</span> <span>{</span>\n<span>//这个方法在dao层也是用了Optional包装了</span>\n        <span>Optional</span><span><span>&lt;</span><span>Terminal</span><span>></span></span> terminalOptional <span>=</span> terminalRepository<span>.</span><span>findById</span><span>(</span>id<span>)</span><span>;</span>\n        <span>//直接使用isPresent()判断是否为空</span>\n        <span>if</span> <span>(</span>terminalOptional<span>.</span><span>isPresent</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n        <span>//使用get()方法获取对象值</span>\n            <span>Terminal</span> terminal <span>=</span> terminalOptional<span>.</span><span>get</span><span>(</span><span>)</span><span>;</span>\n            <span>//在实战中，我们已经免去了用set去赋值的繁琐，直接用BeanCopy去赋值</span>\n            <span>TerminalVO</span> terminalVO <span>=</span> <span>BeanCopyUtils</span><span>.</span><span>copyBean</span><span>(</span>terminal<span>,</span> <span>TerminalVO</span><span>.</span><span>class</span><span>)</span><span>;</span>\n            <span>//调用dao层方法返回包装后的对象</span>\n            <span>Optional</span><span><span>&lt;</span><span>Location</span><span>></span></span> location <span>=</span> locationRepository<span>.</span><span>findLocationById</span><span>(</span>terminal<span>.</span><span>getLocationId</span><span>(</span><span>)</span><span>)</span><span>;</span>\n            <span>if</span> <span>(</span>location<span>.</span><span>isPresent</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n                terminalVO<span>.</span><span>setFullName</span><span>(</span>location<span>.</span><span>get</span><span>(</span><span>)</span><span>.</span><span>getFullName</span><span>(</span><span>)</span><span>)</span><span>;</span>\n            <span>}</span>\n            <span>return</span> terminalVO<span>;</span>\n        <span>}</span>\n        <span>//不要忘记抛出异常</span>\n        <span>throw</span> <span>new</span> <span>ServiceException</span><span>(</span><span>\"该终端不存在\"</span><span>)</span><span>;</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>实战场景还有很多，包括return时可以判断是否返回当前值还是跳转到另一个方法体中，什么的还有很多，如果大家没有经验的小伙伴还想进行学习，可以评论一下我会回复大家</strong></p>\n<h2 id=\"_4-optional使用注意事项\" tabindex=\"-1\"> 4.Optional使用注意事项</h2>\n<p><strong>Optional真么好用，真的可以完全替代if判断吗？</strong> 我想这肯定是大家使用完之后Optional之后可能会产生的想法，<strong>答案是否定的</strong> 举一个最简单的栗子： 例子1： 如果我只想判断对象的某一个变量是否为空并且做出判断呢？</p>\n<div><pre><code><span>Person</span> person<span>=</span><span>new</span> <span>Person</span><span>(</span><span>)</span><span>;</span>\nperson<span>.</span><span>setName</span><span>(</span><span>\"\"</span><span>)</span><span>;</span>\npersion<span>.</span><span>setAge</span><span>(</span><span>2</span><span>)</span><span>;</span>\n<span>//普通判断</span>\n<span>if</span><span>(</span><span>StringUtils</span><span>.</span><span>isNotBlank</span><span>(</span>person<span>.</span><span>getName</span><span>(</span><span>)</span><span>)</span><span>)</span><span>{</span>\n  <span>//名称不为空执行代码块</span>\n<span>}</span>\n<span>//使用Optional做判断</span>\n<span>Optional</span><span>.</span><span>ofNullable</span><span>(</span>person<span>)</span><span>.</span><span>map</span><span>(</span>p <span>-></span> p<span>.</span><span>getName</span><span>(</span><span>)</span><span>)</span><span>.</span><span>orElse</span><span>(</span><span>\"name为空\"</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>我觉得这个例子就能很好的说明这个问题，<strong>只是一个很简单判断，如果用了Optional我们还需要考虑包装值，考虑代码书写，考虑方法调用，虽然只有一行，但是可读性并不好，如果别的程序员去读，我觉得肯定没有if看的明显</strong></p>\n<h2 id=\"_5-jdk1-9对optional优化\" tabindex=\"-1\"> 5.jdk1.9对Optional优化</h2>\n<p>首先增加了三个方法: <strong>or()、ifPresentOrElse() 和 stream()。</strong> <strong>or()</strong> 与orElse等方法相似，如果对象不为空返回对象，如果为空则返回or()方法中预设的值。 <strong>ifPresentOrElse()</strong> 方法有两个参数：一个 Consumer 和一个 Runnable。如果对象不为空，会执行 Consumer 的动作，否则运行 Runnable。相比ifPresent（）多了OrElse判断。 **stream()**将Optional转换成stream，如果有值就返回包含值的stream，如果没值，就返回空的stream。</p>\n<p>因为这个jdk1.9的Optional具体我没有测试，同时也发现有蛮好的文章已经也能让大家明白jdk1.9的option的优化,我就不深入去说了。</p>\n",
      "date_published": "2022-07-11T00:00:00.000Z",
      "date_modified": "2022-07-01T08:48:36.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "服务器运行数据查看工具",
      "url": "https://blog.ciberviler.top/linux/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E8%A1%8C%E6%95%B0%E6%8D%AE%E6%9F%A5%E7%9C%8B%E5%B7%A5%E5%85%B7.html",
      "id": "https://blog.ciberviler.top/linux/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E8%A1%8C%E6%95%B0%E6%8D%AE%E6%9F%A5%E7%9C%8B%E5%B7%A5%E5%85%B7.html",
      "content_html": "<h1 id=\"服务器运行数据查看工具\" tabindex=\"-1\"> 服务器运行数据查看工具</h1>\n<p>我们开发的软件服务需要在服务器上运行，所以服务器性能代表了软件的性能上限，因此服务器性能调优是个十分重要的环节，然而大部分同学对服务器性能调优关注的较少，今天从3个部分对服务器性能调优进行介绍，分别是：服务器配置选择，服务器负载分析，服务器内核参数调优。</p>\n<h2 id=\"服务器配置选择\" tabindex=\"-1\"> <strong>服务器配置选择</strong></h2>\n<p>服务器一般是由CPU、内存、磁盘和网卡组成，因此选择服务器配置就是选择CPU核数、内存大小、磁盘大小及类型、网络带宽。但是，服务器配置的选择是很难标准化的，也就是说很难推断出“一台需要达到1000TPS的后端服务器”的配置应该是什么样的。因为软件的最终运行性能与软件的实现方式是紧密相关的，即使是同一个后端应用程序中的两个接口，由于具体功能的差别，性能也会有所差别。</p>\n<p>因此，服务器配置的选择应该基于具体的测试结果。一开始可以选用配置较低的服务器做调优和测试，并以该服务器的测试结果作为选择服务器的依据。</p>\n<p>以一个订单业务为例，经过测试后，一台配置为4核 CPU 、16GB内存、10Mbps带宽、50GB机械磁盘的服务器的测试结果为：支持50并发量和300TPS吞吐量（增大并发量后会出现超时报错）。而在压力测试过程中， CPU 的使用率接近75%，内存使用率在 50％以下，带宽使用率在50％以下，除去日志以外无磁盘操作。</p>\n<p>因此可以认为，一台配置为4核 CPU ( CPU 使用率需要在75％以下）、8GB内存（内存使用率可以接近100%)、 5Mbps 带宽（带宽使用率可以接近100%）的服务器，可以满足订单接口支持50并发量、300TPS吞吐量的压力。</p>\n<p>如果需要达到200并发数、2400TPS吞吐量的目标的话，则需要8台配置为4核 CPU 、8GB内存、5Mbps带宽的服务器，或者1台配置为32核 CPU 、64GB内存、40Mbps带宽的服务器。当然，最终的服务器配置还是需要通过测试来验证。</p>\n<blockquote>\n<p>注意：在以上订单接口的例子中，后端服务器和数据库等服务器需要一起调试，避免后端服务器性能过剩，而数据库等服务器性能不足的情况发生。另外，以上选择服务器配置的方法不一定适用于所有场景，请斟酌参考。</p>\n</blockquote>\n<h2 id=\"服务器负载分析\" tabindex=\"-1\"> <strong>服务器负载分析</strong></h2>\n<p>在性能调优时，需要先对服务器负载进行分析，通常而言，我们主要分析CPU使用率、内存使用率、磁盘I/O，服务器负载和带宽使用情况。</p>\n<h3 id=\"cpu使用率\" tabindex=\"-1\"> CPU使用率</h3>\n<p>CPU使用率反应的是CPU的忙碌情况。当CPU达到100%时，部分进程会进入等待状态，CPU暂时不会对其进行处理。<strong>在实际情况下，为了应对一下突发性的请求压力，服务器CPU使用率一般需要在75%以下。如果一台服务器的CPU使用率多次高于75%，这时候就考虑增加新的服务器。</strong></p>\n<p>监控CPU使用率我推荐大家使用<strong>htop</strong>工具，可以非常直观看到CPU使用率、内存使用率、及负载等信息。</p>\n<h4 id=\"使用htop查看cpu负载\" tabindex=\"-1\"> 使用htop查看CPU负载</h4>\n<p>首先我们需要安装htop，以centos为例，安装命令如下：</p>\n<div><pre><code>yum <span>install</span> <span>htop</span> -y\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>安装完成后我们就可以通过<code>htop</code>命令观察CPU负载了</p>\n<div><pre><code><span>htop</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>输入<code>htop</code>命令后我们可以很直观的看到CPU负载情况，该命令的CPU使用率会以多个核作为单位进行显示。操作系统机会自动分配多个核的负载，当所有核的CPU使用率都超过75%时才能认为服务器的CPU使用率已经超过75%。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16566648003660.png\" alt=\"服务器运行数据查看工具\">cpu负载</p>\n<p>如上图所示，这是一个4核CPU服务器，在截图的时候其中3核CPU使用率都超过了75%，再观察一会发现所有CPU的使用率都在85%左右徘徊，说明CPU负载很高了，需要考虑增加新的服务器。</p>\n<h3 id=\"内存使用率\" tabindex=\"-1\"> 内存使用率</h3>\n<p>内存使用率反应的是内存的使用情况。内存用于存放程序的代码及数据，一般分为物理内存和虚拟内存，其中物理内存指的是服务器的内存，而虚拟内存指的是硬盘的一块空间。当物理内存使用率达到100%时将会使用虚拟内存。需要注意的是，虚拟内存的读写速度远远低于物理内存，如果程序被放在了虚拟内存执行，那么程序的执行效率会变得很低。</p>\n<p><strong>一般而言，服务器的物理内存应该保持在80%以下，虚拟内存使用率保持在0%。</strong></p>\n<p>服务器内存使用情况还是可以通过hop工具进行查看</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16566648003661.png\" alt=\"服务器运行数据查看工具\">内存使用率</p>\n<p>上面显示了服务器的内存使用情况：总内存16G，使用了10G左右，内存使用率62%，可以继续使用，同时关闭了Swap虚拟内存。</p>\n<p>在下<code>MEM%</code>栏中显示了单个进程的内存使用率。</p>\n<h3 id=\"磁盘i-o\" tabindex=\"-1\"> 磁盘I/O</h3>\n<p>磁盘I/O指的是磁盘的读写，在软件系统中，日志、文件操作、数据库操作都会造成磁盘读写压力，其中又以数据库操作为甚，在高并发情况下往往数据库会首先成为系统的瓶颈。</p>\n<p>磁盘监控我推荐大家使用iostat工具，可以很方便查看磁盘的使用情况。</p>\n<h4 id=\"使用iostat查看磁盘i-o\" tabindex=\"-1\"> 使用iostat查看磁盘I/O</h4>\n<p>首先我们需要安装<code>iostat</code>，以centos为例，安装命令如下：</p>\n<div><pre><code>yum <span>install</span> sysstat -y\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>安装完成后我们就可以通过<code>iostat</code>命令磁盘使用情况了。</p>\n<div><pre><code><span># 查看磁盘总体读写情况， 1代表每1秒读取一次数据</span>\niostat -x <span>1</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16566648003662.png\" alt=\"服务器运行数据查看工具\">磁盘IO</p>\n<p>输入<code>iostat</code>命令后，磁盘总体读写情况如上所示。磁盘负载主要关注2个指标：<code>%idle</code>，<code>%util</code></p>\n<ul>\n<li><code>%idle</code>:表示CPU<strong>除去等待磁盘I/O以外</strong>的空闲时间百分比，这个指标应该要保证在70%以上</li>\n<li><code>%util</code>:该设备用于I/O操作的时间百分比，这个指标需要保证在70%以下，当到达100%时表示已经满负载。为了降低磁盘负载，可以采用性能更高的磁盘（OSD，PCIE）或者降低磁盘的操作频率（异步写、合并写）</li>\n</ul>\n<h3 id=\"平均负载\" tabindex=\"-1\"> 平均负载</h3>\n<p>平均负载指的是单位时间内平均的活跃进程数，是一个表示服务器负载的指标。一般情况下需要保证平均负载的值小于当前服务器的CPU核数。</p>\n<p>同样的，查看服务器平均负载我们也可以使用<code>htop</code>命令</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16566648003663.png\" alt=\"服务器运行数据查看工具\">在这里我们主要关注<code>Load average</code>指标，上图有3个数字，分别代表1分钟，5分钟，15分钟的平均负载。</p>\n<p>一般情况下服务器的平均负载需要小于当前服务器的CPU核数，为了应对突发状况，服务器的平均负载应该在75%即3 以下，很显然，上图这台服务器平均负载超过了75%，需要考虑提升性能了。</p>\n<h3 id=\"网络使用情况\" tabindex=\"-1\"> 网络使用情况</h3>\n<p>网络使用情况也是监控的重要指标。当带宽不足时会大大增加请求的响应时间。为了防止突发性并发压力，应该保证服务器的带宽使用率在80%以上。这里需要注意的是，物理网卡限制了服务器所能使用的最大宽带。</p>\n<p>查看网络使用情况我推荐使用<code>nload</code>工具。</p>\n<h4 id=\"使用nload查看网络\" tabindex=\"-1\"> 使用nload查看网络</h4>\n<p>首先需要安装nload，以centos为例</p>\n<div><pre><code>yum <span>install</span> nload -y\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>安装完成后我们直接运行<code>nload</code></p>\n<div><pre><code>nload\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16566648003664.png\" alt=\"服务器运行数据查看工具\"></p>\n<p>输入<code>nload</code>命令后，网络使用情况如上图所示。其中，网络使用情况分为流入网卡的数据与流出网卡的数据。流入网卡的对应下行带宽的网速，流出网卡的数据对应上行带宽的网速。如果 “当前网速” 持续接近 “最大网速” 时，代表带宽使用率已经接近100%。</p>\n<p>指标说明：</p>\n<ul>\n<li>Curr：当前网速</li>\n<li>Avg：平均网速</li>\n<li>Min：最小网速</li>\n<li>Max：最大网速</li>\n<li>Ttl：总流量</li>\n</ul>\n<h2 id=\"服务器内核参数调优\" tabindex=\"-1\"> <strong>服务器内核参数调优</strong></h2>\n<p>光有强大的物理性能是不够的，还需要对内核参数进行调优，这样才能在高并发压力下充分体现服务器应有的性能。当然，并不是所有的服务器都需要做高并发性能调优，一般来说，只需要对要处理高并发请求的服务器进行内核参数调优即可，常见的包括：前端服务器，后端服务器，数据库服务器。</p>\n<p>服务器常见的调优参数主要有两个：单个进程最大打开文件数 和 TCP相关设置。</p>\n<h3 id=\"单个进程最大打开文件数\" tabindex=\"-1\"> 单个进程最大打开文件数</h3>\n<p>修改单个文件最大打开文件数，只需要编辑<code>/etc/security/limits.conf</code>文件，在文件末尾加上以下四句</p>\n<div><pre><code>* soft\tnofile\t<span>65535</span>\n* hard\tnofile\t<span>65535</span>\n* soft\tnproc\t<span>65535</span>\n* hard\tnproc\t<span>65535</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>其中<code>*</code> 代表所有用户，65536代表修改的值，重启后生效。</p>\n<h3 id=\"tcp相关设置\" tabindex=\"-1\"> TCP相关设置</h3>\n<p>修改TCP相关参数，可以优化TCP高并发通信，编辑<code>/etc/sysctl.conf</code>文件，添加以下内容</p>\n<div><pre><code><span># 为防止洪水攻击，高并发系统需要将此项关闭</span>\nnet.ipv4.tcp_syncookies <span>=</span> <span>0</span>\n\n<span># 开启TCP连接重用，允许处理TIME-WAIT状态的连接重新用于新的TCP连接</span>\nnet.ipv4.tcp_tw_reuse <span>=</span> <span>1</span>\n\n<span># 开启快速回收TCP连接中处于TIME-WAIT状态的连接</span>\nnet.ipv4.tcp_tw_recycle <span>=</span> <span>1</span>\n\n＃修改超时时间（ s <span>)</span>，该值表示如果连接由本端关闭，则连接处于 FIN-WAIT-2状态的时间为 \nnet.ipv4.tcp_fin_timeout <span>=</span> <span>30</span>\n\n＃当 keepalive（长连接）启用的时候，TCP发送 keepalive 消息（探测包）的时间间隔（ s <span>)</span>,默认为2个小时\nnet.ipv4.tcp_keepalive_time <span>=</span><span>1200</span>\n\n＃服务器对外连接的端口范围，影响该服务器与其他服务器的连接数\nnet.ipv4.ip_local_port_range <span>=</span><span>102465535</span>\n\n<span>#SYN队列的长度，可以容纳更多等待连接的网络连接数，默认为1024 </span>\nnet.ipv4.tcp_max_syn_backlog <span>=</span> <span>65535</span>\n\n＃保持 TIME_WAIT 状态连接的最大数量，如果超过此值，TIME_WAIT 将立刻被清除并打印警告信息，默认为180000\nnet.ipv4.tcp_max_tw_buckets <span>=</span><span>5000</span>\n\n＃每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目\nnet.core.netdev_max_backlog <span>=</span><span>65535</span>\n\n<span># TCP最大连接数</span>\nnet.core.somaxconn <span>=</span> <span>65535</span>\n\n＃预留用于接收缓冲的内存默认值（字节） \nnet.core.rmem_default <span>=</span> <span>8388608</span>\n\n＃预留用于接收缓冲的内存最大值（字节） \nnet.core.rmem_max <span>=</span> <span>16777216</span>\n\n＃预留用于发送缓冲的内存默认值（字节） \nnet.core.wmem_default <span>=</span> <span>8388608</span>\n\n＃预留用于发送缓冲的内存最大值（字节） \nnet.core.wmem_maX <span>=</span> <span>16777216</span>\n\n＃避免时间戳异常\nnet.ipv4.tcp_timestamps <span>=</span> <span>0</span>\n\n＃系统中最多有多少个 TCP 套接字不被关联到任何一个用户文件句柄上，如果超过这个数字，连接将即刻被复位并打印警告信息，这个限制仅仅是为了防止简单的DoS 攻击\nnet.ipv4.tcp_max_orphans <span>=</span><span>3276800</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16566648003660.png",
      "date_published": "2022-07-10T00:00:00.000Z",
      "date_modified": "2022-07-01T08:48:30.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Linux"
      ]
    },
    {
      "title": "Vue 子组件与父组件传值",
      "url": "https://blog.ciberviler.top/dev/Vue%E5%AD%90%E7%BB%84%E4%BB%B6%E4%B8%8E%E7%88%B6%E7%BB%84%E4%BB%B6%E4%BC%A0%E5%80%BC.html",
      "id": "https://blog.ciberviler.top/dev/Vue%E5%AD%90%E7%BB%84%E4%BB%B6%E4%B8%8E%E7%88%B6%E7%BB%84%E4%BB%B6%E4%BC%A0%E5%80%BC.html",
      "content_html": "<h1 id=\"vue-子组件与父组件传值\" tabindex=\"-1\"> Vue 子组件与父组件传值</h1>\n<h2 id=\"一、通过父组件给子组件传递函数类型的props实现\" tabindex=\"-1\"> 一、通过父组件给子组件传递函数类型的props实现</h2>\n<p>注意：通过props父子组件的设置接收的名称要一样，绑定的名字（<code>:getChildInfo</code>）和接收的一样（<code>props: ['getChildInfo']</code>）,当调用的时候使用this.xxx.xx范围要对应。</p>\n<p>父组件：</p>\n<div><pre><code><span><span><span>&lt;</span>Child</span> <span>:getChildInfo</span><span><span>=</span><span>\"</span>getChildInfo<span>\"</span></span><span>></span></span><span><span><span>&lt;/</span>Child</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>子组件：</p>\n<div><pre><code><span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>sendChildInfo<span>\"</span></span><span>></span></span><span><span><span>&lt;/</span>button</span><span>></span></span>\n\nprops: ['getChildInfo']\n\nsendChildInfo() {\n\tthis.getChildInfo(数据);\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"二、通过父组件给子组件绑定自定义事件实现\" tabindex=\"-1\"> 二、通过父组件给子组件绑定自定义事件实现</h2>\n<h3 id=\"第一种方式\" tabindex=\"-1\"> <strong>第一种方式：</strong></h3>\n<p>父组件：</p>\n<div><pre><code><span><span><span>&lt;</span>child</span> <span>@haha</span><span><span>=</span><span>\"</span>test<span>\"</span></span><span>></span></span><span><span><span>&lt;/</span>child</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>子组件：</p>\n<div><pre><code><span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>send<span>\"</span></span><span>></span></span><span><span><span>&lt;/</span>button</span><span>></span></span>\n\nsend() {\n\tthis.$emit('haha');\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"第二种方式\" tabindex=\"-1\"> <strong>第二种方式：</strong></h3>\n<p>父组件：</p>\n<div><pre><code><span><span><span>&lt;</span>child</span> <span>ref</span><span><span>=</span><span>\"</span>xxx<span>\"</span></span><span>></span></span><span><span><span>&lt;/</span>child</span><span>></span></span>\n\nmounted() {\n\tthis.$refs.xxx.$on('haha', this.test);\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>子组件：</p>\n<div><pre><code><span><span><span>&lt;</span>button</span> <span>@click</span><span><span>=</span><span>\"</span>send<span>\"</span></span><span>></span></span><span><span><span>&lt;/</span>button</span><span>></span></span>\n\nsend() {\n\tthis.$emit('haha');\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"注意\" tabindex=\"-1\"> 注意：</h3>\n<ol>\n<li>\n<p>若想让自定义事件只能触发一次，可以使用<code>once</code>修饰符，或者<code>$once</code>方法。</p>\n</li>\n<li>\n<p>组件上也可以绑定原生DOM事件，需要使用<code>native</code>修饰符</p>\n<div><pre><code><span><span><span>&lt;</span>Child</span> <span>@click.native</span><span><span>=</span><span>\"</span>xxx<span>\"</span></span><span>></span></span><span><span><span>&lt;/</span>Child</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div></li>\n<li>\n<p>通过<code>this.$refs.xxx.$on('haha', 回调)</code>绑定自定义事件时，回调要么配置在methods中，要么用箭头函数，否则this的指向会出问题。</p>\n</li>\n</ol>\n<h2 id=\"其他参考\" tabindex=\"-1\"> 其他参考</h2>\n<p><strong>一，子组件主动触发事件将数据传递给父组件</strong></p>\n<p>1，在子组件上绑定某个事件以及事件触发的函数</p>\n<p>子组件代码</p>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n    <span><span><span>&lt;</span>div</span><span>></span></span>\n    <span><span><span>&lt;</span>Tree</span> <span>:data</span><span><span>=</span><span>\"</span>treeData<span>\"</span></span> <span>show-checkbox</span> <span>ref</span><span><span>=</span><span>\"</span>treeData<span>\"</span></span><span>></span></span><span><span><span>&lt;/</span>Tree</span><span>></span></span>\n    <span><span><span>&lt;</span>Button</span> <span>type</span><span><span>=</span><span>\"</span>success<span>\"</span></span> <span>@click</span><span><span>=</span><span>\"</span>submit<span>\"</span></span><span>></span></span><span><span><span>&lt;/</span>Button</span><span>></span></span>\n    <span><span><span>&lt;/</span>div</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>事件在子组件中触发的函数</p>\n<div><pre><code>submit(){\n  this.$emit('getTreeData',this.$refs.treeData.getCheckedNodes());\n},\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>2，在父组件中绑定触发事件</p>\n<div><pre><code><span><span><span>&lt;</span>AuthTree</span>  <span>@getTreeData</span><span><span>=</span><span>'</span>testData<span>'</span></span><span>></span></span>\n<span><span><span>&lt;/</span>AuthTree</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>父组件触发函数显示子组件传递的数据</p>\n<div><pre><code>testData(data){\n    console.log(\"parent\");\n    console.log(data)\n},\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p><strong>二，不需要再子组件中触发事件（如点击按钮，create（）事件等等）</strong></p>\n<p>这种方式要简单得多，</p>\n<p>1，子组件中绑定ref</p>\n<div><pre><code><span><span><span>&lt;</span>template</span><span>></span></span>\n<span><span><span>&lt;</span>div</span><span>></span></span>\n<span><span><span>&lt;</span>Tree</span> <span>:data</span><span><span>=</span><span>\"</span>treeData<span>\"</span></span> <span>show-checkbox</span> <span>ref</span><span><span>=</span><span>\"</span>treeData<span>\"</span></span><span>></span></span><span><span><span>&lt;/</span>Tree</span><span>></span></span>\n<span><span><span>&lt;/</span>div</span><span>></span></span>\n<span><span><span>&lt;/</span>template</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>然后在子组件中定义一个函数，这个函数是父组件可以直接调用的。函数的返回值定义为我们需要的数据。</p>\n<div><pre><code>getData(){\n        return this.$refs.treeData.getCheckedNodes()\n    },\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>然后再父组件注册子组件后绑定ref，调用子组件的函数获取数据</p>\n<div><pre><code><span><span><span>&lt;</span>AuthTree</span> <span>ref</span><span><span>=</span><span>\"</span>authTree<span>\"</span></span><span>></span></span>\n          <span><span><span>&lt;/</span>AuthTree</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>父组件函数调用</p>\n<div><pre><code>console.log( this.$refs.authTree.getData());\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p><strong>注意：</strong></p>\n<div><pre><code>emits<span>.</span><span>emit</span><span>(</span><span>\"setAcctStatusPilh\"</span><span>,</span>res<span>.</span>data<span>.</span>acctType<span>)</span><span>;</span>  <span>//如果组件lazy为true，打开时组件未祖册，无法设置</span>\n<span>this</span><span>.</span>$refs<span>.</span>pilhacctmthlyblginfsgmt<span>.</span><span>getAcctType</span><span>(</span>res<span>.</span>data<span>.</span>acctType<span>)</span><span>;</span>  <span>//如果组件lazy为false，打开时组件未祖册，无法设置</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div>",
      "date_published": "2022-07-08T00:00:00.000Z",
      "date_modified": "2022-07-08T08:06:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "JRebel热部署的使用",
      "url": "https://blog.ciberviler.top/dev/JRebel%E7%83%AD%E9%83%A8%E7%BD%B2%E7%9A%84%E4%BD%BF%E7%94%A8.html",
      "id": "https://blog.ciberviler.top/dev/JRebel%E7%83%AD%E9%83%A8%E7%BD%B2%E7%9A%84%E4%BD%BF%E7%94%A8.html",
      "content_html": "<h1 id=\"jrebel热部署的使用\" tabindex=\"-1\"> JRebel热部署的使用</h1>\n<p>对比图：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/feabc010fbd0a0467f3bcb155faede3b-16565707073351.png\" alt=\"JRebel热部署的使用\"></p>\n<p>IDEA在这里配置了自动编译：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/c2dc072b4fb156f0ee8da0c3dd86abb5-16565707098543.png\" alt=\"JRebel热部署的使用\"></p>\n<p>所以当你的代码有变化时，JRebel会自动重新加载最新的代码，所以不用你手动重新编译</p>\n<h2 id=\"注意事项\" tabindex=\"-1\"> <strong>注意事项：</strong></h2>\n<p>c盘下的用户名一定不能为中文名称，否则会一直提示路径错误</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210318093831211.png\" alt=\"注意事项\"></p>\n<h2 id=\"_1、安装jrebel插件\" tabindex=\"-1\"> 1、安装jrebel插件</h2>\n<p>File–》Settings—》plugins----》marketplace----》搜索jrebel</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210318095405727.png\" alt=\"JRebel热部署的使用\"></p>\n<p>安装成功后会重启idea，出现下面的图片</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2021031809551542.png\" alt=\"JRebel热部署的使用\"></p>\n<h2 id=\"_2、配置jrebel插件\" tabindex=\"-1\"> 2、配置jrebel插件</h2>\n<h3 id=\"_2-1激活jrebel\" tabindex=\"-1\"> 2.1激活jrebel</h3>\n<p>先获取GUID</p>\n<ul>\n<li>第一种</li>\n</ul>\n<p>这里感谢薯条大佬搭建的激活服务器，直接访问<a href=\"https://jrebel.qekang.com\" target=\"_blank\" rel=\"noopener noreferrer\">https://jrebel.qekang.com</a>，复制界面上展示的激活链接，填充到激活页面，然后随便填写一个邮箱名即可完成激活。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/715c5a15e09cf6bf8bc357073a697464.png\" alt=\"JRebel热部署的使用\"></p>\n<div><pre><code>https://jrebel.qekang.com/xxxx\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><ul>\n<li>第二种</li>\n</ul>\n<p>在线生成GUID地址 （<a href=\"https://www.guidgen.com/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>https://www.guidgen.com/</strong></a>）， PS：如果失效刷新GUID替换就可以！</p>\n<p>输入url：<code>https://jrebel.qekang.com/GUID</code>(其中的GUID是2.1生成的，邮箱自己随意填写)</p>\n<p>之前点击蓝色字体会出现这个窗口，将上面获取到的GUID根据图片提示输入进去</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210318094513359.png\" alt=\"JRebel热部署的使用\"></p>\n<p>如果没有出现下面提示，请确定自己的网络通畅，然后再次点击激活，如果还不行，更改guid</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2021031809480460.png\" alt=\"JRebel热部署的使用\"></p>\n<ul>\n<li>继续点击我同意【I agree】</li>\n</ul>\n<h2 id=\"_3、jrebel-配置\" tabindex=\"-1\"> 3、JRebel 配置</h2>\n<h3 id=\"_3、1-将工作模式改成离线工作\" tabindex=\"-1\"> 3、1 将工作模式改成离线工作，！！！！</h3>\n<p>不修改成离线工作，你的jrebel会一直报错，当然某些小伙伴的是没有问题</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210318100401836.png\" alt=\"JRebel热部署的使用\"></p>\n<ul>\n<li>你的右上角会有两个绿色的小图标，这个就是jrebel启动</li>\n</ul>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210318100852670.png\" alt=\"JRebel热部署的使用\"></p>\n<h2 id=\"_4、使用jrebel\" tabindex=\"-1\"> 4、使用jreBel</h2>\n<h3 id=\"_4、1-进行项目热部署\" tabindex=\"-1\"> 4、1 进行项目热部署</h3>\n<ul>\n<li>\n<p>左下角有一个JreBel，点击在打开的窗口，选择你所需要进行热部署的项目。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210603103938126.png\" alt=\"JRebel热部署的使用\"></p>\n</li>\n<li>\n<p>勾选后会生成一个rebel.xml文件，此文件可以忽略</p>\n</li>\n</ul>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210603104004373.png\" alt=\"JRebel热部署的使用\"></p>\n<h3 id=\"_4、3-更改后使用ctrl-f9实现不重启服务器部署项目\" tabindex=\"-1\"> 4、3 更改后使用ctrl+f9实现不重启服务器部署项目</h3>\n<ul>\n<li>或者点击小锤子也是\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210603104217131.png\" alt=\"JRebel热部署的使用\"></li>\n</ul>\n<h3 id=\"_4、4-录制快捷键\" tabindex=\"-1\"> 4、4 录制快捷键</h3>\n<ul>\n<li>原有的保存操作不方便一只手操作，设置新的快捷键方便操作\n-edit—&gt;macros—&gt;start macro recording\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2021060310490611.png\" alt=\"JRebel热部署的使用\"></li>\n<li>右下角会出现一个提示\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210603104826766.png\" alt=\"JRebel热部署的使用\"></li>\n<li>然后点击ctrl+F9，此时右下角会有提示，点击红色停止\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210603105037206.png\" alt=\"JRebel热部署的使用\"></li>\n<li>会弹出一个窗口，在窗口中输入build</li>\n</ul>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210603105130362.png\" alt=\"JRebel热部署的使用\"></p>\n<ul>\n<li>打开设置，找到kaymap</li>\n</ul>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210603105243414.png\" alt=\"JRebel热部署的使用\"></p>\n<ul>\n<li>右击选择第一个，在弹出的窗口输入你想使用的快捷键，<code>ctrl+s</code> 已经被使用，建议使用<code>alt+z</code>或者<code>alt+s</code></li>\n</ul>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2021060310541226.png\" alt=\"JRebel热部署的使用\"></p>\n<h3 id=\"警告\" tabindex=\"-1\"> 警告！！！</h3>\n<p>JreBel不适用于resources包下面的文件，修改此包下面的必须重启，否则不生效。</p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/feabc010fbd0a0467f3bcb155faede3b-16565707073351.png",
      "date_published": "2022-07-09T00:00:00.000Z",
      "date_modified": "2022-07-01T03:35:36.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "15000 字的 SQL 语句大全",
      "url": "https://blog.ciberviler.top/dev/15000%E5%AD%97%E7%9A%84SQL%E8%AF%AD%E5%8F%A5%E5%A4%A7%E5%85%A8.html",
      "id": "https://blog.ciberviler.top/dev/15000%E5%AD%97%E7%9A%84SQL%E8%AF%AD%E5%8F%A5%E5%A4%A7%E5%85%A8.html",
      "content_html": "<h1 id=\"_15000-字的-sql-语句大全\" tabindex=\"-1\"> 15000 字的 SQL 语句大全</h1>\n<p><strong>一、基础</strong></p>\n<p><strong>1、说明：创建数据库</strong></p>\n<p>CREATE DATABASE database-name</p>\n<p><strong>2</strong>**、说明：删除数据库**</p>\n<p><strong>d</strong>rop database dbname</p>\n<p><strong>3、说明：备份sql server</strong></p>\n<div><pre><code><span>--- 创建 备份数据的 device</span>\n<span>USE</span> master\n<span>EXEC</span> sp_addumpdevice <span>'disk'</span><span>,</span> <span>'testBack'</span><span>,</span> <span>'c:\\mssql7backup\\MyNwind_1.dat'</span>\n<span>--- 开始 备份</span>\n<span>BACKUP</span> <span>DATABASE</span> pubs <span>TO</span> testBack \n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>4、说明：创建新表</strong></p>\n<p>create table tabname(col1 type1 [not null] [primary key],col2 type2 [not null],..)</p>\n<p><strong>根据已有的表创建新表：</strong></p>\n<p>**A：<strong>create table tab_new like tab_old (使用旧表创建新表)\n<strong>B</strong></strong>：**create table tab_new as select col1,col2… from tab_old definition only</p>\n<p><strong>5、说明：删除新表</strong></p>\n<p>drop table tabname</p>\n<p><strong>6、说明：增加一个列</strong></p>\n<p>Alter table tabname add column col type</p>\n<p><strong>注</strong>：列增加后将不能删除。DB2中列加上后数据类型也不能改变，唯一能改变的是增加varchar类型的长度。</p>\n<p><strong>7、说明：添加主键</strong>：Alter table tabname add primary key(col)\n说明：删除主键：Alter table tabname drop primary key(col)</p>\n<p><strong>8、说明：创建索引</strong>：create [unique] index idxname on tabname(col….)</p>\n<p>删除索引：drop index idxname**\n**</p>\n<p>注：索引是不可更改的，想更改必须删除重新建。</p>\n<p><strong>9</strong>**、说明：创建视图**：create view viewname as select statement</p>\n<p><strong>删除视图</strong>：drop view viewname</p>\n<p><strong>10</strong>**、说明：几个简单的基本的sql语句**</p>\n<p>**选择：**select * from table1 where 范围\n**插入：**insert into table1(field1,field2) values(value1,value2)\n<strong>删除：<strong>delete from table1 where 范围</strong>更新</strong>：update table1 set field1=value1 where 范围\n<strong>查找</strong>：select * from table1 where field1 like ’%value1%’ ---like的语法很精妙，查资料!\n<strong>排序</strong>：select * from table1 order by field1,field2 [desc]\n<strong>总数</strong>：select count as totalcount from table1\n<strong>求和</strong>：select sum(field1) as sumvalue from table1\n<strong>平均</strong>：select avg(field1) as avgvalue from table1\n<strong>最大</strong>：select max(field1) as maxvalue from table1\n<strong>最小</strong>：select min(field1) as minvalue from table1</p>\n<p><strong>11、说明：几个高级查询运算词</strong></p>\n<p><strong>A：UNION 运算符</strong></p>\n<p>UNION 运算符通过组合其他两个结果表（例如 TABLE1 和 TABLE2）并消去表中任何重复行而派生出一个结果表。当 ALL 随 UNION 一起使用时（即 UNION ALL），不消除重复行。两种情况下，派生表的每一行不是来自 TABLE1 就是来自 TABLE2。</p>\n<p><strong>B：EXCEPT 运算符</strong></p>\n<p><strong>EXCEPT</strong>运算符通过包括所有在 TABLE1 中但不在 TABLE2 中的行并消除所有重复行而派生出一个结果表。当 ALL 随 EXCEPT 一起使用时 (EXCEPT ALL)，不消除重复行。**\n**</p>\n<p><strong>C：INTERSECT 运算符</strong></p>\n<p><strong>INTERSECT</strong>运算符通过只包括 TABLE1 和 TABLE2 中都有的行并消除所有重复行而派生出一个结果表。当 <strong>ALL</strong>随 INTERSECT 一起使用时 (INTERSECT ALL)，不消除重复行。\n**注：**使用运算词的几个查询结果行必须是一致的。</p>\n<p><strong>12</strong>**、说明：使用外连接**</p>\n<p>A、<strong>left （outer） join</strong>：</p>\n<p>左外连接（左连接）：结果集几包括连接表的匹配行，也包括左连接表的所有行。</p>\n<p>SQL: select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a = b.c</p>\n<p><strong>B：right （outer） join:</strong></p>\n<p>右外连接(右连接)：结果集既包括连接表的匹配连接行，也包括右连接表的所有行。</p>\n<p><strong>C：full/cross （outer） join</strong>：</p>\n<p>全外连接：不仅包括符号连接表的匹配行，还包括两个连接表中的所有记录。</p>\n<p><strong>12</strong>**、分组:Group by:\n**</p>\n<p>一张表，一旦分组 完成后，查询后只能得到组相关的信息。</p>\n<p><strong>组相关的信息：</strong>（统计信息） count,sum,max,min,avg <strong>分组的标准)</strong></p>\n<p><strong>在SQLServer中分组时：不能以text,ntext,image类型的字段作为分组依据</strong></p>\n<p><strong>在selecte统计函数中的字段，不能和普通的字段放在一起；</strong></p>\n<p><strong>13、对数据库进行操作：</strong></p>\n<p>**\n**</p>\n<p><strong>分离数据库</strong>： <strong>sp_detach_db;</strong></p>\n<p><strong>附加数据库</strong>：<strong>sp_attach_db</strong> 后接表明，附加需要完整的路径名</p>\n<p>**14.**<strong>如何修改数据库的名称:</strong></p>\n<p>sp_renamedb 'old_name', 'new_name'</p>\n<p>对了，我把 MySQL 相关的文章整理成了 PDF，有需要的关注微信公众号 Java后端，回复 666 下载。</p>\n<p><strong>二、提升</strong></p>\n<p>**1、说明：复制表(只复制结构,源表名：a 新表名：b) (Access可用)\n**</p>\n<p>**法一：**select * into b from a where 1&lt;&gt;1（仅用于SQlServer）</p>\n<p>**法二：**select top 0 * into b from a\n**\n**</p>\n<p>**2、说明：拷贝表(拷贝数据,源表名：a 目标表名：b) (Access可用)\n**</p>\n<p>insert into b(a, b, c) select d,e,f from b;</p>\n<p>**3、说明：跨数据库之间表的拷贝(具体数据使用绝对路径) (Access可用)\n**</p>\n<p>insert into b(a, b, c) select d,e,f from b in ‘具体数据库’ where 条件\n例子：..from b in '&quot;&amp;Server.MapPath(&quot;.&quot;)&amp;&quot;\\data.mdb&quot; &amp;&quot;' where..</p>\n<p>**4、说明：子查询(表名1：a 表名2：b)\n**</p>\n<p>select a,b,c from a where a IN (select d from b ) 或者: select a,b,c from a where a IN (1,2,3)</p>\n<p>**5、说明：显示文章、提交人和最后回复时间\n**</p>\n<p>select a.title,a.username,b.adddate from table a,(select max(adddate) adddate from table where table.title=a.title) b</p>\n<p>**6、说明：外连接查询(表名1：a 表名2：b)\n**</p>\n<p>select a.a, a.b, a.c, b.c, b.d, b.f from a LEFT OUT JOIN b ON a.a = b.c</p>\n<p>**7、说明：在线视图查询(表名1：a )\n**select * from (SELECT a,b,c FROM a) T where t.a &gt; 1;</p>\n<p>**8、说明：between的用法,between限制查询数据范围时包括了边界值,not between不包括\n**</p>\n<p>select * from table1 where time between time1 and time2\nselect a,b,c, from table1 where a not between 数值1 and 数值2</p>\n<p>**9、说明：in 的使用方法\n**</p>\n<p>select * from table1 where a [not] in (‘值1’,’值2’,’值4’,’值6’)</p>\n<p>**10、说明：两张关联表，删除主表中已经在副表中没有的信息\n**</p>\n<p>delete from table1 where not exists ( select * from table2 where table1.field1=table2.field1 )</p>\n<p>**11、说明：四表联查问题：\n**</p>\n<p>select * from a left inner join b on a.a=b.b right inner join c on a.a=c.c inner join d on a.a=d.d where .....</p>\n<p>**12、说明：日程安排提前五分钟提醒\n**</p>\n<p>SQL: select * from 日程安排 where datediff('minute',f开始时间,getdate())&gt;5</p>\n<p><strong>13</strong>**、说明：一条****sql** <strong>语句搞定数据库分页</strong></p>\n<p>select top 10 b.* from (select top 20 主键字段,排序字段 from 表名 order by 排序字段 desc) a,表名 b where b.主键字段 = a.主键字段 order by a.排序字段</p>\n<p>**\n**</p>\n<p>**具体实现：**关于数据库分页：</p>\n<div><pre><code><span>declare</span> <span>@start</span> <span>int</span><span>,</span><span>@end</span> <span>int</span>\n  <span>@sql</span>  nvarchar<span>(</span><span>600</span><span>)</span>\n  <span>set</span> <span>@sql</span><span>=</span>’<span>select</span> <span>top</span>’<span>+</span>str<span>(</span><span>@end</span><span>-</span><span>@start</span><span>+</span><span>1</span><span>)</span><span>+</span>’<span>+</span><span>from</span> T <span>where</span> rid <span>not</span> <span>in</span><span>(</span><span>select</span> <span>top</span>’<span>+</span>str<span>(</span><span>@str</span><span>-</span><span>1</span><span>)</span><span>+</span>’Rid <span>from</span> T <span>where</span> Rid<span>></span><span>-</span><span>1</span><span>)</span>’\n  <span>exec</span> sp_executesql <span>@sql</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>**注意：**在top后不能直接跟一个变量，所以在实际应用中只有这样的进行特殊的处理。Rid为一个标识列，如果top后还有具体的字段，这样做是非常有好处的。因为这样可以避免 top的字段如果是逻辑索引的，查询的结果后实际表中的不一致（逻辑索引中的数据有可能和数据表中的不一致，而查询时如果处在索引则首先查询索引）</p>\n<p>**14、说明：前10条记录\n**</p>\n<p>select top 10 * form table1 where 范围</p>\n<p>**15、说明：<strong>选择在每一组b值相同的数据中对应的a最大的记录的所有信息(类似这样的用法可以用于论坛每月排行榜,每月热销产品分析,按科目成绩排名,等等.)</strong>\n**</p>\n<p>select a,b,c from tablename ta where a=(select max(a) from tablename tb where tb.b=ta.b)</p>\n<p>**16、说明：<strong>包括所有在 TableA中但不在 TableB和TableC中的行并消除所有重复行而派生出一个结果表</strong>\n**</p>\n<p>(select a from tableA ) except (select a from tableB) except (select a from tableC)</p>\n<p>**17、说明：随机取出10条数据\n**</p>\n<p>select top 10 * from tablename order by newid()</p>\n<p>**18、说明：随机选择记录\n**</p>\n<p>select newid()</p>\n<p>**19、说明：删除重复记录\n**</p>\n<p><strong>1)</strong> delete from tablename where id not in (select max(id) from tablename group by col1,col2,...)</p>\n<p><strong>2)</strong> select distinct * into temp from tablename\ndelete from tablename\ninsert into tablename select * from temp\n**\n**</p>\n<p>**评价：**这种操作牵连大量的数据的移动，这种做法不适合大容量但数据操作3),例如：在一个外部表中导入数据，由于某些原因第一次只导入了一部分，但很难判断具体位置，这样只有在下一次全部导入，这样也就产生好多重复的字段，怎样删除重复字段</p>\n<div><pre><code><span>alter</span> <span>table</span> tablename\n<span>--添加一个自增列</span>\n<span>add</span>  column_b <span>int</span> <span>identity</span><span>(</span><span>1</span><span>,</span><span>1</span><span>)</span>\n <span>delete</span> <span>from</span> tablename <span>where</span> column_b <span>not</span> <span>in</span><span>(</span>\n<span>select</span> <span>max</span><span>(</span>column_b<span>)</span> <span>from</span> tablename <span>group</span> <span>by</span> column1<span>,</span>column2<span>,</span><span>.</span><span>.</span><span>.</span><span>)</span>\n<span>alter</span> <span>table</span> tablename <span>drop</span> <span>column</span> column_b\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>**20、说明：列出数据库里所有的表名\n**</p>\n<p>select name from sysobjects where type='U' // U代表用户</p>\n<p>**21、说明：列出表里的所有的列名\n**</p>\n<p>select name from syscolumns where id=object_id('TableName')</p>\n<p>**22、说明：<strong>列示type、vender、pcs字段，以type字段排列，case可以方便地实现多重选择，类似select 中的case。</strong>\n**</p>\n<p>select type,sum(case vender when 'A' then pcs else 0 end),sum(case vender when 'C' then pcs else 0 end),sum(case vender when 'B' then pcs else 0 end) FROM tablename group by type\n**\n**</p>\n<p>**显示结果：\ntype vender pcs\n**电脑 A 1\n电脑 A 1\n光盘 B 2\n光盘 A 2\n手机 B 3\n手机 C 3</p>\n<p><strong>23、说明：初始化表table1</strong></p>\n<p>TRUNCATE TABLE table1</p>\n<p>**24、说明：选择从10到15的记录\n**</p>\n<p>select top 5 * from (select top 15 * from table order by id asc) table_别名 order by id desc</p>\n<p><strong>三、技巧</strong></p>\n<p><strong>1、1=1，1=2的使用，在SQL语句组合时用的较多</strong></p>\n<p><strong>“where 1=1” 是表示选择全部  “where 1=2”全部不选，</strong>\n如：</p>\n<div><pre><code><span>if</span> <span>@strWhere</span> <span>!=</span><span>''</span> \n<span>begin</span>\n<span>set</span> <span>@strSQL</span> <span>=</span> <span>'select count(*) as Total from ['</span> <span>+</span> <span>@tblName</span> <span>+</span> <span>'] where '</span> <span>+</span> <span>@strWhere</span>\n<span>end</span>\n<span>else</span> \n<span>begin</span>\n<span>set</span> <span>@strSQL</span> <span>=</span> <span>'select count(*) as Total from ['</span> <span>+</span> <span>@tblName</span> <span>+</span> <span>']'</span> \n<span>end</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>我们可以直接写成</strong></p>\n<p>set @strSQL = 'select count(*) as Total from [' + @tblName + '] where 1=1 安定 '+ @strWhere</p>\n<p>**\n**</p>\n<p><strong>2、收缩数据库</strong></p>\n<p>**\n**--重建索引\nDBCC REINDEX\nDBCC INDEXDEFRAG\n--收缩数据和日志\nDBCC SHRINKDB\nDBCC SHRINKFILE</p>\n<p><strong>3、压缩数据库</strong></p>\n<p>**\n**dbcc shrinkdatabase(dbname)</p>\n<p><strong>4、转移数据库给新用户以已存在用户权限</strong></p>\n<p>**\n**exec sp_change_users_login 'update_one','newname','oldname'\ngo</p>\n<p>**5、检查备份集\n**RESTORE VERIFYONLY from disk='E:\\dvbbs.bak'</p>\n<p><strong>6、修复数据库</strong></p>\n<div><pre><code><span>ALTER</span> <span>DATABASE</span> <span>[</span>dvbbs<span>]</span> <span>SET</span> SINGLE_USER\nGO\n<span>DBCC</span> CHECKDB<span>(</span><span>'dvbbs'</span><span>,</span>repair_allow_data_loss<span>)</span> <span>WITH</span> TABLOCK\nGO\n<span>ALTER</span> <span>DATABASE</span> <span>[</span>dvbbs<span>]</span> <span>SET</span> MULTI_USER\nGO\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>7、日志清除</strong></p>\n<div><pre><code><span>SET</span> NOCOUNT <span>ON</span>\n<span>DECLARE</span> <span>@LogicalFileName</span> sysname<span>,</span>\n <span>@MaxMinutes</span> <span>INT</span><span>,</span>\n <span>@NewSize</span> <span>INT</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>USE</span> tablename <span>-- 要操作的数据库名</span>\n<span>SELECT</span> <span>@LogicalFileName</span> <span>=</span> <span>'tablename_log'</span><span>,</span> <span>-- 日志文件名</span>\n<span>@MaxMinutes</span> <span>=</span> <span>10</span><span>,</span> <span>-- Limit on time allowed to wrap log.</span>\n <span>@NewSize</span> <span>=</span> <span>1</span> <span>-- 你想设定的日志文件的大小(M)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><div><pre><code>Setup <span>/</span> initialize\n<span>DECLARE</span> <span>@OriginalSize</span> <span>int</span>\n<span>SELECT</span> <span>@OriginalSize</span> <span>=</span> size \n <span>FROM</span> sysfiles\n <span>WHERE</span> name <span>=</span> <span>@LogicalFileName</span>\n<span>SELECT</span> <span>'Original Size of '</span> <span>+</span> db_name<span>(</span><span>)</span> <span>+</span> <span>' LOG is '</span> <span>+</span> \n <span>CONVERT</span><span>(</span><span>VARCHAR</span><span>(</span><span>30</span><span>)</span><span>,</span><span>@OriginalSize</span><span>)</span> <span>+</span> <span>' 8K pages or '</span> <span>+</span> \n <span>CONVERT</span><span>(</span><span>VARCHAR</span><span>(</span><span>30</span><span>)</span><span>,</span><span>(</span><span>@OriginalSize</span><span>*</span><span>8</span><span>/</span><span>1024</span><span>)</span><span>)</span> <span>+</span> <span>'MB'</span>\n <span>FROM</span> sysfiles\n <span>WHERE</span> name <span>=</span> <span>@LogicalFileName</span>\n<span>CREATE</span> <span>TABLE</span> DummyTrans\n <span>(</span>DummyColumn <span>char</span> <span>(</span><span>8000</span><span>)</span> <span>not</span> <span>null</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>DECLARE</span> <span>@Counter</span>  <span>INT</span><span>,</span>\n <span>@StartTime</span> <span>DATETIME</span><span>,</span>\n <span>@TruncLog</span>  <span>VARCHAR</span><span>(</span><span>255</span><span>)</span>\n<span>SELECT</span> <span>@StartTime</span> <span>=</span> GETDATE<span>(</span><span>)</span><span>,</span>\n <span>@TruncLog</span> <span>=</span> <span>'BACKUP LOG '</span> <span>+</span> db_name<span>(</span><span>)</span> <span>+</span> <span>' WITH TRUNCATE_ONLY'</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>DBCC</span> SHRINKFILE <span>(</span><span>@LogicalFileName</span><span>,</span> <span>@NewSize</span><span>)</span>\n<span>EXEC</span> <span>(</span><span>@TruncLog</span><span>)</span>\n<span>-- Wrap the log if necessary.</span>\n<span>WHILE</span> <span>@MaxMinutes</span> <span>></span> DATEDIFF <span>(</span>mi<span>,</span> <span>@StartTime</span><span>,</span> GETDATE<span>(</span><span>)</span><span>)</span> <span>-- time has not expired</span>\n <span>AND</span> <span>@OriginalSize</span> <span>=</span> <span>(</span><span>SELECT</span> size <span>FROM</span> sysfiles <span>WHERE</span> name <span>=</span> <span>@LogicalFileName</span><span>)</span> \n <span>AND</span> <span>(</span><span>@OriginalSize</span> <span>*</span> <span>8</span> <span>/</span><span>1024</span><span>)</span> <span>></span> <span>@NewSize</span> \n <span>BEGIN</span> <span>-- Outer loop.</span>\n<span>SELECT</span> <span>@Counter</span> <span>=</span> <span>0</span>\n <span>WHILE</span>  <span>(</span><span>(</span><span>@Counter</span> <span>&lt;</span> <span>@OriginalSize</span> <span>/</span> <span>16</span><span>)</span> <span>AND</span> <span>(</span><span>@Counter</span> <span>&lt;</span> <span>50000</span><span>)</span><span>)</span>\n <span>BEGIN</span> <span>-- update</span>\n <span>INSERT</span> DummyTrans <span>VALUES</span> <span>(</span><span>'Fill Log'</span><span>)</span> <span>DELETE</span> DummyTrans\n <span>SELECT</span> <span>@Counter</span> <span>=</span> <span>@Counter</span> <span>+</span> <span>1</span>\n <span>END</span>\n <span>EXEC</span> <span>(</span><span>@TruncLog</span><span>)</span> \n <span>END</span>\n<span>SELECT</span> <span>'Final Size of '</span> <span>+</span> db_name<span>(</span><span>)</span> <span>+</span> <span>' LOG is '</span> <span>+</span>\n <span>CONVERT</span><span>(</span><span>VARCHAR</span><span>(</span><span>30</span><span>)</span><span>,</span>size<span>)</span> <span>+</span> <span>' 8K pages or '</span> <span>+</span> \n <span>CONVERT</span><span>(</span><span>VARCHAR</span><span>(</span><span>30</span><span>)</span><span>,</span><span>(</span>size<span>*</span><span>8</span><span>/</span><span>1024</span><span>)</span><span>)</span> <span>+</span> <span>'MB'</span>\n <span>FROM</span> sysfiles \n <span>WHERE</span> name <span>=</span> <span>@LogicalFileName</span>\n<span>DROP</span> <span>TABLE</span> DummyTrans\n<span>SET</span> NOCOUNT <span>OFF</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>8、说明：更改某个表</strong></p>\n<p>**\n**exec sp_changeobjectowner 'tablename','dbo'</p>\n<p><strong>9、存储更改全部表</strong></p>\n<div><pre><code><span>CREATE</span> <span>PROCEDURE</span> dbo<span>.</span>User_ChangeObjectOwnerBatch\n<span>@OldOwner</span> <span>as</span> NVARCHAR<span>(</span><span>128</span><span>)</span><span>,</span>\n<span>@NewOwner</span> <span>as</span> NVARCHAR<span>(</span><span>128</span><span>)</span>\n<span>AS</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>DECLARE</span> <span>@Name</span>  <span>as</span> NVARCHAR<span>(</span><span>128</span><span>)</span>\n<span>DECLARE</span> <span>@Owner</span>  <span>as</span> NVARCHAR<span>(</span><span>128</span><span>)</span>\n<span>DECLARE</span> <span>@OwnerName</span>  <span>as</span> NVARCHAR<span>(</span><span>128</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><div><pre><code><span>DECLARE</span> curObject <span>CURSOR</span> <span>FOR</span> \n<span>select</span> <span>'Name'</span>  <span>=</span> name<span>,</span>\n  <span>'Owner'</span>  <span>=</span> user_name<span>(</span>uid<span>)</span>\n<span>from</span> sysobjects\n<span>where</span> user_name<span>(</span>uid<span>)</span><span>=</span><span>@OldOwner</span>\n<span>order</span> <span>by</span> name\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>OPEN</span>  curObject\n<span>FETCH</span> <span>NEXT</span> <span>FROM</span> curObject <span>INTO</span> <span>@Name</span><span>,</span> <span>@Owner</span>\n<span>WHILE</span><span>(</span>@<span>@FETCH_STATUS</span><span>=</span><span>0</span><span>)</span>\n<span>BEGIN</span>   \n<span>if</span> <span>@Owner</span><span>=</span><span>@OldOwner</span> \n<span>begin</span>\n  <span>set</span> <span>@OwnerName</span> <span>=</span> <span>@OldOwner</span> <span>+</span> <span>'.'</span> <span>+</span> rtrim<span>(</span><span>@Name</span><span>)</span>\n  <span>exec</span> sp_changeobjectowner <span>@OwnerName</span><span>,</span> <span>@NewOwner</span>\n<span>end</span>\n<span>-- select @name,@NewOwner,@OldOwner</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>FETCH</span> <span>NEXT</span> <span>FROM</span> curObject <span>INTO</span> <span>@Name</span><span>,</span> <span>@Owner</span>\n<span>END</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><div><pre><code><span>close</span> curObject\n<span>deallocate</span> curObject\nGO\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p><strong>10、SQL SERVER中直接循环写入数据</strong></p>\n<p>**\n**declare @i int\nset @i=1\nwhile @i&lt;30\nbegin\ninsert into test (userid) values(@i)\nset @i=@i+1\nend\n**\n**</p>\n<p><strong>案例</strong>**：**</p>\n<p>**\n**有如下表，要求就裱中所有沒有及格的成績，在每次增長0.1的基礎上，使他們剛好及格:</p>\n<div><pre><code>Name   scor\nZhangshan 80\nLishi 59\nWangwu 50\nSongquan 69\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>while((select</strong> <strong>min</strong>**(score) from tb_table)&lt;<strong><strong>60</strong></strong>)**</p>\n<p><strong>begin</strong></p>\n<p><strong>update tb_table set score</strong> **=****score***<strong>1.01</strong></p>\n<p><strong>where score</strong>**&lt;60**</p>\n<p><strong>if (select</strong> <strong>min</strong>**(score) from tb_table)****&gt;60**</p>\n<p><strong>break</strong></p>\n<p><strong>else</strong></p>\n<p><strong>continue</strong></p>\n<p><strong>end</strong></p>\n<p><strong>数据开发-经典</strong></p>\n<p><strong>1.按姓氏笔画排序:</strong></p>\n<p>**\n**</p>\n<p>Select * From TableName Order By CustomerName Collate Chinese_PRC_Stroke_ci_as //从少到多</p>\n<p><strong>2.数据库加密:</strong></p>\n<p>select encrypt('原始密码')\nselect pwdencrypt('原始密码')\nselect pwdcompare('原始密码','加密后密码') = 1--相同；否则不相同 encrypt('原始密码')\nselect pwdencrypt('原始密码')\nselect pwdcompare('原始密码','加密后密码') = 1--相同；否则不相同</p>\n<p><strong>3.取回表中字段:</strong></p>\n<p>declare @list varchar(1000),\n@sql nvarchar(1000)\nselect @list=@list+','+<a href=\"http://b.name\" target=\"_blank\" rel=\"noopener noreferrer\">b.name</a> from sysobjects a,syscolumns b where <a href=\"http://a.id=b.id\" target=\"_blank\" rel=\"noopener noreferrer\">a.id=b.id</a> and a.name='表A'\nset @sql='select '+right(@list,len(@list)-1)+' from 表A'\nexec (@sql)</p>\n<p><strong>4.查看硬盘分区:</strong></p>\n<p><strong>EXEC master..xp_fixeddrives</strong></p>\n<p><strong>5.比较A,B表是否相等:</strong></p>\n<h1 id=\"if-select-checksum-agg-binary-checksum-from-a\" tabindex=\"-1\"> if (select checksum_agg(binary_checksum(*)) from A)</h1>\n<p>(select checksum_agg(binary_checksum(*)) from B)\nprint '相等'\nelse\nprint '不相等'</p>\n<p><strong>6.杀掉所有的事件探察器进程:</strong></p>\n<p>DECLARE hcforeach CURSOR GLOBAL FOR SELECT 'kill '+RTRIM(spid) FROM master.dbo.sysprocesses\nWHERE program_name IN('SQL profiler',N'SQL 事件探查器')\nEXEC sp_msforeach_worker '?'</p>\n<p><strong>7.<strong><strong>记录搜索</strong></strong>:</strong></p>\n<p>**\n**</p>\n<p><strong>开头到<strong><strong>N</strong></strong>条记录</strong>Select Top N * From 表</p>\n<p>-------------------------------\n**N<strong><strong>到</strong></strong>M<strong><strong>条记录</strong></strong>(<strong><strong>要有主索引</strong></strong>ID)\n**Select Top M-N * From 表 Where ID in (Select Top M ID From 表) Order by ID  Desc\n----------------------------------\n<strong>N****到结尾记录</strong>Select Top N * From 表 Order by ID Desc\n<strong>案例<strong><strong>例如1：一张表有一万多条记录，表的第一个字段 RecID 是自增长字段， 写一个SQL语句， 找出表的第</strong></strong>31<strong><strong>到第</strong></strong>40****个记录。</strong></p>\n<p>select top 10 recid from A where recid not in(select top 30 recid from A)</p>\n<p>分析：如果这样写会产生某些问题，如果recid在表中存在逻辑索引。</p>\n<p>select top 10 recid from A where……是从索引中查找，而后面的select top 30 recid from A则在数据表中查找，这样由于索引中的顺序有可能和数据表中的不一致，这样就导致查询到的不是本来的欲得到的数据。</p>\n<p><strong>解决方案</strong></p>\n<p>**1，**<strong>用order by</strong> select top 30 recid from A order by ricid <strong>如果该字段不是自增长，就会出现问题</strong></p>\n<p>**2，****在那个子查询中也加条件：**select top 30 recid from A where recid&gt;-1</p>\n<p><strong>例2</strong>**：查询表中的最后以条记录，并不知道这个表共有多少数据,**<strong>以及表结构。\nset @s = 'select top 1 * from T  where pid not in (select top ' + str(@count-1) + ' pid from T)'</strong></p>\n<p><strong>print @s   exec sp_executesql @s</strong></p>\n<p><strong>9：获取当前数据库中的所有用户表</strong></p>\n<p>**\n**</p>\n<p>select Name from sysobjects where xtype='u' and status&gt;=0</p>\n<p><strong>10：获取某一个表的所有字段</strong></p>\n<p>**\n**select name from syscolumns where id=object_id('表名')</p>\n<p>select name from syscolumns where id in (select id from sysobjects where type = 'u' and name = '表名')</p>\n<p>两种方式的效果相同</p>\n<p><strong>11：查看与某一个表相关的视图、存储过程、函数</strong></p>\n<p>select a.* from sysobjects a, syscomments b where <a href=\"http://a.id\" target=\"_blank\" rel=\"noopener noreferrer\">a.id</a> = <a href=\"http://b.id\" target=\"_blank\" rel=\"noopener noreferrer\">b.id</a> and b.text like '%表名%'</p>\n<p><strong>12：查看当前数据库中所有存储过程</strong></p>\n<p>**\n**select name as 存储过程名称 from sysobjects where xtype='P'</p>\n<p><strong>13：查询用户创建的所有数据库</strong></p>\n<p>select * from master..sysdatabases D where sid not in(select sid from master..syslogins where name='sa')\n或者\nselect dbid, name AS DB_NAME from master..sysdatabases where sid &lt;&gt; 0x01</p>\n<p><strong>14：查询某一个表的字段和数据类型</strong></p>\n<p>**\n**select column_name,data_type from information_schema.columns\nwhere table_name = '表名'</p>\n<p><strong>15</strong>**：不同服务器数据库之间的数据操作**</p>\n<p>**\n**</p>\n<div><pre><code><span>--创建链接服务器</span>\n\n<span>exec</span> sp_addlinkedserver <span>'ITSV '</span><span>,</span> <span>' '</span><span>,</span> <span>'SQLOLEDB '</span><span>,</span> <span>'远程服务器名或ip地址 '</span>\n\n<span>exec</span> sp_addlinkedsrvlogin <span>'ITSV '</span><span>,</span> <span>'false '</span><span>,</span><span>null</span><span>,</span> <span>'用户名 '</span><span>,</span> <span>'密码 '</span>\n\n<span>--查询示例</span>\n\n<span>select</span> <span>*</span> <span>from</span> ITSV<span>.</span>数据库名<span>.</span>dbo<span>.</span>表名\n\n<span>--导入示例</span>\n\n<span>select</span> <span>*</span> <span>into</span> 表 <span>from</span> ITSV<span>.</span>数据库名<span>.</span>dbo<span>.</span>表名\n\n<span>--以后不再使用时删除链接服务器</span>\n\n<span>exec</span> sp_dropserver <span>'ITSV '</span><span>,</span> <span>'droplogins '</span>\n\n<span>--连接远程/局域网数据(openrowset/openquery/opendatasource)</span>\n\n<span>--1、openrowset</span>\n\n<span>--查询示例</span>\n\n<span>select</span> <span>*</span> <span>from</span> <span>openrowset</span><span>(</span> <span>'SQLOLEDB '</span><span>,</span> <span>'sql服务器名 '</span><span>;</span> <span>'用户名 '</span><span>;</span> <span>'密码 '</span><span>,</span>数据库名<span>.</span>dbo<span>.</span>表名<span>)</span>\n\n<span>--生成本地表</span>\n\n<span>select</span> <span>*</span> <span>into</span> 表 <span>from</span> <span>openrowset</span><span>(</span> <span>'SQLOLEDB '</span><span>,</span> <span>'sql服务器名 '</span><span>;</span> <span>'用户名 '</span><span>;</span> <span>'密码 '</span><span>,</span>数据库名<span>.</span>dbo<span>.</span>表名<span>)</span>\n\n<span>--把本地表导入远程表</span>\n\n<span>insert</span> <span>openrowset</span><span>(</span> <span>'SQLOLEDB '</span><span>,</span> <span>'sql服务器名 '</span><span>;</span> <span>'用户名 '</span><span>;</span> <span>'密码 '</span><span>,</span>数据库名<span>.</span>dbo<span>.</span>表名<span>)</span>\n\n<span>select</span> <span>*</span><span>from</span> 本地表\n\n<span>--更新本地表</span>\n\n<span>update</span> b\n\n<span>set</span> b<span>.</span>列A<span>=</span>a<span>.</span>列A\n\n <span>from</span> <span>openrowset</span><span>(</span> <span>'SQLOLEDB '</span><span>,</span> <span>'sql服务器名 '</span><span>;</span> <span>'用户名 '</span><span>;</span> <span>'密码 '</span><span>,</span>数据库名<span>.</span>dbo<span>.</span>表名<span>)</span><span>as</span> a <span>inner</span> <span>join</span> 本地表 b\n\n<span>on</span> a<span>.</span>column1<span>=</span>b<span>.</span>column1\n\n<span>--openquery用法需要创建一个连接</span>\n\n<span>--首先创建一个连接创建链接服务器</span>\n\n<span>exec</span> sp_addlinkedserver <span>'ITSV '</span><span>,</span> <span>' '</span><span>,</span> <span>'SQLOLEDB '</span><span>,</span> <span>'远程服务器名或ip地址 '</span>\n\n<span>--查询</span>\n\n<span>select</span> <span>*</span> <span>FROM</span> <span>openquery</span><span>(</span>ITSV<span>,</span> <span>'SELECT * FROM 数据库.dbo.表名 '</span><span>)</span>\n\n<span>--把本地表导入远程表</span>\n\n<span>insert</span> <span>openquery</span><span>(</span>ITSV<span>,</span> <span>'SELECT * FROM 数据库.dbo.表名 '</span><span>)</span>\n\n<span>select</span> <span>*</span> <span>from</span> 本地表\n\n<span>--更新本地表</span>\n\n<span>update</span> b <span>set</span> b<span>.</span>列B<span>=</span>a<span>.</span>列B <span>FROM</span> <span>openquery</span><span>(</span>ITSV<span>,</span> <span>'SELECT * FROM 数据库.dbo.表名 '</span><span>)</span> <span>as</span> a <span>inner</span> <span>join</span> 本地表 b <span>on</span> a<span>.</span>列A<span>=</span>b<span>.</span>列A\n\n<span>--3、opendatasource/openrowset</span>\n\n<span>SELECT</span>   <span>*</span> <span>FROM</span>   <span>opendatasource</span><span>(</span> <span>'SQLOLEDB '</span><span>,</span> <span>'Data Source=ip/ServerName;User ID=登陆名;Password=密码 '</span> <span>)</span><span>.</span>test<span>.</span>dbo<span>.</span>roy_ta\n\n<span>--把本地表导入远程表</span>\n\n<span>insert</span> <span>opendatasource</span><span>(</span> <span>'SQLOLEDB '</span><span>,</span> <span>'Data Source=ip/ServerName;User ID=登陆名;Password=密码 '</span><span>)</span><span>.</span>数据库<span>.</span>dbo<span>.</span>表名\n\n<span>select</span> <span>*</span> <span>from</span> 本地表\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>SQL Server基本函数</strong></p>\n<p>SQL Server基本函数</p>\n<p><strong>1.字符串函数</strong> 长度与分析用</p>\n<p><strong>1,datalength</strong>(Char_expr) 返回字符串包含字符数,但不包含后面的空格</p>\n<p><strong>2,substring</strong>(expression,start,length) 取子串，字符串的下标是从“1”，start为起始位置，length为字符串长度，实际应用中以len(expression)取得其长度</p>\n<p><strong>3,right</strong>(char_expr,int_expr) 返回字符串右边第int_expr个字符，还用<strong>left</strong>于之相反**\n**</p>\n<p><strong>4,isnull(</strong> <em>check</em>**_**<em>expression</em> <strong>,</strong> <em>replacement_value</em> **)**如果check_expression為空，則返回replacement_value的值，不為空，就返回check_expression字符操作类</p>\n<p><strong>5,Sp_addtype</strong>自定義數據類型\n例如：<code>EXEC sp_addtype birthday, datetime, 'NULL'</code></p>\n<div><pre><code><span>6</span><span>,</span><span>set</span> nocount {<span>on</span><span>|</span><span>off</span>}\n使返回的结果中不包含有关受 Transact<span>-</span><span>SQL</span> 语句影响的行数的信息。如果存储过程中包含的一些语句并不返回许多实际的数据，则该设置由于大量减少了网络流量，因此可显著提高性能。<span>SET</span> NOCOUNT 设置是在执行或运行时设置，而不是在分析时设置。\n<span>SET</span> NOCOUNT 为 <span>ON</span> 时，不返回计数（表示受 Transact<span>-</span><span>SQL</span> 语句影响的行数）。\n<span>SET</span> NOCOUNT 为 <span>OFF</span> 时，返回计数\n常识\n \n在<span>SQL</span>查询中：<span>from</span>后最多可以跟多少张表或视图：<span>256</span>\n在<span>SQL</span>语句中出现 <span>Order</span> <span>by</span><span>,</span>查询时，先排序，后取\n在<span>SQL</span>中，一个字段的最大容量是<span>8000</span>，而对于nvarchar<span>(</span><span>4000</span><span>)</span><span>,</span>由于nvarchar是Unicode码。 \n       \nSQLServer2000同步复制技术实现步骤\n一、 预备工作\n<span>1.</span>发布服务器<span>,</span>订阅服务器都创建一个同名的windows用户<span>,</span>并设置相同的密码<span>,</span>做为发布快照文件夹的有效访问用户\n<span>--管理工具</span>\n<span>--计算机管理</span>\n<span>--用户和组</span>\n<span>--右键用户</span>\n<span>--新建用户</span>\n<span>--建立一个隶属于administrator组的登陆windows的用户（SynUser）</span>\n<span>2.</span>在发布服务器上<span>,</span>新建一个共享目录<span>,</span>做为发布的快照文件的存放目录<span>,</span>操作:\n我的电脑<span>--D:\\ 新建一个目录,名为: PUB</span>\n<span>--右键这个新建的目录</span>\n<span>--属性--共享</span>\n<span>--选择\"共享该文件夹\"</span>\n<span>--通过\"权限\"按纽来设置具体的用户权限,保证第一步中创建的用户(SynUser) 具有对该文件夹的所有权限</span>\n<span>--确定</span>\n<span>3.</span>设置<span>SQL</span>代理<span>(</span>SQLSERVERAGENT<span>)</span>服务的启动用户<span>(</span>发布<span>/</span>订阅服务器均做此设置<span>)</span>\n开始<span>--程序--管理工具--服务</span>\n<span>--右键SQLSERVERAGENT</span>\n<span>--属性--登陆--选择\"此账户\"</span>\n<span>--输入或者选择第一步中创建的windows登录用户名（SynUser）</span>\n<span>--\"密码\"中输入该用户的密码</span>\n<span>4.</span>设置<span>SQL</span> Server身份验证模式<span>,</span>解决连接时的权限问题<span>(</span>发布<span>/</span>订阅服务器均做此设置<span>)</span>\n企业管理器\n<span>--右键SQL实例--属性</span>\n<span>--安全性--身份验证</span>\n<span>--选择\"SQL Server 和 Windows\"</span>\n<span>--确定</span>\n<span>5.</span>在发布服务器和订阅服务器上互相注册\n企业管理器\n<span>--右键SQL Server组</span>\n<span>--新建SQL Server注册...</span>\n<span>--下一步--可用的服务器中,输入你要注册的远程服务器名 --添加</span>\n<span>--下一步--连接使用,选择第二个\"SQL Server身份验证\"</span>\n<span>--下一步--输入用户名和密码（SynUser）</span>\n<span>--下一步--选择SQL Server组,也可以创建一个新组</span>\n<span>--下一步--完成</span>\n<span>6.</span>对于只能用IP<span>,</span>不能用计算机名的<span>,</span>为其注册服务器别名（此步在实施中没用到）\n <span>(</span>在连接端配置<span>,</span>比如<span>,</span>在订阅服务器上配置的话<span>,</span>服务器名称中输入的是发布服务器的IP<span>)</span>\n开始<span>--程序--Microsoft SQL Server--客户端网络实用工具</span>\n<span>--别名--添加</span>\n<span>--网络库选择\"tcp/ip\"--服务器别名输入SQL服务器名</span>\n<span>--连接参数--服务器名称中输入SQL服务器ip地址</span>\n<span>--如果你修改了SQL的端口,取消选择\"动态决定端口\",并输入对应的端口号</span>\n二、 正式配置\n<span>1</span>、配置发布服务器\n打开企业管理器，在发布服务器（B、C、D）上执行以下步骤:\n<span>(</span><span>1</span><span>)</span> 从<span>[</span>工具<span>]</span>下拉菜单的<span>[</span>复制<span>]</span>子菜单中选择<span>[</span>配置发布、订阅服务器和分发<span>]</span>出现配置发布和分发向导\n<span>(</span><span>2</span><span>)</span> <span>[</span>下一步<span>]</span> 选择分发服务器 可以选择把发布服务器自己作为分发服务器或者其他<span>sql</span>的服务器（选择自己）\n<span>(</span><span>3</span><span>)</span> <span>[</span>下一步<span>]</span> 设置快照文件夹\n采用默认\\\\servername\\Pub\n<span>(</span><span>4</span><span>)</span> <span>[</span>下一步<span>]</span> 自定义配置\n可以选择:是<span>,</span>让我设置分发数据库属性启用发布服务器或设置发布设置\n否<span>,</span>使用下列默认设置（推荐）\n<span>(</span><span>5</span><span>)</span> <span>[</span>下一步<span>]</span> 设置分发数据库名称和位置 采用默认值\n<span>(</span><span>6</span><span>)</span> <span>[</span>下一步<span>]</span> 启用发布服务器 选择作为发布的服务器\n<span>(</span><span>7</span><span>)</span> <span>[</span>下一步<span>]</span> 选择需要发布的数据库和发布类型\n<span>(</span><span>8</span><span>)</span> <span>[</span>下一步<span>]</span> 选择注册订阅服务器\n<span>(</span><span>9</span><span>)</span> <span>[</span>下一步<span>]</span> 完成配置\n<span>2</span>、创建出版物\n发布服务器B、C、D上\n<span>(</span><span>1</span><span>)</span>从<span>[</span>工具<span>]</span>菜单的<span>[</span>复制<span>]</span>子菜单中选择<span>[</span>创建和管理发布<span>]</span>命令\n<span>(</span><span>2</span><span>)</span>选择要创建出版物的数据库，然后单击<span>[</span>创建发布<span>]</span>\n<span>(</span><span>3</span><span>)</span>在<span>[</span>创建发布向导<span>]</span>的提示对话框中单击<span>[</span>下一步<span>]</span>系统就会弹出一个对话框。对话框上的内容是复制的三个类型。我们现在选第一个也就是默认的快照发布<span>(</span>其他两个大家可以去看看帮助<span>)</span>\n<span>(</span><span>4</span><span>)</span>单击<span>[</span>下一步<span>]</span>系统要求指定可以订阅该发布的数据库服务器类型<span>,</span>\nSQLSERVER允许在不同的数据库如 orACLE或ACCESS之间进行数据复制。\n但是在这里我们选择运行<span>\"SQL SERVER 2000\"</span>的数据库服务器\n<span>(</span><span>5</span><span>)</span>单击<span>[</span>下一步<span>]</span>系统就弹出一个定义文章的对话框也就是选择要出版的表\n注意: 如果前面选择了事务发布 则再这一步中只能选择带有主键的表\n<span>(</span><span>6</span><span>)</span>选择发布名称和描述\n<span>(</span><span>7</span><span>)</span>自定义发布属性 向导提供的选择:\n是 我将自定义数据筛选<span>,</span>启用匿名订阅和或其他自定义属性\n否 根据指定方式创建发布 （建议采用自定义的方式）\n<span>(</span><span>8</span><span>)</span><span>[</span>下一步<span>]</span> 选择筛选发布的方式\n<span>(</span><span>9</span><span>)</span><span>[</span>下一步<span>]</span> 可以选择是否允许匿名订阅\n<span>1</span><span>)</span>如果选择署名订阅<span>,</span>则需要在发布服务器上添加订阅服务器\n方法: <span>[</span>工具<span>]</span><span>-</span><span>></span><span>[</span>复制<span>]</span><span>-</span><span>></span><span>[</span>配置发布、订阅服务器和分发的属性<span>]</span><span>-</span><span>></span><span>[</span>订阅服务器<span>]</span> 中添加\n否则在订阅服务器上请求订阅时会出现的提示:改发布不允许匿名订阅\n如果仍然需要匿名订阅则用以下解决办法\n<span>[</span>企业管理器<span>]</span><span>-</span><span>></span><span>[</span>复制<span>]</span><span>-</span><span>></span><span>[</span>发布内容<span>]</span><span>-</span><span>></span><span>[</span>属性<span>]</span><span>-</span><span>></span><span>[</span>订阅选项<span>]</span> 选择允许匿名请求订阅\n<span>2</span><span>)</span>如果选择匿名订阅<span>,</span>则配置订阅服务器时不会出现以上提示\n<span>(</span><span>10</span><span>)</span><span>[</span>下一步<span>]</span> 设置快照 代理程序调度\n<span>(</span><span>11</span><span>)</span><span>[</span>下一步<span>]</span> 完成配置\n当完成出版物的创建后创建出版物的数据库也就变成了一个共享数据库\n有数据\nsrv1<span>.</span>库名<span>.</span><span>.</span>author有字段:id<span>,</span>name<span>,</span>phone<span>,</span>\nsrv2<span>.</span>库名<span>.</span><span>.</span>author有字段:id<span>,</span>name<span>,</span>telphone<span>,</span>adress\n \n要求：\nsrv1<span>.</span>库名<span>.</span><span>.</span>author增加记录则srv1<span>.</span>库名<span>.</span><span>.</span>author记录增加\nsrv1<span>.</span>库名<span>.</span><span>.</span>author的phone字段更新，则srv1<span>.</span>库名<span>.</span><span>.</span>author对应字段telphone更新\n<span>--*/</span>\n \n<span>--大致的处理步骤</span>\n<span>--1.在 srv1 上创建连接服务器,以便在 srv1 中操作 srv2,实现同步</span>\n<span>exec</span> sp_addlinkedserver <span>'srv2'</span><span>,</span><span>''</span><span>,</span><span>'SQLOLEDB'</span><span>,</span><span>'srv2的sql实例名或ip'</span>\n<span>exec</span> sp_addlinkedsrvlogin <span>'srv2'</span><span>,</span><span>'false'</span><span>,</span><span>null</span><span>,</span><span>'用户名'</span><span>,</span><span>'密码'</span>\ngo\n<span>--2.在 srv1 和 srv2 这两台电脑中,启动 msdtc(分布式事务处理服务),并且设置为自动启动</span>\n。我的电脑<span>--控制面板--管理工具--服务--右键 Distributed Transaction Coordinator--属性--启动--并将启动类型设置为自动启动</span>\ngo\n  \n<span>--然后创建一个作业定时调用上面的同步处理存储过程就行了</span>\n \n企业管理器\n<span>--管理</span>\n<span>--SQL Server代理</span>\n<span>--右键作业</span>\n<span>--新建作业</span>\n<span>--\"常规\"项中输入作业名称</span>\n<span>--\"步骤\"项</span>\n<span>--新建</span>\n<span>--\"步骤名\"中输入步骤名</span>\n<span>--\"类型\"中选择\"Transact-SQL 脚本(TSQL)\"</span>\n<span>--\"数据库\"选择执行命令的数据库</span>\n<span>--\"命令\"中输入要执行的语句: exec p_process</span>\n<span>--确定</span>\n<span>--\"调度\"项</span>\n<span>--新建调度</span>\n<span>--\"名称\"中输入调度名称</span>\n<span>--\"调度类型\"中选择你的作业执行安排</span>\n<span>--如果选择\"反复出现\"</span>\n<span>--点\"更改\"来设置你的时间安排</span>\n \n然后将<span>SQL</span> Agent服务启动<span>,</span>并设置为自动启动<span>,</span>否则你的作业不会被执行\n \n设置方法:\n我的电脑<span>--控制面板--管理工具--服务--右键 SQLSERVERAGENT--属性--启动类型--选择\"自动启动\"--确定. </span>\n<span>--3.实现同步处理的方法2,定时同步</span>\n<span>--在srv1中创建如下的同步处理存储过程</span>\n<span>create</span> <span>proc</span> p_process <span>as</span>\n\n<span>--更新修改过的数据</span>\n\n<span>update</span> b <span>set</span> name<span>=</span>i<span>.</span>name<span>,</span>telphone<span>=</span>i<span>.</span>telphone\n\n<span>from</span> srv2<span>.</span>库名<span>.</span>dbo<span>.</span>author b<span>,</span>author i\n\n<span>where</span> b<span>.</span>id<span>=</span>i<span>.</span>id <span>and</span>\n\n<span>(</span>b<span>.</span>name <span>&lt;></span> i<span>.</span>name <span>or</span> b<span>.</span>telphone <span>&lt;></span> i<span>.</span>telphone<span>)</span>\n\n<span>--插入新增的数据</span>\n\n<span>insert</span> srv2<span>.</span>库名<span>.</span>dbo<span>.</span>author<span>(</span>id<span>,</span>name<span>,</span>telphone<span>)</span>\n\n<span>select</span> id<span>,</span>name<span>,</span>telphone <span>from</span> author i\n\n<span>where</span> <span>not</span> <span>exists</span><span>(</span>\n\n<span>select</span> <span>*</span> <span>from</span> srv2<span>.</span>库名<span>.</span>dbo<span>.</span>author <span>where</span> id<span>=</span>i<span>.</span>id<span>)</span>\n\n\n<span>--删除已经删除的数据(如果需要的话)</span>\n\n<span>delete</span> b\n\n<span>from</span> srv2<span>.</span>库名<span>.</span>dbo<span>.</span>author b\n\n<span>where</span> <span>not</span> <span>exists</span><span>(</span><span>select</span> <span>*</span> <span>from</span> author <span>where</span> id<span>=</span>b<span>.</span>id<span>)</span>\n\ngo\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "date_published": "2022-07-07T00:00:00.000Z",
      "date_modified": "2022-06-30T03:46:10.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "SpringBoot 接口数据加解密实战",
      "url": "https://blog.ciberviler.top/dev/SpringBoot%E6%8E%A5%E5%8F%A3%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%A7%A3%E5%AF%86%E5%AE%9E%E6%88%98.html",
      "id": "https://blog.ciberviler.top/dev/SpringBoot%E6%8E%A5%E5%8F%A3%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%A7%A3%E5%AF%86%E5%AE%9E%E6%88%98.html",
      "content_html": "<h1 id=\"springboot-接口数据加解密实战\" tabindex=\"-1\"> SpringBoot 接口数据加解密实战</h1>\n<p>需求解析：</p>\n<ol>\n<li>服务端、客户端和H5统一拦截加解密，网上有成熟方案，也可以按其他服务中实现的加解密流程来搞；</li>\n<li>使用AES放松加密，考虑到H5端存储密钥安全性相对来说会低一些，故分针对H5和安卓、IOS分配两套密钥；</li>\n<li>本次涉及客户端和服务端的整体改造，经讨论，新接口统一加 /secret/ 前缀来区分</li>\n</ol>\n<p>按本次需求来简单还原问题，定义两个对象，后面用得着，</p>\n<p>用户类：</p>\n<div><pre><code><span>@Data</span>\n<span>public</span> <span>class</span> <span>User</span> <span>{</span>\n    <span>private</span> <span>Integer</span> id<span>;</span>\n    <span>private</span> <span>String</span> name<span>;</span>\n    <span>private</span> <span>UserType</span> userType <span>=</span> <span>UserType</span><span>.</span>COMMON<span>;</span>\n    <span>@JsonFormat</span><span>(</span>pattern <span>=</span> <span>\"yyyy-MM-dd HH:mm:ss\"</span><span>)</span>\n    <span>private</span> <span>LocalDateTime</span> registerTime<span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>用户类型枚举类：</p>\n<div><pre><code><span>@Getter</span>\n<span>@JsonFormat</span><span>(</span>shape <span>=</span> <span>JsonFormat<span>.</span>Shape</span><span>.</span>OBJECT<span>)</span>\n<span>public</span> <span>enum</span> <span>UserType</span> <span>{</span>\n    <span>VIP</span><span>(</span><span>\"VIP用户\"</span><span>)</span><span>,</span>\n    <span>COMMON</span><span>(</span><span>\"普通用户\"</span><span>)</span><span>;</span>\n    <span>private</span> <span>String</span> code<span>;</span>\n    <span>private</span> <span>String</span> type<span>;</span>\n\n    <span>UserType</span><span>(</span><span>String</span> type<span>)</span> <span>{</span>\n        <span>this</span><span>.</span>code <span>=</span> <span>name</span><span>(</span><span>)</span><span>;</span>\n        <span>this</span><span>.</span>type <span>=</span> type<span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>构造一个简单的用户列表查询示例：</p>\n<div><pre><code><span>@RestController</span>\n<span>@RequestMapping</span><span>(</span>value <span>=</span> <span>{</span><span>\"/user\"</span><span>,</span> <span>\"/secret/user\"</span><span>}</span><span>)</span>\n<span>public</span> <span>class</span> <span>UserController</span> <span>{</span>\n    <span>@RequestMapping</span><span>(</span><span>\"/list\"</span><span>)</span>\n    <span>ResponseEntity</span><span><span>&lt;</span><span>List</span><span>&lt;</span><span>User</span><span>></span><span>></span></span> <span>listUser</span><span>(</span><span>)</span> <span>{</span>\n        <span>List</span><span><span>&lt;</span><span>User</span><span>></span></span> users <span>=</span> <span>new</span> <span>ArrayList</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        <span>User</span> u <span>=</span> <span>new</span> <span>User</span><span>(</span><span>)</span><span>;</span>\n        u<span>.</span><span>setId</span><span>(</span><span>1</span><span>)</span><span>;</span>\n        u<span>.</span><span>setName</span><span>(</span><span>\"boyka\"</span><span>)</span><span>;</span>\n        u<span>.</span><span>setRegisterTime</span><span>(</span><span>LocalDateTime</span><span>.</span><span>now</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        u<span>.</span><span>setUserType</span><span>(</span><span>UserType</span><span>.</span>COMMON<span>)</span><span>;</span>\n        users<span>.</span><span>add</span><span>(</span>u<span>)</span><span>;</span>\n        <span>ResponseEntity</span><span><span>&lt;</span><span>List</span><span>&lt;</span><span>User</span><span>></span><span>></span></span> response <span>=</span> <span>new</span> <span>ResponseEntity</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        response<span>.</span><span>setCode</span><span>(</span><span>200</span><span>)</span><span>;</span>\n        response<span>.</span><span>setData</span><span>(</span>users<span>)</span><span>;</span>\n        response<span>.</span><span>setMsg</span><span>(</span><span>\"用户列表查询成功\"</span><span>)</span><span>;</span>\n        <span>return</span> response<span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>调用：localhost:8080/user/list</p>\n<p>查询结果如下，没毛病：</p>\n<div><pre><code><span>{</span>\n\t<span>\"code\"</span><span>:</span> <span>200</span><span>,</span>\n\t<span>\"data\"</span><span>:</span> <span>[</span><span>{</span>\n\t\t<span>\"id\"</span><span>:</span> <span>1</span><span>,</span>\n\t\t<span>\"name\"</span><span>:</span> <span>\"boyka\"</span><span>,</span>\n\t\t<span>\"userType\"</span><span>:</span> <span>{</span>\n\t\t\t<span>\"code\"</span><span>:</span> <span>\"COMMON\"</span><span>,</span>\n\t\t\t<span>\"type\"</span><span>:</span> <span>\"普通用户\"</span>\n\t\t<span>}</span><span>,</span>\n\t\t<span>\"registerTime\"</span><span>:</span> <span>\"2022-03-24 23:58:39\"</span>\n\t<span>}</span><span>]</span><span>,</span>\n\t<span>\"msg\"</span><span>:</span> <span>\"用户列表查询成功\"</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>目前主要是利用ControllerAdvice来对请求和响应体进行拦截，主要定义SecretRequestAdvice对请求进行加密和SecretResponseAdvice对响应进行加密(实际情况会稍微复杂一点，项目中又GET类型请求，自定义了一个Filter进行不同的请求解密处理)。</p>\n<p>好了，网上的ControllerAdvice使用示例非常多，我这把两个核心方法给大家展示看看，相信大佬们一看就晓得了，不需多言。上代码：</p>\n<p>SecretRequestAdvice请求解密：</p>\n<div><pre><code><span>/**\n * <span>@description</span>:\n * <span>@author</span>: boykaff\n * <span>@date</span>: 2022-03-25-0025\n */</span>\n<span>@ControllerAdvice</span>\n<span>@Order</span><span>(</span><span>Ordered</span><span>.</span>HIGHEST_PRECEDENCE<span>)</span>\n<span>@Slf4j</span>\n<span>public</span> <span>class</span> <span>SecretRequestAdvice</span> <span>extends</span> <span>RequestBodyAdviceAdapter</span> <span>{</span>\n    <span>@Override</span>\n    <span>public</span> <span>boolean</span> <span>supports</span><span>(</span><span>MethodParameter</span> methodParameter<span>,</span> <span>Type</span> type<span>,</span> <span>Class</span><span><span>&lt;</span><span>?</span> <span>extends</span> <span>HttpMessageConverter</span><span>&lt;</span><span>?</span><span>></span><span>></span></span> aClass<span>)</span> <span>{</span>\n        <span>return</span> <span>true</span><span>;</span>\n    <span>}</span>\n\n    <span>@Override</span>\n    <span>public</span> <span>HttpInputMessage</span> <span>beforeBodyRead</span><span>(</span><span>HttpInputMessage</span> inputMessage<span>,</span> <span>MethodParameter</span> parameter<span>,</span> <span>Type</span> targetType<span>,</span> <span>Class</span><span><span>&lt;</span><span>?</span> <span>extends</span> <span>HttpMessageConverter</span><span>&lt;</span><span>?</span><span>></span><span>></span></span> converterType<span>)</span> <span>throws</span> <span>IOException</span> <span>{</span>\n        <span>//如果支持加密消息，进行消息解密。</span>\n        <span>String</span> httpBody<span>;</span>\n        <span>if</span> <span>(</span><span>Boolean</span><span>.</span>TRUE<span>.</span><span>equals</span><span>(</span><span>SecretFilter</span><span>.</span>secretThreadLocal<span>.</span><span>get</span><span>(</span><span>)</span><span>)</span><span>)</span> <span>{</span>\n            httpBody <span>=</span> <span>decryptBody</span><span>(</span>inputMessage<span>)</span><span>;</span>\n        <span>}</span> <span>else</span> <span>{</span>\n            httpBody <span>=</span> <span>StreamUtils</span><span>.</span><span>copyToString</span><span>(</span>inputMessage<span>.</span><span>getBody</span><span>(</span><span>)</span><span>,</span> <span>Charset</span><span>.</span><span>defaultCharset</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>}</span>\n        <span>//返回处理后的消息体给messageConvert</span>\n        <span>return</span> <span>new</span> <span>SecretHttpMessage</span><span>(</span><span>new</span> <span>ByteArrayInputStream</span><span>(</span>httpBody<span>.</span><span>getBytes</span><span>(</span><span>)</span><span>)</span><span>,</span> inputMessage<span>.</span><span>getHeaders</span><span>(</span><span>)</span><span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>/**\n     * 解密消息体\n     *\n     * <span>@param</span> <span>inputMessage</span> 消息体\n     * <span>@return</span> 明文\n     */</span>\n    <span>private</span> <span>String</span> <span>decryptBody</span><span>(</span><span>HttpInputMessage</span> inputMessage<span>)</span> <span>throws</span> <span>IOException</span> <span>{</span>\n        <span>InputStream</span> encryptStream <span>=</span> inputMessage<span>.</span><span>getBody</span><span>(</span><span>)</span><span>;</span>\n        <span>String</span> requestBody <span>=</span> <span>StreamUtils</span><span>.</span><span>copyToString</span><span>(</span>encryptStream<span>,</span> <span>Charset</span><span>.</span><span>defaultCharset</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>// 验签过程</span>\n        <span>HttpHeaders</span> headers <span>=</span> inputMessage<span>.</span><span>getHeaders</span><span>(</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span><span>CollectionUtils</span><span>.</span><span>isEmpty</span><span>(</span>headers<span>.</span><span>get</span><span>(</span><span>\"clientType\"</span><span>)</span><span>)</span>\n                <span>||</span> <span>CollectionUtils</span><span>.</span><span>isEmpty</span><span>(</span>headers<span>.</span><span>get</span><span>(</span><span>\"timestamp\"</span><span>)</span><span>)</span>\n                <span>||</span> <span>CollectionUtils</span><span>.</span><span>isEmpty</span><span>(</span>headers<span>.</span><span>get</span><span>(</span><span>\"salt\"</span><span>)</span><span>)</span>\n                <span>||</span> <span>CollectionUtils</span><span>.</span><span>isEmpty</span><span>(</span>headers<span>.</span><span>get</span><span>(</span><span>\"signature\"</span><span>)</span><span>)</span><span>)</span> <span>{</span>\n            <span>throw</span> <span>new</span> <span>ResultException</span><span>(</span>SECRET_API_ERROR<span>,</span> <span>\"请求解密参数错误，clientType、timestamp、salt、signature等参数传递是否正确传递\"</span><span>)</span><span>;</span>\n        <span>}</span>\n\n        <span>String</span> timestamp <span>=</span> <span>String</span><span>.</span><span>valueOf</span><span>(</span><span>Objects</span><span>.</span><span>requireNonNull</span><span>(</span>headers<span>.</span><span>get</span><span>(</span><span>\"timestamp\"</span><span>)</span><span>)</span><span>.</span><span>get</span><span>(</span><span>0</span><span>)</span><span>)</span><span>;</span>\n        <span>String</span> salt <span>=</span> <span>String</span><span>.</span><span>valueOf</span><span>(</span><span>Objects</span><span>.</span><span>requireNonNull</span><span>(</span>headers<span>.</span><span>get</span><span>(</span><span>\"salt\"</span><span>)</span><span>)</span><span>.</span><span>get</span><span>(</span><span>0</span><span>)</span><span>)</span><span>;</span>\n        <span>String</span> signature <span>=</span> <span>String</span><span>.</span><span>valueOf</span><span>(</span><span>Objects</span><span>.</span><span>requireNonNull</span><span>(</span>headers<span>.</span><span>get</span><span>(</span><span>\"signature\"</span><span>)</span><span>)</span><span>.</span><span>get</span><span>(</span><span>0</span><span>)</span><span>)</span><span>;</span>\n        <span>String</span> privateKey <span>=</span> <span>SecretFilter</span><span>.</span>clientPrivateKeyThreadLocal<span>.</span><span>get</span><span>(</span><span>)</span><span>;</span>\n        <span>ReqSecret</span> reqSecret <span>=</span> JSON<span>.</span><span>parseObject</span><span>(</span>requestBody<span>,</span> <span>ReqSecret</span><span>.</span><span>class</span><span>)</span><span>;</span>\n        <span>String</span> data <span>=</span> reqSecret<span>.</span><span>getData</span><span>(</span><span>)</span><span>;</span>\n        <span>String</span> newSignature <span>=</span> <span>\"\"</span><span>;</span>\n        <span>if</span> <span>(</span><span>!</span><span>StringUtils</span><span>.</span><span>isEmpty</span><span>(</span>privateKey<span>)</span><span>)</span> <span>{</span>\n            newSignature <span>=</span> <span>Md5Utils</span><span>.</span><span>genSignature</span><span>(</span>timestamp <span>+</span> salt <span>+</span> data <span>+</span> privateKey<span>)</span><span>;</span>\n        <span>}</span>\n        <span>if</span> <span>(</span><span>!</span>newSignature<span>.</span><span>equals</span><span>(</span>signature<span>)</span><span>)</span> <span>{</span>\n            <span>// 验签失败</span>\n            <span>throw</span> <span>new</span> <span>ResultException</span><span>(</span>SECRET_API_ERROR<span>,</span> <span>\"验签失败，请确认加密方式是否正确\"</span><span>)</span><span>;</span>\n        <span>}</span>\n\n        <span>try</span> <span>{</span>\n            <span>String</span> decrypt <span>=</span> <span>EncryptUtils</span><span>.</span><span>aesDecrypt</span><span>(</span>data<span>,</span> privateKey<span>)</span><span>;</span>\n            <span>if</span> <span>(</span><span>StringUtils</span><span>.</span><span>isEmpty</span><span>(</span>decrypt<span>)</span><span>)</span> <span>{</span>\n                decrypt <span>=</span> <span>\"{}\"</span><span>;</span>\n            <span>}</span>\n            <span>return</span> decrypt<span>;</span>\n        <span>}</span> <span>catch</span> <span>(</span><span>Exception</span> e<span>)</span> <span>{</span>\n            log<span>.</span><span>error</span><span>(</span><span>\"error: \"</span><span>,</span> e<span>)</span><span>;</span>\n        <span>}</span>\n        <span>throw</span> <span>new</span> <span>ResultException</span><span>(</span>SECRET_API_ERROR<span>,</span> <span>\"解密失败\"</span><span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>SecretResponseAdvice响应加密：</p>\n<div><pre><code><span>@ControllerAdvice</span>\n<span>public</span> <span>class</span> <span>SecretResponseAdvice</span> <span>implements</span> <span>ResponseBodyAdvice</span> <span>{</span>\n    <span>private</span> <span>Logger</span> logger <span>=</span> <span>LoggerFactory</span><span>.</span><span>getLogger</span><span>(</span><span>SecretResponseAdvice</span><span>.</span><span>class</span><span>)</span><span>;</span>\n\n    <span>@Override</span>\n    <span>public</span> <span>boolean</span> <span>supports</span><span>(</span><span>MethodParameter</span> methodParameter<span>,</span> <span>Class</span> aClass<span>)</span> <span>{</span>\n        <span>return</span> <span>true</span><span>;</span>\n    <span>}</span>\n\n    <span>@Override</span>\n    <span>public</span> <span>Object</span> <span>beforeBodyWrite</span><span>(</span><span>Object</span> o<span>,</span> <span>MethodParameter</span> methodParameter<span>,</span> <span>MediaType</span> mediaType<span>,</span> <span>Class</span> aClass<span>,</span> <span>ServerHttpRequest</span> serverHttpRequest<span>,</span> <span>ServerHttpResponse</span> serverHttpResponse<span>)</span> <span>{</span>\n        <span>// 判断是否需要加密</span>\n        <span>Boolean</span> respSecret <span>=</span> <span>SecretFilter</span><span>.</span>secretThreadLocal<span>.</span><span>get</span><span>(</span><span>)</span><span>;</span>\n        <span>String</span> secretKey <span>=</span> <span>SecretFilter</span><span>.</span>clientPrivateKeyThreadLocal<span>.</span><span>get</span><span>(</span><span>)</span><span>;</span>\n        <span>// 清理本地缓存</span>\n        <span>SecretFilter</span><span>.</span>secretThreadLocal<span>.</span><span>remove</span><span>(</span><span>)</span><span>;</span>\n        <span>SecretFilter</span><span>.</span>clientPrivateKeyThreadLocal<span>.</span><span>remove</span><span>(</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span><span>null</span> <span>!=</span> respSecret <span>&amp;&amp;</span> respSecret<span>)</span> <span>{</span>\n            <span>if</span> <span>(</span>o <span>instanceof</span> <span>ResponseBasic</span><span>)</span> <span>{</span>\n                <span>// 外层加密级异常</span>\n                <span>if</span> <span>(</span>SECRET_API_ERROR <span>==</span> <span>(</span><span>(</span><span>ResponseBasic</span><span>)</span> o<span>)</span><span>.</span><span>getCode</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n                    <span>return</span> <span>SecretResponseBasic</span><span>.</span><span>fail</span><span>(</span><span>(</span><span>(</span><span>ResponseBasic</span><span>)</span> o<span>)</span><span>.</span><span>getCode</span><span>(</span><span>)</span><span>,</span> <span>(</span><span>(</span><span>ResponseBasic</span><span>)</span> o<span>)</span><span>.</span><span>getData</span><span>(</span><span>)</span><span>,</span> <span>(</span><span>(</span><span>ResponseBasic</span><span>)</span> o<span>)</span><span>.</span><span>getMsg</span><span>(</span><span>)</span><span>)</span><span>;</span>\n                <span>}</span>\n                <span>// 业务逻辑</span>\n                <span>try</span> <span>{</span>\n                    <span>String</span> data <span>=</span> <span>EncryptUtils</span><span>.</span><span>aesEncrypt</span><span>(</span>JSON<span>.</span><span>toJSONString</span><span>(</span>o<span>)</span><span>,</span> secretKey<span>)</span><span>;</span>\n                    <span>// 增加签名</span>\n                    <span>long</span> timestamp <span>=</span> <span>System</span><span>.</span><span>currentTimeMillis</span><span>(</span><span>)</span> <span>/</span> <span>1000</span><span>;</span>\n                    <span>int</span> salt <span>=</span> <span>EncryptUtils</span><span>.</span><span>genSalt</span><span>(</span><span>)</span><span>;</span>\n                    <span>String</span> dataNew <span>=</span> timestamp <span>+</span> <span>\"\"</span> <span>+</span> salt <span>+</span> <span>\"\"</span> <span>+</span> data <span>+</span> secretKey<span>;</span>\n                    <span>String</span> newSignature <span>=</span> <span>Md5Utils</span><span>.</span><span>genSignature</span><span>(</span>dataNew<span>)</span><span>;</span>\n                    <span>return</span> <span>SecretResponseBasic</span><span>.</span><span>success</span><span>(</span>data<span>,</span> timestamp<span>,</span> salt<span>,</span> newSignature<span>)</span><span>;</span>\n                <span>}</span> <span>catch</span> <span>(</span><span>Exception</span> e<span>)</span> <span>{</span>\n                    logger<span>.</span><span>error</span><span>(</span><span>\"beforeBodyWrite error:\"</span><span>,</span> e<span>)</span><span>;</span>\n                    <span>return</span> <span>SecretResponseBasic</span><span>.</span><span>fail</span><span>(</span>SECRET_API_ERROR<span>,</span> <span>\"\"</span><span>,</span> <span>\"服务端处理结果数据异常\"</span><span>)</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n        <span>}</span>\n        <span>return</span> o<span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>OK， 代码Demo撸好了，试运行一波：</p>\n<div><pre><code>请求方法：\nlocalhost<span>:</span><span>8080</span>/secret/user/list\n\nheader<span>:</span>\nContent-Type<span>:</span>application/json\nsignature<span>:</span>55efb04a83ca083dd1e6003cde127c45\ntimestamp<span>:</span><span>1648308048</span>\nsalt<span>:</span><span>123456</span>\nclientType<span>:</span>ANDORID\n\nbody体<span>:</span>\n<span>// 原始请求体</span>\n<span>{</span>\n\t<span>\"page\"</span><span>:</span> <span>1</span><span>,</span>\n\t<span>\"size\"</span><span>:</span> <span>10</span>\n<span>}</span>\n<span>// 加密后的请求体</span>\n<span>{</span>\n\t<span>\"data\"</span><span>:</span> <span>\"1ZBecdnDuMocxAiW9UtBrJzlvVbueP9K0MsIxQccmU3OPG92oRinVm0GxBwdlXXJ\"</span>\n<span>}</span>\n\n<span>// 加密响应体：</span>\n<span>{</span>\n    <span>\"data\"</span><span>:</span> <span>\"fxHYvnIE54eAXDbErdrDryEsIYNvsOOkyEKYB1iBcre/QU1wMowHE2BNX/je6OP3NlsCtAeDqcp7J1N332el8q2FokixLvdxAPyW5Un9JiT0LQ3MB8p+nN23pTSIvh9VS92lCA8KULWg2nViSFL5X1VwKrF0K/dcVVZnpw5h227UywP6ezSHjHdA+Q0eKZFGTEv3IzNXWqq/otx5fl1gKQ==\"</span><span>,</span>\n    <span>\"code\"</span><span>:</span> <span>200</span><span>,</span>\n    <span>\"signature\"</span><span>:</span> <span>\"aa61f19da0eb5d99f13c145a40a7746b\"</span><span>,</span>\n    <span>\"msg\"</span><span>:</span> <span>\"\"</span><span>,</span>\n    <span>\"timestamp\"</span><span>:</span> <span>1648480034</span><span>,</span>\n    <span>\"salt\"</span><span>:</span> <span>632648</span>\n<span>}</span>\n\n<span>// 解密后的响应体：</span>\n<span>{</span>\n\t<span>\"code\"</span><span>:</span> <span>200</span><span>,</span>\n\t<span>\"data\"</span><span>:</span> <span>[</span><span>{</span>\n\t\t<span>\"id\"</span><span>:</span> <span>1</span><span>,</span>\n\t\t<span>\"name\"</span><span>:</span> <span>\"boyka\"</span><span>,</span>\n\t\t<span>\"registerTime\"</span><span>:</span> <span>\"2022-03-27T00:19:43.699\"</span><span>,</span>\n\t\t<span>\"userType\"</span><span>:</span> <span>\"COMMON\"</span>\n\t<span>}</span><span>]</span><span>,</span>\n\t<span>\"msg\"</span><span>:</span> <span>\"用户列表查询成功\"</span><span>,</span>\n\t<span>\"salt\"</span><span>:</span> <span>0</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>OK，客户端请求加密-》发起请求-》服务端解密-》业务处理-》服务端响应加密-》客户端解密展示，看起来没啥问题，实际是头天下午花了2小时碰需求，差不多花1小时写好demo测试，然后对所有接口统一进行了处理，整体一下午赶脚应该行了吧，告诉H5和安卓端同学明儿上午联调（不小的大家到这个时候发现猫腻没有，当时确实疏忽了，翻了大车......）</p>\n<p>次日，安卓端反馈，你这个加解密有问题，解密后的数据格式和之前不一样，仔细一看，擦，这个userType和registerTime是不对劲，开始思考：这个能是哪儿的问题呢？1s之后，初步定位，应该是响应体的JSON.toJSONString的问题：</p>\n<div><pre><code>String data = EncryptUtils.aesEncrypt(JSON.toJSONString(o)),\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>Debug断点调试，果然，是JSON.toJSONString(o)这一步骤转换出了问题，那JSON转换时是不是有高级属性可以配置生成想要的序列化格式呢？FastJson在序列化时提供重载方法，找到其中一个&quot;SerializerFeature&quot;参数可以琢磨一下，这个参数是可以对序列化进行配置的，它提供了很多配置类型，其中感觉这几个比较沾边：</p>\n<div><pre><code>WriteEnumUsingToString,\nWriteEnumUsingName,\nUseISO8601DateFormat\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>对枚举类型来说，默认是使用的WriteEnumUsingName(枚举的Name)， 另一种WriteEnumUsingToString是重新toString方法，理论上可以转换成想要的样子，即这个样子：</p>\n<div><pre><code><span>@Getter</span>\n<span>@JsonFormat</span><span>(</span>shape <span>=</span> <span>JsonFormat<span>.</span>Shape</span><span>.</span>OBJECT<span>)</span>\n<span>public</span> <span>enum</span> <span>UserType</span> <span>{</span>\n    <span>VIP</span><span>(</span><span>\"VIP用户\"</span><span>)</span><span>,</span>\n    <span>COMMON</span><span>(</span><span>\"普通用户\"</span><span>)</span><span>;</span>\n    <span>private</span> <span>String</span> code<span>;</span>\n    <span>private</span> <span>String</span> type<span>;</span>\n\n    <span>UserType</span><span>(</span><span>String</span> type<span>)</span> <span>{</span>\n        <span>this</span><span>.</span>code <span>=</span> <span>name</span><span>(</span><span>)</span><span>;</span>\n        <span>this</span><span>.</span>type <span>=</span> type<span>;</span>\n    <span>}</span>\n\n    <span>@Override</span>\n    <span>public</span> <span>String</span> <span>toString</span><span>(</span><span>)</span> <span>{</span>\n        <span>return</span> <span>\"{\"</span> <span>+</span>\n                <span>\"\\\"code\\\":\\\"\"</span> <span>+</span> <span>name</span><span>(</span><span>)</span> <span>+</span> <span>'\\\"'</span> <span>+</span>\n                <span>\", \\\"type\\\":\\\"\"</span> <span>+</span> type <span>+</span> <span>'\\\"'</span> <span>+</span>\n                <span>'}'</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>结果转换出来的数据是字符串类型&quot;{&quot;code&quot;:&quot;COMMON&quot;, &quot;type&quot;:&quot;普通用户&quot;}&quot;，这个方法好像行不通，还有什么好办法呢？思前想后，看文章开始定义的User和UserType类，标记数据序列化格式@JsonFormat，再突然想起之前看到过的一些文章，SpringMVC底层默认是使用Jackson进行序列化的，那好了，就用Jacksong实施呗，将SecretResponseAdvice中的序列化方法替换一下：</p>\n<div><pre><code> <span>String</span> data <span>=</span> <span>EncryptUtils</span><span>.</span><span>aesEncrypt</span><span>(</span>JSON<span>.</span><span>toJSONString</span><span>(</span>o<span>)</span><span>,</span> secretKey<span>)</span><span>;</span>\n 换为：\n <span>String</span> data <span>=</span><span>EncryptUtils</span><span>.</span><span>aesEncrypt</span><span>(</span><span>new</span> <span>ObjectMapper</span><span>(</span><span>)</span><span>.</span><span>writeValueAsString</span><span>(</span>o<span>)</span><span>,</span> secretKey<span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>重新运行一波，走起：</p>\n<div><pre><code><span>{</span>\n\t<span>\"code\"</span><span>:</span> <span>200</span><span>,</span>\n\t<span>\"data\"</span><span>:</span> <span>[</span><span>{</span>\n\t\t<span>\"id\"</span><span>:</span> <span>1</span><span>,</span>\n\t\t<span>\"name\"</span><span>:</span> <span>\"boyka\"</span><span>,</span>\n\t\t<span>\"userType\"</span><span>:</span> <span>{</span>\n\t\t\t<span>\"code\"</span><span>:</span> <span>\"COMMON\"</span><span>,</span>\n\t\t\t<span>\"type\"</span><span>:</span> <span>\"普通用户\"</span>\n\t\t<span>}</span><span>,</span>\n\t\t<span>\"registerTime\"</span><span>:</span> <span>{</span>\n\t\t\t<span>\"month\"</span><span>:</span> <span>\"MARCH\"</span><span>,</span>\n\t\t\t<span>\"year\"</span><span>:</span> <span>2022</span><span>,</span>\n\t\t\t<span>\"dayOfMonth\"</span><span>:</span> <span>29</span><span>,</span>\n\t\t\t<span>\"dayOfWeek\"</span><span>:</span> <span>\"TUESDAY\"</span><span>,</span>\n\t\t\t<span>\"dayOfYear\"</span><span>:</span> <span>88</span><span>,</span>\n\t\t\t<span>\"monthValue\"</span><span>:</span> <span>3</span><span>,</span>\n\t\t\t<span>\"hour\"</span><span>:</span> <span>22</span><span>,</span>\n\t\t\t<span>\"minute\"</span><span>:</span> <span>30</span><span>,</span>\n\t\t\t<span>\"nano\"</span><span>:</span> <span>453000000</span><span>,</span>\n\t\t\t<span>\"second\"</span><span>:</span> <span>36</span><span>,</span>\n\t\t\t<span>\"chronology\"</span><span>:</span> <span>{</span>\n\t\t\t\t<span>\"id\"</span><span>:</span> <span>\"ISO\"</span><span>,</span>\n\t\t\t\t<span>\"calendarType\"</span><span>:</span> <span>\"iso8601\"</span>\n\t\t\t<span>}</span>\n\t\t<span>}</span>\n\t<span>}</span><span>]</span><span>,</span>\n\t<span>\"msg\"</span><span>:</span> <span>\"用户列表查询成功\"</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>解密后的userType枚举类型和非加密版本一样了，舒服了，== 好像还不对，registerTime怎么变成这个样子了？原本是&quot;2022-03-24 23:58:39&quot;这种格式的，<a href=\"https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fyzeng%2Fp%2F11522411.html\" target=\"_blank\" rel=\"noopener noreferrer\">Jackson之LocalDateTime转换，无需改实体类</a>这篇文章讲到了这个问题，并提出了一种解决方案，不过用在我们目前这个需求里面，就是有损改装了啊，不太可取，遂去Jackson官网上查找一下相关文档，当然Jackson也提供了ObjectMapper的序列化配置，重新再初始化配置ObjectMpper对象：</p>\n<div><pre><code><span>String</span> DATE_TIME_FORMATTER <span>=</span> <span>\"yyyy-MM-dd HH:mm:ss\"</span><span>;</span>\n<span>ObjectMapper</span> objectMapper <span>=</span> <span>new</span> <span>Jackson2ObjectMapperBuilder</span><span>(</span><span>)</span>\n                            <span>.</span><span>findModulesViaServiceLoader</span><span>(</span><span>true</span><span>)</span>\n                            <span>.</span><span>serializerByType</span><span>(</span><span>LocalDateTime</span><span>.</span><span>class</span><span>,</span> <span>new</span> <span>LocalDateTimeSerializer</span><span>(</span>\n                                    <span>DateTimeFormatter</span><span>.</span><span>ofPattern</span><span>(</span>DATE_TIME_FORMATTER<span>)</span><span>)</span><span>)</span>\n                            <span>.</span><span>deserializerByType</span><span>(</span><span>LocalDateTime</span><span>.</span><span>class</span><span>,</span> <span>new</span> <span>LocalDateTimeDeserializer</span><span>(</span>\n                                    <span>DateTimeFormatter</span><span>.</span><span>ofPattern</span><span>(</span>DATE_TIME_FORMATTER<span>)</span><span>)</span><span>)</span>\n                            <span>.</span><span>build</span><span>(</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>转换结果：</p>\n<div><pre><code><span>{</span>\n\t<span>\"code\"</span><span>:</span> <span>200</span><span>,</span>\n\t<span>\"data\"</span><span>:</span> <span>[</span><span>{</span>\n\t\t<span>\"id\"</span><span>:</span> <span>1</span><span>,</span>\n\t\t<span>\"name\"</span><span>:</span> <span>\"boyka\"</span><span>,</span>\n\t\t<span>\"userType\"</span><span>:</span> <span>{</span>\n\t\t\t<span>\"code\"</span><span>:</span> <span>\"COMMON\"</span><span>,</span>\n\t\t\t<span>\"type\"</span><span>:</span> <span>\"普通用户\"</span>\n\t\t<span>}</span><span>,</span>\n\t\t<span>\"registerTime\"</span><span>:</span> <span>\"2022-03-29 22:57:33\"</span>\n\t<span>}</span><span>]</span><span>,</span>\n\t<span>\"msg\"</span><span>:</span> <span>\"用户列表查询成功\"</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>OK，和非加密版的终于一致了，完了吗？感觉还是可能存在些什么问题，首先业务代码的时间序列化需求不一样，有&quot;yyyy-MM-dd hh:mm:ss&quot;的，也有&quot;yyyy-MM-dd&quot;的，还可能其他配置思考不到位的，导致和之前非加密版返回数据不一致的问题，到时候联调测出来了也麻烦，有没有一劳永逸的办法呢？同事一句话点亮我，看一下spring框架自身是怎么序列化的，照着配置应该就行嘛，好像有点道理，不从0开始分析源码了，敢兴趣的朋友可以看看这篇文章源码分析<a href=\"https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fjava-chen-hao%2Fp%2F11187914.html\" target=\"_blank\" rel=\"noopener noreferrer\">Spring MVC源码(三) ----- @RequestBody和@ResponseBody原理解析</a>，感觉写可以。</p>\n<p>跟着执行链路，找到具体的响应序列化，重点就是RequestResponseBodyMethodProcessor，</p>\n<div><pre><code><span>protected</span> <span><span>&lt;</span><span>T</span><span>></span></span> <span>void</span> <span>writeWithMessageConverters</span><span>(</span><span>@Nullable</span> <span>T</span> value<span>,</span> <span>MethodParameter</span> returnType<span>,</span> <span>ServletServerHttpRequest</span> inputMessage<span>,</span> <span>ServletServerHttpResponse</span> outputMessage<span>)</span> <span>throws</span> <span>IOException</span><span>,</span> <span>HttpMediaTypeNotAcceptableException</span><span>,</span> <span>HttpMessageNotWritableException</span> <span>{</span>\n        <span>// 获取响应的拦截器链并执行beforeBodyWrite方法，也就是执行了我们自定义的SecretResponseAdvice中的beforeBodyWrite啦</span>\n\t\tbody <span>=</span> <span>this</span><span>.</span><span>getAdvice</span><span>(</span><span>)</span><span>.</span><span>beforeBodyWrite</span><span>(</span>body<span>,</span> returnType<span>,</span> selectedMediaType<span>,</span> converter<span>.</span><span>getClass</span><span>(</span><span>)</span><span>,</span> inputMessage<span>,</span> outputMessage<span>)</span><span>;</span>\n\t\t<span>if</span> <span>(</span>body <span>!=</span> <span>null</span><span>)</span> <span>{</span>\n\t\t    <span>// 执行响应体序列化工作</span>\n\t\t\t<span>if</span> <span>(</span>genericConverter <span>!=</span> <span>null</span><span>)</span> <span>{</span>\n\t\t\t\tgenericConverter<span>.</span><span>write</span><span>(</span>body<span>,</span> <span>(</span><span>Type</span><span>)</span>targetType<span>,</span> selectedMediaType<span>,</span> outputMessage<span>)</span><span>;</span>\n\t\t\t<span>}</span> <span>else</span> <span>{</span>\n\t\t\t\tconverter<span>.</span><span>write</span><span>(</span>body<span>,</span> selectedMediaType<span>,</span> outputMessage<span>)</span><span>;</span>\n\t\t\t<span>}</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>进而通过实例化的AbstractJackson2HttpMessageConverter对象找到执行序列化的核心方法</p>\n<div><pre><code><span>-></span> <span>AbstractGenericHttpMessageConverter</span><span>:</span>\n\t\n\t<span>public</span> <span>final</span> <span>void</span> <span>write</span><span>(</span><span>T</span> t<span>,</span> <span>@Nullable</span> <span>Type</span> type<span>,</span> <span>@Nullable</span> <span>MediaType</span> contentType<span>,</span> <span>HttpOutputMessage</span> outputMessage<span>)</span> <span>throws</span> <span>IOException</span><span>,</span> <span>HttpMessageNotWritableException</span> <span>{</span>\n        <span>.</span><span>.</span><span>.</span>\n\t\t<span>this</span><span>.</span><span>writeInternal</span><span>(</span>t<span>,</span> type<span>,</span> outputMessage<span>)</span><span>;</span>\n\t\toutputMessage<span>.</span><span>getBody</span><span>(</span><span>)</span><span>.</span><span>flush</span><span>(</span><span>)</span><span>;</span>\n     \n    <span>}</span>\n\t<span>-></span> 找到<span>Jackson</span>序列化 <span>AbstractJackson2HttpMessageConverter</span><span>:</span>\n\t<span>// 从spring容器中获取并设置的ObjectMapper实例</span>\n\t<span>protected</span> <span>ObjectMapper</span> objectMapper<span>;</span>\n\t\n\t<span>protected</span> <span>void</span> <span>writeInternal</span><span>(</span><span>Object</span> object<span>,</span> <span>@Nullable</span> <span>Type</span> type<span>,</span> <span>HttpOutputMessage</span> outputMessage<span>)</span> <span>throws</span> <span>IOException</span><span>,</span> <span>HttpMessageNotWritableException</span> <span>{</span>\n        <span>MediaType</span> contentType <span>=</span> outputMessage<span>.</span><span>getHeaders</span><span>(</span><span>)</span><span>.</span><span>getContentType</span><span>(</span><span>)</span><span>;</span>\n        <span>JsonEncoding</span> encoding <span>=</span> <span>this</span><span>.</span><span>getJsonEncoding</span><span>(</span>contentType<span>)</span><span>;</span>\n        <span>JsonGenerator</span> generator <span>=</span> <span>this</span><span>.</span>objectMapper<span>.</span><span>getFactory</span><span>(</span><span>)</span><span>.</span><span>createGenerator</span><span>(</span>outputMessage<span>.</span><span>getBody</span><span>(</span><span>)</span><span>,</span> encoding<span>)</span><span>;</span>\n\n\t\t<span>this</span><span>.</span><span>writePrefix</span><span>(</span>generator<span>,</span> object<span>)</span><span>;</span>\n\t\t<span>Object</span> value <span>=</span> object<span>;</span>\n\t\t<span>Class</span><span><span>&lt;</span><span>?</span><span>></span></span> serializationView <span>=</span> <span>null</span><span>;</span>\n\t\t<span>FilterProvider</span> filters <span>=</span> <span>null</span><span>;</span>\n\t\t<span>JavaType</span> javaType <span>=</span> <span>null</span><span>;</span>\n\t\t<span>if</span> <span>(</span>object <span>instanceof</span> <span>MappingJacksonValue</span><span>)</span> <span>{</span>\n\t\t\t<span>MappingJacksonValue</span> container <span>=</span> <span>(</span><span>MappingJacksonValue</span><span>)</span>object<span>;</span>\n\t\t\tvalue <span>=</span> container<span>.</span><span>getValue</span><span>(</span><span>)</span><span>;</span>\n\t\t\tserializationView <span>=</span> container<span>.</span><span>getSerializationView</span><span>(</span><span>)</span><span>;</span>\n\t\t\tfilters <span>=</span> container<span>.</span><span>getFilters</span><span>(</span><span>)</span><span>;</span>\n\t\t<span>}</span>\n\n\t\t<span>if</span> <span>(</span>type <span>!=</span> <span>null</span> <span>&amp;&amp;</span> <span>TypeUtils</span><span>.</span><span>isAssignable</span><span>(</span>type<span>,</span> value<span>.</span><span>getClass</span><span>(</span><span>)</span><span>)</span><span>)</span> <span>{</span>\n\t\t\tjavaType <span>=</span> <span>this</span><span>.</span><span>getJavaType</span><span>(</span>type<span>,</span> <span>(</span><span>Class</span><span>)</span><span>null</span><span>)</span><span>;</span>\n\t\t<span>}</span>\n\n\t\t<span>ObjectWriter</span> objectWriter <span>=</span> serializationView <span>!=</span> <span>null</span> <span>?</span> <span>this</span><span>.</span>objectMapper<span>.</span><span>writerWithView</span><span>(</span>serializationView<span>)</span> <span>:</span> <span>this</span><span>.</span>objectMapper<span>.</span><span>writer</span><span>(</span><span>)</span><span>;</span>\n\t\t<span>if</span> <span>(</span>filters <span>!=</span> <span>null</span><span>)</span> <span>{</span>\n\t\t\tobjectWriter <span>=</span> objectWriter<span>.</span><span>with</span><span>(</span>filters<span>)</span><span>;</span>\n\t\t<span>}</span>\n\n\t\t<span>if</span> <span>(</span>javaType <span>!=</span> <span>null</span> <span>&amp;&amp;</span> javaType<span>.</span><span>isContainerType</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n\t\t\tobjectWriter <span>=</span> objectWriter<span>.</span><span>forType</span><span>(</span>javaType<span>)</span><span>;</span>\n\t\t<span>}</span>\n\n\t\t<span>SerializationConfig</span> config <span>=</span> objectWriter<span>.</span><span>getConfig</span><span>(</span><span>)</span><span>;</span>\n\t\t<span>if</span> <span>(</span>contentType <span>!=</span> <span>null</span> <span>&amp;&amp;</span> contentType<span>.</span><span>isCompatibleWith</span><span>(</span><span>MediaType</span><span>.</span>TEXT_EVENT_STREAM<span>)</span> <span>&amp;&amp;</span> config<span>.</span><span>isEnabled</span><span>(</span><span>SerializationFeature</span><span>.</span>INDENT_OUTPUT<span>)</span><span>)</span> <span>{</span>\n\t\t\tobjectWriter <span>=</span> objectWriter<span>.</span><span>with</span><span>(</span><span>this</span><span>.</span>ssePrettyPrinter<span>)</span><span>;</span>\n\t\t<span>}</span>\n        <span>// 重点进行序列化</span>\n\t\tobjectWriter<span>.</span><span>writeValue</span><span>(</span>generator<span>,</span> value<span>)</span><span>;</span>\n\t\t<span>this</span><span>.</span><span>writeSuffix</span><span>(</span>generator<span>,</span> object<span>)</span><span>;</span>\n\t\tgenerator<span>.</span><span>flush</span><span>(</span><span>)</span><span>;</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>那么，可以看出SpringMVC在进行响应序列化的时候是从容器中获取的ObjectMapper实例对象，并会根据不同的默认配置条件进行序列化，那处理方法就简单了，我也可以从Spring容器拿数据进行序列化啊。SecretResponseAdvice进行如下进一步改造：</p>\n<div><pre><code><span>@ControllerAdvice</span>\n<span>public</span> <span>class</span> <span>SecretResponseAdvice</span> <span>implements</span> <span>ResponseBodyAdvice</span> <span>{</span>\n\n    <span>@Autowired</span>\n    <span>private</span> <span>ObjectMapper</span> objectMapper<span>;</span>\n     \n      <span>@Override</span>\n    <span>public</span> <span>Object</span> <span>beforeBodyWrite</span><span>(</span><span>.</span><span>.</span><span>.</span><span>.</span><span>)</span> <span>{</span>\n        <span>.</span><span>.</span><span>.</span><span>.</span><span>.</span>\n        <span>String</span> dataStr <span>=</span>objectMapper<span>.</span><span>writeValueAsString</span><span>(</span>o<span>)</span><span>;</span>\n        <span>String</span> data <span>=</span> <span>EncryptUtils</span><span>.</span><span>aesEncrypt</span><span>(</span>dataStr<span>,</span> secretKey<span>)</span><span>;</span>\n        <span>.</span><span>.</span><span>.</span><span>.</span><span>.</span>\n    <span>}</span>\n <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>经测试，响应数据和非加密版万全一致啦，还有GET部分的请求加密，以及后面加解密惨遭跨域问题，后面有空再和大家聊聊。</p>\n<p><a href=\"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fboykait%2Fencrypt-demo\" target=\"_blank\" rel=\"noopener noreferrer\">git的demo地址</a></p>\n",
      "date_published": "2022-07-06T00:00:00.000Z",
      "date_modified": "2022-06-30T03:46:00.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "VUE下拉列表动态切换(人人组件)",
      "url": "https://blog.ciberviler.top/dev/VUE%E4%B8%8B%E6%8B%89%E5%88%97%E8%A1%A8%E5%8A%A8%E6%80%81%E5%88%87%E6%8D%A2.html",
      "id": "https://blog.ciberviler.top/dev/VUE%E4%B8%8B%E6%8B%89%E5%88%97%E8%A1%A8%E5%8A%A8%E6%80%81%E5%88%87%E6%8D%A2.html",
      "content_html": "<h1 id=\"vue下拉列表动态切换-人人组件\" tabindex=\"-1\"> VUE下拉列表动态切换(人人组件)</h1>\n<h2 id=\"方法一\" tabindex=\"-1\"> 方法一</h2>\n<p>vue前端</p>\n<div><pre><code> <span><span><span>&lt;</span>el-form-item</span> <span>label</span><span><span>=</span><span>\"</span>大类<span>\"</span></span> <span>prop</span><span><span>=</span><span>\"</span>busiLines<span>\"</span></span><span>></span></span>\n     <span><span><span>&lt;</span>ren-select</span> <span>v-model</span><span><span>=</span><span>\"</span>dataForm.busiLines<span>\"</span></span> <span>dict-type</span><span><span>=</span><span>\"</span>PIG_BUSI_LINES<span>\"</span></span> <span>@change</span><span><span>=</span><span>\"</span>selectchange<span>\"</span></span> <span>placeholder</span><span><span>=</span><span>\"</span>大类<span>\"</span></span><span>></span></span><span><span><span>&lt;/</span>ren-select</span><span>></span></span>\n<span><span><span>&lt;/</span>el-form-item</span><span>></span></span>\n<span><span><span>&lt;</span>el-form-item</span> <span>label</span><span><span>=</span><span>\"</span>细分<span>\"</span></span> <span>prop</span><span><span>=</span><span>\"</span>busiDtiLines<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>el-select</span> <span>v-model</span><span><span>=</span><span>\"</span>dataForm.busiDtiLines<span>\"</span></span> <span>placeholder</span><span><span>=</span><span>\"</span>细分<span>\"</span></span> <span>clearable</span><span>></span></span>\n        <span><span><span>&lt;</span>el-option</span> <span>:label</span><span><span>=</span><span>\"</span>data.dictLabel<span>\"</span></span> <span>v-for</span><span><span>=</span><span>\"</span>data in dataList<span>\"</span></span> <span>:key</span><span><span>=</span><span>\"</span>data.dictValue<span>\"</span></span> <span>:value</span><span><span>=</span><span>\"</span>data.dictValue<span>\"</span></span><span>></span></span>{{ data.dictLabel }}<span><span><span>&lt;/</span>el-option</span><span>></span></span>\n    <span><span><span>&lt;/</span>el-select</span><span>></span></span>\n<span><span><span>&lt;/</span>el-form-item</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>setup或者data中添加</p>\n<div><pre><code>busi_dict:\"\",\ndataList:[] as any[], // 属性需要做类型断言处理,\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>methods中添加方法：</p>\n<div><pre><code><span>selectchange</span><span>(</span>value<span>)</span><span>{</span>\n      <span>//console.log(value)</span>\n      <span>switch</span><span>(</span>value<span>)</span><span>{</span>\n        <span>case</span> <span>\"1\"</span><span>:</span> <span>this</span><span>.</span>dataList<span>=</span><span>getDictDataList</span><span>(</span><span>this</span><span>.</span>$store<span>.</span>state<span>.</span>dicts<span>,</span> <span>\"BUSI_DTI_LINES_FIN\"</span><span>)</span><span>;</span><span>break</span><span>;</span>\n        <span>case</span> <span>\"2\"</span><span>:</span> <span>this</span><span>.</span>dataList<span>=</span><span>getDictDataList</span><span>(</span><span>this</span><span>.</span>$store<span>.</span>state<span>.</span>dicts<span>,</span> <span>\"BUSI_DTI_LINES_NONFIN\"</span><span>)</span><span>;</span><span>break</span><span>;</span>\n        <span>case</span> <span>\"3\"</span><span>:</span> <span>this</span><span>.</span>dataList<span>=</span><span>getDictDataList</span><span>(</span><span>this</span><span>.</span>$store<span>.</span>state<span>.</span>dicts<span>,</span> <span>\"BUSI_DTI_LINES_RE\"</span><span>)</span><span>;</span><span>break</span><span>;</span>\n        <span>case</span> <span>\"4\"</span><span>:</span> <span>this</span><span>.</span>dataList<span>=</span><span>getDictDataList</span><span>(</span><span>this</span><span>.</span>$store<span>.</span>state<span>.</span>dicts<span>,</span> <span>\"BUSI_DTI_LINES_GUAR\"</span><span>)</span><span>;</span><span>break</span><span>;</span>\n        <span>default</span><span>:</span><span>break</span><span>;</span>\n      <span>}</span><span>;</span>\n    <span>}</span><span>,</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"方法二\" tabindex=\"-1\"> 方法二</h2>\n<p>ren-select组件中添加watch</p>\n<div><pre><code>watch<span>:</span> <span>{</span>\n    <span>//开始监听返回该对象属性值计算属性</span>\n    dictType<span>:</span> <span>{</span>\n      deep<span>:</span> <span>true</span><span>,</span>\n      <span>handler</span><span>(</span>newVal<span>,</span> oldVal<span>)</span> <span>{</span>\n        <span>console</span><span>.</span><span>info</span><span>(</span><span>'[oldVal:'</span> <span>+</span> oldVal <span>+</span> <span>'] [newVal:'</span> <span>+</span> newVal <span>+</span> <span>']'</span><span>)</span>\n        <span>this</span><span>.</span>dataList <span>=</span> <span>getDictDataList</span><span>(</span><span>this</span><span>.</span>store<span>.</span>state<span>.</span>dicts<span>,</span> newVal<span>)</span>\n\n        <span>console</span><span>.</span><span>info</span><span>(</span><span>this</span><span>.</span>dataList<span>)</span>\n      <span>}</span><span>,</span>\n    <span>}</span><span>,</span>\n<span>}</span><span>,</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>vue前端</p>\n<div><pre><code><span><span><span>&lt;</span>el-form-item</span> <span>label</span><span><span>=</span><span>\"</span>大类<span>\"</span></span> <span>prop</span><span><span>=</span><span>\"</span>busiLines<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>ren-select</span> <span>v-model</span><span><span>=</span><span>\"</span>dataForm.busiLines<span>\"</span></span> <span>dict-type</span><span><span>=</span><span>\"</span>PIG_BUSI_LINES<span>\"</span></span> <span>@change</span><span><span>=</span><span>\"</span>selectchange<span>\"</span></span> <span>placeholder</span><span><span>=</span><span>\"</span>大类<span>\"</span></span><span>></span></span><span><span><span>&lt;/</span>ren-select</span><span>></span></span>\n<span><span><span>&lt;/</span>el-form-item</span><span>></span></span>\n<span><span><span>&lt;</span>el-form-item</span> <span>label</span><span><span>=</span><span>\"</span>细分<span>\"</span></span> <span>prop</span><span><span>=</span><span>\"</span>busiDtiLines<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>ren-select</span> <span>v-model</span><span><span>=</span><span>\"</span>dataForm.busiDtiLines<span>\"</span></span> <span>:dict-type</span><span><span>=</span><span>\"</span>busi_dict<span>\"</span></span> <span>placeholder</span><span><span>=</span><span>\"</span>细分<span>\"</span></span><span>></span></span><span><span><span>&lt;/</span>ren-select</span><span>></span></span>\n<span><span><span>&lt;/</span>el-form-item</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>methods中添加方法：</p>\n<div><pre><code><span>selectchange</span><span>(</span>value<span>)</span><span>{</span>\n    <span>switch</span><span>(</span>value<span>)</span><span>{</span>\n        <span>case</span> <span>\"1\"</span><span>:</span> <span>this</span><span>.</span>busi_dict <span>=</span> <span>\"BUSI_DTI_LINES_FIN\"</span><span>;</span><span>break</span><span>;</span>\n        <span>case</span> <span>\"2\"</span><span>:</span> <span>this</span><span>.</span>busi_dict <span>=</span> <span>\"BUSI_DTI_LINES_NONFIN\"</span><span>;</span><span>break</span><span>;</span>\n        <span>case</span> <span>\"3\"</span><span>:</span> <span>this</span><span>.</span>busi_dict <span>=</span> <span>\"BUSI_DTI_LINES_RE\"</span><span>;</span><span>break</span><span>;</span>\n        <span>case</span> <span>\"4\"</span><span>:</span> <span>this</span><span>.</span>busi_dict <span>=</span> <span>\"BUSI_DTI_LINES_GUAR\"</span><span>;</span><span>break</span><span>;</span>\n        <span>default</span><span>:</span><span>break</span><span>;</span>\n    <span>}</span><span>;</span>\n<span>}</span><span>,</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"注意\" tabindex=\"-1\"> 注意：</h2>\n<p>如果下拉列表用字典，打开时会显示字典值的key，所以可以加一个钩子</p>\n<div><pre><code><span>updated</span><span>(</span><span>)</span><span>{</span>\n    <span>this</span><span>.</span><span>selectchange</span><span>(</span><span>this</span><span>.</span>dataForm<span>.</span>busiLines<span>)</span><span>;</span>\n  <span>}</span><span>,</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div>",
      "date_published": "2022-07-05T00:00:00.000Z",
      "date_modified": "2022-06-30T03:45:54.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "Spring Boot 整合流程引擎 Flowable",
      "url": "https://blog.ciberviler.top/dev/SpringBoot%E6%95%B4%E5%90%88%E6%B5%81%E7%A8%8B%E5%BC%95%E6%93%8EFlowable.html",
      "id": "https://blog.ciberviler.top/dev/SpringBoot%E6%95%B4%E5%90%88%E6%B5%81%E7%A8%8B%E5%BC%95%E6%93%8EFlowable.html",
      "content_html": "<h1 id=\"spring-boot-整合流程引擎-flowable\" tabindex=\"-1\"> Spring Boot 整合流程引擎 Flowable</h1>\n<p>流程引擎，也算是一个比较常见的工具了，我们在日常的很多开发中都会用到，当然用的最多的就是 OA 系统了，但是在一些非 OA 系统中，我们也会涉及到，比如一个 CRM 中，可能会有合同管理的需求，合同的审批，也是需要流程引擎的。</p>\n<p>所以今天我们来简单聊聊流程引擎，顺便写一个简单的例子，小伙伴们一起来感受下流程引擎到底是个啥。</p>\n<h2 id=\"_1-流程引擎介绍\" tabindex=\"-1\"> 1. 流程引擎介绍</h2>\n<p>Flowable 是一个使用 Java 编写的轻量级业务流程引擎。Flowable 流程引擎可用于部署 BPMN2.0 流程定义（用于定义流程的行业 XML 标准），创建这些流程定义的流程实例，进行查询，访问运行中或历史的流程实例与相关数据，等等。</p>\n<p>Java 领域另一个流程引擎是 Activiti，不过我觉得这两个东西，只要你会使用其中一个，另一个就不在话下。</p>\n<p>咱就不废话了，上代码吧。</p>\n<h2 id=\"_2-创建项目\" tabindex=\"-1\"> 2. 创建项目</h2>\n<p>首先我们创建一个 Spring Boot 项目，引入 Web、和 MySQL 驱动两个依赖，如下图：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/19013239_62852db7da56536801.png\" alt=\"Spring Boot 整合流程引擎 Flowable，so easy_mysql\"></p>\n<p>项目创建成功之后，我们引入 flowable 依赖，如下：</p>\n<div><pre><code><span><span><span>&lt;</span>dependency</span><span>></span></span>\n    <span><span><span>&lt;</span>groupId</span><span>></span></span>org.flowable<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n    <span><span><span>&lt;</span>artifactId</span><span>></span></span>flowable-spring-boot-starter<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n    <span><span><span>&lt;</span>version</span><span>></span></span>6.7.2<span><span><span>&lt;/</span>version</span><span>></span></span>\n<span><span><span>&lt;/</span>dependency</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>这个会帮我们做一些自动化配置，默认情况下，所以位于 resources/processes 的流程都会被自动部署。</p>\n<p>接下来我们在 application.yaml 中配置一下数据库连接信息，当项目启动的时候会自动初始化数据库，将来流程引擎运行时候的数据会被自动持久化到数据库中。</p>\n<div><pre><code><span>spring</span><span>:</span>\n  <span>datasource</span><span>:</span>\n    <span>username</span><span>:</span> root\n    <span>password</span><span>:</span> <span>123</span>\n    <span>url</span><span>:</span> jdbc<span>:</span>mysql<span>:</span>///flowable<span>?</span>serverTimezone=Asia/Shanghai<span>&amp;useSSL=false&amp;nullCatalogMeansCurrent=true</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>好啦，配置完成后，我们就可以启动项目了。项目启动成功之后，flowable 数据库中就会自动创建如下这些表，将来流程引擎相关的数据都会自动保存到这些表中。</p>\n<p>默认的表比较多，截图只是其中一部分。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/19013239_62852db80079472215.png\" alt=\"Spring Boot 整合流程引擎 Flowable，so easy_流程引擎_02\"></p>\n<h2 id=\"_3-画流程图\" tabindex=\"-1\"> 3. 画流程图</h2>\n<p>画流程图算是比较有挑战的一个步骤了，也是流程引擎使用的关键。官方提供了一些流程引擎绘制工具，这个我就不说了，感兴趣的小伙伴可以自行去体验；IDEA 也自带了一个流程可视化的工具，但是特别难用，我这里也就 不说了。</p>\n<p>这里说一下我常用的 IDEA 插件 <strong>Flowable BPMN visualizer</strong>，如下图：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/19013240_62852db81d94797834.png\" alt=\"Spring Boot 整合流程引擎 Flowable，so easy_流程图_03\"></p>\n<p>插件怎么安装就不用我教了吧，小伙伴们自行安装即可。</p>\n<p>装好插件之后，我们在 resources 目录下新建 processes 目录，这个目录下的流程文件将来会被自动部署。</p>\n<p>接下来我们在 processes 目录下，新建一个 BPMN 文件（插件装好了就有这个选项了），如下：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/19013240_62852db84066473563.png\" alt=\"Spring Boot 整合流程引擎 Flowable，so easy_流程图_04\"></p>\n<p>我们来画个请假的流程，就叫做 ask_for_leave.bpmn20.xml，注意最后面的 <code>.bpmn20.xml</code> 是固定后缀。</p>\n<p>文件创建出来之后，右键单击，选择 View BPMN(Flowable) Diagram,就打开了可视化页面了，我们就可以来绘制自己的流程图了。</p>\n<p>我的请假流程画出来是这样：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/19013240_62852db8574fe29098.png\" alt=\"Spring Boot 整合流程引擎 Flowable，so easy_流程引擎_05\"></p>\n<p>员工发起一个请假流程，首先是组长审核，组长审核通过了，就进入到经理审核，经理审核通过了，这个流程就结束了，如果组长审核未通过或者经理审核未通过，则流程给员工发送一个请假失败的通知，流程结束。</p>\n<p>我们来看下这个流程对应的 XML 文件，一些流程细节会在 XML 文件中体现出来，如下：</p>\n<div><pre><code><span><span><span>&lt;</span>process</span> <span>id</span><span><span>=</span><span>\"</span>ask_for_leave<span>\"</span></span> <span>name</span><span><span>=</span><span>\"</span>ask_for_leave<span>\"</span></span> <span>isExecutable</span><span><span>=</span><span>\"</span>true<span>\"</span></span><span>></span></span>\n  <span><span><span>&lt;</span>userTask</span> <span>id</span><span><span>=</span><span>\"</span>leaveTask<span>\"</span></span> <span>name</span><span><span>=</span><span>\"</span>请假<span>\"</span></span> <span><span>flowable:</span>assignee</span><span><span>=</span><span>\"</span>#{leaveTask}<span>\"</span></span><span>/></span></span>\n  <span><span><span>&lt;</span>userTask</span> <span>id</span><span><span>=</span><span>\"</span>zuzhangTask<span>\"</span></span> <span>name</span><span><span>=</span><span>\"</span>组长审核<span>\"</span></span> <span><span>flowable:</span>assignee</span><span><span>=</span><span>\"</span>#{zuzhangTask}<span>\"</span></span><span>/></span></span>\n  <span><span><span>&lt;</span>userTask</span> <span>id</span><span><span>=</span><span>\"</span>managerTask<span>\"</span></span> <span>name</span><span><span>=</span><span>\"</span>经理审核<span>\"</span></span> <span><span>flowable:</span>assignee</span><span><span>=</span><span>\"</span>#{managerTask}<span>\"</span></span><span>/></span></span>\n  <span><span><span>&lt;</span>exclusiveGateway</span> <span>id</span><span><span>=</span><span>\"</span>managerJudgeTask<span>\"</span></span><span>/></span></span>\n  <span><span><span>&lt;</span>exclusiveGateway</span> <span>id</span><span><span>=</span><span>\"</span>zuzhangJudeTask<span>\"</span></span><span>/></span></span>\n  <span><span><span>&lt;</span>endEvent</span> <span>id</span><span><span>=</span><span>\"</span>endLeave<span>\"</span></span> <span>name</span><span><span>=</span><span>\"</span>结束<span>\"</span></span><span>/></span></span>\n  <span><span><span>&lt;</span>startEvent</span> <span>id</span><span><span>=</span><span>\"</span>startLeave<span>\"</span></span> <span>name</span><span><span>=</span><span>\"</span>开始<span>\"</span></span><span>/></span></span>\n  <span><span><span>&lt;</span>sequenceFlow</span> <span>id</span><span><span>=</span><span>\"</span>flowStart<span>\"</span></span> <span>sourceRef</span><span><span>=</span><span>\"</span>startLeave<span>\"</span></span> <span>targetRef</span><span><span>=</span><span>\"</span>leaveTask<span>\"</span></span><span>/></span></span>\n  <span><span><span>&lt;</span>sequenceFlow</span> <span>id</span><span><span>=</span><span>\"</span>modeFlow<span>\"</span></span> <span>sourceRef</span><span><span>=</span><span>\"</span>leaveTask<span>\"</span></span> <span>targetRef</span><span><span>=</span><span>\"</span>zuzhangTask<span>\"</span></span><span>/></span></span>\n  <span><span><span>&lt;</span>sequenceFlow</span> <span>id</span><span><span>=</span><span>\"</span>zuzhang_go<span>\"</span></span> <span>sourceRef</span><span><span>=</span><span>\"</span>zuzhangJudeTask<span>\"</span></span> <span>targetRef</span><span><span>=</span><span>\"</span>managerTask<span>\"</span></span> <span>name</span><span><span>=</span><span>\"</span>通过<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>conditionExpression</span> <span><span>xsi:</span>type</span><span><span>=</span><span>\"</span>tFormalExpression<span>\"</span></span><span>></span></span><span>&lt;![CDATA[${checkResult=='通过'}]]></span><span><span><span>&lt;/</span>conditionExpression</span><span>></span></span>\n  <span><span><span>&lt;/</span>sequenceFlow</span><span>></span></span>\n  <span><span><span>&lt;</span>sequenceFlow</span> <span>id</span><span><span>=</span><span>\"</span>zuzhang_reject<span>\"</span></span> <span>sourceRef</span><span><span>=</span><span>\"</span>zuzhangJudeTask<span>\"</span></span> <span>targetRef</span><span><span>=</span><span>\"</span>sendMail<span>\"</span></span> <span>name</span><span><span>=</span><span>\"</span>拒绝<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>conditionExpression</span> <span><span>xsi:</span>type</span><span><span>=</span><span>\"</span>tFormalExpression<span>\"</span></span><span>></span></span><span>&lt;![CDATA[${checkResult=='拒绝'}]]></span><span><span><span>&lt;/</span>conditionExpression</span><span>></span></span>\n  <span><span><span>&lt;/</span>sequenceFlow</span><span>></span></span>\n  <span><span><span>&lt;</span>sequenceFlow</span> <span>id</span><span><span>=</span><span>\"</span>jugdeFlow<span>\"</span></span> <span>sourceRef</span><span><span>=</span><span>\"</span>managerTask<span>\"</span></span> <span>targetRef</span><span><span>=</span><span>\"</span>managerJudgeTask<span>\"</span></span><span>/></span></span>\n  <span><span><span>&lt;</span>sequenceFlow</span> <span>id</span><span><span>=</span><span>\"</span>flowEnd<span>\"</span></span> <span>name</span><span><span>=</span><span>\"</span>通过<span>\"</span></span> <span>sourceRef</span><span><span>=</span><span>\"</span>managerJudgeTask<span>\"</span></span> <span>targetRef</span><span><span>=</span><span>\"</span>endLeave<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>conditionExpression</span> <span><span>xsi:</span>type</span><span><span>=</span><span>\"</span>tFormalExpression<span>\"</span></span><span>></span></span><span>&lt;![CDATA[${checkResult=='通过'}]]></span><span><span><span>&lt;/</span>conditionExpression</span><span>></span></span>\n  <span><span><span>&lt;/</span>sequenceFlow</span><span>></span></span>\n  <span><span><span>&lt;</span>sequenceFlow</span> <span>id</span><span><span>=</span><span>\"</span>rejectFlow<span>\"</span></span> <span>name</span><span><span>=</span><span>\"</span>拒绝<span>\"</span></span> <span>sourceRef</span><span><span>=</span><span>\"</span>managerJudgeTask<span>\"</span></span> <span>targetRef</span><span><span>=</span><span>\"</span>sendMail<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>conditionExpression</span> <span><span>xsi:</span>type</span><span><span>=</span><span>\"</span>tFormalExpression<span>\"</span></span><span>></span></span><span>&lt;![CDATA[${checkResult=='拒绝'}]]></span><span><span><span>&lt;/</span>conditionExpression</span><span>></span></span>\n  <span><span><span>&lt;/</span>sequenceFlow</span><span>></span></span>\n  <span><span><span>&lt;</span>serviceTask</span> <span>id</span><span><span>=</span><span>\"</span>sendMail<span>\"</span></span> <span><span>flowable:</span>exclusive</span><span><span>=</span><span>\"</span>true<span>\"</span></span> <span>name</span><span><span>=</span><span>\"</span>发送失败提示<span>\"</span></span> <span>isForCompensation</span><span><span>=</span><span>\"</span>true<span>\"</span></span> <span><span>flowable:</span>class</span><span><span>=</span><span>\"</span>org.javaboy.flowable.AskForLeaveFail<span>\"</span></span><span>/></span></span>\n  <span><span><span>&lt;</span>sequenceFlow</span> <span>id</span><span><span>=</span><span>\"</span>endFlow<span>\"</span></span> <span>sourceRef</span><span><span>=</span><span>\"</span>sendMail<span>\"</span></span> <span>targetRef</span><span><span>=</span><span>\"</span>askForLeaveFail<span>\"</span></span><span>/></span></span>\n  <span><span><span>&lt;</span>endEvent</span> <span>id</span><span><span>=</span><span>\"</span>askForLeaveFail<span>\"</span></span> <span>name</span><span><span>=</span><span>\"</span>请假失败<span>\"</span></span><span>/></span></span>\n  <span><span><span>&lt;</span>sequenceFlow</span> <span>id</span><span><span>=</span><span>\"</span>zuzhangTask_zuzhangJudeTask<span>\"</span></span> <span>sourceRef</span><span><span>=</span><span>\"</span>zuzhangTask<span>\"</span></span> <span>targetRef</span><span><span>=</span><span>\"</span>zuzhangJudeTask<span>\"</span></span><span>/></span></span>\n<span><span><span>&lt;/</span>process</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>结合 XML 文件我来和大家解释一下这里涉及到的 Flowable 中的组件，我们来看下：</p>\n<ul>\n<li><code>&lt;process&gt;</code> ： 表示一个完整的工作流程。</li>\n<li><code>&lt;startEvent&gt;</code> ： 工作流中起点位置，也就是图中的绿色按钮。</li>\n<li><code>&lt;endEvent&gt;</code> ： 工作流中结束位置，也就是图中的红色按钮。</li>\n<li><code>&lt;userTask&gt;</code> ： 代表一个任务审核节点（组长、经理等角色），这个节点上有一个<code>flowable:assignee</code> 属性，这表示这个节点该由谁来处理，将来在 Java 代码中调用的时候，我们需要指定对应的处理人的 ID 或者其他唯一标记。</li>\n<li><code>&lt;serviceTask&gt;</code>：这是服务任务，在具体的实现中，这个任务可以做任何事情。</li>\n<li><code>&lt;exclusiveGateway&gt;</code> ： 逻辑判断节点，相当于流程图中的菱形框。</li>\n<li><code>&lt;sequenceFlow&gt;</code> ：链接各个节点的线条，sourceRef 属性表示线的起始节点，targetRef 属性表示线指向的节点，我们图中的线条都属于这种。</li>\n</ul>\n<p>流程图这块松哥和大家稍微说一下，咋一看这个图挺复杂很难画，但是实际上只要你认认真真去捋一捋这里边的各个属性，基本上很快就明白到底是怎么一回事，我也相信各位小伙伴都有这样的悟性。</p>\n<h2 id=\"_4-开发接口\" tabindex=\"-1\"> 4. 开发接口</h2>\n<p>接下来我们写几个接口，来体验一把流程引擎。</p>\n<p>在正式体验之前，我们先来熟悉几个类，这几个类我们一会写代码会用到。</p>\n<h3 id=\"_4-1-java-类梳理\" tabindex=\"-1\"> 4.1 Java 类梳理</h3>\n<ul>\n<li>ProcessDefinition</li>\n</ul>\n<p>这个最好理解，就是流程的定义，也就相当于规范，每个 ProcessDefinition 都会有一个 id。</p>\n<ul>\n<li>ProcessInstance</li>\n</ul>\n<p>这个就是流程的一个实例。简单来说，ProcessDefinition 相当于是类，而 ProcessInstance 则相当于是根据类 new 出来的对象。</p>\n<ul>\n<li>Activity</li>\n</ul>\n<p>Activity 是流程标准规范 BPMN2.0 里面的规范，流程中的每一个步骤都是一个 Activity。</p>\n<ul>\n<li>Execution</li>\n</ul>\n<p>Execution 的含义是流程的执行线路，通过 Execution 可以获得当前 ProcessInstance 当前执行到哪个 Activity了。</p>\n<ul>\n<li>Task</li>\n</ul>\n<p>Task 就是当前要做的工作。</p>\n<p>实际上这里涉及到的东西比较多，不过我们今天先整一个简单的例子，所以上面这些知识点暂时够用了。</p>\n<h3 id=\"_4-2-查看流程图\" tabindex=\"-1\"> 4.2 查看流程图</h3>\n<p>在正式开始之前，我们先准备一个接口，用来查看流程图的实时执行情况，这样方便我们查看流程到底执行到哪一步了。</p>\n<p>具体的代码如下：</p>\n<div><pre><code><span>@RestController</span>\n<span>public</span> <span>class</span> <span>HelloController</span> <span>{</span>\n\n    <span>@Autowired</span>\n    <span>RuntimeService</span> runtimeService<span>;</span>\n\n    <span>@Autowired</span>\n    <span>TaskService</span> taskService<span>;</span>\n\n    <span>@Autowired</span>\n    <span>RepositoryService</span> repositoryService<span>;</span>\n\n    <span>@Autowired</span>\n    <span>ProcessEngine</span> processEngine<span>;</span>\n\n    <span>@GetMapping</span><span>(</span><span>\"/pic\"</span><span>)</span>\n    <span>public</span> <span>void</span> <span>showPic</span><span>(</span><span>HttpServletResponse</span> resp<span>,</span> <span>String</span> processId<span>)</span> <span>throws</span> <span>Exception</span> <span>{</span>\n        <span>ProcessInstance</span> pi <span>=</span> runtimeService<span>.</span><span>createProcessInstanceQuery</span><span>(</span><span>)</span><span>.</span><span>processInstanceId</span><span>(</span>processId<span>)</span><span>.</span><span>singleResult</span><span>(</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span>pi <span>==</span> <span>null</span><span>)</span> <span>{</span>\n            <span>return</span><span>;</span>\n        <span>}</span>\n        <span>List</span><span><span>&lt;</span><span>Execution</span><span>></span></span> executions <span>=</span> runtimeService\n                <span>.</span><span>createExecutionQuery</span><span>(</span><span>)</span>\n                <span>.</span><span>processInstanceId</span><span>(</span>processId<span>)</span>\n                <span>.</span><span>list</span><span>(</span><span>)</span><span>;</span>\n\n        <span>List</span><span><span>&lt;</span><span>String</span><span>></span></span> activityIds <span>=</span> <span>new</span> <span>ArrayList</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        <span>List</span><span><span>&lt;</span><span>String</span><span>></span></span> flows <span>=</span> <span>new</span> <span>ArrayList</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        <span>for</span> <span>(</span><span>Execution</span> exe <span>:</span> executions<span>)</span> <span>{</span>\n            <span>List</span><span><span>&lt;</span><span>String</span><span>></span></span> ids <span>=</span> runtimeService<span>.</span><span>getActiveActivityIds</span><span>(</span>exe<span>.</span><span>getId</span><span>(</span><span>)</span><span>)</span><span>;</span>\n            activityIds<span>.</span><span>addAll</span><span>(</span>ids<span>)</span><span>;</span>\n        <span>}</span>\n\n        <span>/**\n         * 生成流程图\n         */</span>\n        <span>BpmnModel</span> bpmnModel <span>=</span> repositoryService<span>.</span><span>getBpmnModel</span><span>(</span>pi<span>.</span><span>getProcessDefinitionId</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>ProcessEngineConfiguration</span> engconf <span>=</span> processEngine<span>.</span><span>getProcessEngineConfiguration</span><span>(</span><span>)</span><span>;</span>\n        <span>ProcessDiagramGenerator</span> diagramGenerator <span>=</span> engconf<span>.</span><span>getProcessDiagramGenerator</span><span>(</span><span>)</span><span>;</span>\n        <span>InputStream</span> in <span>=</span> diagramGenerator<span>.</span><span>generateDiagram</span><span>(</span>bpmnModel<span>,</span> <span>\"png\"</span><span>,</span> activityIds<span>,</span> flows<span>,</span> engconf<span>.</span><span>getActivityFontName</span><span>(</span><span>)</span><span>,</span> engconf<span>.</span><span>getLabelFontName</span><span>(</span><span>)</span><span>,</span> engconf<span>.</span><span>getAnnotationFontName</span><span>(</span><span>)</span><span>,</span> engconf<span>.</span><span>getClassLoader</span><span>(</span><span>)</span><span>,</span> <span>1.0</span><span>,</span> <span>false</span><span>)</span><span>;</span>\n        <span>OutputStream</span> out <span>=</span> <span>null</span><span>;</span>\n        <span>byte</span><span>[</span><span>]</span> buf <span>=</span> <span>new</span> <span>byte</span><span>[</span><span>1024</span><span>]</span><span>;</span>\n        <span>int</span> legth <span>=</span> <span>0</span><span>;</span>\n        <span>try</span> <span>{</span>\n            out <span>=</span> resp<span>.</span><span>getOutputStream</span><span>(</span><span>)</span><span>;</span>\n            <span>while</span> <span>(</span><span>(</span>legth <span>=</span> in<span>.</span><span>read</span><span>(</span>buf<span>)</span><span>)</span> <span>!=</span> <span>-</span><span>1</span><span>)</span> <span>{</span>\n                out<span>.</span><span>write</span><span>(</span>buf<span>,</span> <span>0</span><span>,</span> legth<span>)</span><span>;</span>\n            <span>}</span>\n        <span>}</span> <span>finally</span> <span>{</span>\n            <span>if</span> <span>(</span>in <span>!=</span> <span>null</span><span>)</span> <span>{</span>\n                in<span>.</span><span>close</span><span>(</span><span>)</span><span>;</span>\n            <span>}</span>\n            <span>if</span> <span>(</span>out <span>!=</span> <span>null</span><span>)</span> <span>{</span>\n                out<span>.</span><span>close</span><span>(</span><span>)</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>这就一个工具，没啥好说的，一会大家看完后面的代码，再回过头来看这个接口，很多地方就都懂了。</p>\n<h3 id=\"_4-3-开启一个流程\" tabindex=\"-1\"> 4.3 开启一个流程</h3>\n<p>为了方便，接下来的代码我们都在单元测试中完成。</p>\n<p>首先我们来开启一个流程，代码如下：</p>\n<div><pre><code><span>String</span> staffId <span>=</span> <span>\"1000\"</span><span>;</span>\n<span>/**\n * 开启一个流程\n */</span>\n<span>@Test</span>\n<span>void</span> <span>askForLeave</span><span>(</span><span>)</span> <span>{</span>\n    <span>HashMap</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> map <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n    map<span>.</span><span>put</span><span>(</span><span>\"leaveTask\"</span><span>,</span> staffId<span>)</span><span>;</span>\n    <span>ProcessInstance</span> processInstance <span>=</span> runtimeService<span>.</span><span>startProcessInstanceByKey</span><span>(</span><span>\"ask_for_leave\"</span><span>,</span> map<span>)</span><span>;</span>\n    runtimeService<span>.</span><span>setVariable</span><span>(</span>processInstance<span>.</span><span>getId</span><span>(</span><span>)</span><span>,</span> <span>\"name\"</span><span>,</span> <span>\"javaboy\"</span><span>)</span><span>;</span>\n    runtimeService<span>.</span><span>setVariable</span><span>(</span>processInstance<span>.</span><span>getId</span><span>(</span><span>)</span><span>,</span> <span>\"reason\"</span><span>,</span> <span>\"休息一下\"</span><span>)</span><span>;</span>\n    runtimeService<span>.</span><span>setVariable</span><span>(</span>processInstance<span>.</span><span>getId</span><span>(</span><span>)</span><span>,</span> <span>\"days\"</span><span>,</span> <span>10</span><span>)</span><span>;</span>\n    logger<span>.</span><span>info</span><span>(</span><span>\"创建请假流程 processId：{}\"</span><span>,</span> processInstance<span>.</span><span>getId</span><span>(</span><span>)</span><span>)</span><span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>首先由员工发起一个请假流程，map 中存放的 leaveTask 是我们在 XML 流程文件中提前定义好的，提前定义好当前这个任务创建之后，该由谁来处理，这里我们是假设由工号为 1000 的员工来发起这样一个请假流程。同时，我们还设置了一些额外信息。ask_for_leave 是我们在 XML 文件中定义的一个 process 的名称。</p>\n<p>好啦，现在我们执行这个单元测试方法，执行完成后，控制台会打印出当前这个流程的 id，我们拿着这个 id 去访问 4.2 小节的接口，结果如下：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/19013240_62852db86702137091.png\" alt=\"Spring Boot 整合流程引擎 Flowable，so easy_java_06\"></p>\n<p>可以看到，请假用红色的框框起来了，说明当前流程走到了这一步。</p>\n<h3 id=\"_4-4-将请求提交给组长\" tabindex=\"-1\"> 4.4 将请求提交给组长</h3>\n<p>接下来，我们就需要将这个请假流程向后推进一步，将请假事务提交给组长，代码如下：</p>\n<div><pre><code><span>String</span> zuzhangId <span>=</span> <span>\"90\"</span><span>;</span>\n<span>/**\n * 提交给组长审批\n */</span>\n<span>@Test</span>\n<span>void</span> <span>submitToZuzhang</span><span>(</span><span>)</span> <span>{</span>\n    <span>//员工查找到自己的任务，然后提交给组长审批</span>\n    <span>List</span><span><span>&lt;</span><span>Task</span><span>></span></span> list <span>=</span> taskService<span>.</span><span>createTaskQuery</span><span>(</span><span>)</span><span>.</span><span>taskAssignee</span><span>(</span>staffId<span>)</span><span>.</span><span>orderByTaskId</span><span>(</span><span>)</span><span>.</span><span>desc</span><span>(</span><span>)</span><span>.</span><span>list</span><span>(</span><span>)</span><span>;</span>\n    <span>for</span> <span>(</span><span>Task</span> task <span>:</span> list<span>)</span> <span>{</span>\n        logger<span>.</span><span>info</span><span>(</span><span>\"任务 ID：{}；任务处理人：{}；任务是否挂起：{}\"</span><span>,</span> task<span>.</span><span>getId</span><span>(</span><span>)</span><span>,</span> task<span>.</span><span>getAssignee</span><span>(</span><span>)</span><span>,</span> task<span>.</span><span>isSuspended</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> map <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        <span>//提交给组长的时候，需要指定组长的 id</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"zuzhangTask\"</span><span>,</span> zuzhangId<span>)</span><span>;</span>\n        taskService<span>.</span><span>complete</span><span>(</span>task<span>.</span><span>getId</span><span>(</span><span>)</span><span>,</span> map<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>首先我们利用 staffId 查找到当前员工的 id，进而找到当前员工需要执行的任务，遍历这个任务，调用 taskService.complete 方法将任务提交给组长，注意在 map 中指定组长的 id。</p>\n<p>提交完成后，我们再去看流程图片，如下：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/19013240_62852db8757ea39709.png\" alt=\"Spring Boot 整合流程引擎 Flowable，so easy_mysql_07\"></p>\n<p>可以看到，流程图走到组长审批了。</p>\n<h3 id=\"_4-5-组长审批\" tabindex=\"-1\"> 4.5 组长审批</h3>\n<p>组长现在有两种选择，同意或者拒绝，同意的代码如下：</p>\n<div><pre><code><span>/**\n * 组长审批-批准\n */</span>\n<span>@Test</span>\n<span>void</span> <span>zuZhangApprove</span><span>(</span><span>)</span> <span>{</span>\n    <span>List</span><span><span>&lt;</span><span>Task</span><span>></span></span> list <span>=</span> taskService<span>.</span><span>createTaskQuery</span><span>(</span><span>)</span><span>.</span><span>taskAssignee</span><span>(</span>zuzhangId<span>)</span><span>.</span><span>orderByTaskId</span><span>(</span><span>)</span><span>.</span><span>desc</span><span>(</span><span>)</span><span>.</span><span>list</span><span>(</span><span>)</span><span>;</span>\n    <span>for</span> <span>(</span><span>Task</span> task <span>:</span> list<span>)</span> <span>{</span>\n        logger<span>.</span><span>info</span><span>(</span><span>\"组长 {} 在审批 {} 任务\"</span><span>,</span> task<span>.</span><span>getAssignee</span><span>(</span><span>)</span><span>,</span> task<span>.</span><span>getId</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> map <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        <span>//组长审批的时候，如果是同意，需要指定经理的 id</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"managerTask\"</span><span>,</span> managerId<span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"checkResult\"</span><span>,</span> <span>\"通过\"</span><span>)</span><span>;</span>\n        taskService<span>.</span><span>complete</span><span>(</span>task<span>.</span><span>getId</span><span>(</span><span>)</span><span>,</span> map<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>通过组长的 id 查询组长的任务，同意的话，需要指定经理，也就是这个流程下一步该由谁来处理。</p>\n<p>拒绝的代码如下：</p>\n<div><pre><code><span>/**\n * 组长审批-拒绝\n */</span>\n<span>@Test</span>\n<span>void</span> <span>zuZhangReject</span><span>(</span><span>)</span> <span>{</span>\n    <span>List</span><span><span>&lt;</span><span>Task</span><span>></span></span> list <span>=</span> taskService<span>.</span><span>createTaskQuery</span><span>(</span><span>)</span><span>.</span><span>taskAssignee</span><span>(</span>zuzhangId<span>)</span><span>.</span><span>orderByTaskId</span><span>(</span><span>)</span><span>.</span><span>desc</span><span>(</span><span>)</span><span>.</span><span>list</span><span>(</span><span>)</span><span>;</span>\n    <span>for</span> <span>(</span><span>Task</span> task <span>:</span> list<span>)</span> <span>{</span>\n        logger<span>.</span><span>info</span><span>(</span><span>\"组长 {} 在审批 {} 任务\"</span><span>,</span> task<span>.</span><span>getAssignee</span><span>(</span><span>)</span><span>,</span> task<span>.</span><span>getId</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> map <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        <span>//组长审批的时候，如果是拒绝，就不需要指定经理的 id</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"checkResult\"</span><span>,</span> <span>\"拒绝\"</span><span>)</span><span>;</span>\n        taskService<span>.</span><span>complete</span><span>(</span>task<span>.</span><span>getId</span><span>(</span><span>)</span><span>,</span> map<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>拒绝的话，就没那么多事了，直接设置 checkResult 为拒绝即可。</p>\n<p>假设这里执行了同意，那么流程图如下：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/19013240_62852db88301484841.png\" alt=\"Spring Boot 整合流程引擎 Flowable，so easy_spring boot_08\"></p>\n<h3 id=\"_4-6-经理审批\" tabindex=\"-1\"> 4.6 经理审批</h3>\n<p>经理审批和组长审批差不多，只不过经理这里是最后一步了，不需要再指定下一位处理人了，同意的代码如下：</p>\n<div><pre><code><span>/**\n * 经理审批自己的任务-批准\n */</span>\n<span>@Test</span>\n<span>void</span> <span>managerApprove</span><span>(</span><span>)</span> <span>{</span>\n    <span>List</span><span><span>&lt;</span><span>Task</span><span>></span></span> list <span>=</span> taskService<span>.</span><span>createTaskQuery</span><span>(</span><span>)</span><span>.</span><span>taskAssignee</span><span>(</span>managerId<span>)</span><span>.</span><span>orderByTaskId</span><span>(</span><span>)</span><span>.</span><span>desc</span><span>(</span><span>)</span><span>.</span><span>list</span><span>(</span><span>)</span><span>;</span>\n    <span>for</span> <span>(</span><span>Task</span> task <span>:</span> list<span>)</span> <span>{</span>\n        logger<span>.</span><span>info</span><span>(</span><span>\"经理 {} 在审批 {} 任务\"</span><span>,</span> task<span>.</span><span>getAssignee</span><span>(</span><span>)</span><span>,</span> task<span>.</span><span>getId</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> map <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"checkResult\"</span><span>,</span> <span>\"通过\"</span><span>)</span><span>;</span>\n        taskService<span>.</span><span>complete</span><span>(</span>task<span>.</span><span>getId</span><span>(</span><span>)</span><span>,</span> map<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>拒绝代码如下：</p>\n<div><pre><code><span>/**\n * 经理审批自己的任务-拒绝\n */</span>\n<span>@Test</span>\n<span>void</span> <span>managerReject</span><span>(</span><span>)</span> <span>{</span>\n    <span>List</span><span><span>&lt;</span><span>Task</span><span>></span></span> list <span>=</span> taskService<span>.</span><span>createTaskQuery</span><span>(</span><span>)</span><span>.</span><span>taskAssignee</span><span>(</span>managerId<span>)</span><span>.</span><span>orderByTaskId</span><span>(</span><span>)</span><span>.</span><span>desc</span><span>(</span><span>)</span><span>.</span><span>list</span><span>(</span><span>)</span><span>;</span>\n    <span>for</span> <span>(</span><span>Task</span> task <span>:</span> list<span>)</span> <span>{</span>\n        logger<span>.</span><span>info</span><span>(</span><span>\"经理 {} 在审批 {} 任务\"</span><span>,</span> task<span>.</span><span>getAssignee</span><span>(</span><span>)</span><span>,</span> task<span>.</span><span>getId</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> map <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"checkResult\"</span><span>,</span> <span>\"拒绝\"</span><span>)</span><span>;</span>\n        taskService<span>.</span><span>complete</span><span>(</span>task<span>.</span><span>getId</span><span>(</span><span>)</span><span>,</span> map<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"_4-7-拒绝流程\" tabindex=\"-1\"> 4.7 拒绝流程</h3>\n<p>如果组长拒绝了或者经理拒绝了，我们也有相应的处理方案，首先在 XML 流程文件定义时，如下：</p>\n<div><pre><code><span><span><span>&lt;</span>serviceTask</span> <span>id</span><span><span>=</span><span>\"</span>sendMail<span>\"</span></span> <span><span>flowable:</span>exclusive</span><span><span>=</span><span>\"</span>true<span>\"</span></span> <span>name</span><span><span>=</span><span>\"</span>发送失败提示<span>\"</span></span> <span>isForCompensation</span><span><span>=</span><span>\"</span>true<span>\"</span></span> <span><span>flowable:</span>class</span><span><span>=</span><span>\"</span>org.javaboy.flowable.AskForLeaveFail<span>\"</span></span><span>/></span></span>1.\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>如果请假被拒绝，会进入到这个 serviceTask，serviceTask 对应的处理类是 org.javaboy.flowable.AskForLeaveFail，该类的代码如下：</p>\n<div><pre><code><span>public</span> <span>class</span> <span>AskForLeaveFail</span> <span>implements</span> <span>JavaDelegate</span> <span>{</span>\n    <span>@Override</span>\n    <span>public</span> <span>void</span> <span>execute</span><span>(</span><span>DelegateExecution</span> execution<span>)</span> <span>{</span>\n        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"请假失败。。。\"</span><span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>也就是请假失败会进入到这个方法中，现在我们就可以在这个方法中该干嘛干嘛了。</p>\n<h2 id=\"启动报错解决\" tabindex=\"-1\"> 启动报错解决</h2>\n<h3 id=\"flowable启动自动建表失败table-mes-design-test-act-ge-property-doesn-t-exist\" tabindex=\"-1\"> flowable启动自动建表失败Table ‘mes_design_test.act_ge_property‘ doesn‘t exist</h3>\n<div><pre><code><span>--</span><span>-</span> <span>[</span>           main<span>]</span> <span><span>o<span>.</span>f<span>.</span>c<span>.</span>e<span>.</span>impl<span>.</span>db<span>.</span></span>CommonDbSchemaManager</span>    <span>:</span> <span>Could</span> not get property from table ACT_GE_PROPERTY\n \n<span><span>java<span>.</span>sql<span>.</span></span>SQLSyntaxErrorException</span><span>:</span> <span>Table</span> 'mes_design_test<span>.</span>act_ge_property<span>' doesn'</span>t exist\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p><strong>解决</strong></p>\n<p>我的数据库是MySQL8。</p>\n<p>​    经过查询和尝试，原因是：在这个数据库里面，已经有一个数据库里面有activiti的这些表了，它检索的时候全库检索查到它了，所以flowable不去建表了，但是我们指定的这个schema里卖弄还是空的，所以它报了找不到表。</p>\n<p>​    解决方法：mysql的链接上加上参数如下，让本schema成为默认的schema。</p>\n<div><pre><code><span>&amp;</span>nullCatalogMeansCurrent<span>=</span><span>true</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div>",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/19013239_62852db7da56536801.png",
      "date_published": "2022-07-04T00:00:00.000Z",
      "date_modified": "2022-06-29T05:52:54.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "Thanox 情景模式",
      "url": "https://blog.ciberviler.top/daily/Thanox%E6%83%85%E6%99%AF%E6%A8%A1%E5%BC%8F.html",
      "id": "https://blog.ciberviler.top/daily/Thanox%E6%83%85%E6%99%AF%E6%A8%A1%E5%BC%8F.html",
      "summary": "Thanox 情景模式",
      "content_html": "<h1 id=\"thanox-情景模式\" tabindex=\"-1\"> Thanox 情景模式</h1>\n<p>QQ、微信、TIM、网易云音乐，减少cpu、内存RAM占用 ——thanox情景模式自定义策略方案</p>\n<p>QQ优能、微信优能、TIM优能、网易云优能——系列情景模式</p>\n<p>之前发帖后一小会儿就删了，结果有情景模式流出，单个情景模式可能有不生效的情况。网易云音乐难以生效就单独发了个网易云的（结合乖巧模式），原本乖巧模式最好搭配后台启动规则使用，情景模式又要搭配乖巧模式使用。情景模式单独生效是意外之喜。</p>\n<p>这里只是利用thanox情景模式触发执行命令，应该也可以用Xposed edge、Automate、Tasker、Macrodroid等软件实现。</p>\n<p>原本是情景模式、乖巧模式、后台启动规则搭配使用。有些应用在单独使用情景模式时即可生效，有些需要加乖巧模式、后台启动规则，以及去除电池省电白名单。</p>\n<h2 id=\"一、分别介绍-乖巧模式、后台启动规则、命令\" tabindex=\"-1\"> 一、分别介绍 乖巧模式、后台启动规则、命令</h2>\n<p>1乖巧模式和乖巧规则参考</p>\n<p>乖巧模式设置：开启停止服务、阻止服务重启选项。</p>\n<p>乖巧规则：参照视频打开QQ 、TIM，在运行的服务中搜索msf。网易云音乐com.netease.cloudmusic/com.netease.cloudmusic.service.PlayService（关键字PlayService）</p>\n<p>2后台启动规则三条：\n（并考虑把后台启动规则也添加到乖巧模式规则中）</p>\n<p>DENY 包名 包名</p>\n<p>DENY * 包名</p>\n<p>DENY android 包名</p>\n<p>（根据情况对三条规则进行增减。有时可能导致限制应用过于严格，就考虑减少一些规则，但在使用中发现限制效果并不是十分明显，比如DENY 包名 包名 本应达到只启动主进程、禁止主进程启动其他进程、打开应用只有一个进程的效果。）</p>\n<p>3shell命令</p>\n<p>kill -9杀掉程序运行时的非必要进程</p>\n<p>kill -19 暂停 杀<em>不</em>掉的程序运行时的非必要进程</p>\n<p>使用场景有前台和后台的不同， 前台运行时依然可以选择使用kill -19暂停非必要进程。</p>\n<p>长时间不使用时用kill -9杀掉程序运行时的非必要进程，</p>\n<p>频繁切换使用kill -19暂停程序运行时的非必要进程。</p>\n<p>含义：（ps -ef|grep <a href=\"http://com.tencent.mm\" target=\"_blank\" rel=\"noopener noreferrer\">com.tencent.mm</a>:|grep -v push|grep -v grep|awk '{print $2}'|xargs kill -9\\） ps（显示正在运行进程） -ef（前者基础上显示全部） | grep（搜索） <a href=\"http://com.tencent.mm\" target=\"_blank\" rel=\"noopener noreferrer\">com.tencent.mm</a>（微信包名） | grep -v push 排除在之前搜索结果中包含带有push的进程 | grep -v grep | awk '{print $2}' （提取进程pid）| xargs kill -9（杀死之前命令的输出结果--pid）。 单独运行某个“|”之前的部分确保输出结果正确。</p>\n<p>主进程以外的进程都包含“：”，所以搜索包名加冒号就排除了（保留）主进程，去除“：”就会把主进程也处理掉，比如在实现软件后台单进程运行的时候用（比如网易云\\QQ\\TIM,此时会关闭程序主界面，再次打开程序需要重新启动主进程、加载主界面)</p>\n<p>有些杀不掉的进程就用参照上面命令grep -v排除掉（也可以考虑禁掉对应的服务）然后附加一条针对那个进程单独添加一条命令ps -ef|grep <a href=\"http://com.tencent.mm\" target=\"_blank\" rel=\"noopener noreferrer\">com.tencent.mm</a>:push|grep -v grep|awk '{print $2}'|xargs kill -19 （把9改成19 、直接搜索完整进程名grep <a href=\"http://com.tencent.mm\" target=\"_blank\" rel=\"noopener noreferrer\">com.tencent.mm</a>:push），然后grep <a href=\"http://com.tencent.mm\" target=\"_blank\" rel=\"noopener noreferrer\">com.tencent.mm</a>:push就不会占用cpu了。主进程可能会随着使用程序的更多功能导致内存占用变高，重启程序可减少内存占用（乖巧模式视频中重启了微信）。</p>\n<h2 id=\"二情景模式\" tabindex=\"-1\"> 二情景模式</h2>\n<p>1需要下载su插件 地址（新版thanox的插件仓库中已预存插件 直接安装即可）<a href=\"https://github.com/Tornaco/Thanox/releases/download/v1.2.2/plugin_su_enabler_1.2.2-dirty.tp\" target=\"_blank\" rel=\"noopener noreferrer\">查看链接</a> 设置插件允许 root。</p>\n<p>2触发条件 比较实用的</p>\n<p>&quot;condition&quot;: &quot;systemReady == true &quot;, 开机触发</p>\n<p>&quot;condition&quot;: &quot;screenOff==true&quot;, 关闭屏幕触发</p>\n<p>input.getLastKey() == 4 按返回键触发（支持按键模拟主页键返回键任务键，比如悬浮球菜单、Xposed edge手势）</p>\n<p>3 QQ、微信、TIM、网易云音乐 情景模式说明：</p>\n<p>微信：双进程版和暂停进程版</p>\n<p>QQ、TIM、网易云音乐：双进程版和暂停进程版+单进程版</p>\n<p>根据不同使用场景任意切换（支持按键模拟，比如悬浮球菜单、Xposed edge手势等）</p>\n<p>双进程版：在应用程序界面按 &lt;主页键&gt; 导致离开应用程序界面时触发</p>\n<p>和暂停进程版：在应用程序界面按 &lt;任务键&gt; 导致离开应用程序界面时触发</p>\n<p>单进程版：在应用程序界面按 &lt;返回键&gt; 导致离开应用程序界面时触发</p>\n<p>（通过通知栏、手势等使程序后台则不执行）</p>\n<p>附情景模式：</p>\n<div><pre><code><span>[</span>\n  <span>{</span>\n    <span>\"name\"</span><span>:</span> <span>\"[测试用] \"</span><span>,</span>\n    <span>\"description\"</span><span>:</span> <span>\"点击home键关闭蓝牙且提示ok。 用以检查按键触发条件可用性和是否按键混淆(比如按下主页键再按任务键可能导致两个键均能触发，或点击屏幕任何位置都触发) 。(input.getLastKey == 187按下任务键触发,input.getLastKey == 4按下返回键触发。) (标准写法input.getLastKey() == 3) \"</span><span>,</span>\n    <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n    <span>\"condition\"</span><span>:</span> <span>\"input.getLastKey == 3\"</span><span>,</span>\n    <span>\"actions\"</span><span>:</span> <span>[</span>\n      <span>\"hw.disableBT()\"</span><span>,</span>\n      <span>\"ui.showShortToast(\\\"OK\\\");\"</span>\n    <span>]</span>\n  <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"微信\" tabindex=\"-1\"> 微信：</h3>\n<div><pre><code><span>[</span>\n  <span>{</span>\n    <span>\"name\"</span><span>:</span> <span>\"微信优能 双进程\"</span><span>,</span>\n    <span>\"description\"</span><span>:</span> <span>\"离开微信界面，结束主进程和push以外的微信进程。\"</span><span>,</span>\n    <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n    <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; from == \\\"com.tencent.mm\\\"\"</span><span>,</span>\n    <span>\"actions\"</span><span>:</span> <span>[</span>\n      <span>\"Thread.sleep(5000);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.mm:|grep -v push|grep -v grep|awk '{print $2}'|xargs kill -19\\\");\"</span><span>,</span>\n      <span>\"Thread.sleep(30000);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.mm:|grep -v push|grep -v grep|awk '{print $2}'|xargs kill -9\\\");\"</span>\n    <span>]</span>\n  <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>[</span>\n  <span>{</span>\n    <span>\"name\"</span><span>:</span> <span>\"微信优能 双进程 按键触发 测试\"</span><span>,</span>\n    <span>\"description\"</span><span>:</span> <span>\"按下主页导致离开微信界面，结束主进程和push以外的微信进程。按其他键导致微信后台则不执行（通过通知栏、手势使程序后台也不执行）（支持按键模拟主页键返回键任务键，比如悬浮球菜单、Xposed edge手势）。（单双进程版原本是情景模式、乖巧模式、后台启动规则搭配使用的（暂停进程版不需要），单独使用情景模式或依然生效。）\"</span><span>,</span>\n    <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n    <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; from == \\\"com.tencent.mm\\\" &amp;&amp; input.getLastKey() == 3\"</span><span>,</span>\n    <span>\"actions\"</span><span>:</span> <span>[</span>\n      <span>\"Thread.sleep(500);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.mm:|grep -v push|grep -v grep|awk '{print $2}'|xargs kill -19\\\");\"</span><span>,</span>\n      <span>\"Thread.sleep(500);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.mm:|grep -v push|grep -v grep|awk '{print $2}'|xargs kill -9\\\");\"</span>\n    <span>]</span>\n  <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>[</span>\n  <span>{</span>\n    <span>\"name\"</span><span>:</span> <span>\"微信优能 暂停进程版 按键触发 测试\"</span><span>,</span>\n    <span>\"description\"</span><span>:</span> <span>\"按下任务键导致离开微信界面，暂停主进程和push以外的微信进程。按其他键导致微信后台则不执行（通过通知栏、手势使程序后台也不执行）（支持按键模拟主页键返回键任务键，比如悬浮球菜单、Xposed edge手势）。（单双进程版原本是情景模式、乖巧模式、后台启动规则搭配使用的（暂停进程版不需要），单独使用情景模式或依然生效。）\"</span><span>,</span>\n    <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n    <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; from == \\\"com.tencent.mm\\\" &amp;&amp; input.getLastKey() == 187\"</span><span>,</span>\n    <span>\"actions\"</span><span>:</span> <span>[</span>\n      <span>\"Thread.sleep(500);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.mm:|grep -v push|grep -v grep|awk '{print $2}'|xargs kill -19\\\");\"</span>\n    <span>]</span>\n  <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>[</span>\n  <span>{</span>\n    <span>\"name\"</span><span>:</span> <span>\"微信优能 恢复被暂停的进程通用版 按键触发 测试\"</span><span>,</span>\n    <span>\"description\"</span><span>:</span> <span>\"打开微信主程序界面 恢复被暂停的进程\"</span><span>,</span>\n    <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n    <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; to == \\\"com.tencent.mm\\\"\"</span><span>,</span>\n    <span>\"actions\"</span><span>:</span> <span>[</span>\n      <span>\"Thread.sleep(500);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.mm|grep -v grep|awk '{print $2}'|xargs kill -18\\\");\"</span>\n    <span>]</span>\n  <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"qq\" tabindex=\"-1\"> QQ:</h3>\n<div><pre><code><span>[</span>\n  <span>{</span>\n    <span>\"name\"</span><span>:</span> <span>\"QQ优能 双进程版\"</span><span>,</span>\n    <span>\"description\"</span><span>:</span> <span>\"离开QQ主程序界面，结束主进程和MSF以外的进程。\"</span><span>,</span>\n    <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n    <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; from == \\\"tencent.mobileqq\\\"\"</span><span>,</span>\n    <span>\"actions\"</span><span>:</span> <span>[</span>\n      <span>\"Thread.sleep(5000);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.mobileqq:|grep -v MSF|grep -v grep|awk '{print $2}'|xargs kill -19\\\")\"</span><span>,</span>\n      <span>\"Thread.sleep(30000);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.mobileqq:|grep -v MSF|grep -v grep|awk '{print $2}'|xargs kill -9\\\");\"</span>\n    <span>]</span>\n  <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>[</span>\n  <span>{</span>\n    <span>\"name\"</span><span>:</span> <span>\"QQ优能 双进程版 按键触发 测试\"</span><span>,</span>\n    <span>\"description\"</span><span>:</span> <span>\"按下主页键导致离开QQ主程序界面，结束主进程和MSF以外的进程。按其他键导致QQ后台则不执行（通过通知栏、手势使程序后台也不执行）（支持按键模拟主页键返回键任务键，比如悬浮球菜单、Xposed edge手势）。（单双进程版原本是情景模式、乖巧模式、后台启动规则搭配使用的（暂停进程版不需要），单独使用情景模式或依然生效。）\"</span><span>,</span>\n    <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n    <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; from == \\\"tencent.mobileqq\\\" &amp;&amp; input.getLastKey() == 3\"</span><span>,</span>\n    <span>\"actions\"</span><span>:</span> <span>[</span>\n      <span>\"Thread.sleep(200);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.mobileqq:|grep -v MSF|grep -v grep|awk '{print $2}'|xargs kill -19\\\")\"</span><span>,</span>\n      <span>\"Thread.sleep(200);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.mobileqq:|grep -v MSF|grep -v grep|awk '{print $2}'|xargs kill -9\\\");\"</span>\n    <span>]</span>\n  <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>[</span>\n  <span>{</span>\n    <span>\"name\"</span><span>:</span> <span>\"QQ优能 单进程版 按键触发 测试\"</span><span>,</span>\n    <span>\"description\"</span><span>:</span> <span>\"按下返回键导致离开QQ主程序界面，结束MSF以外的QQ进程。按其他键导致QQ后台则不执行（通过通知栏、手势使程序后台也不执行）（支持按键模拟主页键返回键任务键，比如悬浮球菜单、Xposed edge手势）。（单双进程版原本是情景模式、乖巧模式、后台启动规则搭配使用的（暂停进程版不需要），单独使用情景模式或依然生效。）\"</span><span>,</span>\n    <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n    <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; from == \\\"com.tencent.tim\\\" &amp;&amp; input.getLastKey() == 4\"</span><span>,</span>\n    <span>\"actions\"</span><span>:</span> <span>[</span>\n      <span>\"Thread.sleep(200);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.mobileqq|grep -v MSF|grep -v grep|awk '{print $2}'|xargs kill -19\\\")\"</span><span>,</span>\n      <span>\"Thread.sleep(200);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.mobileqq|grep -v MSF|grep -v grep|awk '{print $2}'|xargs kill -9\\\");\"</span>\n    <span>]</span>\n  <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>[</span>\n  <span>{</span>\n    <span>\"name\"</span><span>:</span> <span>\"QQ优能 暂停进程版 按键触发 测试\"</span><span>,</span>\n    <span>\"description\"</span><span>:</span> <span>\"按下任务键导致离开QQ主程序界面，暂停MSF以外的QQ进程。按其他键导致QQ后台则不执行（通过通知栏、手势使程序后台也不执行）（支持按键模拟主页键返回键任务键，比如悬浮球菜单、Xposed edge手势）。（单双进程版原本是情景模式、乖巧模式、后台启动规则搭配使用的（暂停进程版不需要），单独使用情景模式或依然生效。）\"</span><span>,</span>\n    <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n    <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; from == \\\"com.tencent.tim\\\" &amp;&amp; input.getLastKey() == 187\"</span><span>,</span>\n    <span>\"actions\"</span><span>:</span> <span>[</span>\n      <span>\"Thread.sleep(200);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.mobileqq|grep -v MSF|grep -v grep|awk '{print $2}'|xargs kill -19\\\");\"</span>\n    <span>]</span>\n  <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>[</span>\n  <span>{</span>\n    <span>\"name\"</span><span>:</span> <span>\"QQ优能 恢复被暂停的进程通用版 按键触发 测试\"</span><span>,</span>\n    <span>\"description\"</span><span>:</span> <span>\"打开QQ主程序界面 恢复被暂停的进程（）\"</span><span>,</span>\n    <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n    <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; to == \\\"com.tencent.tim\\\"\"</span><span>,</span>\n    <span>\"actions\"</span><span>:</span> <span>[</span>\n      <span>\"Thread.sleep(200);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.mobileqq|grep -v grep|awk '{print $2}'|xargs kill -18\\\");\"</span>\n    <span>]</span>\n  <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"tim\" tabindex=\"-1\"> TIM:</h3>\n<div><pre><code><span>[</span>\n  <span>{</span>\n    <span>\"name\"</span><span>:</span> <span>\"TIM优能 双进程版 按键触发 测试\"</span><span>,</span>\n    <span>\"description\"</span><span>:</span> <span>\"按下主页键导致TIM后台时，结束主进程和MSF以外的TIM进程。按其他键导致TIM后台则不执行（通过通知栏、手势使程序后台也不执行）（支持按键模拟主页键返回键任务键，比如悬浮球菜单、Xposed edge手势）。（单双进程版原本是情景模式、乖巧模式、后台启动规则搭配使用的（暂停进程版不需要），单独使用情景模式或依然生效。）\"</span><span>,</span>\n    <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n    <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; from == \\\"com.tencent.tim\\\" &amp;&amp; input.getLastKey() == 3\"</span><span>,</span>\n    <span>\"actions\"</span><span>:</span> <span>[</span>\n      <span>\"Thread.sleep(200);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.tim:|grep -v MSF|grep -v grep|awk '{print $2}'|xargs kill -19\\\")\"</span><span>,</span>\n      <span>\"Thread.sleep(200);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.tim:|grep -v MSF|grep -v grep|awk '{print $2}'|xargs kill -9\\\");\"</span>\n    <span>]</span>\n  <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>[</span>\n  <span>{</span>\n    <span>\"name\"</span><span>:</span> <span>\"TIM优能 单进程版 按键触发 测试\"</span><span>,</span>\n    <span>\"description\"</span><span>:</span> <span>\"按下返回键导致TIM后台时，只保留MSF进程。按其他键导致TIM后台则不执行（通过通知栏、手势使程序后台也不执行）（支持按键模拟主页键返回键任务键，比如悬浮球菜单、Xposed edge手势）。（单双进程版原本是情景模式、乖巧模式、后台启动规则搭配使用的（暂停进程版不需要），单独使用情景模式或依然生效。）\"</span><span>,</span>\n    <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n    <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; from == \\\"com.tencent.tim\\\" &amp;&amp; input.getLastKey() == 4\"</span><span>,</span>\n    <span>\"actions\"</span><span>:</span> <span>[</span>\n      <span>\"Thread.sleep(200);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.tim|grep -v MSF|grep -v grep|awk '{print $2}'|xargs kill -19\\\")\"</span><span>,</span>\n      <span>\"Thread.sleep(200);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.tim|grep -v MSF|grep -v grep|awk '{print $2}'|xargs kill -9\\\");\"</span>\n    <span>]</span>\n  <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>[</span>\n  <span>{</span>\n    <span>\"name\"</span><span>:</span> <span>\"TIM优能 暂停进程版 按键触发 测试\"</span><span>,</span>\n    <span>\"description\"</span><span>:</span> <span>\"按下任务键导致TIM后台时，暂停MSF以外的进程。按其他键导致TIM后台则不执行（通过通知栏、手势使程序后台也不执行）（支持按键模拟主页键返回键任务键，比如悬浮球菜单、Xposed edge手势）。（单双进程版原本是情景模式、乖巧模式、后台启动规则搭配使用的（暂停进程版不需要），单独使用情景模式或依然生效。）\"</span><span>,</span>\n    <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n    <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; from == \\\"com.tencent.tim\\\" &amp;&amp; input.getLastKey() == 187\"</span><span>,</span>\n    <span>\"actions\"</span><span>:</span> <span>[</span>\n      <span>\"Thread.sleep(200);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.tim|grep -v MSF|grep -v grep|awk '{print $2}'|xargs kill -19\\\")\"</span>\n    <span>]</span>\n  <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>[</span>\n  <span>{</span>\n    <span>\"name\"</span><span>:</span> <span>\"TIM优能 恢复被暂停的进程通用版 按键触发 测试\"</span><span>,</span>\n    <span>\"description\"</span><span>:</span> <span>\"打开TIM主程序界面 恢复被暂停的进程（）\"</span><span>,</span>\n    <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n    <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; to == \\\"com.tencent.tim\\\"\"</span><span>,</span>\n    <span>\"actions\"</span><span>:</span> <span>[</span>\n      <span>\"Thread.sleep(200);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.tencent.tim|grep -v grep|awk '{print $2}'|xargs kill -18\\\")\"</span>\n    <span>]</span>\n  <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"网易云\" tabindex=\"-1\"> 网易云：</h3>\n<div><pre><code><span>[</span>\n  <span>{</span>\n    <span>\"name\"</span><span>:</span> <span>\"网易云优能 双进程版 按键触发 测试\"</span><span>,</span>\n    <span>\"description\"</span><span>:</span> <span>\"按下主页键导致离开网易云主程序界面，结束主进程和play以外的网易云进程。按其他键导致网易云后台则不执行（通过通知栏、手势使程序后台也不执行）（支持按键模拟主页键返回键任务键，比如悬浮球菜单、Xposed edge手势）。（单双进程版原本是情景模式、乖巧模式、后台启动规则搭配使用的（暂停进程版不需要），单独使用情景模式或依然生效。）\"</span><span>,</span>\n    <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n    <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; from == \\\"com.netease.cloudmusic\\\" &amp;&amp; input.getLastKey() == 3\"</span><span>,</span>\n    <span>\"actions\"</span><span>:</span> <span>[</span>\n      <span>\"Thread.sleep(1000);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.netease.cloudmusic:|grep -v :play|grep -v grep|awk '{print $2}'|xargs kill -9\\\");\"</span>\n    <span>]</span>\n  <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>[</span>\n  <span>{</span>\n    <span>\"name\"</span><span>:</span> <span>\"网易云优能 单进程版 按键触发 测试 \"</span><span>,</span>\n    <span>\"description\"</span><span>:</span> <span>\"按下返回键导致离开网易云主程序界面，结束play以外的进程。按其他键导致网易云后台则不执行（通过通知栏、手势使程序后台也不执行）（支持按键模拟主页键返回键任务键，比如悬浮球菜单、Xposed edge手势）。（单双进程版原本是情景模式、乖巧模式、后台启动规则搭配使用的（暂停进程版不需要），单独使用情景模式或依然生效。）\"</span><span>,</span>\n    <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n    <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; from == \\\"com.netease.cloudmusic\\\" &amp;&amp; input.getLastKey() == 4\"</span><span>,</span>\n    <span>\"actions\"</span><span>:</span> <span>[</span>\n      <span>\"Thread.sleep(500);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.netease.cloudmusic|grep -v :play|grep -v grep|awk '{print $2}'|xargs kill -9\\\");\"</span>\n    <span>]</span>\n  <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>[</span>\n  <span>{</span>\n    <span>\"name\"</span><span>:</span> <span>\"网易云优能 暂停进程版 按键触发 测试 \"</span><span>,</span>\n    <span>\"description\"</span><span>:</span> <span>\"按下任务键导致离开网易云主程序界面，暂停play以外的进程。按其他键导致网易云后台则不执行（通过通知栏、手势使程序后台也不执行）（支持按键模拟主页键返回键任务键，比如悬浮球菜单、Xposed edge手势）。（单双进程版原本是情景模式、乖巧模式、后台启动规则搭配使用的（暂停进程版不需要），单独使用情景模式或依然生效。）\"</span><span>,</span>\n    <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n    <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; from == \\\"com.netease.cloudmusic\\\" &amp;&amp; input.getLastKey() == 187\"</span><span>,</span>\n    <span>\"actions\"</span><span>:</span> <span>[</span>\n      <span>\"Thread.sleep(500);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.netease.cloudmusic|grep -v :play|grep -v grep|awk '{print $2}'|xargs kill -19\\\");\"</span>\n    <span>]</span>\n  <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>[</span>\n  <span>{</span>\n    <span>\"name\"</span><span>:</span> <span>\"网易云优能 恢复被暂停的进程通用版 按键触发 测试 \"</span><span>,</span>\n    <span>\"description\"</span><span>:</span> <span>\"打开网易云主程序界面 恢复被暂停的进程（）\"</span><span>,</span>\n    <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n    <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; to == \\\"com.netease.cloudmusic\\\"\"</span><span>,</span>\n    <span>\"actions\"</span><span>:</span> <span>[</span>\n      <span>\"Thread.sleep(500);\"</span><span>,</span>\n      <span>\"sh.exe(\\\"ps -ef|grep com.netease.cloudmusic|grep -v grep|awk '{print $2}'|xargs kill -18\\\");\"</span>\n    <span>]</span>\n  <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "date_published": "2022-06-21T00:00:00.000Z",
      "date_modified": "2022-06-28T07:32:11.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "daily"
      ]
    },
    {
      "title": "快速回忆十大排序",
      "url": "https://blog.ciberviler.top/algorithm/%E5%8D%81%E5%A4%A7%E6%8E%92%E5%BA%8F.html",
      "id": "https://blog.ciberviler.top/algorithm/%E5%8D%81%E5%A4%A7%E6%8E%92%E5%BA%8F.html",
      "summary": "【Java数据结构与算法】快速回忆十大排序 + 使用插入排序、归并排序、快速排序对链表进行排序",
      "content_html": "<h1 id=\"快速回忆十大排序\" tabindex=\"-1\"> 快速回忆十大排序</h1>\n<h2 id=\"java中arrays-sort\" tabindex=\"-1\"> Java中Arrays.sort()</h2>\n<p>通过查看Arrays.sort() 的源码， 可以发现 Arrays.sort() 并不是简单的使用快排，而是根据要排序的长度选择不同的排序。\n简单总结：</p>\n<table>\n<thead>\n<tr>\n<th>区间长度</th>\n<th>所使用的排序算法</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>小于47</td>\n<td>插入排序</td>\n</tr>\n<tr>\n<td>大于47小于286</td>\n<td>快排排序</td>\n</tr>\n<tr>\n<td>大于286，数据基本有序</td>\n<td>归并排序</td>\n</tr>\n<tr>\n<td>大于286，数据基本无序</td>\n<td>快速排序</td>\n</tr>\n</tbody>\n</table>\n<p>进行快排时会计算5个元素如果有相同元素就进行传统<a href=\"https://so.csdn.net/so/search?q=%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F&amp;spm=1001.2101.3001.7020\" target=\"_blank\" rel=\"noopener noreferrer\">快速排序</a>，如果没有相同的就进行双轴快速排序。</p>\n<blockquote>\n<p>插入排序、归并排序、快速排序连源码都在用可见其重要性。</p>\n</blockquote>\n<h2 id=\"经典十大排序\" tabindex=\"-1\"> 经典十大排序</h2>\n<table>\n<thead>\n<tr>\n<th>排序算法</th>\n<th>平均时间复杂度</th>\n<th>最好情况</th>\n<th>最坏情况</th>\n<th>空间复杂度</th>\n<th>稳定性</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>冒泡排序</td>\n<td>O(n2)</td>\n<td>O(n)</td>\n<td>O(n2)</td>\n<td>O(1)</td>\n<td>稳定</td>\n</tr>\n<tr>\n<td>选择排序</td>\n<td>O(n2)</td>\n<td>O(n2)</td>\n<td>O(n2)</td>\n<td>O(1)</td>\n<td>不稳定</td>\n</tr>\n<tr>\n<td>插入排序</td>\n<td>O(n2)</td>\n<td>O(n)</td>\n<td>O(n2)</td>\n<td>O(1)</td>\n<td>稳定</td>\n</tr>\n<tr>\n<td>希尔排序</td>\n<td>O(n log n)</td>\n<td>O(n log2 n)</td>\n<td>O(n log2 n)</td>\n<td>O(1)</td>\n<td>不稳定</td>\n</tr>\n<tr>\n<td>归并排序</td>\n<td>O(n log n)</td>\n<td>O(n log n)</td>\n<td>O(n log n)</td>\n<td>O(n)</td>\n<td>稳定</td>\n</tr>\n<tr>\n<td>快速排序</td>\n<td>O(n log n)</td>\n<td>O(n log n)</td>\n<td>O(n2)</td>\n<td>O(log n)</td>\n<td>不稳定</td>\n</tr>\n<tr>\n<td>堆排序</td>\n<td>O(n log n)</td>\n<td>O(n log n)</td>\n<td>O(n log n)</td>\n<td>O(1)</td>\n<td>不稳定</td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td>计数排序</td>\n<td>O(n+k)</td>\n<td>O(n+k)</td>\n<td>O(n+k)</td>\n<td>O(n+k)</td>\n<td>稳定</td>\n</tr>\n<tr>\n<td>桶数排序</td>\n<td>O(n+k)</td>\n<td>O(n2)</td>\n<td>O(n)</td>\n<td>O(n+k)</td>\n<td>稳定</td>\n</tr>\n<tr>\n<td>基数排序</td>\n<td>O(n*k)</td>\n<td>O(n*k)</td>\n<td>O(n*k)</td>\n<td>O(n+k)</td>\n<td>稳定</td>\n</tr>\n</tbody>\n</table>\n<p>不稳定是指排序过程中会把原本有序区间破化成无序的</p>\n<h2 id=\"排序测试力扣题目\" tabindex=\"-1\"> 排序测试力扣题目</h2>\n<p>力扣 912.排序数组，地址： <a href=\"https://leetcode.cn/problems/sort-an-array/\" target=\"_blank\" rel=\"noopener noreferrer\">https://leetcode.cn/problems/sort-an-array/</a>\n除了冒泡、插入会超时以外，其他排序方式都可以通过。</p>\n<h2 id=\"_1-冒泡排序\" tabindex=\"-1\"> 1. 冒泡排序</h2>\n<p>这应该是大家接触最早的排序。数就像水里的泡泡一样，泡泡从大到小一个个冒出来。\n数组形式： [无序区间] [有序区间] ，在无序区间一直比较并交换把最大的冒到有序区间前。\n两层for循环，一层循环将一个最大的数放到最后。\n<strong>动图演示</strong>：\n<img src=\"https://img-blog.csdnimg.cn/763fdaf26170499aa9e1fc4637b43f1f.gif\" alt=\"图片\">\n<strong>Java代码</strong></p>\n<div><pre><code>        <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> nums<span>.</span>length<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            <span>for</span><span>(</span><span>int</span> j <span>=</span> <span>0</span><span>;</span> j  <span>&lt;</span> nums<span>.</span>length <span>-</span> <span>1</span> <span>-</span> i<span>;</span> j<span>++</span><span>)</span> <span>{</span>\n                <span>if</span><span>(</span>nums<span>[</span>j<span>]</span> <span>></span> nums<span>[</span>j <span>+</span> <span>1</span><span>]</span><span>)</span> <span>{</span>\n                    <span>//交换</span>\n                    <span>int</span> tem <span>=</span> nums<span>[</span>j<span>]</span><span>;</span>\n                    nums<span>[</span>j<span>]</span> <span>=</span> nums<span>[</span>j <span>+</span> <span>1</span><span>]</span><span>;</span>\n                    nums<span>[</span>j  <span>+</span> <span>1</span><span>]</span> <span>=</span> tem<span>;</span>\n                <span>}</span>\n            <span>}</span>\n        <span>}</span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_2-选择排序\" tabindex=\"-1\"> 2. 选择排序</h2>\n<p>插入排序总结一句话就是挑最小的放前面，比较的次数多但是交换的次数少\n数组形式： [有序区间] [无序区间] ，在无序区间挑一个最小的数跟在有序区间后面。\n两层for循环，一层循环用来找到最小的数。\n<strong>动图演示</strong>：\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220622172753245.png\" alt=\"image-20220622172753245\">\n<strong>Java代码</strong>：</p>\n<div><pre><code>        <span>int</span> minIndex <span>=</span> <span>0</span><span>;</span>\n        <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> nums<span>.</span>length <span>-</span> <span>1</span><span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            minIndex <span>=</span> i<span>;</span>\n            <span>for</span><span>(</span><span>int</span> j <span>=</span> i <span>+</span> <span>1</span><span>;</span> j <span>&lt;</span> nums<span>.</span>length<span>;</span> j<span>++</span><span>)</span> <span>{</span>\n               <span>if</span><span>(</span>nums<span>[</span>j<span>]</span> <span>&lt;</span> nums<span>[</span>minIndex<span>]</span><span>)</span> <span>{</span>\n                   minIndex <span>=</span> j<span>;</span>\n               <span>}</span>\n           <span>}</span>\n           <span>//找到最小数的索引，交换</span>\n           <span>int</span> tem <span>=</span> nums<span>[</span>i<span>]</span><span>;</span>\n           nums<span>[</span>i<span>]</span> <span>=</span> nums<span>[</span>minIndex<span>]</span><span>;</span>\n           nums<span>[</span>minIndex<span>]</span> <span>=</span> tem<span>;</span>\n        <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_3-插入排序\" tabindex=\"-1\"> 3. 插入排序</h2>\n<p>插入排序总结：拿到一个元素就去找他该在的位置插入进去\n数组形式： [有序区间] [无序区间] ，在无序区间拿第一个元素插入到有序区其应该在的位置\n从右往左，放第一个比他小的后面，且从右往左遍历过程中把数组右移。</p>\n<p><strong>动图演示</strong>：\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220622172810846.png\" alt=\"image-20220622172810846\">\n<strong>Java代码</strong>：</p>\n<div><pre><code>        <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>1</span><span>;</span> i <span>&lt;</span> nums<span>.</span>length<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            <span>int</span> index <span>=</span> i <span>-</span> <span>1</span><span>;</span>\n            <span>int</span> tem <span>=</span> nums<span>[</span>i<span>]</span><span>;</span>\n            <span>while</span><span>(</span>index <span>>=</span> <span>0</span> <span>&amp;&amp;</span> nums<span>[</span>index<span>]</span> <span>></span> tem<span>)</span> <span>{</span>\n                nums<span>[</span>index <span>+</span> <span>1</span><span>]</span> <span>=</span> nums<span>[</span>index<span>]</span><span>;</span> <span>//右移</span>\n                index<span>--</span><span>;</span>\n            <span>}</span>\n            nums<span>[</span>index <span>+</span> <span>1</span><span>]</span> <span>=</span> tem<span>;</span> <span>//把无序部分第一个数插入到有序部分的这里</span>\n        <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_4-希尔排序\" tabindex=\"-1\"> 4. 希尔排序</h2>\n<p>希尔排序是当时最早突破 O(n2)的排序，是插入排序的改进版本。 插入排序主要在于右移是O(n)\n希尔排序的思想是引入一个增量，先两两插入排序，再四四插入排序，最终整体插入排序，这样前面处理完，后面插入移动次数会变少。\n每一轮按照事先决定的间隔进行插入排序，间隔依次缩小最后为1。\n<strong>动图演示</strong>：\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220622172822763.png\" alt=\"image-20220622172822763\">\n如果看不懂这个动图，可以先看看这个教程，再回头看这个动图。<a href=\"https://www.runoob.com/data-structures/shell-sort.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.runoob.com/data-structures/shell-sort.html</a>\n<strong>Java代码</strong>：</p>\n<div><pre><code>        <span>for</span><span>(</span><span>int</span> gap <span>=</span> nums<span>.</span>length <span>/</span> <span>2</span><span>;</span> gap <span>></span> <span>0</span><span>;</span> gap <span>/=</span> <span>2</span><span>)</span> <span>{</span>\n            <span>//对每组进行插入排序。 这里和动图不太一样，并不是一组一组进行的，而是各组交叉进行的</span>\n            <span>for</span><span>(</span><span>int</span> i <span>=</span> gap<span>;</span> i <span>&lt;</span> nums<span>.</span>length<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n                <span>int</span> tem <span>=</span> nums<span>[</span>i<span>]</span><span>;</span>\n                <span>int</span> index <span>=</span> i<span>;</span>\n                <span>while</span><span>(</span>index <span>>=</span> gap <span>&amp;&amp;</span> nums<span>[</span>index <span>-</span> gap<span>]</span> <span>></span> tem<span>)</span> <span>{</span>\n                    <span>//按分组的位置右移</span>\n                    nums<span>[</span>index<span>]</span> <span>=</span> nums<span>[</span>index <span>-</span> gap<span>]</span><span>;</span>\n                    index <span>-=</span> gap<span>;</span>\n                <span>}</span>\n                nums<span>[</span>index<span>]</span> <span>=</span> tem<span>;</span>\n            <span>}</span>\n        <span>}</span>\n        <span>return</span> nums<span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_5-归并排序\" tabindex=\"-1\"> 5. 归并排序</h2>\n<p>希尔排序是分治法的一个典型应用，将已有序的子序列合并，得到完全有序的序列；</p>\n<p><strong>动图演示</strong>：\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220622172858688.png\" alt=\"image-20220622172858688\">\n<strong>更直观的图片演示</strong>：\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/27888728650c447f85415a003218a727.png\" alt=\"图片\"></p>\n<p><strong>Java代码</strong>：</p>\n<div><pre><code>    <span>int</span><span>[</span><span>]</span> tem<span>;</span>\n    <span>public</span> <span>int</span><span>[</span><span>]</span> <span>sortArray</span><span>(</span><span>int</span><span>[</span><span>]</span> nums<span>)</span> <span>{</span>\n        tem <span>=</span> <span>new</span> <span>int</span><span>[</span>nums<span>.</span>length<span>]</span><span>;</span>\n        <span>mergeSort</span><span>(</span>nums<span>,</span> <span>0</span><span>,</span> nums<span>.</span>length <span>-</span> <span>1</span><span>)</span><span>;</span>\n        <span>return</span> nums<span>;</span>\n    <span>}</span>\n\n    <span>void</span> <span>mergeSort</span><span>(</span><span>int</span><span>[</span><span>]</span> nums<span>,</span> <span>int</span> l<span>,</span> <span>int</span> r<span>)</span> <span>{</span>\n        <span>if</span><span>(</span>l <span>>=</span> r<span>)</span> <span>return</span><span>;</span>\n        <span>int</span> mid <span>=</span> <span>(</span>l <span>+</span> r<span>)</span> <span>/</span> <span>2</span><span>;</span>\n        <span>//分</span>\n        <span>mergeSort</span><span>(</span>nums<span>,</span> l<span>,</span> mid<span>)</span><span>;</span>\n        <span>mergeSort</span><span>(</span>nums<span>,</span> mid <span>+</span> <span>1</span><span>,</span> r<span>)</span><span>;</span>\n        \n        <span>//治(归并)</span>\n        <span>int</span> i <span>=</span> l<span>,</span> j <span>=</span> mid <span>+</span> <span>1</span><span>;</span>\n        <span>int</span> index <span>=</span> <span>0</span><span>;</span>\n        <span>while</span><span>(</span>i <span>&lt;=</span> mid <span>&amp;&amp;</span> j <span>&lt;=</span> r<span>)</span> <span>{</span>\n            <span>if</span><span>(</span>nums<span>[</span>i<span>]</span> <span>&lt;=</span> nums<span>[</span>j<span>]</span><span>)</span> <span>{</span>\n                tem<span>[</span>index<span>++</span><span>]</span> <span>=</span> nums<span>[</span>i<span>++</span><span>]</span><span>;</span>\n            <span>}</span><span>else</span> <span>{</span>\n                tem<span>[</span>index<span>++</span><span>]</span> <span>=</span> nums<span>[</span>j<span>++</span><span>]</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n        <span>while</span><span>(</span>i <span>&lt;=</span> mid<span>)</span> tem<span>[</span>index<span>++</span><span>]</span> <span>=</span> nums<span>[</span>i<span>++</span><span>]</span><span>;</span>\n        <span>while</span><span>(</span>j <span>&lt;=</span> r<span>)</span> tem<span>[</span>index<span>++</span><span>]</span> <span>=</span> nums<span>[</span>j<span>++</span><span>]</span><span>;</span>\n\n        <span>//把归并完成的这部分赋值回给原始数组</span>\n        <span>for</span><span>(</span><span>int</span> k <span>=</span> <span>0</span><span>;</span> k <span>&lt;</span> r <span>-</span> l <span>+</span> <span>1</span><span>;</span> k<span>++</span><span>)</span> <span>{</span>\n            nums<span>[</span>k <span>+</span> l<span>]</span> <span>=</span> tem<span>[</span>k<span>]</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_6-快速排序\" tabindex=\"-1\"> 6. 快速排序</h2>\n<p>通过一趟排序将待排记录分隔成独立的两部分，其中一部分记录的关键字均比另一部分的关键字小，\n然后再分别对这两部分记录继续进行排序，以达到整个序列有序。\n数组形式： [小数] [基准元素] [大数]，在区间中随机挑选一个元素作为基准，小于基准元素的放基准之前，大于基准的放基准之后。\n然后再对小数和大数区间做快排</p>\n<p>整个流程就是找到基准点应该放置的位置。</p>\n<p><strong>动图演示</strong>：\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220622172923616.png\" alt=\"image-20220622172923616\"></p>\n<p><strong>Java代码</strong>：</p>\n<div><pre><code>    <span>public</span> <span>int</span><span>[</span><span>]</span> <span>sortArray</span><span>(</span><span>int</span><span>[</span><span>]</span> nums<span>)</span> <span>{</span>\n        <span>quickSort</span><span>(</span>nums<span>,</span> <span>0</span><span>,</span> nums<span>.</span>length <span>-</span> <span>1</span><span>)</span><span>;</span>\n        <span>return</span> nums<span>;</span>\n\n    <span>}</span>\n\n    <span>public</span> <span>void</span> <span>quickSort</span><span>(</span><span>int</span><span>[</span><span>]</span> nums<span>,</span> <span>int</span> left<span>,</span> <span>int</span> right<span>)</span> <span>{</span>\n        <span>//顺序选取基准值</span>\n        <span>if</span><span>(</span>left <span>>=</span> right<span>)</span> <span>return</span><span>;</span>\n        <span>int</span> first <span>=</span> left<span>,</span> key <span>=</span> nums<span>[</span>first<span>]</span><span>,</span> end <span>=</span> right<span>;</span>\n        <span>while</span> <span>(</span>first <span>&lt;</span> end<span>)</span> <span>{</span>\n            <span>//先看右边的， 比基准大就不管</span>\n            <span>while</span> <span>(</span>first <span>&lt;</span> end <span>&amp;&amp;</span> nums<span>[</span>end<span>]</span> <span>>=</span> key<span>)</span> <span>{</span>\n                end<span>--</span><span>;</span>\n            <span>}</span>\n            <span>//右边end指向的这个值小于分界值， 交换.</span>\n            nums<span>[</span>first<span>]</span> <span>=</span> nums<span>[</span>end<span>]</span><span>;</span>\n\n            <span>//然后走左边</span>\n            <span>while</span> <span>(</span>first <span>&lt;</span> end <span>&amp;&amp;</span> nums<span>[</span>first<span>]</span> <span>&lt;=</span> key<span>)</span> <span>{</span>\n                <span>++</span>first<span>;</span>\n            <span>}</span>\n            <span>//如果first指针指向的值大于分界值key, 交换</span>\n            nums<span>[</span>end<span>]</span> <span>=</span> nums<span>[</span>first<span>]</span><span>;</span>\n        <span>}</span>\n        <span>// 左右指针相同， 基准值该在这个位置，使得基准值左右两边是比他小和比他大的数</span>\n        nums<span>[</span>first<span>]</span> <span>=</span> key<span>;</span>\n        <span>//递归， 对左右两边再进行上面操作</span>\n        <span>quickSort</span><span>(</span>nums<span>,</span> left<span>,</span> first <span>-</span> <span>1</span><span>)</span><span>;</span>\n        <span>quickSort</span><span>(</span>nums<span>,</span>first <span>+</span> <span>1</span><span>,</span> right<span>)</span><span>;</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>如果遇到数组是 9 8 7 6 5 4 3 2 1， 再从左往右顺序选取基准值的话，每次都得移动 n 个， 算法时间复杂度退回到O(n2)。\n所以最好是随机选取基准，或者提前打乱数组，数组越乱，快排越快\n<strong>随机选取基准值，快排代码</strong>：</p>\n<div><pre><code>    <span>public</span> <span>int</span><span>[</span><span>]</span> <span>sortArray</span><span>(</span><span>int</span><span>[</span><span>]</span> nums<span>)</span> <span>{</span>\n        <span>quickSort</span><span>(</span>nums<span>,</span> <span>0</span><span>,</span> nums<span>.</span>length <span>-</span> <span>1</span><span>)</span><span>;</span>\n        <span>return</span> nums<span>;</span>\n\n    <span>}</span>\n    <span>public</span> <span>void</span> <span>quickSort</span><span>(</span><span>int</span><span>[</span><span>]</span> nums<span>,</span> <span>int</span> left<span>,</span> <span>int</span> right<span>)</span> <span>{</span>\n        <span>if</span><span>(</span>left <span>>=</span> right<span>)</span> <span>return</span><span>;</span>\n        <span>//随机选取基准值</span>\n        <span>int</span> index <span>=</span> left <span>+</span> <span>(</span><span>int</span><span>)</span><span>(</span><span>Math</span><span>.</span><span>random</span><span>(</span><span>)</span> <span>*</span> <span>(</span>right <span>-</span> left <span>+</span> <span>1</span><span>)</span><span>)</span><span>;</span>\n        <span>int</span> key <span>=</span> nums<span>[</span>index<span>]</span><span>;</span>\n        <span>int</span> first <span>=</span> left<span>,</span> end <span>=</span> right<span>;</span>\n        nums<span>[</span>index<span>]</span> <span>=</span> nums<span>[</span>first<span>]</span><span>;</span>\n        nums<span>[</span>first<span>]</span> <span>=</span> key<span>;</span>\n        \n        <span>while</span> <span>(</span>first <span>&lt;</span> end<span>)</span> <span>{</span>\n            <span>//先看右边的， 比基准大就不管</span>\n            <span>while</span> <span>(</span>first <span>&lt;</span> end <span>&amp;&amp;</span> nums<span>[</span>end<span>]</span> <span>>=</span> key<span>)</span> <span>{</span>\n                end<span>--</span><span>;</span>\n            <span>}</span>\n            <span>//右边end指向的这个值小于分界值， 交换.</span>\n            nums<span>[</span>first<span>]</span> <span>=</span> nums<span>[</span>end<span>]</span><span>;</span>\n\n            <span>//然后走左边</span>\n            <span>while</span> <span>(</span>first <span>&lt;</span> end <span>&amp;&amp;</span> nums<span>[</span>first<span>]</span> <span>&lt;=</span> key<span>)</span> <span>{</span>\n                <span>++</span>first<span>;</span>\n            <span>}</span>\n            <span>//如果first指针指向的值大于分界值key, 交换</span>\n            nums<span>[</span>end<span>]</span> <span>=</span> nums<span>[</span>first<span>]</span><span>;</span>\n        <span>}</span>\n        <span>// 左右指针相同， 基准值该在这个位置，使得基准值左右两边是比他小和比他大的数</span>\n        nums<span>[</span>first<span>]</span> <span>=</span> key<span>;</span>\n\n        <span>//递归， 对左右两边再进行上面操作</span>\n        <span>quickSort</span><span>(</span>nums<span>,</span> left<span>,</span> first <span>-</span> <span>1</span><span>)</span><span>;</span>\n        <span>quickSort</span><span>(</span>nums<span>,</span>first <span>+</span> <span>1</span><span>,</span> right<span>)</span><span>;</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_7-堆排序\" tabindex=\"-1\"> 7. 堆排序</h2>\n<p>利用小顶堆。</p>\n<blockquote>\n<p>待补充</p>\n</blockquote>\n<h2 id=\"_8-计数排序\" tabindex=\"-1\"> 8. 计数排序</h2>\n<p>记录索引位置数的个数，利用索引本身就有序进行排序。\n有一个缺点就是得事先知道数据得范围，范围多大就得开多大数组。\n<strong>动图演示</strong>：\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/543d76445825431bb4e3fad91c11b673.gif\" alt=\"图片\">\n<strong>Java代码</strong>：</p>\n<div><pre><code>    <span>public</span> <span>int</span><span>[</span><span>]</span> <span>sortArray</span><span>(</span><span>int</span><span>[</span><span>]</span> nums<span>)</span> <span>{</span>\n        <span>int</span><span>[</span><span>]</span> dic <span>=</span> <span>new</span> <span>int</span><span>[</span><span>100001</span><span>]</span><span>;</span>\n        <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> nums<span>.</span>length<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            dic<span>[</span>nums<span>[</span>i<span>]</span> <span>+</span> <span>50000</span><span>]</span><span>++</span><span>;</span>\n        <span>}</span>\n        <span>int</span> index <span>=</span> <span>0</span><span>;</span>\n        <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> dic<span>.</span>length<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            <span>for</span><span>(</span><span>int</span> j <span>=</span> <span>0</span><span>;</span> j <span>&lt;</span> dic<span>[</span>i<span>]</span><span>;</span> j<span>++</span><span>)</span> <span>{</span>\n                nums<span>[</span>index<span>++</span><span>]</span> <span>=</span> i <span>-</span> <span>50000</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n        <span>return</span> nums<span>;</span>\n    <span>}</span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_9-桶排序\" tabindex=\"-1\"> 9. 桶排序</h2>\n<p>桶排序是计数排序的升级版， 计数排序是一对一的映射，而桶排序是一对多的映射，把数据分到不同的桶里的元素用其他排序方式排序。\n<strong>动图演示</strong>：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220622172938902.png\" alt=\"image-20220622172938902\">\n<strong>Java代码</strong>：</p>\n<div><pre><code>    <span>public</span> <span>int</span><span>[</span><span>]</span> <span>sortArray</span><span>(</span><span>int</span><span>[</span><span>]</span> nums<span>)</span> <span>{</span>\n        <span>int</span> n <span>=</span> nums<span>.</span>length<span>;</span>\n        <span>int</span> max <span>=</span> nums<span>[</span><span>0</span><span>]</span><span>,</span> min <span>=</span> nums<span>[</span><span>0</span><span>]</span><span>;</span>\n        <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> n<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            <span>if</span><span>(</span>nums<span>[</span>i<span>]</span> <span>></span> max<span>)</span> max <span>=</span> nums<span>[</span>i<span>]</span><span>;</span>\n            <span>if</span><span>(</span>nums<span>[</span>i<span>]</span> <span>&lt;</span> min<span>)</span> min <span>=</span> nums<span>[</span>i<span>]</span><span>;</span>\n        <span>}</span>\n        <span>int</span> diff <span>=</span> max <span>-</span> min<span>;</span>\n        <span>//设n个桶</span>\n        <span>List</span><span><span>&lt;</span><span>Integer</span><span>></span></span><span>[</span><span>]</span> buket <span>=</span> <span>new</span> <span>List</span><span>[</span>n<span>]</span><span>;</span>\n        <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> n<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            buket<span>[</span>i<span>]</span> <span>=</span> <span>new</span> <span>ArrayList</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        <span>}</span>\n        <span>//每个桶的范围，防止为0</span>\n        <span>int</span> section <span>=</span> diff <span>/</span> n <span>+</span> <span>1</span><span>;</span> \n        <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> n<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            <span>int</span> id <span>=</span> <span>(</span>nums<span>[</span>i<span>]</span> <span>-</span> min<span>)</span> <span>/</span> section <span>-</span> <span>1</span><span>;</span> <span>// -1防止等于 n</span>\n            <span>if</span><span>(</span>id <span>&lt;</span> <span>0</span><span>)</span> id <span>=</span> <span>0</span><span>;</span>\n            buket<span>[</span>id<span>]</span><span>.</span><span>add</span><span>(</span>nums<span>[</span>i<span>]</span><span>)</span><span>;</span>\n        <span>}</span>\n        <span>//桶内排序</span>\n        <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> n<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            <span>Collections</span><span>.</span><span>sort</span><span>(</span>buket<span>[</span>i<span>]</span><span>)</span><span>;</span>\n        <span>}</span>\n        <span>//返回排序数组</span>\n        <span>int</span> index <span>=</span> <span>0</span><span>;</span>\n        <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> n<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            <span>for</span><span>(</span><span>int</span> j <span>=</span> <span>0</span><span>;</span> j <span>&lt;</span> buket<span>[</span>i<span>]</span><span>.</span><span>size</span><span>(</span><span>)</span><span>;</span> j<span>++</span><span>)</span> <span>{</span>\n                nums<span>[</span>index<span>++</span><span>]</span> <span>=</span> buket<span>[</span>i<span>]</span><span>.</span><span>get</span><span>(</span>j<span>)</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n        <span>return</span> nums<span>;</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_10-基数排序\" tabindex=\"-1\"> 10. 基数排序</h2>\n<p>基数排序是桶排序的扩展， 思想是把整数按每位不同放入不同的桶里，按每位进行比较。\n比如 32，34，16， 5 排序， 先按个位数排序 32，34，5，16， 再按十位排序5，16，32，34就完事了\n【因为之前按个位排序时把 32放在了34前面，所以再进行十位排序时，按顺序来32自然在34前面】\n<strong>动图演示</strong>：\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/caddb1ae0bfa4189bf084bf520aad160.gif\" alt=\"图片\">\n<strong>Java代码</strong>：</p>\n<div><pre><code>    <span>public</span> <span>int</span><span>[</span><span>]</span> <span>sortArray</span><span>(</span><span>int</span><span>[</span><span>]</span> nums<span>)</span> <span>{</span>\n        <span>List</span><span><span>&lt;</span><span>Integer</span><span>></span></span><span>[</span><span>]</span> buket <span>=</span> <span>new</span> <span>List</span><span>[</span><span>10</span><span>]</span><span>;</span>\n        <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> <span>10</span><span>;</span> i<span>++</span><span>)</span> buket<span>[</span>i<span>]</span> <span>=</span> <span>new</span> <span>ArrayList</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        <span>// 把负数全部转化成正数处理</span>\n        <span>int</span> max <span>=</span> nums<span>[</span><span>0</span><span>]</span> <span>+</span> <span>50000</span><span>;</span>\n        <span>//得到最大的数</span>\n        <span>for</span><span>(</span><span>int</span> t <span>:</span> nums<span>)</span> <span>if</span><span>(</span>t <span>+</span> <span>50000</span> <span>></span> max<span>)</span> max <span>=</span> t <span>+</span> <span>50000</span><span>;</span>\n        \n        <span>//从个位到最高位</span>\n        <span>int</span> len <span>=</span> <span>String</span><span>.</span><span>valueOf</span><span>(</span>max<span>)</span><span>.</span><span>length</span><span>(</span><span>)</span><span>;</span> <span>//最高位位数</span>\n        <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> len<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            <span>//入桶</span>\n            <span>for</span><span>(</span><span>int</span> t <span>:</span> nums<span>)</span> <span>{</span>\n                buket<span>[</span><span>(</span><span>(</span>t <span>+</span> <span>50000</span><span>)</span> <span>/</span> <span>(</span><span>int</span><span>)</span><span>Math</span><span>.</span><span>pow</span><span>(</span><span>10</span><span>,</span> i<span>)</span><span>)</span> <span>%</span> <span>10</span><span>]</span><span>.</span><span>add</span><span>(</span>t <span>+</span> <span>50000</span><span>)</span><span>;</span>\n            <span>}</span>\n            <span>//出桶</span>\n            <span>int</span> index <span>=</span> <span>0</span><span>;</span>\n            <span>for</span><span>(</span><span>int</span> j <span>=</span> <span>0</span><span>;</span> j <span>&lt;</span> <span>10</span><span>;</span> j<span>++</span><span>)</span> <span>{</span>\n                <span>for</span><span>(</span><span>int</span> k <span>=</span> <span>0</span><span>;</span> k <span>&lt;</span> buket<span>[</span>j<span>]</span><span>.</span><span>size</span><span>(</span><span>)</span><span>;</span> k<span>++</span><span>)</span> <span>{</span>\n                    nums<span>[</span>index<span>++</span><span>]</span> <span>=</span> buket<span>[</span>j<span>]</span><span>.</span><span>get</span><span>(</span>k<span>)</span> <span>-</span> <span>50000</span><span>;</span>\n                <span>}</span>\n                buket<span>[</span>j<span>]</span><span>.</span><span>clear</span><span>(</span><span>)</span><span>;</span> <span>//清空桶</span>\n            <span>}</span>\n        <span>}</span>\n        <span>return</span> nums<span>;</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"对链表进行排序\" tabindex=\"-1\"> 对链表进行排序</h2>\n<p>如果你掌握了 插入排序、快速排序、归并排序的精髓，那么试试这三种方法对链表进行排序吧\n狂刷三道力扣中等题：\n<a href=\"https://leetcode.cn/problems/insertion-sort-list/\" target=\"_blank\" rel=\"noopener noreferrer\">力扣 147. 对链表进行插入排序</a>\n<a href=\"https://leetcode.cn/problems/sort-list/\" target=\"_blank\" rel=\"noopener noreferrer\">力扣 148. 排序链表</a>\n<a href=\"https://leetcode.cn/problems/7WHec2/\" target=\"_blank\" rel=\"noopener noreferrer\">力扣 剑指 Offer II 077. 链表排序</a></p>\n<h2 id=\"_1-插入排序o-n2\" tabindex=\"-1\"> 1. 插入排序O(n2)</h2>\n<p>插入排序： 【有序】【无序】 无序部分找最小值放有序后头</p>\n<p>直接上Java代码：</p>\n<div><pre><code>    <span>public</span> <span>ListNode</span> <span>insertionSortList</span><span>(</span><span>ListNode</span> head<span>)</span> <span>{</span>\n        <span>//由于链表只能从前往后遍历，所以只能从前往后遍历找插入位置</span>\n        <span>//没有元素或者只有一个元素直接返回</span>\n        <span>if</span><span>(</span>head <span>==</span> <span>null</span> <span>||</span> head<span>.</span>next <span>==</span> <span>null</span><span>)</span> <span>return</span> head<span>;</span>\n        <span>ListNode</span> dump <span>=</span> <span>new</span> <span>ListNode</span><span>(</span><span>)</span><span>;</span>\n        dump<span>.</span>next <span>=</span> head<span>;</span>\n        <span>ListNode</span> lastNode <span>=</span> head<span>;</span><span>//有序节点的最后一个节点</span>\n        <span>ListNode</span> cur <span>=</span> head<span>.</span>next<span>;</span>\n        <span>while</span><span>(</span>cur <span>!=</span> <span>null</span><span>)</span> <span>{</span>\n            <span>if</span><span>(</span>cur<span>.</span>val <span>>=</span> lastNode<span>.</span>val<span>)</span> <span>{</span>\n                <span>//直接往后走</span>\n                lastNode <span>=</span> lastNode<span>.</span>next<span>;</span>\n            <span>}</span><span>else</span> <span>{</span>\n                <span>ListNode</span> pre <span>=</span> dump<span>;</span>\n                <span>while</span><span>(</span>pre<span>.</span>next<span>.</span>val <span>&lt;</span> cur<span>.</span>val<span>)</span> <span>{</span>\n                   pre <span>=</span> pre<span>.</span>next<span>;</span>\n                <span>}</span>\n                <span>//lastNode 不变，但是lastNode下一个数被插入前面了，</span>\n                lastNode<span>.</span>next <span>=</span> cur<span>.</span>next<span>;</span>\n                cur<span>.</span>next <span>=</span> pre<span>.</span>next<span>;</span>\n                pre<span>.</span>next <span>=</span> cur<span>;</span>\n            <span>}</span>\n            cur <span>=</span> lastNode<span>.</span>next<span>;</span>\n        <span>}</span>\n        lastNode<span>.</span>next <span>=</span> <span>null</span><span>;</span>\n        <span>return</span> dump<span>.</span>next<span>;</span>\n    <span>}</span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_2-快速排序o-n-log-n\" tabindex=\"-1\"> 2.快速排序O(n log n)</h2>\n<p>快速排序： 【小数】【基准元素】【大数】，所有小数移动到基准元素左边，大数移动到基准元素右边</p>\n<p>直接上Java代码： 对于<a href=\"https://leetcode.cn/problems/sort-list/\" target=\"_blank\" rel=\"noopener noreferrer\">力扣 148. 排序链表</a>，快排超时了。</p>\n<div><pre><code>    <span>public</span> <span>ListNode</span> <span>sortList</span><span>(</span><span>ListNode</span> head<span>)</span> <span>{</span>\n        <span>if</span><span>(</span>head <span>==</span> <span>null</span> <span>||</span> head<span>.</span>next <span>==</span> <span>null</span><span>)</span> <span>return</span> head<span>;</span>\n        <span>ListNode</span> dump <span>=</span> <span>new</span> <span>ListNode</span><span>(</span><span>)</span><span>;</span>\n        dump<span>.</span>next <span>=</span> head<span>;</span>\n        <span>return</span> <span>quickSort</span><span>(</span>dump<span>,</span> <span>null</span><span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>ListNode</span> <span>quickSort</span><span>(</span><span>ListNode</span> headPre<span>,</span> <span>ListNode</span> end<span>)</span> <span>{</span>\n        <span>if</span><span>(</span>headPre <span>==</span> end <span>||</span> headPre<span>.</span>next <span>==</span> end <span>||</span> headPre<span>.</span>next<span>.</span>next <span>==</span> end<span>)</span> <span>return</span> headPre<span>;</span>\n        <span>//将小于基准值的节点存在这个临时链表中</span>\n        <span>ListNode</span> temDump <span>=</span> <span>new</span> <span>ListNode</span><span>(</span><span>)</span><span>;</span>\n        <span>ListNode</span> tp <span>=</span> temDump<span>;</span>\n        <span>//key 为基准节点，基准节点左边是比他小的，右边是比他大的</span>\n        <span>ListNode</span> key <span>=</span> headPre<span>.</span>next<span>,</span> lp <span>=</span> headPre<span>;</span>\n        <span>while</span><span>(</span>lp<span>.</span>next <span>!=</span> end<span>)</span> <span>{</span>\n            <span>if</span><span>(</span>lp<span>.</span>next<span>.</span>val <span>&lt;</span> key<span>.</span>val<span>)</span> <span>{</span>\n            <span>//节点值小于基准节点，就把这个节点放到左边</span>\n                tp<span>.</span>next <span>=</span> lp<span>.</span>next<span>;</span>\n                tp <span>=</span> tp<span>.</span>next<span>;</span>\n                lp<span>.</span>next <span>=</span> lp<span>.</span>next<span>.</span>next<span>;</span>\n            <span>}</span><span>else</span> <span>{</span>\n                lp <span>=</span> lp<span>.</span>next<span>;</span>\n            <span>}</span>\n        <span>}</span>\n        <span>//合并大小两个链表</span>\n        tp<span>.</span>next <span>=</span> key<span>;</span>\n        <span>//整个链表用headPre连回来</span>\n        headPre<span>.</span>next <span>=</span> temDump<span>.</span>next<span>;</span> <span>// 链表插回原链表（如果不做这一步，处理右半部分的时候就断了）</span>\n        <span>quickSort</span><span>(</span>headPre<span>,</span> key<span>)</span><span>;</span>\n        <span>quickSort</span><span>(</span>key<span>,</span> end<span>)</span><span>;</span>\n\n        <span>return</span> headPre<span>.</span>next<span>;</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_2-归并排序o-n-log-n\" tabindex=\"-1\"> 2.归并排序O(n log n)</h2>\n<p>链表排序最好就是用归并排序， 链表的归并排序不需要额外空间\n归并，分治</p>\n<p>归并排序需要不断的把链表分为两段，分为两段的方法可以用快慢指针，快指针溢出走两步，慢指针一次走一步，快指针走到头慢指针指向中间节点。</p>\n<p>直接上Java代码：</p>\n<div><pre><code><span>class</span> <span>Solution</span> <span>{</span>\n    <span>public</span> <span>ListNode</span> <span>sortList</span><span>(</span><span>ListNode</span> head<span>)</span> <span>{</span>\n        <span>if</span><span>(</span>head <span>==</span> <span>null</span> <span>||</span> head<span>.</span>next <span>==</span> <span>null</span><span>)</span> <span>return</span> head<span>;</span>\n        <span>return</span> <span>mergeSort</span><span>(</span>head<span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>ListNode</span> <span>mergeSort</span><span>(</span><span>ListNode</span> head<span>)</span> <span>{</span>\n        <span>if</span><span>(</span>head<span>.</span>next <span>==</span> <span>null</span><span>)</span> <span>return</span> head<span>;</span>\n        <span>// 分</span>\n        <span>//找中间节点</span>\n        <span>ListNode</span> fast <span>=</span> head<span>,</span> slow <span>=</span> head<span>,</span> pre <span>=</span> <span>null</span><span>;</span><span>//pre 是slow节点的前一个节点</span>\n        <span>while</span><span>(</span>fast <span>!=</span> <span>null</span> <span>&amp;&amp;</span> fast<span>.</span>next <span>!=</span> <span>null</span><span>)</span> <span>{</span>\n            fast <span>=</span> fast<span>.</span>next<span>.</span>next<span>;</span>\n            pre <span>=</span> slow<span>;</span>\n            slow <span>=</span> slow<span>.</span>next<span>;</span>\n        <span>}</span>\n        pre<span>.</span>next <span>=</span> <span>null</span><span>;</span> <span>//断链， 现在head只有一半链表, slow 是另一半链表</span>\n        <span>ListNode</span> left <span>=</span> <span>mergeSort</span><span>(</span>head<span>)</span><span>;</span> <span>// 继续把head这一半进行分半</span>\n        <span>ListNode</span> right <span>=</span> <span>mergeSort</span><span>(</span>slow<span>)</span><span>;</span> <span>//继续把slow这一半进行分半</span>\n\n        <span>//治</span>\n        <span>//left、 right都是从最小（一个节点）回溯到最长（一半）</span>\n        <span>//合并left、right</span>\n        <span>ListNode</span> dump <span>=</span> <span>new</span> <span>ListNode</span><span>(</span><span>)</span><span>;</span>\n        <span>ListNode</span> cur <span>=</span> dump<span>;</span>\n        <span>while</span><span>(</span>left <span>!=</span> <span>null</span> <span>&amp;&amp;</span> right <span>!=</span> <span>null</span><span>)</span> <span>{</span>\n            <span>if</span><span>(</span>left<span>.</span>val <span>&lt;=</span> right<span>.</span>val<span>)</span> <span>{</span>\n                cur<span>.</span>next <span>=</span> left<span>;</span>\n                left <span>=</span> left<span>.</span>next<span>;</span>\n                cur <span>=</span> cur<span>.</span>next<span>;</span>\n            <span>}</span><span>else</span> <span>{</span>\n                cur<span>.</span>next <span>=</span> right<span>;</span>\n                right <span>=</span> right<span>.</span>next<span>;</span>\n                cur <span>=</span> cur<span>.</span>next<span>;</span>\n            <span>}</span>\n        <span>}</span>\n        <span>if</span><span>(</span>left <span>!=</span> <span>null</span><span>)</span> cur<span>.</span>next <span>=</span> left<span>;</span>\n        <span>if</span><span>(</span>right <span>!=</span> <span>null</span><span>)</span> cur<span>.</span>next <span>=</span> right<span>;</span>\n        <span>return</span> dump<span>.</span>next<span>;</span>\n    <span>}</span>\n<span>}</span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "image": "https://img-blog.csdnimg.cn/763fdaf26170499aa9e1fc4637b43f1f.gif",
      "date_published": "2022-07-03T00:00:00.000Z",
      "date_modified": "2022-06-22T09:31:48.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "algorithm"
      ]
    },
    {
      "title": "SpringBoot中Rest的使用和请求参数注解",
      "url": "https://blog.ciberviler.top/dev/SpringBoot%E4%B8%ADRest%E7%9A%84%E4%BD%BF%E7%94%A8%E5%92%8C%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%B3%A8%E8%A7%A3.html",
      "id": "https://blog.ciberviler.top/dev/SpringBoot%E4%B8%ADRest%E7%9A%84%E4%BD%BF%E7%94%A8%E5%92%8C%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E6%B3%A8%E8%A7%A3.html",
      "content_html": "<h1 id=\"springboot中rest的使用和请求参数注解\" tabindex=\"-1\"> SpringBoot中Rest的使用和请求参数注解</h1>\n<h2 id=\"rest的使用和原理\" tabindex=\"-1\"> Rest的使用和原理</h2>\n<p>Rest风格支持（使用HTTP请求方式动词来表示对资源的操作）\n• 以前：/getUser 获取用户 /deleteUser 删除用户 /editUser 修改用户 /saveUser 保存用户\n• 现在： /user GET-获取用户 DELETE-删除用户 PUT-修改用户 POST-保存用户。\n看下面的一个例子，这是一个表单：</p>\n<div><pre><code><span><span>&lt;!</span><span>DOCTYPE</span> <span>html</span><span>></span></span>\n<span><span><span>&lt;</span>html</span> <span>lang</span><span><span>=</span><span>\"</span>en<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;</span>head</span><span>></span></span>\n    <span><span><span>&lt;</span>meta</span> <span>charset</span><span><span>=</span><span>\"</span>UTF-8<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>title</span><span>></span></span>hah<span><span><span>&lt;/</span>title</span><span>></span></span>\n<span><span><span>&lt;/</span>head</span><span>></span></span>\n<span><span><span>&lt;</span>body</span><span>></span></span>\n<span><span><span>&lt;</span>form</span> <span>action</span><span><span>=</span><span>\"</span>/user<span>\"</span></span> <span>method</span><span><span>=</span><span>\"</span>get<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>input</span> <span>value</span><span><span>=</span><span>\"</span>get<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>submit<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;/</span>form</span><span>></span></span>\n<span><span><span>&lt;</span>form</span> <span>action</span><span><span>=</span><span>\"</span>/user<span>\"</span></span> <span>method</span><span><span>=</span><span>\"</span>post<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>input</span> <span>value</span><span><span>=</span><span>\"</span>post<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>submit<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;/</span>form</span><span>></span></span>\n<span><span><span>&lt;</span>form</span> <span>action</span><span><span>=</span><span>\"</span>/user<span>\"</span></span> <span>method</span><span><span>=</span><span>\"</span>post<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>input</span> <span>value</span><span><span>=</span><span>\"</span>put<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>submit<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;/</span>form</span><span>></span></span>\n<span><span><span>&lt;</span>form</span> <span>action</span><span><span>=</span><span>\"</span>/user<span>\"</span></span> <span>method</span><span><span>=</span><span>\"</span>post<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>input</span> <span>value</span><span><span>=</span><span>\"</span>delete<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>submit<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;/</span>form</span><span>></span></span>\n<span><span><span>&lt;/</span>body</span><span>></span></span>\n<span><span><span>&lt;/</span>html</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>处理上述表单提交的controller。但是我们以put方式和delete方式提交表单时，发现返回的都是GET-张三，不支持put和delete请求。</p>\n<div><pre><code><span>@RestController</span>\n<span>public</span> <span>class</span> <span>UserController</span> <span>{</span>\n\n    <span>@RequestMapping</span><span>(</span>value <span>=</span> <span>\"/user\"</span><span>,</span>method <span>=</span> <span>RequestMethod</span><span>.</span>GET<span>)</span>\n    <span>public</span> <span>String</span> <span>getUser</span><span>(</span><span>)</span><span>{</span>\n        <span>return</span> <span>\"GET-张三\"</span><span>;</span>\n    <span>}</span>\n\n    <span>@RequestMapping</span><span>(</span>value <span>=</span> <span>\"/user\"</span><span>,</span>method <span>=</span> <span>RequestMethod</span><span>.</span>POST<span>)</span>\n    <span>public</span> <span>String</span> <span>saveUser</span><span>(</span><span>)</span><span>{</span>\n        <span>return</span> <span>\"POST-张三\"</span><span>;</span>\n    <span>}</span>\n\n\n    <span>@RequestMapping</span><span>(</span>value <span>=</span> <span>\"/user\"</span><span>,</span>method <span>=</span> <span>RequestMethod</span><span>.</span>PUT<span>)</span>\n    <span>public</span> <span>String</span> <span>putUser</span><span>(</span><span>)</span><span>{</span>\n        <span>return</span> <span>\"PUT-张三\"</span><span>;</span>\n    <span>}</span>\n\n    <span>@RequestMapping</span><span>(</span>value <span>=</span> <span>\"/user\"</span><span>,</span>method <span>=</span> <span>RequestMethod</span><span>.</span>DELETE<span>)</span>\n    <span>public</span> <span>String</span> <span>deleteUser</span><span>(</span><span>)</span><span>{</span>\n        <span>return</span> <span>\"DELETE-张三\"</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>在<strong>WebMvcAutoConfiguration</strong>中<strong>hiddenHttpMethodFilter</strong>方法，返回一个<strong>filter</strong>-&gt;<strong>OrderedHiddenHttpMethodFilter</strong>。<strong>OrderedHiddenHttpMethodFilter</strong>继承自<strong>HiddenHttpMethodFilter</strong>。@ConditionalOnMissingBean({HiddenHttpMethodFilter.class})需要之前<strong>HiddenHttpMethodFilter</strong>没有被注入，并且 @ConditionalOnProperty(prefix = &quot;spring.mvc.hiddenmethod.filter&quot;, name = {&quot;enabled&quot;})要求spring.mvc.hiddenmethod.filter.enabled=true.</p>\n<div><pre><code><span>@Bean</span>\n    <span>@ConditionalOnMissingBean</span><span>(</span><span>{</span><span>HiddenHttpMethodFilter</span><span>.</span><span>class</span><span>}</span><span>)</span>\n    <span>@ConditionalOnProperty</span><span>(</span>\n        prefix <span>=</span> <span>\"spring.mvc.hiddenmethod.filter\"</span><span>,</span>\n        name <span>=</span> <span>{</span><span>\"enabled\"</span><span>}</span>\n    <span>)</span>\n    <span>public</span> <span>OrderedHiddenHttpMethodFilter</span> <span>hiddenHttpMethodFilter</span><span>(</span><span>)</span> <span>{</span>\n        <span>return</span> <span>new</span> <span>OrderedHiddenHttpMethodFilter</span><span>(</span><span>)</span><span>;</span>\n    <span>}</span>\n<span>public</span> <span>class</span> <span>OrderedHiddenHttpMethodFilter</span> <span>extends</span> <span>HiddenHttpMethodFilter</span> <span>implements</span> <span>OrderedFilter</span> <span>{</span>\n\n   <span>/**\n    * The default order is high to ensure the filter is applied before Spring Security.\n    */</span>\n   <span>public</span> <span>static</span> <span>final</span> <span>int</span> DEFAULT_ORDER <span>=</span> REQUEST_WRAPPER_FILTER_MAX_ORDER <span>-</span> <span>10000</span><span>;</span>\n\n   <span>private</span> <span>int</span> order <span>=</span> DEFAULT_ORDER<span>;</span>\n\n   <span>@Override</span>\n   <span>public</span> <span>int</span> <span>getOrder</span><span>(</span><span>)</span> <span>{</span>\n      <span>return</span> <span>this</span><span>.</span>order<span>;</span>\n   <span>}</span>\n   <span>public</span> <span>void</span> <span>setOrder</span><span>(</span><span>int</span> order<span>)</span> <span>{</span>\n      <span>this</span><span>.</span>order <span>=</span> order<span>;</span>\n   <span>}</span>\n\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>HiddenHttpMethodFilter</strong>中有个<strong>DEFAULT_METHOD_PARAM</strong>字段&quot;<strong>_method</strong>&quot;。所以我们在提交表单时也要提交一个&quot;<strong>_method</strong>&quot;参数。并且spring.mvc.hiddenmethod.filter.enabled=true.</p>\n<div><pre><code><span>public</span> <span>class</span> <span>HiddenHttpMethodFilter</span> <span>extends</span> <span>OncePerRequestFilter</span> <span>{</span>\n\n   <span>private</span> <span>static</span> <span>final</span> <span>List</span><span><span>&lt;</span><span>String</span><span>></span></span> ALLOWED_METHODS <span>=</span>\n         <span>Collections</span><span>.</span><span>unmodifiableList</span><span>(</span><span>Arrays</span><span>.</span><span>asList</span><span>(</span><span>HttpMethod</span><span>.</span>PUT<span>.</span><span>name</span><span>(</span><span>)</span><span>,</span>\n               <span>HttpMethod</span><span>.</span>DELETE<span>.</span><span>name</span><span>(</span><span>)</span><span>,</span> <span>HttpMethod</span><span>.</span>PATCH<span>.</span><span>name</span><span>(</span><span>)</span><span>)</span><span>)</span><span>;</span>\n\n   <span>public</span> <span>static</span> <span>final</span> <span>String</span> DEFAULT_METHOD_PARAM <span>=</span> <span>\"_method\"</span><span>;</span>\n\n   <span>private</span> <span>String</span> methodParam <span>=</span> DEFAULT_METHOD_PARAM<span>;</span>\n   <span>public</span> <span>void</span> <span>setMethodParam</span><span>(</span><span>String</span> methodParam<span>)</span> <span>{</span>\n      <span>Assert</span><span>.</span><span>hasText</span><span>(</span>methodParam<span>,</span> <span>\"'methodParam' must not be empty\"</span><span>)</span><span>;</span>\n      <span>this</span><span>.</span>methodParam <span>=</span> methodParam<span>;</span>\n   <span>}</span>\n\n   <span>@Override</span>\n   <span>protected</span> <span>void</span> <span>doFilterInternal</span><span>(</span><span>HttpServletRequest</span> request<span>,</span> <span>HttpServletResponse</span> response<span>,</span> <span>FilterChain</span> filterChain<span>)</span>\n         <span>throws</span> <span>ServletException</span><span>,</span> <span>IOException</span> <span>{</span>\n      <span>HttpServletRequest</span> requestToUse <span>=</span> request<span>;</span>\n      <span>if</span> <span>(</span><span>\"POST\"</span><span>.</span><span>equals</span><span>(</span>request<span>.</span><span>getMethod</span><span>(</span><span>)</span><span>)</span> <span>&amp;&amp;</span> request<span>.</span><span>getAttribute</span><span>(</span><span>WebUtils</span><span>.</span>ERROR_EXCEPTION_ATTRIBUTE<span>)</span> <span>==</span> <span>null</span><span>)</span> <span>{</span>\n         <span>String</span> paramValue <span>=</span> request<span>.</span><span>getParameter</span><span>(</span><span>this</span><span>.</span>methodParam<span>)</span><span>;</span>\n         <span>if</span> <span>(</span><span>StringUtils</span><span>.</span><span>hasLength</span><span>(</span>paramValue<span>)</span><span>)</span> <span>{</span>\n            <span>String</span> method <span>=</span> paramValue<span>.</span><span>toUpperCase</span><span>(</span><span>Locale</span><span>.</span>ENGLISH<span>)</span><span>;</span>\n            <span>if</span> <span>(</span>ALLOWED_METHODS<span>.</span><span>contains</span><span>(</span>method<span>)</span><span>)</span> <span>{</span>\n               requestToUse <span>=</span> <span>new</span> <span>HttpMethodRequestWrapper</span><span>(</span>request<span>,</span> method<span>)</span><span>;</span>\n            <span>}</span>\n         <span>}</span>\n      <span>}</span>\n      filterChain<span>.</span><span>doFilter</span><span>(</span>requestToUse<span>,</span> response<span>)</span><span>;</span>\n   <span>}</span>\n\n   <span>private</span> <span>static</span> <span>class</span> <span>HttpMethodRequestWrapper</span> <span>extends</span> <span>HttpServletRequestWrapper</span> <span>{</span>\n\n      <span>private</span> <span>final</span> <span>String</span> method<span>;</span>\n\n      <span>public</span> <span>HttpMethodRequestWrapper</span><span>(</span><span>HttpServletRequest</span> request<span>,</span> <span>String</span> method<span>)</span> <span>{</span>\n         <span>super</span><span>(</span>request<span>)</span><span>;</span>\n         <span>this</span><span>.</span>method <span>=</span> method<span>;</span>\n      <span>}</span>\n\n      <span>@Override</span>\n      <span>public</span> <span>String</span> <span>getMethod</span><span>(</span><span>)</span> <span>{</span>\n         <span>return</span> <span>this</span><span>.</span>method<span>;</span>\n      <span>}</span>\n   <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>因此修改表单如下：</p>\n<div><pre><code><span><span>&lt;!</span><span>DOCTYPE</span> <span>html</span><span>></span></span>\n<span><span><span>&lt;</span>html</span> <span>lang</span><span><span>=</span><span>\"</span>en<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;</span>head</span><span>></span></span>\n    <span><span><span>&lt;</span>meta</span> <span>charset</span><span><span>=</span><span>\"</span>UTF-8<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>title</span><span>></span></span>hah<span><span><span>&lt;/</span>title</span><span>></span></span>\n<span><span><span>&lt;/</span>head</span><span>></span></span>\n<span><span><span>&lt;</span>body</span><span>></span></span>\n<span><span><span>&lt;</span>form</span> <span>action</span><span><span>=</span><span>\"</span>/user<span>\"</span></span> <span>method</span><span><span>=</span><span>\"</span>get<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>input</span> <span>value</span><span><span>=</span><span>\"</span>get<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>submit<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;/</span>form</span><span>></span></span>\n<span><span><span>&lt;</span>form</span> <span>action</span><span><span>=</span><span>\"</span>/user<span>\"</span></span> <span>method</span><span><span>=</span><span>\"</span>post<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>input</span> <span>value</span><span><span>=</span><span>\"</span>post<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>submit<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;/</span>form</span><span>></span></span>\n<span><span><span>&lt;</span>form</span> <span>action</span><span><span>=</span><span>\"</span>/user<span>\"</span></span> <span>method</span><span><span>=</span><span>\"</span>post<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>input</span> <span>name</span><span><span>=</span><span>\"</span>_method<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>hidden<span>\"</span></span> <span>value</span><span><span>=</span><span>\"</span>put<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>input</span> <span>value</span><span><span>=</span><span>\"</span>put<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>submit<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;/</span>form</span><span>></span></span>\n<span><span><span>&lt;</span>form</span> <span>action</span><span><span>=</span><span>\"</span>/user<span>\"</span></span> <span>method</span><span><span>=</span><span>\"</span>post<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>input</span> <span>name</span><span><span>=</span><span>\"</span>_method<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>hidden<span>\"</span></span> <span>value</span><span><span>=</span><span>\"</span>delete<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>input</span> <span>value</span><span><span>=</span><span>\"</span>delete<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>submit<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;/</span>form</span><span>></span></span>\n\n<span><span><span>&lt;/</span>body</span><span>></span></span>\n<span><span><span>&lt;/</span>html</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>配置yaml:</p>\n<div><pre><code><span>spring</span><span>:</span>\n  <span>mvc</span><span>:</span>\n    <span>hiddenmethod</span><span>:</span>\n      <span>filter</span><span>:</span>\n        <span>enabled</span><span>:</span> <span>true</span> <span>#开启页面表单的Rest功能</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>修改表单，配置yaml之后，再点击delete 和put就可以发送delete 和put请求了。</strong></p>\n<h3 id=\"rest原理\" tabindex=\"-1\"> Rest原理</h3>\n<p>表单提交要使用REST的时候：</p>\n<ul>\n<li>表单提交会带上**_method=PUT**</li>\n<li><strong>请求过来被</strong>HiddenHttpMethodFilter拦截</li>\n<li>1.如果请求正常，并且是POST（if (&quot;POST&quot;.equals(request.getMethod()) &amp;&amp; request.getAttribute(WebUtils.ERROR_EXCEPTION_ATTRIBUTE) == null) ）则获取**_method**的值</li>\n<li>\n<ul>\n<li>2.获取到**_method<strong>的值，如果是</strong>ALLOWED_METHODS<strong>里的方法（<strong>PUT</strong>.<strong>DELETE</strong>.<strong>PATCH</strong>）则将方法传给包装模式类</strong>requesWrapper**，requesWrapper只改变了请求方式。</li>\n</ul>\n</li>\n</ul>\n<p><strong>原生request（post），包装模式requesWrapper重写了getMethod方法，返回的是传入的值。</strong>\n<strong>过滤器链放行的时候用wrapper。以后的方法调用getMethod是调用requesWrapper的。</strong></p>\n<div><pre><code><span>@Override</span>\n<span>protected</span> <span>void</span> <span>doFilterInternal</span><span>(</span><span>HttpServletRequest</span> request<span>,</span> <span>HttpServletResponse</span> response<span>,</span> <span>FilterChain</span> filterChain<span>)</span>\n      <span>throws</span> <span>ServletException</span><span>,</span> <span>IOException</span> <span>{</span>\n\n   <span>HttpServletRequest</span> requestToUse <span>=</span> request<span>;</span>\n\n   <span>if</span> <span>(</span><span>\"POST\"</span><span>.</span><span>equals</span><span>(</span>request<span>.</span><span>getMethod</span><span>(</span><span>)</span><span>)</span> <span>&amp;&amp;</span> request<span>.</span><span>getAttribute</span><span>(</span><span>WebUtils</span><span>.</span>ERROR_EXCEPTION_ATTRIBUTE<span>)</span> <span>==</span> <span>null</span><span>)</span> <span>{</span>\n      <span>// paramValue拿到的是_method</span>\n       <span>String</span> paramValue <span>=</span> request<span>.</span><span>getParameter</span><span>(</span><span>this</span><span>.</span>methodParam<span>)</span><span>;</span>\n      <span>if</span> <span>(</span><span>StringUtils</span><span>.</span><span>hasLength</span><span>(</span>paramValue<span>)</span><span>)</span> <span>{</span>\n         <span>String</span> method <span>=</span> paramValue<span>.</span><span>toUpperCase</span><span>(</span><span>Locale</span><span>.</span>ENGLISH<span>)</span><span>;</span>\n         <span>if</span> <span>(</span>ALLOWED_METHODS<span>.</span><span>contains</span><span>(</span>method<span>)</span><span>)</span> <span>{</span>\n            requestToUse <span>=</span> <span>new</span> <span>HttpMethodRequestWrapper</span><span>(</span>request<span>,</span> method<span>)</span><span>;</span>\n         <span>}</span>\n      <span>}</span>\n   <span>}</span>\n\n   filterChain<span>.</span><span>doFilter</span><span>(</span>requestToUse<span>,</span> response<span>)</span><span>;</span>\n<span>}</span>\n<span>private</span> <span>static</span> <span>final</span> <span>List</span><span><span>&lt;</span><span>String</span><span>></span></span> ALLOWED_METHODS <span>=</span>\n      <span>Collections</span><span>.</span><span>unmodifiableList</span><span>(</span><span>Arrays</span><span>.</span><span>asList</span><span>(</span><span>HttpMethod</span><span>.</span>PUT<span>.</span><span>name</span><span>(</span><span>)</span><span>,</span>\n            <span>HttpMethod</span><span>.</span>DELETE<span>.</span><span>name</span><span>(</span><span>)</span><span>,</span> <span>HttpMethod</span><span>.</span>PATCH<span>.</span><span>name</span><span>(</span><span>)</span><span>)</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>requesWrapper:</strong></p>\n<div><pre><code><span>private</span> <span>static</span> <span>class</span> <span>HttpMethodRequestWrapper</span> <span>extends</span> <span>HttpServletRequestWrapper</span> <span>{</span>\n\n\t\t<span>private</span> <span>final</span> <span>String</span> method<span>;</span>\n\n\t\t<span>public</span> <span>HttpMethodRequestWrapper</span><span>(</span><span>HttpServletRequest</span> request<span>,</span> <span>String</span> method<span>)</span> <span>{</span>\n\t\t\t<span>super</span><span>(</span>request<span>)</span><span>;</span>\n\t\t\t<span>this</span><span>.</span>method <span>=</span> method<span>;</span>\n\t\t<span>}</span>\n\n\t\t<span>@Override</span>\n\t\t<span>public</span> <span>String</span> <span>getMethod</span><span>(</span><span>)</span> <span>{</span>\n\t\t\t<span>return</span> <span>this</span><span>.</span>method<span>;</span>\n\t\t<span>}</span>\n\t<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"将-method改成其他名字\" tabindex=\"-1\"> 将_method改成其他名字</h3>\n<p>将**_method<strong>改成了</strong>_m**,此时因为程序中无法获取**_m**，所以我们表单中点击<strong>delete</strong>依然是<strong>post</strong>,因此我们需要再更改表单即可。</p>\n<div><pre><code><span>//自定义filter</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>context<span>.</span>annotation<span>.</span></span><span>Bean</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>context<span>.</span>annotation<span>.</span></span><span>Configuration</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>filter<span>.</span></span><span>HiddenHttpMethodFilter</span></span><span>;</span>\n\n<span>@Configuration</span><span>(</span>proxyBeanMethods <span>=</span> <span>false</span><span>)</span>\n<span>public</span> <span>class</span> <span>RestConfig</span> <span>{</span>\n\n    <span>@Bean</span>\n    <span>public</span> <span>HiddenHttpMethodFilter</span> <span>hiddenHttpMethodFilter</span><span>(</span><span>)</span><span>{</span>\n        <span>HiddenHttpMethodFilter</span> methodFilter <span>=</span> <span>new</span> <span>HiddenHttpMethodFilter</span><span>(</span><span>)</span><span>;</span>\n        methodFilter<span>.</span><span>setMethodParam</span><span>(</span><span>\"_m\"</span><span>)</span><span>;</span>\n        <span>return</span> methodFilter<span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>修改form表单，添加_m：</strong></p>\n<div><pre><code><span><span>&lt;!</span><span>DOCTYPE</span> <span>html</span><span>></span></span>\n<span><span><span>&lt;</span>html</span> <span>lang</span><span><span>=</span><span>\"</span>en<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;</span>head</span><span>></span></span>\n    <span><span><span>&lt;</span>meta</span> <span>charset</span><span><span>=</span><span>\"</span>UTF-8<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>title</span><span>></span></span>hah<span><span><span>&lt;/</span>title</span><span>></span></span>\n<span><span><span>&lt;/</span>head</span><span>></span></span>\n<span><span><span>&lt;</span>body</span><span>></span></span>\n<span><span><span>&lt;</span>form</span> <span>action</span><span><span>=</span><span>\"</span>/user<span>\"</span></span> <span>method</span><span><span>=</span><span>\"</span>get<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>input</span> <span>value</span><span><span>=</span><span>\"</span>get<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>submit<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;/</span>form</span><span>></span></span>\n<span><span><span>&lt;</span>form</span> <span>action</span><span><span>=</span><span>\"</span>/user<span>\"</span></span> <span>method</span><span><span>=</span><span>\"</span>post<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>input</span> <span>value</span><span><span>=</span><span>\"</span>post<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>submit<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;/</span>form</span><span>></span></span>\n<span><span><span>&lt;</span>form</span> <span>action</span><span><span>=</span><span>\"</span>/user<span>\"</span></span> <span>method</span><span><span>=</span><span>\"</span>post<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>input</span> <span>name</span><span><span>=</span><span>\"</span>_method<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>hidden<span>\"</span></span> <span>value</span><span><span>=</span><span>\"</span>put<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>input</span> <span>name</span><span><span>=</span><span>\"</span>_m<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>hidden<span>\"</span></span> <span>value</span><span><span>=</span><span>\"</span>put<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>input</span> <span>value</span><span><span>=</span><span>\"</span>put<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>submit<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;/</span>form</span><span>></span></span>\n<span><span><span>&lt;</span>form</span> <span>action</span><span><span>=</span><span>\"</span>/user<span>\"</span></span> <span>method</span><span><span>=</span><span>\"</span>post<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>input</span> <span>name</span><span><span>=</span><span>\"</span>_method<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>hidden<span>\"</span></span> <span>value</span><span><span>=</span><span>\"</span>delete<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>input</span> <span>name</span><span><span>=</span><span>\"</span>_m<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>hidden<span>\"</span></span> <span>value</span><span><span>=</span><span>\"</span>delete<span>\"</span></span><span>></span></span>\n    <span><span><span>&lt;</span>input</span> <span>value</span><span><span>=</span><span>\"</span>delete<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>submit<span>\"</span></span><span>></span></span>\n<span><span><span>&lt;/</span>form</span><span>></span></span>\n\n<span><span><span>&lt;/</span>body</span><span>></span></span>\n<span><span><span>&lt;/</span>html</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"rest使用客户端工具\" tabindex=\"-1\"> Rest使用客户端工具</h3>\n<ul>\n<li>**如PostMan直接发送Put、delete等方式请求，无需Filter。**表单只能用get,post请求。</li>\n</ul>\n<h2 id=\"请求处理-参数注解\" tabindex=\"-1\"> 请求处理----参数注解</h2>\n<p><strong>@PathVariable、@RequestHeader、@ModelAttribute、@RequestParam、@MatrixVariable、@CookieValue、@RequestBody</strong></p>\n<h4 id=\"参数注解作用\" tabindex=\"-1\"> 参数注解作用</h4>\n<h5 id=\"pathvariable\" tabindex=\"-1\"> <strong>@PathVariable</strong></h5>\n<p>作用：<code>@PathVariable</code>是spring3.0的一个新功能：接收请求路径中占位符的值，将URL中占位符参数<code>{xxx}</code>绑定到处理器类的方法形参中<code>@PathVariable(“xxx“)</code>，上如果有多个占位符，形参列表需要定义多个参数，不是很方便，可以直接定义一个map集合<code>@PathVariable Map&lt;String,String&gt; kv</code>，会自动映射多个参数；</p>\n<h5 id=\"requestparam\" tabindex=\"-1\"> @RequestParam</h5>\n<p>@RequestParam主要用于将请求参数区域的数据映射到控制层方法的参数上</p>\n<div><pre><code><span>@RequestParam</span><span>(</span>value<span>=</span>”参数名”<span>,</span>required<span>=</span>”<span>true</span><span>/</span><span>false</span>”<span>,</span>defaultValue<span>=</span>””<span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><ul>\n<li><code>value</code>：请求中传入参数的名称，即前端传过来时定义的参数名。如果不设置value值，则前端定义的参数名必须和后端接口参数名相同</li>\n<li><code>required</code>：该参数是否为必传项。默认是true，表示请求中一定要传入对应的参数，否则会报404错误；如果设置为false，当请求中没有此参数，将会默认为null。而对于基本数据类型的变量，则必须有值，这时会抛出空指针异常。如果允许空值，则接口中变量需要使用包装类来声明。</li>\n<li><code>defaultValue</code>：参数的默认值，如果请求中没有同名的参数时，该变量默认为此值。</li>\n</ul>\n<h5 id=\"requestbody\" tabindex=\"-1\"> @RequestBody</h5>\n<p>作用：@RequestBody主要用来接收前端传递给后端的json字符串中的数据的(请求体中的数据的)</p>\n<ul>\n<li>GET方式无请求体，所以使用@RequestBody接收数据时，前端不能使用GET方式提交数据，而是用POST方式进行提交</li>\n<li>在后端的同一个接收方法里，@RequestBody与@RequestParam()可以同时使用，@RequestBody最多只能有一个，而@RequestParam()可以有多个</li>\n<li>如果参数时放在请求体application/json传入后台的话，那么后台要用@RequestBody才能接收到</li>\n<li>如果不是放在请求体中的话，那么后台接收前台传过来的参数时，要用@RequestParam来接收，或者形参前 什么也不写也能接收</li>\n</ul>\n<h5 id=\"cookievalue\" tabindex=\"-1\"> <strong>@CookieValue</strong></h5>\n<p>同请求头类似，可以获取cookie属性，也可以将获取到的属性封装为cookie对象</p>\n<h5 id=\"requestattribute\" tabindex=\"-1\"> <strong>@RequestAttribute</strong></h5>\n<p>获取请求域中的信息</p>\n<div><pre><code><span>@Controller</span>\n<span>public</span> <span>class</span> <span>GoController</span> <span>{</span>\n    <span>@GetMapping</span><span>(</span><span>\"/goto\"</span><span>)</span>\n    <span>public</span> <span>String</span> <span>goPage</span><span>(</span><span>HttpServletRequest</span> request<span>)</span><span>{</span>\n        request<span>.</span><span>setAttribute</span><span>(</span><span>\"msg\"</span><span>,</span><span>\"成功\"</span><span>)</span><span>;</span>\n        request<span>.</span><span>setAttribute</span><span>(</span><span>\"code\"</span><span>,</span><span>\"200\"</span><span>)</span><span>;</span>\n        <span>return</span> <span>\"forward:/success\"</span><span>;</span>\n    <span>}</span>\n    <span>@ResponseBody</span>\n    <span>@GetMapping</span><span>(</span><span>\"/success\"</span><span>)</span>\n    <span>public</span> <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span><span>Object</span><span>></span></span> <span>getmap</span><span>(</span><span>@RequestAttribute</span><span>(</span><span>\"msg\"</span><span>)</span> <span>String</span> msg<span>,</span>\n                                     <span>@RequestAttribute</span><span>(</span><span>\"code\"</span><span>)</span> <span>String</span> code<span>)</span><span>{</span>\n        <span>HashMap</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> map <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"msg\"</span><span>,</span>msg<span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"code\"</span><span>,</span>code<span>)</span><span>;</span>\n        <span>return</span> map<span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h5 id=\"matrixvariable\" tabindex=\"-1\"> <strong>@MatrixVariable</strong></h5>\n<p>读取矩阵变量，矩阵变量语法如下，每一个变量之间用分号隔开</p>\n<p>语法： 请求路径：/cars/sell;low=34;brand=byd,audi,yd</p>\n<div><pre><code><span>//cars/sell;low=34;brand=byd,audi,yd</span>\n<span>@GetMapping</span><span>(</span><span>\"/car/{path}\"</span><span>)</span>\n<span>public</span> <span>Map</span> <span>test2</span><span>(</span><span>@MatrixVariable</span><span>(</span><span>\"low\"</span><span>)</span> <span>String</span> low<span>,</span>\n                 <span>@MatrixVariable</span><span>(</span><span>\"brand\"</span><span>)</span> <span>List</span><span><span>&lt;</span><span>String</span><span>></span></span> brand<span>,</span>\n                 <span>@PathVariable</span><span>(</span><span>\"path\"</span><span>)</span> <span>String</span> path<span>)</span><span>{</span>\n    <span>HashMap</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> map <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n    map<span>.</span><span>put</span><span>(</span><span>\"low\"</span><span>,</span>low<span>)</span><span>;</span>\n    map<span>.</span><span>put</span><span>(</span><span>\"brand\"</span><span>,</span>brand<span>)</span><span>;</span>\n    map<span>.</span><span>put</span><span>(</span><span>\"path\"</span><span>,</span>path<span>)</span><span>;</span>\n    <span>return</span> map<span>;</span>\n<span>}</span>\n<span>//{\"path\":\"sell\",\"low\":34,\"brand\":[\"byd\",\"audi\",\"yd\"]}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"示例\" tabindex=\"-1\"> 示例：</h4>\n<p>请求地址如果为：<a href=\"http://localhost:9999/car/2/owner/zhangsan?age=18&amp;inters=basketball&amp;inters=football\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:9999/car/2/owner/zhangsan?age=18&amp;inters=basketball&amp;inters=football</a></p>\n<div><pre><code><span>@PathVariable</span><span>(</span><span>\"id\"</span><span>)</span> <span>Integer</span> id<span>:</span> 获取路径中<span>{</span>id<span>}</span>\n<span>@PathVariable</span><span>(</span><span>\"username\"</span><span>)</span> <span>String</span> name： 获取路径中<span>{</span>username<span>}</span>\n<span>@PathVariable</span> <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>String</span><span>></span></span> pv： 获取路径中所有的路径变量\n<span>@RequestHeader</span><span>(</span><span>\"User-Agent\"</span><span>)</span> <span>String</span> userAgent： 获取请求头中userAgent\n<span>@RequestHeader</span> <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>String</span><span>></span></span> header： 获取请求头中所有参数\n<span>@RequestParam</span><span>(</span><span>\"age\"</span><span>)</span> <span>Integer</span> age： 获取请求参数中<span>\"age\"</span>\n<span>@RequestParam</span><span>(</span><span>\"inters\"</span><span>)</span> <span>List</span><span><span>&lt;</span><span>String</span><span>></span></span> inters： 获取请求参数中<span>\"inters\"</span>\n<span>@RequestParam</span> <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>String</span><span>></span></span> params： 获取所有的请求参数\n<span>@CookieValue</span><span>(</span><span>\"_ga\"</span><span>)</span> <span>String</span> _ga： 获取cookie中_ga的值\n<span>@CookieValue</span><span>(</span><span>\"_ga\"</span><span>)</span> <span>Cookie</span> cookie<span>)</span> ： 获取cookie\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>import</span> <span><span>javax<span>.</span>servlet<span>.</span>http<span>.</span></span><span>Cookie</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>HashMap</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>List</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Map</span></span><span>;</span>\n\n<span>@RestController</span>\n<span>public</span> <span>class</span> <span>ParameterTestController</span> <span>{</span>\n\n\n    <span>//  http://localhost:9999/car/2/owner/zhangsan?age=18&amp;inters=basketball&amp;inters=football</span>\n    <span>@GetMapping</span><span>(</span><span>\"/car/{id}/owner/{username}\"</span><span>)</span>\n    <span>public</span> <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> <span>getCar</span><span>(</span><span>@PathVariable</span><span>(</span><span>\"id\"</span><span>)</span> <span>Integer</span> id<span>,</span>\n                                      <span>@PathVariable</span><span>(</span><span>\"username\"</span><span>)</span> <span>String</span> name<span>,</span>\n                                      <span>@PathVariable</span> <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>String</span><span>></span></span> pv<span>,</span>\n                                      <span>@RequestHeader</span><span>(</span><span>\"User-Agent\"</span><span>)</span> <span>String</span> userAgent<span>,</span>\n                                      <span>@RequestHeader</span> <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>String</span><span>></span></span> header<span>,</span>\n                                      <span>@RequestParam</span><span>(</span><span>\"age\"</span><span>)</span> <span>Integer</span> age<span>,</span>\n                                      <span>@RequestParam</span><span>(</span><span>\"inters\"</span><span>)</span> <span>List</span><span><span>&lt;</span><span>String</span><span>></span></span> inters<span>,</span>\n                                      <span>@RequestParam</span> <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>String</span><span>></span></span> params<span>,</span>\n                                      <span>@CookieValue</span><span>(</span><span>\"_ga\"</span><span>)</span> <span>String</span> _ga<span>,</span>\n                                      <span>@CookieValue</span><span>(</span><span>\"_ga\"</span><span>)</span> <span>Cookie</span> cookie<span>)</span> <span>{</span>\n\n\n        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> map <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n\n        map<span>.</span><span>put</span><span>(</span><span>\"id\"</span><span>,</span> id<span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"name\"</span><span>,</span> name<span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"pv\"</span><span>,</span> pv<span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"userAgent\"</span><span>,</span> userAgent<span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"headers\"</span><span>,</span> header<span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"age\"</span><span>,</span> age<span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"inters\"</span><span>,</span> inters<span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"params\"</span><span>,</span> params<span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"_ga\"</span><span>,</span> _ga<span>)</span><span>;</span>\n        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>cookie<span>.</span><span>getName</span><span>(</span><span>)</span> <span>+</span> <span>\"===>\"</span> <span>+</span> cookie<span>.</span><span>getValue</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>return</span> map<span>;</span>\n    <span>}</span>\n\n\n    <span>@PostMapping</span><span>(</span><span>\"/save\"</span><span>)</span>\n    <span>public</span> <span>Map</span> <span>postMethod</span><span>(</span><span>@RequestBody</span> <span>String</span> content<span>)</span> <span>{</span>\n        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> map <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"content\"</span><span>,</span> content<span>)</span><span>;</span>\n        <span>return</span> map<span>;</span>\n    <span>}</span>\n\n\n    <span>//1、语法： 请求路径：/cars/sell;low=34;brand=byd,audi,yd</span>\n    <span>//2、SpringBoot默认是禁用了矩阵变量的功能</span>\n    <span>//      手动开启：原理。对于路径的处理。UrlPathHelper进行解析。</span>\n    <span>//              removeSemicolonContent（移除分号内容）支持矩阵变量的</span>\n    <span>//3、矩阵变量必须有url路径变量才能被解析</span>\n    <span>@GetMapping</span><span>(</span><span>\"/cars/{path}\"</span><span>)</span>\n    <span>public</span> <span>Map</span> <span>carsSell</span><span>(</span><span>@MatrixVariable</span><span>(</span><span>\"low\"</span><span>)</span> <span>Integer</span> low<span>,</span>\n                        <span>@MatrixVariable</span><span>(</span><span>\"brand\"</span><span>)</span> <span>List</span><span><span>&lt;</span><span>String</span><span>></span></span> brand<span>,</span>\n                        <span>@PathVariable</span><span>(</span><span>\"path\"</span><span>)</span> <span>String</span> path<span>)</span> <span>{</span>\n        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> map <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n\n        map<span>.</span><span>put</span><span>(</span><span>\"low\"</span><span>,</span> low<span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"brand\"</span><span>,</span> brand<span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"path\"</span><span>,</span> path<span>)</span><span>;</span>\n        <span>return</span> map<span>;</span>\n    <span>}</span>\n\n    <span>// /boss/1;age=20/2;age=10</span>\n\n    <span>@GetMapping</span><span>(</span><span>\"/boss/{bossId}/{empId}\"</span><span>)</span>\n    <span>public</span> <span>Map</span> <span>boss</span><span>(</span><span>@MatrixVariable</span><span>(</span>value <span>=</span> <span>\"age\"</span><span>,</span> pathVar <span>=</span> <span>\"bossId\"</span><span>)</span> <span>Integer</span> bossAge<span>,</span>\n                    <span>@MatrixVariable</span><span>(</span>value <span>=</span> <span>\"age\"</span><span>,</span> pathVar <span>=</span> <span>\"empId\"</span><span>)</span> <span>Integer</span> empAge<span>)</span> <span>{</span>\n        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> map <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n\n        map<span>.</span><span>put</span><span>(</span><span>\"bossAge\"</span><span>,</span> bossAge<span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"empAge\"</span><span>,</span> empAge<span>)</span><span>;</span>\n        <span>return</span> map<span>;</span>\n\n    <span>}</span>\n\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "date_published": "2022-07-02T00:00:00.000Z",
      "date_modified": "2022-06-22T10:40:36.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "SpringBoot整合Mybatis-plus及用法2",
      "url": "https://blog.ciberviler.top/dev/SpringBoot%E6%95%B4%E5%90%88Mybatis-plus%E5%8F%8A%E7%94%A8%E6%B3%952.html",
      "id": "https://blog.ciberviler.top/dev/SpringBoot%E6%95%B4%E5%90%88Mybatis-plus%E5%8F%8A%E7%94%A8%E6%B3%952.html",
      "content_html": "<h1 id=\"springboot整合mybatis-plus及用法2\" tabindex=\"-1\"> SpringBoot整合Mybatis-plus及用法2</h1>\n<h2 id=\"创建项目\" tabindex=\"-1\"> 创建项目</h2>\n<p>普通的spring-boot项目，在 <a href=\"https://start.spring.io\" target=\"_blank\" rel=\"noopener noreferrer\">start.spring.io</a>或者使用idea创建都行，相关依赖如下</p>\n<p>我这版本用的springboot版本是 2.1.4</p>\n<div><pre><code><span><span><span>&lt;</span>dependencies</span><span>></span></span>\n\t<span><span><span>&lt;</span>dependency</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>groupId</span><span>></span></span>org.springframework.boot<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>artifactId</span><span>></span></span>spring-boot-starter-web<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n\t<span><span><span>&lt;/</span>dependency</span><span>></span></span>\n\n\t<span><span><span>&lt;</span>dependency</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>groupId</span><span>></span></span>org.springframework.boot<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>artifactId</span><span>></span></span>spring-boot-devtools<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>scope</span><span>></span></span>runtime<span><span><span>&lt;/</span>scope</span><span>></span></span>\n\t<span><span><span>&lt;/</span>dependency</span><span>></span></span>\n\t<span><span><span>&lt;</span>dependency</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>groupId</span><span>></span></span>mysql<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>artifactId</span><span>></span></span>mysql-connector-java<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>scope</span><span>></span></span>runtime<span><span><span>&lt;/</span>scope</span><span>></span></span>\n\t<span><span><span>&lt;/</span>dependency</span><span>></span></span>\n\t<span><span><span>&lt;</span>dependency</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>groupId</span><span>></span></span>org.projectlombok<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>artifactId</span><span>></span></span>lombok<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>optional</span><span>></span></span>true<span><span><span>&lt;/</span>optional</span><span>></span></span>\n\t<span><span><span>&lt;/</span>dependency</span><span>></span></span>\n\t<span><span><span>&lt;</span>dependency</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>groupId</span><span>></span></span>org.springframework.boot<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>artifactId</span><span>></span></span>spring-boot-starter-test<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>scope</span><span>></span></span>test<span><span><span>&lt;/</span>scope</span><span>></span></span>\n\t<span><span><span>&lt;/</span>dependency</span><span>></span></span>\n\n\t<span><span><span>&lt;</span>dependency</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>groupId</span><span>></span></span>com.baomidou<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>artifactId</span><span>></span></span>mybatis-plus-boot-starter<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>version</span><span>></span></span>3.1.0<span><span><span>&lt;/</span>version</span><span>></span></span>\n\t<span><span><span>&lt;/</span>dependency</span><span>></span></span>\n<span><span><span>&lt;/</span>dependencies</span><span>></span></span>\n<span><span><span>&lt;</span>build</span><span>></span></span>\n\t<span><span><span>&lt;</span>resources</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>resource</span><span>></span></span>\n\t\t\t<span><span><span>&lt;</span>directory</span><span>></span></span>src/main/java<span><span><span>&lt;/</span>directory</span><span>></span></span>\n\t\t\t<span><span><span>&lt;</span>includes</span><span>></span></span>\n\t\t\t\t<span><span><span>&lt;</span>include</span><span>></span></span>**/*.xml<span><span><span>&lt;/</span>include</span><span>></span></span>\n\t\t\t<span><span><span>&lt;/</span>includes</span><span>></span></span>\n\t\t\t<span><span><span>&lt;</span>filtering</span><span>></span></span>true<span><span><span>&lt;/</span>filtering</span><span>></span></span>\n\t\t<span><span><span>&lt;/</span>resource</span><span>></span></span>\n\t\t<span><span><span>&lt;</span>resource</span><span>></span></span>\n\t\t\t<span><span><span>&lt;</span>directory</span><span>></span></span>src/main/resources<span><span><span>&lt;/</span>directory</span><span>></span></span>\n\t\t<span><span><span>&lt;/</span>resource</span><span>></span></span>\n\t<span><span><span>&lt;/</span>resources</span><span>></span></span>\n<span><span><span>&lt;/</span>build</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"建表\" tabindex=\"-1\"> 建表</h2>\n<div><pre><code><span>CREATE</span> <span>TABLE</span> <span><span>`</span>topic<span>`</span></span> <span>(</span>\n  <span><span>`</span>id<span>`</span></span> <span>int</span><span>(</span><span>11</span><span>)</span> <span>NOT</span> <span>NULL</span> <span>AUTO_INCREMENT</span><span>,</span>\n  <span><span>`</span>title<span>`</span></span> <span>varchar</span><span>(</span><span>255</span><span>)</span> <span>DEFAULT</span> <span>NULL</span><span>,</span>\n  <span><span>`</span>content<span>`</span></span> <span>varchar</span><span>(</span><span>255</span><span>)</span> <span>DEFAULT</span> <span>NULL</span><span>,</span>\n  <span><span>`</span>tag<span>`</span></span> <span>varchar</span><span>(</span><span>255</span><span>)</span> <span>DEFAULT</span> <span>NULL</span><span>,</span>\n  <span><span>`</span>in_time<span>`</span></span> <span>datetime</span> <span>DEFAULT</span> <span>NULL</span><span>,</span>\n  <span>PRIMARY</span> <span>KEY</span> <span>(</span><span><span>`</span>id<span>`</span></span><span>)</span>\n<span>)</span> <span>ENGINE</span><span>=</span><span>InnoDB</span> <span>AUTO_INCREMENT</span><span>=</span><span>14</span> <span>DEFAULT</span> <span>CHARSET</span><span>=</span>utf8<span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>插入一些数据</p>\n<div><pre><code><span>INSERT</span> <span>INTO</span> <span><span>`</span>topic<span>`</span></span> <span>(</span><span><span>`</span>id<span>`</span></span><span>,</span> <span><span>`</span>title<span>`</span></span><span>,</span> <span><span>`</span>content<span>`</span></span><span>,</span> <span><span>`</span>tag<span>`</span></span><span>,</span> <span><span>`</span>in_time<span>`</span></span><span>)</span>\n<span>VALUES</span>\n\t<span>(</span><span>1</span><span>,</span> <span>'title1'</span><span>,</span> <span>'content1'</span><span>,</span> <span>'tag1'</span><span>,</span> <span>'2019-04-15 09:33:35'</span><span>)</span><span>,</span>\n\t<span>(</span><span>2</span><span>,</span> <span>'title2'</span><span>,</span> <span>'content2'</span><span>,</span> <span>'tag2'</span><span>,</span> <span>'2019-04-15 09:33:35'</span><span>)</span><span>,</span>\n\t<span>(</span><span>3</span><span>,</span> <span>'title3'</span><span>,</span> <span>'content3'</span><span>,</span> <span>'tag3'</span><span>,</span> <span>'2019-04-15 09:33:35'</span><span>)</span><span>,</span>\n\t<span>(</span><span>4</span><span>,</span> <span>'title4'</span><span>,</span> <span>'content4'</span><span>,</span> <span>'tag4'</span><span>,</span> <span>'2019-04-15 09:33:35'</span><span>)</span><span>,</span>\n\t<span>(</span><span>5</span><span>,</span> <span>'title4'</span><span>,</span> <span>'content4'</span><span>,</span> <span>'tag4'</span><span>,</span> <span>'2019-04-15 09:33:35'</span><span>)</span><span>,</span>\n\t<span>(</span><span>6</span><span>,</span> <span>'title4'</span><span>,</span> <span>'content4'</span><span>,</span> <span>'tag4'</span><span>,</span> <span>'2019-04-15 09:33:35'</span><span>)</span><span>,</span>\n\t<span>(</span><span>7</span><span>,</span> <span>'title4'</span><span>,</span> <span>'content4'</span><span>,</span> <span>'tag4'</span><span>,</span> <span>'2019-04-15 09:33:35'</span><span>)</span><span>,</span>\n\t<span>(</span><span>8</span><span>,</span> <span>'title4'</span><span>,</span> <span>'content4'</span><span>,</span> <span>'tag4'</span><span>,</span> <span>'2019-04-15 09:33:35'</span><span>)</span><span>,</span>\n\t<span>(</span><span>9</span><span>,</span> <span>'title4'</span><span>,</span> <span>'content4'</span><span>,</span> <span>'tag4'</span><span>,</span> <span>'2019-04-15 09:33:35'</span><span>)</span><span>,</span>\n\t<span>(</span><span>10</span><span>,</span> <span>'title4'</span><span>,</span> <span>'content4'</span><span>,</span> <span>'tag4'</span><span>,</span> <span>'2019-04-15 09:33:35'</span><span>)</span><span>,</span>\n\t<span>(</span><span>11</span><span>,</span> <span>'title4'</span><span>,</span> <span>'content4'</span><span>,</span> <span>'tag4'</span><span>,</span> <span>'2019-04-15 09:33:35'</span><span>)</span><span>,</span>\n\t<span>(</span><span>12</span><span>,</span> <span>'title4'</span><span>,</span> <span>'content4'</span><span>,</span> <span>'tag4'</span><span>,</span> <span>'2019-04-15 09:33:35'</span><span>)</span><span>,</span>\n\t<span>(</span><span>13</span><span>,</span> <span>'title4'</span><span>,</span> <span>'content4'</span><span>,</span> <span>'tag4'</span><span>,</span> <span>'2019-04-15 09:33:35'</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"创建实体类\" tabindex=\"-1\"> 创建实体类</h2>\n<div><pre><code><span>@Data</span>\n<span>public</span> <span>class</span> <span>Topic</span> <span>{</span>\n\n  <span>@TableId</span><span>(</span>type <span>=</span> <span>IdType</span><span>.</span>AUTO<span>)</span>\n  <span>private</span> <span>Integer</span> id<span>;</span>\n\n  <span>private</span> <span>String</span> title<span>;</span>\n  <span>private</span> <span>String</span> content<span>;</span>\n  <span>private</span> <span>String</span> tag<span>;</span>\n  <span>private</span> <span>Date</span> inTime<span>;</span>\n\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"创建mapper\" tabindex=\"-1\"> 创建mapper</h2>\n<div><pre><code><span>public</span> <span>interface</span> <span>TopicMapper</span> <span>extends</span> <span>BaseMapper</span><span><span>&lt;</span><span>Topic</span><span>></span></span> <span>{</span>\n\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h2 id=\"创建service\" tabindex=\"-1\"> 创建service</h2>\n<div><pre><code><span>@Service</span>\n<span>@Transactional</span>\n<span>public</span> <span>class</span> <span>TopicService</span> <span>{</span>\n\n  <span>@Autowired</span>\n  <span>private</span> <span>TopicMapper</span> topicMapper<span>;</span>\n\n  <span>public</span> <span>List</span><span><span>&lt;</span><span>Topic</span><span>></span></span> <span>list</span><span>(</span><span>)</span> <span>{</span>\n    <span>return</span> topicMapper<span>.</span><span>selectList</span><span>(</span><span>new</span> <span>QueryWrapper</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>)</span><span>;</span>\n  <span>}</span>\n\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"创建controller\" tabindex=\"-1\"> 创建controller</h2>\n<div><pre><code><span>@RestController</span>\n<span>public</span> <span>class</span> <span>TopicController</span> <span>{</span>\n\n  <span>@Autowired</span>\n  <span>private</span> <span>TopicService</span> topicService<span>;</span>\n\n  <span>@GetMapping</span><span>(</span><span>\"/\"</span><span>)</span>\n  <span>public</span> <span>Object</span> <span>list</span><span>(</span><span>)</span> <span>{</span>\n    <span>return</span> topicService<span>.</span><span>list</span><span>(</span><span>)</span><span>;</span>\n  <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"添加包扫描\" tabindex=\"-1\"> 添加包扫描</h2>\n<p>最后在启动类 <code>MybatisPlusDemoApplication.java</code> 上加上扫描包的注解，如下</p>\n<div><pre><code><span>@SpringBootApplication</span>\n<span>@MapperScan</span><span>(</span><span>\"com.example.mybatisplusdemo.mapper\"</span><span>)</span>\n<span>public</span> <span>class</span> <span>MybatisPlusDemoApplication</span> <span>{</span>\n\n  <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>{</span>\n    <span>SpringApplication</span><span>.</span><span>run</span><span>(</span><span>MybatisPlusDemoApplication</span><span>.</span><span>class</span><span>,</span> args<span>)</span><span>;</span>\n  <span>}</span>\n\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"测试\" tabindex=\"-1\"> 测试</h2>\n<div><pre><code>curl http://localhost:808/\n[{\"id\":1,\"title\":\"title1\",\"content\":\"content1\",\"tag\":\"tag1\",\"inTime\":\"2019-04-15T14:33:35.000+0000\"},\n{\"id\":2,\"title\":\"title2\",\"content\":\"content2\",\"tag\":\"tag2\",\"inTime\":\"2019-04-15T14:33:35.000+0000\"},\n{\"id\":3,\"title\":\"title3\",\"content\":\"content3\",\"tag\":\"tag3\",\"inTime\":\"2019-04-15T14:33:35.000+0000\"},\n{\"id\":4,\"title\":\"title4\",\"content\":\"content4\",\"tag\":\"tag4\",\"inTime\":\"2019-04-15T14:33:35.000+0000\"},\n{\"id\":5,\"title\":\"title4\",\"content\":\"content4\",\"tag\":\"tag4\",\"inTime\":\"2019-04-15T14:33:35.000+0000\"},\n{\"id\":6,\"title\":\"title4\",\"content\":\"content4\",\"tag\":\"tag4\",\"inTime\":\"2019-04-15T14:33:35.000+0000\"},\n{\"id\":7,\"title\":\"title4\",\"content\":\"content4\",\"tag\":\"tag4\",\"inTime\":\"2019-04-15T14:33:35.000+0000\"},\n{\"id\":8,\"title\":\"title4\",\"content\":\"content4\",\"tag\":\"tag4\",\"inTime\":\"2019-04-15T14:33:35.000+0000\"},\n{\"id\":9,\"title\":\"title4\",\"content\":\"content4\",\"tag\":\"tag4\",\"inTime\":\"2019-04-15T14:33:35.000+0000\"},\n{\"id\":10,\"title\":\"title4\",\"content\":\"content4\",\"tag\":\"tag4\",\"inTime\":\"2019-04-15T14:33:35.000+0000\"},\n{\"id\":11,\"title\":\"title4\",\"content\":\"content4\",\"tag\":\"tag4\",\"inTime\":\"2019-04-15T14:33:35.000+0000\"},\n{\"id\":12,\"title\":\"title4\",\"content\":\"content4\",\"tag\":\"tag4\",\"inTime\":\"2019-04-15T14:33:35.000+0000\"},\n{\"id\":13,\"title\":\"title4\",\"content\":\"content4\",\"tag\":\"tag4\",\"inTime\":\"2019-04-15T14:33:35.000+0000\"}]\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>上面的一些用法在mybatis-plus官网上都能找到，都是基本用法，但开发项目不可能都是简单的crud，下面来说说一些高级的用法</p>\n<h2 id=\"xml怎么配置\" tabindex=\"-1\"> xml怎么配置</h2>\n<p>mybatis-plus里内置的crud都给封装好了，都在<code>BaseMapper</code>接口里，包括CRUD，分页，那如果我要自定义查询，返回字段不是整个实体类的字段怎么办呢？</p>\n<p>可以通过定义xml文件来查询，方法如下</p>\n<p>在<code>TopicMapper.java</code>类的包下，创建一个 <code>TopicMapper.xml</code> 文件，填上下面内容</p>\n<div><pre><code><span>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?></span>\n<span><span>&lt;!</span><span>DOCTYPE</span> <span>mapper</span> <span>PUBLIC</span> <span>\"-//mybatis.org//DTD Mapper 3.0//EN\"</span> <span>\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span><span>></span></span>\n<span><span><span>&lt;</span>mapper</span> <span>namespace</span><span><span>=</span><span>\"</span>com.example.mybatisplusdemo.mapper.TopicMapper<span>\"</span></span><span>></span></span>\n\n  <span>&lt;!-- 映射表字段与实体类属性 --></span>\n  <span><span><span>&lt;</span>resultMap</span> <span>id</span><span><span>=</span><span>\"</span>BaseResultMap<span>\"</span></span> <span>type</span><span><span>=</span><span>\"</span>com.example.mybatisplusdemo.model.Topic<span>\"</span></span><span>></span></span>\n      <span><span><span>&lt;</span>id</span> <span>column</span><span><span>=</span><span>\"</span>id<span>\"</span></span> <span>jdbcType</span><span><span>=</span><span>\"</span>INTEGER<span>\"</span></span> <span>property</span><span><span>=</span><span>\"</span>id<span>\"</span></span><span>/></span></span>\n      <span><span><span>&lt;</span>id</span> <span>column</span><span><span>=</span><span>\"</span>title<span>\"</span></span> <span>jdbcType</span><span><span>=</span><span>\"</span>VARCHAR<span>\"</span></span> <span>property</span><span><span>=</span><span>\"</span>title<span>\"</span></span><span>/></span></span>\n      <span><span><span>&lt;</span>id</span> <span>column</span><span><span>=</span><span>\"</span>content<span>\"</span></span> <span>jdbcType</span><span><span>=</span><span>\"</span>VARCHAR<span>\"</span></span> <span>property</span><span><span>=</span><span>\"</span>content<span>\"</span></span><span>/></span></span>\n      <span><span><span>&lt;</span>id</span> <span>column</span><span><span>=</span><span>\"</span>tag<span>\"</span></span> <span>jdbcType</span><span><span>=</span><span>\"</span>VARCHAR<span>\"</span></span> <span>property</span><span><span>=</span><span>\"</span>tag<span>\"</span></span><span>/></span></span>\n      <span><span><span>&lt;</span>id</span> <span>column</span><span><span>=</span><span>\"</span>in_time<span>\"</span></span> <span>jdbcType</span><span><span>=</span><span>\"</span>DATE<span>\"</span></span> <span>property</span><span><span>=</span><span>\"</span>inTime<span>\"</span></span><span>/></span></span>\n  <span><span><span>&lt;/</span>resultMap</span><span>></span></span>\n\n  <span>&lt;!-- 通用查询结果列 --></span>\n  <span><span><span>&lt;</span>sql</span> <span>id</span><span><span>=</span><span>\"</span>Base_Column_List<span>\"</span></span><span>></span></span>\n      id, title, content, tag, in_time\n  <span><span><span>&lt;/</span>sql</span><span>></span></span>\n\n  <span>&lt;!-- 自定义查询方法 --></span>\n\n<span><span><span>&lt;/</span>mapper</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>在这个xml文件里定义一个方法</p>\n<div><pre><code><span><span><span>&lt;</span>select</span> <span>id</span><span><span>=</span><span>\"</span>selectByTitle<span>\"</span></span> <span>resultMap</span><span><span>=</span><span>\"</span>BaseResultMap<span>\"</span></span><span>></span></span>\n  select <span><span><span>&lt;</span>include</span> <span>refid</span><span><span>=</span><span>\"</span>Base_Column_List<span>\"</span></span><span>/></span></span> from topic where title = '${title}'\n<span><span><span>&lt;/</span>select</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>对应的，在 <code>TopicMapper.java</code> 里也要加上相应的接口</p>\n<div><pre><code><span>public</span> <span>interface</span> <span>TopicMapper</span> <span>extends</span> <span>BaseMapper</span><span><span>&lt;</span><span>Topic</span><span>></span></span> <span>{</span>\n  <span>Topic</span> <span>selectByTitle</span><span>(</span><span>@Param</span><span>(</span><span>\"title\"</span><span>)</span> <span>String</span> title<span>)</span><span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>在service里就可以调用了，controller里再调用service里的方法，然后测试</p>\n<div><pre><code><span>curl</span> http://localhost:8080/selectByTitle?title<span>=</span>titl1\n<span>{</span><span>\"id\"</span>:1,<span>\"title\"</span><span>:</span><span>\"title1\"</span>,<span>\"content\"</span><span>:</span><span>\"content1\"</span>,<span>\"tag\"</span><span>:</span><span>\"tag1\"</span>,<span>\"inTime\"</span><span>:</span><span>\"2019-04-15T05:00:00.000+0000\"</span><span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>可以看到上面xml里定义方法时用到的返回类型是定义好的映射 <code>resultMap=&quot;BaseResultMap&quot;</code>和通用查询结果列 <code>&lt;include refid=&quot;Base_Column_List&quot;/&gt;</code>，那如果我想返回一个map怎么办呢？</p>\n<p>将 <code>resultMap=&quot;BaseResultMap&quot;</code> 换成 <code>resultType=&quot;map&quot;</code>，查询语句里写上要查询的字段即可</p>\n<h2 id=\"自定义返回结果\" tabindex=\"-1\"> 自定义返回结果</h2>\n<p>上面最后提到返回一个map，这需求也很常见，比如一个表字段有10个，我只想要5个，那这时候再去定义通用查询结果列就不太好了，两个还好，多了xml就会很乱，所以map是最适合的方式，下面来定义一个查询看下效果</p>\n<div><pre><code><span>&lt;</span><span>select</span> id<span>=</span><span>\"selectTitleList\"</span> resultType<span>=</span><span>\"map\"</span><span>></span>\n  <span>select</span> id<span>,</span> title<span>,</span> in_time <span>from</span> topic\n<span>&lt;</span><span>/</span><span>select</span><span>></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>上面定义了一个方法，返回用的是<code>map</code>，查询字段有 <code>id, title</code>，<code>BaseMapper.java</code> 里接口定义如下</p>\n<div><pre><code><span>public</span> <span>interface</span> <span>TopicMapper</span> <span>extends</span> <span>BaseMapper</span><span><span>&lt;</span><span>Topic</span><span>></span></span> <span>{</span>\n  <span>List</span><span><span>&lt;</span><span>Map</span><span>></span></span> <span>selectTitleList</span><span>(</span><span>)</span><span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>写好service,controller，测试</p>\n<div><pre><code>curl http://localhost:8080/selectTitleList\n[{\"in_time\":\"2019-04-15T14:33:35.000+0000\",\"id\":1,\"title\":\"title1\"},\n{\"in_time\":\"2019-04-15T14:33:35.000+0000\",\"id\":2,\"title\":\"title2\"},\n{\"in_time\":\"2019-04-15T14:33:35.000+0000\",\"id\":3,\"title\":\"title3\"},\n{\"in_time\":\"2019-04-15T14:33:35.000+0000\",\"id\":4,\"title\":\"title4\"},\n{\"in_time\":\"2019-04-15T14:33:35.000+0000\",\"id\":5,\"title\":\"title4\"},\n{\"in_time\":\"2019-04-15T14:33:35.000+0000\",\"id\":6,\"title\":\"title4\"},\n{\"in_time\":\"2019-04-15T14:33:35.000+0000\",\"id\":7,\"title\":\"title4\"},\n{\"in_time\":\"2019-04-15T14:33:35.000+0000\",\"id\":8,\"title\":\"title4\"},\n{\"in_time\":\"2019-04-15T14:33:35.000+0000\",\"id\":9,\"title\":\"title4\"},\n{\"in_time\":\"2019-04-15T14:33:35.000+0000\",\"id\":10,\"title\":\"title4\"},\n{\"in_time\":\"2019-04-15T14:33:35.000+0000\",\"id\":11,\"title\":\"title4\"},\n{\"in_time\":\"2019-04-15T14:33:35.000+0000\",\"id\":12,\"title\":\"title4\"},\n{\"in_time\":\"2019-04-15T14:33:35.000+0000\",\"id\":13,\"title\":\"title4\"}]\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"map转驼峰\" tabindex=\"-1\"> map转驼峰</h2>\n<p>上面查询结果可以看到，返回的确实是map，没有问题，但java类中的驼峰没有转回来呀，这样就不友好了，比如前端定义好了返回结果类，本来查询列表好好的，但换成详细查询的时候，字段收不到了，找了半天原来是字段变了，又是一场撕逼</p>\n<p>mybatis我不知道有没有办法解决，但mybatis-plus人家很用心呀，一个配置就解决了这个问题</p>\n<p>创建 <code>MybatisPlusConfig.java</code> 配置类，添加上下面配置即可实现<code>map转驼峰</code>和分页功能，分页功能下面再介绍，这里就先配置上</p>\n<div><pre><code><span>@Configuration</span>\n<span>@MapperScan</span><span>(</span><span>\"com.example.mybatisplusdemo.mapper\"</span><span>)</span>\n<span>public</span> <span>class</span> <span>MybatisPlusConfig</span> <span>{</span>\n\n  <span>@Bean</span><span>(</span><span>\"mybatisSqlSession\"</span><span>)</span>\n  <span>public</span> <span>SqlSessionFactory</span> <span>sqlSessionFactory</span><span>(</span><span>@Qualifier</span><span>(</span><span>\"dataSource\"</span><span>)</span> <span>DataSource</span> dataSource<span>)</span> <span>throws</span> <span>Exception</span> <span>{</span>\n    <span>MybatisSqlSessionFactoryBean</span> sqlSessionFactory <span>=</span> <span>new</span> <span>MybatisSqlSessionFactoryBean</span><span>(</span><span>)</span><span>;</span>\n    <span>MybatisConfiguration</span> configuration <span>=</span> <span>new</span> <span>MybatisConfiguration</span><span>(</span><span>)</span><span>;</span>\n    configuration<span>.</span><span>setDefaultScriptingLanguage</span><span>(</span><span>MybatisXMLLanguageDriver</span><span>.</span><span>class</span><span>)</span><span>;</span>\n    configuration<span>.</span><span>setJdbcTypeForNull</span><span>(</span><span>JdbcType</span><span>.</span>NULL<span>)</span><span>;</span>\n    <span>//*注册Map 下划线转驼峰*</span>\n   configuration<span>.</span><span>setObjectWrapperFactory</span><span>(</span><span>new</span> <span>MybatisMapWrapperFactory</span><span>(</span><span>)</span><span>)</span><span>;</span>\n\n    <span>// 添加数据源</span>\n    sqlSessionFactory<span>.</span><span>setDataSource</span><span>(</span>dataSource<span>)</span><span>;</span>\n\n    sqlSessionFactory<span>.</span><span>setConfiguration</span><span>(</span>configuration<span>)</span><span>;</span>\n\n    <span>// 添加分页插件，这里有个坑</span>\n    <span>PaginationInterceptor</span> paginationInterceptor <span>=</span> <span>new</span> <span>PaginationInterceptor</span><span>(</span><span>)</span><span>;</span>\n    sqlSessionFactory<span>.</span><span>setPlugins</span><span>(</span><span>new</span> <span>Interceptor</span><span>[</span><span>]</span><span>{</span>paginationInterceptor<span>}</span><span>)</span><span>;</span>\n\n    <span>return</span> sqlSessionFactory<span>.</span><span>getObject</span><span>(</span><span>)</span><span>;</span>\n  <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>加上这个配置类后，Mapper扫描注解顺便也从启动类上移到这个类上配置，然后再次启动项目，测试</p>\n<div><pre><code>curl http://localhost:8080/selectTitleList\n[{\"inTime\":\"2019-04-15T14:33:35.000+0000\",\"id\":1,\"title\":\"title1\"},\n{\"inTime\":\"2019-04-15T14:33:35.000+0000\",\"id\":2,\"title\":\"title2\"},\n{\"inTime\":\"2019-04-15T14:33:35.000+0000\",\"id\":3,\"title\":\"title3\"},\n{\"inTime\":\"2019-04-15T14:33:35.000+0000\",\"id\":4,\"title\":\"title4\"},\n{\"inTime\":\"2019-04-15T14:33:35.000+0000\",\"id\":5,\"title\":\"title4\"},\n{\"inTime\":\"2019-04-15T14:33:35.000+0000\",\"id\":6,\"title\":\"title4\"},\n{\"inTime\":\"2019-04-15T14:33:35.000+0000\",\"id\":7,\"title\":\"title4\"},\n{\"inTime\":\"2019-04-15T14:33:35.000+0000\",\"id\":8,\"title\":\"title4\"},\n{\"inTime\":\"2019-04-15T14:33:35.000+0000\",\"id\":9,\"title\":\"title4\"},\n{\"inTime\":\"2019-04-15T14:33:35.000+0000\",\"id\":10,\"title\":\"title4\"},\n{\"inTime\":\"2019-04-15T14:33:35.000+0000\",\"id\":11,\"title\":\"title4\"},\n{\"inTime\":\"2019-04-15T14:33:35.000+0000\",\"id\":12,\"title\":\"title4\"},\n{\"inTime\":\"2019-04-15T14:33:35.000+0000\",\"id\":13,\"title\":\"title4\"}]\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>再看看结果，<code>in_time</code>已经从下划线转成驼峰 <code>inTime</code> 命名了，可喜可贺可喜可贺</p>\n<h2 id=\"basemapper分页\" tabindex=\"-1\"> BaseMapper分页</h2>\n<p>分页分两种，一种是BaseMapper接口内置的分页接口，直接调用即可，使用如下</p>\n<p>在service里直接调用方法</p>\n<div><pre><code><span>public</span> <span>IPage</span><span><span>&lt;</span><span>Topic</span><span>></span></span> <span>selectWithPage</span><span>(</span><span>Integer</span> pageNo<span>,</span> <span>Integer</span> pageSize<span>)</span> <span>{</span>\n  <span>QueryWrapper</span><span><span>&lt;</span><span>Topic</span><span>></span></span> wrapper <span>=</span> <span>new</span> <span>QueryWrapper</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n  <span>IPage</span><span><span>&lt;</span><span>Topic</span><span>></span></span> iPage <span>=</span> <span>new</span> <span>Page</span><span><span>&lt;</span><span>></span></span><span>(</span>pageNo<span>,</span> pageSize<span>)</span><span>;</span>\n  <span>return</span> topicMapper<span>.</span><span>selectPage</span><span>(</span>iPage<span>,</span> wrapper<span>)</span><span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>测试 <code>curl http://localhost:8080/selectWithPage?pageNo=1&amp;pageSize=5</code></p>\n<div><pre><code>{\"records\":[{\"id\":1,\"title\":\"title1\",\"content\":\"content1\",\"tag\":\"tag1\",\"inTime\":\"2019-04-15T14:33:35.000+0000\"},\n{\"id\":2,\"title\":\"title2\",\"content\":\"content2\",\"tag\":\"tag2\",\"inTime\":\"2019-04-15T14:33:35.000+0000\"},\n{\"id\":3,\"title\":\"title3\",\"content\":\"content3\",\"tag\":\"tag3\",\"inTime\":\"2019-04-15T14:33:35.000+0000\"},\n{\"id\":4,\"title\":\"title4\",\"content\":\"content4\",\"tag\":\"tag4\",\"inTime\":\"2019-04-15T14:33:35.000+0000\"},\n{\"id\":5,\"title\":\"title4\",\"content\":\"content4\",\"tag\":\"tag4\",\"inTime\":\"2019-04-15T14:33:35.000+0000\"}],\n\"total\":13,\"size\":5,\"current\":1,\"searchCount\":true,\"pages\":3}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"自定义查询分页\" tabindex=\"-1\"> 自定义查询分页</h2>\n<p>上面说到了使用自定义查询时可以指定查询字段，然后返回map即可，那分页怎么办？</p>\n<p>mybatis-plus里有一个 <code>IPage</code> 接口，通过这个接口来封装分页信息，用法如下</p>\n<p>在xml里定义查询方法</p>\n<div><pre><code><span><span><span>&lt;</span>select</span> <span>id</span><span><span>=</span><span>\"</span>selectMapWithPage<span>\"</span></span> <span>resultType</span><span><span>=</span><span>\"</span>map<span>\"</span></span><span>></span></span>\n  select id, title, in_time from topic\n<span><span><span>&lt;/</span>select</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>在 <code>BaseMapper.java</code> 里定义接口</p>\n<div><pre><code><span>public</span> <span>interface</span> <span>TopicMapper</span> <span>extends</span> <span>BaseMapper</span><span><span>&lt;</span><span>Topic</span><span>></span></span> <span>{</span>\n  <span>IPage</span><span><span>&lt;</span><span>Map</span><span>></span></span> <span>selectMapWithPage</span><span>(</span><span>IPage</span> iPage<span>)</span><span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p><code>TopicService.java</code> 里封装 IPage 对象然后调用接口</p>\n<div><pre><code><span>public</span> <span>IPage</span><span><span>&lt;</span><span>Map</span><span>></span></span> <span>selectMapWithPage</span><span>(</span><span>Integer</span> pageNo<span>,</span> <span>Integer</span> pageSize<span>)</span> <span>{</span>\n  <span>IPage</span><span><span>&lt;</span><span>Map</span><span>></span></span> iPage <span>=</span> <span>new</span> <span>Page</span><span><span>&lt;</span><span>></span></span><span>(</span>pageNo<span>,</span> pageSize<span>)</span><span>;</span>\n  iPage <span>=</span> topicMapper<span>.</span><span>selectMapWithPage</span><span>(</span>iPage<span>)</span><span>;</span>\n  <span>return</span> iPage<span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>测试 <code>curl http://localhost:8080/selectMapWithPage?pageNo=1&amp;pageSize=5</code></p>\n<div><pre><code>{\"records\":[{\"inTime\":\"2019-04-15T14:33:35.000+0000\",\"id\":1,\"title\":\"title1\"},\n{\"inTime\":\"2019-04-15T14:33:35.000+0000\",\"id\":2,\"title\":\"title2\"},\n{\"inTime\":\"2019-04-15T14:33:35.000+0000\",\"id\":3,\"title\":\"title3\"},\n{\"inTime\":\"2019-04-15T14:33:35.000+0000\",\"id\":4,\"title\":\"title4\"},\n{\"inTime\":\"2019-04-15T14:33:35.000+0000\",\"id\":5,\"title\":\"title4\"}],\n\"total\":13,\"size\":5,\"current\":1,\"searchCount\":true,\"pages\":3}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"注意\" tabindex=\"-1\"> 注意</h2>\n<ol>\n<li>在xml文件里写的sql语句不要在最后带上<code>;</code>，因为有些分页查询会自动拼上 <code>limit 0, 10;</code> 这样的sql语句，如果你在定义sql的时候已经加上了 <code>;</code>，调用这个查询的时候就会报错了</li>\n<li>往xml文件里的查询方法里传参数要带上 <code>@Param(&quot;&quot;)</code> 注解，这样mybatis才认，否则会报错</li>\n<li>分页中传的pageNo可以从0或者1开始，查询出的结果是一样的，这一点不像jpa里必须是从0开始才是第一页</li>\n</ol>\n<h2 id=\"异常\" tabindex=\"-1\"> 异常</h2>\n<p>2019-06-21更新</p>\n<p>今天创建了个项目，使用了 mybatis-plus(v3.1.1) 查询数据的时候出了个异常 <code>Error evaluating expression 'ew.sqlSegment != null and ew.sqlSegment != '' and ew.nonEmptyOfWhere</code></p>\n<p>原因好像是java的反射出的问题，devtools 也是利用java的反射来实现的热加载，mybatis-plus 里的 lambda 表达式也是用反射来找到属性的值进行sql拼接的，估计是这俩货冲突了，不过挺好奇，项目里还用到了 lombok，就没问题，这。。</p>\n<p>解决方法: 把<code>spring-boot-devtools</code>这个依赖去掉就可以了</p>\n",
      "date_published": "2022-07-02T00:00:00.000Z",
      "date_modified": "2022-06-20T09:35:36.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "SpringBoot整合Mybatis-plus及用法",
      "url": "https://blog.ciberviler.top/dev/SpringBoot%E6%95%B4%E5%90%88Mybatis-plus%E5%8F%8A%E7%94%A8%E6%B3%95.html",
      "id": "https://blog.ciberviler.top/dev/SpringBoot%E6%95%B4%E5%90%88Mybatis-plus%E5%8F%8A%E7%94%A8%E6%B3%95.html",
      "content_html": "<h1 id=\"springboot整合mybatis-plus及用法\" tabindex=\"-1\"> SpringBoot整合Mybatis-plus及用法</h1>\n<h2 id=\"一、mybatis-plus简介\" tabindex=\"-1\"> 一、mybatis-plus简介：</h2>\n<p>Mybatis-Plus（简称MP）是一个 Mybatis 的增强工具，在 Mybatis 的基础上只做增强不做改变，为简化开发、提高效率而生。这是官方给的定义，关于mybatis-plus的更多介绍及特性，可以参考mybatis-plus官网。那么它是怎么增强的呢？其实就是它已经封装好了一些crud方法，我们不需要再写xml了，直接调用这些方法就行，就类似于JPA。并且3.X系列支持lambda语法,让我在写条件构造的时候少了很多的&quot;魔法值&quot;,从代码结构上更简洁了.</p>\n<h2 id=\"二、springboot整合mybatis-plus案例\" tabindex=\"-1\"> 二、springboot整合mybatis-plus案例</h2>\n<p>pom.xml配置</p>\n<div><pre><code><span><span><span>&lt;</span>dependencies</span><span>></span></span>\n    <span><span><span>&lt;</span>dependency</span><span>></span></span>\n      <span><span><span>&lt;</span>groupId</span><span>></span></span>org.springframework.boot<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n      <span><span><span>&lt;</span>artifactId</span><span>></span></span>spring-boot-starter<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n    <span><span><span>&lt;/</span>dependency</span><span>></span></span>\n    <span>&lt;!--springboot程序测试依赖，如果是自动创建项目默认添加--></span>\n    <span><span><span>&lt;</span>dependency</span><span>></span></span>\n      <span><span><span>&lt;</span>groupId</span><span>></span></span>org.springframework.boot<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n      <span><span><span>&lt;</span>artifactId</span><span>></span></span>spring-boot-starter-test<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n      <span><span><span>&lt;</span>scope</span><span>></span></span>test<span><span><span>&lt;/</span>scope</span><span>></span></span>\n    <span><span><span>&lt;/</span>dependency</span><span>></span></span>\n    <span><span><span>&lt;</span>dependency</span><span>></span></span>\n      <span><span><span>&lt;</span>groupId</span><span>></span></span>org.projectlombok<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n      <span><span><span>&lt;</span>artifactId</span><span>></span></span>lombok<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n      <span><span><span>&lt;</span>version</span><span>></span></span>1.16.10<span><span><span>&lt;/</span>version</span><span>></span></span>\n      <span><span><span>&lt;</span>scope</span><span>></span></span>provided<span><span><span>&lt;/</span>scope</span><span>></span></span>\n    <span><span><span>&lt;/</span>dependency</span><span>></span></span>\n    <span>&lt;!-- 包含spirng Mvc ,tomcat的包包含requestMapping restController 等注解 --></span>\n    <span><span><span>&lt;</span>dependency</span><span>></span></span>\n      <span><span><span>&lt;</span>groupId</span><span>></span></span>org.springframework.boot<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n      <span><span><span>&lt;</span>artifactId</span><span>></span></span>spring-boot-starter-web<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n    <span><span><span>&lt;/</span>dependency</span><span>></span></span>\n    <span><span><span>&lt;</span>dependency</span><span>></span></span>\n      <span><span><span>&lt;</span>groupId</span><span>></span></span>com.alibaba<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n      <span><span><span>&lt;</span>artifactId</span><span>></span></span>druid-spring-boot-starter<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n      <span><span><span>&lt;</span>version</span><span>></span></span>1.1.10<span><span><span>&lt;/</span>version</span><span>></span></span>\n    <span><span><span>&lt;/</span>dependency</span><span>></span></span>\n    <span><span><span>&lt;</span>dependency</span><span>></span></span>\n      <span><span><span>&lt;</span>groupId</span><span>></span></span>mysql<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n      <span><span><span>&lt;</span>artifactId</span><span>></span></span>mysql-connector-java<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n    <span><span><span>&lt;/</span>dependency</span><span>></span></span>\n    <span>&lt;!-- druid依赖 --></span>\n    <span><span><span>&lt;</span>dependency</span><span>></span></span>\n      <span><span><span>&lt;</span>groupId</span><span>></span></span>com.alibaba<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n      <span><span><span>&lt;</span>artifactId</span><span>></span></span>druid<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n      <span><span><span>&lt;</span>version</span><span>></span></span>1.1.0<span><span><span>&lt;/</span>version</span><span>></span></span>\n    <span><span><span>&lt;/</span>dependency</span><span>></span></span>\n    <span>&lt;!-- mybatisPlus 核心库 --></span>\n    <span><span><span>&lt;</span>dependency</span><span>></span></span>\n      <span><span><span>&lt;</span>groupId</span><span>></span></span>com.baomidou<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n      <span><span><span>&lt;</span>artifactId</span><span>></span></span>mybatis-plus-boot-starter<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n      <span><span><span>&lt;</span>version</span><span>></span></span>3.1.0<span><span><span>&lt;/</span>version</span><span>></span></span>\n    <span><span><span>&lt;/</span>dependency</span><span>></span></span>\n  <span><span><span>&lt;/</span>dependencies</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>application.yml配置</p>\n<div><pre><code><span>server</span><span>:</span>\n  <span>port</span><span>:</span> <span>10100</span>   <span>#  配置启动端口号</span>\n \n<span>mybatis</span><span>:</span>\n  <span>config-location</span><span>:</span> classpath<span>:</span>mybatis.cfg.xml    <span>#  mybatis主配置文件所在路径</span>\n  <span>type-aliases-package</span><span>:</span> com.demo.drools.entity  <span>#  定义所有操作类的别名所在包</span>\n  <span>mapper-locations</span><span>:</span>                                     <span>#  所有的mapper映射文件</span>\n    <span>-</span> classpath<span>:</span>mapper/<span>*.xml</span>\n \n \n<span>spring</span><span>:</span> <span>#springboot的配置</span>\n  <span>datasource</span><span>:</span> <span>#定义数据源</span>\n    <span>#127.0.0.1为本机测试的ip，3306是mysql的端口号。serverTimezone是定义时区，照抄就好，mysql高版本需要定义这些东西</span>\n    <span>#useSSL也是某些高版本mysql需要问有没有用SSL连接</span>\n    <span>url</span><span>:</span> jdbc<span>:</span>mysql<span>:</span>//127.0.0.1<span>:</span>3306/test<span>?</span>serverTimezone=GMT%2B8<span>&amp;useSSL=FALSE</span>\n    <span>username</span><span>:</span> root  <span>#数据库用户名，root为管理员</span>\n    <span>password</span><span>:</span> <span>123456</span> <span>#该数据库用户的密码</span>\n    <span># 使用druid数据源</span>\n    <span>type</span><span>:</span> com.alibaba.druid.pool.DruidDataSource\n \n<span># mybatis-plus相关配置</span>\n<span>mybatis-plus</span><span>:</span>\n  <span># xml扫描，多个目录用逗号或者分号分隔（告诉 Mapper 所对应的 XML 文件位置）</span>\n  <span>mapper-locations</span><span>:</span> classpath<span>:</span>mapper/<span>*.xml</span>\n  <span># 以下配置均有默认值,可以不设置</span>\n  <span>global-config</span><span>:</span>\n    <span>db-config</span><span>:</span>\n      <span>#主键类型 AUTO:\"数据库ID自增\" INPUT:\"用户输入ID\",ID_WORKER:\"全局唯一ID (数字类型唯一ID)\", UUID:\"全局唯一ID UUID\";</span>\n      <span>id-type</span><span>:</span> auto\n      <span>#字段策略 IGNORED:\"忽略判断\"  NOT_NULL:\"非 NULL 判断\")  NOT_EMPTY:\"非空判断\"</span>\n      <span>field-strategy</span><span>:</span> NOT_EMPTY\n      <span>#数据库类型</span>\n      <span>db-type</span><span>:</span> MYSQL\n  <span>configuration</span><span>:</span>\n    <span># 是否开启自动驼峰命名规则映射:从数据库列名到Java属性驼峰命名的类似映射</span>\n    <span>map-underscore-to-camel-case</span><span>:</span> <span>true</span>\n    <span># 如果查询结果中包含空值的列，则 MyBatis 在映射的时候，不会映射这个字段</span>\n    <span>call-setters-on-nulls</span><span>:</span> <span>true</span>\n    <span># 这个配置会将执行的sql打印出来，在开发或测试的时候可以用</span>\n    <span>log-impl</span><span>:</span> org.apache.ibatis.logging.stdout.StdOutImpl\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>用户信息实体</p>\n<div><pre><code> \n<span>package</span> <span>com<span>.</span>demo<span>.</span>drools<span>.</span>entity</span><span>;</span>\n \n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>annotation<span>.</span></span><span>IdType</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>annotation<span>.</span></span><span>TableId</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>annotation<span>.</span></span><span>TableName</span></span><span>;</span>\n<span>import</span> <span><span>lombok<span>.</span></span><span>Data</span></span><span>;</span>\n \n<span>/**\n * TODO your comment\n *\n * <span>@author</span> xlc\n * <span>@date</span> 2022/6/20 19:14\n */</span>\n<span>@Data</span>\n<span>@TableName</span><span>(</span><span>\"user_info\"</span><span>)</span><span>//@TableName中的值对应着表名</span>\n<span>public</span> <span>class</span> <span>UserInfoEntity</span> <span>{</span>\n    <span>/**\n     * 主键\n     * @TableId中可以决定主键的类型,不写会采取默认值,默认值可以在yml中配置\n     * AUTO: 数据库ID自增\n     * INPUT: 用户输入ID\n     * ID_WORKER: 全局唯一ID，Long类型的主键\n     * ID_WORKER_STR: 字符串全局唯一ID\n     * UUID: 全局唯一ID，UUID类型的主键\n     * NONE: 该类型为未设置主键类型\n     */</span>\n    <span>@TableId</span><span>(</span>type <span>=</span> <span>IdType</span><span>.</span>AUTO<span>)</span>\n    <span>private</span> <span>Long</span> id<span>;</span>\n    <span>/**\n     * 姓名\n     */</span>\n    <span>private</span> <span>String</span> name<span>;</span>\n    <span>/**\n     * 年龄\n     */</span>\n    <span>private</span> <span>Integer</span> age<span>;</span>\n    <span>/**\n     * 技能\n     */</span>\n    <span>private</span> <span>String</span> skill<span>;</span>\n    <span>/**\n     * 评价\n     */</span>\n    <span>private</span> <span>String</span> evaluate<span>;</span>\n    <span>/**\n     * 分数\n     */</span>\n    <span>private</span> <span>Long</span> fraction<span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>config类-1(推荐)</p>\n<div><pre><code><span>package</span> <span>com<span>.</span>xlc<span>.</span>springmybatisdemo<span>.</span>config</span><span>;</span>\n\n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>annotation<span>.</span></span><span>DbType</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>extension<span>.</span>plugins<span>.</span></span><span>MybatisPlusInterceptor</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>extension<span>.</span>plugins<span>.</span>inner<span>.</span></span><span>BlockAttackInnerInterceptor</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>extension<span>.</span>plugins<span>.</span>inner<span>.</span></span><span>OptimisticLockerInnerInterceptor</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>extension<span>.</span>plugins<span>.</span>inner<span>.</span></span><span>PaginationInnerInterceptor</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>context<span>.</span>annotation<span>.</span></span><span>Bean</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>context<span>.</span>annotation<span>.</span></span><span>Configuration</span></span><span>;</span>\n\n<span>/**\n * <span>@author</span> xlc\n * <span>@createTime</span> 2022/6/20 14:39\n * <span>@description</span>\n * @Version 1.0\n */</span>\n<span>@Configuration</span>\n<span>public</span> <span>class</span> <span>MybatisPlusConfig</span> <span>{</span>\n\n    <span>/**\n     * 新的分页插件,一缓和二缓遵循mybatis的规则,需要设置 MybatisConfiguration#useDeprecatedExecutor = false 避免缓存出现问题(该属性会在旧插件移除后一同移除)\n     */</span>\n    <span>@Bean</span>\n    <span>public</span> <span>MybatisPlusInterceptor</span> <span>mybatisPlusInterceptor</span><span>(</span><span>)</span> <span>{</span>\n        <span>MybatisPlusInterceptor</span> interceptor <span>=</span> <span>new</span> <span>MybatisPlusInterceptor</span><span>(</span><span>)</span><span>;</span>\n        <span>// 分页插件</span>\n        interceptor<span>.</span><span>addInnerInterceptor</span><span>(</span><span>new</span> <span>PaginationInnerInterceptor</span><span>(</span><span>DbType</span><span>.</span>MYSQL<span>)</span><span>)</span><span>;</span>\n        <span>// 乐观锁插件</span>\n        interceptor<span>.</span><span>addInnerInterceptor</span><span>(</span><span>new</span> <span>OptimisticLockerInnerInterceptor</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>// 防全表更新与删除插件</span>\n        interceptor<span>.</span><span>addInnerInterceptor</span><span>(</span><span>new</span> <span>BlockAttackInnerInterceptor</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>return</span> interceptor<span>;</span>\n    <span>}</span>\n\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>config类-2</p>\n<div><pre><code> \n<span>package</span> <span>com<span>.</span>demo<span>.</span>drools<span>.</span>config</span><span>;</span>\n \n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>extension<span>.</span>plugins<span>.</span></span><span>PaginationInterceptor</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>extension<span>.</span>plugins<span>.</span></span><span>PerformanceInterceptor</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>context<span>.</span>annotation<span>.</span></span><span>Bean</span></span><span>;</span>\n \n<span>/**\n * TODO your comment\n *\n * <span>@author</span> xlc\n * <span>@date</span> 2022/6/20 19:14\n */</span>\n<span>public</span> <span>class</span> <span>MybatisPlusConfig</span> <span>{</span>\n    <span>/**\n     * mybatis-plus SQL执行效率插件【生产环境可以关闭】\n     */</span>\n    <span>@Bean</span>\n    <span>public</span> <span>PerformanceInterceptor</span> <span>performanceInterceptor</span><span>(</span><span>)</span> <span>{</span>\n        <span>return</span> <span>new</span> <span>PerformanceInterceptor</span><span>(</span><span>)</span><span>;</span>\n    <span>}</span>\n    <span>/**\n     * 分页插件\n     */</span>\n    <span>@Bean</span>\n    <span>public</span> <span>PaginationInterceptor</span> <span>paginationInterceptor</span><span>(</span><span>)</span> <span>{</span>\n        <span>return</span> <span>new</span> <span>PaginationInterceptor</span><span>(</span><span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>spring boot启动类</p>\n<div><pre><code><span>package</span> <span>com<span>.</span>demo<span>.</span>drools</span><span>;</span>\n \n<span>import</span> <span><span>org<span>.</span>mybatis<span>.</span>spring<span>.</span>annotation<span>.</span></span><span>MapperScan</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>boot<span>.</span></span><span>SpringApplication</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>boot<span>.</span>autoconfigure<span>.</span></span><span>SpringBootApplication</span></span><span>;</span>\n \n<span>/**\n * <span>@author</span> 于嘉琪\n */</span>\n<span>@SpringBootApplication</span>\n<span>//@MapperScan和dao层添加@Mapper注解意思一样</span>\n<span>@MapperScan</span><span>(</span>basePackages <span>=</span> <span>\"com.demo.drools.dao\"</span><span>)</span>\n<span>public</span> <span>class</span> <span>DroolsApplication</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>{</span>\n        <span>SpringApplication</span><span>.</span><span>run</span><span>(</span><span>DroolsApplication</span><span>.</span><span>class</span><span>,</span> args<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>dao层</p>\n<div><pre><code> \n<span>package</span> <span>com<span>.</span>demo<span>.</span>drools<span>.</span>dao</span><span>;</span>\n \n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>core<span>.</span>mapper<span>.</span></span><span>BaseMapper</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>core<span>.</span>metadata<span>.</span></span><span>IPage</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>drools<span>.</span>entity<span>.</span></span><span>UserInfoEntity</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>apache<span>.</span>ibatis<span>.</span>annotations<span>.</span></span><span>Mapper</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>apache<span>.</span>ibatis<span>.</span>annotations<span>.</span></span><span>Param</span></span><span>;</span>\n \n<span>/**\n * 用户信息DAO\n *\n * <span>@author</span> xlc\n * <span>@date</span> 2022/6/20 19:16\n */</span>\n<span>@Mapper</span>\n<span>public</span> <span>interface</span> <span>UserInfoDao</span> <span>extends</span> <span>BaseMapper</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> <span>{</span>\n   \n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>service层</p>\n<div><pre><code> \n<span>package</span> <span>com<span>.</span>demo<span>.</span>drools<span>.</span>service</span><span>;</span>\n \n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>core<span>.</span>metadata<span>.</span></span><span>IPage</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>extension<span>.</span>service<span>.</span></span><span>IService</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>drools<span>.</span>entity<span>.</span></span><span>UserInfoEntity</span></span><span>;</span>\n \n<span>/**\n * TODO your comment\n *\n * <span>@author</span> xlc\n * <span>@date</span> 2022/6/20 19:17\n */</span>\n<span>public</span> <span>interface</span> <span>UserInfoService</span> <span>extends</span> <span>IService</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> <span>{</span>\n    \n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>serviceImpl实现类层</p>\n<div><pre><code> \n<span>package</span> <span>com<span>.</span>demo<span>.</span>drools<span>.</span>service<span>.</span>impl</span><span>;</span>\n \n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>core<span>.</span>metadata<span>.</span></span><span>IPage</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>extension<span>.</span>service<span>.</span>impl<span>.</span></span><span>ServiceImpl</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>drools<span>.</span>dao<span>.</span></span><span>UserInfoDao</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>drools<span>.</span>entity<span>.</span></span><span>UserInfoEntity</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>drools<span>.</span>service<span>.</span></span><span>UserInfoService</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>stereotype<span>.</span></span><span>Service</span></span><span>;</span>\n \n<span>import</span> <span><span>javax<span>.</span>annotation<span>.</span></span><span>Resource</span></span><span>;</span>\n \n<span>/**\n * TODO your comment\n *\n * <span>@author</span> xlc\n * <span>@date</span> 2022/6/20 19:18\n */</span>\n<span>@Service</span>\n<span>public</span> <span>class</span> <span>UserInfoSerivceImpl</span> <span>extends</span> <span>ServiceImpl</span><span><span>&lt;</span><span>UserInfoDao</span><span>,</span> <span>UserInfoEntity</span><span>></span></span> <span>implements</span> <span>UserInfoService</span> <span>{</span>\n    \n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>controller控制层</p>\n<div><pre><code> \n<span>package</span> <span>com<span>.</span>demo<span>.</span>drools<span>.</span>controller</span><span>;</span>\n \n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>core<span>.</span>metadata<span>.</span></span><span>IPage</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>extension<span>.</span>plugins<span>.</span>pagination<span>.</span></span><span>Page</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>drools<span>.</span>entity<span>.</span></span><span>UserInfoEntity</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>drools<span>.</span>service<span>.</span></span><span>UserInfoService</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>beans<span>.</span>factory<span>.</span>annotation<span>.</span></span><span>Autowired</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>bind<span>.</span>annotation<span>.</span></span><span>RequestMapping</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>bind<span>.</span>annotation<span>.</span></span><span>RestController</span></span><span>;</span>\n \n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>ArrayList</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Collection</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>HashMap</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>List</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Map</span></span><span>;</span>\n \n<span>/**\n * TODO your comment\n *\n * <span>@author</span> xlc\n * <span>@date</span> 2022/6/20 19:20\n */</span>\n<span>@RestController</span>\n<span>@RequestMapping</span><span>(</span><span>\"/userInfo\"</span><span>)</span>\n<span>public</span> <span>class</span> <span>UserInfoController</span> <span>{</span>\n    <span>@Autowired</span>\n    <span>private</span> <span>UserInfoService</span> userInfoService<span>;</span>\n    \n    <span>/**\n     * 根据ID获取用户信息\n     * <span>@author</span> xlc\n     * @CreateTime 2022/20 16:34\n     * @Param  userId  用户ID\n     * @Return UserInfoEntity 用户实体\n     */</span>\n    <span>@RequestMapping</span><span>(</span><span>\"/getInfo\"</span><span>)</span>\n    <span>public</span> <span>UserInfoEntity</span> <span>getInfo</span><span>(</span><span>String</span> userId<span>)</span><span>{</span>\n        <span>UserInfoEntity</span> userInfoEntity <span>=</span> userInfoService<span>.</span><span>getById</span><span>(</span>userId<span>)</span><span>;</span>\n        <span>return</span> userInfoEntity<span>;</span>\n    <span>}</span>\n    <span>/**\n     * 查询全部信息\n     * <span>@author</span> xlc\n     * @CreateTime 2022/20 16:35\n     * @Param  userId  用户ID\n     * @Return List<span><span><span>&lt;</span>UserInfoEntity</span><span>></span></span> 用户实体集合\n     */</span>\n    <span>@RequestMapping</span><span>(</span><span>\"/getList\"</span><span>)</span>\n    <span>public</span> <span>List</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> <span>getList</span><span>(</span><span>)</span><span>{</span>\n        <span>List</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> userInfoEntityList <span>=</span> userInfoService<span>.</span><span>list</span><span>(</span><span>)</span><span>;</span>\n        <span>return</span> userInfoEntityList<span>;</span>\n    <span>}</span>\n    <span>/**\n     * 分页查询全部数据\n     * <span>@author</span> xlc\n     * @CreateTime 2022/20 16:37\n     * @Return IPage<span><span><span>&lt;</span>UserInfoEntity</span><span>></span></span> 分页数据\n     */</span>\n    <span>@RequestMapping</span><span>(</span><span>\"/getInfoListPage\"</span><span>)</span>\n    <span>public</span> <span>IPage</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> <span>getInfoListPage</span><span>(</span><span>)</span><span>{</span>\n        <span>//需要在Config配置类中配置分页插件</span>\n        <span>IPage</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> page <span>=</span> <span>new</span> <span>Page</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        page<span>.</span><span>setCurrent</span><span>(</span><span>5</span><span>)</span><span>;</span> <span>//当前页</span>\n        page<span>.</span><span>setSize</span><span>(</span><span>1</span><span>)</span><span>;</span>    <span>//每页条数</span>\n        page <span>=</span> userInfoService<span>.</span><span>page</span><span>(</span>page<span>)</span><span>;</span>\n        <span>return</span> page<span>;</span>\n    <span>}</span>\n    <span>/**\n     * 根据指定字段查询用户信息集合\n     * <span>@author</span> xlc\n     * @CreateTime 2022/20 16:39\n     * @Return Collection<span><span><span>&lt;</span>UserInfoEntity</span><span>></span></span> 用户实体集合\n     */</span>\n    <span>@RequestMapping</span><span>(</span><span>\"/getListMap\"</span><span>)</span>\n    <span>public</span> <span>Collection</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> <span>getListMap</span><span>(</span><span>)</span><span>{</span>\n        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span><span>Object</span><span>></span></span> map <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        <span>//kay是字段名 value是字段值</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"age\"</span><span>,</span><span>20</span><span>)</span><span>;</span>\n        <span>Collection</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> userInfoEntityList <span>=</span> userInfoService<span>.</span><span>listByMap</span><span>(</span>map<span>)</span><span>;</span>\n        <span>return</span> userInfoEntityList<span>;</span>\n    <span>}</span>\n    <span>/**\n     * 新增用户信息\n     * <span>@author</span> xlc\n     * @CreateTime 2022/20 16:40\n     */</span>\n    <span>@RequestMapping</span><span>(</span><span>\"/saveInfo\"</span><span>)</span>\n    <span>public</span> <span>void</span> <span>saveInfo</span><span>(</span><span>)</span><span>{</span>\n        <span>UserInfoEntity</span> userInfoEntity <span>=</span> <span>new</span> <span>UserInfoEntity</span><span>(</span><span>)</span><span>;</span>\n        userInfoEntity<span>.</span><span>setName</span><span>(</span><span>\"小龙\"</span><span>)</span><span>;</span>\n        userInfoEntity<span>.</span><span>setSkill</span><span>(</span><span>\"JAVA\"</span><span>)</span><span>;</span>\n        userInfoEntity<span>.</span><span>setAge</span><span>(</span><span>18</span><span>)</span><span>;</span>\n        userInfoEntity<span>.</span><span>setFraction</span><span>(</span><span>59L</span><span>)</span><span>;</span>\n        userInfoEntity<span>.</span><span>setEvaluate</span><span>(</span><span>\"该学生是一个在改BUG的码农\"</span><span>)</span><span>;</span>\n        userInfoService<span>.</span><span>save</span><span>(</span>userInfoEntity<span>)</span><span>;</span>\n    <span>}</span>\n    <span>/**\n     * 批量新增用户信息\n     * <span>@author</span> xlc\n     * @CreateTime 2022/20 16:42\n     */</span>\n    <span>@RequestMapping</span><span>(</span><span>\"/saveInfoList\"</span><span>)</span>\n    <span>public</span> <span>void</span> <span>saveInfoList</span><span>(</span><span>)</span><span>{</span>\n        <span>//创建对象</span>\n        <span>UserInfoEntity</span> sans <span>=</span> <span>new</span> <span>UserInfoEntity</span><span>(</span><span>)</span><span>;</span>\n        sans<span>.</span><span>setName</span><span>(</span><span>\"Sans\"</span><span>)</span><span>;</span>\n        sans<span>.</span><span>setSkill</span><span>(</span><span>\"睡觉\"</span><span>)</span><span>;</span>\n        sans<span>.</span><span>setAge</span><span>(</span><span>18</span><span>)</span><span>;</span>\n        sans<span>.</span><span>setFraction</span><span>(</span><span>60L</span><span>)</span><span>;</span>\n        sans<span>.</span><span>setEvaluate</span><span>(</span><span>\"Sans是一个爱睡觉,并且身材较矮骨骼巨大的骷髅小胖子\"</span><span>)</span><span>;</span>\n        <span>UserInfoEntity</span> papyrus <span>=</span> <span>new</span> <span>UserInfoEntity</span><span>(</span><span>)</span><span>;</span>\n        papyrus<span>.</span><span>setName</span><span>(</span><span>\"papyrus\"</span><span>)</span><span>;</span>\n        papyrus<span>.</span><span>setSkill</span><span>(</span><span>\"JAVA\"</span><span>)</span><span>;</span>\n        papyrus<span>.</span><span>setAge</span><span>(</span><span>18</span><span>)</span><span>;</span>\n        papyrus<span>.</span><span>setFraction</span><span>(</span><span>58L</span><span>)</span><span>;</span>\n        papyrus<span>.</span><span>setEvaluate</span><span>(</span><span>\"Papyrus是一个讲话大声、个性张扬的骷髅，给人自信、有魅力的骷髅小瘦子\"</span><span>)</span><span>;</span>\n        <span>//批量保存</span>\n        <span>List</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> list <span>=</span><span>new</span> <span>ArrayList</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        list<span>.</span><span>add</span><span>(</span>sans<span>)</span><span>;</span>\n        list<span>.</span><span>add</span><span>(</span>papyrus<span>)</span><span>;</span>\n        userInfoService<span>.</span><span>saveBatch</span><span>(</span>list<span>)</span><span>;</span>\n    <span>}</span>\n    <span>/**\n     * 更新用户信息\n     * <span>@author</span> xlc\n     * @CreateTime 2022/20 16:47\n     */</span>\n    <span>@RequestMapping</span><span>(</span><span>\"/updateInfo\"</span><span>)</span>\n    <span>public</span> <span>void</span> <span>updateInfo</span><span>(</span><span>)</span><span>{</span>\n        <span>//根据实体中的ID去更新,其他字段如果值为null则不会更新该字段,参考yml配置文件</span>\n        <span>UserInfoEntity</span> userInfoEntity <span>=</span> <span>new</span> <span>UserInfoEntity</span><span>(</span><span>)</span><span>;</span>\n        userInfoEntity<span>.</span><span>setId</span><span>(</span><span>1L</span><span>)</span><span>;</span>\n        userInfoEntity<span>.</span><span>setAge</span><span>(</span><span>19</span><span>)</span><span>;</span>\n        userInfoService<span>.</span><span>updateById</span><span>(</span>userInfoEntity<span>)</span><span>;</span>\n    <span>}</span>\n    <span>/**\n     * 新增或者更新用户信息\n     * <span>@author</span> xlc\n     * @CreateTime 2022/20 16:50\n     */</span>\n    <span>@RequestMapping</span><span>(</span><span>\"/saveOrUpdateInfo\"</span><span>)</span>\n    <span>public</span> <span>void</span> <span>saveOrUpdate</span><span>(</span><span>)</span><span>{</span>\n        <span>//传入的实体类userInfoEntity中ID为null就会新增(ID自增)</span>\n        <span>//实体类ID值存在,如果数据库存在ID就会更新,如果不存在就会新增</span>\n        <span>UserInfoEntity</span> userInfoEntity <span>=</span> <span>new</span> <span>UserInfoEntity</span><span>(</span><span>)</span><span>;</span>\n        userInfoEntity<span>.</span><span>setId</span><span>(</span><span>1L</span><span>)</span><span>;</span>\n        userInfoEntity<span>.</span><span>setAge</span><span>(</span><span>20</span><span>)</span><span>;</span>\n        userInfoService<span>.</span><span>saveOrUpdate</span><span>(</span>userInfoEntity<span>)</span><span>;</span>\n    <span>}</span>\n    <span>/**\n     * 根据ID删除用户信息\n     * <span>@author</span> xlc\n     * @CreateTime 2022/20 16:52\n     */</span>\n    <span>@RequestMapping</span><span>(</span><span>\"/deleteInfo\"</span><span>)</span>\n    <span>public</span> <span>void</span> <span>deleteInfo</span><span>(</span><span>String</span> userId<span>)</span><span>{</span>\n        userInfoService<span>.</span><span>removeById</span><span>(</span>userId<span>)</span><span>;</span>\n    <span>}</span>\n    <span>/**\n     * 根据ID批量删除用户信息\n     * <span>@author</span> xlc\n     * @CreateTime 2022/20 16:55\n     */</span>\n    <span>@RequestMapping</span><span>(</span><span>\"/deleteInfoList\"</span><span>)</span>\n    <span>public</span> <span>void</span> <span>deleteInfoList</span><span>(</span><span>)</span><span>{</span>\n        <span>List</span><span><span>&lt;</span><span>String</span><span>></span></span> userIdlist <span>=</span> <span>new</span> <span>ArrayList</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        userIdlist<span>.</span><span>add</span><span>(</span><span>\"12\"</span><span>)</span><span>;</span>\n        userIdlist<span>.</span><span>add</span><span>(</span><span>\"13\"</span><span>)</span><span>;</span>\n        userInfoService<span>.</span><span>removeByIds</span><span>(</span>userIdlist<span>)</span><span>;</span>\n    <span>}</span>\n    <span>/**\n     * 根据指定字段删除用户信息\n     * <span>@author</span> xlc\n     * @CreateTime 2022/20 16:57\n     */</span>\n    <span>@RequestMapping</span><span>(</span><span>\"/deleteInfoMap\"</span><span>)</span>\n    <span>public</span> <span>void</span> <span>deleteInfoMap</span><span>(</span><span>)</span><span>{</span>\n        <span>//kay是字段名 value是字段值</span>\n        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span><span>Object</span><span>></span></span> map <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"skill\"</span><span>,</span><span>\"删除\"</span><span>)</span><span>;</span>\n        map<span>.</span><span>put</span><span>(</span><span>\"fraction\"</span><span>,</span><span>10L</span><span>)</span><span>;</span>\n        userInfoService<span>.</span><span>removeByMap</span><span>(</span>map<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>controller层用到<a href=\"https://so.csdn.net/so/search?q=lambda&amp;spm=1001.2101.3001.7020\" target=\"_blank\" rel=\"noopener noreferrer\">lambda</a>语法</p>\n<div><pre><code> \n<span>package</span> <span>com<span>.</span>demo<span>.</span>drools<span>.</span>controller</span><span>;</span>\n \n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>core<span>.</span>conditions<span>.</span>query<span>.</span></span><span>QueryWrapper</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>core<span>.</span>metadata<span>.</span></span><span>IPage</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>baomidou<span>.</span>mybatisplus<span>.</span>extension<span>.</span>plugins<span>.</span>pagination<span>.</span></span><span>Page</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>drools<span>.</span>entity<span>.</span></span><span>UserInfoEntity</span></span><span>;</span>\n<span>import</span> <span><span>com<span>.</span>demo<span>.</span>drools<span>.</span>service<span>.</span></span><span>UserInfoService</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>beans<span>.</span>factory<span>.</span>annotation<span>.</span></span><span>Autowired</span></span><span>;</span>\n<span>import</span> <span><span>org<span>.</span>springframework<span>.</span>web<span>.</span>bind<span>.</span>annotation<span>.</span></span><span>RequestMapping</span></span><span>;</span>\n \n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>HashMap</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>List</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Map</span></span><span>;</span>\n \n<span>/**\n * TODO your comment\n *\n * <span>@author</span> xlc\n * <span>@date</span> 2022/6/20 19:28\n */</span>\n<span>public</span> <span>class</span> <span>UserInfoPlusController</span> <span>{</span>\n    <span>@Autowired</span>\n    <span>private</span> <span>UserInfoService</span> userInfoService<span>;</span>\n    \n    <span>/**\n     * MP扩展演示\n     * <span>@author</span> xlc\n     * @CreateTime 2022/20 16:37\n     * @Return Map<span><span><span>&lt;</span>String,Object</span><span>></span></span> 返回数据\n     */</span>\n    <span>@RequestMapping</span><span>(</span><span>\"/getInfoListPlus\"</span><span>)</span>\n    <span>public</span> <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span><span>Object</span><span>></span></span> <span>getInfoListPage</span><span>(</span><span>)</span><span>{</span>\n        <span>//初始化返回类</span>\n        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span><span>Object</span><span>></span></span> result <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        <span>//查询年龄等于18岁的学生</span>\n        <span>//等价SQL: SELECT id,name,age,skill,evaluate,fraction FROM user_info WHERE age = 18</span>\n        <span>QueryWrapper</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> queryWrapper1 <span>=</span> <span>new</span> <span>QueryWrapper</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        queryWrapper1<span>.</span><span>lambda</span><span>(</span><span>)</span><span>.</span><span>eq</span><span>(</span><span>UserInfoEntity</span><span>::</span><span>getAge</span><span>,</span><span>18</span><span>)</span><span>;</span>\n        <span>List</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> userInfoEntityList1 <span>=</span> userInfoService<span>.</span><span>list</span><span>(</span>queryWrapper1<span>)</span><span>;</span>\n        result<span>.</span><span>put</span><span>(</span><span>\"studentAge18\"</span><span>,</span>userInfoEntityList1<span>)</span><span>;</span>\n        <span>//查询年龄大于5岁的学生且小于等于18岁的学生</span>\n        <span>//等价SQL: SELECT id,name,age,skill,evaluate,fraction FROM user_info WHERE age > 5 AND age &lt;= 18</span>\n        <span>QueryWrapper</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> queryWrapper2 <span>=</span> <span>new</span> <span>QueryWrapper</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        queryWrapper2<span>.</span><span>lambda</span><span>(</span><span>)</span><span>.</span><span>gt</span><span>(</span><span>UserInfoEntity</span><span>::</span><span>getAge</span><span>,</span><span>5</span><span>)</span><span>;</span>\n        queryWrapper2<span>.</span><span>lambda</span><span>(</span><span>)</span><span>.</span><span>le</span><span>(</span><span>UserInfoEntity</span><span>::</span><span>getAge</span><span>,</span><span>18</span><span>)</span><span>;</span>\n        <span>List</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> userInfoEntityList2 <span>=</span> userInfoService<span>.</span><span>list</span><span>(</span>queryWrapper2<span>)</span><span>;</span>\n        result<span>.</span><span>put</span><span>(</span><span>\"studentAge5\"</span><span>,</span>userInfoEntityList2<span>)</span><span>;</span>\n        <span>//模糊查询技能字段带有\"画\"的数据,并按照年龄降序</span>\n        <span>//等价SQL: SELECT id,name,age,skill,evaluate,fraction FROM user_info WHERE skill LIKE '%画%' ORDER BY age DESC</span>\n        <span>QueryWrapper</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> queryWrapper3 <span>=</span> <span>new</span> <span>QueryWrapper</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        queryWrapper3<span>.</span><span>lambda</span><span>(</span><span>)</span><span>.</span><span>like</span><span>(</span><span>UserInfoEntity</span><span>::</span><span>getSkill</span><span>,</span><span>\"画\"</span><span>)</span><span>;</span>\n        queryWrapper3<span>.</span><span>lambda</span><span>(</span><span>)</span><span>.</span><span>orderByDesc</span><span>(</span><span>UserInfoEntity</span><span>::</span><span>getAge</span><span>)</span><span>;</span>\n        <span>List</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> userInfoEntityList3 <span>=</span> userInfoService<span>.</span><span>list</span><span>(</span>queryWrapper3<span>)</span><span>;</span>\n        result<span>.</span><span>put</span><span>(</span><span>\"studentAgeSkill\"</span><span>,</span>userInfoEntityList3<span>)</span><span>;</span>\n        <span>//模糊查询名字带有\"小\"或者年龄大于18的学生</span>\n        <span>//等价SQL: SELECT id,name,age,skill,evaluate,fraction FROM user_info WHERE name LIKE '%小%' OR age > 18</span>\n        <span>QueryWrapper</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> queryWrapper4 <span>=</span> <span>new</span> <span>QueryWrapper</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        queryWrapper4<span>.</span><span>lambda</span><span>(</span><span>)</span><span>.</span><span>like</span><span>(</span><span>UserInfoEntity</span><span>::</span><span>getName</span><span>,</span><span>\"小\"</span><span>)</span><span>;</span>\n        queryWrapper4<span>.</span><span>lambda</span><span>(</span><span>)</span><span>.</span><span>or</span><span>(</span><span>)</span><span>.</span><span>gt</span><span>(</span><span>UserInfoEntity</span><span>::</span><span>getAge</span><span>,</span><span>18</span><span>)</span><span>;</span>\n        <span>List</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> userInfoEntityList4 <span>=</span> userInfoService<span>.</span><span>list</span><span>(</span>queryWrapper4<span>)</span><span>;</span>\n        result<span>.</span><span>put</span><span>(</span><span>\"studentOr\"</span><span>,</span>userInfoEntityList4<span>)</span><span>;</span>\n        <span>//查询评价不为null的学生,并且分页</span>\n        <span>//等价SQL: SELECT id,name,age,skill,evaluate,fraction FROM user_info WHERE evaluate IS NOT NULL LIMIT 0,5</span>\n        <span>IPage</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> page <span>=</span> <span>new</span> <span>Page</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        page<span>.</span><span>setCurrent</span><span>(</span><span>1</span><span>)</span><span>;</span>\n        page<span>.</span><span>setSize</span><span>(</span><span>5</span><span>)</span><span>;</span>\n        <span>QueryWrapper</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> queryWrapper5 <span>=</span> <span>new</span> <span>QueryWrapper</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        queryWrapper5<span>.</span><span>lambda</span><span>(</span><span>)</span><span>.</span><span>isNotNull</span><span>(</span><span>UserInfoEntity</span><span>::</span><span>getEvaluate</span><span>)</span><span>;</span>\n        page <span>=</span> userInfoService<span>.</span><span>page</span><span>(</span>page<span>,</span>queryWrapper5<span>)</span><span>;</span>\n        result<span>.</span><span>put</span><span>(</span><span>\"studentPage\"</span><span>,</span>page<span>)</span><span>;</span>\n        <span>return</span> result<span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>以上就是mybatis-plus的小案例，mybatis-plus它像我之前使用的spring data <a href=\"https://so.csdn.net/so/search?q=jpa&amp;spm=1001.2101.3001.7020\" target=\"_blank\" rel=\"noopener noreferrer\">jpa</a>框架不用写sql语句，就可以实现简单的增删改查、批量操作、分页mybatis-plus功能还是比较强大，能减少我们写很多代码，我个人还是比较喜欢用这个mybatis-plus的</p>\n<p>mybatis-plus只是mybatis的增强版，它不影响mybatis的使用，我们可以写我们自定的方法以及sql，接下来我们看一个小案例</p>\n<p>dao层新增方法</p>\n<div><pre><code><span>/**\n     * 查询大于该分数的学生\n     * <span>@author</span> xlc\n     * @CreateTime 2022/20 14:28\n     * @Param  page  分页参数\n     * @Param  fraction  分数\n     * @Return IPage<span><span><span>&lt;</span>UserInfoEntity</span><span>></span></span> 分页数据\n     */</span>\n    <span>IPage</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> <span>selectUserInfoByGtFraction</span><span>(</span>\n            <span>@Param</span><span>(</span>value <span>=</span> <span>\"page\"</span><span>)</span> <span>IPage</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> page<span>,</span>\n            <span>@Param</span><span>(</span>value <span>=</span> <span>\"fraction\"</span><span>)</span><span>Long</span> fraction<span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>service新增方法</p>\n<div><pre><code><span>/**\n     * 查询大于该分数的学生\n     * <span>@author</span> xlc\n     * @CreateTime 2022/20 14:27\n     * @Param  page  分页参数\n     * @Param  fraction  分数\n     * @Return IPage<span><span><span>&lt;</span>UserInfoEntity</span><span>></span></span> 分页数据\n     */</span>\n    <span>IPage</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> <span>selectUserInfoByGtFraction</span><span>(</span><span>IPage</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> page<span>,</span><span>Long</span> fraction<span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>serviceImpl层新增方法</p>\n<div><pre><code><span>/**\n     * 查询大于该分数的学生\n     * <span>@author</span> xlc\n     * @CreateTime 2022/20 14:27\n     * @Param  page  分页参数\n     * @Param  fraction  分数\n     * @Return IPage<span><span><span>&lt;</span>UserInfoEntity</span><span>></span></span> 分页数据\n     */</span>\n    <span>@Override</span>\n    <span>public</span> <span>IPage</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> <span>selectUserInfoByGtFraction</span><span>(</span><span>IPage</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> page<span>,</span> <span>Long</span> fraction<span>)</span> <span>{</span>\n        <span>return</span> userInfoDao<span>.</span><span>selectUserInfoByGtFraction</span><span>(</span>page<span>,</span>fraction<span>)</span><span>;</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>controller层新增方法</p>\n<div><pre><code> <span>/**\n     * MP自定义SQL\n     * <span>@author</span> xlc\n     * @CreateTime 2022/20 14:37\n     * @Return IPage<span><span><span>&lt;</span>UserInfoEntity</span><span>></span></span> 分页数据\n     */</span>\n    <span>@RequestMapping</span><span>(</span><span>\"/getInfoListSQL\"</span><span>)</span>\n    <span>public</span> <span>IPage</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> <span>getInfoListSQL</span><span>(</span><span>)</span><span>{</span>\n        <span>//查询大于60分以上的学生,并且分页</span>\n        <span>IPage</span><span><span>&lt;</span><span>UserInfoEntity</span><span>></span></span> page <span>=</span> <span>new</span> <span>Page</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        page<span>.</span><span>setCurrent</span><span>(</span><span>1</span><span>)</span><span>;</span>\n        page<span>.</span><span>setSize</span><span>(</span><span>5</span><span>)</span><span>;</span>\n        page <span>=</span> userInfoService<span>.</span><span>selectUserInfoByGtFraction</span><span>(</span>page<span>,</span><span>60L</span><span>)</span><span>;</span>\n        <span>return</span> page<span>;</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>配置我们的mybatis的xml</p>\n<div><pre><code><span>&lt;</span>?xml <span>version</span><span>=</span><span>\"1.0\"</span> <span>encoding</span><span>=</span><span>\"UTF-8\"</span> ?<span>></span>\n<span>&lt;</span><span>!</span>DOCTYPE mapper PUBLIC <span>\"-//mybatis.org//DTD Mapper 3.0//EN\"</span> <span>\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span> <span>></span>\n<span>&lt;</span>mapper <span>namespace</span><span>=</span><span>\"com.demo.drools.dao.UserInfoDao\"</span><span>></span>\n  <span>&lt;</span>select <span>id</span><span>=</span><span>\"selectUserInfoByGtFraction\"</span> <span>resultType</span><span>=</span><span>\"com.demo.drools.entity.UserInfoEntity\"</span><span>></span>\n    SELECT * FROM user_info WHERE fraction <span>></span> <span>#{fraction}</span>\n    <span>&lt;</span>/select<span>></span>\n<span>&lt;</span>/mapper<span>></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>以上配置就是我们的mybatis用法。</p>\n<h2 id=\"mybatis-plus强大的条件构造器querywrapper、updatewrapper\" tabindex=\"-1\"> mybatis plus强大的条件构造器queryWrapper、updateWrapper</h2>\n<p>1.<strong>QueryWrapper</strong>： Entity 对象封装操作类\n2.<strong>UpdateWrapper</strong> ： Update 条件封装，用于Entity对象更新操作\n3.条件构造器使用中的各个方法格式和说明</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220620164733512.png\" alt=\"image-20220620164733512\"></p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220620164733512.png",
      "date_published": "2022-07-01T00:00:00.000Z",
      "date_modified": "2022-06-20T08:54:02.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "Logback 配置文件优化",
      "url": "https://blog.ciberviler.top/dev/Logback%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BC%98%E5%8C%96.html",
      "id": "https://blog.ciberviler.top/dev/Logback%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BC%98%E5%8C%96.html",
      "content_html": "<h1 id=\"logback-配置文件优化\" tabindex=\"-1\"> Logback 配置文件优化</h1>\n<p><strong>01、通过阅读本篇文章将了解到</strong></p>\n<ul>\n<li>1.日志输出到文件并根据<code>LEVEL</code>级别将日志分类保存到不同文件</li>\n<li>2.通过异步输出日志减少磁盘<code>IO</code>提高性能</li>\n<li>3.异步输出日志的原理</li>\n</ul>\n<h3 id=\"_02、配置文件logback-spring-xml\" tabindex=\"-1\"> 02、配置文件logback-spring.xml</h3>\n<p><code>SpringBoot</code>工程自带<code>logback</code>和<code>slf4j</code>的依赖，所以重点放在编写配置文件上，需要引入什么依赖，日志依赖冲突统统都不需要我们管了。<code>logback</code>框架会默认加载<code>classpath</code>下命名为<code>logback-spring</code>或<code>logback</code>的配置文件。将所有日志都存储在一个文件中文件大小也随着应用的运行越来越大并且不好排查问题，正确的做法应该是将<code>error</code>日志和其他日志分开，并且不同级别的日志根据时间段进行记录存储。</p>\n<div><pre><code><span>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?></span>\n<span><span><span>&lt;</span>configuration</span><span>></span></span>\n    <span><span><span>&lt;</span>property</span> <span>resource</span><span><span>=</span><span>\"</span>logback.properties<span>\"</span></span><span>/></span></span>\n    <span><span><span>&lt;</span>appender</span> <span>name</span><span><span>=</span><span>\"</span>CONSOLE-LOG<span>\"</span></span> <span>class</span><span><span>=</span><span>\"</span>ch.qos.logback.core.ConsoleAppender<span>\"</span></span><span>></span></span>\n        <span><span><span>&lt;</span>layout</span> <span>class</span><span><span>=</span><span>\"</span>ch.qos.logback.classic.PatternLayout<span>\"</span></span><span>></span></span>\n            <span><span><span>&lt;</span>pattern</span><span>></span></span>[%d{yyyy-MM-dd' 'HH:mm:ss.sss}] [%C] [%t] [%L] [%-5p] %m%n<span><span><span>&lt;/</span>pattern</span><span>></span></span>\n        <span><span><span>&lt;/</span>layout</span><span>></span></span>\n    <span><span><span>&lt;/</span>appender</span><span>></span></span>\n    <span>&lt;!--获取比info级别高(包括info级别)但除error级别的日志--></span>\n    <span><span><span>&lt;</span>appender</span> <span>name</span><span><span>=</span><span>\"</span>INFO-LOG<span>\"</span></span> <span>class</span><span><span>=</span><span>\"</span>ch.qos.logback.core.rolling.RollingFileAppender<span>\"</span></span><span>></span></span>\n        <span><span><span>&lt;</span>filter</span> <span>class</span><span><span>=</span><span>\"</span>ch.qos.logback.classic.filter.LevelFilter<span>\"</span></span><span>></span></span>\n            <span><span><span>&lt;</span>level</span><span>></span></span>ERROR<span><span><span>&lt;/</span>level</span><span>></span></span>\n            <span><span><span>&lt;</span>onMatch</span><span>></span></span>DENY<span><span><span>&lt;/</span>onMatch</span><span>></span></span>\n            <span><span><span>&lt;</span>onMismatch</span><span>></span></span>ACCEPT<span><span><span>&lt;/</span>onMismatch</span><span>></span></span>\n        <span><span><span>&lt;/</span>filter</span><span>></span></span>\n        <span><span><span>&lt;</span>encoder</span><span>></span></span>\n            <span><span><span>&lt;</span>pattern</span><span>></span></span>[%d{yyyy-MM-dd' 'HH:mm:ss.sss}] [%C] [%t] [%L] [%-5p] %m%n<span><span><span>&lt;/</span>pattern</span><span>></span></span>\n        <span><span><span>&lt;/</span>encoder</span><span>></span></span>\n\n        <span>&lt;!--滚动策略--></span>\n        <span><span><span>&lt;</span>rollingPolicy</span> <span>class</span><span><span>=</span><span>\"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span>\"</span></span><span>></span></span>\n            <span>&lt;!--路径--></span>\n            <span><span><span>&lt;</span>fileNamePattern</span><span>></span></span>${LOG_INFO_HOME}//%d.log<span><span><span>&lt;/</span>fileNamePattern</span><span>></span></span>\n            <span><span><span>&lt;</span>maxHistory</span><span>></span></span>30<span><span><span>&lt;/</span>maxHistory</span><span>></span></span>\n        <span><span><span>&lt;/</span>rollingPolicy</span><span>></span></span>\n    <span><span><span>&lt;/</span>appender</span><span>></span></span>\n    <span><span><span>&lt;</span>appender</span> <span>name</span><span><span>=</span><span>\"</span>ERROR-LOG<span>\"</span></span> <span>class</span><span><span>=</span><span>\"</span>ch.qos.logback.core.rolling.RollingFileAppender<span>\"</span></span><span>></span></span>\n        <span><span><span>&lt;</span>filter</span> <span>class</span><span><span>=</span><span>\"</span>ch.qos.logback.classic.filter.ThresholdFilter<span>\"</span></span><span>></span></span>\n            <span><span><span>&lt;</span>level</span><span>></span></span>ERROR<span><span><span>&lt;/</span>level</span><span>></span></span>\n        <span><span><span>&lt;/</span>filter</span><span>></span></span>\n        <span><span><span>&lt;</span>encoder</span><span>></span></span>\n            <span><span><span>&lt;</span>pattern</span><span>></span></span>[%d{yyyy-MM-dd' 'HH:mm:ss.sss}] [%C] [%t] [%L] [%-5p] %m%n<span><span><span>&lt;/</span>pattern</span><span>></span></span>\n        <span><span><span>&lt;/</span>encoder</span><span>></span></span>\n        <span>&lt;!--滚动策略--></span>\n        <span><span><span>&lt;</span>rollingPolicy</span> <span>class</span><span><span>=</span><span>\"</span>ch.qos.logback.core.rolling.TimeBasedRollingPolicy<span>\"</span></span><span>></span></span>\n            <span>&lt;!--路径--></span>\n            <span><span><span>&lt;</span>fileNamePattern</span><span>></span></span>${LOG_ERROR_HOME}//%d.log<span><span><span>&lt;/</span>fileNamePattern</span><span>></span></span>\n            <span><span><span>&lt;</span>maxHistory</span><span>></span></span>30<span><span><span>&lt;/</span>maxHistory</span><span>></span></span>\n        <span><span><span>&lt;/</span>rollingPolicy</span><span>></span></span>\n    <span><span><span>&lt;/</span>appender</span><span>></span></span>\n\n    <span><span><span>&lt;</span>root</span> <span>level</span><span><span>=</span><span>\"</span>info<span>\"</span></span><span>></span></span>\n        <span><span><span>&lt;</span>appender-ref</span> <span>ref</span><span><span>=</span><span>\"</span>CONSOLE-LOG<span>\"</span></span> <span>/></span></span>\n        <span><span><span>&lt;</span>appender-ref</span> <span>ref</span><span><span>=</span><span>\"</span>INFO-LOG<span>\"</span></span> <span>/></span></span>\n        <span><span><span>&lt;</span>appender-ref</span> <span>ref</span><span><span>=</span><span>\"</span>ERROR-LOG<span>\"</span></span> <span>/></span></span>\n    <span><span><span>&lt;/</span>root</span><span>></span></span>\n<span><span><span>&lt;/</span>configuration</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>部分标签说明</p>\n<p><code>&lt;root&gt;</code>标签，必填标签，用来指定最基础的日志输出级别</p>\n<ul>\n<li><code>&lt;appender-ref&gt;</code>标签，添加<code>append</code></li>\n</ul>\n<p><code>&lt;append&gt;</code>标签，通过使用该标签指定日志的收集策略</p>\n<ul>\n<li><code>name</code>属性指定<code>appender</code>命名</li>\n<li><code>class</code>属性指定输出策略，通常有两种，控制台输出和文件输出，文件输出就是将日志进行一个持久化。<code>ConsoleAppender</code>将日志输出到控制台</li>\n</ul>\n<p><code>&lt;filter&gt;</code>标签，通过使用该标签指定过滤策略</p>\n<ul>\n<li><code>&lt;level&gt;</code>标签指定过滤的类型</li>\n</ul>\n<p><code>&lt;encoder&gt;</code>标签，使用该标签下的<code>&lt;pattern&gt;</code>标签指定日志输出格式。</p>\n<p><code>&lt;rollingPolicy&gt;</code>标签指定收集策略，比如基于时间进行收集</p>\n<ul>\n<li><code>&lt;fileNamePattern&gt;</code>标签指定生成日志保存地址 通过这样配置已经实现了分类分天手机日志的目标了</li>\n</ul>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16556915204025.jpeg\" alt=\"图片\"></p>\n<h3 id=\"_03、logback-高级特性异步输出日志\" tabindex=\"-1\"> 03、logback 高级特性异步输出日志</h3>\n<p>之前的日志配置方式是基于同步的，每次日志输出到文件都会进行一次磁盘IO。采用异步写日志的方式而不让此次写日志发生磁盘IO，阻塞线程从而造成不必要的性能损耗。异步输出日志的方式很简单，添加一个基于异步写日志的<code>appender</code>，并指向原先配置的<code>appender</code>即可</p>\n<div><pre><code> <span>&lt;!-- 异步输出 --></span>\n    <span><span><span>&lt;</span>appender</span> <span>name</span><span><span>=</span><span>\"</span>ASYNC-INFO<span>\"</span></span> <span>class</span><span><span>=</span><span>\"</span>ch.qos.logback.classic.AsyncAppender<span>\"</span></span><span>></span></span>\n        <span>&lt;!-- 不丢失日志.默认的,如果队列的80%已满,则会丢弃TRACT、DEBUG、INFO级别的日志 --></span>\n        <span><span><span>&lt;</span>discardingThreshold</span><span>></span></span>0<span><span><span>&lt;/</span>discardingThreshold</span><span>></span></span>\n        <span>&lt;!-- 更改默认的队列的深度,该值会影响性能.默认值为256 --></span>\n        <span><span><span>&lt;</span>queueSize</span><span>></span></span>256<span><span><span>&lt;/</span>queueSize</span><span>></span></span>\n        <span>&lt;!-- 添加附加的appender,最多只能添加一个 --></span>\n        <span><span><span>&lt;</span>appender-ref</span> <span>ref</span><span><span>=</span><span>\"</span>INFO-LOG<span>\"</span></span><span>/></span></span>\n    <span><span><span>&lt;/</span>appender</span><span>></span></span>\n\n    <span><span><span>&lt;</span>appender</span> <span>name</span><span><span>=</span><span>\"</span>ASYNC-ERROR<span>\"</span></span> <span>class</span><span><span>=</span><span>\"</span>ch.qos.logback.classic.AsyncAppender<span>\"</span></span><span>></span></span>\n        <span>&lt;!-- 不丢失日志.默认的,如果队列的80%已满,则会丢弃TRACT、DEBUG、INFO级别的日志 --></span>\n        <span><span><span>&lt;</span>discardingThreshold</span><span>></span></span>0<span><span><span>&lt;/</span>discardingThreshold</span><span>></span></span>\n        <span>&lt;!-- 更改默认的队列的深度,该值会影响性能.默认值为256 --></span>\n        <span><span><span>&lt;</span>queueSize</span><span>></span></span>256<span><span><span>&lt;/</span>queueSize</span><span>></span></span>\n        <span>&lt;!-- 添加附加的appender,最多只能添加一个 --></span>\n        <span><span><span>&lt;</span>appender-ref</span> <span>ref</span><span><span>=</span><span>\"</span>ERROR-LOG<span>\"</span></span><span>/></span></span>\n    <span><span><span>&lt;/</span>appender</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"_04、异步输出日志性能测试\" tabindex=\"-1\"> 04、异步输出日志性能测试</h3>\n<p>既然能提高性能的话，必须进行一次测试比对，同步和异步输出日志性能到底能提升多少倍？</p>\n<h3 id=\"_05、服务器硬件\" tabindex=\"-1\"> 05、服务器硬件</h3>\n<ul>\n<li><code>CPU</code> 六核</li>\n<li>内存 8G</li>\n</ul>\n<h3 id=\"_06、测试工具\" tabindex=\"-1\"> 06、测试工具</h3>\n<ul>\n<li>Apache Jmeter</li>\n</ul>\n<h3 id=\"_07、同步输出日志\" tabindex=\"-1\"> 07、同步输出日志</h3>\n<ul>\n<li>线程数：100</li>\n<li><code>Ramp-Up Loop</code>(可以理解为启动线程所用时间) ：0 可以理解为100个线程同时启用</li>\n<li>测试结果</li>\n</ul>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16556915204021.png\" alt=\"图片\"></p>\n<p>重点关注指标 Throughput【TPS】 吞吐量：系统在单位时间内处理请求的数量，在同步输出日志中 TPS 为 44.2/sec</p>\n<h3 id=\"_08、异步输出日志\" tabindex=\"-1\"> 08、异步输出日志</h3>\n<ul>\n<li>线程数 100</li>\n<li><code>Ramp-Up Loop</code>：0</li>\n<li>测试结果</li>\n</ul>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16556915204022.png\" alt=\"图片\"></p>\n<p>TPS 为 497.5/sec ， 性能提升了10多倍！！！</p>\n<h3 id=\"_09、异步日志输出原理\" tabindex=\"-1\"> 09、异步日志输出原理</h3>\n<p>从<code>logback</code>框架下的<code>Logger.info</code>方法开始追踪。一路的方法调用路径如下图所示：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16556915204023.png\" alt=\"图片\"></p>\n<p>异步输出日志中最关键的就是配置文件中<code>ch.qos.logback.classic``AsyncAppenderBase``append</code></p>\n<div><pre><code>//来自阿里大佬的《LeetCode刷题答案》pdf新鲜出炉\n//年末面试必备！大家可以关注公众号TJ君，回复LeetCode领取。\n\nprotected void append(E eventObject) {\n        if(!this.isQueueBelowDiscardingThreshold() || !this.isDiscardable(eventObject)) {\n            this.preprocess(eventObject);\n            this.put(eventObject);\n        }\n    }\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>通过队列情况判断是否需要丢弃日志，不丢弃的话将它放到阻塞队列中，通过查看代码，这个阻塞队列为<code>ArrayBlockingQueueu</code>，默认大小为256，可以通过配置文件进行修改。<code>Logger.info(...)</code>到<code>append(...)</code>就结束了，只做了将日志塞入到阻塞队列的事，然后继续执行<code>Logger.info(...)</code>下面的语句了。在<code>AsyncAppenderBase</code>类中定义了一个<code>Worker</code>线程，<code>run</code>方法中的关键部分代码如下:</p>\n<div><pre><code>E e = parent.blockingQueue.take();\naai.appendLoopOnAppenders(e);\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>从阻塞队列中取出一个日志，并调用<code>AppenderAttachableImpl</code>类中的<code>appendLoopOnAppenders</code>方法维护一个<code>Append</code>列表。<code>Worker</code>线程中调用方法过程主要如下图：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16556915204024.png\" alt=\"图片\"></p>\n<p>最主要的两个方法就是<code>encode``write``encode</code></p>\n<p>来源：<a href=\"https://juejin.cn/post/6844903909920604174\" target=\"_blank\" rel=\"noopener noreferrer\">https://juejin.cn/post/6844903909920604174</a></p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16556915204025.jpeg",
      "date_published": "2022-06-30T00:00:00.000Z",
      "date_modified": "2022-06-20T02:20:38.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "Oracle的数据 导入与导出-数据库",
      "url": "https://blog.ciberviler.top/linux/Oracle%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E4%B8%8E%E5%AF%BC%E5%87%BA-%E6%95%B0%E6%8D%AE%E5%BA%93.html",
      "id": "https://blog.ciberviler.top/linux/Oracle%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E4%B8%8E%E5%AF%BC%E5%87%BA-%E6%95%B0%E6%8D%AE%E5%BA%93.html",
      "content_html": "<h1 id=\"oracle的数据-导入与导出-数据库\" tabindex=\"-1\"> Oracle的数据 导入与导出-数据库</h1>\n<h2 id=\"_1-数据库导入导出需要注意\" tabindex=\"-1\"> 1 数据库导入导出需要注意</h2>\n<p>1.目标数据库要与源数据库有着名称相同的表空间。</p>\n<p>2.目标数据在进行导入时，用户名尽量相同(这样保证用户的权限级别相同)。</p>\n<p>3.目标数据库每次在进行数据导入前，应做好数据备份，以防数据丢失。</p>\n<p>4.弄清是导入导出到相同版本还是不同版本(oracle10g 版本与 oracle11g 版本)。</p>\n<p>5.目标数据导入前,弄清楚是数据覆盖(替换),还是仅插入新数据或替换部分数据表。</p>\n<p>6.确定目标数据库磁盘空间是否足够容纳新数据，是否需要扩充表空间。</p>\n<p>7.导入导出时注意字符集是否相同，一般 Oracle 数据库的字符集只有一个，并且固定，</p>\n<p>一般不改变。</p>\n<p>8.确定操作者的账号权限。</p>\n<p><a href=\"https://article.itxueyuan.com/2d0kg5\" target=\"_blank\" rel=\"noopener noreferrer\">https://article.itxueyuan.com/2d0kg5</a></p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/73851450\" target=\"_blank\" rel=\"noopener noreferrer\">https://zhuanlan.zhihu.com/p/73851450</a></p>\n<p><a href=\"https://www.jb51.net/article/156826.htm\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.jb51.net/article/156826.htm</a></p>\n<p><a href=\"https://www.gxlcms.com/sql_question-400828.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.gxlcms.com/sql_question-400828.html</a></p>\n<h2 id=\"_2-导出-数据-格式介绍\" tabindex=\"-1\"> 2 导出 数据 格式介绍</h2>\n<p>Dmp 格式：.dmp 是二进制文件，可跨平台，还能包含权限，效率好。</p>\n<p>Sql 格式：.sql 格式的文件，可用文本编辑器查看，通用性比较好，效率不如第一种，</p>\n<p>适合小数据量导入导出。尤其注意的是表中不能有大字段 （blob,clob,long），如果有，会</p>\n<p>报错。</p>\n<p>Pde 格式：.pde 格式的文件，.pde 为 PL/SQL Developer 自有的文件格式，只能用 PL/SQL</p>\n<p>Developer 工具导入导出，不能用文本编辑器查看。</p>\n<h3 id=\"_3-方式\" tabindex=\"-1\"> 3 方式</h3>\n<h4 id=\"如果是docker-先登录\" tabindex=\"-1\"> <strong>如果是docker 先登录：</strong></h4>\n<p>进入镜像进行配置</p>\n<div><pre><code><span>docker</span> <span>exec</span> -it oracle11 <span>bash</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code>sqlplus /nolog\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>发现没有该命令，所以切换root用户。</p>\n<div><pre><code><span>su</span> root \n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>输入密码：helowin</p>\n<p>编辑profile文件配置ORACLE环境变量</p>\n<p>打开：vi /etc/profile ，在文件最后写上下面内容：</p>\n<div><pre><code><span>export</span> <span>ORACLE_HOME</span><span>=</span>/home/oracle/app/oracle/product/11.2.0/dbhome_2\n<span>export</span> <span>ORACLE_SID</span><span>=</span>helowin\n<span>export</span> <span><span>PATH</span></span><span>=</span><span>$ORACLE_HOME</span>/bin:<span>$PATH</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>保存后执行<code>source /etc/profile</code> 加载环境变量；</p>\n<p>创建软连接</p>\n<div><pre><code><span>ln</span> -s <span>$ORACLE_HOME</span>/bin/sqlplus /usr/bin\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>切换到oracle 用户</p>\n<div><pre><code><span>su</span> - oracle\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>登录sqlplus并修改sys、system用户密码</p>\n<div><pre><code>sqlplus <span>/</span>nolog   <span>--登录</span>\nconn <span>/</span><span>as</span> sysdba  <span>--</span>\n<span>alter</span> <span>user</span> system identified <span>by</span> system<span>;</span><span>--修改system用户账号密码；</span>\n<span>alter</span> <span>user</span> sys identified <span>by</span> system<span>;</span><span>--修改sys用户账号密码；</span>\n<span>create</span> <span>user</span> test identified <span>by</span> test<span>;</span> <span>-- 创建内部管理员账号密码；</span>\n<span>grant</span> <span>connect</span><span>,</span>resource<span>,</span>dba <span>to</span> yan_test<span>;</span> <span>--将dba权限授权给内部管理员账号和密码；</span>\n<span>ALTER</span> PROFILE <span>DEFAULT</span> <span>LIMIT</span> PASSWORD_LIFE_TIME UNLIMITED<span>;</span> <span>--修改密码规则策略为密码永不过期；（会出现坑，后面讲解）</span>\n<span>alter</span> system <span>set</span> processes<span>=</span><span>1000</span> scope<span>=</span>spfile<span>;</span> <span>--修改数据库最大连接数据；</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>修改以上信息后，需要重新启动数据库；</p>\n<div><pre><code>conn /as sysdba\n<span>shutdown</span> immediate<span>;</span> --关闭数据库\nstartup<span>;</span> --启动数据库\nexit：退出软链接\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><h4 id=\"命令格式\" tabindex=\"-1\"> 命令格式</h4>\n<p>exp|imp 用 户 名 / 密 码 @ 连 接 地 址 : 端 口 / 服 务 名 file= 路 径 / 文 件 名 .dmp</p>\n<p>full=y|tabels(tablename,tablename...)|owner(username1,username2,username3)</p>\n<p>exp:导出命令，导出时必写。</p>\n<p>imp:导入命令，导入时必写,每次操作，二者只能选择一个执行。</p>\n<p>username:导出数据的用户名，必写;</p>\n<p>password:导出数据的密码，必写;</p>\n<p>@:地址符号，必写;</p>\n<p>SERVICENAME:Oracle 的服务名，必写;</p>\n<p>1521:端口号，1521 是默认的可以不写,非默认要写;</p>\n<p>file=&quot;文件名.dmp&quot; : 文件存放路径地址，必写;</p>\n<p>full=y :表示全库导出。可以不写，则默认为 no,则只导出用户下的对象;</p>\n<p>tables:表示只导出哪些表;</p>\n<p>owner:导出该用户下对象;</p>\n<p>full|tables|owner:只能使用一种;</p>\n<h4 id=\"_1、传统方法\" tabindex=\"-1\"> <em><strong>1、传统方法：</strong></em></h4>\n<p><strong>dmp文件的导出</strong></p>\n<p>首先,我们先了解dmp文件的导出</p>\n<p>dmp文件导出一般用的比较多的是三种,分别是: 导出整个数据库实例的所有数据,导出指定用户的所有的表,导出指定表.</p>\n<p>我们以自己的数据库为例,假设我们的数据库的实例为&quot;Oracle&quot;</p>\n<p>可以通过&quot;任务管理器----&gt;服务&quot;中查看自己的数据库实例</p>\n<p>一般信息是 已启用 自动 本地系统</p>\n<p>打开cmd命令行 :</p>\n<p>1: 将数据库Oracle完全导出,用户名system密码manager导出到 c:daochu.dmp中</p>\n<div><pre><code>exp system<span>/</span>manager<span>@Oracle</span> <span>file</span><span>=</span>c:daochu<span>.</span>dmp <span>full</span><span>=</span>y\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>2: 将数据库中RFD用户与,JYZGCX用户的表导出</p>\n<div><pre><code>exp system<span>/</span>manager<span>@ORACLE</span> <span>file</span><span>=</span>d:daochu<span>.</span>dmp owner<span>=</span><span>(</span>RFD<span>,</span>JYZGCX<span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>3: 将数据库中的表T_USER,T_ROLE导出</p>\n<p>system为用户名，manager为密码，ORACLE为数据库实例名，其实不一定非的用system用户，只要是拥有管理员权限的用户都可以</p>\n<div><pre><code>exp JYZGCX<span>/</span>JYZGCX<span>@Oracle</span> <span>file</span> <span>=</span> d:datanewsmgnt<span>.</span>dmp <span>tables</span> <span>=</span> <span>(</span>T_USER<span>,</span>T_ROLE<span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code><span>--备份某几张表  ！！！！</span>\nexp smsc<span>/</span>smsc <span>file</span><span>=</span><span>/</span><span>data</span><span>/</span>oracle_bak<span>/</span>dmp<span>/</span>bakup0209_2<span>.</span>dmp <span>tables</span><span>=</span>\\<span>(</span>send_msg_his<span>,</span>send_msg<span>,</span>recv_msg_his<span>,</span>recv_msg\\<span>)</span>\n<span>--备份整个数据库 ！！！！</span>\n<span>--方式1</span>\nexp smsc<span>/</span>smsc <span>file</span><span>=</span><span>/</span><span>data</span><span>/</span>oracle_bak<span>/</span>dmp<span>/</span>bakupsmmc0209_2<span>.</span>dmp <span>full</span><span>=</span>y\n<span>--方式2</span>\nexp cop<span>/</span>cop<span>@133.96.84.39</span>:<span>1521</span><span>/</span>coprule <span>file</span><span>=</span><span>/</span>home<span>/</span>oracle<span>/</span>cop_20160902<span>.</span>dmp owner<span>=</span>cop log<span>=</span><span>/</span>home<span>/</span>oracle<span>/</span>cop<span>.</span>log\n<span>--本机上</span>\nexp zop<span>/</span>zop<span>@orcl</span> <span>file</span><span>=</span> D:\\zop_bak<span>.</span>dmp owner<span>=</span>zop log<span>=</span>D:\\zop_ba<span>.</span>log\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>dmp文件的导入</strong></p>\n<p>步骤如下:</p>\n<p>机器环境是windows7,其实也无所谓,命令行不都是样的么</p>\n<p>\\1. 打开&quot;开始&quot; ---&gt;输入cmd,打开cmd命令窗口,输入: sqlplus/as sysdba; 然后使用conn / as sysdba;这样就可以以超级管理员的最高权限登录,当然这决定于init.ora文件中的数据库初始化参数.</p>\n<p>\\2. 上面sysdba登录后,就可以创建表空间和用户了.</p>\n<p>(打开&quot;开始&quot;--&gt;输入cmd--&gt;sqlplus/nolog; 输入conn/as sysdba 管理员账户登录;)</p>\n<p>由于我们已经有dmp文件了,可以用notepad++ 打开dmp文件,进去按ctrl+f 去查找tablespace,可以找到这个dmp文件对应的表空间,然后根据表空间的信息去创建表空间,这样才能导入dmp文件.</p>\n<p>然后就是创建表空间,命令如下:</p>\n<div><pre><code><span>create</span> <span>tablespace</span> USERS\n\nlogging\n\ndatefile <span>'D:oracleproduct10.2.0oradataorclUSERS.dnf'</span>\n\nsize <span>32</span>m\n\nautoxtend onnext <span>32</span>m maxsize <span>2048</span>m\n\nextend management <span>local</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>创建test用户,密码也是test222,使用上面创建的表空间</p>\n<div><pre><code><span>create</span> <span>user</span> test identifiles <span>by</span> test222\n\n <span>default</span> <span>tablespace</span> USERS\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>给创建的test用户分配权限,为了方便可以直接分配dba权限</p>\n<p><code>grant dba to test;</code></p>\n<p>这样一来,我们前期的准备工作就完成了,然后就可以关掉刚刚的命令窗口了.</p>\n<p>打开&quot;开始&quot; ---&gt;输入cmd(是cmd窗口不是sqlplus窗口)</p>\n<p>由于上面的步骤中,创建了test用户,所以我们往test用户去导入数据</p>\n<p>直接输入如下的语句:</p>\n<div><pre><code>imp test<span>/</span>test222<span>@localhost</span><span>/</span>orcl <span>file</span><span>=</span><span>\"C:UsersxiejiachenDesktoptest20190630.DMP\"</span> <span>full</span> <span>=</span>y<span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>下面解释一下上面的语句:</p>\n<p>test是上面创建的登录数据库的用户名</p>\n<p>test222是上面的登录数据库的密码</p>\n<p>localhost: 代表你的数据库是本机还是远程导入,需要的可以随时替换ip地址</p>\n<p>orcl: 是实例的名称</p>\n<p>file: 后面是你的dmp的文件路径</p>\n<p>full=y : 全部导入</p>\n<p>以上就是oracle数据库导出和导入dmp文件的两种方法.</p>\n<div><pre><code><span>--数据的导入</span>\n<span>--1 将D:\\daochu.dmp 中的数据导入 TEST数据库中。</span>\n imp system<span>/</span>manager<span>@TEST</span> <span>file</span><span>=</span>d:\\daochu<span>.</span>dmp\n imp aichannel<span>/</span>aichannel<span>@TEST</span> <span>full</span><span>=</span>y <span>file</span><span>=</span>d:\\datanewsmgnt<span>.</span>dmp <span>ignore</span><span>=</span>y\n<span>--上面可能有点问题，因为有的表已经存在，然后它就报错，对该表就不进行导入。</span>\n<span>-- 在后面加上 ignore=y 就可以了。</span>\n<span>--2 将d:daochu.dmp中的表table1 导入</span>\nimp system<span>/</span>manager<span>@TEST</span> <span>file</span><span>=</span>d:\\daochu<span>.</span>dmp <span>tables</span><span>=</span><span>(</span>table1<span>)</span>\n<span>--基本上上面的导入导出够用了。不少情况要先是将表彻底删除，然后导入。</span>\n注意：\n操作者要有足够的权限，权限不够它会提示。\n数据库时可以连上的。可以用tnsping TEST 来获得数据库TEST能否连上。\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_2、数据泵方法\" tabindex=\"-1\"> 2、数据泵方法：</h4>\n<p>创建directory:</p>\n<div><pre><code>expdp<span>(</span>impdp<span>)</span> username<span>/</span>password<span>@SERVICENAME</span>:<span>1521</span> \nschemas<span>=</span>username <span>dumpfile</span><span>=</span>file1<span>.</span>dmp logfile<span>=</span>file1<span>.</span>log \ndirectory<span>=</span>testdata1 remap_schema<span>=</span>test:test<span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>数据库导出举例:</p>\n<div><pre><code>expdp xinxiaoyong<span>/</span><span>123456</span><span>@127.0.0.1</span>:<span>1521</span> schemas<span>=</span>xinxiaoyong <span>dumpfile</span><span>=</span>test<span>.</span>dmp \n\nlogfile<span>=</span>test<span>.</span>log directory<span>=</span>testdata1<span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><div><pre><code>exp:导出命令，导出时必写。\nimp:导入命令，导入时必写<span>,</span>每次操作，二者只能选择一个执行。\nusername:导出数据的用户名，必写<span>;</span>\npassword:导出数据的密码，必写<span>;</span>\n@:地址符号，必写<span>;</span>\nSERVICENAME:Oracle的服务名，必写<span>;</span>\n<span>1521</span>:端口号，<span>1521</span>是默认的可以不写<span>,</span>非默认要写<span>;</span>\nschemas：导出操作的用户名<span>;</span>\n<span>dumpfile</span>：导出的文件<span>;</span>\nlogfile:导出的日志文件<span>,</span>可以不写；\ndirectory:创建的文件夹名称<span>;</span>\nremap_schema<span>=</span>源数据库用户名:目标数据库用户名<span>,</span>二者不同时必写，相同可以省略<span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>1.查看表空间：</p>\n<p><code>select ＊　from dba_tablespaces;</code></p>\n<p>2.查看管理理员目录(同时查看操作系统是否存在，因为Oracle并不关心该目录是否存在，如果不存在，则出错)。</p>\n<p><code>select ＊　from dba_directories;</code></p>\n<p>3.创建逻辑目录，该命令不会在操作系统创建真正的目录，最好以system等管理员创建。</p>\n<p><code>create directory testdata1 as 'd:testdump';</code></p>\n<p>4.给xinxiaoyong用户赋予在指定目录的操作权限，最好以system等管理员赋予。\n//xinxiaoyong 是用户名(123456是用户密码)</p>\n<p><code>grant read,write on directory testdata1 to xinxiaoyong;</code></p>\n<p>5.导出数据</p>\n<p>1)按用户导</p>\n<div><pre><code>expdp xinxiaoyong<span>/</span><span>*</span><span>*</span><span>*</span><span>123456</span><span>*</span><span>*</span><span>*</span><span>@orcl</span> schemas<span>=</span>xinxiaoyong <span>dumpfile</span><span>=</span>expdp<span>.</span>dmp directory<span>=</span>testdata1<span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>2)并行进程</p>\n<div><pre><code>parallel expdp xinxiaoyong<span>/</span><span>*</span><span>*</span><span>*</span><span>123456</span><span>*</span><span>*</span><span>*</span><span>@orcl</span> \ndirectory<span>=</span>testdata1 <span>dumpfile</span><span>=</span>xinxiaoyong3<span>.</span>dmp parallel<span>=</span><span>*</span><span>*</span><span>*</span><span>40</span><span>*</span><span>*</span><span>*</span> job_name<span>=</span>xinxiaoyong3\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>3)按表名导</p>\n<div><pre><code>expdp xinxiaoyong<span>/</span><span>*</span><span>*</span><span>*</span><span>123456</span><span>*</span><span>*</span><span>*</span><span>@orcl</span> <span>tables</span><span>=</span>emp<span>,</span>dept <span>dumpfile</span><span>=</span>expdp<span>.</span>dmp directory<span>=</span>testdata1<span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>4)按查询条件导</p>\n<div><pre><code>expdp xinxiaoyong<span>/</span><span>*</span><span>*</span><span>*</span><span>123456</span><span>*</span><span>*</span><span>*</span><span>@orcl</span> \ndirectory<span>=</span>testdata1 <span>dumpfile</span><span>=</span>expdp<span>.</span>dmp <span>tables</span><span>=</span>emp query<span>=</span><span>'WHERE deptno=20'</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>5)按表空间导</p>\n<div><pre><code>expdp system<span>/</span>manager directory<span>=</span>testdata1 <span>dumpfile</span><span>=</span><span>tablespace</span><span>.</span>dmp tablespaces<span>=</span><span>temp</span><span>,</span>example<span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>6)导整个数据库</p>\n<div><pre><code>expdp system<span>/</span>manager directory<span>=</span>testdata1 <span>dumpfile</span><span>=</span><span>full</span><span>.</span>dmp <span>FULL</span><span>=</span>y<span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>6.还原数据\n1)导到指定用户下</p>\n<div><pre><code> impdp xinxiaoyong<span>/</span><span>*</span><span>*</span><span>*</span><span>123456</span><span>*</span><span>*</span><span>*</span> directory<span>=</span>testdata1 <span>dumpfile</span><span>=</span>expdp<span>.</span>dmp schemas<span>=</span>xinxiaoyong<span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>2)改变表的</p>\n<div><pre><code>owner impdp system<span>/</span>manager \ndirectory<span>=</span>testdata1 <span>dumpfile</span><span>=</span>expdp<span>.</span>dmp <span>tables</span><span>=</span>xinxiaoyong<span>.</span>dept remap_schema <span>=</span>xinxiaoyong:system<span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>3)导入表空间</p>\n<div><pre><code>impdp system/manager directory=testdata1 dumpfile=tablespace.dmp tablespaces=example;\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>4)导入数据库</p>\n<div><pre><code>impdb system<span>/</span>manager directory<span>=</span>dump_dir <span>dumpfile</span><span>=</span><span>full</span><span>.</span>dmp <span>FULL</span><span>=</span>y<span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>5)追加数据</p>\n<div><pre><code>impdp system<span>/</span>manager \ndirectory<span>=</span>testdata1 <span>dumpfile</span><span>=</span>expdp<span>.</span>dmp schemas<span>=</span>system table_exists_action<span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h4 id=\"_3、plsql方法\" tabindex=\"-1\"> 3、PLSQL方法：</h4>\n<p>登录plsql工具，所使用用户为源数据库有导出权限（exp_full_database,dba等）的用户。</p>\n<p>1.导出建表语句（包括存储结构）</p>\n<p>导出步骤tools -&gt;export user object，选择要导出的对象，导出.sql格式文件并等待导出完成，如 下图：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220620092932901.png\" alt=\"image-20220620092932901\"></p>\n<p>导出数据文件 ;\n   2.导出步骤tools -&gt;export tables，选择要导出的表及导出的格式进行导出。</p>\n<p>导出为dmp格式，如下图：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220620092943308.png\" alt=\"image-20220620092943308\"></p>\n<p>导出为sql格式，如下图：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220620092949353.png\" alt=\"image-20220620092949353\"></p>\n<p>导出为pde格式，如下图：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220620092954469.png\" alt=\"image-20220620092954469\"></p>\n<p>提示说明：采用第三方工具导出导入整个数据库的话，耗时较长，一定要有足够</p>\n<p>的时间来操作(数据量大的话需要好几个小时)。</p>\n<p>3.导入建表语句\n   导入步骤tools-&gt;import tables-&gt;SQL Inserts 导入.sql文件\n4.导入数据；\n   tools-&gt;import talbes，然后再根据导出的数据格式选择导入dmp文件，或者sql文件，\n或者pde文件。\n   提示说明：导入之前最好把以前的表删除，当然导入另外数据库除外。\n      另外导入时当发现进度条一直卡在一个点，而且导出的文件不再增大时，甚至是提示程序\n未响应，千万不要以为程序卡死了，这个导入导出就是比较缓慢，只要没有提示报错，</p>\n<p>或者导入完成就不要停止程序。</p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220620092932901.png",
      "date_published": "2022-06-29T00:00:00.000Z",
      "date_modified": "2022-06-20T03:39:20.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Linux"
      ]
    },
    {
      "title": "Oracle数据库基础",
      "url": "https://blog.ciberviler.top/linux/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80.html",
      "id": "https://blog.ciberviler.top/linux/Oracle%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80.html",
      "content_html": "<h1 id=\"oracle数据库基础\" tabindex=\"-1\"> Oracle数据库基础</h1>\n<p><strong>数据字典</strong>，数据库元数据信息的数据字典表和用户可以读取的数据字典视图组成。存放oracle数据库所用的有关信息。通过数据字典可以查看数据表和用户的一些信息。</p>\n<p><strong>数据文件</strong>，一个oracle数据可以拥有一个或多个物理的数据文件，一个数据文件只对于一个数据库</p>\n<p><strong>表空间</strong>，存储的逻辑结构，是组织数据和进行空间分配的逻辑结构。简单点，表空间就是一个或者多个数据文件的集合，所有的数据文件都被逻辑的存放在指定的表空间中。通常有system 、sysaux、 temp三个默认表空间。</p>\n<p><strong>系统用户</strong>：sys，system，sysman，scott默认密码tigger，</p>\n<p><strong>系统用户登入SQLplus</strong>：[system/123456][@server/ip][as sysdba/sysoper]管理员权限，@server/ip，数据库不在本机，需要输入IP。</p>\n<p><strong>登入用户命令</strong>：connect sys/123456 as sysdba；connect system/123456</p>\n<p><strong>查看当前登入用户</strong>：show user</p>\n<p><strong>使用数据字典来查看信息</strong>：含有的字典有dba_users、user_users、dba_tablespaces，user_tablespaces(普通用户表空间)</p>\n<p>可以使用desc来查看数据字典都有些什么字段， desc dba_users，之后可以使用select语句查看具体的记录。可以查看某个用户默认的表空间。</p>\n<p><strong>启用用户的语句</strong>：alter user username account unlock。比如启动scoot用户alter user scott account unlock；这样就可以使用scott用户登入系统。</p>\n<h2 id=\"表空间\" tabindex=\"-1\"> <strong>表空间</strong></h2>\n<p>这是数据库的逻辑存储空间，在数据库中开辟的一个空间来存储数据，oracle的很多优化都是通过表空间来实现的。表都是放在表空间的数据文件里面。</p>\n<p>一个形象的比喻：在一个房间里面这个房间可以存储很多箱子，箱子里面可以存储物品！ 表空间可以看成房间，箱子可以看成数据文件物品可以看成表。 用户指定表空间也就是你希望把属于这个用户的表放在那个房间（表空间）里面。\n表空间是一个虚拟的概念可以无限大，但是需要由数据文件作为载体。</p>\n<p><strong>为什么要创建表空间？</strong></p>\n<p>答：在建立用户的时候，我们建议数据库管理员要指定用户的默认表空间。因为我们在利用CREATE语句创建数据库对象，如数据库表的时候，其默认是存储在数据库的当前默认空间。若不指定用户默认表空间的话，则用户每次创建数据库对象的时候，都要指定表空间，显然，这并不是很合理。不同的表空间有不同的权限控制。用户对于表空间A具有完全控制权限，可能对于表空间B就只有查询权限，甚至连连接的权限的都没有。所以，合理为用户配置表空间的访问权限，也是提高数据库安全性的一个方法。</p>\n<p><strong>修改用户默认的表空间（管理员权限）</strong>：alter user username default | temporary tablespace tablename.</p>\n<p><strong>创建表空间</strong>：create [temporary] tablespace tablename tempfile | datafile 'xxx.dbf' size xx； (默认目录下)</p>\n<p><strong>如何查看默认路径</strong>：通过数据字典dba_data_files；临时表空间dba_temp_files</p>\n<p>select file_name from dba_data_files where tablesopace_name='XXX.dbf'</p>\n<p>设置表空间联机或脱机状态(无法使用表空间)，创建好表空间后默认是联机状态：alter tablespace tablename online | offline；</p>\n<p><strong>设置表空间的只读或者只写</strong>：alter tablespace tablename read only | write only | read write;</p>\n<p><strong>如何查看表空间所处的状态</strong>：通过status字段（dba_tablespaces）select statue from dba_tablespaces where tablespace_name='XXX.dbf';</p>\n<p><strong>为表空间添加数据文件</strong>：alter tablespace tablename add datafile 'xxx.dbf' size xx；可以从字典dba_data_files中file_name字段查看当前表空间的数据文件。</p>\n<p><strong>删除表空间的数据文件</strong>：alter tablespace tablename drop datafile 'xxx.dbf' ；不能删除第一条</p>\n<p><strong>删除表空间</strong>：drop tablespace tablename [ including contents ] 如果只是删除表空间就直接使用drop。如果需要将表空间里面的文件也删除，就使用including。</p>\n<p><strong>创建用户</strong>：create user 用户名 identified by 密码 default tablespace 表空间表；</p>\n<p><strong>接着授权给新建的用户：</strong>\ngrant connect,resource to news; --表示把 connect,resource权限授予news用户\n​grant dba to news; --表示把 dba权限授予给news用户</p>\n<h2 id=\"表\" tabindex=\"-1\"> <strong>表</strong></h2>\n<p>存储数据的基本单位，表是一个二维结构，行列。数据类型：字符型、日期型、数值型、其他类型。</p>\n<p><strong>字符型</strong>：char(n)、nchar(n)，固定的数据类型，如果没有达到N那么就自动补空格。</p>\n<p>varchar2(n)、nvarchar2(n)，可变的数据类型，可以节省空间</p>\n<p><strong>数值型</strong>：number（p,s）p有效数字，s小数点后的位数。float（）二进制。number（6，0）表示6位整数</p>\n<p><strong>日期型</strong>：date</p>\n<p><strong>其他类型</strong>：blob、clob，存储4GB的数据</p>\n<p>**创建表：**create tabel table_name ( colum1_name datatype，colum2_name datatype <strong>default 默认值</strong> )；</p>\n<p><strong>查看表结构</strong>：desc table_name</p>\n<p><strong>修改表</strong>：alert table tablename add column_name datatype； 增加字段</p>\n<p>alert table tablename modify column_name datatype；修改数据类型</p>\n<p>alert table tablename drop column column_name ；删除字段</p>\n<p>alert table tablename rename column column_oldname to column_newname；修改字段的名字</p>\n<p>rename table_oldname to table_newname ；修改表名</p>\n<p><strong>删除表</strong>：truncate table table_name；截断表中的数据，执行后，表字段在，但内容不在。</p>\n<p>drop table table_name ；彻底删除表</p>\n<p>操作表中的数据</p>\n<p><strong>添加数据</strong>：insert into table_name [(column1, column2,....)] values(value1,value2,...)</p>\n<p>alert table tablename modify column_name default 默认值</p>\n<p><strong>复制表的数据</strong>：create table table_name <strong>as</strong> select column1,... from other_tablename ； 复制表中的内容</p>\n<p>insert into table_name [(column1, column2,....)] select column1,* from table_old</p>\n<p><strong>更新数据</strong>： update table_name set column1=value1,...[where conditions]</p>\n<p><strong>删除数据</strong>：delete from table_name ; 删除全部数据和truncate一样，但是truncate效率高。</p>\n<p>有条件删除，上面加上where子句。</p>\n<h2 id=\"约束\" tabindex=\"-1\"> <strong>约束</strong></h2>\n<p>作用定义规则，那些字段是一定需要输入的，那些字段是需要唯一的等等，这样可以确保数据的完整性。</p>\n<p><strong>非空约束</strong>：not null 在数据类型之后添加即可。id number(6,0) not null</p>\n<p>alert table tablename <strong>modify</strong> column_name datatype null ; 将非空的改为可以为空</p>\n<p><strong>主键约束</strong>：可以为一个字段，也可以是多个字段称为复合主键 primary key</p>\n<p>create table name(column1,..., constraint keyname primary key(column1,column2))；复合约束</p>\n<p>如果忘记了约束的名字，可以在<strong>数据字典user_constraints</strong>里面查看</p>\n<p>alert table tablename add constraint keyname primary key(column1,column2))；表创建好后添加主键</p>\n<p>alert table tablename rename constraint oldname to new_name；更改约束名字</p>\n<p><strong>删除约束</strong>：alert table tablename disable | enable constaint name；禁用主键约束</p>\n<p>alert table tablename drop constraint name</p>\n<p>alert table tablename drop primary key [cascade]</p>\n<p><strong>外键约束</strong>：alert table table1name (column_name datatype references table2name(column_name),..);</p>\n<p>table2是主表，table1为从表，table2的column因为主键，对应字段的类型要一样。从表中的值来源于主表或者为空。</p>\n<p>(add)constraint constraint_name foreign key(column) references table_name(column_name) [on delete cascade]</p>\n<p>例子：create table userinfo (</p>\n<p>id varchar(10),</p>\n<p>name varchar(10),</p>\n<p>typeid_new varchar(20) references typeid(typeid) on delete cascade</p>\n<p>);</p>\n<p><strong>唯一约束</strong>：unique，在字段名后加就可以，跟default使用一样的。</p>\n<p>constraint constraint_name unique（column_name）</p>\n<p><strong>检查约束</strong>：create table userinfo (</p>\n<p>salary number(5,0) check( salary&gt;0 )</p>\n<p>);</p>\n<p>在SQLplus中可以使用以下语句更改显示的字段名、格式等：</p>\n<p>col column_name heading new_name； 显示的名字</p>\n<p>col column_name format a10； 更改字符型字段的长度，更改为10个字符长；</p>\n<p>col column_name format 99; 更改数值型的显示位数，两位，保留一位小数99.9，也可以加上$</p>\n<p>col column_name clear ；清楚之前设置的格式</p>\n<h2 id=\"查询\" tabindex=\"-1\"> <strong>查询</strong></h2>\n<p>对原表不会有影响，只是对查询结果有影响</p>\n<p>select [distinct] column_name as newname</p>\n<p>from table</p>\n<p>[where ]</p>\n<p>order by column1 desc/asc, column2</p>\n<p>order by对查询结果进行排序</p>\n<p>group by 对查询结果进行分组，以汇总数据或者整个分组显示单行的汇总信息，在结果中每组数据都有一个与之对应的统计值（count、min、max、sum、avg）。计算每个username的平均分数，group by username。</p>\n<p>select job_id, avg(salary), sum(salary),count(*) from employees group by job_id；最后结果上会显示出4列</p>\n<p><strong>rollup</strong>：在结果上增加一行，汇总各列信息，group by rollup(job_id)</p>\n<p>having子句是对分组后的结果进行进一步的筛选，having是作用在组上面的。对having子句作用的理解就是记住select语句中子句的处理顺序，在select语句中，首先由from子句找到数据表，where子句接受from子句输出的数据，而having子句则接受来自group by 、where和from子句的输出。</p>\n<p>逻辑运算符的优先级：not、and、or</p>\n<p>模糊查询：like、_（任意一个字符）、%（任意多个值）、</p>\n<p>以a开头的：where like 'a%'</p>\n<p>含有a的用户名：where like '%a%'</p>\n<p>case..when.：select username ,case when username ='aaa' then 计算机部门',</p>\n<p>when 'bbb' then '市场部门' else '其他部门' end as 部门</p>\n<p>from users;</p>\n<p>判断某列的值是否为null：column is NULL/is NOT NULL</p>\n<h2 id=\"多表查询\" tabindex=\"-1\"> <strong>多表查询</strong></h2>\n<p>from table1 join_type table2 [on(join_condition)]</p>\n<p>join_type有内连接（inner join），自然连接（natural join）、外连接。</p>\n<p><strong>内连接</strong>：需要指定连接的条件，只返回符合条件和连接条件的行，消除不匹配的行。</p>\n<p><strong>自然连接</strong>：第一个表中的那些列与第二表中具有相同名称的列进行连接，bU需要明确指出进行连接的列。</p>\n<p><strong>外连接</strong>：扩展内连接的结果集，出返回匹配的结果集，还会返回不匹配的结果集。外连接有以下几种</p>\n<p><strong>左外连接</strong>（left [outer] join）：显示左表中不匹配的行，满足where条件但不与右表匹配的行</p>\n<p><strong>右外连接</strong>（right [outer] join）：显示右表中不匹配的行，满足where条件但不与左表匹配的行</p>\n<p><strong>全外连接</strong>（full [outer] join）：显示所有符合搜索条件的行</p>\n<p><code>grant &lt;权限&gt;，&lt;权限&gt; [on&lt;对象类型&gt;&lt;对象名&gt;] to &lt;用户&gt; [with admin option](可以授予给他人)</code></p>\n",
      "date_published": "2022-06-28T00:00:00.000Z",
      "date_modified": "2022-06-20T01:36:59.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Linux"
      ]
    },
    {
      "title": "ES6语法详解",
      "url": "https://blog.ciberviler.top/dev/ES6%E8%AF%AD%E6%B3%95%E8%AF%A6%E8%A7%A3.html",
      "id": "https://blog.ciberviler.top/dev/ES6%E8%AF%AD%E6%B3%95%E8%AF%A6%E8%A7%A3.html",
      "content_html": "<h1 id=\"es6语法详解\" tabindex=\"-1\"> ES6语法详解</h1>\n<h2 id=\"let变量\" tabindex=\"-1\"> let变量</h2>\n<p><code>let</code>声明的变量在<code>let</code>命令所在的代码块中有效。不存在变量提升，只能先声明后使用。</p>\n<h3 id=\"暂存死区\" tabindex=\"-1\"> 暂存死区</h3>\n<p>如果区块中存在<code>let</code>和<code>const</code>命令，这个区块对这些命令声明的变量，从一开始就形成了封闭作用域。凡是在声明之前就使用这些变量。</p>\n<div><pre><code><span>var</span> a <span>=</span> <span>1</span><span>;</span>\n<span>{</span>\n    a <span>=</span> <span>2</span><span>;</span>           <span>//ReferenceError</span>\n    <span>let</span> a <span>=</span> <span>'a'</span><span>;</span>\n    console<span>.</span><span>log</span><span>(</span>a<span>)</span><span>;</span>  <span>//'a';</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>在相同块级作用域中，不能用<code>let</code>重复声明同一变量。即使已存在的变量是通过<code>var</code>声明的。</p>\n<div><pre><code><span>let</span> a <span>=</span> <span>1</span><span>;</span>  <span>let</span> a <span>=</span> <span>2</span><span>;</span>   <span>//报错</span>\n<span>let</span> a <span>=</span> <span>1</span><span>;</span>  <span>var</span> a <span>=</span> <span>2</span><span>;</span>   <span>//报错，var声明有变量提升作用</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h3 id=\"块级作用域和函数声明\" tabindex=\"-1\"> 块级作用域和函数声明</h3>\n<p>在块级作用域中，用<code>let</code>声明的变量只在当前作用域中有效，且不会受到外部的影响，所以块级作用域可以替代自执行函数表达式。</p>\n<p>理论上，函数在块级作用域中声明行为和<code>let</code>类似，但在es6浏览器环境中，为了兼容老版本，函数声明与<code>var</code>声明变量类似，会提升到全局作用域头部，和当前块级作用域的头部，为了避免差异，可以将函数声明写成函数表达式。</p>\n<div><pre><code><span>let</span> <span>fn</span> <span>=</span> <span>function</span> <span>(</span><span>)</span> <span>{</span><span>}</span><span>;</span>    <span>//函数表达式</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h2 id=\"const常量\" tabindex=\"-1\"> const常量</h2>\n<p>声明常量必须马上赋值且不能再改变。<code>const</code>和<code>let</code>有类似的特点：在块级作用域内有效，声明不提升，存在暂存死区，不可重复声明。</p>\n<p>复合型数据如<code>object</code>，声明后不可在重新赋值，但可以修改这个值本身，比如修改属性和新增属性。冻结对象可以使用<code>Object.freeze</code>方法。</p>\n<div><pre><code><span>const</span> json <span>=</span> Object<span>.</span><span>freeze</span><span>(</span><span>{</span><span>}</span><span>)</span><span>;</span>\n<span>//常规模式下修改json无效，严格模式下报错</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h3 id=\"顶层变量\" tabindex=\"-1\"> 顶层变量</h3>\n<p><code>javascript</code>的顶层对象是<code>window</code>，<code>node</code>的顶层对象是<code>global</code>，<code>ES6</code>规定用<code>let</code> <code>const</code> <code>class</code>声明的变量不在是顶层对象的属性。</p>\n<div><pre><code><span>let</span> a <span>=</span> <span>1</span><span>;</span>\nwindow<span>.</span>a   <span>//undefined</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h2 id=\"解构赋值\" tabindex=\"-1\"> 解构赋值</h2>\n<p>从数组和对象中提取值，对变量进行赋值，称为解构（destructuring）</p>\n<p><strong>数组</strong>的解构赋值，按照对应的顺序赋值，如果值数量超出则多余的值被抛弃，如果值不够则为<code>undefined</code>。</p>\n<div><pre><code><span>let</span> arr <span>=</span> <span>[</span><span>1</span><span>,</span> <span>[</span><span>2</span><span>,</span> <span>3</span><span>]</span><span>]</span><span>;</span>\n<span>let</span> <span>[</span>a<span>,</span> <span>[</span>b<span>,</span> c<span>]</span><span>]</span> <span>=</span> arr<span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p><strong>对象</strong>的解构赋值必须要属性名相同，顺序毫无影响。如果属性名不同，需要写成如下形式。</p>\n<div><pre><code><span>let</span> <span>{</span><span>a</span><span>:</span> b<span>}</span> <span>=</span> <span>{</span><span>c</span><span>:</span> <span>1</span><span>}</span><span>;</span>\nb <span>//1</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>实际上对象解构赋值的是后者。</p>\n<div><pre><code><span>let</span> <span>{</span>a<span>}</span> <span>=</span> <span>{</span><span>a</span><span>:</span> <span>1</span><span>}</span>     <span>//简写 </span>\n<span>let</span> <span>{</span><span>a</span><span>:</span> a<span>}</span> <span>=</span> <span>{</span><span>a</span><span>:</span> <span>1</span><span>}</span>  <span>//全写</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p><strong>字符串</strong>解构赋值和数组类似。</p>\n<div><pre><code><span>let</span> <span>[</span>a<span>,</span> b<span>,</span> c<span>]</span> <span>=</span> <span>'hello'</span><span>;</span>\nconsole<span>.</span><span>log</span><span>(</span>a<span>,</span>b<span>,</span>c<span>)</span>  <span>//h,e,l</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>数组解构赋值<strong>默认值</strong>，当等号右边的值 <code>=== undefined</code>时，默认值生效。</p>\n<div><pre><code><span>let</span> <span>[</span>a <span>=</span> <span>1</span><span>,</span> b <span>=</span> <span>2</span><span>]</span> <span>=</span> <span>[</span><span>undefined</span><span>,</span> <span>null</span><span>]</span><span>;</span>\nconsole<span>.</span><span>log</span><span>(</span>a<span>,</span> b<span>)</span><span>;</span>  <span>//1 null</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>以上代码逻辑是：</p>\n<div><pre><code><span>if</span> <span>(</span><span>[</span>undifined<span>,</span> <span>null</span><span>]</span><span>[</span><span>0</span><span>]</span> <span>===</span> <span>undefined</span><span>)</span> <span>{</span>\n    a <span>=</span> <span>1</span><span>;</span>\n<span>}</span> <span>else</span> <span>{</span>\n    a <span>=</span> <span>[</span>undifined<span>,</span> <span>null</span><span>]</span><span>[</span><span>0</span><span>]</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>对象解构赋值默认值，当对象属性值严格等于<code>undefined</code>时。</p>\n<div><pre><code><span>let</span> <span>{</span>a<span>,</span> b<span>=</span><span>2</span><span>}</span> <span>=</span> <span>{</span><span>1</span><span>,</span> <span>undefined</span><span>}</span>\na<span>,</span>b <span>//1,2</span>\n\n<span>let</span> <span>{</span><span>a</span><span>:</span> b<span>=</span><span>1</span><span>}</span> <span>=</span> <span>{</span><span>a</span><span>:</span> <span>undefined</span><span>}</span>\nb <span>//1</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>事实上，只要某种数据结构具有 <code>Iterator</code> 接口，都可以采用数组形式的解构赋值。</p>\n<p>函数参数的解构赋值，传入的参数不是数组或对象，而是变量。</p>\n<div><pre><code><span>let</span> <span>fn</span> <span>=</span> <span>(</span> <span><span>[</span>a<span>,</span> b<span>]</span></span> <span>)</span> <span>=></span> <span>{</span>\n    <span>return</span> a <span>+</span> b<span>;</span>\n<span>}</span><span>;</span>\n<span>fn</span> <span>(</span><span>[</span><span>1</span><span>,</span> <span>2</span><span>]</span><span>)</span><span>;</span> <span>//3</span>\n<span>[</span><span>[</span><span>1</span><span>,</span><span>2</span><span>]</span><span>,</span><span>[</span><span>3</span><span>,</span><span>4</span><span>]</span><span>]</span><span>.</span><span>map</span><span>(</span><span>[</span>a<span>,</span>b<span>]</span><span>=></span> a<span>+</span>b<span>)</span><span>;</span>\n<span>//[3,7]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>函数参数也可使用默认值</p>\n<div><pre><code><span>let</span> <span>fn</span><span>(</span><span><span>{</span>a<span>=</span><span>1</span><span>,</span> b<span>=</span><span>2</span><span>}</span> <span>=</span> <span>{</span><span>}</span></span><span>)</span> <span>{</span> <span>return</span> <span>[</span>a<span>,</span>b<span>]</span><span>}</span>\n<span>fn</span><span>(</span><span>{</span><span>a</span><span>:</span><span>10</span><span>}</span><span>)</span>  <span>// [10,2]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>等号右边如果不是对象，会先转成对象，转换失败则报错。</p>\n<div><pre><code><span>let</span> <span>{</span><span>toString</span><span>:</span> s<span>}</span> <span>=</span> <span>123</span><span>;</span>\ns <span>===</span> <span>Number</span><span>.</span>prototype<span>.</span>toString\n\n<span>let</span> <span>{</span><span>toString</span><span>:</span> s<span>}</span> <span>=</span> <span>true</span><span>;</span>\ns <span>===</span> <span>Blooean</span><span>.</span>prototype<span>.</span>toString\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p><code>undefined</code> <code>null</code>不能转成对象，结构赋值报错。</p>\n<div><pre><code><span>let</span> <span>{</span>a<span>}</span> <span>=</span> <span>undefined</span><span>;</span>   <span>//TypeError</span>\n<span>let</span> <span>{</span>b<span>}</span> <span>=</span> <span>null</span><span>;</span>        <span>//TypeError</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>解构赋值应用:</p>\n<div><pre><code><span>//交换变量的值</span>\n<span>let</span> a <span>=</span> <span>1</span><span>,</span> b <span>=</span> <span>2</span><span>;</span>\n<span>[</span>a<span>,</span>b<span>]</span> <span>=</span> <span>[</span>b<span>,</span> a<span>]</span><span>;</span>\n\n<span>//函数返回多个值</span>\n<span>let</span> <span>fn</span> <span>=</span> <span>(</span><span>)</span> <span>=></span> <span>{</span><span>x</span><span>:</span> <span>1</span><span>,</span> <span>y</span><span>:</span> <span>2</span><span>}</span>\n\n<span>//提取json数据</span>\n<span>let</span> <span>{</span>a<span>,</span> b<span>}</span> <span>=</span> obj<span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"字符串扩展\" tabindex=\"-1\"> 字符串扩展</h2>\n<p><code>ES6</code>提供<code>for...of</code>方法遍历字符串。</p>\n<p>新增的其他方法：<code>startsWidth()</code> <code>endsWidth()</code> <code>includes()</code>。</p>\n<div><pre><code><span>let</span> s <span>=</span> <span>'hello word!'</span><span>;</span>\ns<span>.</span><span>startsWith</span><span>(</span><span>'hello'</span><span>)</span><span>;</span>     <span>//true</span>\ns<span>.</span><span>endsWidth</span><span>(</span><span>'word'</span><span>)</span><span>;</span>       <span>//true</span>\ns<span>.</span><span>includes</span><span>(</span><span>'o'</span><span>)</span><span>;</span>           <span>//true </span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p><code>charAt()</code> 用于返回给定位置的字符，对于编码大于0xFFFF的字符用<code>at()</code>方法。</p>\n<div><pre><code><span>'ab'</span><span>.</span><span>charAt</span><span>(</span><span>0</span><span>)</span>  <span>//'a'</span>\n<span>'𠮷a'</span><span>.</span><span>charAt</span><span>(</span><span>0</span><span>)</span> <span>//'\\uD842'</span>\n<span>'𠮷a'</span><span>.</span><span>at</span><span>(</span><span>0</span><span>)</span>     <span>//'𠮷'</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h3 id=\"模版字符串\" tabindex=\"-1\"> 模版字符串</h3>\n<p>用于字符串拼接，<code>{}</code>中可以进行运算、引用对象、调用函数，非字符串类型会被转成字符串。可以嵌套使用，<code>{}</code>中可以再使用模版字符串。如果字符串中有反引号要用反斜杠转义。</p>\n<div><pre><code><span>let</span> name <span>=</span> <span>'zq'</span><span>;</span>\n<span><span>`</span><span>your name is </span><span><span>${</span>name<span>}</span></span><span>`</span></span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>模版字符串中空格和和缩紧都会被保留，可以用<code>trim()</code>方法消除。</p>\n<div><pre><code><span><span>`</span><span>&lt;ul>\n    &lt;li>&lt;li>\n&lt;/ul></span><span>`</span></span><span>.</span><span>trim</span><span>(</span><span>)</span><span>;</span>  \n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h2 id=\"正则表达式\" tabindex=\"-1\"> 正则表达式</h2>\n<p><code>RegExp</code>构造函数参数有两种情况。</p>\n<div><pre><code><span>//参数一：字符串，参数二：修饰符</span>\n<span>let</span> reg <span>=</span> <span>new</span> <span>RegExp</span><span>(</span><span>'abc'</span><span>,</span><span>'i'</span><span>)</span><span>;</span>\n\n<span>//参数一：正则表达式</span>\n<span>let</span> reg <span>=</span> <span>new</span> <span>RegExp</span><span>(</span><span><span>/</span><span>abc</span><span>/</span></span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>以上代码中，第二种只能传一个参数，返回原有正则的拷贝，不允许传第二个参数添加修饰符。</p>\n<div><pre><code><span>let</span> reg <span>=</span> <span>RegExp</span><span>(</span><span><span>/</span><span>abc</span><span>/</span></span><span>,</span> <span>'i'</span><span>)</span><span>;</span>  <span>//报错</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p><code>ES6</code>允许给<code>RegExp</code>构造函数传入第二个参数添加修饰符，即使第一个参数是正则，但会覆盖原有正则表达式的修饰符。</p>\n<div><pre><code><span>let</span> reg <span>=</span> <span>new</span> <span>RegExp</span><span>(</span><span><span>/</span><span>abc</span><span>/</span><span>g</span></span><span>,</span> i<span>)</span><span>.</span>flags  <span>//'i'</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>新增<code>flags</code>属性，返回正则表达式的修饰符。</p>\n<div><pre><code><span>//ES5的source属性</span>\n<span>/</span>abc<span>/</span>i<span>.</span>source  <span>//'abc'</span>\n\n<span>//ES6的flags属性</span>\n<span>/</span>abc<span>/</span>i<span>.</span>flags   <span>//'i'</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"数值相关\" tabindex=\"-1\"> 数值相关</h2>\n<h3 id=\"number对象扩展\" tabindex=\"-1\"> Number对象扩展</h3>\n<p><code>ES6</code>在<code>Number</code>对象上提供了新的方法。</p>\n<p><code>Number.isFinite()</code>判断是否为有限数值。</p>\n<div><pre><code>Number<span>.</span><span>isFinite</span><span>(</span><span>'1'</span><span>)</span>   <span>//false</span>\nNumber<span>.</span><span>isFinite</span><span>(</span><span>NaN</span><span>)</span>   <span>//false</span>\nNumber<span>.</span><span>isFinite</span><span>(</span><span>1.01</span><span>)</span>  <span>//true</span>\nNumber<span>.</span><span>isFinite</span><span>(</span><span>Infinity</span><span>)</span>  <span>//false</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p><code>Number.isNaN()</code>检测一个值是否为<code>NaN</code>，只有<code>NaN</code>才会返回<code>true</code>，其他值一律返回<code>false</code>。</p>\n<blockquote>\n<p>全局方法<code>isFinite()</code>和<code>isNaN()</code>会将传入的值转成数字类型再判断，<code>Number.isFinite()</code>和<code>Number.isNaN()</code>方法参数必须是数值类型，否则直接返回<code>false</code>。</p>\n</blockquote>\n<div><pre><code><span>isNaN</span><span>(</span><span>'NaN'</span><span>)</span>          <span>//true</span>\nNumber<span>.</span><span>isNaN</span><span>(</span><span>'NaN'</span><span>)</span>   <span>//false</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p><code>ES6</code>将全局方法<code>parseInt()</code>和<code>parseFloat()</code>放到<code>Number</code>对象上，行为不变。</p>\n<p><code>Number.isInteger()</code>用来判断一个数是否为整数。</p>\n<blockquote>\n<p>小数和整数采用相同的存储方式，小数点后全为零也为整数。</p>\n</blockquote>\n<div><pre><code>Number<span>.</span><span>isInteger</span><span>(</span><span>2</span><span>)</span>    <span>//true</span>\nNumber<span>.</span><span>isInteger</span><span>(</span><span>2.0</span><span>)</span>  <span>//true</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h3 id=\"math对象扩展\" tabindex=\"-1\"> Math对象扩展</h3>\n<p><code>Math.trunc()</code>方法返回数值的整数部分。</p>\n<div><pre><code>Math<span>.</span><span>trunc</span><span>(</span><span>1.1</span><span>)</span>     <span>//1</span>\nMath<span>.</span><span>trunc</span><span>(</span><span>-</span><span>1.1</span><span>)</span>    <span>//-1</span>\nMath<span>.</span><span>trunc</span><span>(</span><span>'1.1'</span><span>)</span>   <span>//1</span>\nMath<span>.</span><span>trunc</span><span>(</span><span>'a'</span><span>)</span>     <span>//NaN</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>可以使用<code>Math.floor()</code>和<code>Math.ceil()</code>方法模拟<code>Math.trunc()</code>。</p>\n<div><pre><code>Math<span>.</span>trunc <span>=</span> Math<span>.</span>trunc <span>||</span> <span>function</span><span>(</span><span>x</span><span>)</span> <span>{</span>\n  <span>return</span> x <span>&lt;</span> <span>0</span> <span>?</span> Math<span>.</span><span>ceil</span><span>(</span>x<span>)</span> <span>:</span> Math<span>.</span><span>floor</span><span>(</span>x<span>)</span><span>;</span>\n<span>}</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p><code>ES6</code>新增了<strong>三角函数</strong>：</p>\n<ul>\n<li><code>Math.sinh(x)</code> 返回x的双曲正弦</li>\n<li><code>Math.cosh(x)</code> 返回x的双曲余弦</li>\n<li><code>Math.tanh(x)</code> 返回x的双曲正切</li>\n<li><code>Math.asinh(x)</code> 返回x的反双曲正弦</li>\n<li><code>Math.acosh(x)</code> 返回x的反双曲余弦</li>\n<li><code>Math.atanh(x)</code> 返回x的反双曲正切</li>\n</ul>\n<h3 id=\"指数运算符\" tabindex=\"-1\"> 指数运算符</h3>\n<p><code>ES6</code>新增了指数运算符<code>**</code>。</p>\n<div><pre><code><span>let</span> a <span>=</span> <span>2</span><span>;</span>\na <span>=</span> a<span>**</span><span>3</span><span>;</span>    <span>//8</span>\n<span>//可以简写成 a **= 3</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h2 id=\"函数的扩展\" tabindex=\"-1\"> 函数的扩展</h2>\n<h3 id=\"基本用法\" tabindex=\"-1\"> 基本用法</h3>\n<p><code>ES6</code> 允许为函数的参数设置<strong>默认值</strong>，即直接写在参数定义的后面。使用默认值时，不能有同名参数。</p>\n<div><pre><code><span>function</span> <span>(</span><span>x <span>=</span> <span>1</span></span><span>)</span> <span>{</span><span>}</span>\n<span>function</span> <span>(</span><span>x<span>,</span> x<span>=</span><span>1</span></span><span>)</span> <span>{</span><span>}</span>   <span>//报错</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>默认参数不是传值，而是每次都重新计算。</p>\n<div><pre><code><span>let</span> y <span>=</span> <span>10</span><span>;</span>\n<span>function</span> <span>fn</span> <span>(</span><span>x <span>=</span> y<span>+</span><span>1</span></span><span>)</span> <span>{</span>\n    console<span>.</span><span>log</span><span>(</span>x<span>)</span><span>;</span>\n<span>}</span>\n<span>fn</span><span>(</span><span>)</span><span>;</span>  <span>//11;</span>\ny<span>++</span><span>;</span>\n<span>fn</span><span>(</span><span>)</span><span>;</span>  <span>//12;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>函数参数是默认声明的，不能用<code>let</code>或<code>const</code>再次声明，可以用<code>var</code>再次声明。</p>\n<div><pre><code><span>function</span> <span>(</span><span>x</span><span>)</span> <span>{</span>\n    <span>let</span> x <span>=</span> <span>1</span><span>;</span>    <span>//报错</span>\n    <span>var</span> x <span>=</span> <span>1</span><span>;</span>    <span>//正常</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>函数默认值与解构赋值默认值结合使用。</p>\n<div><pre><code><span>//只使用解构赋值默认值</span>\n<span>function</span> <span>fn</span> <span>(</span><span><span>{</span>a<span>,</span> b <span>=</span> <span>2</span><span>}</span></span><span>)</span> <span>{</span>\n    console<span>.</span><span>log</span> <span>(</span>a<span>,</span> b<span>)</span><span>;</span>\n<span>}</span>\n<span>fn</span> <span>(</span><span>{</span><span>a</span><span>:</span><span>1</span><span>}</span><span>)</span><span>;</span>   <span>//1, 2</span>\n<span>fn</span> <span>(</span><span>{</span><span>a</span><span>:</span><span>1</span><span>,</span> <span>b</span><span>:</span><span>3</span><span>}</span><span>)</span><span>;</span>   <span>//1, 3</span>\n<span>fn</span> <span>(</span><span>)</span><span>;</span>   <span>//报错</span>\n\n<span>//使用解构赋值默认值和函数参数默认值</span>\n<span>function</span> <span>fn</span> <span>(</span><span><span>{</span>a<span>,</span> b <span>=</span> <span>2</span><span>}</span> <span>=</span> <span>{</span><span>}</span></span><span>)</span> <span>{</span>\n    console<span>.</span><span>log</span> <span>(</span>a<span>,</span> b<span>)</span><span>;</span>\n<span>}</span>\n<span>fn</span><span>(</span><span>)</span>   <span>//undefined, 2</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>函数默认值参数不是最后一个参数，则不能省略，可以用<code>undefined</code>代替，不能用<code>null</code>代替。</p>\n<div><pre><code><span>function</span> <span>fn</span> <span>(</span><span>x<span>,</span> y<span>=</span><span>1</span><span>,</span> z</span><span>)</span> <span>{</span>\n    console<span>.</span><span>log</span><span>(</span>x<span>,</span> y<span>,</span> z<span>)</span><span>;</span>\n<span>}</span><span>;</span>\n<span>fn</span><span>(</span><span>1</span><span>,</span><span>2</span><span>)</span>   <span>//1,2,undefined</span>\n<span>fn</span><span>(</span><span>1</span><span>,</span><span>undefined</span><span>,</span><span>2</span><span>)</span><span>;</span>  <span>//1,1,2</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>将函数参数默认值设成<code>undefined</code>表示此参数可以省略。</p>\n<div><pre><code><span>function</span> <span>fn</span> <span>(</span><span>x<span>=</span><span>undefined</span><span>,</span> y</span><span>)</span> <span>{</span><span>}</span>\n<span>fn</span><span>(</span><span>,</span><span>2</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h3 id=\"length属性\" tabindex=\"-1\"> length属性</h3>\n<p>指定了默认值以后，函数的<code>length</code>属性，将返回没有指定默认值的参数个数。如果设置了默认值的参数不是尾参数，那么<code>length</code>属性也不再计入后面的参数。</p>\n<div><pre><code><span>function</span> <span>fn</span> <span>(</span><span>x<span>,</span> y<span>=</span><span>1</span><span>,</span> z</span><span>)</span> <span>{</span><span>}</span><span>;</span>\n<span>fn</span><span>(</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>)</span><span>.</span>length<span>;</span>    <span>//1</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h3 id=\"函数参数作用域\" tabindex=\"-1\"> 函数参数作用域</h3>\n<p>一旦设置了参数的默认值，函数进行声明初始化时，参数会形成一个单独的作用域（context）与函数内部不是同一个作用域。等到初始化结束，这个作用域就会消失。这种语法行为，在不设置参数默认值时，是不会出现的。</p>\n<div><pre><code><span>var</span> x <span>=</span> <span>1</span><span>;</span>\n<span>function</span> <span>f</span><span>(</span><span>x<span>,</span> y <span>=</span> x</span><span>)</span> <span>{</span>\n  console<span>.</span><span>log</span><span>(</span>y<span>)</span><span>;</span>\n<span>}</span>\n<span>f</span><span>(</span><span>2</span><span>)</span> <span>// 2</span>\n\n<span>//参数作用域如下：</span>\n<span>{</span>\n    <span>let</span> x <span>=</span> <span>2</span><span>;</span>\n    <span>let</span> y <span>=</span> x<span>;</span>    \n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"rest参数\" tabindex=\"-1\"> rest参数</h3>\n<p><code>ES6</code> 引入 <code>rest</code> 参数（形式为<code>...变量名</code>），用于获取函数的多余参数，<code>rest</code> 参数搭配的变量是一个数组，该变量将多余的参数放入数组中。<code>...变量</code>后不能再有参数，否则报错。</p>\n<p>函数的<code>length</code>属性不包括<code>rest</code>参数。</p>\n<div><pre><code><span>function</span> <span>fn</span><span>(</span><span>x<span>,</span> <span>...</span>rest</span><span>)</span> <span>{</span>\n    console<span>.</span><span>log</span><span>(</span>Array<span>.</span><span>isArray</span><span>(</span>rest<span>)</span><span>)</span><span>;</span>\n    console<span>.</span><span>log</span><span>(</span>rest<span>)</span><span>;</span>\n<span>}</span><span>;</span>\n<span>fn</span><span>(</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>)</span><span>.</span>length<span>;</span>  <span>//1</span>\n<span>//true</span>\n<span>//[2,3]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>从 <code>ES5</code> 开始，函数内部可以设定为严格模式。<code>ES7</code>规定只要函数参数使用了默认值、解构赋值、或者扩展运算符，那么函数内部就不能显式设定为严格模式，否则会报错。</p>\n<h3 id=\"name属性\" tabindex=\"-1\"> name属性</h3>\n<p>函数的<code>name</code>属性，返回该函数的函数名。如果将一个匿名函数赋值给一个变量，<code>ES5</code> 的<code>name</code>属性，会返回空字符串，而 <code>ES6</code> 的<code>name</code>属性会返回实际的函数名。</p>\n<div><pre><code><span>let</span> <span>fn</span> <span>=</span> <span>(</span><span>)</span> <span>=></span> <span>{</span><span>}</span>\n\n<span>//es5</span>\nfn<span>.</span>name  <span>//''</span>\n\n<span>//es6</span>\nfn<span>.</span>name  <span>//'fn'</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>如果将一个具名函数赋值给一个变量，则 <code>ES5</code> 和 <code>ES6</code> 的<code>name</code>属性都返回这个具名函数原本的名字。</p>\n<div><pre><code><span>let</span> <span>fn</span> <span>=</span> <span>function</span> <span>a</span><span>(</span><span>)</span> <span>{</span><span>}</span><span>;</span>\n<span>//es5 es6</span>\nfn<span>.</span>name    <span>//'a'</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h3 id=\"箭头函数\" tabindex=\"-1\"> 箭头函数</h3>\n<ul>\n<li>函数体内的<code>this</code>对象，就是定义时所在的对象，而不是使用时所在的对象。</li>\n<li>不可以当作构造函数，也就是说，不可以使用<code>new</code>命令，否则会抛出一个错误。</li>\n<li>不可以使用<code>arguments</code>对象，该对象在函数体内不存在。如果要用，可以用 <code>rest</code> 参数代替。</li>\n<li>不可以使用<code>yield</code>命令，因此箭头函数不能用作 <code>Generator</code> 函数。</li>\n</ul>\n<p>箭头函数根本没有自己的<code>this</code>，导致内部的<code>this</code>就是外层代码块的<code>this</code>。</p>\n<p>除了<code>this</code>，以下三个变量在箭头函数之中也是不存在的，指向外层函数的对应变量：<code>arguments</code>、<code>super</code>、<code>new.target</code>。</p>\n<p>不能用<code>call()</code>、<code>apply()</code>、<code>bind()</code>这些方法去改变this的指向。</p>\n<h2 id=\"数组的扩展\" tabindex=\"-1\"> 数组的扩展</h2>\n<h3 id=\"扩展运算符\" tabindex=\"-1\"> 扩展运算符</h3>\n<p>扩展运算符用三个点号表示，功能是把数组或类数组对象展开成一系列用逗号隔开的值（数组）,和...rest相反。</p>\n<p>扩展运算符后面还可以放置表达式。</p>\n<div><pre><code><span>let</span> x <span>=</span> <span>1</span><span>;</span>\n<span>...</span><span>(</span>x <span>></span> <span>0</span> <span>?</span> <span>[</span><span>'a'</span><span>,</span><span>'b'</span><span>]</span> <span>:</span> <span>[</span><span>]</span><span>)</span>   <span>//'a','b'</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>如果扩展运算符后面是一个空数组，则不产生任何效果。</p>\n<div><pre><code><span>[</span><span>...</span><span>[</span><span>]</span><span>,</span> <span>1</span><span>]</span>  <span>//[1]</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>扩展运算符可以展开数组，所以不再需要apply方法，将数组转为函数的参数。</p>\n<div><pre><code>Math<span>.</span><span>max</span><span>.</span><span>apply</span><span>(</span><span>null</span><span>,</span> <span>[</span><span>14</span><span>,</span> <span>3</span><span>,</span> <span>77</span><span>]</span><span>)</span>\n\n<span>// ES6 的写法</span>\nMath<span>.</span><span>max</span><span>(</span><span>...</span><span>[</span><span>14</span><span>,</span> <span>3</span><span>,</span> <span>77</span><span>]</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>扩展运算符可用于复制数组，合并数组。</p>\n<div><pre><code><span>let</span> arr1 <span>=</span> <span>[</span><span>1</span><span>,</span><span>2</span><span>]</span><span>;</span>\n\n<span>//ES5</span>\n<span>let</span> arr2 <span>=</span> arr1<span>.</span><span>concat</span><span>(</span><span>)</span><span>;</span>\n\n<span>//ES6</span>\n<span>let</span> arr2 <span>=</span> <span>[</span><span>...</span>arr1<span>]</span><span>;</span>\n\n<span>//ES6</span>\n<span>let</span> <span>[</span><span>...</span>arr2<span>]</span> <span>=</span> arr1<span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>扩展运算符还可以将字符串转为真正的数组。</p>\n<div><pre><code><span>[</span><span>...</span><span>'hello'</span><span>]</span>\n<span>// [ \"h\", \"e\", \"l\", \"l\", \"o\" ]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>任何 <code>Iterator</code> 接口的对象, 都可以用扩展运算符转为真正的数组。</p>\n<p>通过 <code>push</code> 函数，将一个数组添加到另一个数组的尾部。</p>\n<div><pre><code><span>let</span> arr1 <span>=</span> <span>[</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>]</span><span>;</span>\n<span>let</span> arr2 <span>=</span> <span>[</span><span>4</span><span>,</span><span>5</span><span>]</span><span>;</span>\narr1<span>.</span><span>push</span><span>(</span><span>...</span>arr2<span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>扩展运算符其他应用: <strong>复制数组</strong>，<strong>合并数组</strong>，<strong>展开字符串</strong>(有Iterato接口的对象)，****</p>\n<div><pre><code><span>let</span> arr <span>=</span> <span>[</span><span>1</span><span>,</span><span>2</span><span>]</span><span>;</span>\n\n<span>let</span> arr1 <span>=</span> <span>[</span><span>...</span>arr<span>]</span><span>;</span>  <span>//复制数组</span>\n<span>let</span> arr2 <span>=</span> <span>[</span><span>...</span>arr<span>,</span> <span>...</span><span>[</span><span>3</span><span>,</span><span>4</span><span>]</span><span>]</span><span>;</span>   <span>//合并数组</span>\n<span>let</span> arr3 <span>=</span> <span>[</span><span>...</span><span>'hello'</span><span>]</span><span>;</span>   <span>//展开字符串</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"array-from\" tabindex=\"-1\"> Array.from()</h3>\n<p><code>Array.from</code>方法用于将两类对象转为真正的数组：类似数组的对象和可遍历（<code>iterable</code>）的对象（包括 <code>ES6</code> 新增的数据结构 <code>Set</code> 和 <code>Map</code>）。<a href=\"https://link.segmentfault.com/?enc=7TBM4qWk0KvtKHeEfNIU3w%3D%3D.%2BOpU5EeurIhyb8WliOadB0lXgsBJVbhY711Ce9SUdBJZQDSXXbEAM5bKZrs1jim5HdBHQ%2B9nEkasCiMSTYwRW42mOBSmnEngEhWrN%2FLmuge01wDlT86RrImxi%2F6teelWP9zk%2BTVV%2BIeXaqfI2oaxgz9Dx2zjUHDwv86hznUhYVj79HYNdyDCyJTOp1zBPYf5\" target=\"_blank\" rel=\"noopener noreferrer\">将类数组转成数组</a></p>\n<div><pre><code><span>let</span> arrayLike <span>=</span> <span>{</span>\n    <span>'0'</span><span>:</span> <span>'a'</span><span>,</span>\n    <span>'1'</span><span>:</span> <span>'b'</span><span>,</span>\n    <span>'2'</span><span>:</span> <span>'c'</span><span>,</span>\n    <span>length</span><span>:</span> <span>3</span>\n<span>}</span><span>;</span>\n\n<span>// ES5的写法</span>\n<span>var</span> arr1 <span>=</span> <span>[</span><span>]</span><span>.</span><span>slice</span><span>.</span><span>call</span><span>(</span>arrayLike<span>)</span><span>;</span> <span>// ['a', 'b', 'c']</span>\n\n<span>// ES6的写法</span>\n<span>let</span> arr2 <span>=</span> Array<span>.</span><span>from</span><span>(</span>arrayLike<span>)</span><span>;</span> <span>// ['a', 'b', 'c']</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>只要有<code>length</code>属性的对象就叫做类似数组的对象，就可以被转化。</p>\n<div><pre><code><span>let</span> obj <span>=</span> <span>{</span><span>length</span><span>:</span> <span>2</span><span>}</span>\nArray<span>.</span><span>form</span><span>(</span>obj<span>)</span>    <span>/</span><span>/</span><span>[</span><span>undefined</span><span>,</span> <span>undefined</span><span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>对于还没有部署该方法的浏览器，可以用 <code>Array.prototype.slice</code> 方法替代。</p>\n<div><pre><code><span>const</span> toArray <span>=</span> <span>(</span><span>(</span><span>)</span> <span>=></span>\n  Array<span>.</span>from <span>?</span> Array<span>.</span><span>from</span> <span>:</span> <span>obj</span> <span>=></span> <span>[</span><span>]</span><span>.</span><span>slice</span><span>.</span><span>call</span><span>(</span>obj<span>)</span>\n<span>)</span><span>(</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>实际应用中，常见的类似数组的对象是 DOM 操作返回的 <code>NodeList</code> 集合，以及函数内部的 <code>arguments</code> 对象。<code>Array.form()</code> 都可以转换。</p>\n<p><code>Array.from</code> 还可以接受第二个参数，作用类似于数组的 <code>map</code> 方法，用来对每个元素进行处理，将处理后的值放入返回的数组。如果 <code>map</code> 函数里面用到了 <code>this</code> 关键字，还可以传入 <code>Array.from</code> 的第三个参数，用来绑定 <code>this</code>。</p>\n<div><pre><code>Array<span>.</span><span>from</span><span>(</span><span>[</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>]</span><span>,</span> <span>(</span><span>x</span><span>)</span> <span>=></span> x <span>*</span> x<span>)</span><span>;</span>\n<span>//等同于</span>\nArray<span>.</span><span>from</span><span>(</span><span>[</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>]</span><span>)</span><span>.</span><span>map</span><span>(</span><span>x</span> <span>=></span> x <span>*</span> x<span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>如果参数是一个真正的数组，<code>Array.from</code> 会返回一个一模一样的新数组。</p>\n<div><pre><code>Array<span>.</span><span>from</span><span>(</span><span>[</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>]</span><span>)</span>   <span>//[1,2,3]</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h3 id=\"array-of\" tabindex=\"-1\"> Array.of()</h3>\n<p><code>Array.of</code>方法用于将一组值，转换为数组。</p>\n<div><pre><code>Array<span>.</span><span>of</span><span>(</span><span>3</span><span>,</span><span>4</span><span>)</span> <span>// [3,4]</span>\nArray<span>.</span><span>of</span><span>(</span><span>2</span><span>)</span>   <span>// [2]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>和<code>Array()</code>方法不同，传入一个值时，表示数组的长度。</p>\n<div><pre><code><span>Array</span><span>(</span><span>2</span><span>)</span>  <span>//[undefinde, undefined]</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h3 id=\"find-和findindex\" tabindex=\"-1\"> find()和findIndex()</h3>\n<p><code>find</code> 方法找出第一个符合条件的数组成员。它的参数是一个回调函数，所有数组成员依次执行该回调函数，直到找出第一个返回值为 <code>true</code> 的成员，然后返回该成员。如果没有符合条件的成员，则返回 <code>undefined</code>。</p>\n<div><pre><code><span>[</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>]</span><span>.</span><span>find</span><span>(</span><span>v</span> <span>=></span> v<span>></span><span>2</span><span>)</span><span>;</span>   <span>//3</span>\n\n<span>[</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>]</span><span>.</span><span>find</span><span>(</span><span>(</span><span>v<span>,</span> i<span>,</span> arr</span><span>)</span> <span>=></span> <span>{</span>\n    <span>return</span> v<span>></span><span>2</span>\n<span>}</span><span>)</span><span>;</span>   \n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>数组实例的 <code>findIndex</code> 方法的用法与 <code>find</code> 方法非常类似，返回第一个符合条件的数组成员的位置，如果所有成员都不符合条件，则返回-1。</p>\n<p>这两个方法都可以接受第二个参数，用来绑定回调函数的 <code>this</code> 对象。</p>\n<h3 id=\"fill-方法\" tabindex=\"-1\"> fill() 方法</h3>\n<p><code>fill</code> 方法使用给定值，填充一个数组。还可以接受第二个和第三个参数，用于指定填充的起始位置和结束位置。</p>\n<div><pre><code><span>[</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>]</span><span>.</span><span>fill</span><span>(</span><span>'a'</span><span>)</span><span>;</span>  <span>//['a', 'a', 'a']</span>\n<span>[</span><span>1</span><span>,</span><span>2</span><span>,</span><span>3</span><span>,</span><span>4</span><span>,</span><span>5</span><span>]</span><span>.</span><span>fill</span><span>(</span><span>'a'</span><span>,</span> <span>2</span><span>,</span> <span>4</span><span>)</span><span>;</span>   <span>//[1, 2, 'a', 'a', 5]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><blockquote>\n<p>如果填充的类型为对象，那么被赋值的是同一个内存地址的对象，而不是深拷贝对象。</p>\n</blockquote>\n<div><pre><code><span>let</span> arr <span>=</span> <span>new</span> <span>Array</span><span>(</span><span>2</span><span>)</span><span>.</span><span>fill</span><span>(</span><span>{</span><span>name</span><span>:</span> <span>'Jim'</span><span>}</span><span>)</span><span>;</span>\narr<span>[</span><span>0</span><span>]</span><span>.</span>name <span>=</span> <span>'Tim'</span><span>;</span>\n\n<span>// [{name: 'Tim'}, {name: 'Tim'}]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><h3 id=\"keys-values-entries-方法\" tabindex=\"-1\"> keys(), values(), entries() 方法</h3>\n<p><code>keys()</code> 是对键名的遍历，<code>values()</code> 是对键值的遍历，<code>entries()</code> 是对键值对的遍历。<code>keys(), values(), entries()</code> 返回一个遍历器对象。可以用 <code>for...of</code> 循环进行遍历。</p>\n<h3 id=\"includes-方法\" tabindex=\"-1\"> includes() 方法</h3>\n<p><code>includes()</code> 判断数组是否包含给定的值，返回布尔值，<code>NaN</code> 也能实现。它还有第二个参数，表示查找的起始位置，为负数则表示从后往前。\n而 <code>indexOf()</code> 方法对 <code>NaN</code> 无效，会返回-1；</p>\n<blockquote>\n<p>includes 为 ES2016 引入的方法。</p>\n</blockquote>\n<p>相比于 indexOf，返回的是元素第一次出现的位置，再比较是否等于 -1，内部使用 === 判断，对 NaN 不适用。</p>\n<h3 id=\"数组的空位\" tabindex=\"-1\"> 数组的空位</h3>\n<p>数组的空位指，数组的某一个位置没有任何值。</p>\n<div><pre><code><span>Array</span><span>(</span><span>3</span><span>)</span><span>;</span>  <span>//[,,]</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>ES5 对空位的处理不一致。大多数情况下会被忽略。</p>\n<ul>\n<li>forEach(), filter(), reduce(), every(), some() 会跳过空位。</li>\n<li>map() 会跳过空位，但会保留这个值。</li>\n<li>join() 和 toString() 会将空位视为 undefined ，而 undefine 和 null 会被处理成空字符串。</li>\n</ul>\n<div><pre><code><span>// forEach方法</span>\n<span>[</span><span>,</span><span>'a'</span><span>]</span><span>.</span><span>forEach</span><span>(</span><span>(</span><span>x<span>,</span>i</span><span>)</span> <span>=></span> console<span>.</span><span>log</span><span>(</span>i<span>)</span><span>)</span><span>;</span> <span>// 1</span>\n\n<span>// filter方法</span>\n<span>[</span><span>'a'</span><span>,</span><span>,</span><span>'b'</span><span>]</span><span>.</span><span>filter</span><span>(</span><span>x</span> <span>=></span> <span>true</span><span>)</span> <span>// ['a','b']</span>\n\n<span>// every方法</span>\n<span>[</span><span>,</span><span>'a'</span><span>]</span><span>.</span><span>every</span><span>(</span><span>x</span> <span>=></span> x<span>===</span><span>'a'</span><span>)</span> <span>// true</span>\n\n<span>// reduce方法</span>\n<span>[</span><span>1</span><span>,</span><span>,</span><span>2</span><span>]</span><span>.</span><span>reduce</span><span>(</span><span>(</span><span>x<span>,</span>y</span><span>)</span> <span>=></span> <span>return</span> x<span>+</span>y<span>)</span> <span>// 3</span>\n\n<span>// some方法</span>\n<span>[</span><span>,</span><span>'a'</span><span>]</span><span>.</span><span>some</span><span>(</span><span>x</span> <span>=></span> x <span>!==</span> <span>'a'</span><span>)</span> <span>// false</span>\n\n<span>// map方法</span>\n<span>[</span><span>,</span><span>'a'</span><span>]</span><span>.</span><span>map</span><span>(</span><span>x</span> <span>=></span> <span>1</span><span>)</span> <span>// [,1]</span>\n\n<span>// join方法</span>\n<span>[</span><span>,</span><span>'a'</span><span>,</span><span>undefined</span><span>,</span><span>null</span><span>]</span><span>.</span><span>join</span><span>(</span><span>'#'</span><span>)</span> <span>// \"#a##\"</span>\n\n<span>// toString方法</span>\n<span>[</span><span>,</span><span>'a'</span><span>,</span><span>undefined</span><span>,</span><span>null</span><span>]</span><span>.</span><span>toString</span><span>(</span><span>)</span> <span>// \",a,,\"</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>ES6 会将空位转为 undefined。</p>\n<p>Array.from 方法、扩展运算符（...）、entries()、keys()、values()、find() 和 findIndex() 会将数组的空位，转为 undefined ；for···of 会遍历空位。</p>\n<h2 id=\"对象的扩展\" tabindex=\"-1\"> 对象的扩展</h2>\n<h3 id=\"属性简写\" tabindex=\"-1\"> 属性简写</h3>\n<p>直接写入变量和函数，作为对象的属性和方法。</p>\n<div><pre><code><span>let</span> a <span>=</span> <span>1</span><span>;</span>\n<span>let</span> obj <span>=</span> <span>{</span>\n  a<span>,</span>\n  <span>method</span><span>(</span><span>)</span> <span>{</span>\n    <span>return</span> <span>this</span><span>.</span>a\n  <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>这种写法用于函数的返回值。</p>\n<div><pre><code><span>function</span> <span>getPoint</span><span>(</span><span>)</span> <span>{</span>\n  <span>const</span> x <span>=</span> <span>1</span><span>;</span>\n  <span>const</span> y <span>=</span> <span>10</span><span>;</span>\n  <span>return</span> <span>{</span>x<span>,</span> y<span>}</span><span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"属性名表达式\" tabindex=\"-1\"> 属性名表达式</h3>\n<p>定义对象有两种方法。</p>\n<div><pre><code>obj<span>.</span>a <span>=</span> <span>1</span><span>;</span>\nobj<span>[</span><span>'c'</span> <span>+</span> <span>'d'</span><span>]</span> <span>=</span> <span>2</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>如果使用字面量方式定义对象（使用大括号），在 ES5 中只能使用方法一。ES6 允许字面量定义对象时，用方法二（表达式）作为对象的属性名，即把表达式放在方括号内。</p>\n<div><pre><code><span>let</span> lastWord <span>=</span> <span>'last word'</span><span>;</span>\n\n<span>const</span> a <span>=</span> <span>{</span>\n  <span>'first word'</span><span>:</span> <span>'hello'</span><span>,</span>\n   <span>[</span>lastWord<span>]</span> <span>:</span> <span>'world'</span>\n<span>}</span><span>;</span>\n\na<span>[</span><span>'first word'</span><span>]</span> <span>// \"hello\"</span>\na<span>[</span>lastWord<span>]</span> <span>// \"world\"</span>\na<span>[</span><span>'last word'</span><span>]</span> <span>// \"world\"</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>属性名表达式如果是一个对象，默认情况下会自动将对象转为字符串[object Object]。</p>\n<div><pre><code><span>let</span> obj1 <span>=</span> <span>{</span>\n  <span>a</span><span>:</span> <span>1</span>\n<span>}</span><span>;</span>\n<span>let</span> obj2 <span>=</span> <span>{</span>\n  <span>b</span><span>:</span> <span>2</span>\n<span>}</span>\n<span>let</span> json <span>=</span> <span>{</span>\n  <span>[</span>obj1<span>]</span> <span>:</span> <span>'value1'</span><span>,</span>\n  <span>[</span>obj2<span>]</span> <span>:</span> <span>'value2'</span>\n<span>}</span>\n\njson  <span>//Object {[object Object]: 'value2'}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>[obj1] 会把 [obj2] 覆盖掉，而 json 最后只有一个 [object Object] 属性。</p>\n<h3 id=\"object-is\" tabindex=\"-1\"> <a href=\"http://Object.is\" target=\"_blank\" rel=\"noopener noreferrer\">Object.is</a>()</h3>\n<p>为了解决相等运算符（<mark>）和严格相等运算符（</mark>=）的缺点，<a href=\"http://Object.is\" target=\"_blank\" rel=\"noopener noreferrer\">Object.is</a> 用来比较两个值是否全等。</p>\n<div><pre><code><span>+</span><span>0</span> <span>===</span> <span>-</span><span>0</span> <span>//true</span>\n<span>NaN</span> <span>===</span> <span>NaN</span> <span>// false</span>\n\nObject<span>.</span><span>is</span><span>(</span><span>+</span><span>0</span><span>,</span> <span>-</span><span>0</span><span>)</span> <span>// false</span>\nObject<span>.</span><span>is</span><span>(</span><span>NaN</span><span>,</span> <span>NaN</span><span>)</span> <span>// true</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"object-assign\" tabindex=\"-1\"> Object.assign()</h3>\n<p>Object.assign 方法用于对象的合并，将源对象（source）的所有可枚举属性，复制到目标对象，属于浅拷贝。</p>\n<p>此方法的第一个参数是目标对象，后面的参数都是源对象。</p>\n<p>如果目标对象与源对象有同名属性，或多个源对象有同名属性，则后面的属性会覆盖前面的属性。</p>\n<div><pre><code><span>const</span> target <span>=</span> <span>{</span> <span>a</span><span>:</span> <span>1</span><span>,</span> <span>b</span><span>:</span> <span>1</span> <span>}</span><span>;</span>\n\n<span>const</span> source1 <span>=</span> <span>{</span> <span>b</span><span>:</span> <span>2</span><span>,</span> <span>c</span><span>:</span> <span>2</span> <span>}</span><span>;</span>\n<span>const</span> source2 <span>=</span> <span>{</span> <span>c</span><span>:</span> <span>3</span> <span>}</span><span>;</span>\n\nObject<span>.</span><span>assign</span><span>(</span>target<span>,</span> source1<span>,</span> source2<span>)</span><span>;</span>\ntarget <span>// {a:1, b:2, c:3}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>如果只有一个参数，Object.assign 会直接返回该参数。</p>\n<div><pre><code><span>const</span> obj <span>=</span> <span>{</span><span>a</span><span>:</span> <span>1</span><span>}</span><span>;</span>\nObject<span>.</span><span>assign</span><span>(</span>obj<span>)</span> <span>===</span> obj <span>// true</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>如果首参不是对象，则会先转成对象，然后返回，undefined 和 null 无法转成对象，报错。如果不是首参，只有字符串会以数组形式拷贝入目标对象，其他都不会产生效果。</p>\n<div><pre><code><span>typeof</span> Object<span>.</span><span>assign</span><span>(</span><span>2</span><span>)</span> <span>// \"object\"</span>\n<span>let</span> obj <span>=</span> <span>{</span><span>a</span><span>:</span> <span>1</span><span>}</span><span>;</span>\nObject<span>.</span><span>assign</span><span>(</span>obj<span>,</span> <span>undefined</span><span>)</span> <span>===</span> obj <span>// true</span>\nObject<span>.</span><span>assign</span><span>(</span>obj<span>,</span> <span>null</span><span>)</span> <span>===</span> obj <span>// true</span>\n\n<span>const</span> v1 <span>=</span> <span>'abc'</span><span>;</span>\n<span>const</span> v2 <span>=</span> <span>true</span><span>;</span>\n<span>const</span> v3 <span>=</span> <span>10</span><span>;</span>\n\n<span>const</span> obj <span>=</span> Object<span>.</span><span>assign</span><span>(</span><span>{</span><span>}</span><span>,</span> v1<span>,</span> v2<span>,</span> v3<span>)</span><span>;</span>\nconsole<span>.</span><span>log</span><span>(</span>obj<span>)</span><span>;</span> <span>// { \"0\": \"a\", \"1\": \"b\", \"2\": \"c\" }</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"属性的可枚举行\" tabindex=\"-1\"> 属性的可枚举行</h3>\n<p>对象的每个属性都有一个描述对象（Descriptor），用来控制该属性的行为。Object.getOwnPropertyDescriptor 方法可以获取该属性的描述对象。</p>\n<div><pre><code><span>let</span> obj <span>=</span> <span>{</span> <span>foo</span><span>:</span> <span>123</span> <span>}</span><span>;</span>\nObject<span>.</span><span>getOwnPropertyDescriptor</span><span>(</span>obj<span>,</span> <span>'foo'</span><span>)</span>\n<span>//  {</span>\n<span>//    value: 123,</span>\n<span>//    writable: true,</span>\n<span>//    enumerable: true,</span>\n<span>//    configurable: true</span>\n<span>//  }</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>描述对象的 enumerable 属性，称为”可枚举性“，如果该属性为 false，就表示某些操作会忽略当前属性。</p>\n<p>有四个操作会忽略 enumerable 为 false 的属性。</p>\n<ul>\n<li><code>for...in</code> 循环：只遍历对象自身的和继承的可枚举的属性。</li>\n<li><code>Object.keys()</code>：返回对象自身的所有可枚举的属性的键名。</li>\n<li><code>JSON.stringify()</code>：只串行化对象自身的可枚举的属性。</li>\n<li><code>Object.assign()</code>： 忽略 enumerable 为 false 的属性，只拷贝对象自身的可枚举的属性。</li>\n</ul>\n<h3 id=\"属性的遍历\" tabindex=\"-1\"> 属性的遍历</h3>\n<p><strong>for...in</strong> 循环遍历对象自身的和继承的可枚举属性（不含 Symbol 属性）。</p>\n<p><strong>Object.keys</strong> 返回一个数组，包括对象自身的（不含继承的）所有可枚举属性（不含 Symbol 属性）的键名。</p>\n<p><strong>Object.getOwnPropertyNames</strong> 返回一个数组，包含对象自身的所有属性（不含 Symbol 属性，但是包括不可枚举属性）的键名。</p>\n<p><strong>Object.getOwnPropertySymbols</strong> 返回一个数组，包含对象自身的所有 Symbol 属性的键名。</p>\n<p><strong>Reflect.ownKeys</strong> 返回一个数组，包含对象自身的所有键名，不管键名是 Symbol 或字符串，也不管是否可枚举。</p>\n<h3 id=\"proto-属性\" tabindex=\"-1\"> __ proto __属性</h3>\n<p>用来读取或设置当前对象的 <code>prototype</code> 对象。实现上，<code>__proto__</code>调用的是<code>Object.prototype.__proto__</code>。</p>\n<h3 id=\"object-keys-object-values-object-entries\" tabindex=\"-1\"> Object.keys(), Object.values(), Object.entries()</h3>\n<p>ES5 引入了 <code>Object.keys</code> 方法，返回一个数组，成员是参数对象自身的（不含继承的）所有可遍历（enumerable）属性的键名。</p>\n<p>ES6 引入了跟 <code>Object.keys</code> 配套的 <code>Object.values</code> 和 <code>Object.entries</code>，作为遍历一个对象的补充手段，供 <code>for...of</code> 循环使用。</p>\n<p><strong>Object.values()</strong> 方法返回一个数组，成员是参数对象自身的（不含继承的）所有可遍历（enumerable）属性的键值。</p>\n<p><strong>Object.entries()</strong> 方法返回一个数组，成员是参数对象自身的（不含继承的）所有可遍历（enumerable）属性的键值对数组。</p>\n<div><pre><code><span>const</span> obj <span>=</span> <span>{</span> <span>foo</span><span>:</span> <span>'bar'</span><span>,</span> <span>baz</span><span>:</span> <span>42</span> <span>}</span><span>;</span>\nObject<span>.</span><span>entries</span><span>(</span>obj<span>)</span>\n<span>// [ [\"foo\", \"bar\"], [\"baz\", 42] ]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h3 id=\"对象的扩展运算符\" tabindex=\"-1\"> 对象的扩展运算符</h3>\n<p>ES7 将扩展运算符引入了对象。</p>\n<p>可用于<strong>解构赋值</strong>：</p>\n<div><pre><code><span>let</span> <span>{</span> x<span>,</span> y<span>,</span> <span>...</span>z <span>}</span> <span>=</span> <span>{</span> <span>x</span><span>:</span> <span>1</span><span>,</span> <span>y</span><span>:</span> <span>2</span><span>,</span> <span>a</span><span>:</span> <span>3</span><span>,</span> <span>b</span><span>:</span> <span>4</span> <span>}</span><span>;</span>\nx <span>// 1</span>\ny <span>// 2</span>\nz <span>// { a: 3, b: 4 }</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>解构赋值不是最后一个参数，所以会报错。解构赋值要求等号右边是一个对象，否则报错。</p>\n<p>解构赋值的拷贝是浅拷贝，且不能复制继承自原型对象的属性。</p>\n<p>用于<strong>拷贝对象</strong> 和 <strong>合并对象</strong></p>\n<div><pre><code><span>let</span> z <span>=</span> <span>{</span> <span>a</span><span>:</span> <span>3</span><span>,</span> <span>b</span><span>:</span> <span>4</span> <span>}</span><span>;</span>\n<span>let</span> n <span>=</span> <span>{</span> <span>...</span>z <span>}</span><span>;</span>\nn <span>// { a: 3, b: 4 }</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>这等同于使用 <code>Object.assign</code> 方法。</p>\n<div><pre><code><span>let</span> ab <span>=</span> <span>{</span> <span>...</span>a<span>,</span> <span>...</span>b <span>}</span><span>;</span>\n<span>// 等同于</span>\n<span>let</span> ab <span>=</span> Object<span>.</span><span>assign</span><span>(</span><span>{</span><span>}</span><span>,</span> a<span>,</span> b<span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>与数组的扩展运算符一样，对象的扩展运算符后面可以跟表达式。</p>\n<div><pre><code><span>const</span> obj <span>=</span> <span>{</span>\n  <span>...</span><span>(</span>x <span>></span> <span>1</span> <span>?</span> <span>{</span><span>a</span><span>:</span> <span>1</span><span>}</span> <span>:</span> <span>{</span><span>}</span><span>)</span><span>,</span>\n  <span>b</span><span>:</span> <span>2</span><span>,</span>\n<span>}</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><h2 id=\"symbel\" tabindex=\"-1\"> Symbel</h2>\n<p>ES5 的对象属性名都是字符串，这容易造成属性名的冲突，为了保证每个属性的名字都是独一无二的，这样就从根本上防止属性名的冲突。这就是 ES6 引入Symbol的原因。</p>\n<p>它是 JavaScript 语言的第七种数据类型，前六种是：undefined、null、布尔值（Boolean）、字符串（String）、数值（Number）、对象（Object）。</p>\n<div><pre><code><span>let</span> s <span>=</span> <span>Symbel</span><span>(</span><span>)</span><span>;</span>\n<span>typeof</span> s\n<span>// 'Symbel'</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>s 是一个独一无二的值。</p>\n<p>Symbol 函数前不能使用 <code>new</code> 命令，否则会报错。这是因为生成的 Symbol 是一个原始类型的值，不是对象。也就是说，由于 Symbol 值不是对象，所以不能添加属性。基本上，它是一种类似于字符串的数据类型。</p>\n<p>Symbol 函数可以接受一个字符串作为参数，表示对 Symbol 实例的描述，主要是为了在控制台显示，或者转为字符串时，比较容易区分。</p>\n<div><pre><code><span>let</span> s1 <span>=</span> <span>Symbol</span><span>(</span><span>'foo'</span><span>)</span><span>;</span>\n\ns1 <span>// Symbol(foo)</span>\n\ns1<span>.</span><span>toString</span><span>(</span><span>)</span> <span>// \"Symbol(foo)\"</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>如果 Symbol 的参数是一个对象，就会调用该对象的toString方法，将其转为字符串，然后才生成一个 Symbol 值。</p>\n<p>Symbol 函数的参数只是表示对当前 Symbol 值的描述，因此相同参数的Symbol函数的返回值是不相等的。</p>\n<p>Symbol 值不能与其他类型的值进行运算，会报错。但是，Symbol 值可以显式转为字符串。也可以转为布尔值，但是不能转为数值。</p>\n<div><pre><code><span>let</span> sym <span>=</span> <span>Symbol</span><span>(</span><span>'My symbol'</span><span>)</span><span>;</span>\n\n<span>String</span><span>(</span>sym<span>)</span> <span>// 'Symbol(My symbol)'</span>\nsym<span>.</span><span>toString</span><span>(</span><span>)</span> <span>// 'Symbol(My symbol)'</span>\n\n<span>Boolean</span><span>(</span>sym<span>)</span> <span>// true</span>\n<span>!</span>sym  <span>// false</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"作为属性名\" tabindex=\"-1\"> 作为属性名</h3>\n<div><pre><code><span>let</span> mySymbol <span>=</span> <span>Symbol</span><span>(</span><span>)</span><span>;</span>\n\n<span>// 第一种写法</span>\n<span>let</span> a <span>=</span> <span>{</span><span>}</span><span>;</span>\na<span>[</span>mySymbol<span>]</span> <span>=</span> <span>'Hello!'</span><span>;</span>\n\n<span>// 第二种写法</span>\n<span>let</span> a <span>=</span> <span>{</span>\n  <span>[</span>mySymbol<span>]</span><span>:</span> <span>'Hello!'</span>\n<span>}</span><span>;</span>\n\n<span>// 第三种写法</span>\n<span>let</span> a <span>=</span> <span>{</span><span>}</span><span>;</span>\nObject<span>.</span><span>defineProperty</span><span>(</span>a<span>,</span> mySymbol<span>,</span> <span>{</span> <span>value</span><span>:</span> <span>'Hello!'</span> <span>}</span><span>)</span><span>;</span>\n\n<span>// 以上写法都得到同样结果</span>\na<span>[</span>mySymbol<span>]</span> <span>// \"Hello!\"</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>Symbol 值作为对象属性名时，不能用点运算符。</p>\n<p>在对象的内部，使用 Symbol 值定义属性时，Symbol 值必须放在方括号之中。</p>\n<h2 id=\"module模块\" tabindex=\"-1\"> Module模块</h2>\n<p><code>ES6</code> 模块通过<code>export</code>命令显式指定输出的代码，再通过<code>import</code>命令输入。使用模块自动采用严格模式。<a href=\"https://link.segmentfault.com/?enc=1gqS2d%2BHX2rNigzRaRiK9w%3D%3D.p%2F9KZRIufKJXjX29hQ8D27gL5UnNsPRc%2BdtMVanU71Ir975mR%2ByRyEs8MVq0EQyF%2Bk7QztHAKp%2Bm7S%2FJMlEEJmTYwf6XEvniadeVni7aMbk%3D\" target=\"_blank\" rel=\"noopener noreferrer\">严格模式详解</a></p>\n<h3 id=\"export\" tabindex=\"-1\"> export</h3>\n<p><code>export</code> 用于规定模块的对外接口，输出变量，函数，类。</p>\n<div><pre><code><span>//写法1</span>\n<span>export</span> <span>let</span> a <span>=</span> <span>1</span><span>;</span>\n<span>export</span> <span>function</span> <span>b</span> <span>(</span><span>)</span> <span>{</span><span>}</span><span>;</span>\n\n<span>//写法2</span>\n<span>let</span> a <span>=</span> <span>1</span><span>;</span>\n<span>function</span> <span>b</span> <span>(</span><span>)</span> <span>{</span><span>}</span><span>;</span>\n<span>export</span> <span>{</span>a<span>,</span> b<span>}</span><span>;</span>\n\n<span>//报错</span>\n<span>let</span> a <span>=</span> <span>1</span><span>;</span>\n<span>export</span> a<span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>通常输出的变量就是本来的名字，可以用 <code>as</code> 修改。</p>\n<div><pre><code><span>function</span> <span>a</span> <span>(</span><span>)</span> <span>{</span><span>}</span><span>;</span>\n<span>let</span> b <span>=</span> <span>1</span><span>;</span>\n\n<span>export</span> <span>{</span>\n    a <span>as</span> fnA<span>,</span>\n    b <span>as</span> vB\n<span>}</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><code>export</code>输出的接口和模块内部的变量是<strong>动态绑定</strong>关系，变量值改变，通过接口获取的值也相应改变。</p>\n<div><pre><code><span>//test.js</span>\n<span>export</span> <span>let</span> a <span>=</span> <span>1</span><span>;</span>\n<span>setTimeout</span><span>(</span><span>(</span><span>)</span> <span>=></span> a<span>=</span><span>2</span><span>,</span> <span>1000</span><span>)</span><span>;</span>\n\n<span>import</span> <span>{</span>a<span>}</span> <span>from</span> <span>'./test'</span>\n<span>//a = 1, 1s后变成2</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><code>export</code>必须处于<strong>模块顶层</strong>，如果处于块级作用域会报错。<code>import</code>也是如此。</p>\n<div><pre><code><span>function</span> <span>(</span><span>)</span> <span>{</span>\n    <span>export</span> <span>let</span> a <span>=</span> <span>1</span><span>;</span>  <span>//报错</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h3 id=\"import\" tabindex=\"-1\"> import</h3>\n<p>使用<code>import</code>加载模块。<a href=\"https://link.segmentfault.com/?enc=ARF3XMHuI%2B65E8pPDrk7tA%3D%3D.z7wzeodzC5kDDuFlv9x8LVD%2FI7kxCCFp8oA7SjOc62fEvwbbh9XR6qMyPeXKLTL5i2%2BOL0i9LkG9%2Bpjf85EwZjcyHtfwMs0CX9ju846bXXS1FajvjAB17YpsD952EJdn\" target=\"_blank\" rel=\"noopener noreferrer\">import - MDN</a></p>\n<div><pre><code><span>import</span> <span>{</span>a<span>,</span> b<span>}</span> <span>from</span> <span>'./test'</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p><code>import</code>后跟一个大括号，括号内指定需要导入的变量，变量名需对应。但可以通过<code>as</code>修改。</p>\n<div><pre><code><span>import</span> <span>{</span>a <span>as</span> vA<span>,</span> b <span>as</span> vB<span>}</span> <span>from</span> <span>'./test'</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p><code>import</code>后的<code>from</code>用来指定模块的路径，绝对路径或相对路径，<code>.js</code>可以省略。如果模块有配置文件，则不带路径。</p>\n<div><pre><code><span>import</span> react<span>,</span> <span>{</span>Component<span>}</span> <span>from</span> <span>'react'</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p><code>import</code>有<strong>提升效果</strong>，会提升到模块头部，先执行。</p>\n<p>由于<code>import</code>是静态执行，不能使用表达式和变量。比如<code>from</code>后的路径不能用一个变量代替。</p>\n<p><code>import</code>会执行所加载的模块，可以直接跟模块名。但多次加载相同模块只执行一次，<code>import</code>语句是单例模式。</p>\n<div><pre><code><span>import</span> <span>'module_name'</span><span>;</span>\n\n<span>import</span> <span>{</span>a<span>}</span> <span>from</span> <span>'./test'</span><span>;</span>\n<span>import</span> <span>{</span>b<span>}</span> <span>from</span> <span>'./test'</span><span>;</span>\n<span>//等同于</span>\n<span>import</span> <span>{</span>a<span>,</span>b<span>}</span> <span>from</span> <span>'./test'</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>模块整体加载：</p>\n<div><pre><code><span>import</span> <span>*</span> <span>as</span> myModule <span>from</span> <span>'./my_module.js'</span><span>;</span>\n<span>//以myModule为命名空间，在myMoudle下可以找到所有接口，不允许修改。</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>导入<strong>默认值</strong> ：</p>\n<div><pre><code><span>export</span> <span>default</span> <span>function</span> <span>(</span><span>)</span> <span>{</span><span>}</span><span>;</span>\n<span>import</span> fn <span>from</span> <span>'./test'</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><blockquote>\n<ul>\n<li>导入默认值可以使用任意名字代替输出值。</li>\n<li><code>import</code>后不用大括号。</li>\n<li><code>export default</code>后跟的变量名或函数名称在模块外部无效。</li>\n<li>一个模块只能有一个默认输出，<code>export default</code>只能使用一次。</li>\n<li><code>export default</code>表示将后面的值赋给<code>default</code>，再输出一个叫<code>default</code>的变量或函数。</li>\n<li><code>export default</code>后不能有变量声明语句。</li>\n</ul>\n</blockquote>\n<div><pre><code><span>//test.js</span>\n<span>function</span> <span>fn</span> <span>(</span><span>)</span> <span>{</span><span>}</span><span>;</span>\n<span>export</span> <span>default</span> fn<span>;</span>\n<span>//等同于</span>\n<span>export</span> <span>{</span>fn <span>as</span> <span>default</span><span>}</span><span>;</span>\n<span>import</span> <span>{</span><span>default</span> <span>as</span> foo<span>}</span> <span>from</span> <span>'./test'</span><span>;</span>\n<span>//等同于</span>\n<span>import</span> foo <span>from</span> <span>'./test'</span><span>;</span>\n<span>export</span> <span>default</span> <span>let</span> a <span>=</span> <span>1</span><span>;</span>  <span>//报错</span>\n<span>export</span> <span>default</span> <span>10</span><span>;</span>         <span>//正确</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><code>import</code>和<code>export</code>的<strong>复合写法</strong>:</p>\n<div><pre><code><span>export</span> <span>{</span>foo<span>,</span> fn<span>}</span> <span>from</span> <span>'module'</span><span>;</span>\n<span>//等同于</span>\n<span>import</span> <span>{</span>foo<span>,</span> fn<span>}</span> <span>from</span> <span>'module'</span><span>;</span>\n<span>export</span> <span>{</span>foo<span>,</span> fn<span>}</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><h3 id=\"模块在浏览器中加载\" tabindex=\"-1\"> 模块在浏览器中加载</h3>\n<p>加载<code>javascript</code>脚本使用<code>&lt;script&gt;</code>标签，可使用<code>defer</code>或<code>async</code>实现异步加载，<code>defer</code>会等到页面渲染完，其他脚本执行完再执行，<code>async</code>只要资源加载完就终断页面渲染立即执行，不能保证多个<code>async</code>脚本按顺序执行。</p>\n<p>在浏览器中可以使用<code>&lt;script&gt;</code>标签加载模块，但需要<code>type='module'</code>属性。</p>\n<div><pre><code><span><span><span>&lt;</span>script</span> <span>src</span><span><span>=</span><span>'</span>path/test.js<span>'</span></span> <span>type</span><span><span>=</span><span>'</span>module<span>'</span></span><span>></span></span><span><span><span>&lt;/</span>script</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>带有<code>type='module'</code>的<code>&lt;script&gt;</code>都是异步加载，等同于自动打开了<code>defer</code>属性，也可以加<code>async</code>属性，让模块加载完立即执行。</p>\n<p>也可以直接在<code>&lt;script&gt;</code>标签内加载模块。</p>\n<div><pre><code><span><span><span>&lt;</span>script</span> <span>type</span><span><span>=</span><span>'</span>module<span>'</span></span><span>></span></span>\n    import a from './test.js';\n<span><span><span>&lt;/</span>script</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div>",
      "date_published": "2022-06-26T00:00:00.000Z",
      "date_modified": "2022-06-15T06:57:48.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "改造BeanUtils优雅实现List数据拷贝",
      "url": "https://blog.ciberviler.top/dev/%E6%94%B9%E9%80%A0BeanUtils%E4%BC%98%E9%9B%85%E5%AE%9E%E7%8E%B0List%E6%95%B0%E6%8D%AE%E6%8B%B7%E8%B4%9D.html",
      "id": "https://blog.ciberviler.top/dev/%E6%94%B9%E9%80%A0BeanUtils%E4%BC%98%E9%9B%85%E5%AE%9E%E7%8E%B0List%E6%95%B0%E6%8D%AE%E6%8B%B7%E8%B4%9D.html",
      "content_html": "<h1 id=\"改造beanutils优雅实现list数据拷贝\" tabindex=\"-1\"> 改造BeanUtils优雅实现List数据拷贝</h1>\n<p>BeanUtils.copyProperties();确实为我们做了很多事情，虽然不能完美完成深拷贝，但是对于 po、vo、dto 的拷贝已经足够用了。但是其还是有一些不够完美的地方。</p>\n<p>不足几点如下：</p>\n<p><strong>①</strong>不能拷贝 list，而拷贝 list 的情况又大量存在，因此会有许多重复代码。</p>\n<div><pre><code><span>for</span> <span>(</span><span>S</span> source <span>:</span> sources<span>)</span> <span>{</span>\n    <span>T</span> target <span>=</span> <span>new</span> <span>T</span><span>(</span><span>)</span><span>;</span>\n    <span>copyProperties</span><span>(</span>source<span>,</span> target<span>)</span><span>;</span>\n    list<span>.</span><span>add</span><span>(</span>target<span>)</span><span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>②</strong>有一些简单的查询，仅仅需要转换一下 vo 也需要 new Vo()。</p>\n<div><pre><code><span>public</span> <span>Vo</span> <span>findById</span><span>(</span><span>Integer</span> id<span>)</span> <span>{</span>\n <span>Vo</span> vo <span>=</span> <span>new</span> <span>Vo</span><span>(</span><span>)</span><span>;</span>\n <span>Po</span> po <span>=</span> dao<span>.</span><span>findById</span><span>(</span>id<span>)</span><span>;</span>\n <span>copyProperties</span><span>(</span>po<span>,</span> vo<span>)</span><span>;</span>\n <span>return</span> vo<span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>③</strong>这种拷贝方式是没有返回值的，jdk8 支持 stream() 操作之后，支持不是很友好，不方便 lambda 表达式的使用，因此我们决定通过集成 BeanUtils 类，自己造一个方便用的轮子。</p>\n<p><strong>使用</strong></p>\n<p>我们将新创建一个轮子 BeanConvertUtils，使用如下，当我们要转换 po、vo 时，只需要：</p>\n<div><pre><code><span>// 使用前</span>\n<span>public</span> <span>Vo</span> <span>findById</span><span>(</span><span>Integer</span> id<span>)</span> <span>{</span>\n <span>Vo</span> vo <span>=</span> <span>new</span> <span>Vo</span><span>(</span><span>)</span><span>;</span>\n <span>Po</span> po <span>=</span> dao<span>.</span><span>findById</span><span>(</span>id<span>)</span><span>;</span>\n <span>copyProperties</span><span>(</span>po<span>,</span> vo<span>)</span><span>;</span>\n <span>return</span> vo<span>;</span>\n<span>}</span>\n\n<span>// 使用后</span>\n<span>public</span> <span>Vo</span> <span>findById</span><span>(</span><span>Integer</span> id<span>)</span> <span>{</span>\n <span>return</span> <span>BeanConvertUtils</span><span>.</span><span>converTo</span><span>(</span>dao<span>.</span><span>findById</span><span>(</span>id<span>)</span><span>,</span> <span>Vo</span><span>::</span><span>new</span><span>)</span><span>;</span>\n<span>}</span>\n\n<span>// 使用后，通过lambda表达式特殊处理个别字段</span>\n<span>public</span> <span>Vo</span> <span>findById</span><span>(</span><span>Integer</span> id<span>)</span> <span>{</span>\n <span>return</span> <span>BeanConvertUtils</span><span>.</span><span>converTo</span><span>(</span>dao<span>.</span><span>findById</span><span>(</span>id<span>)</span><span>,</span> <span>Vo</span><span>::</span><span>new</span><span>,</span> \n  <span>(</span>s<span>,</span> t<span>)</span> <span>-></span> t<span>.</span><span>setName</span><span>(</span>s<span>.</span>getName<span>)</span><span>)</span>\n <span>)</span><span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>当我们要拷贝 list 的时候也很简单：</p>\n<div><pre><code><span>// 使用前</span>\n<span>public</span> <span>List</span><span><span>&lt;</span><span>Vo</span><span>></span></span> <span>findAll</span><span>(</span><span>)</span> <span>{</span>\n <span>List</span><span><span>&lt;</span><span>Vo</span><span>></span></span> vos <span>=</span> <span>new</span> <span>ArrayList</span><span>(</span><span>)</span><span>;</span>\n <span>List</span><span><span>&lt;</span><span>Po</span><span>></span></span> pos <span>=</span> dao<span>.</span><span>findAll</span><span>(</span><span>)</span><span>;</span>\n <span>for</span> <span>(</span><span>Po</span> po <span>:</span> <span>Pos</span><span>)</span> <span>{</span>\n     <span>Vo</span> vo <span>=</span> <span>new</span> <span>Vo</span><span>(</span><span>)</span><span>;</span>\n     <span>BeanUtis</span><span>.</span><span>copyProperties</span><span>(</span>po<span>,</span> vo<span>)</span><span>;</span>\n     vos<span>.</span><span>add</span><span>(</span>vo<span>)</span><span>;</span>\n    <span>}</span>\n <span>return</span> vos<span>;</span>\n<span>}</span>\n\n<span>// 使用后</span>\n<span>public</span> <span>List</span><span><span>&lt;</span><span>Vo</span><span>></span></span> <span>findAll</span><span>(</span><span>)</span> <span>{</span>\n <span>return</span> <span>BeanConvertUtils</span><span>.</span><span>converToList</span><span>(</span>dao<span>.</span><span>findAll</span><span>(</span><span>)</span><span>,</span> <span>Vo</span><span>::</span><span>new</span><span>)</span>\n<span>}</span>\n\n<span>// 同样支持自定义lambda</span>\n<span>public</span> <span>List</span><span><span>&lt;</span><span>Vo</span><span>></span></span> <span>findAll</span><span>(</span><span>)</span> <span>{</span>\n <span>return</span> <span>BeanConvertUtils</span><span>.</span><span>converToList</span><span>(</span>dao<span>.</span><span>findAll</span><span>(</span><span>)</span><span>,</span> <span>Vo</span><span>::</span><span>new</span><span>,</span>\n  <span>(</span>s<span>,</span> t<span>)</span> <span>-></span> t<span>.</span><span>setName</span><span>(</span>s<span>.</span>getName<span>)</span><span>)</span>\n <span>)</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"代码如下\" tabindex=\"-1\"> 代码如下：</h3>\n<div><pre><code><span>/**\n * 转换对象工具\n *\n * <span>@author</span> bugpool\n */</span>\n<span>public</span> <span>class</span> <span>BeanConvertUtils</span> <span>extends</span> <span>BeanUtils</span> <span>{</span>\n\n    <span>public</span> <span>static</span> <span><span>&lt;</span><span>S</span><span>,</span> <span>T</span><span>></span></span> <span>T</span> <span>convertTo</span><span>(</span><span>S</span> source<span>,</span> <span>Supplier</span><span><span>&lt;</span><span>T</span><span>></span></span> targetSupplier<span>)</span> <span>{</span>\n        <span>return</span> <span>convertTo</span><span>(</span>source<span>,</span> targetSupplier<span>,</span> <span>null</span><span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>/**\n     * 转换对象\n     *\n     * <span>@param</span> <span>source</span>         源对象\n     * <span>@param</span> <span>targetSupplier</span> 目标对象供应方\n     * <span>@param</span> <span>callBack</span>       回调方法\n     * <span>@param</span> <span><span>&lt;</span>S<span>></span></span>            源对象类型\n     * <span>@param</span> <span><span>&lt;</span>T<span>></span></span>            目标对象类型\n     * <span>@return</span> 目标对象\n     */</span>\n    <span>public</span> <span>static</span> <span><span>&lt;</span><span>S</span><span>,</span> <span>T</span><span>></span></span> <span>T</span> <span>convertTo</span><span>(</span><span>S</span> source<span>,</span> <span>Supplier</span><span><span>&lt;</span><span>T</span><span>></span></span> targetSupplier<span>,</span> <span>ConvertCallBack</span><span><span>&lt;</span><span>S</span><span>,</span> <span>T</span><span>></span></span> callBack<span>)</span> <span>{</span>\n        <span>if</span> <span>(</span><span>null</span> <span>==</span> source <span>||</span> <span>null</span> <span>==</span> targetSupplier<span>)</span> <span>{</span>\n            <span>return</span> <span>null</span><span>;</span>\n        <span>}</span>\n\n        <span>T</span> target <span>=</span> targetSupplier<span>.</span><span>get</span><span>(</span><span>)</span><span>;</span>\n        <span>copyProperties</span><span>(</span>source<span>,</span> target<span>)</span><span>;</span>\n        <span>if</span> <span>(</span>callBack <span>!=</span> <span>null</span><span>)</span> <span>{</span>\n            callBack<span>.</span><span>callBack</span><span>(</span>source<span>,</span> target<span>)</span><span>;</span>\n        <span>}</span>\n        <span>return</span> target<span>;</span>\n    <span>}</span>\n\n    <span>public</span> <span>static</span> <span><span>&lt;</span><span>S</span><span>,</span> <span>T</span><span>></span></span> <span>List</span><span><span>&lt;</span><span>T</span><span>></span></span> <span>convertListTo</span><span>(</span><span>List</span><span><span>&lt;</span><span>S</span><span>></span></span> sources<span>,</span> <span>Supplier</span><span><span>&lt;</span><span>T</span><span>></span></span> targetSupplier<span>)</span> <span>{</span>\n        <span>return</span> <span>convertListTo</span><span>(</span>sources<span>,</span> targetSupplier<span>,</span> <span>null</span><span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>/**\n     * 转换对象\n     *\n     * <span>@param</span> <span>sources</span>        源对象list\n     * <span>@param</span> <span>targetSupplier</span> 目标对象供应方\n     * <span>@param</span> <span>callBack</span>       回调方法\n     * <span>@param</span> <span><span>&lt;</span>S<span>></span></span>            源对象类型\n     * <span>@param</span> <span><span>&lt;</span>T<span>></span></span>            目标对象类型\n     * <span>@return</span> 目标对象list\n     */</span>\n    <span>public</span> <span>static</span> <span><span>&lt;</span><span>S</span><span>,</span> <span>T</span><span>></span></span> <span>List</span><span><span>&lt;</span><span>T</span><span>></span></span> <span>convertListTo</span><span>(</span><span>List</span><span><span>&lt;</span><span>S</span><span>></span></span> sources<span>,</span> <span>Supplier</span><span><span>&lt;</span><span>T</span><span>></span></span> targetSupplier<span>,</span> <span>ConvertCallBack</span><span><span>&lt;</span><span>S</span><span>,</span> <span>T</span><span>></span></span> callBack<span>)</span> <span>{</span>\n        <span>if</span> <span>(</span><span>null</span> <span>==</span> sources <span>||</span> <span>null</span> <span>==</span> targetSupplier<span>)</span> <span>{</span>\n            <span>return</span> <span>null</span><span>;</span>\n        <span>}</span>\n\n        <span>List</span><span><span>&lt;</span><span>T</span><span>></span></span> list <span>=</span> <span>new</span> <span>ArrayList</span><span><span>&lt;</span><span>></span></span><span>(</span>sources<span>.</span><span>size</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>for</span> <span>(</span><span>S</span> source <span>:</span> sources<span>)</span> <span>{</span>\n            <span>T</span> target <span>=</span> targetSupplier<span>.</span><span>get</span><span>(</span><span>)</span><span>;</span>\n            <span>copyProperties</span><span>(</span>source<span>,</span> target<span>)</span><span>;</span>\n            <span>if</span> <span>(</span>callBack <span>!=</span> <span>null</span><span>)</span> <span>{</span>\n                callBack<span>.</span><span>callBack</span><span>(</span>source<span>,</span> target<span>)</span><span>;</span>\n            <span>}</span>\n            list<span>.</span><span>add</span><span>(</span>target<span>)</span><span>;</span>\n        <span>}</span>\n        <span>return</span> list<span>;</span>\n    <span>}</span>\n\n    <span>/**\n     * 回调接口\n     *\n     * <span>@param</span> <span><span>&lt;</span>S<span>></span></span> 源对象类型\n     * <span>@param</span> <span><span>&lt;</span>T<span>></span></span> 目标对象类型\n     */</span>\n    <span>@FunctionalInterface</span>\n    <span>public</span> <span>interface</span> <span>ConvertCallBack</span><span><span>&lt;</span><span>S</span><span>,</span> <span>T</span><span>></span></span> <span>{</span>\n        <span>void</span> <span>callBack</span><span>(</span><span>S</span> t<span>,</span> <span>T</span> s<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>性能</strong></p>\n<p>由于只是 BeanUtils 的一个封装，跟原来的代码性能几乎差不多，如果要说差一点也没错，毕竟多了一层函数堆栈的调用，但是基本可以忽略不计。主要的性能还是由 BeanUtils 决定。</p>\n<p><strong>提醒</strong></p>\n<p>不知道大家对这个 BeanConvertUtils 工具类感觉怎么样，自己在项目中倒是大量使用，也很方便。</p>\n<p>但是有两点要提醒：</p>\n<p>此方法依旧不能解决深层次的深拷贝问题，详细的可以 google 一下 BeanUtils 的深拷贝问题。‘</p>\n<p>如果 source 或者 targetSupplier 只要有一个为 null，本工具类不像 BeanUtils 一样抛出异常，而是返回 null，因为笔者认为调用方如果把 null 进行准换，那就是想转换为 null，为不为空应该由调用方自己负责。</p>\n",
      "date_published": "2022-06-27T00:00:00.000Z",
      "date_modified": "2022-06-13T14:44:57.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "架构师图谱之微服务&消息队列",
      "url": "https://blog.ciberviler.top/dev/%E5%BE%AE%E6%9C%8D%E5%8A%A1&%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97.html",
      "id": "https://blog.ciberviler.top/dev/%E5%BE%AE%E6%9C%8D%E5%8A%A1&%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97.html",
      "content_html": "<h1 id=\"架构师图谱之微服务-消息队列\" tabindex=\"-1\"> 架构师图谱之微服务&amp;消息队列</h1>\n<h2 id=\"概述\" tabindex=\"-1\"> 概述</h2>\n<p>“架构师图谱”是一个很宏大的命题，特别是优秀的架构师自身也是“由点到面再到图”，一点点成长积累起来，尝试写这篇文章的目的更多的是结合自身的一些架构、研发、管理经验对现阶段做一个复盘总结，所以这里更偏向于后端图谱，依赖于开源技术、云原生或者其他第三方服务。这里会重点介绍一些技术栈、设计理念以及适应场景，这些可以作为我们选型时的依据。所谓“架构即决策”，是在一个有约束的盒子中寻求最优解。这个有约束的盒子是团队经验、成本、资源、进度、业务所处阶段等编织、掺杂在一起的综合体。本质上无优劣，但是存在恰当的架构用在合适的软件系统中，而这些就是决策的结果。</p>\n<h2 id=\"序章\" tabindex=\"-1\"> <strong>序章</strong></h2>\n<p>一个技术图谱：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16550404961021.png\" alt=\"图片\"></p>\n<p>计划会分上、中、下三个篇章来介绍：</p>\n<ul>\n<li>上篇：重点聚焦在微服务和常用的消息队列，包括相关的选型以及一些理论基础</li>\n<li>中篇：主要集中在数据库、分布式（一致性/锁/缓存/发号/任务调度等），以及流媒体</li>\n<li>下篇：分享一些DevOps、项目管理、团队建设方向的一些经验</li>\n</ul>\n<p>完整的思维导图：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16550404961022.png\" alt=\"图片\"></p>\n<h2 id=\"微服务\" tabindex=\"-1\"> 微服务</h2>\n<p>微服务（英语：Microservices）是一种软件架构风格，它是以专注于单一责任与功能的小型功能区块（Small Building Blocks）为基础，利用模块化的方式组合出复杂的大型应用程序，各功能区块使用与语言无关（Language-Independent/Language agnostic）的API集相互通信。</p>\n<p>微服务架构有别于更为传统的单体服务，可将应用拆分成多个核心功能。每个功能都被称为一项服务，可以单独构建和部署。这也体现了可扩展的基本思想：将原本大一统的系统拆成多个小部分，扩展时只修改其中一部分，通过这种方式减少改动范围，降低改动风险。微服务架构涵盖了服务的多个方面，包括网关、通信协议、服务注册/发现、可观察性、如何合理的划分等等。</p>\n<h3 id=\"理论基础\" tabindex=\"-1\"> <strong>理论基础</strong></h3>\n<p>微服务的理论基础主要用来指导微服务架构设计、服务拆分，确定合适的服务粒度和边界。在做微服务之前我们首先要想明白我们现有系统面临什么样的问题，为什么需要微服务，随后才是怎么做。微服务很多核心理念其实在半个世纪前的一篇文章中就被阐述过了，而且这篇文章中的很多论点在软件开发飞速发展的这半个世纪中竟然一再被验证，这就是康威定律（Conway’s Law）。在康威的这篇文章中，最有名的一句话就是：</p>\n<p>Organizations which design systems are constrained to produce designs which are copies of the communication structures of these organizations.</p>\n<p>中文直译大概的意思就是：设计系统的组织，其产生的设计等同于组织之内、组织之间的沟通结构。最初这篇文章只是描述作者自己的发现和总结，后来“人月神话”中，引用这个观点，并将其“吹捧”成现在熟知的“高位定律”，其中的一些核心观点可以概括如下：</p>\n<ul>\n<li>组织沟通方式决定系统设计，对于复杂的系统，聊设计就离不开聊人与人的沟通，解决好人与人的沟通问题，才能有一个好的系统设计</li>\n<li>时间再多一件事情也不可能做的完美，但总有时间做完一件事情，这与架构设计的“简单、合适、演化”思维不谋而合</li>\n<li>线型系统和线型组织架构间有潜在的异质同态特征，更直白的说，你想要什么样的系统，就搭建什么样的团队，定义好系统的边界和接口，团队内应该是自治的，这样将沟通成本维持在系统内部，每个子系统就会更加内聚</li>\n<li>大的系统组织总是比小系统更倾向于分解，面对复杂的系统及组织，往往可以采用分而治之。另外，搜索公众号编程技术圈后台回复“神器”，获取一份惊喜礼包。</li>\n</ul>\n<p>但是当我们的业务和组织架构复杂度比较高的时候，很多概念只从技术角度很难去抽象，这就需要我们自上而下，建立起通用语言，让业务人员和研发人员说一样的话，把思考层次从代码细节拉到业务层面。越高层的抽象越稳定，越细节的东西越容易变化。通过对不同领域的建模，逐步确定领域范围和业务边界，这也就是领域驱动设计（DDD）。DDD是一种在面向高度复杂的软件系统时，关于如何去建模的方法论，它的关键点是根据系统的复杂程度建立合适的模型，DDD中的界限上下文也完美匹配了微服务的高内聚、低耦合特性，这也为我们微服务的划分提供了强有力的基础。DDD实施的一般步骤是：</p>\n<ul>\n<li>根据需求划分出初步的领域和限界上下文，以及上下文之间的关系</li>\n<li>进一步分析每个上下文内部，识别出哪些是实体，哪些是值对象</li>\n<li>对实体、值对象进行关联和聚合，划分出聚合的范畴和聚合根</li>\n<li>为聚合根设计仓储，并思考实体或值对象的创建方式</li>\n<li>在工程中实践领域模型，并在实践中检验模型的合理性，倒推模型中不足的地方并重构</li>\n</ul>\n<p>但是DDD也不是银弹，特别是在一些新业务场景，本身就充满了很多的不确定性，一次性把边界划清楚并不是一件很容易的事。大家在一个进程里，调整起来会相对容易，然后让不同的界限上下文各自演化，等到了一定程度之后再考虑微服务也是一个不错的选择。</p>\n<h3 id=\"网关\" tabindex=\"-1\"> 网关</h3>\n<p>作为微服务的统一入口，也肩负着整个微服务的流量接入、管理、聚合、安全等，从服务分层的角度可以划分为接入网关和业务网关。接入网关接入网关提供最基础的流量接入和安全防护能力，侧重于全局，与业务无关。</p>\n<ul>\n<li>\n<p>域名&amp;DNS，作为服务的流量入口，对外通过域名和DNS提供服务，国内域名厂商一般都依托于共有云或被共有云厂商收购，用来完善自由的云生态，像阿里的万网，腾讯的DNSPod等，也有国外的AWS，GoDaddy和Namecheap等，可以用作.me等国内无法托管或备案域名的管理，其次也可以借助DNS（HTTPDNS、EDNS）实现跨地域、运营商网络等负载均衡，实现异地多活、就近访问、容灾等。</p>\n</li>\n<li>\n<p>负载均衡（LB），主要负责请求的转发代理，按机器负载来分配流量等，对外提供VIP，这里的负载可以宽泛的理解为系统的压力，可以用CPU负载来衡量，也可以用连接数、I/O使用率、网卡吞吐量等来衡量。负载均衡器按服务层级来划分，除了前边提到的DNS，还有集群级别的硬件负载均衡，以及机器级别的软件负载均衡。</p>\n</li>\n<li>\n<ul>\n<li>DNS/硬件负载均衡（F5/A10）主要用来应对海量用户的访问，中小量用户使用无疑会增加更多的维护和采购成本。</li>\n<li>软件负载均衡可以选择自研或上云，LVS、Keepalived主要用于四层（IP+端口）的负载均衡，在四层的基础之上如果要实现应用层（域名/URL/用户会话）等的7层负载均衡，可以使用Nginx、Keepalived的组合。</li>\n</ul>\n</li>\n<li>\n<p>除此之外，网关也负责服务整体的安全防护，SSL，IPV6等。</p>\n</li>\n<li>\n<ul>\n<li>安全防护目的是保护服务数据以及可用性，例如防范常见的DDOS/CC网络攻击，反爬虫，自定义访问控制，自研成本往往比较高，可以借助云上一系列的高防、防火墙服务。</li>\n<li>SSL（TLS）用来提供外部https访问，https可以防止数据在传输过程中不被窃取、改变，确保数据的完整性，在支付或者用户登录等敏感数据场景，可以起到一定的保护作用，同时https页面对搜索引擎也比较友好。</li>\n<li>IPV6，全球43亿IPV4地址已经在2019年年底耗尽，网信办在2018年开始就已经推行各大运营商、CDN厂商、互联网核心产品支持IPV6，我们公司之前也是试点之一。IPV6的支持只需要增加一条“AAAA”DNS记录，将域名解析到自持IPV6的IP/VIP即可。IPV4到IPV6由于存在兼容性等问题，一定是长期共存的，过渡方案可以采用IPV6代理（IPV6代理转发到IPV4服务）或者双栈（同时支持IPV6和IPV4）。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"业务网关\" tabindex=\"-1\"> 业务网关：</h3>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16550404961023.png\" alt=\"图片\"></p>\n<p>业务网关作为业务的最上层出口，一般承担起业务接入或者BFF的工作，例如基础的路由、鉴权、限流、熔断降级、服务聚合、插件化能力，并可以通过可视化界面管理网关配置。可选框架有基于OpenResty的Kong、APISIX以及其他语言相关的Spring Cloud Gateway、gRPC-Gateway等等，国内开源的Goku、Kratos、go-zero go框架，有很多比较有意思的组件实现，我们日常业务上也可以借鉴。</p>\n<ul>\n<li>鉴权，鉴权的目的是为了验证用户、请求等的有效性，例如用户身份鉴权（JWT/Oauth2/Cookie），请求鉴权（请求签名、请求加密），鉴权逻辑也花样繁多，大多需要基于业务定制化，通过网关插件能很好的集成进来。</li>\n<li>限流，限流是为了做一定的流量控制，防止对系统产生过大压力从而影响整个服务。可以基于单台机器或整个集群限流，常见的方式有限制总量和限制速率，超过的则排队或丢弃，例如令牌桶（弹性）/漏桶（匀速）算法。</li>\n<li>熔断降级，熔断作为服务断路器，当下游的服务因为某种原因突然变得不可用或响应过慢（这里既可以指单次请求也可以指一段时间），上游服务为了保证自己整体服务的可用性，不再继续调用目标服务，直接返回，这样也能对整体链路起到保护作用。如果目标服务情况好转则恢复调用，同时结合降级策略提升服务的鲁棒性。常见的有Hystrix/Resilience4J（Hystrix虽然已停止更新，但现有功能已经能满足大多业务场景）。</li>\n<li>重试，大量网络IO，避免不了会出现因网络抖动，出现连接失败或者超时，重试可以提高请求的最终成功率，削平服务毛刺。但重试也有可能放大故障，所以可以结合退避策略（backoff）、限制单点重试、限制链路重试这些策略进行优雅的重试，同时也可以采用更加激进的“对冲请求”提前（tp99时间未响应时）发起重试请求，降低系统时延。</li>\n<li>插件化，各个网关集成插件的方式尽不相同，但是目的都是为了集成技术人员编写的一些业务相关的通用能力，例如前边提到的身份鉴权、请求鉴权等等。另外作为业务网关插件，也可以编写一些基础业务（API鉴权、请求格式化）逻辑，直接透传请求到服务层，省去很多BFF和上下游对接的工作。</li>\n<li>BFF，Backend For Frontend，可以按照业务逻辑，以串行、并行和分支等结构编排多个服务API，为服务提供聚合、适配、裁剪（只返回需要的字段）功能，核心是API的动态编排以满足日益增长的业务逻辑，降低前端与微服务之间的对接成本。BFF并不意味着只能由后端实现，也可以在前端通过GraphQL等API查询语言实现。</li>\n</ul>\n<h3 id=\"协议\" tabindex=\"-1\"> 协议</h3>\n<p>服务间的通信方式是在采用微服务架构时需要做出一个最基本的决策，统一的协议标准也能大大降低服务的联调和维护成本。</p>\n<ul>\n<li>HTTP REST，REST更确切的讲是指的API设计风格，而不是协议标准。通常基于使用HTTP，URL，和JSON这些现有的广泛流行的协议和标准。符合REST设计风格的API称作RESTful API。在实际应用中大多实现的是伪REST API，例如用POST请求同时实现资源的增删改，或者为了请求的扩展性，资源的增删改查都使用POST JSON。</li>\n<li>RPC，RPC协议描绘了客户端与服务端之间的点对点调用流程，包括stub、通信、RPC消息协议部分。可以基于TCP，也可以基于http。在实际应用中，还需要考虑服务的高可用、负载均衡等问题，所以产品级的RPC框架除了点对点的RPC协议的具体实现外，还应包括服务的发现与注册、提供服务的多台Server的负载均衡、服务的高可用等更多的功能。目前的RPC框架大致有两种不同的侧重方向，一种偏重于服务治理（Dubbo、Motan），另一种偏重于跨语言调用（Thrift/GRPC）。</li>\n</ul>\n<h3 id=\"rpc-vs-http-rest优点\" tabindex=\"-1\"> RPC vs HTTP REST优点：</h3>\n<ul>\n<li>更清晰的API定义，例如gRPC协议的定义文件proto，自身就可以作为很好的API文档，日常开发中也可以把proto文件独立版本库管理，精简目录结构，方便不同的服务引用。</li>\n<li>更好的传输效率，通过序列化和反序列化进一步压缩网络传输数据，不过序列化、反序列化也会有一定的性能损耗，protobuf可以说很好的兼顾了这两点。</li>\n<li>更合适的容错机制，可以基于实际的业务场景，实现更合适的超时控制与异常重试机制，以应对网络抖动等对服务造成的影响。</li>\n</ul>\n<p>在一些特定场景，例如：OpenAPI、BFF等，HTTP REST可以更大程度上降低外部团队的接入成本。并且RPC也有调试不便、多语言互通需要对应的SDK支持这些问题，各有利弊。综合考虑来看，除了一些特定场景，如果我们已经有相对完善的基础设施支撑（RPC框架、服务治理），RPC可以为一个更合适的选择。</p>\n<h3 id=\"服务注册-发现\" tabindex=\"-1\"> <strong>服务注册/发现</strong></h3>\n<p>服务注册主要是通过将微服务的后端机器IP、端口、地域等信息注册起来，并结合一定的发现机制使客户端的请求能够直连具体的后端机器。从实现方式上可以分为服务端模式与客户端模式：</p>\n<ul>\n<li>服务端模式，也可以说是传统模式，通过借助负载均衡器和DNS实现，负载均衡器负责健康检查、负载均衡策略，DNS负责实现访问域名到负载均衡器IP/VIP的映射。通过直接暴露域名和端口的方式提供客户端访问。</li>\n<li>客户端模式，可以借助注册中心实现，注册中心负责服务的注册与健康检查，客户端通过监听配置变更的方式及时把配置中心维护的配置同步到本地，通过客户端负载均衡策略直接向后端机器发起请求。</li>\n</ul>\n<p>从两种模式的实现方式上可以看出：</p>\n<ul>\n<li>\n<p>服务端模式注册与发现都由服务端完成，这样可以使客户端专注在自身的业务实现，但是由于依赖负载均衡器，也就是集中式的proxy，proxy需要维护双向连接，也很容易使自己成为系统瓶颈，可用性的高低直接决定了服务质量，并且DNS缓存机制也会导致故障发生时，迁移并不能及时完成。当然在服务量少，且负载均衡器有VIP的情况下，我们也可以不使用DNS。</p>\n</li>\n<li>\n<p>客户端模式注册与发现由配置中心和客户端共同完成，通过分布式的方式，可以避免出现proxy节点性能瓶颈问题，但是可靠性与性能瓶颈很容器出现在配置中心上，并且客户端的也需要一定的接入成本。好在开源的已经有很成熟的架构方案与丰富的客户端SDK，例如etcd/ZooKeeper/Consul，Consul提供开箱即用的功能，etcd社区和接入易用性方面更优一些，他们之间的一些具体区别：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16550404961034.jpeg\" alt=\"图片\"></p>\n</li>\n</ul>\n<h3 id=\"配置中心\" tabindex=\"-1\"> <strong>配置中心</strong></h3>\n<p>配置中心从使用场景来讲，一类是前边讲到的服务注册、发现和KV存储，例如etcd/ZooKeeper/Consul，在Kubernetes场景下也可以通过ConfigMap/Secret将配置写入本地文件、环境变量或者共享的Volume中，这样没有了中心服务的依赖和客户端的接入，可以实现一些老旧服务的无侵入式改造。但是作为配置中心，除了基础的配置数据，一些情况下还要开放给非开发人员（测试、运维、产品）使用，完善的控制台、权限管理、Dashbord的支持，也非常重要，这类可以参考Nacos（阿里开源）/Apollo（携程开源）。Nacos在读写性能上优于Apollo，但是功能特性（例如权限管理）稍逊于Apollo。</p>\n<h3 id=\"可观察性\" tabindex=\"-1\"> <strong>可观察性</strong></h3>\n<p>在控制论中，可观察性是用系统输出到外部的信息来推断系统内部运运行状态的一种度量方式</p>\n<p>在云原生时代，容器和服务的生命周期是紧密联系在一起的，相较在传统的单体服务运行在物理主机或者虚拟机当中，排查问题的时候显得非常不便，这种复杂性导致了一个定义研发运营效率的MTTR（平均故障修复时间）指标急剧增加。所以这里更强调的是微服务的可观察性，需要提前想好我们要如何观察容器内的服务以及服务之间的拓扑信息、各式指标的搜集等，这些监测能力相当重要。可观察性三大支柱围绕Tracing（链路追踪）、Logging（日志）和Metrics（度量）展开，这三个维度几乎涵盖了应用程序的各种表征行为，开发人员通过收集并查看这三个维度的数据时刻掌握应用程序的运行情况。很长一段时间，这三者是独立存在的，随着时间的推移，这三者已经相互关联，相辅相成。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16550404961035.jpeg\" alt=\"图片\"></p>\n<h3 id=\"链路追踪\" tabindex=\"-1\"> <strong>链路追踪</strong></h3>\n<p>链路追踪为分布式应用的开发者提供了完整的调用链路还原、调用请求量统计、链路拓扑、应用依赖分析等工具，可以帮助开发者快速分析和诊断分布式应用架构下的性能瓶颈，提高微服务时代下的开发诊断效率以及系统的可观察性。为了解决不同的分布式系统API不兼容的问题，诞生了OpenTracing规范，OpenTracing中的Trace可以被认为是由多个Spacn组成的DAG图。</p>\n<div><pre><code>[Span A]  ←←←(the root span)\n        |\n +------+------+\n |             |\n[Span B]      [Span C] ←←←(Span C 是 Span A 的孩子节点, ChildOf)\n |             |\n[Span D]      +---+-------+\n           |           |\n       [Span E]    [Span F] >>> [Span G] >>> [Span H]\n                                   ↑\n                                   ↑\n                                   ↑\n                     （Span G在Span F后被调用，FollowsFrom）\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>OpenTracing专注在tracing，除此之外还有包含了Metrics的OpenCensus标准，以及由CNCF推出，融合OpenTracing和OpenCensus的OpenTelemetry。OpenTelemetry旨在实现云原生时代可观察性指标（Tracing、Logging、Metrics）的统一收集和处理，同时提供推动这些标准实施的组件和工具。OpenTracing中的佼佼者当属Jaeger、Zipkin、Skywalking。他们之间的一些对比：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16550404961036.jpeg\" alt=\"图片\"></p>\n<p>Zipkin开源时间长，社区相对丰富，Jaeger更加轻量，也是Istio推荐方案，SkyWalking支持部分语言（Java、PHP、Python等）的无侵入式接入。另外APM（应用性能）监控的支持也会影响到我们的选型。除此之外，面对线上海量请求，如果采用抽样采样策略，那就需要支持一定的流量染色，把我们核心关注的请求（例如链路中发生了错误、部分请求耗时过高等）都进行采样，可以通过结合opentelemetry-collector以及开箱即用的tailsamplingprocessor[1]构建Pipeline插件实现。</p>\n<h3 id=\"日志\" tabindex=\"-1\"> <strong>日志</strong></h3>\n<p>服务间的链路日志能否帮助我们判断错误发生的具体位置，这类业务日志主要集中在访问日志/打点日志等等。随着大数据的兴起，我们对数据的分析解读能力越来越强，日志作为原始数据则体现出了更大的价值，例如用户的行为分析，反垃圾，舆情分析等等。</p>\n<p>业务日志：这类日志重点在于通过不同级别的日志，及时发现分析系统存在的异常，RFC 5424定义的8中日志级别：</p>\n<ul>\n<li>Emergency：system is unusable</li>\n<li>Alert：action must be taken immediately</li>\n<li>Critical：critical conditions</li>\n<li>Error：error conditions</li>\n<li>Warning：warning conditions</li>\n<li>Notice：normal but significant condition</li>\n<li>Informational：informational messages</li>\n<li>Debug：debug-level messages</li>\n</ul>\n<p>在实际使用过程中可能会对日志级别进行简化和调整，一般来讲Warning及以上的日志是需要重点关注的，需要做好及时的监控告警，Warning以下的日志也可以辅助问题的定位。日志写入可以选择写入消息队列，也可以选择落地磁盘，将关心的结构化或非结构化日志、业务模块信息（如果是细粒度的微服务，可以选择将日志放同一模块收集），以及级别、时间（who、when、where、how、what）等要素正确的写入正确写入后再收集到日志服务。写入消息队列需要考虑消息队列的选型以及做好可用性和积压监控，写入磁盘需要考虑写入性能以及日志的切割清理，例如Golang的zap+rotatelogs组合。日志收集的话，由于Logstash资源消耗相对比较大，虚拟机环境中可以使用Filebeat来替代，更严苛的线上或容器环境，可以使用Fluentd/Fluentd Bit。日志最终汇总到ES和Kibana做展示，通过Esalert定制告警策略。</p>\n<p>大数据日志：大数据日志本质上也对应着我们一定的业务场景，但大多是海量日志、高吞吐量场景，所以对海量日志的收集和存储是较大的挑战。实现方案我们可以采用高吞吐量的流式中间件，例如Kafka/Plusar等，在结合流式处理（Flink）或者批处理（Spark）系统，将数据汇总到Hadoop进行分析，这里涉及到的中间件和数据库可参考后续章节。另外，搜索公众号Java架构师技术后台回复“Spring”，获取一份惊喜礼包。</p>\n<h3 id=\"指标3\" tabindex=\"-1\"> <strong>指标3</strong></h3>\n<p>指标是有关系统的离散的数据点，这些指标通常表示为计数或度量，并且通常在一段时间内进行汇总或计算，一般用来做基础的资源监控和业务监控：</p>\n<ul>\n<li>资源监控：CPU、内存、IO、fd、GC等</li>\n<li>业务监控：QPS、模调、耗时分布等</li>\n</ul>\n<p>Zabbix作为老牌的监控系统，适合更复杂的物理机、虚拟机、数据库等更复杂的场景，同时也拥有更丰富的图形化界面，但是Prometheus作为云原生的代表作，与Kubernetes、容器等能更好的结合，协同Grafana实现可定制化的界面，另外存储基于TSDB，相比于关系型数据库也有更好的扩展性。以Prometheus为例，支持的数据类型有：</p>\n<ul>\n<li>Counter只增不减的计数器，例如请求数（http_requests_total）。基于此数据模型，使用Prometheus提供的强大PromQL表达式能够拓展出更加适合开发观察的指标数据。分钟增量请求：increase(http_requests_total[1m]) 分钟QPS：rate(http_requests_total[1m])</li>\n<li>Gauge可增可减的时刻量，例如Go语言协程数（go_goroutines） 波动量：delta(go_goroutines[10m])</li>\n<li>Histogram直方图，不同区间内样本的个数。例如，耗时50ms-100ms每分钟请求量，100ms-150ms每分钟请求量。</li>\n<li>Summary 概要，反应百分位值。例如，某RPC接口，95%的请求耗时低于150ms，99%的请求耗时低于200ms。</li>\n</ul>\n<h3 id=\"service-mesh\" tabindex=\"-1\"> <strong>Service Mesh</strong></h3>\n<p>Service Mesh这个服务网格专注于处理服务和服务之间的通信，包括我们前边讲的服务发现、熔断降级、安全、流量控制、可观察性等能力。这些通用能力在Service Mesh出现之前，由Lib/Framework完成，这样就可以在开发层面上很容易地集成到我们的应用服务中。但是并没有办法实现跨语言编程，有什么改动后，也需要重新编译重新发布服务。理论上应该有一个专门的层来干这事，于是出现了Sidecar，Sidecar集群就成了Service Mesh，加上对整个集群的管理控制面板，就成了现在的Service Mesh架构，可以说Service Mesh是云原生时代的必然产物。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16550404961037.jpeg\" alt=\"图片\"></p>\n<p>目前比较流行的Service Mesh开源软件是Istio和Linkerd，还有更加轻量级的Conduit，它们都可以在Kubernetes中集成。Istio基于Golang编写，使用Envoy作为Sidecar，在服务治理方面职责分明，国内落地案例相较Linkerd 、Conduit更加广泛。由于Service Mesh承担了服务核心的流量调度环节，再给我们带来便利的同时，也引入很多的不可控因素，例如：Sidecar组件不可用，将直接导致系统出现致命问题。所以在充分做好服务可观察性的前提下，也要保证Service Mesh的高可用，一种比较好的方式是，除了在本机有 Sidecar，我们还可以部署一下稍微集中一点的 Sidecar——比如为某个服务集群部署一个集中式的 Sidecar。一旦本机的有问题，可以走集中的。</p>\n<h2 id=\"消息队列\" tabindex=\"-1\"> 消息队列</h2>\n<p>在计算机科学中，消息队列（英语：Message queue）是一种进程间通信或同一进程的不同线程间的通信方式，软件的贮列用来处理一系列的输入，通常是来自用户。消息队列提供了异步的通信协议，每一个贮列中的纪录包含详细说明的数据，包含发生的时间，输入设备的种类，以及特定的输入参数，也就是说：消息的发送者和接收者不需要同时与消息队列交互。消息会保存在队列中，直到接收者取回它。</p>\n<p><a href=\"http://mp.weixin.qq.com/s?__biz=MzAwNjQwNzU2NQ==&amp;mid=2650360380&amp;idx=1&amp;sn=3a97f6d7ae39fea666416a92b1801ce2&amp;chksm=83003edeb477b7c8f34536fc00378008eefc2910d6c5853d9668a3017d70df5414f0bb693539&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\"><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16550404961038.png\" alt=\"图片\"></a></p>\n<p>实际应用场景中，消息队列也经常作为中间件，用于异步解耦、削峰填谷、数据广播、错峰与流控、最终一致性等，在一些核心的大数据分析、交易支付等场景也经常扮演重要角色，消息队列的选型主要侧重以下几点：</p>\n<ul>\n<li>HA：自身的高可用性保障，避免消息队列的引入而影响整体服务的可用性</li>\n<li>高吞吐：在面对海量数据写入能否保持一个相对稳定、高效的数据处理能力</li>\n<li>功能丰富性：是否支持延迟消息、事务消息、死信队列、优先级队列等</li>\n<li>消息广播：是否支持将消息广播给消费者组或者一组消费者</li>\n<li>消息堆积能力：在数据量过大时，是否允许一定消息堆积到broker</li>\n<li>数据持久性：数据持久化策略的采用，也决定着数据在宕机恢复后是否会丢失数据</li>\n<li>重复消费：是否支持ack机制，在消费者未正确处理消息时，支持重新消费</li>\n<li>消息顺序性：针对顺序消费的场景保证数据按写入时间的顺序性</li>\n</ul>\n<p>这里着重对比一下Redis、RabbitMQ/RocketMQ、Kafka、Plusar。</p>\n<h3 id=\"redis\" tabindex=\"-1\"> <strong>Redis</strong></h3>\n<p>Redis实现消息队列可以通过List类型、Pub/Sub、Stream（Redis 5.0）类型来实现，HA使用多副本或者集群的方式。作为消息队列使用起来非常方便，但是也有很多的弊端：</p>\n<ul>\n<li>功能丰富性：只支持普通的消息类型</li>\n<li>数据持久性：Pub/Sub只提供缓冲区广播能力，不进行持久化，List/Stream即使基于aof和rdb持久化策略，但是并没有事务性保障，在宕机恢复后还是存在丢失数据的可能性</li>\n<li>消息堆积能力：List随长度增大，内存不断增长；Pub/Sub只在缓冲区内堆积，缓冲区满消费者强制下线；Stream创建时可以指定队列最大长度，写满后剔除旧消息</li>\n</ul>\n<p>除此之外，List类型无法支持消息广播，和Pub/Sub一样也不支持重复消费。结合整体来看Redis作为消息队列大多数只应用在数据量小，对丢失数据不敏感的业务场景，适用范围较小，复杂业务并且有一定运维支撑的情况下，可以直接考虑企业级消息中间件。</p>\n<h3 id=\"rabbitmq-vs-kafka-vs-rocketmq\" tabindex=\"-1\"> <strong>RabbitMQ vs Kafka vs RocketMQ</strong></h3>\n<p>这几个可以作为企业级消息中间件的代表，RabbitMQ和kafka的一些详细对比，可以参考之前写的这篇文章《消息队列RabbitMQ与Kafka对比分析[2]》。而RocketMQ在设计之初就借鉴了很多RabbitMQ、Kafka的设计理念，例如：Routing、多副本、顺序写（IO），也广泛应用在淘宝双十一等场景。</p>\n<h3 id=\"ha\" tabindex=\"-1\"> <strong>HA</strong></h3>\n<p>在HA方面他们都是通过副本的方式，区别是RabbitMQ是集群级别的副本，Kafka是多partiton和ISR、选举机制，而RocketMQ通过多（master/slave）副本同时保障NameServer和Broker。</p>\n<h3 id=\"高吞吐\" tabindex=\"-1\"> <strong>高吞吐</strong></h3>\n<p>Kafka和RocketMQ通过直接操作文件系统，相比于RabbitMQ，顺序写能大幅度提升数据的处理速度。Kafka为了进一步提升消息的吞吐量，可以采用客户端缓冲队列的方式批量发送，但也会存在宕机丢失数据的可能性，可以通过设置batch.size与linger.ms来动态调整，相比于RocketMQ更加灵活。Kafka的partition机制的确会带来性能的提升，但是在Topic不断增多的情况下，众多的partition及副本也将顺序写逐步退化为随机写，并且扩容时，由于hash值的变化，也会涉及到大量partiton数据的迁移。RocketMQ采用commitlog的方式实现全局写，所以能支持更多的Topic，扩容也不涉及大量数据的迁移。</p>\n<h3 id=\"功能丰富性\" tabindex=\"-1\"> <strong>功能丰富性</strong></h3>\n<p>Kafka只有基础的消息类型，RabbitMQ支持优先级队列，通过TTL和死信队列可以实现消息的延迟和重试，但是需要提前创建好对应重试频率的队列，例如：1s重试队列，10s重试队列，RocketMQ则内置了18个重试频率“1s 5s 10s 30s 1m 2m……”，另外也具有独有的2PL事务消息，很好的保障业务逻辑与消息发送的一致性。</p>\n<h3 id=\"重复消费\" tabindex=\"-1\"> <strong>重复消费</strong></h3>\n<p>他们三者都采用ACK机制保障了单条消息重复消费的能力，Kafka通过offset和partition特殊的ttl机制（segment过期，按文件名顺序清理），能支持通过重置offset来回溯历史数据。</p>\n<h3 id=\"消息顺序性\" tabindex=\"-1\"> <strong>消息顺序性</strong></h3>\n<p>RabbitMQ和RocketMQ可以保证写入同一topic的顺序性，但是在多个消费者同时消费的情况下还是会出现乱序的情况，在数据量较大的时候，我们也可以通过单个消费者消费，再按照一定的分发策略分配给多个消费者执行，只不过会提升整体复杂度，同时会带来更多的HA、维护成本考量。Kafka可以保障单个partition的顺序性，并且每个partiton只允许一个消费者来消费（N：1），这就从策略上避免了多消费者的情况，在数据量较大的情况下，可以通过划分更多的partition提升数据处理能力。综合来讲，RabbitMQ、RocketMQ使用Queue模型，丰富的消息队列功能，更多的应用在业务场景，Kafka基于Streaming模型，结合批处理、流式处理，更多的应用在大数据分析场景。</p>\n<h3 id=\"pulsar\" tabindex=\"-1\"> <strong>Pulsar</strong></h3>\n<p>Pulsar作为Apache开源、云原生的消息中间件，诞生之初就引发了很大的关注。设计上避免了Kafka遇到的功能丰富性、扩容等方面的问题，采用计算、存储分离的架构，broker层只作为“API接口层”，存储交给更专业的bookeeper，由于broker层的无状态性，结合Kubernetes等非常方便的进行扩容。并且Pulsar支持多个消费模型提升消费者处理能力，例如：exclusive、failover、shared、key-shared等，可以说综合了Kafka和其他消息中间件的众多优点。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16550404961039.jpeg\" alt=\"图片\"></p>\n<ul>\n<li>HA、高吞吐：和Kafka类似，通过多partition和选举机制功，除此之外，还支持丰富的跨地域复制能力</li>\n<li>功能丰富性：可以支持秒级的延迟消息，以及独特的重试队列和私信队列</li>\n<li>消息顺序性：为了实现partition消息的顺序性，和Kafka一样，都需要将消息写入到同一broker，区别是Kafka会同时存储消息在该broker，broker和partiton绑定在一起，而Pulsar可以将消息分块（segment）后，更加均匀的分散到bookeeper节点上，broker只需要记录映射关系即可，这样在资源扩容时，可以更加快速便捷</li>\n</ul>\n<p>像能量守恒定律一样，系统的复杂度往往也是守恒的，实现即高性能又高可用的消息中间件需要的技术复杂性，不会凭空消失，只会从一个地方转移到另一个地方，消息队列本质上可以理解为feature+fs，只不过存储、计算分离架构，将各层间的职责分离，使每一层都能专注在自身领域，以应对海量数据和更加复杂多变的环境，这也是现在新技术发展的一个趋势。作为后起之秀，的确可以站在巨人的肩膀上，避免很多设计上的不足，同时引入一些新的架构理念，但是要成功的在其中分一杯羹，同样也要面临用户学习成本高、缺少杀手级应用、如何迁移等等这些现实性的问题，不过依靠良好的社区和技术先驱，随着时间的变迁，这些短板也会逐步补齐，真正适应当前时代的技术一定会脱颖而出。ps：腾讯云最近开源Rop[3]，支持RocketMQ相对平滑的迁移至Pulsar</p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16550404961021.png",
      "date_published": "2022-06-25T00:00:00.000Z",
      "date_modified": "2022-06-12T13:36:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "Github技巧",
      "url": "https://blog.ciberviler.top/other/Github%E6%8A%80%E5%B7%A7.html",
      "id": "https://blog.ciberviler.top/other/Github%E6%8A%80%E5%B7%A7.html",
      "content_html": "<h1 id=\"github技巧\" tabindex=\"-1\"> Github技巧</h1>\n<h2 id=\"_1-搜索\" tabindex=\"-1\"> 1.搜索</h2>\n<p>github高级搜索功能</p>\n<p>直接打开这里<a href=\"https://github.com/search/advanced\" target=\"_blank\" rel=\"noopener noreferrer\">GitHub · Where software is built</a></p>\n<p>或搜索后在搜索页面 language 下方打开（没找到更好的方法）</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220504225139153-165500134904917.png\" alt=\"image-20220504225139153\"></p>\n<p>更多技巧可查看官方文档：</p>\n<p><a href=\"https://docs.github.com/cn/search-github/getting-started-with-searching-on-github/about-searching-on-github\" target=\"_blank\" rel=\"noopener noreferrer\">About searching on GitHub - GitHub Docs</a></p>\n<p><a href=\"https://docs.github.com/cn/search-github/searching-on-github/searching-code\" target=\"_blank\" rel=\"noopener noreferrer\">搜索代码 - GitHub Docs</a></p>\n<h2 id=\"_2-查找文件\" tabindex=\"-1\"> 2.查找文件</h2>\n<p>在主页按“t”：查找文件</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220504225403858-165500134905018.png\" alt=\"image-20220504225403858\"></p>\n<p>点进源代码后，按“l”：跳转到某一行</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220504225816271.png\" alt=\"image-20220504225816271\"></p>\n<p>点击行号：</p>\n<ol>\n<li>复制这行代码</li>\n<li>生成永久链接</li>\n</ol>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220504225652318.png\" alt=\"image-20220504225652318\"></p>\n<p>源代码中按“b”：查看文件的改动记录</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220504225932440-165500134905019.png\" alt=\"image-20220504225932440\"></p>\n<p>键盘快捷键：</p>\n<ul>\n<li>\n<p>文档</p>\n<p><a href=\"https://docs.github.com/cn/get-started/using-github/keyboard-shortcuts\" target=\"_blank\" rel=\"noopener noreferrer\">键盘快捷键 - GitHub Docs</a></p>\n<p><a href=\"https://coderwall.com/p/ln-ira/github-markdown-cheat-sheet\" target=\"_blank\" rel=\"noopener noreferrer\">GitHub Markdown Cheat Sheet (Example)</a></p>\n</li>\n</ul>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/gs-165500134905020.png\" alt=\"Picture\"></p>\n<h2 id=\"_3-阅读代码技巧\" tabindex=\"-1\"> 3.阅读代码技巧</h2>\n<p>代码跳转：</p>\n<ol>\n<li>下载到本地</li>\n<li>在线vscode：仓库详情界面按下“。”键，</li>\n</ol>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220504230504057-165500134905021.png\" alt=\"image-20220504230504057\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220504230630070-165500155568446.png\" alt=\"image-20220504230630070\"></p>\n<h2 id=\"_4-在线运行项目\" tabindex=\"-1\"> 4.在线运行项目</h2>\n<p>在项目地址前加上<code>gitpod.io/#/</code>前缀</p>\n<p><a href=\"https://github.com/nginx/nginx\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/nginx/nginx</a> =&gt; <a href=\"https://gitpod.io/#/github.com/nginx/nginx\" target=\"_blank\" rel=\"noopener noreferrer\">https://gitpod.io/#/github.com/nginx/nginx</a></p>\n<p>登陆：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220504230740420.png\" alt=\"image-20220504230740420\"></p>\n<p>加载：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220504230844063-165500134905023.png\" alt=\"image-20220504230844063\"></p>\n<p>运行：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220504230956747-165500134905024.png\" alt=\"image-20220504230956747\"></p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220504225139153-165500134904917.png",
      "date_published": "2022-06-24T00:00:00.000Z",
      "date_modified": "2022-06-12T02:41:10.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "MyEclipsev2021永久激活版",
      "url": "https://blog.ciberviler.top/dev/MyEclipse.html",
      "id": "https://blog.ciberviler.top/dev/MyEclipse.html",
      "summary": "MyEclipsev2021永久激活版",
      "content_html": "<h1 id=\"myeclipsev2021永久激活版\" tabindex=\"-1\"> MyEclipsev2021永久激活版</h1>\n<h3 id=\"激活码\" tabindex=\"-1\"> 激活码</h3>\n<p>1、zLR8ZC-855575-6154505816197416\n2、3LR8ZC-855575-61567256274007429\n3、zLR8ZC-855575-61567256215416341\n4、3LR8ZC-855575-61567256646682235\n5、zLR8ZC-855575-61567256903775584\n6、oLR8ZC-855575-77665356722269248\n7、fLR8ZC-855575-7766535033841152\n8、gLR8ZC-855575-78507056841444089\n9、GLR8ZC-855575-7850705925145157</p>\n<h3 id=\"软件特色\" tabindex=\"-1\"> 软件特色</h3>\n<p>【企业级开发】\n软件为完成工作提供了智能的企业工具。Java EE库和功能是企业级项目的基础，支持部署到几十个企业友好的应用服务器进行快速检测。\n【Java Web开发】\n有了它，你就拥有了所有的Web开发技术。支持快速添加技术功能到Web项目中，使用可视化编辑器以便编码和配置，并且还可以在多种应用服务器上测试你的任务。\n【云开发】\n脱离缓存，使用内置功能连接到云，支持探索和连接服务，为他人提供自己的REST Web服务。无论是定位还是虚拟的微博，它都能轻松地创建云连接。\n【移动开发】\n移动应用开发再也无需使用特殊工具或学习新的编程语言。软件支持使用Java、HTML和JQuery进行编码，使用移动工具创建拥有良好编码的应用，并嵌入到原生iOS和Android应用中。</p>\n<h3 id=\"myeclipse2021破解教程\" tabindex=\"-1\"> MyEclipse2021破解教程</h3>\n<p>1、在软件学堂下载软件安装包，并对压缩包进行解压得到安装程序和破解文件。\n2、然后双击运行软件安装程序，按照安装向导进行安装。\n<img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/202106280930579127.jpg\" alt=\"img\">\n3、接受软件安装协议，点击Next进行下一步。\n<img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/202106280931029971.jpg\" alt=\"img\">\n4、选择软件安装位置，一般默认安装在c盘，用户也可自定义选择其他位置，注意千万不要出现中文目录。\n<img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/202106280931116442.jpg\" alt=\"img\">\n5、软件正在安装中，请用户耐心等待。\n<img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/202106280931181934.jpg\" alt=\"img\">\n6、待到安装完成后，退出安装向导。\n<img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/202106280931248968.jpg\" alt=\"img\">\n7、接下来进入软件主界面，在弹出注册界面，点击Enter License默认进入。\n<img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/202106280931301641123212.jpg\" alt=\"img\">\n8、然后将软件包中的注册码输入到该界面中，再点击Enable Now。\n9、接着载点击Activate Now即可完成激活啦。\n<img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/202106280931445590.jpg\" alt=\"img\"></p>\n<h3 id=\"功能介绍\" tabindex=\"-1\"> 功能介绍</h3>\n<p>1、优化JavaEE开发\n确保企业开发使用的是MyEclipse中当前最新的JavaEE技术，并且它强大的功能随时可用。\n2、保持厂商中立\n如果IBMWebSphere是你企业开发的重要组成部分，那么厂商锁定肯定会阻碍你的选择。你可以让开发更加自由，为WebSphere开发提供了工具，并支持大量的其他关键性技术。\n3、RESTfulWeb服务开发\n支持使用RESTweb服务创建云应用。使用REST特殊工具生成和测试添加到应用中的服务。\n4、项目工作流中保持Maven\n通过标准的Maven项目架构和菜单内置的启动命令，你可以在当前IDE下使用Maven管理项目。</p>\n<h3 id=\"myeclipse-eclipse使用教程\" tabindex=\"-1\"> MyEclipse/Eclipse使用教程</h3>\n<p>设置工作空间编码格式\n点击Windows → preference → WorkSpace\n或者搜索workspace\n选择编码格式，默认为GBK，不过选择UTF-8为好。\n<img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/202107091052554606.jpg\" alt=\"img\">\n成功更改工作空间编码之后，如果对默认字体不适应，可以选择更改字体。\n更改字体\n点击Windows → preference → General →Appearence → Color and Fonts → Basic\n或者搜索Colors and fonts\n选择 Text font ，点击Edit编辑，就可以更改字体了，选择合适的就行。\n<img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/202107091053019148.jpg\" alt=\"img\">\n字体设置完之后，最好顺便设置下注释模版，注释模版就是在使用/** <em>/这种注释的时候，会自动按照所设置的注释模版注释。注释是个好习惯。\n设置注释模版\nClass类的注释模板打开Eclipse/MyEclipse工具，点击 Window-&gt;<a href=\"http://www.xue51.com/zt/Premierebbdq/\" target=\"_blank\" rel=\"noopener noreferrer\">Pr</a>eferences弹出首选项设置窗口，Java-&gt;Code Style-&gt;Code Template选项列表，点击Types。\n<img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/20210709105305842.jpg\" alt=\"img\">\n可以输入/<strong>，然后回车或按shift+alt+j快捷键补齐注释内容。\n<img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/202107091053091687.jpg\" alt=\"img\">\n注释模版代码:\n1、/</strong>\n2、</em> Title: ${type_name}\n3、* Description:\n4、* Version:1.0.0\n5、* @author ${user}\n6、* @date ${date}\n7、*/</p>\n<h3 id=\"常用快捷建\" tabindex=\"-1\"> 常用快捷建</h3>\n<p>Ctrl+H 全局搜索\nCtrl+F 本类搜索以及替换\nCtrl+shift+R 搜索文件\nshift+tab 整体代码向左移\nctrl+shift+↓ 复制当前代码并向下移一行ctrl+shift+R 搜索文件\nctrl+H 搜索所有文件包括代码\nctrl+f 搜索当前页面存盘\nCtrl+s(肯定知道)注释代码\nCtrl+/取消注释\nCtrl+1 快速修复\nCtrl+L 定位在某行\nCtrl+O 快速显示 OutLine\nCtrl+T 快速显示当前类的继承结构\nCtrl+W 关闭当前Editer\nCtrl+K 快速定位到下一个\nCtrl+E 快速显示当前Editer的下拉列表\nCtrl+J 正向增量查找\nCtrl+D: 删除当前行\nCtrl+Alt+↓ 复制当前行到下一行(复制增加)\nCtrl+Alt+↑ 复制当前行到上一行(复制增加)</p>\n",
      "image": "https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/202106280930579127.jpg",
      "date_published": "2022-01-22T00:00:00.000Z",
      "date_modified": "2022-06-12T02:30:32.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "SpringBoot+拦截器+自定义异常+自定义注解+全局异常处理",
      "url": "https://blog.ciberviler.top/dev/SpringBoot.html",
      "id": "https://blog.ciberviler.top/dev/SpringBoot.html",
      "summary": "SpringBoot+拦截器+自定义异常+自定义注解+全局异常处理",
      "content_html": "<h1 id=\"springboot-拦截器-自定义异常-自定义注解-全局异常处理\" tabindex=\"-1\"> SpringBoot+拦截器+自定义异常+自定义注解+全局异常处理</h1>\n<ul>\n<li>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">前言</a></p>\n</li>\n<li>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">资源权限</a></p>\n</li>\n<li>\n<ul>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">1.静态资源准备</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">2.自定义一个异常，便于拦截抛出</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">3.全局异常处理</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">4.controller层</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">5.拦截器创建</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">6.将拦截器注入应用</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">7.验证查看结果</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">操作权限</a></p>\n</li>\n<li>\n<ul>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">1.和上面一样使用静态资源</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">2.自定义注解</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">3.controller层</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">4.修改一下之前的拦截器</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">5.验证结果</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">角色权限</a></p>\n</li>\n<li>\n<ul>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">1.静态对应关系</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">2.修改controller</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">3.修改一下拦截器</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">4.结果测试</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&amp;scene=21&amp;token=899450012&amp;lang=zh_CN#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">总结</a></p>\n</li>\n</ul>\n<hr>\n<h2 id=\"前言\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">前言</a></h2>\n<p>提到权限管理这块肯定很多人第一想到的就是Springboot Security或者是Shiro安全框架，但本文介绍的并不是这两种，不是因为他们不好用，实在是自己太懒了，我觉得一个拦截器加上其他的一些处理就能满足项目的需求，我又何必去多用一个框架呢，这篇文章也不是去对比谁好谁坏，各位自行抉择。</p>\n<p>我将权限管理分为三块：</p>\n<ol>\n<li><strong>资源权限</strong> ：将url当做资源，可以给每个账号动态划分Url权限，访问不同的URl；</li>\n<li><strong>操作权限</strong> ：将所有URL分为增、删、改、查4种操作权限，给用户分配对应的操作权限，如某个用户只有查操作权限那么他就无法做其他的操作；</li>\n<li><strong>角色权限</strong> ：系统有多个角色，每个角色的权限都不同，如一个管理后台有着账号管理模块、商品模块等，为超级管理员的角色就可以看到所有模块并操作，而为售后的角色就只能看到商品模块，即使他知道账号管理模块下的URL也无权限操作。然后为用户设置角色就有对应的权限；</li>\n</ol>\n<blockquote>\n<p>“</p>\n<p>推荐下自己做的 Spring Boot 的实战项目：</p>\n<p><a href=\"https://github.com/YunaiV/ruoyi-vue-pro\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/YunaiV/ruoyi-vue-pro</a></p>\n</blockquote>\n<h2 id=\"资源权限\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">资源权限</a></h2>\n<h3 id=\"_1-静态资源准备\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">1.静态资源准备</a></h3>\n<p>这里方便演示就不直接操作数据库了，对应的权限建表关系也很简单，这里直接建立静态的用户对应的URL关系。</p>\n<div><pre><code>public class Constant {\n    /**\n     * 权限管理\n     */\n    public static Map&lt;Integer,String[]> permission=new HashMap&lt;>();\n    static {\n        String[] frist={\"/url1\",\"/url2\",\"/url3\",\"/url4\",\"/url5\",\"/url6\",\"/url7\"};//用户1所拥有的URL权限\n        String[] second={\"/url1\",\"/url2\",\"/url3\",\"/url4\",\"/url5\"};//用户2所拥有的URL权限\n        String[] third={\"/url1\",\"/url2\",\"/url3\"};//用户3所拥有的URL权限\n        permission.put(1,frist);\n        permission.put(2,second);\n        permission.put(3,third);\n\n    }\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"_2-自定义一个异常-便于拦截抛出\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">2.自定义一个异常，便于拦截抛出</a></h3>\n<div><pre><code>public class APIException extends RuntimeException {\n    private static final long serialVersionUID = 1L;\n    private String msg;\n    public APIException(String msg) {\n        super(msg);\n        this.msg = msg;\n    }\n\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"_3-全局异常处理\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">3.全局异常处理</a></h3>\n<p>便于异常后返回统一规范的结果,正常应该是正常返回自定义Vo，但这里目标是为了演示结果，再加上各位应该都有自己的Vo类，所以这里就不用了</p>\n<div><pre><code>@RestControllerAdvice\npublic class WebExceptionControl {\n    \n    @ExceptionHandler(APIException.class)\n    public String APIExceptionHandler(APIException e) {\n        return e.getMessage();\n    }\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"_4-controller层\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">4.controller层</a></h3>\n<p>很简单创建对应的URL就好</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346343241051.webp\" alt=\"图片\"></p>\n<h3 id=\"_5-拦截器创建\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">5.拦截器创建</a></h3>\n<p>一般是要先验证token，后根据token取到用户对应信息，这里没有登录所以就直接在token里传对应用户的key值了</p>\n<div><pre><code>/**\n * 权限管理URL拦截器\n */\npublic class URLInterceptor implements HandlerInterceptor {\n\n    // 预处理回调方法，在接口调用之前使用  true代表放行  false代表不放行\n    @Override\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {\n        HttpServletRequest httpServletRequest = (HttpServletRequest) request;\n        String token = httpServletRequest.getHeader(\"token\");\n        String requestURL = httpServletRequest.getRequestURI();\n        //1.根据token判断用户是否登录\n        if (token==null){   //正常情况下这里还需判断与redis中的token是否匹配\n            // 如果没有token或者token不匹配, 直接抛出异常  提示未登录\n            throw  new APIException(\"当前用户未登录\");\n        }\n        //2.登录成功后 根据用户token中的信息获取到用户对应的URL权限集合\n        String[] strings = Constant.permission.get(Integer.valueOf(token));\n        boolean hasPermission = false;\n        //3.再根据用户对应的URL集合去与当前请求的URL对比  有匹配的则放行  反之则抛出异常\n        for (int i =0;i&lt;strings.length;i++) {\n            if (strings[i].equals(requestURL)){\n                hasPermission = true;\n                break;\n            }\n        }\n        if (hasPermission){\n            return true;\n        }else {\n            throw  new APIException(\"当前用户没有访问路径\" + requestURL + \"的权限\");\n        }\n    }\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"_6-将拦截器注入应用\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">6.将拦截器注入应用</a></h3>\n<div><pre><code>@Configuration\npublic class WebMvcConfg implements WebMvcConfigurer {\n\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        //权限拦截器\n        registry.addInterceptor(urlInterceptor()).addPathPatterns(\"/**\");\n    }\n    @Bean\n    public URLInterceptor urlInterceptor(){\n        return new URLInterceptor();\n    }\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"_7-验证查看结果\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">7.验证查看结果</a></h3>\n<p>分别在token中传入用户1-3的key，访问不同url就可以看到效果，如下</p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\"><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346343241052.webp\" alt=\"图片\"></a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\"><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346343241053.webp\" alt=\"图片\"></a></p>\n<blockquote>\n<p>“</p>\n<p>推荐下自己做的 Spring Cloud 的实战项目：</p>\n<p><a href=\"https://github.com/YunaiV/onemall\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/YunaiV/onemall</a></p>\n</blockquote>\n<h2 id=\"操作权限\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">操作权限</a></h2>\n<h3 id=\"_1-和上面一样使用静态资源\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">1.和上面一样使用静态资源</a></h3>\n<div><pre><code>public class Constant {\n    /**\n     * 权限管理\n     */\n    public static Map&lt;Integer,String[]> permission=new HashMap&lt;>();\n    static {\n        String[] frist={\"insert\",\"delete\",\"select\",\"update\"};//用户1所拥有的操作权限\n        String[] second={\"insert\",\"select\",\"update\"};//用户2所拥有的URL权限\n        String[] third={\"select\"};//用户3所拥有的URL权限\n        permission.put(1,frist);\n        permission.put(2,second);\n        permission.put(3,third);\n\n    }\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"_2-自定义注解\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">2.自定义注解</a></h3>\n<div><pre><code>@Target(ElementType.METHOD)\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface UrlAnnotation {\n    /**\n     * 操作类型(type):添加,删除,修改,插入\n     * \n     */\n    String type();\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"_3-controller层\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">3.controller层</a></h3>\n<p>打上自定义的注解，代表对应方法是什么操作</p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\"><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346343241054.webp\" alt=\"图片\"></a></p>\n<h3 id=\"_4-修改一下之前的拦截器\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">4.修改一下之前的拦截器</a></h3>\n<p>添加对注解上面的操作类型的获取，并用type类型去对比判断</p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\"><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346343241055.webp\" alt=\"图片\"></a></p>\n<h3 id=\"_5-验证结果\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">5.验证结果</a></h3>\n<p>其他都不变</p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\"><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346343241056.webp\" alt=\"图片\"></a></p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\"><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346343241157.webp\" alt=\"图片\"></a></p>\n<h2 id=\"角色权限\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">角色权限</a></h2>\n<p>这里其实和上面的操作大同小异，我这里简单演示一下，以两个模块为例</p>\n<h3 id=\"_1-静态对应关系\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">1.静态对应关系</a></h3>\n<div><pre><code>public class Constant {\n    /**\n     * 权限管理\n     */\n    public static Map&lt;Integer,String[]> permission=new HashMap&lt;>();\n    static {\n        String[] frist={\"test\",\"test1\"};//用户1所拥有的模块权限  这里的test是模块URL入口  例如：test模块下所有URL都是/test/**\n        String[] second={\"test\"};//用户2所拥有的模块权限\n        permission.put(1,frist); //这里的1其实是用户对应ID为1的角色\n        permission.put(2,second);//这个2同理\n\n    }\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"_2-修改controller\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">2.修改controller</a></h3>\n<p>模拟两个模块</p>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\"><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346343241158.webp\" alt=\"图片\"></a></p>\n<h3 id=\"_3-修改一下拦截器\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">3.修改一下拦截器</a></h3>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\"><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346343241159.webp\" alt=\"图片\"></a></p>\n<h3 id=\"_4-结果测试\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">4.结果测试</a></h3>\n<p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\"><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346343241160.webp\" alt=\"图片\"></a></p>\n<h2 id=\"总结\" tabindex=\"-1\"> <a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247487551&amp;idx=1&amp;sn=18f64ba49f3f0f9d8be9d1fdef8857d9&amp;scene=21#wechat_redirect\" target=\"_blank\" rel=\"noopener noreferrer\">总结</a></h2>\n<p>其实用自定义的拦截器去做权限，不管是什么类型其实都大同小异，根据需求灵活的去处理才是最重要的，上面的静态权限变通一下，建立角色表、用户表、路径表以及对应关系，就很容易做出URL的动态权限配置了，灵活运用自定义注解搭配可以做到更细致。</p>\n",
      "image": "https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346343241051.webp",
      "date_published": "2022-01-15T00:00:00.000Z",
      "date_modified": "2022-06-12T02:30:32.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "Openssl一键自签证书",
      "url": "https://blog.ciberviler.top/dev/openssl%E4%B8%80%E9%94%AE%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6.html",
      "id": "https://blog.ciberviler.top/dev/openssl%E4%B8%80%E9%94%AE%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6.html",
      "summary": "Openssl一键自签证书",
      "content_html": "<h1 id=\"openssl一键自签证书\" tabindex=\"-1\"> Openssl一键自签证书</h1>\n<p><code>vim openssl.sh</code></p>\n<div><pre><code><span>#!/bin/bash</span>\n<span>while</span> <span>[</span><span>[</span> -z <span>\"<span>$domain</span>\"</span> <span>]</span><span>]</span><span>;</span><span>do</span>\n    <span>read</span> -p <span>\"输入域名/IP(必填,如 *.haoduck.com): \"</span> domain\n<span>done</span>\n<span>read</span> -p <span>\"输入邮箱(选填,默认admin@haoduck.com): \"</span> mail\n<span>[</span><span>[</span> -z <span>\"<span>$mail</span>\"</span> <span>]</span><span>]</span> <span>&amp;&amp;</span> <span>mail</span><span>=</span>admin@haoduck.com\n<span>read</span> -p <span>\"输入日期(选填,默认3650): \"</span> day\n<span>[</span><span>[</span> -z <span>\"<span>$day</span>\"</span> <span>]</span><span>]</span> <span>&amp;&amp;</span> <span>day</span><span>=</span><span>3650</span>\n<span>dir</span><span>=</span><span>$domain</span> <span>&amp;&amp;</span> <span>mkdir</span> -p <span>$dir</span>\n<span>crt_file</span><span>=</span><span>\"<span>$dir</span>/<span>${domain}</span>.crt\"</span>\n<span>key_file</span><span>=</span><span>\"<span>$dir</span>/<span>${domain}</span>.key\"</span>\n<span>if</span> <span>[</span><span>[</span> <span>\"<span><span>$(</span><span>command</span> -v openssl<span>)</span></span>\"</span> <span>]</span><span>]</span><span>;</span><span>then</span>\n    openssl req -x509 -nodes -newkey rsa:2048 -days <span>$day</span> -keyout <span>$key_file</span> -out <span>$crt_file</span> -subj <span>\"/C=US/ST=California/L=Los Angeles/O=Haoduck/OU=Aoao/CN=<span>${domain}</span>/emailAddress=<span>${mail}</span>\"</span>\n    <span>echo</span> -e <span>\"<span title=\"\\t\">\\t</span>证书：<span><span>$(</span><span>pwd</span><span>)</span></span>/<span>$crt_file</span><span title=\"\\n\">\\n</span><span title=\"\\t\">\\t</span>私钥：<span><span>$(</span><span>pwd</span><span>)</span></span>/<span>$key_file</span>\"</span>\n<span>else</span>\n    <span>echo</span> <span>\"openssl 未安装\"</span>\n<span>fi</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><code>bash openssl.sh</code></p>\n",
      "date_published": "2022-01-18T00:00:00.000Z",
      "date_modified": "2022-06-12T02:30:32.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "SpringBoot打包不同环境配置与shell脚本部署",
      "url": "https://blog.ciberviler.top/dev/springboot%E6%89%93%E5%8C%85%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E9%83%A8%E7%BD%B2.html",
      "id": "https://blog.ciberviler.top/dev/springboot%E6%89%93%E5%8C%85%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E9%83%A8%E7%BD%B2.html",
      "summary": "SpringBoot打包不同环境配置与shell脚本部署",
      "content_html": "<h1 id=\"springboot打包不同环境配置与shell脚本部署\" tabindex=\"-1\"> SpringBoot打包不同环境配置与shell脚本部署</h1>\n<p>本篇和大家分享的是springboot打包并结合shell脚本命令部署，重点在分享一个shell程序启动工具，希望能便利工作；</p>\n<ul>\n<li>profiles指定不同环境的配置</li>\n<li>maven-assembly-plugin打发布压缩包</li>\n<li>分享shenniu_publish.sh程序启动工具</li>\n<li>linux上使用shenniu_publish.sh启动程序</li>\n</ul>\n<h1 id=\"profiles指定不同环境的配置\" tabindex=\"-1\"> profiles指定不同环境的配置</h1>\n<p>通常一套程序分为了很多个部署环境：开发，测试，uat，线上 等，我们要想对这些环境区分配置文件，可以通过两种方式：</p>\n<ul>\n<li>通过application.yml中编码指定 profile.active=uat 方式指定</li>\n<li>通过mvn中profiles来区分不同环境对应的配置文件夹，人工可以手动在idea勾选生成不同环境的包(推荐)</li>\n</ul>\n<p>这里我们要讲的是第二种，首先在mvn中配置如下内容：</p>\n<div><pre><code> 1     &lt;profiles>\n 2         &lt;profile>\n 3             &lt;id>node&lt;/id>\n 4             &lt;properties>\n 5                 &lt;!--传递给脚本的参数值-->\n 6                 &lt;activeProfile>node&lt;/activeProfile>\n 7                 &lt;package-name>${scripts_packageName}&lt;/package-name>\n 8                 &lt;boot-main>${scripts_bootMain}&lt;/boot-main>\n 9             &lt;/properties>\n10             &lt;activation>\n11                 &lt;activeByDefault>true&lt;/activeByDefault>\n12             &lt;/activation>\n13         &lt;/profile>\n14         &lt;profile>\n15             &lt;id>node1&lt;/id>\n16             &lt;properties>\n17                 &lt;activeProfile>node1&lt;/activeProfile>\n18                 &lt;package-name>${scripts_packageName}&lt;/package-name>\n19                 &lt;boot-main>${scripts_bootMain}&lt;/boot-main>\n20             &lt;/properties>\n21         &lt;/profile>\n22         &lt;profile>\n23             &lt;id>node2&lt;/id>\n24             &lt;properties>\n25                 &lt;activeProfile>node2&lt;/activeProfile>\n26                 &lt;package-name>${scripts_packageName}&lt;/package-name>\n27                 &lt;boot-main>${scripts_bootMain}&lt;/boot-main>\n28             &lt;/properties>\n29         &lt;/profile>\n30     &lt;/profiles>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>节点粗解：</p>\n<ul>\n<li>id：用来指定不同环境配置文件所在的目录，如下我这里：\n<img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/fe69f622e6fd659b563e79a848403dcac97db44d.png\" alt=\"image\"></li>\n<li>properties：该节点中的节点是可作为参数传递给其他配置文件，如我这里的package-name节点值就可以在另外的assembly.xml或者shell脚本文件中通过${package-name}获取到，如下：\n<img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/fd2638a541ecddb2844197770587337bfa4bcc29.png\" alt=\"image\"></li>\n<li>activeByDefault：指定默认环境配置文件夹</li>\n</ul>\n<h1 id=\"maven-assembly-plugin打发布压缩包\" tabindex=\"-1\"> maven-assembly-plugin打发布压缩包</h1>\n<p>对于springboot程序打包，可以分为jar和war，这里是jar包；有场景是咋们配置文件或者第三方等依赖包不想放到工程jar中，并且把这些文件压缩成一个zip包，方便上传到linux；此时通过maven-assembly-plugin和maven-jar-plugin就可以做到，mvn的配置如：</p>\n<div><pre><code> 1            &lt;plugin>\n 2                 &lt;groupId>org.apache.maven.plugins&lt;/groupId>\n 3                 &lt;artifactId>maven-jar-plugin&lt;/artifactId>\n 4                 &lt;version>2.6&lt;/version>\n 5                 &lt;configuration>\n 6                     &lt;archive>\n 7                         &lt;addMavenDescriptor>false&lt;/addMavenDescriptor>\n 8                         &lt;manifest>\n 9                             &lt;addClasspath>true&lt;/addClasspath>\n10                             &lt;classpathPrefix>lib/&lt;/classpathPrefix>\n11                             &lt;mainClass>${scripts_bootMain}&lt;/mainClass>\n12                         &lt;/manifest>\n13                     &lt;/archive>\n14                     &lt;!--打包排除项-->\n15                     &lt;excludes>\n16                         &lt;exclude>**/*.yml&lt;/exclude>\n17                         &lt;exclude>**/*.properties&lt;/exclude>\n18                         &lt;exclude>**/*.xml&lt;/exclude>\n19                         &lt;exclude>**/*.sh&lt;/exclude>\n20                     &lt;/excludes>\n21                 &lt;/configuration>\n22                 &lt;executions>\n23                     &lt;execution>\n24                         &lt;id>make-a-jar&lt;/id>\n25                         &lt;phase>compile&lt;/phase>\n26                         &lt;goals>\n27                             &lt;goal>jar&lt;/goal>\n28                         &lt;/goals>\n29                     &lt;/execution>\n30                 &lt;/executions>\n31             &lt;/plugin>\n32 \n33             &lt;plugin>\n34                 &lt;groupId>org.apache.maven.plugins&lt;/groupId>\n35                 &lt;artifactId>maven-assembly-plugin&lt;/artifactId>\n36                 &lt;version>2.4&lt;/version>\n37                 &lt;!-- The configuration of the plugin -->\n38                 &lt;configuration>\n39                     &lt;!-- Specifies the configuration file of the assembly plugin -->\n40                     &lt;descriptors>\n41                         &lt;descriptor>${project.basedir}/src/main/assembly/assembly.xml&lt;/descriptor>\n42                     &lt;/descriptors>\n43                 &lt;/configuration>\n44                 &lt;executions>\n45                     &lt;execution>\n46                         &lt;id>make-assembly&lt;/id>\n47                         &lt;phase>package&lt;/phase>\n48                         &lt;goals>\n49                             &lt;goal>single&lt;/goal>\n50                         &lt;/goals>\n51                     &lt;/execution>\n52                 &lt;/executions>\n53             &lt;/plugin>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>值得注意的地方如下几点：</p>\n<ul>\n<li>mainClass节点：用来指定启动main函数入口类路径，如这里的：com.sm.EurekaServerApplication</li>\n<li>excludes节点：排除主jar包中配置等一些列后缀文件，因为我们要包这些配置文件放到主包外面</li>\n<li>descriptor节点：用来指定assembly插件对应的assembly.xml配置文件</li>\n</ul>\n<p>有了上面mvn配置，我们还需要assembly.xml的配置，这里提取了结合shell脚本发布程序的配置：</p>\n<div><pre><code> 1 &lt;assembly xmlns=\"http://maven.apache.org/ASSEMBLY/2.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n 2           xsi:schemaLocation=\"http://maven.apache.org/ASSEMBLY/2.0.0 http://maven.apache.org/xsd/assembly-2.0.0.xsd\n 3 http://maven.apache.org/ASSEMBLY/2.0.0 \">\n 4     &lt;id>${activeProfile}&lt;/id>\n 5     &lt;!--打包成一个用于发布的zip文件-->\n 6     &lt;formats>\n 7         &lt;format>zip&lt;/format>\n 8     &lt;/formats>\n 9     &lt;!--true：zip中生成一级目录(此处屏蔽，配合脚本需要profiles后缀)-->\n10     &lt;includeBaseDirectory>false&lt;/includeBaseDirectory>\n11     &lt;dependencySets>\n12         &lt;dependencySet>\n13             &lt;!--打包进zip文件的lib目录-->\n14             &lt;useProjectArtifact>false&lt;/useProjectArtifact>\n15             &lt;outputDirectory>${package-name}-${activeProfile}/lib&lt;/outputDirectory>\n16             &lt;unpack>false&lt;/unpack>\n17         &lt;/dependencySet>\n18     &lt;/dependencySets>\n19 \n20     &lt;fileSets>\n21         &lt;!-- 配置文件打包进zip文件的conf目录 -->\n22         &lt;fileSet>\n23             &lt;directory>${project.basedir}/src/main/profiles/${activeProfile}&lt;/directory>\n24             &lt;outputDirectory>${package-name}-${activeProfile}/conf&lt;/outputDirectory>\n25             &lt;includes>\n26                 &lt;include>**/*&lt;/include>\n27                 &lt;!--&lt;include>*.xml&lt;/include>-->\n28                 &lt;!--&lt;include>*.properties&lt;/include>-->\n29                 &lt;!--&lt;include>*.yml&lt;/include>-->\n30             &lt;/includes>\n31         &lt;/fileSet>\n32 \n33         &lt;!--启动脚本打包进zip文件-->\n34         &lt;fileSet>\n35             &lt;directory>${project.basedir}/src/main/scripts&lt;/directory>\n36             &lt;outputDirectory>&lt;/outputDirectory>\n37             &lt;includes>\n38                 &lt;include>**/*&lt;/include>\n39             &lt;/includes>\n40             &lt;!-- 文件文件权限为777 -->\n41             &lt;fileMode>777&lt;/fileMode>\n42             &lt;!-- 目录权限为777  -->\n43             &lt;directoryMode>777&lt;/directoryMode>\n44             &lt;!--脚本中参数变量为pom中的值 关键-->\n45             &lt;filtered>true&lt;/filtered>\n46         &lt;/fileSet>\n47 \n48         &lt;!-- 项目编译出来的jar打包进zip文件 -->\n49         &lt;fileSet>\n50             &lt;directory>${project.build.directory}&lt;/directory>\n51             &lt;outputDirectory>${package-name}-${activeProfile}/&lt;/outputDirectory>\n52             &lt;includes>\n53                 &lt;include>*.jar&lt;/include>\n54             &lt;/includes>\n55         &lt;/fileSet>\n56     &lt;/fileSets>\n57 &lt;/assembly>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>重点节点介绍：</p>\n<ul>\n<li>formats节点：把配置文件和jar包等压缩成什么文件格式，这里可以有：zip，tar等</li>\n<li>fileMode节点：指定scripts目录下脚本文件(这里是：shenniu_publish.sh)在linux上文件权限为777</li>\n<li>filtered节点：脚本中参数变量为pom的profiles中properties的值(该配置，是把mvn中属性值映射生成到sh文件中，如：${package-name})</li>\n</ul>\n<p>完成上面配置后，此时我们可以通过idea上勾选切换不同环境来打zip包，如图：</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/348819-20190309170559272-1005982868.png\" alt=\"img\"></p>\n<h1 id=\"分享shenniu-publish-sh程序启动工具\" tabindex=\"-1\"> 分享shenniu_publish.sh程序启动工具</h1>\n<p>上面步骤完成了zip格式的发布包，我们再分享下启动程序的shell脚本，该脚本具有的功能如：</p>\n<ul>\n<li>解压zip+启动jar包</li>\n<li>启动jar包</li>\n<li>停止对应jar运行</li>\n<li>重启jar程序</li>\n</ul>\n<p>目前该shell中封装了两种启动jar命令的方式：</p>\n<ul>\n<li>java -cp</li>\n<li>java -jar</li>\n</ul>\n<p>如图命令格式：</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/348819-20190309170514140-1638598831.png\" alt=\"img\"></p>\n<p>来看全部的shell代码：</p>\n<div><pre><code>  1 #!/usr/bin/env bash\n  2 #可变参数变量\n  3 languageType=\"javac\" #支持 java,javac,netcore 发布\n  4 #参数值由pom文件传递\n  5 baseZipName=\"${package-name}-${activeProfile}\" #压缩包名称  publish-test.zip的publish\n  6 packageName=\"${package-name}\" #命令启动包名 xx.jar的xx\n  7 mainclass=\"${boot-main}\" #java -cp启动时，指定main入口类;命令：java -cp conf;lib\\*.jar;${packageName}.jar ${mainclass}\n  8 \n  9 #例子\n 10 # baseZipName=\"publish-test\" #压缩包名称  publish-test.zip的publish\n 11 # packageName=\"publish\" #命令启动包名 publish.jar的xx\n 12 \n 13 #固定变量\n 14 basePath=$(cd `dirname $0`/; pwd)\n 15 baseZipPath=\"${basePath}/${baseZipName}.zip\"  #压缩包路径\n 16 baseDirPath=\"${basePath}\" #解压部署磁盘路径\n 17 pid= #进程pid\n 18 \n 19 #解压\n 20 function shenniu_unzip()\n 21 {\n 22     echo \"解压---------------------------------------------\"\n 23     echo \"压缩包路径：${baseZipPath}\"\n 24     if [ ! `find ${baseZipPath}` ]\n 25     then\n 26         echo \"不存在压缩包：${baseZipPath}\"\n 27     else\n 28         echo \"解压磁盘路径：${baseDirPath}/${baseZipName}\"\n 29         echo \"开始解压...\"\n 30 \n 31         #解压命令\n 32         unzip -od ${baseDirPath}/${baseZipName} ${baseZipPath}\n 33 \n 34         #设置执行权限\n 35         chmod +x ${baseDirPath}/${baseZipName}/${packageName}\n 36 \n 37         echo \"解压完成。\"  \n 38     fi\n 39 }\n 40 \n 41 #检测pid\n 42 function getPid()\n 43 {\n 44     echo \"检测状态---------------------------------------------\"\n 45     pid=`ps -ef | grep -n ${packageName} | grep -v grep | awk '{print $2}'`\n 46     if [ ${pid} ] \n 47     then\n 48         echo \"运行pid：${pid}\"\n 49     else\n 50         echo \"未运行\"\n 51     fi\n 52 }\n 53 \n 54 #启动程序\n 55 function start()\n 56 {\n 57     #启动前，先停止之前的\n 58     stop\n 59     if [ ${pid} ]\n 60     then\n 61         echo \"停止程序失败，无法启动\"\n 62     else\n 63         echo \"启动程序---------------------------------------------\"\n 64         \n 65         #选择语言类型\n 66         read -p \"输入程序类型(java,javac,netcore)，下一步按回车键(默认：${languageType})：\" read_languageType\n 67         if [ ${read_languageType} ]\n 68         then\n 69             languageType=${read_languageType}\n 70         fi\n 71         echo \"选择程序类型：${languageType}\"\n 72 \n 73         #进入运行包目录\n 74         cd ${baseDirPath}/${baseZipName}\n 75 \n 76         #分类启动\n 77         if [ \"${languageType}\" == \"javac\" ] \n 78         then\n 79             if [ ${mainclass} ] \n 80             then\n 81                 nohup java -cp conf:lib\\*.jar:${packageName}.jar ${mainclass} >${baseDirPath}/${packageName}.out 2>&amp;1 &amp;\n 82                #nohup java -cp conf:lib\\*.jar:${packageName}.jar ${mainclass} >/dev/null 2>&amp;1 &amp;\n 83             fi\n 84         elif [ \"${languageType}\" == \"java\" ] \n 85         then\n 86             nohup java -jar ${baseDirPath}/${baseZipName}/${packageName}.jar >/dev/null 2>&amp;1 &amp;\n 87             # java -jar ${baseDirPath}/${baseZipName}/${packageName}.jar\n 88         elif [ \"${languageType}\" == \"netcore\" ] \n 89         then\n 90             #nohup dotnet run ${baseDirPath}/${baseZipName}/${packageName} >/dev/null 2>&amp;1 &amp;\n 91             nohup ${baseDirPath}/${baseZipName}/${packageName} >/dev/null 2>&amp;1 &amp;\n 92         fi\n 93 \n 94         #查询是否有启动进程\n 95         getPid\n 96         if [ ${pid} ]\n 97         then\n 98             echo \"已启动\"\n 99             #nohup日志\n100             tail -n 50 -f ${baseDirPath}/${packageName}.out\n101         else\n102             echo \"启动失败\"\n103         fi\n104     fi\n105 }\n106 \n107 #停止程序\n108 function stop()\n109 {\n110     getPid\n111     if [ ${pid} ] \n112     then\n113         echo \"停止程序---------------------------------------------\"\n114         kill -9 ${pid}\n115         \n116         getPid\n117         if [ ${pid} ] \n118         then\n119             #stop\n120             echo \"停止失败\"\n121         else\n122             echo \"停止成功\"\n123         fi\n124     fi\n125 }\n126 \n127 #启动时带参数，根据参数执行\n128 if [ ${#} -ge 1 ] \n129 then\n130     case ${1} in\n131         \"start\") \n132             start\n133         ;;\n134         \"restart\") \n135             start\n136         ;;\n137         \"stop\") \n138             stop\n139         ;;\n140         \"unzip\") \n141             #执行解压\n142             shenniu_unzip\n143             #执行启动\n144             start\n145         ;;\n146         *) \n147             echo \"${1}无任何操作\"\n148         ;;\n149     esac\n150 else\n151     echo \"\n152     command如下命令：\n153     unzip：解压并启动\n154     start：启动\n155     stop：停止进程\n156     restart：重启\n157 \n158     示例命令如：./shenniu_publish start\n159     \"\n160 fi\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>正如上面小节说的，shell中的参数 package-name，activeProfile，boot-main 都是由mvn中profiles的properties中提供，是可变的参数，脚本代码本身不需要人工去修改，只需要变的是mvn的参数即可；其实在我们生成zip包的时候，shell中的参数就被替换了，可以看zip中shell文件内容如：</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/348819-20190309170701655-1208411312.png\" alt=\"img\"></p>\n<h1 id=\"linux上使用shenniu-publish-sh启动程序\" tabindex=\"-1\"> linux上使用shenniu_publish.sh启动程序</h1>\n<p>把生成的zip上传到linux上，通过命令解压：</p>\n<div><pre><code>1 unzip -od eureka-server-0.0.1-node eureka-server-0.0.1-node.zip\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>其实shell脚本中包含有解压命令，但是我在打包时放在了zip中，所以只能通过手动解压了，当然可以调整；此时进入加压目录如此：</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/348819-20190309170918126-491643739.png\" alt=\"img\"></p>\n<p>注：这里第一次执行./shenniu_publish.sh脚本时候，提示了错误信息；是由于我是在windows上编辑的这个脚本，其空格等和linux上不一样，所以运行会有问题，要解决可以使用vim命令在linux把该文件转成linux格式，如下命令：</p>\n<div><pre><code>1 vim shenniu_publish.sh\n2 set ff=unix\n3 :wq\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>执行完后，再来运行脚本./shenniu_publish.sh，此时有如下提示:</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/348819-20190309171107977-1319405631.png\" alt=\"img\"></p>\n<p>此刻我们文件是解压状态，因此只需要start命令启动程序即可：</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/348819-20190309171127604-1971799892.png\" alt=\"img\"></p>\n<p>到这里shenniu_publish.sh脚本使用就完成了，只要脚本没有提示错误，基本都能启动jar服务；其他restart和stop命令也如此执行就行：</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/348819-20190309171150215-294116419.png\" alt=\"img\"></p>\n<p>可以去研究下shell代码，希望该脚本能给你带来效率和好的学习思路，下面是测试用例git地址，脚本在eureka-server项目中：<a href=\"https://github.com/shenniubuxing3/springcloud-Finchley.SR2\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/shenniubuxing3/springcloud-Finchley.SR2</a></p>\n",
      "image": "https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/fe69f622e6fd659b563e79a848403dcac97db44d.png",
      "date_published": "2022-01-15T00:00:00.000Z",
      "date_modified": "2022-06-12T02:30:32.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "Linux脚本工具",
      "url": "https://blog.ciberviler.top/linux/Linux%E8%84%9A%E6%9C%AC%E5%B7%A5%E5%85%B7.html",
      "id": "https://blog.ciberviler.top/linux/Linux%E8%84%9A%E6%9C%AC%E5%B7%A5%E5%85%B7.html",
      "summary": "Linux脚本工具",
      "content_html": "<h1 id=\"linux脚本工具\" tabindex=\"-1\"> Linux脚本工具</h1>\n<h2 id=\"ednovas-的-toolbox-工具箱\" tabindex=\"-1\"> EdNovas 的 Toolbox 工具箱</h2>\n<p><strong>脚本地址</strong></p>\n<p><a href=\"https://github.com/wdm1732418365/vpstoolbox\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/wdm1732418365/vpstoolbox</a></p>\n<p>最新版：</p>\n<div><pre><code>CODE\n<span>wget</span> -N https://raw.githubusercontent.com/wdm1732418365/vpstoolbox/main/ednovastool.sh <span>&amp;&amp;</span> <span>chmod</span> +x ednovastool.sh <span>&amp;&amp;</span> ./ednovastool.sh\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div>",
      "date_published": "2022-01-21T00:00:00.000Z",
      "date_modified": "2022-06-12T02:30:32.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "MySQL 8",
      "url": "https://blog.ciberviler.top/linux/MySQL.html",
      "id": "https://blog.ciberviler.top/linux/MySQL.html",
      "summary": "MySQL 8",
      "content_html": "<h1 id=\"mysql-8\" tabindex=\"-1\"> MySQL 8</h1>\n<p>mysql从5.7一下子跳跃到了8.0，其中的改变还是很大，有点这里就不说了，小伙伴们自己去百度了解一下，这里重点说一下，安装的事</p>\n<p>1.解压后，文件下下面是没有my.ini 和 data目录的，需要自己新建一个my.ini和data目录</p>\n<p>my.ini的基本代码就这几行配置，足矣，更详细的自己官网上看（F:\\mysql-8.0.11-winx64 是我的解压路径）</p>\n<div><pre><code>\n[mysqld]\n# 设置3306端口\nport=3306\n# 设置mysql的安装目录\nbasedir=E:\\Software\\mysql-8.0.19-winx64\n# 设置mysql数据库的数据的存放目录，在安装mysql-5.7.30-winx64.zip版本的时候，此配置不可添加，否则mysql将无法启动。\n# datadir=E:\\Software\\mysql-8.0.19-winx64\\data\n# 允许最大连接数\nmax_connections=200\n# 允许连接失败的次数。这是为了防止有人从该主机试图攻击数据库系统\nmax_connect_errors=10\n# 服务端使用的字符集默认为UTF8\ncharacter-set-server=utf8\n# 创建新表时将使用的默认存储引擎\ndefault-storage-engine=INNODB\n# 默认使用“mysql_native_password”插件认证\ndefault_authentication_plugin=mysql_native_password\n# 关闭ssl\nskip_ssl\n# 配置时区\ndefault-time_zone='+8:00'\n[mysql]\n# 设置mysql客户端默认字符集\ndefault-character-set=utf8\n[client]\n# 设置mysql客户端连接服务端时默认使用的端口\nport=3306\ndefault-character-set=utf8\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>2.配置环境变量，将解压目录下的bin文件夹的路径配置到系统变量中的path下（F:\\mysql-8.0.11-winx64\\bin）</p>\n<p>3.以管理员身份运行命令提示符</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/856176-20180428143824709-218907811.png\" alt=\"img\"></p>\n<p>如果顺利会产生下面的信息：</p>\n<p>第4行的信息尤其重要，这是初始化密码，请拿笔或者截图记下，这个随机密码会很随机，随机到可能有一些符号；</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/856176-20180428143923105-1817069252.png\" alt=\"img\"></p>\n<p>提示：如果你关了这个窗口，或者没记住，那也没事，删掉初始化的 datadir 目录（就是解压文件夹下的data文件夹）里面的东西，不要删除data文件夹，再执行一遍初始化命令，又会重新生成的。</p>\n<p>4.安装服务 mysqld --install 服务名（可以不写，默认是MySql,如果你的电脑上要安装付哦个mysql,这里的服务名写一下做区分），安装成功后控制它会提示：success ** (忘记了)</p>\n<div><pre><code>mysqld --install [服务名]\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>5.启动服务（这时候不要去登录mysql,登录不进去的，必须要先启动）</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/856176-20180428144751212-1355452928.png\" alt=\"img\"></p>\n<p>6.登录mysql，当然是为了修改密码啊，那个随机密码鬼才能记得住，这时候也不要尝试用图形化管理工具（navicat for mysql）去登录，会报错的，继续往下看</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/856176-20180428145014478-776409826.png\" alt=\"img\"></p>\n<p>这里踩坑的小朋友一般是密码输错了，或者服务没启动，一直登录不进去。</p>\n<p>7.修改密码</p>\n<p>ALTER USER &quot;root&quot;@&quot;localhost&quot; IDENTIFIED BY &quot;你的新密码&quot;;</p>\n<p><strong>注意：重点啊，如果你没有设置认证方式，默认的密码加密方式是：caching_sha2_password，而现在很多客户端工具还不支持这种加密认证方式，连接测试的时候就会报错：client does not support authentication protocol requested by server; consider upgrading MySQL client，这里的错误信息就是不支持身份认证方式，没关系，去my.ini里面在[mysqld]下面加上这句话即可：</strong></p>\n<div><pre><code>default_authentication_plugin=mysql_native_password\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>8.打开远程访问</p>\n<p>对于允许远程访问，有两种角色，一种是我们的root用户，还有一种是非root用户，从安全的角度（我也不知道什么角度，听别人说的，暂且相信着吧），远程访问最后不要用root用户</p>\n<div><pre><code>用root用户访问：\nGRANT ALL PRIVILEGES ON *.* TO 'root'@'%'IDENTIFIED BY '密码' WITH GRANT OPTION;\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>这里允许root用户远程的时候，如果出现如下的错误，就先去把root用的host改成%，再运行上面那句话，对于mysql用户管理这一块不熟悉的朋友们，请看我另一篇博客--mysql 用户及权限管理</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/856176-20180428150157767-1407082633.png\" alt=\"img\"></p>\n<p>非root用户，这里就要先去创建一个用户</p>\n<div><pre><code>切换数据库\nmysql>use mysql;\n\n创建用户(user1:用户名;%:任意ip,也可以指定，root默认就是localhost;123456：登录密码)\nmysql>CREATE USER 'user1'@'%' IDENTIFIED BY '123456';\n\n授权，默认创建的用户权限是usage,就是无权限，只能登录而已，（all：所有权限，这里有select,update等等权限，可以去搜一下；后面的*.*：指定数据库.指定表，这里是所有；to后面就是你刚才创建的用户）mysql>grant all on *.* to 'user1'@'%'；\n注意:用以上命令授权的用户不能给其它用户授权,如果想让该用户可以授权,用以下命令: \nGRANT all ON databasename.tablename TO 'username'@'host' WITH GRANT OPTION; \n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>其他：</p>\n<div><pre><code><span># 修改密码</span>\n<span>ALTER</span> <span>USER</span> <span>'test'</span><span>@'localhost'</span> IDENTIFIED <span>WITH</span> MYSQL_NATIVE_PASSWORD <span>BY</span> <span>'新密码'</span><span>;</span>\n\n<span>ALTER</span> <span>USER</span> <span>'ynau'</span><span>@'localhost'</span> IDENTIFIED <span>WITH</span> MYSQL_NATIVE_PASSWORD <span>BY</span> <span>'123456'</span><span>;</span>\n\n<span># 创建用户</span>\n<span>CREATE</span> <span>USER</span> <span>'ynau'</span><span>@'%'</span> IDENTIFIED <span>BY</span> <span>'123456'</span><span>;</span>\n\n<span>#授权</span>\n<span>grant</span> <span>all</span> <span>on</span> <span>*</span><span>.</span><span>*</span> <span>to</span> <span>'ynau'</span><span>@'%'</span><span>;</span>\n\n<span>#刷新：</span>\nflush <span>privileges</span><span>;</span>\n\n<span>#重启mysql服务</span>\nservice mysqld restart\n\n<span>#验证是否修改成功</span>\nmysql <span>-</span>u test <span>-</span>p\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "image": "https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/856176-20180428143824709-218907811.png",
      "date_published": "2022-01-23T00:00:00.000Z",
      "date_modified": "2022-06-12T02:30:32.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "MySQL压缩版安装配置",
      "url": "https://blog.ciberviler.top/linux/MySQL%E5%8E%8B%E7%BC%A9%E7%89%88%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE.html",
      "id": "https://blog.ciberviler.top/linux/MySQL%E5%8E%8B%E7%BC%A9%E7%89%88%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE.html",
      "summary": "MySQL压缩版安装配置",
      "content_html": "<h1 id=\"mysql压缩版安装配置\" tabindex=\"-1\"> MySQL压缩版安装配置</h1>\n<h2 id=\"_1-下载\" tabindex=\"-1\"> 1 下载</h2>\n<p>官网：<a href=\"https://www.mysql.com/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.mysql.com/</a>\n最新版下载地址：<a href=\"https://dev.mysql.com/downloads/mysql/\" target=\"_blank\" rel=\"noopener noreferrer\">https://dev.mysql.com/downloads/mysql/</a>\n多版本下载地址：<a href=\"https://downloads.mysql.com/archives/community/\" target=\"_blank\" rel=\"noopener noreferrer\">https://downloads.mysql.com/archives/community/</a>\n在这里，我使用的是MySQL8.0.19解压缩版，附上下载链接：<a href=\"https://cdn.mysql.com/archives/mysql-8.0/mysql-8.0.19-winx64.zip\" target=\"_blank\" rel=\"noopener noreferrer\">https://cdn.mysql.com/archives/mysql-8.0/mysql-8.0.19-winx64.zip</a></p>\n<p>此时的MySQL版本已经更新到8.0.23，所以我需要进入多版本链接进行下载。</p>\n<p><strong>注意：</strong></p>\n<ul>\n<li>旧版本中存在漏洞</li>\n<li><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/image-20220115155838758.png\" alt=\"image-20220115155838758\"></li>\n</ul>\n<h2 id=\"_2-安装\" tabindex=\"-1\"> 2 安装</h2>\n<p>1.我们提前创建好解压目录：</p>\n<p>找到刚才下载的压缩包，复制到我们上一步创建的解压目录下：</p>\n<p>右键进行解压，解压后的目录如下图所示：</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDU3NzU0Mw.png\" alt=\"img\"></p>\n<p>接下来创建我们的数据库文件存放位置，这里我在mysql解压目录的同级目录下创建了<code>databases</code>文件夹，作为数据库存放目录</p>\n<p>接下来进行初始化安装：\n用管理员身份打开cmd命令，并进入到mysql解压目录下的bin目录，如：<code>D:\\ProgramFiles\\MySQL8\\bin</code></p>\n<p><strong>2、创建一个名为my.ini的文件：</strong></p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/ZmFuZ3poZW5naGVpdGk.png\" alt=\"img\"></p>\n<p><strong>3、修改my.ini文件：</strong></p>\n<div><pre><code><span>[</span>mysql<span>]</span>\n<span># 设置mysql客户端默认字符集</span>\n<span>default</span><span>-</span><span>character</span><span>-</span><span>set</span><span>=</span>utf8\n<span>[</span>mysqld<span>]</span>\n<span># 设置3306端口</span>\nport <span>=</span> <span>3306</span>\n<span># 设置mysql的安装目录</span>\nbasedir <span>=</span> D:\\\\Program Files\\\\mysql\\\\\n<span># 设置mysql数据库的数据的存放目录</span>\ndatadir <span>=</span> D:\\\\Program Files\\\\mysql\\\\<span>data</span>\n<span># 允许最大连接数</span>\nmax_connections<span>=</span><span>20</span>\n<span># 服务端使用的字符集默认为8比特编码的latin1字符集</span>\n<span>character</span><span>-</span><span>set</span><span>-</span>server<span>=</span>utf8\n<span># 创建新表时将使用的默认存储引擎</span>\n<span>default</span><span>-</span>storage<span>-</span><span>engine</span><span>=</span><span>INNODB</span>\n<span># 创建模式</span>\nsql_mode <span>=</span> NO_ENGINE_SUBSTITUTION<span>,</span>STRICT_TRANS_TABLES\n\n\n\n<span>[</span>mysqld<span>]</span>\n<span># 设置服务端使⽤用的字符集为utf-8</span>\n<span>character</span><span>-</span><span>set</span><span>-</span>server<span>=</span>utf8\n<span># 绑定IPv4地址</span>\nbind<span>-</span>address <span>=</span> <span>127.0</span><span>.0</span><span>.1</span>\n<span># 设置mysql的端⼝口号</span>\nport <span>=</span> <span>3306</span>\n<span># 设置mysql的安装⽬目录</span>\nbasedir<span>=</span>D:<span>/</span>ProgramFiles<span>/</span>MySQL8\n<span># 设置mysql数据库的数据的存放⽬目录</span>\ndatadir<span>=</span>D:<span>/</span>ProgramFiles<span>/</span>MySQL8<span>/</span><span>data</span>\n<span># 允许最⼤大连接数</span>\nmax_connections<span>=</span><span>20</span>\n<span># 创建新表时将使⽤用的默认存储引擎</span>\n<span>default</span><span>-</span>storage<span>-</span><span>engine</span><span>=</span><span>INNODB</span>\n<span>default</span><span>-</span>time_zone<span>=</span><span>'+8:00'</span>\n<span># 设置mysql以及数据库的默认编码</span>\n<span>[</span>mysql<span>]</span>\n<span>default</span><span>-</span><span>character</span><span>-</span><span>set</span><span>=</span>utf8\n<span>[</span>mysql<span>.</span>server<span>]</span>\n<span>default</span><span>-</span><span>character</span><span>-</span><span>set</span><span>=</span>utf8\n<span># 设置客户端默认字符集</span>\n<span>[</span>client<span>]</span>\n<span>default</span><span>-</span><span>character</span><span>-</span><span>set</span><span>=</span>utf8\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>特别要注意：</strong></p>\n<p>（1）D:\\Program Files\\mysql\\data 这个目录一定要是“\\”，千万别弄成“\\”不然会报错，或者可以用“/”；\n（2）Mysq安装目录和数据存放目录一定要修改为你自己设定的目录，除非你设置的目录与上述一致。</p>\n<h2 id=\"_3-配置\" tabindex=\"-1\"> 3.配置</h2>\n<p>3.用管理员身份打开cmd窗口：win -&gt; windows系统 -&gt; 右击命令提示符 -&gt; 更多 -&gt; 以管理员身份运行</p>\n<p>4.进入到bin目录下</p>\n<p>5.执行 <code>mysqld --install</code> 命令安装（执行 <code>mysqld --remove</code> 卸载安装）</p>\n<p>6.继续执行 <code>mysqld --initialize --user=root --console</code> 命令</p>\n<p>注意：初始化完成后MySQL会给root用户创建一个默认随机密码，下图白色部分就是密码，同时在data目录下也添加了相关的配置文件，如果密码有字符辨识不了，则把date目录下的文件都删了，重新执行这一步。</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/1780812-20190829212537656-1187829463.png\" alt=\"img\"></p>\n<p>7.执行<code>net start mysql</code>启动服务（执行<code>net stop mysql</code>关闭服务）</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/1780812-20190829212232857-537058421.png\" alt=\"img\"></p>\n<p>8.执行<code>mysql -uroot -pqLBiVku7k%f</code>登录MySQL（-u后面是用户名，-p后面是密码，即上面的默认随机密码）</p>\n<p>9.修改密码</p>\n<p>mysql版本是7:</p>\n<p><code>set password = password('root');</code></p>\n<p>注意：如果mysql版本是8或以上，则使用 alter user 'root'@'localhost' identified by '新的密码'; 修改密码</p>\n<p><code>ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '123456';</code>\n这样我们就可以将<code>roo</code>t账户的密码修改为<code>123456</code>了，将<code>123456</code>处替换为你们要修改的密码，回车执行就可以了。</p>\n<p>12.登录MySQL后可以添加一个用户</p>\n<p>添加格式：</p>\n<p>grant 权限 on 数据库.表 to 用户名@'IP地址' identified by '密码'</p>\n<p>实例：</p>\n<p><code>grant all on *.* to test@'%' identified by'test'</code></p>\n<h2 id=\"_4-安装错误提示\" tabindex=\"-1\"> 4 安装错误提示</h2>\n<h3 id=\"提示\" tabindex=\"-1\"> 提示</h3>\n<p>安装过程中如果出现以下错误，是我们的电脑缺少运行时环境。\n**注：**在这里我们有出现这种情况，但为了以防万一，还是给大家说一下，这里的图片用的网图，如有侵权，请评论删图！</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/20200131203311761.png\" alt=\"img\"></p>\n<p>解决办法：\n下载vcruntime140_1.dll，链接：<a href=\"https://cn.dll-files.com/vcruntime140_1.dll.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://cn.dll-files.com/vcruntime140_1.dll.html</a></p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/16422331874666.png\" alt=\"在这里插入图片描述\">\n下载完成后，解压提取文件，将提取出来的<code>vcruntime140_1.dll</code>文件复制到我们的<code>C:\\Windows\\System32</code>\n<img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/16422331874677.png\" alt=\"在这里插入图片描述\">\n<strong>注意, 32位版本的<code>vcruntime140_1.dll</code>需要复制到<code>C:\\Windows\\SysWOW64</code>下</strong></p>\n<h3 id=\"tips2\" tabindex=\"-1\"> tips2：</h3>\n<p>mysqld –initialize-insecure自动生成无密码的root用户；\nmysqld –initialize自动生成带随机密码的root用户；\nmysqld -remove移除自己的mysqld服务；\nnet stop mysql命令，停止mysql服务\n如果报错，清空data文件夹，最好还是删掉data文件，重新执行remove--initialize--install--start（这些不是命令）流程即可；</p>\n<h2 id=\"_5-配置mysql的环境变量\" tabindex=\"-1\"> 5 配置mysql的环境变量</h2>\n<div><pre><code>MYSQL_HOME\n\nD<span>:</span>\\<span>Program</span> <span>Files</span>\\mysql\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/20200303112518670.png\" alt=\"img\"></p>\n<p>点击Path，增加：</p>\n<div><pre><code><span>%</span>MYSQL_HOME<span>%</span>\\<span>bin</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/20190831112741174.png\" alt=\"img\"></p>\n",
      "image": "https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/image-20220115155838758.png",
      "date_published": "2022-01-24T00:00:00.000Z",
      "date_modified": "2022-06-12T02:30:32.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "Nginx从安装到高可用",
      "url": "https://blog.ciberviler.top/linux/Nginx%E4%BB%8E%E5%AE%89%E8%A3%85%E5%88%B0%E9%AB%98%E5%8F%AF%E7%94%A8.html",
      "id": "https://blog.ciberviler.top/linux/Nginx%E4%BB%8E%E5%AE%89%E8%A3%85%E5%88%B0%E9%AB%98%E5%8F%AF%E7%94%A8.html",
      "summary": "Nginx从安装到高可用",
      "content_html": "<h1 id=\"nginx从安装到高可用\" tabindex=\"-1\"> Nginx从安装到高可用</h1>\n<div><pre><code>原文：blog.csdn.net/qq_34886352/article/details/103581973\n第1-100期：100期Java项目整理\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h3 id=\"一、nginx安装\" tabindex=\"-1\"> 一、Nginx安装</h3>\n<h5 id=\"_1、去官网http-nginx-org-下载对应的nginx包-推荐使用稳定版本\" tabindex=\"-1\"> 1、去官网<a href=\"http://nginx.org/%E4%B8%8B%E8%BD%BD%E5%AF%B9%E5%BA%94%E7%9A%84nginx%E5%8C%85%EF%BC%8C%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8%E7%A8%B3%E5%AE%9A%E7%89%88%E6%9C%AC\" target=\"_blank\" rel=\"noopener noreferrer\">http://nginx.org/下载对应的nginx包，推荐使用稳定版本</a></h5>\n<h5 id=\"_2、上传nginx到linux系统\" tabindex=\"-1\"> 2、上传nginx到linux系统</h5>\n<h5 id=\"_3、安装依赖环境\" tabindex=\"-1\"> 3、安装依赖环境</h5>\n<p>(1)安装gcc环境</p>\n<div><pre><code>yum install gcc-c++\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>(2)安装PCRE库，用于解析正则表达式</p>\n<div><pre><code>yum install -y pcre pcre-devel\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>(3)zlib压缩和解压缩依赖</p>\n<div><pre><code>yum install -y zlib zlib-devel\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>(4)SSL 安全的加密的套接字协议层，用于HTTP安全传输，也就是https</p>\n<div><pre><code>yum install -y openssl openssl-devel\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h5 id=\"_4、解压-需要注意-解压后得到的是源码-源码需要编译后才能安装\" tabindex=\"-1\"> 4、解压，需要注意，解压后得到的是源码，源码需要编译后才能安装</h5>\n<div><pre><code>tar -zxvf nginx-1.16.1.tar.gz\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h5 id=\"_5、编译之前-先创建nginx临时目录-如果不创建-在启动nginx的过程中会报错\" tabindex=\"-1\"> 5、编译之前，先创建nginx临时目录，如果不创建，在启动nginx的过程中会报错</h5>\n<div><pre><code>mkdir /var/temp/nginx -p\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h5 id=\"_6、在nginx目录-输入如下命令进行配置-目的是为了创建makefile文件\" tabindex=\"-1\"> 6、在nginx目录，输入如下命令进行配置，目的是为了创建makefile文件</h5>\n<div><pre><code>./configure \\   \n--prefix=/usr/local/nginx \\    \n--pid-path=/var/run/nginx/nginx.pid \\    \n--lock-path=/var/lock/nginx.lock \\    \n--error-log-path=/var/log/nginx/error.log \\    \n--http-log-path=/var/log/nginx/access.log \\    \n--with-http_gzip_static_module \\    \n--http-client-body-temp-path=/var/temp/nginx/client \\    \n--http-proxy-temp-path=/var/temp/nginx/proxy \\    \n--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \\    \n--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \\    \n--http-scgi-temp-path=/var/temp/nginx/scgi\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>注：代表在命令行中换行，用于提高可读性配置命令：</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346363259473.jpg\" alt=\"图片\"></p>\n<h5 id=\"_7、make编译-安装\" tabindex=\"-1\"> 7、make编译&amp;安装</h5>\n<div><pre><code>make\nmake install\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h5 id=\"_8、进入sbin目录启动nginx\" tabindex=\"-1\"> 8、进入sbin目录启动nginx</h5>\n<div><pre><code>启动：nginx\n停止：./nginx -s stop\n重新加载：./nginx -s reload\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h3 id=\"二、配置反向代理\" tabindex=\"-1\"> 二、配置反向代理</h3>\n<p>1、配置upstream</p>\n<div><pre><code>upstream [proxyName] {\n    server 192.168.1.173:8080;\n    server 192.168.1.174:8080;\n    server 192.168.1.175:8080;\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>2、配置server</p>\n<div><pre><code>server {\n    listem  80;\n    server_name www.tomcats.com;\n\n    location / {\n        proxy_pass http://tomcats;\n    }\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"三、配置负载均衡\" tabindex=\"-1\"> 三、配置负载均衡</h3>\n<p>nginx默认采用轮训的方式进行负载均衡</p>\n<p>1、使用加权轮询</p>\n<div><pre><code>upstream [proxyName] {\n    server 192.168.1.173:8080 weight=1;\n    server 192.168.1.174:8080 weight=5;\n    server 192.168.1.175:8080 weight=2;\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>2、hash负载均衡</p>\n<div><pre><code>upstream [proxyName] {\n    ip_hash\n\n    server 192.168.1.173:8080;\n    server 192.168.1.174:8080;\n    server 192.168.1.175:8080;\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>hash算法实际上只会计算 192.168.1这段做哈希</p>\n<p>使用ip_hash的注意点：</p>\n<ul>\n<li>不能把后台服务器直接移除，只能标记down.</li>\n</ul>\n<p>3、url hash负载均衡</p>\n<div><pre><code>upstream [proxyName] {\n    hash $request_url;\n\n    server 192.168.1.173:8080;\n    server 192.168.1.174:8080;\n    server 192.168.1.175:8080;\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>4、最小连接负载均衡</p>\n<div><pre><code>upstream [proxyName] {\n    least_conn;\n\n    server 192.168.1.173:8080;\n    server 192.168.1.174:8080;\n    server 192.168.1.175:8080;\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"四、upstream指令参数\" tabindex=\"-1\"> 四、upstream指令参数</h3>\n<ul>\n<li><code>max_conns</code>：限制最大同时连接数 1.11.5之前只能用于商业版</li>\n<li><code>slow_start</code>：单位秒，权重在指定时间内从1上升到指定值，不适用与hash负载均衡、随机负载均衡 如果在 upstream 中只有一台 server，则该参数失效（商业版才有）</li>\n<li><code>down</code>：禁止访问</li>\n<li><code>backup</code>：备用机 只有在其他服务器无法访问的时候才能访问到 不适用与hash负载均衡、随机负载均衡</li>\n<li><code>max_fails</code>：表示失败几次，则标记server已宕机，剔出上游服务 默认值1</li>\n<li><code>fail_timeout</code>：表示失败的重试时间 默认值10</li>\n</ul>\n<p>1、keepalived</p>\n<div><pre><code>upstream [proxyName] {\n    server 192.168.1.173:8080 weight=1;\n    server 192.168.1.174:8080 weight=5;\n    server 192.168.1.175:8080 weight=2;\n\n    keepalive 32; #保持的连接数\n}\n\nserver {\n    listem  80;\n    server_name www.tomcats.com;\n\n    location / {\n        proxy_pass http://tomcats;\n        proxy_http_version 1.1; #连接的协议版本\n        proxy_set_header Connection \"\"; 清空连接请求头\n    }\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>2、控制浏览器缓存</p>\n<div><pre><code>server {\n    listem  80;\n    server_name www.tomcats.com;\n\n    location / {\n        proxy_pass http://tomcats;\n               expires 10s;  #浏览器缓存10秒钟\n               #expires @22h30m  #在晚上10点30的时候过期\n               #expires -1h  #缓存在一小时前时效\n               #expires epoch  #不设置缓存\n               #expires off  #缓存关闭，浏览器自己控制缓存\n               #expires max  #最大过期时间\n    }\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>3、反向代理缓存</p>\n<div><pre><code>upstream [proxyName] {\n    server 192.168.1.173:8080 weight=1;\n    server 192.168.1.174:8080 weight=5;\n    server 192.168.1.175:8080 weight=2;\n}\n\n#proxy_cache_path 设置缓存保存的目录的位置\n#keys_zone设置共享内以及占用的空间大小\n#mas_size 设置缓存最大空间\n#inactive 缓存过期时间，错过此时间自动清理\n#use_temp_path 关闭零时目录\nproxy_cache_path /usr/local/nginx/upsteam_cache keys_zone=mycache:5m max_size=1g inactive=8h use_temp_path=off;\n\nserver {\n    listem  80;\n    server_name www.tomcats.com;\n    #开启并使用缓存\n    proxy_cache mycache;\n    #针对200和304响应码的缓存过期时间\n    proxy_cache_valid 200 304 8h;   \n\n    location / {\n        proxy_pass http://tomcats;\n    }\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"五、配置ssl证书提供https访问\" tabindex=\"-1\"> 五、配置ssl证书提供https访问</h3>\n<h5 id=\"_1-安装ssl模块\" tabindex=\"-1\"> 1. 安装SSL模块</h5>\n<p>要在nginx中配置https，就必须安装ssl模块，也就是: <code>http_ssl_module</code>。</p>\n<p>进入到nginx的解压目录：<code>/home/software/nginx-1.16.1</code></p>\n<p>新增ssl模块(原来的那些模块需要保留)</p>\n<div><pre><code>./configure \\\n--prefix=/usr/local/nginx \\\n--pid-path=/var/run/nginx/nginx.pid \\\n--lock-path=/var/lock/nginx.lock \\\n--error-log-path=/var/log/nginx/error.log \\\n--http-log-path=/var/log/nginx/access.log \\\n--with-http_gzip_static_module \\\n--http-client-body-temp-path=/var/temp/nginx/client \\\n--http-proxy-temp-path=/var/temp/nginx/proxy \\\n--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \\\n--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \\\n--http-scgi-temp-path=/var/temp/nginx/scgi  \\\n--with-http_ssl_module\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>编译和安装</p>\n<div><pre><code>make\nmake install\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h5 id=\"_2、配置https\" tabindex=\"-1\"> 2、配置HTTPS</h5>\n<p>把ssl证书 <code>*.crt</code> 和 私钥 <code>*.key</code> 拷贝到<code>/usr/local/nginx/conf</code>目录中。</p>\n<p>新增 server 监听 443 端口：</p>\n<div><pre><code>server {\n    listen       443;\n    server_name  www.imoocdsp.com;\n    # 开启ssl\n    ssl     on;\n    # 配置ssl证书\n    ssl_certificate      1_www.imoocdsp.com_bundle.crt;\n    # 配置证书秘钥\n    ssl_certificate_key  2_www.imoocdsp.com.key;\n    # ssl会话cache\n    ssl_session_cache    shared:SSL:1m;\n    # ssl会话超时时间\n    ssl_session_timeout  5m;\n    # 配置加密套件，写法遵循 openssl 标准\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;\n    ssl_prefer_server_ciphers on;\n    \n    location / {\n        proxy_pass http://tomcats/;\n        index  index.html index.htm;\n    }\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"六、配置ha-nginx\" tabindex=\"-1\"> 六、配置ha nginx</h3>\n<h5 id=\"_1、安装keepalived\" tabindex=\"-1\"> 1、安装keepalived</h5>\n<p>(1)下载</p>\n<div><pre><code>https://www.keepalived.org/download.html\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>(2)解压</p>\n<div><pre><code>tar -zxvf keepalived-2.0.18.tar.gz\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>(3)使用configure命令配置安装目录与核心配置文件所在位置：</p>\n<div><pre><code>./configure --prefix=/usr/local/keepalived --sysconf=/etc\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><ul>\n<li><strong>prefix</strong>：keepalived安装的位置sysconf：keepalived核心配置文件所在位置，固定位置，改成其他位置则keepalived启动不了，<code>/var/log/messages</code>中会报错</li>\n<li><strong>sysconf</strong>：keepalived核心配置文件所在位置，固定位置，改成其他位置则keepalived启动不了，<code>/var/log/messages</code>中会报错</li>\n</ul>\n<p>配置过程中可能会出现警告信息，如下所示：</p>\n<div><pre><code>*** WARNING - this build will not support IPVS with IPv6. Please install libnl/libnl-3 dev libraries to support IPv6 with IPVS.\n\n# 安装libnl/libnl-3依赖\nyum -y install libnl libnl-devel  \n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>(4)安装keepalived</p>\n<div><pre><code>make &amp;&amp; make install\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>(5)配置文件 在<code>/etc/keepalived/keepalived.conf</code></p>\n<p>(6)忘记安装配置的目录，则通过如下命令找到：</p>\n<div><pre><code>whereis keepalived\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>(7)启动keepalived</p>\n<p>进入sbin目录</p>\n<div><pre><code>./keepalived\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h5 id=\"_2、配置keepalived-主机\" tabindex=\"-1\"> 2、配置keepalived 主机</h5>\n<p>(1)通过命令 <code>vim keepalived.conf</code> 打开配置文件</p>\n<div><pre><code>global_defs { \n    # 路由id：当前安装keepalived的节点主机标识符，保证全局唯一 \n    router_id keep_171 \n} \n\nvrrp_instance VI_1 { \n    # 表示状态是MASTER主机还是备用机BACKUP \n    state MASTER \n    # 该实例绑定的网卡 \n    interface ens33 \n    # 保证主备节点一致即可 \n    virtual_router_id 51 \n    # 权重，master权重一般高于backup，如果有多个，那就是选举，谁的权重高，谁就当选 \n    priority 100 \n    # 主备之间同步检查时间间隔，单位秒 \n    advert_int 2 \n    # 认证权限密码，防止非法节点进入 \n    authentication { \n        auth_type PASS \n        auth_pass 1111 \n    } \n    # 虚拟出来的ip，可以有多个（vip） \n    virtual_ipaddress { \n        192.168.1.161 \n    }\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>附：查看网卡信息命令</p>\n<div><pre><code>ip addr\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>(2)启动keepalived</p>\n<p>(3)查看进程</p>\n<div><pre><code>ps -ef|grep keepalived\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>(4)查看vip(虚拟ip)</p>\n<p>在网卡ens33下，多了一个<code>192.168.1.161</code>，这个就是虚拟ip</p>\n<h5 id=\"_3、把keepalived注册为系统服务\" tabindex=\"-1\"> 3、把keepalived注册为系统服务</h5>\n<p>(1)拷贝配置文件</p>\n<ul>\n<li>将keepalived目录下<code>etc/init.d/keepalived</code>拷贝到<code>/etc/init.d/</code>下</li>\n<li>将keepalived目录下<code>etc/sysconfig/keepalived</code>拷贝到<code>/etc/sysconfig/</code>下</li>\n</ul>\n<p>(2)刷新systemctl</p>\n<div><pre><code>systemctl daemon-reload\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>(3)启动、停止、重启keepalived</p>\n<div><pre><code>#启动\nsystemctl start keepalived.service\n#停止\nsystemctl stop keepalived.service\n#重启\nsystemctl restart keepalived.service\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h5 id=\"_4、实现双机主备高可用\" tabindex=\"-1\"> 4、实现双机主备高可用</h5>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346363259474.webp\" alt=\"图片\"></p>\n<p>(1)修改备机配置</p>\n<div><pre><code>global_defs { \n    router_id keep_172 \n} \nvrrp_instance VI_1 { \n    # 备用机设置为BACKUP \n    state BACKUP \n    interface ens33 \n    virtual_router_id 51 \n    # 权重低于MASTER \n    priority 80 \n    advert_int 2 \n    authentication { \n        auth_type PASS auth_pass 1111 \n    }\n    virtual_ipaddress {\n        # 注意：主备两台的vip都是一样的，绑定到同一个vip \n        192.168.1.161 \n    } \n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>(2) 启动 Keepalived</p>\n<p>(3) 访问vip即可访问主机，当主机失效时访问vip就会访问到备机</p>\n<h5 id=\"_5、keepalived配置nginx自动重启\" tabindex=\"-1\"> 5、keepalived配置nginx自动重启</h5>\n<p>(1)编写脚本</p>\n<p>在<code>/etc/keepalived/</code>下创建脚本<code>check_nginx_alive_or_not</code></p>\n<div><pre><code>#!/bin/bash \n\nA=`ps -C nginx --no-header |wc -l` \n# 判断nginx是否宕机，如果宕机了，尝试重启 \nif [ $A -eq 0 ];then \n    /usr/local/nginx/sbin/nginx \n    # 等待一小会再次检查nginx，如果没有启动成功，则停止keepalived，使其启动备用机 \n    sleep 3 \n        if [ `ps -C nginx --no-header |wc -l` -eq 0 ];then \n            killall keepalived \n        fi \nfi\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>(2)添加运行权限</p>\n<div><pre><code>chmod +x /etc/keepalived/check_nginx_alive_or_not.sh\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>(3)配置keepalived监听nginx脚本</p>\n<div><pre><code>vrrp_script check_nginx_alive { \n    script \"/etc/keepalived/check_nginx_alive_or_not.sh\" \n    interval 2 # 每隔两秒运行上一行脚本 \n    weight 10 # 如果脚本运行失败，则升级权重+10 \n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>(4)在vrrp_instance中新增监控的脚本</p>\n<div><pre><code>track_script { \n    check_nginx_alive # 追踪 nginx 脚本\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>(5)重启Keepalived使得配置文件生效</p>\n<div><pre><code>systemctl restart keepalived\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h5 id=\"_6、keepalived双主热备\" tabindex=\"-1\"> 6、keepalived双主热备</h5>\n<p>(1)配置DNS轮询</p>\n<p>在同一个域名下配置两个ip，自行百度</p>\n<p>(2)配置第一台主机</p>\n<div><pre><code>global_defs {\n    router_id keep_171 \n} \nvrrp_instance VI_1 { \n    state MASTER i\n    nterface ens33 \n    virtual_router_id 51 \n    priority 100 \n    advert_int 1 \n    authentication { \n        auth_type PASS \n        auth_pass 1111 \n    } \n    virtual_ipaddress { \n        192.168.1.161 \n    } \n} \n\nvrrp_instance VI_2  {\n    state BACKUP \n    interface ens33 \n    virtual_router_id 52 \n    priority 80 \n    advert_int 1 \n    authentication { \n        auth_type PASS \n        auth_pass 1111 \n    } \n    virtual_ipaddress { \n        192.168.1.162 \n    }\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>(3)配置第二台主机</p>\n<div><pre><code>global_defs {\n    router_id keep_172 \n} \nvrrp_instance VI_1 { \n    state BACKUP \n    interface ens33 \n    virtual_router_id 51 \n    priority 80 \n    advert_int 1 \n    authentication { \n        auth_type PASS \n        auth_pass 1111 \n    } \n    virtual_ipaddress { \n        192.168.1.161\n    }\n} \n\nvrrp_instance VI_2 {\n    state MASTER \n    interface ens33 \n    virtual_router_id 52 \n    priority 100 \n    advert_int 1 \n    authentication { \n        auth_type PASS \n        auth_pass 1111 \n    } \n    virtual_ipaddress { \n        192.168.1.162 \n    }\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>(4)重启两台Keepalived</p>\n<div><pre><code>systemctl restart keepalived\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h3 id=\"七、lvs-linux-virtual-server-实现高可用负载均衡\" tabindex=\"-1\"> 七、LVS（Linux Virtual Server）实现高可用负载均衡</h3>\n<h5 id=\"_1、为什么要使用lvs-nginx\" tabindex=\"-1\"> 1、为什么要使用LVS+Nginx</h5>\n<ul>\n<li>lvs基于四层负载均衡，工作效率较Nginx的七层负载更高，使用LVS搭建Nginx集群，可以提高性能</li>\n<li>四层负载均衡无法对信息处理，只能通过ip+端口的形式转发，所以需要七成负载进行数据的处理</li>\n<li>Nginx接收请求来回，LVS可以只接受不响应</li>\n</ul>\n<h5 id=\"_2、lvs的三种模式\" tabindex=\"-1\"> 2、LVS的三种模式</h5>\n<p>(1)NAT模式</p>\n<ul>\n<li>客户端将请求发往LVS，LVS会选择一台服务器响应请求，服务器将结果返回给LVS，LVS再返回给客户端。</li>\n<li>在NAT模式中，服务器的网关必须指向LVS，否则报文无法送达客户端</li>\n<li>NAT 技术将请求的报文和响应的报文都需要通过LVS进行地址改写，因此网站访问量比较大的时候负载均衡调度器有比较大的瓶颈，一般要求最多之能 10-20 台节点</li>\n<li>NAT 模式支持对 IP 地址和端口进行转换。即用户请求的端口和真实服务器的端口可以不一致</li>\n</ul>\n<p>(2)TUN模式</p>\n<ul>\n<li>客户端将请求发往LVS，LVS会选择一台服务器响应请求，在客户端与服务器之间建立隧道，返回结果的时候直接由服务器返回响应，不在经过LVS。</li>\n<li>TUN模式必须所有的服务器上都绑定VIP的IP地址，所有的服务器都必须有网卡。</li>\n<li>TUN模式走隧道运维难度大，并且会直接暴露服务器地址</li>\n<li>服务器将应答包直接发给用户。所以，减少了负载均衡器的大量数据流动，负载均衡器不再是系统的瓶颈，就能处理很巨大的请求量，这种方式，一台负载均衡器能够为很多服务器进行分发。而且跑在公网上就能进行不同地域的分发</li>\n</ul>\n<p>(3)DR模式</p>\n<ul>\n<li>客户端将请求发往LVS，LVS会选择一台服务器响应请求，返回结果的时候通过统一的路由进行返回，不在经过LVS。</li>\n<li>和TUN模式一样，LVS只是分发请求，应答包通过单独的路由返回给客户端，与TUN相比这种方式不需要隧道结构，可以兼容大多数的操作系统，同时统一路由可以隐藏真实的物理服务器。DR模式效率更高，但配置更复杂.</li>\n<li>所有服务器节点和LVS只能在一个局域网里面。</li>\n</ul>\n<h5 id=\"_3、搭建lvs-dr模式\" tabindex=\"-1\"> 3、搭建LVS-DR模式</h5>\n<p>先关闭掉服务器上网络配置管理器，避免网络接口冲突</p>\n<div><pre><code>systemctl stop NetworkManager\nsystemctl disable NetworkManager\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>(1)创建子接口（创建LVS的虚拟ip）</p>\n<p>进入网卡配置目录<code>/etc/sysconfig/network-scripts/</code>,找到网卡配置文件，这里以<code>ifcfg-ens33</code>为例，拷贝并创建子接口</p>\n<div><pre><code>cp ifcfg-ens33 ifcfg-ens33:1\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>修改子接口配置如下</p>\n<ul>\n<li>配置中的 192.168.1.150 就是vip，是提供给外网用户访问的ip地址</li>\n</ul>\n<div><pre><code>DEVICE=\"ens33:1\"\nONBOOT=\"yes\"\nIPADDR=192.168.1.150\nNETMASK=255.255.255.0\nBOOTPROTO=static\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><ul>\n<li>重启网络服务</li>\n</ul>\n<div><pre><code>service network restart\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>重启成功后，ip addr 查看一下，你会发现多了一个ip，也就是虚拟ip（vip）</p>\n<blockquote>\n<p>注意：阿里云不支持配置网卡，需要购买相应的负载均衡服务，腾讯云支持配置网卡，但需要购买网卡支持，一个网卡支持10个虚拟ip配置</p>\n</blockquote>\n<p>(2)安装ipvsadm</p>\n<p>如今的centos都集成了LVS，所以ipvs是自带的，我们只需要安装ipvsadm即可（ipvsadm是管理集群的工具，通过ipvs可以管理集群，查看集群等操作）</p>\n<div><pre><code>yum install ipvsadm\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>(3)配置服务器（RS）的虚拟ip</p>\n<p>进入网卡配置目录<code>/etc/sysconfig/network-scripts/</code>,找到<code>ifcfg-lo</code>，拷贝并创建子接口</p>\n<div><pre><code>cp ifcfg-lo ifcfg-lo:1\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>修改子接口配置如下</p>\n<div><pre><code>DEVICE=\"lo:1\"\nIPADDR=192.168.1.150\nNETMASK=255.255.255.255\nNETWORK=127.0.0.0\nBROADCAST=127.255.255.255\nONBOOT=\"yes\"\nNAME=loopback\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>重启网络服务成功后，<code>ip addr</code> 查看一下，你会发现多了一个ip，也就是虚拟ip（vip）</p>\n<p>(4)为服务器（RS）配置arp</p>\n<p>ARP响应级别与通告行为参数说明</p>\n<div><pre><code>arp-ignore：ARP响应级别（处理请求）\n    0：只要本机配置了ip，就能响应请求\n    1：请求的目标地址到达对应的网络接口，才会响应请求\narp-announce：ARP通告行为（返回响应）\n    0：本机上任何网络接口都向外通告，所有的网卡都能接受到通告\n    1：尽可能避免本网卡与不匹配的目标进行通告2：只在本网卡通告\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>打开sysctl.conf:</p>\n<div><pre><code>vim /etc/sysctl.conf\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>配置所有网卡、默认网卡以及虚拟网卡的arp响应级别和通告行为，分别对应：all，default，lo</p>\n<div><pre><code># configration for lvs \nnet.ipv4.conf.all.arp_ignore = 1 \nnet.ipv4.conf.default.arp_ignore = 1 \nnet.ipv4.conf.lo.arp_ignore = 1 \n\nnet.ipv4.conf.all.arp_announce = 2 \nnet.ipv4.conf.default.arp_announce = 2 \nnet.ipv4.conf.lo.arp_announce = 2\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>刷新配置文件</p>\n<div><pre><code>sysctl -p\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>增加一个网关，用于接收数据报文，当有请求到本机后，会交给lo去处理</p>\n<div><pre><code>route add -host 192.168.1.150 dev lo:1\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>将网关添加至开机启动</p>\n<div><pre><code>echo \"route add -host 192.168.1.150 dev lo:1\" >> /etc/rc.local\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>(4)使用ipvsadm配置集群规则</p>\n<p>创建LVS节点，用户访问的集群调度者</p>\n<div><pre><code>ipvsadm -A -t 192.168.1.150:80 -s rr -p 5\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><ul>\n<li>-A：添加集群</li>\n<li>-t：tcp协议ip地址：设定集群的访问</li>\n<li>ip：也就是LVS的虚拟ip</li>\n<li>-s：设置负载均衡的算法，</li>\n<li>rr：表示轮询</li>\n<li>-p：设置连接持久化的时间,在指定时间内同一个用户的请求会访问到同一个服务器中</li>\n</ul>\n<p>创建多台RS真实服务器</p>\n<div><pre><code>ipvsadm -a -t 192.168.1.150:80 -r 192.168.1.171:80 -g \nipvsadm -a -t 192.168.1.150:80 -r 192.168.1.172:80 -g\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><ul>\n<li>-a：添加真实服务器</li>\n<li>-t：tcp协议</li>\n<li>-r：真实服务器的ip地址</li>\n<li>-g：设定DR模式</li>\n</ul>\n<p>保存到规则库，否则重启失效</p>\n<div><pre><code>ipvsadm -S\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>检查集群</p>\n<div><pre><code>#查看集群列表\nipvsadm -Ln\n#查看集群状态\nipvsadm -Ln --stats\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>一些其他命令</p>\n<div><pre><code> # 重启ipvsadm，重启后需要重新配置 \n service ipvsadm restart \n # 查看持久化连接 \n ipvsadm -Ln --persistent-conn \n # 查看连接请求过期时间以及请求源ip和目标ip \n ipvsadm -Lnc \n # 设置tcp tcpfin udp 的过期时间（一般保持默认） \n ipvsadm --set 1 1 1 \n # 查看过期时间 \n ipvsadm -Ln --timeout\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>(5)访问虚拟ip，完成LVS搭建</p>\n<h3 id=\"附-lvs的负载均衡算法\" tabindex=\"-1\"> 附：LVS的负载均衡算法</h3>\n<h5 id=\"_1-静态算法\" tabindex=\"-1\"> (1)静态算法</h5>\n<p>静态：根据LVS本身自由的固定的算法分发用户请求。</p>\n<ul>\n<li>轮询（Round Robin 简写’rr’）：轮询算法假设所有的服务器处理请求的能力都一样的，调度器会把所有的请求平均分配给每个真实服务器。（同Nginx的轮询）</li>\n<li>加权轮询（Weight Round Robin 简写’wrr’）：安装权重比例分配用户请求。权重越高，被分配到处理的请求越多。（同Nginx的权重）</li>\n<li>源地址散列（Source Hash 简写’sh’）：同一个用户ip的请求，会由同一个RS来处理。（同Nginx的ip_hash）</li>\n<li>目标地址散列（Destination Hash 简写’dh’）：根据url的不同，请求到不同的RS。（同Nginx的url_hash）</li>\n</ul>\n<h5 id=\"_2-动态算法\" tabindex=\"-1\"> (2)动态算法</h5>\n<p>动态：会根据流量的不同，或者服务器的压力不同来分配用户请求，这是动态计算的。</p>\n<ul>\n<li>\n<p>最小连接数（Least Connections 简写’lc’）：把新的连接请求分配到当前连接数最小的服务器。</p>\n</li>\n<li>\n<p>加权最少连接数（Weight Least Connections 简写’wlc’）：服务器的处理性能用数值来代表，权重越大处理的请求越多。Real Server 有可能会存在性能上的差异，wlc动态获取不同服务器的负载状况，把请求分发到性能好并且比较空闲的服务器。</p>\n</li>\n<li>\n<p>最短期望延迟（Shortest Expected Delay 简写’sed’）：特殊的wlc算法。举例阐述，假设有ABC三台服务器，权重分别为1、2、3 。如果使用wlc算法的话，当一个新请求进来，它可能会分给ABC中的任意一个。使用sed算法后会进行如下运算：</p>\n</li>\n<li>\n<ul>\n<li>A：（1+1）/1=2</li>\n<li>B：（1+2）/2=3/2</li>\n<li>C：（1+3）/3=4/3</li>\n</ul>\n</li>\n</ul>\n<p>最终结果，会把这个请求交给得出运算结果最小的服务器。最少队列调度（Never Queue 简写’nq’）：永不使用队列。如果有Real Server的连接数等于0，则直接把这个请求分配过去，不需要在排队等待运算了（sed运算）。</p>\n<h3 id=\"八、搭建keepalived-lvs-nginx高可用集群负载均衡\" tabindex=\"-1\"> 八、搭建Keepalived+Lvs+Nginx高可用集群负载均衡</h3>\n<p>如果原先服务器上配置了LVS+nginx需要清空ipvsadm中的配置</p>\n<div><pre><code>ipvsadm -C\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>如果配置了<code>Keepalived+Nginx</code>双主集群也需要去除掉Keepalived中原先的配置，按照的后文进行配置</p>\n<h5 id=\"_1-使用keepalived配置master-lvs\" tabindex=\"-1\"> (1)使用keepalived配置Master LVS</h5>\n<p>在LVS的机器上安装keepalived，安装过程参考上文</p>\n<p>(1)修改keepalived的配置</p>\n<div><pre><code>global_defs {\n    router_id keep_151 \n} \nvrrp_instance VI_1 { \n    state MASTER \n    interface ens33 \n    virtual_router_id 41 \n    priority 100 \n    advert_int 1 \n    authentication { \n        auth_type PASS \n        auth_pass 1111 \n    } \n    virtual_ipaddress { \n        192.168.1.150\n    }\n} \n\n#配置集群访问的ip+端口，端口和nginx保持一致\nvirtual_server 192.168.1.150 80{\n    #健康检查的时间，单位：秒\n    delay_loop 6\n    #配置负载均衡的算法，默认的轮询\n    lb_algo rr\n    #设置LVS的模式 NAT|TUN|DR\n    lb-kind DR\n    #设置会话持久化的时间\n    persistence_timeout 5\n    #协议\n    protocol TCP\n    \n    #配置负载均衡的真实服务器，也就是nginx节点的具体的ip地址\n    real_server 192.168.1.171 80{\n        #轮询权重配比\n        weight 1\n        #设置健康检查\n        TCP_CHECK {\n            #检查80端口\n            connect_port 80\n            #超时时间\n            connect_timeout 2\n            #重试次数\n            nb_get_retry 2\n            #重试间隔时间\n            delay_before_retry 3\n        }\n    }\n    real_server 192.168.1.171 80{\n        weight 1\n        TCP_CHECK {\n            connect_port 80\n            connect_timeout 2\n            nb_get_retry 2\n            delay_before_retry 3\n        }\n    }\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>(2)启动/重启keepalived</p>\n<div><pre><code>systemctl restart keepalived\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h5 id=\"_2-使用keepalived配置backup-lvs\" tabindex=\"-1\"> (2)使用keepalived配置Backup LVS</h5>\n<p>配置在备用机上</p>\n<div><pre><code>global_defs {\n    router_id keep_152 \n} \nvrrp_instance VI_1 { \n    state  BACKUP\n    interface ens33 \n    virtual_router_id 41 \n    priority 50 \n    advert_int 1 \n    authentication { \n        auth_type PASS \n        auth_pass 1111 \n    } \n    virtual_ipaddress { \n        192.168.1.150\n    }\n} \n\n#配置集群访问的ip+端口，端口和nginx保持一致\nvirtual_server 192.168.1.150 80{\n    #健康检查的时间，单位：秒\n    delay_loop 6\n    #配置负载均衡的算法，默认的轮询\n    lb_algo rr\n    #设置LVS的模式 NAT|TUN|DR\n    lb-kind DR\n    #设置会话持久化的时间\n    persistence_timeout 5\n    #协议\n    protocol TCP\n    \n    #配置负载均衡的真实服务器，也就是nginx节点的具体的ip地址\n    real_server 192.168.1.171 80{\n        #轮询权重配比\n        weight 1\n        #设置健康检查\n        TCP_CHECK {\n            #检查80端口\n            connect_port 80\n            #超时时间\n            connect_timeout 2\n            #重试次数\n            nb_get_retry 2\n            #重试间隔时间\n            delay_before_retry 3\n        }\n    }\n    real_server 192.168.1.171 80{\n        weight 1\n        TCP_CHECK {\n            connect_port 80\n            connect_timeout 2\n            nb_get_retry 2\n            delay_before_retry 3\n        }\n    }\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "image": "https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346363259473.jpg",
      "date_published": "2022-01-16T00:00:00.000Z",
      "date_modified": "2022-06-12T02:30:32.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "SSH客户端软件",
      "url": "https://blog.ciberviler.top/linux/SSH%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BD%AF%E4%BB%B6.html",
      "id": "https://blog.ciberviler.top/linux/SSH%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BD%AF%E4%BB%B6.html",
      "summary": "SSH客户端软件",
      "content_html": "<h1 id=\"ssh客户端软件\" tabindex=\"-1\"> SSH客户端软件</h1>\n<p>SSH客户端是在管理和配置Linux服务器用到很多的软件了，一款好的SSH管理软件不但可以让你更好地执行<a href=\"https://www.v1tx.com/post/linux-commands/\" target=\"_blank\" rel=\"noopener noreferrer\">Linux命令</a>，对于工作效率的提升也是非常明显，在本文中我们就来介绍几款非常好用的SSH客户端软件</p>\n<h2 id=\"xshell\" tabindex=\"-1\"> Xshell</h2>\n<p>Xshell Plus Linux连接SSH工具 v7.0.0092 特别版</p>\n<p><a href=\"https://lanzoui.com/b010yn1di\" target=\"_blank\" rel=\"noopener noreferrer\">https://lanzoui.com/b010yn1di</a></p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/2019103708637-800x493.jpg\" alt=\"Xshell\"></p>\n<p><a href=\"https://www.netsarang.com/zh/xshell/\" target=\"_blank\" rel=\"noopener noreferrer\">Xshell</a> 是国内比较流行的SSH软件，和其他的SSH客户端相比，Xshell更加注重用户体验的一些东西，比如其现代化的界面，多种语言包括简体中文支持，代码高亮等，对于新手非常友好。</p>\n<p>Xshell中还提供了一些高级功能，比如标签管理、批量命令等，不过有一些为高级功能，需要升级付费版才能使用，当然，因为现在很多操作都可以在<a href=\"https://www.v1tx.com/post/best-hosting-control-panels/\" target=\"_blank\" rel=\"noopener noreferrer\">网站面板</a>完成，对于新手来说，其实Xshell免费版本已经足够了，而专业人员使用频率足够高的话付费购买也是非常值得的</p>\n<h2 id=\"finalshell\" tabindex=\"-1\"> Finalshell</h2>\n<p>FinalShell v3.9.2 破解版SSH工具</p>\n<p><a href=\"https://lanzoui.com/iAZxSx022ah\" target=\"_blank\" rel=\"noopener noreferrer\">https://lanzoui.com/iAZxSx022ah</a></p>\n<ul>\n<li>点击菜单-&gt;激活/升级-&gt;登陆/激活，即破解离线激活高级版！</li>\n</ul>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/20190911171724.jpg\" alt=\"img\"></p>\n<p><a href=\"http://www.hostbuf.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Finalshell</a> 是一款国人开发的远程连接工具，支持 Windows、Linux 和 macOS，通过界面我们可以看出这款软件非常强大，你不仅可以在远程窗口上执行命令，还可以实时监测到系统的消耗，比如CPU、内存、网络等资源的使用量</p>\n<p>Finalshell 还有比较方便的一点就是文件的传输，在软件的右下角有一个文件夹管理界面，让你可以像在<a href=\"https://www.v1tx.com/post/best-ftp-client/\" target=\"_blank\" rel=\"noopener noreferrer\">FTP软件</a>中那样传输文件，支持右键上传下载，支持鼠标拖拽文件上传到服务器，省去了很多命令行的繁琐步骤</p>\n<p>除了基础功能，Finalshell 还可以升级到专业版，包括打包传输、高级网络监控、高级进程管理、多地点ping监控等</p>\n<h2 id=\"windterm-v2-2-0\" tabindex=\"-1\"> WindTerm v2.2.0</h2>\n<p>连接SSH/Telnet/Serial/Shell/Sftp开源工具</p>\n<p>项目地址:<a href=\"https://github.com/kingToolbox/WindTerm/\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/kingToolbox/WindTerm/</a>\n<a href=\"https://lanzoui.com/iafhqwr0fba\" target=\"_blank\" rel=\"noopener noreferrer\">https://lanzoui.com/iafhqwr0fba</a></p>\n<h2 id=\"nxshell-v1-4-6\" tabindex=\"-1\"> NxShell v1.4.6</h2>\n<p>绿色版/安装版 : <a href=\"https://lanzoui.com/b010z3paf\" target=\"_blank\" rel=\"noopener noreferrer\">https://lanzoui.com/b010z3paf</a></p>\n<h2 id=\"mobaxterm\" tabindex=\"-1\"> MobaXterm</h2>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/2019101843976-800x496.jpg\" alt=\"MobaXterm\"></p>\n<p><a href=\"https://mobaxterm.mobatek.net/\" target=\"_blank\" rel=\"noopener noreferrer\">MobaXterm</a> 是一个功能强大的SSH工具，除了支持基本的SSH终端管理外，还有非常多的增强和扩展功能</p>\n<ul>\n<li>有绿色版本软件，使用方便</li>\n<li>多标签管理，随时切换</li>\n<li>支持SSH、Telent、FTP、SFTP等多种协议</li>\n<li>支持RDP远程连接Windows</li>\n<li>图形化SFTP管理，可上传下载文件</li>\n<li>内置MobaTextEditor，可以直接在服务端编辑和保存文件</li>\n<li>应用内分屏，最多支持4个屏幕</li>\n<li>支持安装插件</li>\n</ul>\n<p>MobaXterm 是一个非常好的一站式服务器管理工具，对于多种协议的支持，让其不管是Linux、Windows还是VNC等，都可以在一个软件中进行操作管理，配合内置的SFTP文件管理和MobaTextEditor，可以让远程终端文件管理更加便捷</p>\n<p><a href=\"https://www.v1tx.com/post/mobaxterm/\" target=\"_blank\" rel=\"noopener noreferrer\">MobaXterm 多功能的Windows终端工具</a></p>\n<h2 id=\"termius\" tabindex=\"-1\"> Termius</h2>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/20200101100956-1024x670.jpg\" alt=\"img\"></p>\n<p><a href=\"https://termius.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Termius</a> 是一款全平台的SSH客户端，该软件最大的特点就是支持全部平台，包括Windows、Mac、Linux、iOS、Android等，有了移动设备支持，只要有网络，你可以在任何时间地点管理服务器</p>\n<p>如果你的工作经常用到SSH连接，还可以升级高级版实现全平台同步，全平台的好处就是只要你在一个平台添加或修改了服务器，其他平台会自动同步，随时随地管理主机，而且也不用在手机上输入复杂的密码了</p>\n<p>在功能上，Termius 也有很多实用的东西，比如SFTP、代码片段、选项卡等，可以省下很多事情</p>\n<h2 id=\"putty\" tabindex=\"-1\"> PuTTY</h2>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/2019163024711-800x505.jpg\" alt=\"PuTTY\"></p>\n<p><a href=\"https://www.putty.org/\" target=\"_blank\" rel=\"noopener noreferrer\">PuTTY</a> 是一款开源免费的SSH客户端，支持SCP，SSH，Telnet，rlogin等多种网络协议，该软件的特点非常小巧，大小只有1M左右， 而且有绿色版本下载下来就能使用，再加上其开源的特性，很多人都一直在使用PuTTY管理Linux服务器，不过由于软件是全英文的界面，而且有些东西需要学习设置，对新手来说可能并不是那么友好</p>\n<h2 id=\"simpleremote\" tabindex=\"-1\"> SimpleRemote</h2>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/20190911170438-1024x568.jpg\" alt=\"img\"></p>\n<p><a href=\"http://www.91fk.net/\" target=\"_blank\" rel=\"noopener noreferrer\">SimpleRemote</a> 是一款免费开源的远程连接管理工具，软件非常的小巧，解压后只有不到3MB的大小</p>\n<p>虽然是一款很小的软件，但是基本远程连接功能都有，比如常用的多标签、配色方案、密钥连接、RDP、Telnet等，对于大多数人来说，功能完全够用，而且对于重要的信息，还可以为SimpleRemote设置打开密码，只有输入正确的密码才能使用</p>\n<h2 id=\"zoc-terminal\" tabindex=\"-1\"> ZOC Terminal</h2>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/2019171854023-800x570.jpg\" alt=\"ZOC Terminal\"></p>\n<p><a href=\"https://www.emtec.com/zoc/\" target=\"_blank\" rel=\"noopener noreferrer\">ZOC Terminal</a> 是一款强大的终端模拟器，其支持Windows和Mac平台，软件使用很方便，可以快速连接、也可以保存主机，支持多标签、多窗口，如果你对基础的界面不满意，还可以定制样式，包括背景、字体、颜色等，组成自己喜欢的界面，不过这款软件并没有提供免费版本，需要付费购买</p>\n<h2 id=\"juicessh\" tabindex=\"-1\"> JuiceSSH</h2>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/20201202073329-1024x499.jpg\" alt=\"Android SSH客户端 JuiceSSH\"></p>\n<p><a href=\"https://juicessh.com/\" target=\"_blank\" rel=\"noopener noreferrer\">JuiceSSH</a> 是一款Android上的免费SSH客户端，你可以用它快速连接到Linux服务器，也可以添加账号密码或密钥保存多台机器，Juice 让你在手机上就能非常方便地执行这些操作</p>\n<p>它的主要功能有</p>\n<ul>\n<li>全彩色终端显示，多个主题可选</li>\n<li>轻松输入，弹出键盘可以方便地输入常用的特殊字符</li>\n<li>Telnet 和 本地 Shell 命令执行</li>\n<li>第三方插件支持，比如性能监控、OpenSSH导入等</li>\n<li>其他高级功能</li>\n</ul>\n<p>对于想要在安卓手机上管理服务器的人来说，JuiceSSH 是一个非常好的选择，免费版本以及足够使用，付费版还有更多强大功能，包括端口转发、自动执行代码段、快捷方式等，能够极大提升运维效率</p>\n<h2 id=\"servercat\" tabindex=\"-1\"> ServerCat</h2>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/20201202073517-1024x515.jpg\" alt=\"iOS SSH客户端 ServerCat\"></p>\n<p><a href=\"https://apps.apple.com/cn/app/servercat-linux-%E7%9B%91%E6%8E%A7-ssh-%E7%BB%88%E7%AB%AF/id1501532023\" target=\"_blank\" rel=\"noopener noreferrer\">ServerCat</a> 是一款iOS平台上的Linux管理软件，它可以让你在iPhone上连接远程服务器，用来监视系统性能、管理Docker和执行SSH命令，软件内提供了很多监控参数，比如CPU、内存、系统负载、网速、硬盘等，并且以可视化的形式展示，你可以随时查看自己服务器的系统状态，避免因负载过高则影响产品服务</p>\n<h2 id=\"shellfish\" tabindex=\"-1\"> ShellFish</h2>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/20210719141114-1024x517.jpg\" alt=\"iPhone和iPad上的SSH客户端 ShellFish\"></p>\n<p><a href=\"https://apps.apple.com/cn/app/secure-shellfish/id1336634154\" target=\"_blank\" rel=\"noopener noreferrer\">ShellFish</a> 是一款SFTP和SSH结合的软件，支持iPhone和iPad，你可以用它来连接远程服务并管理上面的文件，它专为移动设备做了很多优化，比如你可以使用SFTP管理服务器上的文件，使用专用键盘执行命令，创建代码片段快速使用等，而且还有一个很不错的地方在于它是支持<a href=\"https://www.v1tx.com/post/shortcuts/\" target=\"_blank\" rel=\"noopener noreferrer\">快捷指令</a>的，你可以和其他APP配合使用，使用语音执行命令等</p>\n",
      "image": "https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/2019103708637-800x493.jpg",
      "date_published": "2022-01-17T00:00:00.000Z",
      "date_modified": "2022-06-12T02:30:32.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "python安装源",
      "url": "https://blog.ciberviler.top/linux/python%E5%AE%89%E8%A3%85%E6%BA%90.html",
      "id": "https://blog.ciberviler.top/linux/python%E5%AE%89%E8%A3%85%E6%BA%90.html",
      "summary": "python安装源",
      "content_html": "<h1 id=\"python安装源\" tabindex=\"-1\"> python安装源</h1>\n<p>在<code>C:\\Users\\Administrator\\pip</code>下，新建<code>pip.ini</code>，输入以下内容：</p>\n<div><pre><code><span>[</span><span>global</span><span>]</span>\ntimeout <span>=</span> <span>6000</span>\nindex<span>-</span>url <span>=</span> https<span>:</span><span>//</span>mirrors<span>.</span>aliyun<span>.</span>com<span>/</span>pypi<span>/</span>simple<span>/</span>\n<span>[</span>install<span>]</span>\nuse<span>-</span>mirrors <span>=</span> true\nmirrors <span>=</span> https<span>:</span><span>//</span>mirrors<span>.</span>aliyun<span>.</span>com<span>/</span>pypi<span>/</span>simple<span>/</span>\ntrusted<span>-</span>host <span>=</span> mirrors<span>.</span>aliyun<span>.</span>com\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>其他：</p>\n<div><pre><code><span>[</span><span>global</span><span>]</span>\n<span># 阿里云</span>\nindex<span>-</span>url <span>=</span> https<span>:</span><span>//</span>mirrors<span>.</span>aliyun<span>.</span>com<span>/</span>pypi<span>/</span>simple<span>/</span> \n<span># 清华大学</span>\n<span># index-url = https://pypi.tuna.tsinghua.edu.cn/simple/</span>\n<span># 中国科技大学</span>\n<span># index-url = https://pypi.mirrors.ustc.edu.cn/simple/ </span>\n<span># 豆瓣</span>\n<span># index-url = http://pypi.douban.com/simple </span>\n<span># Python官方</span>\n<span># index-url = https://pypi.python.org/simple/ </span>\n<span># v2ex</span>\n<span># index-url = http://pypi.v2ex.com/simple/ </span>\n<span># 中国科学院</span>\n<span># index-url = http://pypi.mirrors.opencas.cn/simple/ </span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "date_published": "2022-01-19T00:00:00.000Z",
      "date_modified": "2022-06-12T02:30:32.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "StartAllBack",
      "url": "https://blog.ciberviler.top/pc/StartAllBack(StartIsBack)v3.2.1Stable.html",
      "id": "https://blog.ciberviler.top/pc/StartAllBack(StartIsBack)v3.2.1Stable.html",
      "summary": "StartAllBack",
      "content_html": "<h1 id=\"startallback\" tabindex=\"-1\"> StartAllBack</h1>\n<p>StartAllBack(StartIsBack) v3.2.1 Stable</p>\n<p>Windows11开始菜单增强工具StartAllBack正式版发布了！在任务栏上为Windows 11恢复经典样式的Windows 7主题风格开始菜单，主要功能包括：恢复和改进开始菜单样式、个性化任务栏、资源管理器等功能。</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/2021101417221273.png\" alt=\"img\"></p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/2021101417221337.png\" alt=\"StartAllBack(StartIsBack++) v3.2.1 Stable\">\n<img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/2021101417221672.png\" alt=\"StartAllBack(StartIsBack++) v3.2.1 Stable\">\n<img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/2021101417221711.png\" alt=\"StartAllBack(StartIsBack++) v3.2.1 Stable\"></p>\n<h2 id=\"新版变化\" tabindex=\"-1\"> 新版变化</h2>\n<p>StartIsBack for Windows 11\n<a href=\"https://www.startallback.com/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.startallback.com/</a></p>\n<p>2021.12.18 v3.2.1\n- 修复 Xbox 应用大小未调整的问题\n- 修复更新或重启后选项丢失的问题</p>\n<p>最近主要更新：\n- 支持DEV渠道开发者预览版~22500\n- 支持带有经典任务栏中心的开始菜单</p>\n<p><strong>特点描述</strong></p>\n<p>√ 破解免激活，无30天试用期，无哭脸表情水印！\n√ 全面更新中文语言翻译，优化对齐简体中文字串\n√ 剥离升级程序，无升级提示弹窗，去选项检查更新项\n√ 采用原版7zSFX自解压形式重新打包，支持静默安装</p>\n<p>静默安装参数：/ai /gm2\n无人值守安装示例：\n<code>StartAllBack_Repack.exe /ai /gm2</code>\n或右键解压后执行：\n<code>StartAllBackCfg.exe /install /elevated /silent</code></p>\n<h2 id=\"下载地址\" tabindex=\"-1\"> 下载地址</h2>\n<hr>\n<p>Win11经典开始菜单 StartAllBack v3.2.1.4211 中文破解版</p>\n<p><a href=\"https://www.123pan.com/s/A6cA-ODHJh\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.123pan.com/s/A6cA-ODHJh</a></p>\n<p><a href=\"https://423down.lanzouo.com/b0f1rgl8j\" target=\"_blank\" rel=\"noopener noreferrer\">https://423down.lanzouo.com/b0f1rgl8j</a></p>\n<p><a href=\"https://pan.baidu.com/s/1nBlz81CCOQDPcKgkKEF-jg\" target=\"_blank\" rel=\"noopener noreferrer\">https://pan.baidu.com/s/1nBlz81CCOQDPcKgkKEF-jg</a></p>\n<hr>\n<p>StartAllBack 3.2.1.4211 Final (2021/12/18)\n<a href=\"https://s3.amazonaws.com/startisback/StartAllBack_3.2.1_setup.exe\" target=\"_blank\" rel=\"noopener noreferrer\">https://s3.amazonaws.com/startisback/StartAllBack_3.2.1_setup.exe</a></p>\n<p>StartAllBack v2.x-3.x+ Patch (2021/10/13)\n<a href=\"https://423down.lanzouo.com/i1YBsva4eqf\" target=\"_blank\" rel=\"noopener noreferrer\">https://423down.lanzouo.com/i1YBsva4eqf</a></p>\n",
      "image": "https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/2021101417221273.png",
      "date_published": "2022-01-16T00:00:00.000Z",
      "date_modified": "2022-06-12T02:30:32.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "win10快捷键",
      "url": "https://blog.ciberviler.top/pc/win10%E5%BF%AB%E6%8D%B7%E9%94%AE.html",
      "id": "https://blog.ciberviler.top/pc/win10%E5%BF%AB%E6%8D%B7%E9%94%AE.html",
      "summary": "win10快捷键",
      "content_html": "<h1 id=\"win10快捷键\" tabindex=\"-1\"> win10快捷键</h1>\n<h3 id=\"_1-win10-自定义\" tabindex=\"-1\"> 1.win10 自定义</h3>\n<p>Win 10 下快捷方式设置了快捷键一直无法呼出。</p>\n<p>在目录：</p>\n<p>C:\\Users\\xxxxxx\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs</p>\n<p>将要运行的程序的快捷方式放在这里，在快捷方式上--&gt;右键--&gt;属性增加快捷键即可呼出应用。</p>\n<h3 id=\"_2-winhotkey\" tabindex=\"-1\"> 2.WinhotKey</h3>\n<p><em>WinhotKey</em>是一款专业的全局快捷键设置软件,可以通过设置热键来实现相应的动作,包括打开文件或文件夹、调用Windows各种功能、执行相应动作等</p>\n",
      "date_published": "2022-02-07T00:00:00.000Z",
      "date_modified": "2022-06-12T02:30:32.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "卸载windows服务，删除 windows 服务",
      "url": "https://blog.ciberviler.top/pc/%E5%88%A0%E9%99%A4%20windows%20%E6%9C%8D%E5%8A%A1.html",
      "id": "https://blog.ciberviler.top/pc/%E5%88%A0%E9%99%A4%20windows%20%E6%9C%8D%E5%8A%A1.html",
      "summary": "卸载windows服务，删除 windows 服务",
      "content_html": "<h1 id=\"卸载windows服务-删除-windows-服务\" tabindex=\"-1\"> 卸载windows服务，删除 windows 服务</h1>\n<h2 id=\"方法-步骤\" tabindex=\"-1\"> 方法/步骤</h2>\n<ol>\n<li>\n<p>1</p>\n<p>windows提供了基于命令窗口删除服务的功能，就是在命令窗口输入</p>\n<p><strong>sc delete 服务名称</strong></p>\n<p>在窗口输入上面的命令就能删除了。下面详细说明。</p>\n</li>\n<li>\n<p>2</p>\n<p><strong>确定&quot;服务名称&quot;</strong>，&quot;服务名称&quot;并不是我们在服务列表里直接看到的名称，我们看到的是服务的&quot;显示名称&quot;,查看服务名称的方法，就是在要删除的服务上右击，选择&quot;属性&quot;，这时就能看到真正的&quot;服务名称&quot;。比如下面的例子我们要删除“SQL Server Browser”服务，其真实的服务名称为“SQLBrowser”</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/d9a8d2d2bb665159594c639f8fe23ea23b42c7a1.jpg\" alt=\"怎么卸载windows服务，删除 windows 服务\"></p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/116b1ae23ea23a424176d3a53733ec3835bbc0a1.jpg\" alt=\"怎么卸载windows服务，删除 windows 服务\"></p>\n</li>\n<li>\n<p>3</p>\n<p><strong>执行”sc delete 服务名称“</strong>，打开命令窗口，输入  ”sc delete &quot;+刚才查看到的服务名称，回车就会提示删除成功。这里我们输入  <code>sc delete SQLBrowser</code> ，提示删除成功后，在服务窗口列表里也删除掉了。</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/a151a233ec3834bbffe3d1ea8714c27bd3823da6.jpg\" alt=\"怎么卸载windows服务，删除 windows 服务\"></p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/0d55dc7bd28286894d4ac40465f97fbd4d7c37a6.jpg\" alt=\"怎么卸载windows服务，删除 windows 服务\"></p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/7efc527c34b33c41c0b6a0f4887de137c8762ea6.jpg\" alt=\"怎么卸载windows服务，删除 windows 服务\"></p>\n</li>\n</ol>\n",
      "image": "https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/d9a8d2d2bb665159594c639f8fe23ea23b42c7a1.jpg",
      "date_published": "2022-01-27T00:00:00.000Z",
      "date_modified": "2022-06-12T02:30:32.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "安装WSA-激活GPU-双击安装APK",
      "url": "https://blog.ciberviler.top/pc/%E5%AE%89%E8%A3%85WSA-%E6%BF%80%E6%B4%BBGPU-%E5%8F%8C%E5%87%BB%E5%AE%89%E8%A3%85APK.html",
      "id": "https://blog.ciberviler.top/pc/%E5%AE%89%E8%A3%85WSA-%E6%BF%80%E6%B4%BBGPU-%E5%8F%8C%E5%87%BB%E5%AE%89%E8%A3%85APK.html",
      "summary": "安装WSA-激活GPU-双击安装APK",
      "content_html": "<h1 id=\"安装wsa-激活gpu-双击安装apk\" tabindex=\"-1\"> 安装WSA-激活GPU-双击安装APK</h1>\n<p>仅支持Windows11（包含正式版、RP、Beta、Dev）\n》》》 目 录 《《《\n1.安装WSA本体（必装）\n2.激活GPU（普通用户请跳过！！！）\n3.安装“安装程序”（选装）\n4.安装ADB（选装）\n5.安装Android应用\n6.卸载Android应用\n7.注意事项\n8.参考链接</p>\n<p>【1 安装WSA本体】\n-\n① 微软商店程序抓包网址： <a href=\"https://store.rg-adguard.net/\" target=\"_blank\" rel=\"noopener noreferrer\">查看链接</a>\n② WSA微软商店链接： <a href=\"https://www.microsoft.com/store/productId/9P3395VX91NR\" target=\"_blank\" rel=\"noopener noreferrer\">查看链接</a>\n-\n1.打开①链接，在输入框中输入②，选择Slow通道，确认，下载最底下的&quot;MicrosoftCorporationII.WindowsSubsystemForAndroid_1.7.32815.0_neutral_~_8wekyb3d8bbwe.msixbundle&quot;\n(注：四个选项与Windows渠道相对应，Fast-Dev渠道，Slow-Beta渠道，RP-RP渠道和Retail-正式版，目前只有Beta版本有发布)</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_b9fb4b26_4742_3909@854x219.png.m.jpg\" alt=\"img\"></p>\n<p>输入下载地址，选择正确通道</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_6e58f04a_4742_3911@1234x333.png.m.jpg\" alt=\"img\"></p>\n<p>选择最新安装包</p>\n<p>2.右键Windodws徽标，选择&quot;Windows终端（管理员）&quot;输入命令 add-appxpackage &quot;文件路径/文件名&quot;，回车，安装完成</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_d413f6bb_4742_3913@834x644.png.m.jpg\" alt=\"img\"></p>\n<p>打开终端</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_6907ae9d_4742_3915@1129x631.png.m.jpg\" alt=\"img\"></p>\n<p>输入指令</p>\n<p>3.开启主板虚拟化支持，具体按照各BIOS进行设置（新购买电脑一般已开启主板虚拟化支持）\n4.系统中开启Hyper-V和虚拟机平台，打开资源管理器，在路径中输入中文&quot;控制面板&quot;，回车，即可进入控制面板，选择程序-程序和功能-启用或关闭Windows功能，开启&quot;Hyper-V&quot;和&quot;虚拟机平台&quot;，确定，重启</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_fac9b857_1334_2244@1499x962.png.m.jpg\" alt=\"img\"></p>\n<p>资源管理器可以直接进入控制面板</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_c335fb7e_1334_2246@1499x962.png.m.jpg\" alt=\"img\"></p>\n<p>按图开启Windows功能</p>\n<p>5.完成，Enjoy it.</p>\n<p>【2 激活GPU】（普通用户无需进行该项设置！！！）\n-\nINTEL英特尔：\n<a href=\"https://www.intel.com/content/www/us/en/download/19344/intel-graphics-windows-10-windows-11-dch-drivers.html\" target=\"_blank\" rel=\"noopener noreferrer\">查看链接</a>\nNVIDIA英伟达（经验证无效，请使用官网最新驱动）：\n<a href=\"https://developer.nvidia.com/cuda/wsl/download\" target=\"_blank\" rel=\"noopener noreferrer\">查看链接</a>\nAMD超微半导体：\n<a href=\"https://www.amd.com/en/support/kb/release-notes/rn-rad-win-wsl-support\" target=\"_blank\" rel=\"noopener noreferrer\">查看链接</a>\nopengl3支持：\n<a href=\"https://www.microsoft.com/store/productId/9NQPSL29BFFF\" target=\"_blank\" rel=\"noopener noreferrer\">查看链接</a>\n-\n1.下载安装对应显卡驱动和opengl3支持，安装后重启\n（注：具体是否成功受概率等玄学因素影响，Intel驱动如果安装失败可尝试再次安装；未测试是否影响调用，建议普通用户跳过该步骤）\n2.设置中开启高性能模式，设置-系统-显示-图形，应用的自定义选项-浏览，添加WSA，选择WSA，图形首选项选择高性能，保存</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_7b0d9d68_3027_155@1775x1115.png.m.jpg\" alt=\"img\"></p>\n<p>打开设置</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_d40bb361_3027_1552@1775x1115.png.m.jpg\" alt=\"img\"></p>\n<p>添加WSA</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_6185d916_3027_1554@1775x1115.png.m.jpg\" alt=\"img\"></p>\n<p>选项中选择高性能模式</p>\n<p>3.显卡设置中开启高性能模式（以N卡为例，集显和A卡请自测），NVIDIA控制面板-管理3D设置-添加-选择WSA，确定，并调整WSA首选图形处理器为高性能NVIDIA处理器</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_1a2bee58_3028_9618@974x1199.png.m.jpg\" alt=\"img\"></p>\n<p>打开NVIDIA控制面板并添加WSA</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_c9c477e5_3028_9619@974x718.png.m.jpg\" alt=\"img\"></p>\n<p>选择高性能NVIDIA处理器</p>\n<p>4.重启，完成</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_451e5133_3028_9621@503x909.png.m.jpg\" alt=\"img\"></p>\n<p>安兔兔GPU显示分数，但很低</p>\n<p>【3 安装“安装程序”】\n-\nAPKInstaller： <a href=\"https://github.com/Paving-Base/APK-Installer/releases\" target=\"_blank\" rel=\"noopener noreferrer\">查看链接</a></p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_b0236f41_4742_3917@835x388.png.m.jpg\" alt=\"img\"></p>\n<p>安装程序可以直接桌面显示apk且可以双击安装</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_76800999_4742_3919@636x405.png.m.jpg\" alt=\"img\"></p>\n<p>以WinUi的界面进行安卓程序的安装</p>\n<p>-\n1.下载最新压缩包，如&quot;APKInstaller.Package._0.0.1.0_Test.rar&quot;\n2.解压缩\n3.开启旁加载模式，设置-隐私和安全性-开发者选项-开启&quot;从任意源（包括松散文件）安装应用&quot;</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_3f879f05_4742_392@1775x1115.png.m.jpg\" alt=\"img\"></p>\n<p>打开开发人员模式</p>\n<p>4.右键msixbundle文件，如&quot;APKInstaller (Package)_0.0.1.0_x86_x64_arm64.msixbundle&quot;，属性-数字签名-双击签名列表中的签名-查看证书-安装证书-本地计算机-将所有的证书都放入下列储存-受信任人-完成</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_e89acd6b_6561_4202@1352x952.png.m.jpg\" alt=\"img\"></p>\n<p>打开属性</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_ef4554ea_4742_3922@2091x745.png.m.jpg\" alt=\"img\"></p>\n<p>安装程序证书 1</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_bef29485_4742_3924@1072x746.png.m.jpg\" alt=\"img\"></p>\n<p>安装程序证书 2</p>\n<p>5.双击msixbundle文件，如&quot;APKInstaller (Package)_0.0.1.0_x86_x64_arm64.msixbundle&quot;，自动安装框架，然后提示安装失败\n6.右键&quot;Install.ps1&quot;选择&quot;使用PowerShell运行&quot;</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_ee8ded6d_4746_3735@1352x952.png.m.jpg\" alt=\"img\"></p>\n<p>安装程序本体</p>\n<p>7.安装完成</p>\n<p>【4 安装ADB】\n-\n最新ADB： <a href=\"https://dl.google.com/android/repository/platform-tools-latest-windows.zip\" target=\"_blank\" rel=\"noopener noreferrer\">查看链接</a>\n-\n1.下载解压缩，将文件夹内的所有文件复制到&quot;C:\\Users\\用户名&quot;下即可</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_772f1dd4_4746_3737@1365x957.png.m.jpg\" alt=\"img\"></p>\n<p>安装adb在正确的位置，无需配置环境变量</p>\n<p>【5 安装Android应用】\n-\n方法一（ADB安装）：\n1.打开&quot;Windows Subsystem for Android™&quot;，打开&quot;开发人员模式&quot;</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_43576668_4746_3739@1003x813.png.m.jpg\" alt=\"img\"></p>\n<p>打开WSA</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_2a149b56_4746_374@1200x932.png.m.jpg\" alt=\"img\"></p>\n<p>开启开发人员模式，注意未启动WSA不能安装程序</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_9f6776e4_4746_3742@636x388.png.m.jpg\" alt=\"img\"></p>\n<p>启动WSA</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_ffb679db_4746_3744@1200x932.png.m.jpg\" alt=\"img\"></p>\n<p>启动成功，可以安装应用</p>\n<p>2.确保已正确安装ADB，Win+R，输入&quot;CMD&quot;，回车，输入指令&quot;adb connect 127.0.0.1:58526&quot;\n3.&quot;adb install （将安装文件拖入此处）&quot;，回车，安装完成\n-\n方法二（安装器安装）：\n1.确保已正确安装APKInstaller，双击.apk的安卓程序进行安装，根据指引打开&quot;开发人员模式&quot;\n（注：Android子系统必须处于开机状态才能进行安装，可以点击WSA中&quot;开发人员模式&quot;下&quot;管理开发人员设置&quot;唤醒）</p>\n<p>【6 卸载Android应用】\n-\n1.列表中直接右键卸载即可</p>\n<p>【7 注意事项】\n1.该教程基于Windows11专业版制作，如家庭版没有某些选项，可以百度其他打开的方式\n2.如果遇到鼠标无法点击的情况，如登录酷安，可以使用tab键切换组件\n3.提示WiFi连接问题：<a href=\"https://www.uso.cn/post/view/47990\" target=\"_blank\" rel=\"noopener noreferrer\">查看链接</a>\n4.PowerShell运行ps1文件的问题：<a href=\"https://m.jb51.net/os/win10/728455.html\" target=\"_blank\" rel=\"noopener noreferrer\">查看链接</a>\n5.Windows家庭版没有PowerShell的问题：<a href=\"https://blog.csdn.net/houmenghu/article/details/103876847\" target=\"_blank\" rel=\"noopener noreferrer\">查看链接</a></p>\n<p>【8 参考链接】\n-\nWSA安装： <a href=\"https://www.coolapk.com/feed/30833815?shareKey=NGRjZTFhMjYxNTQ2NjE3MmNmMmU~&amp;shareUid=538951&amp;shareFrom=com.coolapk.market_11.4.3\" target=\"_blank\" rel=\"noopener noreferrer\">查看链接</a>\nGPU驱动： <a href=\"https://www.coolapk.com/feed/30854918?shareKey=Y2ZiMjNmN2E4NWM2NjE3MmNmMmU~&amp;shareUid=538951&amp;shareFrom=com.coolapk.market_11.4.3\" target=\"_blank\" rel=\"noopener noreferrer\">查看链接</a>\nAPKInstaller： <a href=\"https://www.coolapk.com/feed/30857122?shareKey=OTAzN2JmMDBmZTg3NjE3MmNmMDM~&amp;shareUid=538951&amp;shareFrom=com.coolapk.market_11.4.3\" target=\"_blank\" rel=\"noopener noreferrer\">查看链接</a></p>\n",
      "image": "https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/538951_b9fb4b26_4742_3909@854x219.png.m.jpg",
      "date_published": "2022-02-11T00:00:00.000Z",
      "date_modified": "2022-06-12T02:30:32.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "开源后台管理系统",
      "url": "https://blog.ciberviler.top/source_code/%E5%BC%80%E6%BA%90%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F.html",
      "id": "https://blog.ciberviler.top/source_code/%E5%BC%80%E6%BA%90%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F.html",
      "summary": "开源后台管理系统",
      "content_html": "<h1 id=\"开源后台管理系统\" tabindex=\"-1\"> 开源后台管理系统</h1>\n<p><strong>1. D2admin</strong></p>\n<p>开源地址：<a href=\"https://github.com/d2-projects/d2-admin\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/d2-projects/d2-admin</a></p>\n<p>文档地址：<a href=\"https://d2.pub/zh/doc/d2-admin/\" target=\"_blank\" rel=\"noopener noreferrer\">https://d2.pub/zh/doc/d2-admin/</a></p>\n<p>效果预览：<a href=\"https://d2.pub/d2-admin/preview/#/index\" target=\"_blank\" rel=\"noopener noreferrer\">https://d2.pub/d2-admin/preview/#/index</a></p>\n<p>开源协议：MIT</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346319611813.webp\" alt=\"图片\">图片</p>\n<p><strong>2. vue-element-admin</strong></p>\n<p>开源地址：<a href=\"https://github.com/PanJiaChen/vue-element-admin\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/PanJiaChen/vue-element-admin</a></p>\n<p>文档地址：<a href=\"https://panjiachen.github.io/vue-element-admin-site/zh/\" target=\"_blank\" rel=\"noopener noreferrer\">https://panjiachen.github.io/vue-element-admin-site/zh/</a></p>\n<p>效果预览：<a href=\"https://d2.pub/d2-admin/preview/#/index\" target=\"_blank\" rel=\"noopener noreferrer\">https://d2.pub/d2-admin/preview/#/index</a></p>\n<p>开源协议：MIT</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346319611814.webp\" alt=\"图片\">图片</p>\n<p><strong>3. JEECG-BOOT</strong></p>\n<p>开源地址：<a href=\"https://github.com/zhangdaiscott/jeecg-boot\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/zhangdaiscott/jeecg-boot</a></p>\n<p>文档地址：<a href=\"https://panjiachen.github.io/vue-element-admin-site/zh/\" target=\"_blank\" rel=\"noopener noreferrer\">https://panjiachen.github.io/vue-element-admin-site/zh/</a></p>\n<p>效果预览：<a href=\"http://boot.jeecg.com/\" target=\"_blank\" rel=\"noopener noreferrer\">http://boot.jeecg.com/</a></p>\n<p>开源协议：Apache-2.0 License</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346319611815.webp\" alt=\"图片\">图片</p>\n<h1 id=\"_4-gin-vue-admin\" tabindex=\"-1\"> <strong>4. GIN-VUE-ADMIN</strong></h1>\n<p>开源地址：<a href=\"https://github.com/flipped-aurora/gin-vue-admin\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/flipped-aurora/gin-vue-admin</a></p>\n<p>文档地址：<a href=\"https://www.gin-vue-admin.com/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.gin-vue-admin.com/</a></p>\n<p>效果预览：<a href=\"http://demo.gin-vue-admin.com/#/layout/dashboard\" target=\"_blank\" rel=\"noopener noreferrer\">http://demo.gin-vue-admin.com/#/layout/dashboard</a></p>\n<p>开源协议：Apache-2.0 License</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346319611816.webp\" alt=\"图片\">图片</p>\n<h1 id=\"_5-vue-admin-beautiful\" tabindex=\"-1\"> <strong>5. vue-admin-beautiful</strong></h1>\n<p>开源地址：<a href=\"https://github.com/chuzhixin/vue-admin-beautiful\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/chuzhixin/vue-admin-beautiful</a></p>\n<p>文档地址：<a href=\"https://www.gin-vue-admin.com/\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.gin-vue-admin.com/</a></p>\n<p>效果预览：<a href=\"http://beautiful.panm.cn/\" target=\"_blank\" rel=\"noopener noreferrer\">http://beautiful.panm.cn/</a></p>\n<p>开源协议：MPL-2.0 License</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346319611817.webp\" alt=\"图片\">图片</p>\n<p><strong>6. Dcat-admin</strong></p>\n<p>开源地址：<a href=\"https://github.com/jqhph/dcat-admin\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/jqhph/dcat-admin</a></p>\n<p>文档地址：<a href=\"http://www.dcatadmin.com/\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.dcatadmin.com/</a></p>\n<p>效果预览：<a href=\"http://103.39.211.179:8080/admin\" target=\"_blank\" rel=\"noopener noreferrer\">http://103.39.211.179:8080/admin</a></p>\n<p>开源协议：MIT License</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346319611918.webp\" alt=\"图片\">图片</p>\n<p><strong>7. RuoYi</strong></p>\n<p>开源地址：<a href=\"https://gitee.com/y_project/RuoYi\" target=\"_blank\" rel=\"noopener noreferrer\">https://gitee.com/y_project/RuoYi</a></p>\n<p>文档地址：<a href=\"https://doc.ruoyi.vip/\" target=\"_blank\" rel=\"noopener noreferrer\">https://doc.ruoyi.vip/</a></p>\n<p>效果预览：<a href=\"https://vue.ruoyi.vip/index\" target=\"_blank\" rel=\"noopener noreferrer\">https://vue.ruoyi.vip/index</a></p>\n<p>开源协议：MIT License</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346319611919.webp\" alt=\"图片\">图片</p>\n<p><strong>8. renren-fast-vue</strong></p>\n<p>开源地址：<a href=\"https://gitee.com/renrenio/renren-fast-vue\" target=\"_blank\" rel=\"noopener noreferrer\">https://gitee.com/renrenio/renren-fast-vue</a></p>\n<p>文档地址：<a href=\"https://www.renren.io/guide\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.renren.io/guide</a></p>\n<p>效果预览：<a href=\"http://demo.open.renren.io/renren-fast/#/home\" target=\"_blank\" rel=\"noopener noreferrer\">http://demo.open.renren.io/renren-fast/#/home</a></p>\n<p>开源协议：MIT License</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346319611920.webp\" alt=\"图片\">图片</p>\n<p><strong>9. ant-design-pro</strong></p>\n<p>开源地址：<a href=\"https://github.com/ant-design/ant-design-pro\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/ant-design/ant-design-pro</a></p>\n<p>文档地址：<a href=\"https://pro.ant.design/index-cn/\" target=\"_blank\" rel=\"noopener noreferrer\">https://pro.ant.design/index-cn/</a></p>\n<p>效果预览：<a href=\"https://pro.ant.design/\" target=\"_blank\" rel=\"noopener noreferrer\">https://pro.ant.design/</a></p>\n<p>开源协议：MIT License</p>\n<p><strong>10. iview-admin</strong></p>\n<p>开源地址：<a href=\"https://github.com/iview/iview-admin\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/iview/iview-admin</a></p>\n<p>文档地址：<a href=\"https://lison16.github.io/iview-admin-doc/\" target=\"_blank\" rel=\"noopener noreferrer\">https://lison16.github.io/iview-admin-doc/</a></p>\n<p>效果预览：<a href=\"https://admin.iviewui.com/home\" target=\"_blank\" rel=\"noopener noreferrer\">https://admin.iviewui.com/home</a></p>\n<p>开源协议：MIT License</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346319611921.webp\" alt=\"图片\">图片</p>\n<p><strong>11. material-dashboard</strong></p>\n<p>开源地址：<a href=\"https://github.com/creativetimofficial/material-dashboard#demo\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/creativetimofficial/material-dashboard#demo</a></p>\n<p>文档地址：<a href=\"https://demos.creative-tim.com/material-dashboard/docs/2.1/getting-started/introduction.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://demos.creative-tim.com/material-dashboard/docs/2.1/getting-started/introduction.html</a></p>\n<p>效果预览：<a href=\"https://demos.creative-tim.com/material-dashboard/examples/dashboard.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://demos.creative-tim.com/material-dashboard/examples/dashboard.html</a></p>\n<p>开源协议：MIT License</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346319611922.webp\" alt=\"图片\">图片</p>\n<p><strong>12.EAdmin</strong></p>\n<p>开源地址：<a href=\"https://github.com/suruibuas/eadmin\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/suruibuas/eadmin</a></p>\n<p>文档地址：<a href=\"http://doc.eadmin.com.cn/\" target=\"_blank\" rel=\"noopener noreferrer\">http://doc.eadmin.com.cn/</a></p>\n<p>效果预览：<a href=\"http://www.eadmin.com.cn/\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.eadmin.com.cn/</a></p>\n<p>开源协议：无</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346319611923.jpg\" alt=\"图片\"></p>\n",
      "image": "https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-164346319611813.webp",
      "date_published": "2022-02-06T00:00:00.000Z",
      "date_modified": "2022-06-12T02:30:32.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "截图工具大全",
      "url": "https://blog.ciberviler.top/tools/%E6%88%AA%E5%9B%BE%E5%B7%A5%E5%85%B7.html",
      "id": "https://blog.ciberviler.top/tools/%E6%88%AA%E5%9B%BE%E5%B7%A5%E5%85%B7.html",
      "summary": "截图工具大全",
      "content_html": "<h1 id=\"截图工具大全\" tabindex=\"-1\"> 截图工具大全</h1>\n<p>第一款. win10自带</p>\n<p>快捷键：Windows键+Shift+S</p>\n<p>第二款.微信自带</p>\n<p>快捷键：Alt+A</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-16442232269891.webp\" alt=\"图片\"></p>\n<p>第三款.QQ自带</p>\n<p>快捷键：Ctrl+Alt+A</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-16442232269892.webp\" alt=\"图片\"></p>\n<p>第四款.钉钉自带</p>\n<p>快捷键：Ctrl+Shift+A</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-16442232269893.webp\" alt=\"图片\"></p>\n<p>第五款.浏览器自带</p>\n<p>个人使用的星愿浏览器</p>\n<p>第六款.Snipaste</p>\n<p><a href=\"https://zh.snipaste.com/\" target=\"_blank\" rel=\"noopener noreferrer\">https://zh.snipaste.com/</a></p>\n<p>快捷键：F1</p>\n<p>它还有一个超好用的贴图功能！把一些资料贴在桌面上，然后再去编辑文章，省得来回切换了</p>\n<p>第七款.Sniptool</p>\n<p><a href=\"https://tc5.us/file/15690961-442919658\" target=\"_blank\" rel=\"noopener noreferrer\">https://tc5.us/file/15690961-442919658</a></p>\n<p>它可以将多个截取的图片组合到一个画布中,并且，它拥有强大的标注编辑功能，对于截图内容可以进行编辑标注。比如添加文本、画框、表情，对截图进行透明化处理，更换背景等。</p>\n<p>更赞的时，它还有一个模糊图像功能，可以对截图内容进行局部</p>\n<p>第八款. FsCapture</p>\n<p><a href=\"http://xz.w10a.com/Small/FastStoneCapturev2020.zip\" target=\"_blank\" rel=\"noopener noreferrer\">http://xz.w10a.com/Small/FastStoneCapturev2020.zip</a></p>\n<p>可以长截图，屏幕放大与聚焦，这在视频演示中很常用。除此之外，它还有一个强大的编辑器，可以做一些图片的处理，比如模糊（私密部分打码）、调整色彩等，基本是个简版的PS。</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-16442232269894.webp\" alt=\"图片\"></p>\n<p>第九款.FireShot <a href=\"https://www.chrome666.com/chrome-extension/fireshot.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.chrome666.com/chrome-extension/fireshot.html</a></p>\n<p>能搞定网页长图，基本功能都具备</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-16442232269895.jpg\" alt=\"图片\"></p>\n<p>第十款.ShareX</p>\n<p><a href=\"https://getsharex.com/\" target=\"_blank\" rel=\"noopener noreferrer\">https://getsharex.com/</a></p>\n<p>开源免费，steam有收录</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-16442232269896.jpg\" alt=\"图片\"></p>\n",
      "image": "https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-16442232269891.webp",
      "date_published": "2022-02-12T00:00:00.000Z",
      "date_modified": "2022-06-12T02:30:32.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "阿里十大最受开发者欢迎的工具",
      "url": "https://blog.ciberviler.top/tools/%E9%98%BF%E9%87%8C%E5%8D%81%E5%A4%A7%E6%9C%80%E5%8F%97%E5%BC%80%E5%8F%91%E8%80%85%E6%AC%A2%E8%BF%8E%E7%9A%84%E5%B7%A5%E5%85%B7.html",
      "id": "https://blog.ciberviler.top/tools/%E9%98%BF%E9%87%8C%E5%8D%81%E5%A4%A7%E6%9C%80%E5%8F%97%E5%BC%80%E5%8F%91%E8%80%85%E6%AC%A2%E8%BF%8E%E7%9A%84%E5%B7%A5%E5%85%B7.html",
      "summary": "阿里十大最受开发者欢迎的工具",
      "content_html": "<h1 id=\"阿里十大最受开发者欢迎的工具\" tabindex=\"-1\"> 阿里十大最受开发者欢迎的工具</h1>\n<p>精选了一些阿里经济体内部最受开发者欢迎的开发者工具，筛选出一些带有普适性同样适合外部开发者的，希望能助力开发者们提高开发效率。</p>\n<h3 id=\"_1-java-工程脚手架-java-initializr\" tabindex=\"-1\"> 1. Java 工程脚手架 Java Initializr</h3>\n<p><strong>官网</strong>：\n<a href=\"https://start.aliyun.com/bootstrap.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://start.aliyun.com/bootstrap.html</a></p>\n<p><strong>简介</strong>：\n2020 年由阿里巴巴中间件团队发布的定制版 Java工程脚手架，快速搭建工程应用。</p>\n<p>Java工程脚手架是一个项目框架生成工具，旨在减少开发者的工程搭建成本，为开发者提供简便、快捷的项目配置体验。</p>\n<p>支持 Spring 官方脚手架的全部功能，且增加了丰富的典型配置和使用案例。多种标准应用架构供选择，让你生成完工程就可以直接写代码。基于浏览器的运行环境，进一步降低功能体验和试用的复杂度。</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640.webp\" alt=\"图片\"></p>\n<h3 id=\"_2-java-线上诊断工具-arthas\" tabindex=\"-1\"> 2. Java 线上诊断工具 Arthas</h3>\n<p><strong>官网</strong>：\n<a href=\"https://arthas.aliyun.com/en-us/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://arthas.aliyun.com/en-us/index.html</a></p>\n<p><strong>简介</strong>：Arthas 是阿里巴巴 2018 年 9 月开源的一款 Java 线上诊断工具。</p>\n<p>工具的使用场景：</p>\n<ul>\n<li>这个类从哪个 jar 包加载的？为什么会报各种类相关的 Exception？</li>\n<li>我改的代码为什么没有执行到？难道是我没 commit？分支搞错了？</li>\n<li>遇到问题无法在线上 debug，难道只能通过加日志再重新发布吗？</li>\n<li>线上遇到某个用户的数据处理有问题，但线上同样无法 debug，线下无法重现！</li>\n<li>是否有一个全局视角来查看系统的运行状况？</li>\n<li>有什么办法可以监控到 JVM 的实时运行状态？</li>\n</ul>\n<p>Arthas 支持 JDK 6+，支持 Linux/Mac/Windows，采用命令行交互模式，同时提供丰富的 Tab 自动补全功能，进一步方便进行问题的定位和诊断。</p>\n<h3 id=\"_3-java-工具集-dragonwell\" tabindex=\"-1\"> 3. Java 工具集 Dragonwell</h3>\n<p><strong>官网</strong>：\n<a href=\"https://www.aliyun.com/product/dragonwell\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.aliyun.com/product/dragonwell</a></p>\n<p><strong>简介</strong>：\nAlibaba Dragonwell 是一款免费的, 生产就绪型 Open JDK 发行版，提供长期支持，包括性能增强和安全修复。阿里巴巴拥有最丰富的 Java 应用场景，覆盖电商，金融，物流等众多领域，世界上最大的 Java 用户之一。Alibaba Dragonwell 作为 Java 应用的基石，支撑了阿里经济体内所有的 Java 业务。Alibaba Dragonwell 完全兼容 Java SE 标准，您可以在任何常用操作系统（包括 Linux、Windows 和 macOS）上开发 Java 应用程序， 运行时生产环境选择 Alibaba Dragonwell。</p>\n<p><strong>特性</strong></p>\n<ul>\n<li>\n<p>安全与稳定\n紧密与 OpenJDK 社区保持合作，保持对社区工作的跟踪，及时同步上游更新；同时，Dragonwell 选择性的移植高版本 Java 的重要功能，这些移植功能已经在阿里内部被大规模部署，用户都可以免费使用，而不用等下一个 LTS 版本</p>\n</li>\n<li>\n<p>标准兼容\nOpenJDK 的下游, 完全遵循 Java SE 标准，通过 JCK 兼容性测试</p>\n</li>\n<li>\n<p>性能卓越\nDragonwell 作为阿里巴巴 Java 应用的基石，支撑了阿里经济体内所有的 Java 业务，积累了大量业务场景下的实践和创新</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-16434631208084.webp\" alt=\"图片\"></p>\n</li>\n</ul>\n<h3 id=\"_4-java-代码规约扫描插件\" tabindex=\"-1\"> 4. Java 代码规约扫描插件</h3>\n<p><strong>官网</strong>：\n<a href=\"https://github.com/alibaba/p3c\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/alibaba/p3c</a></p>\n<p><strong>简介</strong>：\n《阿里巴巴Java开发手册》自从第一个版本起，倍受业界关注，相信很多人对其中的规则也有了一定的了解，很多人甚至希望能尽快在自己的团队推行起来，这样大家有了一套共同的开发准则。但是，如何更好的去遵守规则并且按照手册去开发我们的系统确变得不那么容易，为了让开发者更加方便、快速的将规范推动并实行起来，阿里巴巴基于手册内容，研发了一套自动化的IDE检测插件（IDEA、Eclipse）， 该插件在扫描代码后，将不符合《手册》的代码按Blocker/Critical/Major三个等级显示在下方，甚至在IDEA上，还基于Inspection机制提供了实时检测功能，编写代码的同时也能快速发现问题所在。对于历史代码，部分规则实现了批量一键修复的功能，提升代码质量，提高团队研发效能。</p>\n<h3 id=\"_5-应用实时监控工具-arms\" tabindex=\"-1\"> 5. 应用实时监控工具 ARMS</h3>\n<p><strong>官网</strong>：\n<a href=\"https://www.aliyun.com/product/arms\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.aliyun.com/product/arms</a></p>\n<p><strong>简介</strong>：\n应用实时监控服务 (Application Real-Time Monitoring Service, 简称ARMS) 是一款应用性能管理产品，包含前端监控，应用监控和Prometheus监控三大子产品，涵盖了浏览器，小程序，APP，分布式应用和容器环境等性能管理，能帮助你实现全栈式的性能监控和端到端的全链路追踪诊断， 让应用运维从未如此轻松高效。</p>\n<p>工具的使用场景：</p>\n<ul>\n<li>\n<p>晚上 10 点收到 37 条报警信息，你却无从下手？</p>\n</li>\n<li>\n<p>当我们发现问题的时候，客户/业务方已经发起投诉？</p>\n</li>\n<li>\n<p>每个月花几十万买服务器，却无法保障用户体验？</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-16434631208085.webp\" alt=\"图片\"></p>\n</li>\n</ul>\n<h3 id=\"_6-性能测试工具-pts\" tabindex=\"-1\"> 6. 性能测试工具 PTS</h3>\n<p><strong>官网</strong>：\n<a href=\"https://www.aliyun.com/product/pts\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.aliyun.com/product/pts</a> ；</p>\n<p><strong>简介</strong>：\nPTS（Performance Testing Service）是面向所有技术背景人员的云化测试工具。有别于传统工具的繁复，PTS以互联网化的交互，提供性能测试、API调试和监测等多种能力。自研和适配开源的功能都可以轻松模拟任意体量的用户访问业务的场景，任务随时发起，免去繁琐的搭建和维护成本。更是紧密结合监控、流控等兄弟产品提供一站式高可用能力，高效检验和管理业务性能。</p>\n<p>使用场景：</p>\n<ul>\n<li>\n<p>大促活动准备前，想模拟真实多用户高并发访问场景？</p>\n</li>\n<li>\n<p>产品版本迭代，想观察流量洪峰时产品表现？</p>\n</li>\n<li>\n<p>产品交付</p>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-16434631208086.webp\" alt=\"图片\"></p>\n</li>\n</ul>\n<h3 id=\"_7-架构可视化工具-ahas\" tabindex=\"-1\"> 7. 架构可视化工具 AHAS</h3>\n<p><strong>官网</strong>：\n<a href=\"https://www.aliyun.com/product/ahas\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.aliyun.com/product/ahas</a></p>\n<p><strong>简介</strong>：\n应用高可用服务（Application High Availability Service）是专注于提高应用及业务高可用的工具平台，目前主要提供 应用架构探测感知，故障注入式高可用能力评测 和 流控降级高可用防护 三大核心能力，通过各自的工具模块可以快速低成本的在营销活动场景、业务核心场景全面提升业务稳定性和韧性。</p>\n<p>使用场景：</p>\n<ul>\n<li>服务化改造过程中，想精确的了解资源实例的构成和交互情况，实现架构的可视化？</li>\n<li>想引入真实的故障场景和演练模型？</li>\n<li>低门槛获得流控、降级功能？</li>\n</ul>\n<p><img src=\"https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640-16434631208097.jpg\" alt=\"图片\"></p>\n<h3 id=\"_8-数据处理工具-easyexcel\" tabindex=\"-1\"> 8. 数据处理工具 EasyExcel</h3>\n<p><strong>官网</strong>：\n<a href=\"https://github.com/alibaba/easyexcel\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/alibaba/easyexcel</a></p>\n<p><strong>简介</strong>：\nJava解析、生成Excel比较有名的框架有Apache poi、jxl。但他们都存在一个严重的问题就是非常的耗内存，poi有一套SAX模式的API可以一定程度的解决一些内存溢出的问题，但POI还是有一些缺陷，比如07版Excel解压缩以及解压后存储都是在内存中完成的，内存消耗依然很大。easyexcel重写了poi对07版Excel的解析，能够原本一个3M的excel用POI sax依然需要100M左右内存降低到几M，并且再大的excel不会出现内存溢出，03版依赖POI的sax模式。在上层做了模型转换的封装，让使用者更加简单方便.</p>\n<h3 id=\"_9-ios-类工具-handyjson\" tabindex=\"-1\"> 9. iOS 类工具 HandyJSON</h3>\n<p><strong>官网</strong>：\n<a href=\"https://github.com/alibaba/HandyJSON\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/alibaba/HandyJSON</a></p>\n<p><strong>简介</strong>：\nHandyJSON是一个用于Swift语言中的JSON序列化/反序列化库。</p>\n<p>与其他流行的Swift JSON库相比，HandyJSON的特点是，它支持纯swift类，使用也简单。它反序列化时(把JSON转换为Model)不要求Model从NSObject继承(因为它不是基于KVC机制)，也不要求你为Model定义一个Mapping函数。只要你定义好Model类，声明它服从HandyJSON协议，HandyJSON就能自行以各个属性的属性名为Key，从JSON串中解析值。</p>\n<h4 id=\"特性\" tabindex=\"-1\"> 特性</h4>\n<ul>\n<li>序列化Model到JSON、从JSON反序列化到Model</li>\n<li>自然地以Model的属性名称作为解析JSON的Key，不需要额外指定</li>\n<li>支持Swift中大部分类型</li>\n<li>支持class、struct定义的Model</li>\n<li>支持自定义解析规则</li>\n<li>类型自适应，如JSON中是一个Int，但对应Model是String字段，会自动完成转化</li>\n</ul>\n<h3 id=\"_10-数据库落地-druid\" tabindex=\"-1\"> 10. 数据库落地 Druid</h3>\n<p><strong>官网</strong>：\n<a href=\"https://github.com/alibaba/druid\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/alibaba/druid</a></p>\n<p><strong>简介</strong>：\nDruid 是一个 JDBC 组件库，包含数据库连接池、SQL Parser 等组件, 被大量业务和技术产品使用或集成，经历过最严苛线上业务场景考验，是你值得信赖的技术产品。</p>\n",
      "image": "https://gh.xlc520.tk/xlc520/MyImage/raw/main/MdImg/640.webp",
      "date_published": "2022-02-19T00:00:00.000Z",
      "date_modified": "2022-06-12T02:30:32.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "提问的智慧",
      "url": "https://blog.ciberviler.top/essay/How-To-Ask-Questions.html",
      "id": "https://blog.ciberviler.top/essay/How-To-Ask-Questions.html",
      "summary": "提问的智慧，How To Ask Questions The Smart Way",
      "content_html": "<h1 id=\"提问的智慧\" tabindex=\"-1\"> 提问的智慧</h1>\n<p><strong>How To Ask Questions The Smart Way</strong></p>\n<p>Copyright © 2001,2006,2014 Eric S. Raymond, Rick Moen</p>\n<h2 id=\"前言\" tabindex=\"-1\"> 前言</h2>\n<p><img src=\"https://fastly.jsdelivr.net/gh/xlc520/MyImage@main/MdImg/提问的艺术.jpg\" alt=\"提问的艺术\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/xlc520/MyImage@main/MdImg/提问的艺术.png\" alt=\"提问的艺术\"></p>\n<p><img src=\"https://fastly.jsdelivr.net/gh/xlc520/MyImage@main/MdImg/提问.jpg\" alt=\"提问\"></p>\n<h2 id=\"目录\" tabindex=\"-1\"> 目录</h2>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li>\n<ul>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n</li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n<li></li>\n</ul>\n<h2 id=\"声明\" tabindex=\"-1\"> 声明</h2>\n<p>许多项目在他们的使用协助/说明网页中链接了本指南，这么做很好，我们也鼓励大家都这么做。但如果你是负责管理这个项目网页的人，请在超链接附近的显着位置上注明：</p>\n<p><strong>本指南不提供此项目的实际支持服务！</strong></p>\n<p>我们已经深刻领教到少了上述声明所带来的痛苦。因为少了这点声明，我们不停地被一些白痴纠缠。这些白痴认为既然我们发布了这本指南，那么我们就有责任解决世上所有的技术问题。</p>\n<p>如果你是因为需要某些协助而正在阅读这本指南，并且最后离开是因为发现从本指南作者们身上得不到直接的协助，那么你就是我们所说的那些白痴之一。别问我们问题，我们只会忽略你。我们在这本指南中是教你如何从那些真正懂得你所遇到软件或硬件问题的人取得协助，而99%的情况下那不会是我们。除非你确定本指南的作者之一刚好是你所遇到的问题领域的专家，否则请不要打扰我们，这样大家都会开心一点。</p>\n<h2 id=\"简介\" tabindex=\"-1\"> 简介</h2>\n<p>在<a href=\"http://www.catb.org/~esr/faqs/hacker-howto.html\" target=\"_blank\" rel=\"noopener noreferrer\">黑客</a>的世界里，当你拋出一个技术问题时，最终是否能得到有用的回答，往往取决于你所提问和追问的方式。本指南将教你如何正确的提问以获得你满意的答案。</p>\n<p>不只是黑客，现在开放源代码（Open Source）软件已经相当盛行，你常常也可以由其他有经验的使用者身上得到好答案，这是件**<em>好事</em>**；使用者比起黑客来，往往对那些新手常遇到的问题更宽容一些。然而，将有经验的使用者视为黑客，并采用本指南所提的方法与他们沟通，同样也是能从他们身上得到满意回答的最有效方式。</p>\n<p>首先你应该明白，黑客们喜爱有挑战性的问题，或者能激发我们思维的好问题。如果我们并非如此，那我们也不会成为你想询问的对象。如果你给了我们一个值得反复咀嚼玩味的好问题，我们自会对你感激不尽。好问题是激励，是厚礼。好问题可以提高我们的理解力，而且通常会暴露我们以前从没意识到或者思考过的问题。对黑客而言，&quot;好问题！&quot;是诚挚的大力称赞。</p>\n<p>尽管如此，黑客们有着蔑视或傲慢面对简单问题的坏名声，这有时让我们看起来对新手、无知者似乎较有敌意，但其实不是那样的。</p>\n<p>我们不讳言我们对那些不愿思考、或者在发问前不做他们该做的事的人的蔑视。那些人是时间杀手 -– 他们只想索取，从不付出，消耗我们可用在更有趣的问题或更值得回答的人身上的时间。我们称这样的人为 <code>失败者（撸瑟）</code> （由于历史原因，我们有时把它拼作 <code>lusers</code>）。</p>\n<p>我们意识到许多人只是想使用我们写的软件，他们对学习技术细节没有兴趣。对大多数人而言，电脑只是种工具，是种达到目的的手段而已。他们有自己的生活并且有更要紧的事要做。我们了解这点，也从不指望每个人都对这些让我们着迷的技术问题感兴趣。尽管如此，我们回答问题的风格是指向那些真正对此有兴趣并愿意主动参与解决问题的人，这一点不会变，也不该变。如果连这都变了，我们就是在降低做自己最擅长的事情上的效率。</p>\n<p>我们（在很大程度上）是自愿的，从繁忙的生活中抽出时间来解答疑惑，而且时常被提问淹没。所以我们无情的滤掉一些话题，特别是拋弃那些看起来像失败者的家伙，以便更高效的利用时间来回答<code>赢家（winner）</code>的问题。</p>\n<p>如果你厌恶我们的态度，高高在上，或过于傲慢，不妨也设身处地想想。我们并没有要求你向我们屈服 -- 事实上，我们大多数人非常乐意与你平等地交流，只要你付出小小努力来满足基本要求，我们就会欢迎你加入我们的文化。但让我们帮助那些不愿意帮助自己的人是没有效率的。无知没有关系，但装白痴就是不行。</p>\n<p>所以，你不必在技术上很在行才能吸引我们的注意，但你必须表现出能引导你变得在行的特质 -- 机敏、有想法、善于观察、乐于主动参与解决问题。如果你做不到这些使你与众不同的事情，我们建议你花点钱找家商业公司签个技术支持服务合同，而不是要求黑客个人无偿地帮助你。</p>\n<p>如果你决定向我们求助，当然你也不希望被视为失败者，更不愿成为失败者中的一员。能立刻得到快速并有效答案的最好方法，就是像赢家那样提问 -- 聪明、自信、有解决问题的思路，只是偶尔在特定的问题上需要获得一点帮助。</p>\n<p>（欢迎对本指南提出改进意见。你可以 email 你的建议至 <a href=\"esr@thyrsus.com\">esr@thyrsus.com</a> 或 <a href=\"respond-auto@linuxmafia.com\">respond-auto@linuxmafia.com</a>。然而请注意，本文并非<a href=\"http://www.ietf.org/rfc/rfc1855.txt\" target=\"_blank\" rel=\"noopener noreferrer\">网络礼节</a>的通用指南，而我们通常会拒绝无助于在技术论坛得到有用答案的建议。）</p>\n<h2 id=\"在提问之前\" tabindex=\"-1\"> 在提问之前</h2>\n<p>在你准备要通过电子邮件、新闻群组或者聊天室提出技术问题前，请先做到以下事情：</p>\n<ol>\n<li>尝试在你准备提问的论坛的旧文章中搜索答案。</li>\n<li>尝试上网搜索以找到答案。</li>\n<li>尝试阅读手册以找到答案。</li>\n<li>尝试阅读常见问题文件（FAQ）以找到答案。</li>\n<li>尝试自己检查或试验以找到答案</li>\n<li>向你身边的强者朋友打听以找到答案。</li>\n<li>如果你是程序开发者，请尝试阅读源代码以找到答案</li>\n</ol>\n<p>当你提出问题的时候，请先表明你已经做了上述的努力；这将有助于树立你并不是一个不劳而获且浪费别人的时间的提问者。如果你能一并表达在做了上述努力的过程中所**<em>学到</em>**的东西会更好，因为我们更乐于回答那些表现出能从答案中学习的人的问题。</p>\n<p>运用某些策略，比如先用Google搜索你所遇到的各种错误信息（既搜索<a href=\"http://groups.google.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Google论坛</a>，也搜索网页），这样很可能直接就找到了能解决问题的文件或邮件列表线索。即使没有结果，在邮件列表或新闻组寻求帮助时加上一句 <code>我在Google中搜过下列句子但没有找到什么有用的东西</code> 也是件好事，即使它只是表明了搜索引擎不能提供哪些帮助。这么做（加上搜索过的字串）也让遇到相似问题的其他人能被搜索引擎引导到你的提问来。</p>\n<p>别着急，不要指望几秒钟的Google搜索就能解决一个复杂的问题。在向专家求助之前，再阅读一下常见问题文件（FAQ）、放轻松、坐舒服一些，再花点时间思考一下这个问题。相信我们，他们能从你的提问看出你做了多少阅读与思考，如果你是有备而来，将更有可能得到解答。不要将所有问题一股脑拋出，只因你的第一次搜索没有找到答案（或者找到太多答案）。</p>\n<p>准备好你的问题，再将问题仔细的思考过一遍，因为草率的发问只能得到草率的回答，或者根本得不到任何答案。越是能表现出在寻求帮助前你为解决问题所付出的努力，你越有可能得到实质性的帮助。</p>\n<p>小心别问错了问题。如果你的问题基于错误的假设，某个普通黑客（J. Random Hacker）多半会一边在心里想着<code>蠢问题…</code>， 一边用无意义的字面解释来答复你，希望着你会从问题的回答（而非你想得到的答案）中汲取教训。</p>\n<p>绝不要自以为**<em>够格</em><strong>得到答案，你没有；你并没有。毕竟你没有为这种服务支付任何报酬。你将会是自己去</strong><em>挣到</em>**一个答案，靠提出有内涵的、有趣的、有思维激励作用的问题 --一个有潜力能贡献社区经验的问题，而不仅仅是被动的从他人处索取知识。</p>\n<p>另一方面，表明你愿意在找答案的过程中做点什么是一个非常好的开端。<code>谁能给点提示？</code>、<code>我的这个例子里缺了什么？</code>以及<code>我应该检查什么地方</code>比<code>请把我需要的确切的过程贴出来</code>更容易得到答复。因为你表现出只要有人能指个正确方向，你就有完成它的能力和决心。</p>\n<h2 id=\"当你提问时\" tabindex=\"-1\"> 当你提问时</h2>\n<h3 id=\"慎选提问的论坛\" tabindex=\"-1\"> 慎选提问的论坛</h3>\n<p>小心选择你要提问的场合。如果你做了下述的事情，你很可能被忽略掉或者被看作失败者：</p>\n<ul>\n<li>在与主题不合的论坛上贴出你的问题</li>\n<li>在探讨进阶技术问题的论坛张贴非常初级的问题；反之亦然</li>\n<li>在太多的不同新闻群组上重复转贴同样的问题（cross-post）</li>\n<li>向既非熟人也没有义务解决你问题的人发送私人电邮</li>\n</ul>\n<p>黑客会剔除掉那些搞错场合的问题，以保护他们沟通的渠道不被无关的东西淹没。你不会想让这种事发生在自己身上的。</p>\n<p>因此，第一步是找到对的论坛。再说一次，Google和其它搜索引擎还是你的朋友，用它们来找到与你遭遇到困难的软硬件问题最相关的网站。通常那儿都有常见问题（FAQ）、邮件列表及相关说明文件的链接。如果你的努力（包括**<em>阅读</em>**FAQ）都没有结果，网站上也许还有报告Bug（Bug-reporting）的流程或链接，如果是这样，连过去看看。</p>\n<p>向陌生的人或论坛发送邮件最可能是风险最大的事情。举例来说，别假设一个提供丰富内容的网页的作者会想充当你的免费顾问。不要对你的问题是否会受到欢迎做太乐观的估计 -- 如果你不确定，那就向别处发送，或者压根别发。</p>\n<p>在选择论坛、新闻群组或邮件列表时，别太相信名字，先看看FAQ或者许可书以弄清楚你的问题是否切题。发文前先翻翻已有的话题，这样可以让你感受一下那里的文化。事实上，事先在新闻组或邮件列表的历史记录中搜索与你问题相关的关键词是个极好的主意，也许这样就找到答案了。即使没有，也能帮助你归纳出更好的问题。</p>\n<p>别像机关枪似的一次&quot;扫射&quot;所有的帮助渠道，这就像大喊大叫一样会使人不快。要一个一个地来。</p>\n<p>搞清楚你的主题！最典型的错误之一是在某种致力于跨平台可移植的语言、套件或工具的论坛中提关于Unix或Windows操作系统程序界面的问题。如果你不明白为什么这是大错，最好在搞清楚这之间差异之前什么也别问。</p>\n<p>一般来说，在仔细挑选的公共论坛中提问，会比在私有论坛中提同样的问题更容易得到有用的回答。有几个理由可以支持这点，一是看潜在的回复者有多少，二是看观众有多少。黑客较愿意回答那些能帮助到许多人的问题。</p>\n<p>可以理解的是，老练的黑客和一些热门软件的作者正在接受过多的错发信息。就像那根最后压垮骆驼背的稻草一样，你的加入也有可能使情况走向极端 -- 已经好几次了，一些热门软件的作者从自己软件的支持中抽身出来，因为伴随而来涌入其私人邮箱的无用邮件变得无法忍受。</p>\n<h3 id=\"stack-overflow\" tabindex=\"-1\"> Stack Overflow</h3>\n<p>搜索，<strong><em>然后</em></strong> 在 Stack Exchange 问。</p>\n<p>近年来，Stack Exchange community 社区已经成为回答技术及其他问题的主要渠道，尤其是那些开放源码的项目。</p>\n<p>因为 Google 索引是即时的，在看 Stack Exchange 之前先在 Google 搜索。有很高的机率某人已经问了一个类似的问题，而且 Stack Exchange 网站们往往会是搜索结果中最前面几个。如果你在 Google 上没有找到任何答案，你再到特定相关主题的网站去找。用标签（Tag）搜索能让你更缩小你的搜索结果。</p>\n<p>Stack Exchange 已经成长到<a href=\"http://stackexchange.com/sites\" target=\"_blank\" rel=\"noopener noreferrer\">超过一百个网站</a>，以下是最常用的几个站：</p>\n<ul>\n<li>Super User 是问一些通用的电脑问题，如果你的问题跟代码或是写程序无关，只是一些网络连线之类的，请到这里。</li>\n<li>Stack Overflow 是问写程序有关的问题。</li>\n<li>Server Fault 是问服务器和网管相关的问题。</li>\n</ul>\n<h3 id=\"网站和irc论坛\" tabindex=\"-1\"> 网站和IRC论坛</h3>\n<p>本地的使用者群组（user group），或者你所用的 Linux 发行版本也许正在宣传他们的网页论坛或 IRC 频道，并提供新手帮助（在一些非英语国家，新手论坛很可能还是邮件列表）， 这些地方是开始提问的好首选，特别是当你觉得遇到的也许只是相对简单或者很普通的问题时。经过宣传的 IRC 频道是公开欢迎提问的地方，通常可以即时得到回应。</p>\n<p>事实上，如果程序出的问题只发生在特定 Linux 发行版提供的版本（这很常见），最好先去该发行版的论坛或邮件列表中提问，再到程序本身的论坛或邮件列表提问。（否则）该项目的黑客可能仅仅回复 &quot;用**<em>我们的</em>**版本&quot;。</p>\n<p>在任何论坛发文以前，先确认一下有没有搜索功能。如果有，就试着搜索一下问题的几个关键词，也许这会有帮助。如果在此之前你已做过通用的网页搜索（你也该这样做），还是再搜索一下论坛，搜索引擎有可能没来得及索引此论坛的全部内容。</p>\n<p>通过论坛或 IRC 频道来提供使用者支持服务有增长的趋势，电子邮件则大多为项目开发者间的交流而保留。所以最好先在论坛或 IRC 中寻求与该项目相关的协助。</p>\n<h3 id=\"第二步-使用项目邮件列表\" tabindex=\"-1\"> 第二步，使用项目邮件列表</h3>\n<p>当某个项目提供开发者邮件列表时，要向列表而不是其中的个别成员提问，即使你确信他能最好地回答你的问题。查一查项目的文件和首页，找到项目的邮件列表并使用它。有几个很好的理由支持我们采用这种办法：</p>\n<ul>\n<li>任何好到需要向个别开发者提出的问题，也将对整个项目群组有益。反之，如果你认为自己的问题对整个项目群组来说太愚蠢，也不能成为骚扰个别开发者的理由。</li>\n<li>向列表提问可以分散开发者的负担，个别开发者（尤其是项目领导人）也许太忙以至于没法回答你的问题。</li>\n<li>大多数邮件列表都会被存档，那些被存档的内容将被搜索引擎索引。如果你向列表提问并得到解答，将来其它人可以通过网页搜索找到你的问题和答案，也就不用再次发问了。</li>\n<li>如果某些问题经常被问到，开发者可以利用此信息来改进说明文件或软件本身，以使其更清楚。如果只是私下提问，就没有人能看到最常见问题的完整场景。</li>\n</ul>\n<p>如果一个项目既有&quot;使用者&quot; 也有&quot;开发者&quot;（或&quot;黑客&quot;）邮件列表或论坛，而你又不会动到那些源代码，那么就向&quot;使用者&quot;列表或论坛提问。不要假设自己会在开发者列表中受到欢迎，那些人多半会将你的提问视为干扰他们开发的噪音。</p>\n<p>然而，如果你**<em>确信</em>**你的问题很特别，而且在&quot;使用者&quot; 列表或论坛中几天都没有回复，可以试试前往&quot;开发者&quot;列表或论坛发问。建议你在张贴前最好先暗地里观察几天以了解那里的行事方式（事实上这是参与任何私有或半私有列表的好主意）</p>\n<p>如果你找不到一个项目的邮件列表，而只能查到项目维护者的电子邮件地址，尽管向他发信。即使是在这种情况下，也别假设（项目）邮件列表不存在。在你的电子邮件中，请陈述你已经试过但没有找到合适的邮件列表，也提及你不反对将自己的邮件转发给他人（许多人认为，即使没什么秘密，私人电子邮件也不应该被公开。通过允许将你的电子邮件转发他人，你给了相应人员处置你邮件的选择）。</p>\n<h3 id=\"使用有意义且描述明确的标题\" tabindex=\"-1\"> 使用有意义且描述明确的标题</h3>\n<p>在邮件列表、新闻群组或论坛中，大约50字以内的标题是抓住资深专家注意力的好机会。别用喋喋不休的<code>帮帮忙</code>、<code>跪求</code>、<code>急</code>（更别说<code>救命啊！！！！</code>这样让人反感的话，用这种标题会被条件反射式地忽略）来浪费这个机会。不要妄想用你的痛苦程度来打动我们，而是在这点空间中使用极简单扼要的描述方式来提出问题。</p>\n<p>一个好标题范例是<code>目标 -- 差异</code>式的描述，许多技术支持组织就是这样做的。在<code>目标</code>部分指出是哪一个或哪一组东西有问题，在<code>差异</code>部分则描述与期望的行为不一致的地方。</p>\n<blockquote>\n<p>蠢问题：救命啊！我的笔电不能正常显示了！</p>\n</blockquote>\n<blockquote>\n<p>聪明问题：<a href=\"http://X.org\" target=\"_blank\" rel=\"noopener noreferrer\">X.org</a> 6.8.1的鼠标游标会变形，某牌显卡 MV1005 芯片组。</p>\n</blockquote>\n<blockquote>\n<p>更聪明问题：<a href=\"http://X.org\" target=\"_blank\" rel=\"noopener noreferrer\">X.org</a> 6.8.1的鼠标游标，在某牌显卡 MV1005 芯片组环境下 - 会变形。</p>\n</blockquote>\n<p>编写<code>目标 -- 差异</code> 式描述的过程有助于你组织对问题的细緻思考。是什么被影响了？ 仅仅是鼠标游标或者还有其它图形？只在 <a href=\"http://X.org\" target=\"_blank\" rel=\"noopener noreferrer\">X.org</a> 的 X 版中出现？或只是出现在6.8.1版中？ 是针对某牌显卡芯片组？或者只是其中的 MV1005 型号？ 一个黑客只需瞄一眼就能够立即明白你的环境**<em>和</em>**你遇到的问题。</p>\n<p>总而言之，请想像一下你正在一个只显示标题的存档讨论串（Thread）索引中查寻。让你的标题更好地反映问题，可使下一个搜索类似问题的人能够关注这个讨论串，而不用再次提问相同的问题。</p>\n<p>如果你想在回复中提出问题，记得要修改内容标题，以表明你是在问一个问题， 一个看起来像 <code>Re: 测试</code> 或者 <code>Re: 新bug</code> 的标题很难引起足够重视。另外，在不影响连贯性之下，适当引用并删减前文的内容，能给新来的读者留下线索。</p>\n<p>对于讨论串，不要直接点击回复来开始一个全新的讨论串，这将限制你的观众。因为有些邮件阅读程序，比如 mutt ，允许使用者按讨论串排序并通过折叠讨论串来隐藏消息，这样做的人永远看不到你发的消息。</p>\n<p>仅仅改变标题还不够。mutt 和其它一些邮件阅读程序还会检查邮件标题以外的其它信息，以便为其指定讨论串。所以宁可发一个全新的邮件。</p>\n<p>在网页论坛上，好的提问方式稍有不同，因为讨论串与特定的信息紧密结合，并且通常在讨论串外就看不到里面的内容，故通过回复提问，而非改变标题是可接受的。不是所有论坛都允许在回复中出现分离的标题，而且这样做了基本上没有人会去看。不过，通过回复提问，这本身就是暧昧的做法，因为它们只会被正在查看该标题的人读到。所以，除非你**<em>只想</em>**在该讨论串当前活跃的人群中提问，不然还是另起炉灶比较好。</p>\n<h3 id=\"使问题容易回复\" tabindex=\"-1\"> 使问题容易回复</h3>\n<p>以<code>请将你的回复寄到……</code>来结束你的问题多半会使你得不到回答。如果你觉得花几秒钟在邮件客户端设置一下回复地址都麻烦，我们也觉得花几秒钟思考你的问题更麻烦。如果你的邮件程序不支持这样做，<a href=\"http://linuxmafia.com/faq/Mail/muas.html\" target=\"_blank\" rel=\"noopener noreferrer\">换个好点的</a>；如果是操作系统不支持这种邮件程序，也换个好点的。</p>\n<p>在论坛，要求通过电子邮件回复是非常无礼的，除非你相信回复的信息可能比较敏感（而且有人会为了某些未知的原因，只让你而不是整个论坛知道答案）。如果你只是想在有人回复讨论串时得到电子邮件提醒，可以要求网页论坛发送给你。几乎所有论坛都支持诸如<code>追踪此讨论串</code>、<code>有回复时发送邮件提醒</code>等功能。</p>\n<h3 id=\"用清晰、正确、精准并语法正确的语句\" tabindex=\"-1\"> 用清晰、正确、精准并语法正确的语句</h3>\n<p>我们从经验中发现，粗心的提问者通常也会粗心的写程序与思考（我敢打包票）。回答粗心大意者的问题很不值得，我们宁愿把时间耗在别处。</p>\n<p>正确的拼字、标点符号和大小写是很重要的。一般来说，如果你觉得这样做很麻烦，不想在乎这些，那我们也觉得麻烦，不想在乎你的提问。花点额外的精力斟酌一下字句，用不着太僵硬与正式 -- 事实上，黑客文化很看重能准确地使用非正式、俚语和幽默的语句。但它**<em>必须很</em>**准确，而且有迹象表明你是在思考和关注问题。</p>\n<p>正确地拼写、使用标点和大小写，不要将<code>its</code>混淆为<code>it's</code>，<code>loose</code>搞成<code>lose</code>或者将<code>discrete</code>弄成<code>discreet</code>。不要<strong>全部用大写</strong>，这会被视为无礼的大声嚷嚷（全部小写也好不到哪去，因为不易阅读。<a href=\"http://en.wikipedia.org/wiki/Alan_Cox\" target=\"_blank\" rel=\"noopener noreferrer\">Alan Cox</a>也许可以这样做，但你不行。）</p>\n<p>更白话的说，如果你写得像是个半文盲[译注：<a href=\"http://zh.wikipedia.org/zh-tw/%E5%B0%8F%E7%99%BD\" target=\"_blank\" rel=\"noopener noreferrer\">小白</a>]），那多半得不到理睬。也不要使用即时通讯中的简写或<a href=\"http://zh.wikipedia.org/zh-tw/%E7%81%AB%E6%98%9F%E6%96%87\" target=\"_blank\" rel=\"noopener noreferrer\">火星文</a>，如将<code>的</code>简化为<code>ㄉ</code>会使你看起来像一个为了少打几个键而省字的小白。更糟的是，如果像个小孩似地鬼画符那绝对是在找死，可以肯定没人会理你（或者最多是给你一大堆指责与挖苦）。</p>\n<p>如果在使用非母语的论坛提问，你可以犯点拼写和语法上的小错，但决不能在思考上马虎（没错，我们通常能弄清两者的分别）。同时，除非你知道回复者使用的语言，否则请使用英语书写。繁忙的黑客一般会直接删除用他们看不懂语言写的消息。在网络上英语是通用语言，用英语书写可以将你的问题在尚未被阅读就被直接删除的可能性降到最低。</p>\n<p>如果英文是你的外语（Second language），提示潜在回复者你有潜在的语言困难是很好的：\n[译注：以下附上原文以供使用]</p>\n<blockquote>\n<p>English is not my native language; please excuse typing errors.</p>\n</blockquote>\n<ul>\n<li>英文不是我的母语，请原谅我的错字或语法</li>\n</ul>\n<blockquote>\n<p>If you speak $LANGUAGE, please email/PM me;\nI may need assistance translating my question.</p>\n</blockquote>\n<ul>\n<li>如果你说<strong>某语言</strong>，请寄信/私讯给我；我需要有人协助我翻译我的问题</li>\n</ul>\n<blockquote>\n<p>I am familiar with the technical terms,\nbut some slang expressions and idioms are difficult for me.</p>\n</blockquote>\n<ul>\n<li>我对技术名词很熟悉，但对于俗语或是特别用法比较不甚了解。</li>\n</ul>\n<blockquote>\n<p>I've posted my question in $LANGUAGE and English.\nI'll be glad to translate responses, if you only use one or the other.</p>\n</blockquote>\n<ul>\n<li>我把我的问题用<strong>某语言</strong>和英文写出来，如果你只用一种语言回答，我会乐意将其翻译成另一种。</li>\n</ul>\n<h3 id=\"使用易于读取且标准的文件格式发送问题\" tabindex=\"-1\"> 使用易于读取且标准的文件格式发送问题</h3>\n<p>如果你人为地将问题搞得难以阅读，它多半会被忽略，人们更愿读易懂的问题，所以：</p>\n<ul>\n<li>使用纯文字而不是HTML (<a href=\"http://archive.birdhouse.org/etc/evilmail.html\" target=\"_blank\" rel=\"noopener noreferrer\">关闭HTML</a>并不难）</li>\n<li>使用MIME附件通常是可以的，前提是真正有内容（譬如附带的源代码或patch），而不仅仅是邮件程序生成的模板（譬如只是信件内容的拷贝）。</li>\n<li>不要发送一段文字只是单行句子但多次断行的邮件（这使得回复部分内容非常困难）。设想你的读者是在80个字符宽的终端机上阅读邮件，最好设置你的断行点小于80字。</li>\n<li>但是，也**<em>不要</em>**用任何固定断行资料（譬如日志档案拷贝或会话记录）。档案应该原样包含，让回复者有信心他们看到的是和你看到的一样的东西。</li>\n<li>在英语论坛中，不要使用<code>Quoted-Printable</code> MIME编码发送消息。这种编码对于张贴非ASCII语言可能是必须的，但很多邮件程序并不支持这种编码。当它们分断时，那些文本中四处散布的<code>=20</code>符号既难看也分散注意力，甚至有可能破坏内容的语意。</li>\n<li>绝对，**<em>永远</em>**不要指望黑客们阅读使用封闭格式编写的文档，像是微软公司的Word或Excel文件等。大多数黑客对此的反应就像有人将还在冒热气的猪粪倒在你门口阶梯上时你的反应一样。即便他们能够处理，他们也很厌恶这么做。</li>\n<li>如果你从使用Windows的电脑发送电子邮件，关闭微软愚蠢的<code>智能引号</code>功能 （从[选项] &gt; [校订] &gt; [自动校正选项], 按掉<code>智能引号</code>单选框），以免在你的邮件中到处散布垃圾字符。</li>\n<li>在论坛，勿滥用<code>表情符号</code>和<code>HTML</code>功能（当它们提供时）。一两个表情符号通常没有问题，但花哨的彩色文本倾向于使人认为你是个无能之辈。过滥地使用表情符号、色彩和字体会使你看来像个傻笑的小姑娘。这通常不是个好主意，除非你只是对sex而不是有用的回复更有兴趣。</li>\n</ul>\n<p>如果你使用图形用户界面的邮件程序（如微软公司的Outlook或者其它类似的），注意它们的默认设置不一定满足这些要求。大多数这类程序有基于选单的<code>查看源代码</code>命令，用它来检查发送文件夹中的消息，以确保发送的是没有多餘杂质的纯文本文件。</p>\n<h3 id=\"精确的描述问题并言之有物\" tabindex=\"-1\"> 精确的描述问题并言之有物</h3>\n<ul>\n<li>仔细、清楚地描述你的问题或Bug的症状。</li>\n<li>描述问题发生的环境（机器配置、操作系统、应用程序、以及相关的信息），提供经销商的发行版和版本号（如：<code>Fedora Core 4</code>、<code>Slackware 9.1</code>等）。</li>\n<li>描述在提问前你是怎样去研究和理解这个问题的。</li>\n<li>描述在提问前为确定问题而采取的诊断步骤。</li>\n<li>描述最近做过什么可能相关的硬件或软件变更。</li>\n<li>尽可能的提供一个可以<code>重现这个问题的既定环境</code>的方法</li>\n</ul>\n<p>尽量去揣测一个黑客会怎样反问你，在他提问的时候预先给他答案。</p>\n<p>以上几点中，当你报告的是你认为可能在代码中的问题时，给黑客一个可以重现你的问题的环境尤其重要。当你这么做时，你得到有效的回答的机会和速度都会大大的提升。</p>\n<p><a href=\"http://www.chiark.greenend.org.uk/~sgtatham/\" target=\"_blank\" rel=\"noopener noreferrer\">Simon Tatham</a>写过一篇名为《<a href=\"http://www.chiark.greenend.org.uk/~sgtatham/bugs-tw.html\" target=\"_blank\" rel=\"noopener noreferrer\">如何有效的报告Bug</a>》的出色文章。强力推荐你也读一读。</p>\n<h3 id=\"话不在多而在精\" tabindex=\"-1\"> 话不在多而在精</h3>\n<p>你需要提供精确有内容的信息。这并不是要求你简单的把成堆的出错代码或者资料完全转录到你的提问中。如果你有庞大而复杂的测试样例能重现程序挂掉的情境，尽量将它剪裁得越小越好。</p>\n<p>这样做的用处至少有三点。\n第一，表现出你为简化问题付出了努力，这可以使你得到回答的机会增加；\n第二，简化问题使你更有可能得到**<em>有用</em>**的答案；\n第三，在精炼你的bug报告的过程中，你很可能就自己找到了解决方法或权宜之计。</p>\n<h3 id=\"别动辄声称找到bug\" tabindex=\"-1\"> 别动辄声称找到Bug</h3>\n<p>当你在使用软件中遇到问题，除非你非常、**<em>非常</em>**的有根据，不要动辄声称找到了Bug。提示：除非你能提供解决问题的源代码补丁，或者对前一版本的回归测试表现出不正确的行为，否则你都多半不够完全确信。这同样适用在网页和文件，如果你（声称）发现了文件的<code>Bug</code>，你应该能提供相应位置的修正或替代文件。</p>\n<p>请记得，还有许多其它使用者没遇到你发现的问题，否则你在阅读文件或搜索网页时就应该发现了（你在抱怨前？）。这也意味着很有可能是你弄错了而不是软件本身有问题。</p>\n<p>编写软件的人总是非常辛苦地使它尽可能完美。如果你声称找到了Bug，也就是在质疑他们的能力，即使你是对的，也有可能会冒犯到其中某部分人。这尤其严重当你在标题中嚷嚷着有<code>Bug</code>。</p>\n<p>提问时，即使你私下非常确信已经发现一个真正的Bug，最好写得像是**<em>你</em>**做错了什么。如果真的有Bug，你会在回复中看到这点。这样做的话，如果真有Bug，维护者就会向你道歉，这总比你惹恼别人然后欠别人一个道歉要好一点。</p>\n<h3 id=\"可以低声下气-但还是要先做功课\" tabindex=\"-1\"> 可以低声下气，但还是要先做功课</h3>\n<p>有些人明白他们不该粗鲁或傲慢的提问并要求得到答复，但他们选择另一个极端 -- 低声下气：<code>我知道我只是个可悲的新手，一个撸瑟，但...</code>。这既使人困扰，也没有用，尤其是伴随着与实际问题含糊不清的描述时更令人反感。</p>\n<p>别用原始灵长类动物的把戏来浪费你我的时间。取而代之的是，尽可能清楚地描述背景条件和你的问题情况。这比低声下气更好地定位了你的位置。</p>\n<p>有时网页论坛会设有专为新手提问的版面，如果你真的认为遇到了初学者的问题，到那去就是了，但一样别那么低声下气。</p>\n<h3 id=\"描述问题症状而非猜测\" tabindex=\"-1\"> 描述问题症状而非猜测</h3>\n<p>告诉黑客们你认为问题是怎样造成的并没什么帮助。（如果你的推断如此有效，还用向别人求助吗？），因此要确信你原原本本告诉了他们问题的症状，而不是你的解释和理论；让黑客们来推测和诊断。如果你认为陈述自己的猜测很重要，清楚地说明这只是你的猜测，并描述为什么它们不起作用。</p>\n<p><em><strong>蠢问题</strong></em></p>\n<blockquote>\n<p>我在编译内核时接连遇到 SIG11 错误，\n我怀疑某条飞线搭在主板的走线上了，这种情况应该怎样检查最好？</p>\n</blockquote>\n<p><em><strong>聪明问题</strong></em></p>\n<blockquote>\n<p>我的组装电脑是 FIC-PA2007 主机板搭载 AMD K6/233 CPU（威盛 Apollo VP2芯片组），\n256MB Corsair PC133 SDRAM内存，在编译内核时，从开机20分钟以后就频频产生 SIG11 错误，\n但是在头20分钟内从没发生过相同的问题。重新启动也没有用，但是关机一晚上就又能工作20分钟。\n所有内存都换过了，没有效果。相关部分的标准编译记录如下…。</p>\n</blockquote>\n<p>由于以上这点似乎让许多人觉得难以配合，这里有句话可以提醒你：<code>所有的诊断专家都来自密苏里州。</code> 美国国务院的官方座右铭则是：<code>让我看看</code>（出自国会议员 Willard D. Vandiver 在1899年时的讲话：<code>我来自一个出产玉米，棉花，牛蒡和民主党人的国家，滔滔雄辩既不能说服我，也不会让我满意。我来自密苏里州，你必须让我看看。</code>） 针对诊断者而言，这并不是一种怀疑，而只是一种真实而有用的需求，以便让他们看到的是与你看到的原始证据尽可能一致的东西，而不是你的猜测与归纳的结论。所以，大方的展示给我们看吧！</p>\n<h3 id=\"按发生时间先后列出问题症状\" tabindex=\"-1\"> 按发生时间先后列出问题症状</h3>\n<p>问题发生前的一系列操作，往往就是对找出问题最有帮助的线索。因此，你的说明里应该包含你的操作步骤，以及机器和软件的反应，直到问题发生。在命令行处理的情况下，提供一段操作记录（例如运行脚本工具所生成的），并引用相关的若干行（如20行）记录会非常有帮助。</p>\n<p>如果挂掉的程序有诊断选项（如 -v 的详述开关），试着选择这些能在记录中增加调试信息的选项。记住，<code>多</code>不等于<code>好</code>。试着选取适当的调试级别以便提供有用的信息而不是让读者淹没在垃圾中。</p>\n<p>如果你的说明很长（如超过四个段落），在开头简述问题，接下来再按时间顺序详述会有所帮助。这样黑客们在读你的记录时就知道该注意哪些内容了。</p>\n<h3 id=\"描述目标而不是过程\" tabindex=\"-1\"> 描述目标而不是过程</h3>\n<p>如果你想弄清楚如何做某事（而不是报告一个Bug），在开头就描述你的目标，然后才陈述重现你所卡住的特定步骤。</p>\n<p>经常寻求技术帮助的人在心中有个更高层次的目标，而他们在自以为能达到目标的特定道路上被卡住了，然后跑来问该怎么走，但没有意识到这条路本身就有问题。结果要费很大的劲才能搞定。</p>\n<p><strong>蠢问题</strong></p>\n<blockquote>\n<p>我怎样才能从某绘图程序的颜色选择器中取得十六进制的的RGB值？</p>\n</blockquote>\n<p><strong>聪明问题</strong></p>\n<blockquote>\n<p>我正试着用替换一幅图片的色码成自己选定的色码，我现在知道的唯一方法是编辑每个色码区块，\n但却无法从某绘图程序的颜色选择器取得十六进制的的RGB值。</p>\n</blockquote>\n<p>第二种提问法比较聪明，你可能得到像是<code>建议采用另一个更合适的工具</code>的回复。</p>\n<h3 id=\"别要求使用私人电邮回复\" tabindex=\"-1\"> 别要求使用私人电邮回复</h3>\n<p>黑客们认为问题的解决过程应该公开、透明，此过程中如果更有经验的人注意到不完整或者不当之处，最初的回复才能够、也应该被纠正。同时，作为提供帮助者也能因为能力和学识被其它同行看到而得到某种奖励。</p>\n<p>当你要求私下回复时，这个过程和奖励都被中止。别这样做，让**<em>回复者</em>**来决定是否私下回答 -- 如果他真这么做了，通常是因为他认为问题编写太差或者太肤浅，以至于对其它人没有兴趣。</p>\n<p>这条规则存在一条有限的例外，如果你确信提问可能会引来大量雷同的回复时，那么这个神奇的提问句会是<code>向我发电邮，我将为论坛归纳这些回复</code>。试着将邮件列表或新闻群组从洪水般的雷同回复中解救出来是非常有礼貌的 -- 但你必须信守诺言。</p>\n<h3 id=\"清楚明确的表达你的问题以及需求\" tabindex=\"-1\"> 清楚明确的表达你的问题以及需求</h3>\n<p>漫无边际的提问近乎无休无止的时间黑洞。最有可能给你有用答案的人通常也正是最忙的人（他们忙是因为要亲自完成大部分工作）。这样的人对无节制的时间黑洞相当厌恶，所以他们也倾向于厌恶那些漫无边际的提问。</p>\n<p>如果你明确表述需要回答者做什么（如提供指点、发送一段代码、检查你的补丁、或是其他等等），就最有可能得到有用的答案。因为这会定出一个时间和精力的上限，便于回答者能集中精力来帮你。这么做很棒。</p>\n<p>要理解专家们所处的世界，请把专业技能想像为充裕的资源，而回复的时间则是稀缺的资源。你要求他们奉献的时间越少，你越有可能从真正专业而且很忙的专家那里得到解答。</p>\n<p>所以，界定一下你的问题，使专家花在辨识你的问题和回答所需要付出的时间减到最少，这技巧对你有用答案相当有帮助 -- 但这技巧通常和简化问题有所区别。因此，问<code>我想更好的理解X，可否指点一下哪有好一点说明？</code>通常比问<code>你能解释一下X吗？</code>更好。如果你的代码不能运作，通常请别人看看哪里有问题，比要求别人替你改正要明智得多。</p>\n<h3 id=\"询问有关代码的问题时\" tabindex=\"-1\"> 询问有关代码的问题时</h3>\n<p>别要求他人帮你有问题的代码调试而不提示一下应该从何入手。张贴几百行的代码，然后说一声：<code>它不会动</code>会让你完全被忽略。只贴几十行代码，然后说一句：<code>在第七行以后，我期待它显示 &lt;x&gt;，但实际出现的是 &lt;y&gt;</code>比较有可能让你得到回应。</p>\n<p>最有效描述程序问题的方法是提供最精简的Bug展示测试示例（bug-demonstrating test case）。什么是最精简的测试示例? 那是问题的缩影；一小个程序片段能<strong>刚好</strong>展示出程序的异常行为，而不包含其他令人分散注意力的内容。怎么制作最精简的测试示例？如果你知道哪一行或哪一段代码会造成异常的行为，复制下来并加入足够重现这个状况的代码（例如，足以让这段代码能被编译/直译/被应用程序处理）。如果你无法将问题缩减到一个特定区块，就复制一份代码并移除不影响产生问题行为的部分。总之，测试示例越小越好（查看一节）。</p>\n<p>一般而言，要得到一段相当精简的测试示例并不太容易，但永远先尝试这样做的是种好习惯。这种方式可以帮助你了解如何自行解决这个问题 —- 而且即使你的尝试不成功，黑客们也会看到你在尝试取得答案的过程中付出了努力，这可以让他们更愿意与你合作。</p>\n<p>如果你只是想让别人帮忙审查（Review）一下代码，在信的开头就要说出来，并且一定要提到你认为哪一部分特别需要关注以及为什么。</p>\n<h3 id=\"别把自己家庭作业的问题贴上来\" tabindex=\"-1\"> 别把自己家庭作业的问题贴上来</h3>\n<p>黑客们很擅长分辨哪些问题是家庭作业式的问题；因为我们中的大多数都曾自己解决这类问题。同样，这些问题得由**<em>你</em>**来搞定，你会从中学到东西。你可以要求给点提示，但别要求得到完整的解决方案。</p>\n<p>如果你怀疑自己碰到了一个家庭作业式的问题，但仍然无法解决，试试在使用者群组，论坛或（最后一招）在项目的<strong>使用者</strong>邮件列表或论坛中提问。尽管黑客们**<em>会</em>**看出来，但一些有经验的使用者也许仍会给你一些提示。</p>\n<h3 id=\"去掉无意义的提问句\" tabindex=\"-1\"> 去掉无意义的提问句</h3>\n<p>避免用无意义的话结束提问，例如<code>有人能帮我吗？</code>或者<code>这有答案吗？</code>。</p>\n<p>首先：如果你对问题的描述不是很好，这样问更是画蛇添足。</p>\n<p>其次：由于这样问是画蛇添足，黑客们会很厌烦你 -- 而且通常会用逻辑上正确，但毫无意义的回答来表示他们的蔑视， 例如：<code>没错，有人能帮你</code>或者<code>不，没答案</code>。</p>\n<p>一般来说，避免用 <code>是或否</code>、<code>对或错</code>、<code>有或没有</code>类型的问句，除非你想得到<a href=\"http://homepage.ntlworld.com./jonathan.deboynepollard/FGA/questions-with-yes-or-no-answers.html\" target=\"_blank\" rel=\"noopener noreferrer\">是或否类型的回答</a>。</p>\n<h3 id=\"即使你很急也不要在标题写紧急\" tabindex=\"-1\"> 即使你很急也不要在标题写<code>紧急</code></h3>\n<p>这是你的问题，不是我们的。宣称<code>紧急</code>极有可能事与愿违：大多数黑客会直接删除无礼和自私地企图即时引起关注的问题。更严重的是，<code>紧急</code>这个字（或是其他企图引起关注的标题）通常会被垃圾信过滤器过滤掉 -- 你希望能看到你问题的人可能永远也看不到。</p>\n<p>有半个例外的情况是，如果你是在一些很高调，会使黑客们兴奋的地方，也许值得这样去做。在这种情况下，如果你有时间压力，也很有礼貌地提到这点，人们也许会有兴趣回答快一点。</p>\n<p>当然，这风险很大，因为黑客们兴奋的点多半与你的不同。譬如从 NASA 国际空间站（International Space Station）发这样的标题没有问题，但用自我感觉良好的慈善行为或政治原因发肯定不行。事实上，张贴诸如<code>紧急：帮我救救这个毛绒绒的小海豹！</code>肯定让你被黑客忽略或惹恼他们，即使他们认为毛绒绒的小海豹很重要。</p>\n<p>如果你觉得这点很不可思议，最好再把这份指南剩下的内容多读几遍，直到你弄懂了再发文。</p>\n<h3 id=\"礼多人不怪-而且有时还很有帮助\" tabindex=\"-1\"> 礼多人不怪，而且有时还很有帮助</h3>\n<p>彬彬有礼，多用<code>请</code>和<code>谢谢您的关注</code>，或<code>谢谢你的关照</code>。让大家都知道你对他们花时间免费提供帮助心存感激。</p>\n<p>坦白说，这一点并没有比清晰、正确、精准并合法语法和避免使用专用格式重要（也不能取而代之）。黑客们一般宁可读有点唐突但技术上鲜明的Bug报告，而不是那种有礼但含糊的报告。（如果这点让你不解，记住我们是按问题能教我们什么来评价问题的价值的）</p>\n<p>然而，如果你有一串的问题待解决，客气一点肯定会增加你得到有用回应的机会。</p>\n<p>（我们注意到，自从本指南发布后，从资深黑客那里得到的唯一严重缺陷反馈，就是对预先道谢这一条。一些黑客觉得<code>先谢了</code>意味着事后就不用再感谢任何人的暗示。我们的建议是要么先说<code>先谢了</code>，**<em>然后</em>**事后再对回复者表示感谢，或者换种方式表达感激，譬如用<code>谢谢你的关注</code>或<code>谢谢你的关照</code>。）</p>\n<h3 id=\"问题解决后-加个简短的补充说明\" tabindex=\"-1\"> 问题解决后，加个简短的补充说明</h3>\n<p>问题解决后，向所有帮助过你的人发个说明，让他们知道问题是怎样解决的，并再一次向他们表示感谢。如果问题在新闻组或者邮件列表中引起了广泛关注，应该在那里贴一个说明比较恰当。</p>\n<p>最理想的方式是向最初提问的话题回复此消息，并在标题中包含<code>已修正</code>，<code>已解决</code>或其它同等含义的明显标记。在人来人往的邮件列表里，一个看见讨论串<code>问题 X</code>和<code>问题的X - 已解决</code>的潜在回复者就明白不用再浪费时间了（除非他个人觉得<code>问题 X</code>的有趣），因此可以利用此时间去解决其它问题。</p>\n<p>补充说明不必很长或是很深入；简单的一句<code>你好，原来是网线出了问题！谢谢大家 – Bill</code>比什么也不说要来的好。事实上，除非结论真的很有技术含量，否则简短可爱的小结比长篇大论更好。说明问题是怎样解决的，但大可不必将解决问题的过程复述一遍。</p>\n<p>对于有深度的问题，张贴调试记录的摘要是有帮助的。描述问题的最终状态，说明是什么解决了问题，在此**<em>之后</em>**才指明可以避免的盲点。避免盲点的部分应放在正确的解决方案和其它总结材料之后，而不要将此信息搞成侦探推理小说。列出那些帮助过你的名字，会让你交到更多朋友。</p>\n<p>除了有礼貌和有内涵以外，这种类型的补充也有助于他人在邮件列表/新闻群组/论坛中搜索到真正解决你问题的方案，让他们也从中受益。</p>\n<p>至少，这种补充有助于让每位参与协助的人因问题的解决而从中得到满足感。如果你自己不是技术专家或者黑客，那就相信我们，这种感觉对于那些你向他们求助的大师或者专家而言，是非常重要的。问题悬而未决会让人灰心；黑客们渴望看到问题被解决。好人有好报，满足他们的渴望，你会在下次提问时尝到甜头。</p>\n<p>思考一下怎样才能避免他人将来也遇到类似的问题，自问写一份文件或加个常见问题（FAQ）会不会有帮助。如果是的话就将它们发给维护者。</p>\n<p>在黑客中，这种良好的后继行动实际上比传统的礼节更为重要，也是你如何透过善待他人而赢得声誉的方式，这是非常有价值的资产。</p>\n<h2 id=\"如何解读答案\" tabindex=\"-1\"> 如何解读答案</h2>\n<p><a id=\"RTFM\"></a></p>\n<h3 id=\"rtfm和stfw-如何知道你已完全搞砸了\" tabindex=\"-1\"> RTFM和STFW：如何知道你已完全搞砸了</h3>\n<p>有一个古老而神圣的传统：如果你收到<code>RTFM （Read The Fucking Manual）</code>的回应，回答者认为你<strong>应该去读他妈的手册</strong>。当然，基本上他是对的，你应该去读一读。</p>\n<p>RTFM 有一个年轻的亲戚。如果你收到<code>STFW（Search The Fucking Web）</code>的回应，回答者认为你<strong>应该到他妈的网上搜索</strong>过了。那人多半也是对的，去搜索一下吧。（更温和一点的说法是 <strong><a href=\"http://lmgtfy.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Google是你的朋友</a></strong>！）</p>\n<p>在论坛，你也可能被要求去爬爬论坛的旧文。事实上，有人甚至可能热心地为你提供以前解决此问题的讨论串。但不要依赖这种关照，提问前应该先搜索一下旧文。</p>\n<p>通常，用这两句之一回答你的人会给你一份包含你需要内容的手册或者一个网址，而且他们打这些字的时候也正在读着。这些答复意味着回答者认为</p>\n<ul>\n<li><strong>你需要的信息非常容易获得</strong>；</li>\n<li><strong>你自己去搜索这些信息比灌给你能让你学到更多</strong>。</li>\n</ul>\n<p>你不应该因此不爽；<strong>依照黑客的标准，他已经表示了对你一定程度的关注，而没有对你的要求视而不见</strong>。你应该对他祖母般的慈祥表示感谢。</p>\n<h3 id=\"如果还是搞不懂\" tabindex=\"-1\"> 如果还是搞不懂</h3>\n<p>如果你看不懂回应，别立刻要求对方解释。像你以前试着自己解决问题时那样（利用手册，FAQ，网络，身边的高手），先试着去搞懂他的回应。如果你真的需要对方解释，记得表现出你已经从中学到了点什么。</p>\n<p>比方说，如果我回答你：<code>看来似乎是 zentry 卡住了；你应该先清除它。</code>，然后，这是一个**<em>很糟的</em>**后续问题回应：<code>zentry是什么？</code> **<em>好</em>**的问法应该是这样：<code>哦~~~我看过说明了但是只有 -z 和 -p 两个参数中提到了 zentries，而且还都没有清楚的解释如何清除它。你是指这两个中的哪一个吗？还是我看漏了什么？</code></p>\n<h3 id=\"处理无礼的回应\" tabindex=\"-1\"> 处理无礼的回应</h3>\n<p>很多黑客圈子中看似无礼的行为并不是存心冒犯。相反，它是直接了当，一针见血式的交流风格，这种风格更注重解决问题，而不是使人感觉舒服而却模模糊糊。</p>\n<p>如果你觉得被冒犯了，试着平静地反应。如果有人真的做了出格的事，邮件列表、新闻群组或论坛中的前辈多半会招呼他。如果这**<em>没有</em><strong>发生而你却发火了，那么你发火对象的言语可能在黑客社区中看起来是正常的，而</strong><em>你</em>**将被视为有错的一方，这将伤害到你获取信息或帮助的机会。</p>\n<p>另一方面，你偶而真的会碰到无礼和无聊的言行。与上述相反，对真正的冒犯者狠狠地打击，用犀利的语言将其驳得体无完肤都是可以接受的。然而，在行事之前一定要非常非常的有根据。纠正无礼的言论与开始一场毫无意义的口水战仅一线之隔，黑客们自己莽撞地越线的情况并不鲜见。如果你是新手或外人，避开这种莽撞的机会并不高。如果你想得到的是信息而不是消磨时光，这时最好不要把手放在键盘上以免冒险。</p>\n<p>（有些人断言很多黑客都有轻度的自闭症或亚斯伯格综合症，缺少用于润滑人类社会<strong>正常</strong>交往所需的神经。这既可能是真也可能是假的。如果你自己不是黑客，兴许你认为我们脑袋有问题还能帮助你应付我们的古怪行为。只管这么干好了，我们不在乎。我们**<em>喜欢</em>**我们现在这个样子，并且通常对病患标记都有站得住脚的怀疑。）</p>\n<p>在下一节，我们会谈到另一个问题，当**<em>你</em>**行为不当时所会受到的<code>冒犯</code>。</p>\n<h2 id=\"如何避免扮演失败者\" tabindex=\"-1\"> 如何避免扮演失败者</h2>\n<p>在黑客社区的论坛中有那么几次你可能会搞砸 -- 以本指南所描述到的或类似的方式。而你会在公开场合中被告知你是如何搞砸的，也许攻击的言语中还会带点夹七夹八的颜色。</p>\n<p>这种事发生以后，你能做的最糟糕的事莫过于哀嚎你的遭遇、宣称被口头攻击、要求道歉、高声尖叫、憋闷气、威胁诉诸法律、向其雇主报怨、忘了关马桶盖等等。相反地，你该这么做：</p>\n<p>熬过去，这很正常。事实上，它是有益健康且合理的。</p>\n<p>社区的标准不会自行维持，它们是通过参与者积极而**<em>公开地</em>**执行来维持的。不要哭嚎所有的批评都应该通过私下的邮件传送，它不是这样运作的。当有人评论你的一个说法有误或者提出不同看法时，坚持声称受到个人攻击也毫无益处，这些都是失败者的态度。</p>\n<p>也有其它的黑客论坛，受过高礼节要求的误导，禁止参与者张贴任何对别人帖子挑毛病的消息，并声称<code>如果你不想帮助用户就闭嘴。</code> 结果造成有想法的参与者纷纷离开，这么做只会使它们沦为毫无意义的嘮叨与无用的技术论坛。</p>\n<p>夸张的讲法是：你要的是<strong>友善</strong>（以上述方式）还是有用？两个里面挑一个。</p>\n<p>记着：当黑客说你搞砸了，并且（无论多么刺耳）告诉你别再这样做时，他正在为关心<strong>你</strong>和<strong>他的社区</strong>而行动。对他而言，不理你并将你从他的生活中滤掉更简单。如果你无法做到感谢，至少要表现地有点尊严，别大声哀嚎，也别因为自己是个有戏剧性超级敏感的灵魂和自以为有资格的新来者，就指望别人像对待脆弱的洋娃娃那样对你。</p>\n<p>有时候，即使你没有搞砸（或者只是在他的想像中你搞砸了），有些人也会无缘无故地攻击你本人。在这种情况下，抱怨倒是**<em>真的</em>**会把问题搞砸。</p>\n<p>这些来找麻烦的人要么是毫无办法但自以为是专家的不中用家伙，要么就是测试你是否真会搞砸的心理专家。其它读者要么不理睬，要么用自己的方式对付他们。这些来找麻烦的人在给他们自己找麻烦，这点你不用操心。</p>\n<p>也别让自己卷入口水战，最好不要理睬大多数的口水战 -- 当然，是在你检验它们只是口水战，而并未指出你有搞砸的地方，且也没有巧妙地将问题真正的答案藏于其后（这也是有可能的）。</p>\n<h2 id=\"不该问的问题\" tabindex=\"-1\"> 不该问的问题</h2>\n<p>以下是几个经典蠢问题，以及黑客没回答时心中所想的：</p>\n<p>问题：</p>\n<p>问题：</p>\n<p>问题：</p>\n<p>问题：</p>\n<p>问题：</p>\n<p>问题：</p>\n<p>问题：</p>\n<p>问题：</p>\n<p>问题：</p>\n<hr>\n<p><a id=\"q1\"></a></p>\n<blockquote>\n<p>问题：我能在哪找到 X 程序或 X 资源？</p>\n</blockquote>\n<p>回答：就在我找到它的地方啊，白痴 -- 搜索引擎的那一头。天哪！难道还有人不会用 <a href=\"http://www.google.com\" target=\"_blank\" rel=\"noopener noreferrer\">Google</a> 吗？</p>\n<p><a id=\"q2\"></a></p>\n<blockquote>\n<p>问题：我怎样用 X 做 Y？</p>\n</blockquote>\n<p>回答：如果你想解决的是 Y ，提问时别给出可能并不恰当的方法。这种问题说明提问者不但对 X 完全无知，也对 Y 要解决的问题糊涂，还被特定形势禁锢了思维。最好忽略这种人，等他们把问题搞清楚了再说。</p>\n<p><a id=\"q3\"></a></p>\n<blockquote>\n<p>问题：如何设定我的 shell 提示？？</p>\n</blockquote>\n<p>回答：如果你有足够的智慧提这个问题，你也该有足够的智慧去 ，然后自己去找出来。</p>\n<p><a id=\"q4\"></a></p>\n<blockquote>\n<p>问题：我可以用 Bass-o-matic 文件转换工具将 AcmeCorp 档案转换为 TeX 格式吗？</p>\n</blockquote>\n<p>回答：试试看就知道了。如果你试过，你既知道了答案，就不用浪费我的时间了。</p>\n<p><a id=\"q5\"></a></p>\n<blockquote>\n<p>问题：我的程序/设定/SQL语句没有用</p>\n</blockquote>\n<p>回答：这不算是问题吧，我对要我问你二十个问题才找得出你真正问题的问题没兴趣 -- 我有更有意思的事要做呢。在看到这类问题的时候，我的反应通常不外如下三种</p>\n<ul>\n<li>你还有什么要补充的吗？</li>\n<li>真糟糕，希望你能搞定。</li>\n<li>这关我有什么屁事？</li>\n</ul>\n<p><a id=\"q6\"></a></p>\n<blockquote>\n<p>问题：我的 Windows 电脑有问题，你能帮我吗？</p>\n</blockquote>\n<p>回答：能啊，扔掉萎软的垃圾，换个像 Linux 或 BSD 的开放源代码操作系统吧。</p>\n<p>注意：如果程序有官方版 Windows 或者与 Windows 有互动（如Samba），你**<em>可以</em>**问与Windows相关的问题， 只是别对问题是由 Windows 操作系统而不是程序本身造成的回复感到惊讶， 因为 Windows 一般来说实在太烂，这种说法通常都是对的。</p>\n<p><a id=\"q7\"></a></p>\n<blockquote>\n<p>问题：我的程序不会动了，我认为系统工具 X 有问题</p>\n</blockquote>\n<p>回答：你完全有可能是第一个注意到被成千上万用户反复使用的系统调用与函数库档案有明显缺陷的人，更有可能的是你完全没有根据。不同凡响的说法需要不同凡响的证据，当你这样声称时，你必须有清楚而详尽的缺陷说明文件作后盾。</p>\n<p><a id=\"q8\"></a></p>\n<blockquote>\n<p>问题：我在安装 Linux（或者 X ）时有问题，你能帮我吗？</p>\n</blockquote>\n<p>回答：不能，我只有亲自在你的电脑上动手才能找到毛病。还是去找你当地的 Linux 使用群组者寻求实际的指导吧（你能在<a href=\"http://www.linux.org/groups/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">这儿</a>找到使用者群组的清单）。</p>\n<p>注意：如果安装问题与某 Linux 的发行版有关，在它的邮件列表、论坛或本地使用者群组中提问也许是恰当的。此时，应描述问题的准确细节。在此之前，先用 <code>Linux</code> 和**<em>所有</em>**被怀疑的硬件作关键词仔细搜索。</p>\n<p><a id=\"q9\"></a></p>\n<blockquote>\n<p>问题：我怎么才能破解 root 帐号/窃取 OP 特权/读别人的邮件呢？</p>\n</blockquote>\n<p>回答：想要这样做，说明了你是个卑鄙小人；想找个黑客帮你，说明你是个白痴！</p>\n<h2 id=\"好问题与蠢问题\" tabindex=\"-1\"> 好问题与蠢问题</h2>\n<p>最后，我将透过举一些例子，来说明怎样聪明的提问；同一个问题的两种问法被放在一起，一种是愚蠢的，另一种才是明智的。</p>\n<p><strong><em>蠢问题</em></strong>：</p>\n<blockquote>\n<p>我可以在哪儿找到关于 Foonly Flurbamatic 的资料？</p>\n</blockquote>\n<p>这种问法无非想得到  这样的回答。</p>\n<p><strong><em>聪明问题</em></strong>：</p>\n<blockquote>\n<p>我用Google搜索过 &quot;Foonly Flurbamatic 2600&quot;，但是没找到有用的结果。谁知道上哪儿去找对这种设备编程的资料？</p>\n</blockquote>\n<p>这个问题已经 STFW 过了，看起来他真的遇到了麻烦。</p>\n<p><strong><em>蠢问题</em></strong></p>\n<blockquote>\n<p>我从 foo 项目找来的源码没法编译。它怎么这么烂？</p>\n</blockquote>\n<p>他觉得都是别人的错，这个傲慢自大的提问者</p>\n<p><strong><em>聪明问题</em></strong></p>\n<blockquote>\n<p>foo 项目代码在 Nulix 6.2 版下无法编译通过。我读过了 FAQ，但里面没有提到跟 Nulix 有关的问题。这是我编译过程的记录，我有什么做的不对的地方吗？</p>\n</blockquote>\n<p>提问者已经指明了环境，也读过了FAQ，还列出了错误，并且他没有把问题的责任推到别人头上，他的问题值得被关注。</p>\n<p><strong><em>蠢问题</em></strong></p>\n<blockquote>\n<p>我的主机板有问题了，谁来帮我？</p>\n</blockquote>\n<p>某黑客对这类问题的回答通常是：<code>好的，还要帮你拍拍背和换尿布吗？</code>，然后按下删除键。</p>\n<p><strong><em>聪明问题</em></strong></p>\n<blockquote>\n<p>我在 S2464 主机板上试过了 X 、 Y 和 Z ，但没什么作用，我又试了 A 、 B 和 C 。请注意当我尝试 C 时的奇怪现象。显然 florbish 正在 grommicking，但结果出人意料。通常在 Athlon MP 主机板上引起 grommicking 的原因是什么？有谁知道接下来我该做些什么测试才能找出问题？</p>\n</blockquote>\n<p>这个家伙，从另一个角度来看，值得去回答他。他表现出了解决问题的能力，而不是坐等天上掉答案。</p>\n<p>在最后一个问题中，注意<code>告诉我答案</code>和<code>给我启示，指出我还应该做什么诊断工作</code>之间微妙而又重要的区别。</p>\n<p>事实上，后一个问题源自于 2001 年 8 月在 Linux 内核邮件列表（lkml）上的一个真实的提问。我（Eric）就是那个提出问题的人。我在 Tyan S2464 主板上观察到了这种无法解释的锁定现象，列表成员们提供了解决这一问题的重要信息。</p>\n<p>通过我的提问方法，我给了别人可以咀嚼玩味的东西；我设法让人们很容易参与并且被吸引进来。我显示了自己具备和他们同等的能力，并邀请他们与我共同探讨。通过告诉他们我所走过的弯路，以避免他们再浪费时间，我也表明了对他们宝贵时间的尊重。</p>\n<p>事后，当我向每个人表示感谢，并且讚赏这次良好的讨论经歷的时候， 一个 Linux 内核邮件列表的成员表示，他觉得我的问题得到解决并非由于我是这个列表中的**<em>名人</em>**，而是因为我用了正确的方式来提问。</p>\n<p>黑客从某种角度来说是拥有丰富知识但缺乏人情味的家伙；我相信他是对的，如果我**<em>像</em>**个乞讨者那样提问，不论我是谁，一定会惹恼某些人或者被他们忽视。他建议我记下这件事，这直接导致了本指南的出现。</p>\n<h2 id=\"如果得不到回答\" tabindex=\"-1\"> 如果得不到回答</h2>\n<p>如果仍得不到回答，请不要以为我们觉得无法帮助你。有时只是看到你问题的人不知道答案罢了。没有回应不代表你被忽视，虽然不可否认这种差别很难区分。</p>\n<p>总的来说，简单的重复张贴问题是个很糟的点子。这将被视为无意义的喧闹。有点耐心，知道你问题答案的人可能生活在不同的时区，可能正在睡觉，也有可能你的问题一开始就没有组织好。</p>\n<p>你可以通过其他渠道获得帮助，这些渠道通常更适合初学者的需要。</p>\n<p>有许多网上的以及本地的使用者群组，由热情的软件爱好者（即使他们可能从没亲自写过任何软件）组成。通常人们组建这样的团体来互相帮助并帮助新手。</p>\n<p>另外，你可以向很多商业公司寻求帮助，不论公司大还是小。别为要付费才能获得帮助而感到沮丧！毕竟，假使你的汽车发动机汽缸密封圈爆掉了-- 完全可能如此 --你还得把它送到修车铺，并且为维修付费。就算软件没花费你一分钱，你也不能强求技术支持总是免费的。</p>\n<p>对像是 Linux 这种大众化的软件，每个开发者至少会对应到上万名使用者。根本不可能由一个人来处理来自上万名使用者的求助电话。要知道，即使你要为这些协助付费，和你所购买的同类软件相比，你所付出的也是微不足道的（通常封闭源代码软件的技术支持费用比开放源代码软件的要高得多，且内容也没那么丰富）。</p>\n<h2 id=\"如何更好地回答问题\" tabindex=\"-1\"> 如何更好地回答问题</h2>\n<p><strong><em>态度和善一点</em></strong>。问题带来的压力常使人显得无礼或愚蠢，其实并不是这样。</p>\n<p><strong><em>对初犯者私下回复</em></strong>。对那些坦诚犯错之人没有必要当众羞辱，一个真正的新手也许连怎么搜索或在哪找常见问题都不知道。</p>\n<p><strong><em>如果你不确定，一定要说出来</em></strong>！一个听起来权威的错误回复比没有还要糟，别因为听起来像个专家很好玩，就给别人乱指路。要谦虚和诚实，给提问者与同行都树个好榜样。</p>\n<p><strong><em>如果帮不了忙，也别妨碍他</em></strong>。不要在实际步骤上开玩笑，那样也许会毁了使用者的设置 --有些可怜的呆瓜会把它当成真的指令。</p>\n<p><strong><em>试探性的反问以引出更多的细节</em></strong>。如果你做得好，提问者可以学到点东西 --你也可以。试试将蠢问题转变成好问题，别忘了我们都曾是新手。</p>\n<p>尽管对那些懒虫抱怨一声 RTFM 是正当的，能指出文件的位置（即使只是建议个 Google 搜索关键词）会更好。</p>\n<p><strong><em>如果你决定回答，就请给出好的答案</em></strong>。当别人正在用错误的工具或方法时别建议笨拙的权宜之计（wordaround），应推荐更好的工具，重新界定问题。</p>\n<p><strong><em>正面的回答问题</em></strong>！如果这个提问者已经很深入的研究而且也表明已经试过 X 、 Y 、 Z 、 A 、 B 、 C 但没得到结果，回答 <code>试试看 A 或是 B</code> 或者 <code>试试X 、 Y 、 Z 、 A 、 B 、 C</code> 并附上一个链接一点用都没有。</p>\n<p><strong><em>帮助你的社区从问题中学习</em></strong>。当回复一个好问题时，问问自己<code>如何修改相关文件或常见问题文件以免再次解答同样的问题？</code>，接着再向文件维护者发一份补丁。</p>\n<p>如果你是在研究一番后才做出的回答，<strong><em>展现你的技巧而不是直接端出结果</em></strong>。毕竟<code>授人以鱼不如授人以渔</code>。</p>\n<h2 id=\"鸣谢\" tabindex=\"-1\"> 鸣谢</h2>\n<ul>\n<li>Evelyn Mitchel贡献了一些愚蠢问题例子并启发了编写<code>如何更好地回答问题</code>这一节</li>\n<li>Mikhail Ramendik贡献了一些特别有价值的建议和改进</li>\n<li>xlc520重新编辑了部分，并加入插图</li>\n</ul>\n",
      "image": "https://fastly.jsdelivr.net/gh/xlc520/MyImage@main/MdImg/提问的艺术.jpg",
      "date_published": "2022-03-29T00:00:00.000Z",
      "date_modified": "2022-06-09T09:00:12.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "essay"
      ]
    },
    {
      "title": "Nice Article",
      "url": "https://blog.ciberviler.top/essay/",
      "id": "https://blog.ciberviler.top/essay/",
      "summary": "article分类",
      "content_html": "<p align=\"center\"> \n  <img src=\"https://metrics.lecoq.io/xlc520?template=classic&isocalendar=1&languages=1&people=1&activity=1&achievements=1&lines=1&repositories=1&notable=1&introduction=1&pagespeed=1&repositories=100&repositories.batch=100&repositories.forks=false&repositories.affiliations=owner&isocalendar.duration=full-year&languages.limit=8&languages.threshold=0%&languages.colors=github&languages.sections=most-used&languages.indepth=false&languages.analysis.timeout=15&languages.categories=markup%2C programming&languages.recent.categories=markup%2C programming&languages.recent.load=300&languages.recent.days=14&people.limit=24&people.identicons=false&people.identicons.hide=false&people.size=28&people.types=followers%2C following&people.shuffle=false&activity.limit=5&activity.load=300&activity.days=14&activity.visibility=all&activity.timestamps=false&activity.filter=all&achievements.threshold=C&achievements.secrets=true&achievements.display=detailed&achievements.limit=0&notable.from=organization&notable.repositories=false&notable.indepth=false&notable.types=commit&repositories.featured= xlc520%2Fxlc520.github.io&introduction.title=true&pagespeed.url=xlc520.github.io&pagespeed.detailed=false&pagespeed.screenshot=false&config.timezone=Asia%2FShanghai\" /> \n</p>\n<p align=\"center\"> \n  您是第  <img src=\"https://profile-counter.glitch.me/xlc520/count.svg\" />  位访问者\n</p>",
      "date_published": "2022-03-20T00:00:00.000Z",
      "date_modified": "2022-06-09T09:00:12.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "essay"
      ]
    },
    {
      "title": "人生三境界",
      "url": "https://blog.ciberviler.top/essay/%E4%BA%BA%E7%94%9F%E4%B8%89%E5%A2%83%E7%95%8C.html",
      "id": "https://blog.ciberviler.top/essay/%E4%BA%BA%E7%94%9F%E4%B8%89%E5%A2%83%E7%95%8C.html",
      "summary": "人生三境界，格局决定结局，境界决定人生",
      "content_html": "<h1 id=\"人生三境界-格局决定结局-境界决定人生\" tabindex=\"-1\"> 人生三境界，格局决定结局，境界决定人生</h1>\n<p>人生能够成就什么与自身的境界密切相关，人生格局决定人生结局，人生有什么样的境界就有什么样的格局。从古到今，成就大事业，大学问的人，都是经过这三种境界的人。</p>\n<p>人生的第一境界是：<strong>昨夜西风凋碧树，独上高楼，望尽天涯路</strong>。这一境界就是人生要立志、要下决心、做人要自强、自立、自信、自奋，人生有了目标，才能有前进的方向，成功者总是从立志开始的，做人没有志向，哪来的成功呢？</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/c8ea15ce36d3d539ad9b54e1d0bf0e58352ab02b.jpeg\" alt=\"img\"></p>\n<p>人生的第二境界是：**衣带渐宽终不悔，为伊消得人憔悴。**人生有了理想、有了目标，就需要靠脚踏实地的奋斗来实现，奋斗需要勤奋和刻苦，奋斗需要顽强拼搏，在奋斗的路上不管是苦、是累都无怨无悔，即使是人瘦了，也在所不辞，一个人有了如此执着的精神，便会痴迷于人生的事业和兴趣，成为一个不懈努力的追梦者。</p>\n<p>人生的第三境界是：**众时寻他千百度，蓦然回首，那人却在灯火阑珊处。**一个人的成功总不会是一帆风顺的，要成功就需要努力付出，有汗水才会有收获，有付出才会有回报，梅花香自苦寒来，功到自然成，人生只有经过奋斗和拼搏，经过磨砺才能绽放人生美丽的异彩！</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/58ee3d6d55fbb2fb4bc601d49472c7ac4423dccc.jpeg\" alt=\"img\"></p>\n<p>做人是需要境界的，人有了境界才能站得高，看得远，如此，才能有美好的人生。人生的三个境界分为四个层次，也就是欲求境界、求知境界、道德境界、审美境界，做人有了境界之分，便有了有德之人，无德之人；有了低级趣味的人，也有高级趣味的人。</p>\n<p>做人不能做无德之人，做低级趣味的人，人大多都是凡人和普通的人，即使是凡人和普通的人也要有自己的境界和追求，这就是做一个平凡而不平庸的人。做人要做有德之人，做有健康趣味的人，只有如此 ，人生之路才走得远，像吴亦凡混得如此有名、如此有钱，但他却是无德的人，是一个低级趣味的人，最终他摔得很惨。这就是见证，做人一定要有格局，要有品味，要有追求，要有精神境界，不然，人生就走不远，也飞不高。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/9d82d158ccbf6c8113a64f776606563d32fa4059.jpeg\" alt=\"img\"></p>\n<p>人是高级动物，有思想、有灵魂、有智慧，人的高级决定了人必须有精神追求，不能沉迷于物质享受之中。商品经济时代，做人更要经得住各种物欲的诱惑和考验，要受得住寂寞，耐得住宁静，如此才能坚定自己的人生理想，不忘初心，永远前行，做最好的自己。</p>\n<p>人的境界靠的自律精神，一个人不自律便会猪狗不如，有境界的人是靠自律约束出来的，自律就是人生的最高境界，人不自律便会放纵，人一旦放纵了便会自毁人生。做人一定要能够克制自己的言行，约束自己的行为。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/279759ee3d6d55fba7ea1c63b71aa84220a4dd0c.jpeg\" alt=\"img\"></p>\n<p>孔子曰：<strong>君子有三戒：少之时，血气未定，戒之在色；及其壮也，血气方刚，戒之在斗；及其老也，血气既衰，戒之在得</strong>。孔子是智慧的人，更是自律的人，做人自律就是戒，也就是做人生的减法，约束自己的行为，管住自己的嘴，管住自己的手，如此，做人的境界才能高，格局才能大，路才行得远。</p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/c8ea15ce36d3d539ad9b54e1d0bf0e58352ab02b.jpeg",
      "date_published": "2022-03-20T00:00:00.000Z",
      "date_modified": "2022-06-09T09:00:12.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "essay"
      ]
    },
    {
      "title": "人生最好的三种状态",
      "url": "https://blog.ciberviler.top/essay/%E4%BA%BA%E7%94%9F%E6%9C%80%E5%A5%BD%E7%9A%84%E4%B8%89%E7%A7%8D%E7%8A%B6%E6%80%81.html",
      "id": "https://blog.ciberviler.top/essay/%E4%BA%BA%E7%94%9F%E6%9C%80%E5%A5%BD%E7%9A%84%E4%B8%89%E7%A7%8D%E7%8A%B6%E6%80%81.html",
      "summary": "人生最好的三种状态",
      "content_html": "<h1 id=\"人生最好的三种状态-不期而遇-不言而喻-不药而愈\" tabindex=\"-1\"> 人生最好的三种状态：不期而遇，不言而喻，不药而愈</h1>\n<p>人这一辈子，不过短短数十载，来去匆匆。</p>\n<p>很多人终其一生，都在追寻一种最好的状态。</p>\n<p>可究竟怎样的状态，才算得上最好的状态呢？</p>\n<p><strong>其实，人生最好的状态，就藏在这三句话里。</strong></p>\n<p><img src=\"https://nimg.ws.126.net/?url=http://dingyue.ws.126.net/2020/1227/adc9a8f1p00qlygon000td200u0007gg00hz004g.png&amp;thumbnail=660x2147483647&amp;quality=80&amp;type=jpg\" alt=\"img\"></p>\n<p>释家说缘起缘灭，很多人深以为然。我们一生大约会与200万人擦肩而过，与认识大概20万人。佛说每一次的擦肩而过都是前世的一次回眸，那与你命中注定的那人，衣服都会擦烂了吧。爱情不是用来找的，而是等的。很多人去寻找爱情，会找到，但是过程很艰辛。而那种不期而遇的爱情，遇见了就是一辈子。也许就在某天清晨，你推开窗子，楼下正走着的一位女子刚好抬头向上望来，你们四目相对，缘分就自然来了。</p>\n<p><strong>命中注定的人，即使隔着万水千山，也总会有一天，在某个地点再次重逢。</strong></p>\n<p>曾看过一段话：“人生，总会有不期而遇的温暖，和生生不息的希望。”</p>\n<p>所以，哪怕四季更迭，春去春回，我们也总会在某一个轮回中，遇见那个命中注定的人。</p>\n<p>然后，怀抱希望，温暖一生。</p>\n<p><img src=\"https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2020%2F1227%2F84d63d90p00qlygon000vd200u0007gg00hz004g.png&amp;thumbnail=660x2147483647&amp;quality=80&amp;type=jpg\" alt=\"img\"></p>\n<p>真正好的爱情，就是“不费力”。不需要可以讨好、努力经营，两个人已是顺其自然的舒服。如果一段情、一个人，得让你耗费巨大精力来取悦，这已注定不是陪你到最后的缘分了。最爱你的人，不会舍得你如此辛苦。两个人即使是不说话，也不会觉得尴尬，很多事情都是不言而喻的，仅仅一个眼神、一个表情就能明白对方心中所想，这才是爱情真正的模样。</p>\n<p>人这一生，大多数人只是你生命中的过客，匆匆而过，不留下任何痕迹，只有少数人能真正走进你的世界。</p>\n<p>在茫茫人海中，若能遇到一个懂你心意，知你悲欢的知心人，便是万两黄金也不换。</p>\n<p><strong>在这个人面前，只要你一个眼神，对方就能读懂你的心意；一个动作，对方就能明白你的所需。</strong></p>\n<p>不用解释什么，也不用刻意伪装什么。</p>\n<p>只有真正懂你的人，才能达到这种心灵上的契合，精神上的同频。</p>\n<p>很多事情，在你们之间早就不言而喻。</p>\n<p><strong>心若近了，一切便不会远。懂，比什么都重要。</strong></p>\n<p><img src=\"https://nimg.ws.126.net/?url=http%3A%2F%2Fdingyue.ws.126.net%2F2020%2F1227%2F5dadd129p00qlygoo0010d200u0007gg00hz004g.png&amp;thumbnail=660x2147483647&amp;quality=80&amp;type=jpg\" alt=\"img\"></p>\n<p>成年人的字典里没有“容易”两个人，我们会经历种种困难，恋人离去，工作不顺，家人生病。任何一件事都让我们想要逃离，不想长大。可是慢慢地，我们再次面对这些困难时，我们能从容面对。一切磨难，你不需要药来治愈，就是人生的最好状态。</p>\n<p><strong>成长的路上，我们都会遇到各种各样的难关，都是一路奔跑，一路跌倒；一路得到，又一路失去。</strong></p>\n<p>或许很多人，都曾在人群中，假装开心，笑容满面。却在四下无人时，撕下自己看似坚强的外表，露出最真实的脆弱，掩面哭泣。</p>\n<p>在这悲喜交错的人生中，没有人是你的万能解药。</p>\n<p>哪怕是时间，也不可能成为你最好的解药。</p>\n<p>就像季羡林在书中传达给我们的信念：所有的悲欢离合，他人难悟，悲喜自渡。</p>\n<p>所以，你要学会独自去面对那些人生难题，找到属于自己的答案。</p>\n<p><strong>你要做到，即使没有解药，也能够自我治愈。</strong></p>\n",
      "image": "https://nimg.ws.126.net/?url=http://dingyue.ws.126.net/2020/1227/adc9a8f1p00qlygon000td200u0007gg00hz004g.png&thumbnail=660x2147483647&quality=80&type=jpg",
      "date_published": "2022-04-21T00:00:00.000Z",
      "date_modified": "2022-06-09T09:00:12.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "essay"
      ]
    },
    {
      "title": "以你之名，书我一生",
      "url": "https://blog.ciberviler.top/essay/%E4%BB%A5%E4%BD%A0%E4%B9%8B%E5%90%8D%EF%BC%8C%E4%B9%A6%E6%88%91%E4%B8%80%E7%94%9F.html",
      "id": "https://blog.ciberviler.top/essay/%E4%BB%A5%E4%BD%A0%E4%B9%8B%E5%90%8D%EF%BC%8C%E4%B9%A6%E6%88%91%E4%B8%80%E7%94%9F.html",
      "content_html": "<h1 id=\"以你之名-书我一生\" tabindex=\"-1\"> 以你之名，书我一生</h1>\n<p><strong>“未曾相逢先一笑，初会便已许平生。”</strong></p>\n<p><strong>我本是一颗暗淡无光的星，坐落于银色海洋之上，直到听见了另外一个星系的回声，于是便努力的将我这颗星球为你亮起。</strong></p>\n<p><strong>我们没必要去花心思设想未来如何应对，而应该武装自己，只为了当有一天遇见的时候，能够理直气壮地说:我知道你很好，但是我也不差。</strong></p>\n<p><strong>多希望彼此是一直喜欢，一直热爱，这样我就能恒久地执着地望向你。</strong></p>\n<p><strong>后来我才知道，她并不是为我盛开的花，我只是恰好途径了她的盛放。</strong></p>\n<p><strong>浮世三千吾爱有三，日、月与卿，日为朝月为暮，卿为朝朝暮暮。</strong></p>\n<p><strong>以你之名，书我一生。酸甜苦辣，与你共享;三餐四季，与你共度。</strong></p>\n",
      "date_published": "2022-06-16T00:00:00.000Z",
      "date_modified": "2022-06-09T09:00:12.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "essay"
      ]
    },
    {
      "title": "早安心语220519",
      "url": "https://blog.ciberviler.top/essay/%E6%97%A9%E5%AE%89%E5%BF%83%E8%AF%AD220519.html",
      "id": "https://blog.ciberviler.top/essay/%E6%97%A9%E5%AE%89%E5%BF%83%E8%AF%AD220519.html",
      "summary": "早安心语220519",
      "content_html": "<h1 id=\"早安心语220519\" tabindex=\"-1\"> 早安心语220519</h1>\n<blockquote>\n<p>2022年5月19日</p>\n<p>如果有一天公司给你调岗降薪，逼你辞职。说明他已经不是曾经的的那个他了。——By 我自己</p>\n</blockquote>\n<p>1.马云说过：“傻傻的信，傻傻的干，傻傻的挣了数百万!精明的算，精明的看，最后成了穷光蛋!”水不动就是死水，人不动就是废人。人要有六动：关系靠走动，团队靠活动，客户靠感动，资金靠流动，生命靠运动，成功靠行动!好励志的一段话，送给所有正在奋斗的人!早安!!</p>\n<p><img src=\"http://img.mp.sohu.com/upload/20170531/ffd141fb79a44a75a2bc4e8dbdb7cd98_th.png\" alt=\"img\"></p>\n<p>2.前行的路，不怕万人阻挡，只怕自己投降;人生的帆，不怕狂风巨浪，只怕自己没胆量!有路，就大胆去走;有梦，就大胆飞翔。大胆，才应该是我们的信仰，梦想，永远只会是梦里空想，要知道，逆风的方向，更适合飞翔;才是人生奋斗的方向!早安[太阳][太阳][太阳]</p>\n<p><img src=\"http://img.mp.sohu.com/upload/20170531/b4ad3110984c4562895e36a1bfbf9bf4_th.png\" alt=\"img\"></p>\n<p>3.每个人的际遇不同，成功总有早晚，但肯定离不开两样东西，一是努力，二就是格局。不要总羡慕别人走运，嫉妒别人成功。平时不努力，就算运气来了，你没迎接它的到来也是擦肩而过。</p>\n<p><img src=\"http://img.mp.sohu.com/upload/20170531/e98a21bc3483488991655a9b89fba3cd_th.png\" alt=\"img\"></p>\n<p>4.内心强大比什么都重要 你要照顾好自己;承认自己的平凡，但是努力向好的方向发展;可以平静面对生活，安然的听从自己内心的感受，不受其他影响，你可以迷茫，请不要虚度。早安![拥抱][拥抱]</p>\n<p><img src=\"http://img.mp.sohu.com/upload/20170531/2237eda2c3454edb9fa660ac0cd177a5_th.png\" alt=\"img\"></p>\n<p>5.给自己一点掌声。在漫漫人生旅途中,总会有寂寞、失落、沮丧的时候,这时给自己一点掌声,让自己战胜怯懦,使无畏的心更加的坚强,更是温暖自己独自前行的路。当自己累了、倦了、快撑不下去了,给自己一点掌声,不只是对自己寂寞灵魂的一种填充,更是对风雨人生的一种从容。相信自己,肯定自己,做自己。早安![太阳][太阳]</p>\n<p><img src=\"http://img.mp.sohu.com/upload/20170531/414d97812cd848dba9f60102f0a6ec64_th.png\" alt=\"img\"></p>\n<p>6.命，是失败者的借口;运，是成功者的谦词。失败者说命不好，心里后悔当初没尽力;成功者说，是命好，心里却清楚付出的代价。命运，不是什么神秘的力量，而是自我的花开出的果。你如何选择，命运就如何发生。想要知道费了多少心，只需看树上挂了多少果实。人生，越努力，越幸运。早安![太阳][太阳]</p>\n<p><img src=\"http://img.mp.sohu.com/upload/20170531/2981e2a7303f43d5b089d914c618b2eb_th.png\" alt=\"img\"></p>\n<p>7.当你又瘦又好看，钱包里都是自己努力赚来的钱的时候，你就会恍然大悟，哪有时间患得患失，哪有时间猜东猜西，哪有时间揣摩别人。早安![玫瑰][玫瑰]</p>\n<p><img src=\"http://img.mp.sohu.com/upload/20170531/f9328d620b894c64aca03c6593458ac5_th.png\" alt=\"img\"></p>\n<p>8.人生最可悲的事情，莫过于胸怀大志，却又虚度光阴。觉得自己不够聪明，但干事总爱拖延;觉得自己学历不漂亮，可又没利用业余继续充电;对自己不满意，但自我安慰今天好好玩明天再努力。既然知道路远，那就要早点上路。迎着太阳，出发!早安![太阳][太阳]</p>\n<p><img src=\"http://img.mp.sohu.com/upload/20170531/49e9577183644a82a04b2421ef4047a1_th.png\" alt=\"img\"></p>\n<p>9.人间没有不弯的路，世上没有不谢的花。通往成功的路不会平坦宽阔，实现自已的梦想不会一帆风顺，人生不如意十有八九，但这些都是暂时的。花开花落，潮起潮落，一切都会有终结的。生命是一场耐心的角逐赛，只要你能坚持下去，即便道路再崎岖难行，前途也是一片光明;生命是一朵花，纵然会在寒冬凋谢，但只要你坚持下来，下一个春天必定会绽放得更加灿烂!早安!</p>\n<p><img src=\"http://img.mp.sohu.com/upload/20170531/e5e12be4674843768bbda9a96582b809_th.png\" alt=\"img\"></p>\n<p>10.不要让未来的你，讨厌现在的自己。我正在努力变成自己喜欢的那个自己。早安!</p>\n",
      "image": "http://img.mp.sohu.com/upload/20170531/ffd141fb79a44a75a2bc4e8dbdb7cd98_th.png",
      "date_published": "2022-05-16T00:00:00.000Z",
      "date_modified": "2022-06-09T09:00:12.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "essay"
      ]
    },
    {
      "title": "鲁迅名言",
      "url": "https://blog.ciberviler.top/essay/%E9%B2%81%E8%BF%85%E5%90%8D%E8%A8%80.html",
      "id": "https://blog.ciberviler.top/essay/%E9%B2%81%E8%BF%85%E5%90%8D%E8%A8%80.html",
      "content_html": "<h1 id=\"鲁迅名言\" tabindex=\"-1\"> 鲁迅名言</h1>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16545675217234.jpeg\" alt=\"图片\"></p>\n<p><strong>鲁迅</strong>（1881年9月25日－1936年10月19日），浙江绍兴人。著名文学家、思想家、民主战士，五四新文化运动的重要参与者，中国现代文学的奠基人。主要作品有：《呐喊》《彷徨》《朝花夕拾》《且介亭杂文》等。</p>\n<p><strong>1、冷漠</strong></p>\n<p>在中国，尤其是在都市里，倘使路上有暴病倒地，或翻车捽摔伤的人，路人围观或甚至高兴的人尽有，有肯伸手来扶助一下的人却是极少的。</p>\n<p>——《经验》一九三三年</p>\n<p><strong>2、自私自利</strong></p>\n<p>我的经验，是人来要我帮忙的，他用“互助论”；一到不用，或要攻击我了，就用“进化论的生存竞争论”；取去我的衣服，倘向他索还，他就说我是“个人主义”，自私自利，吝啬得很。</p>\n<p>——1935年致萧军、萧红的信</p>\n<p><strong>3、不尊重女性</strong></p>\n<p>我一向不相信昭君出塞会安汉，木兰从军就可以保隋；也不信妲己亡殷，西施沼吴，杨妃乱唐的那些古老话。我以为在男权社会里，女人是决不会有这种大力量的，兴亡的责任，都应该男的负。但向来的男性的作者，大抵将败亡的大罪，推在女性身上，这真是一钱不值的没有出息的男人。</p>\n<p>——《阿金》</p>\n<p><strong>4、民族主义</strong></p>\n<p>中国现在的假吉诃德们……他们何尝不知道“国货运动”振兴不了什么民族工业。</p>\n<p>他们何尝不知道什么“中国固有文化”咒不死帝国主义，无论念几千万遍“不仁不义”或者金光明咒，也不会引发日本地震，使它陆沉大海。然而他们故意高喊恢复“民族精神”，仿佛得了什么祖传秘诀。</p>\n<p>——《真假堂吉诃德》</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/image-20220607100616554.png\" alt=\"image-20220607100616554\"></p>\n<p><strong>5、欺软怕硬</strong></p>\n<p>可惜中国人但对于羊显凶兽相，而对于凶兽则显羊相，所以即使显凶兽相，也还是卑怯的国民。这样下去，一定要完结的。</p>\n<p>我想，要中国得救，也不必添甚么东西进去，只要青年们将这两种性质的古传用法，反过来一用就够了：对手如凶兽时就如凶兽，对手如羊时就如羊！</p>\n<p>——《忽然想到·七》</p>\n<p><strong>6、不知耻</strong></p>\n<p>战士死了的时候，苍蝇所首先发见的是他的缺点和伤痕，嘬，营营地叫，以为得意，以为比死了的战士更英雄。但是战士已经死了，不再来挥去他们。于是乎苍蝇们即更其营营地叫，自以为倒是不朽的声音，因为他们的完全，远在战士之上。的确的，谁也没有发见过苍蝇们的缺点和创伤。然而，有缺点的战士终竟是战士，完美的苍蝇也终竟不过是苍蝇。</p>\n<p>——《战士和苍蝇》</p>\n<p><strong>7、国粹主义</strong></p>\n<p>即使无名肿毒，倘若生在中国人身上，也便“红肿之处，艳若桃花；溃烂之时，美如奶酪。”国粹所在，妙不可言。</p>\n<p>——《随感录三十九》</p>\n<p><strong>8、世故</strong></p>\n<p>耳闻目睹的不算，单是看看报章，也就可以知道社会上有多少不平，人们有多少冤抑。</p>\n<p>但对于这些事，除了有时或有同业、同乡、同族的人们来说几句呼吁的话之外，利害无关的人的义愤的声音，我们是很少听到的。这很分明，是大家不开口；或者以为和自己不相干；或者连“以为和自己不相干”的意思也全没有。</p>\n<p>“世故”深到不自觉其“深于世故”，这才真是“深于世故”的了。这是中国处世法的精义中的精义。</p>\n<p>——《世故三昧》</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16545675217231.jpeg\" alt=\"图片\"></p>\n<p><strong>9、迂腐折中</strong></p>\n<p>中国人的性情是总喜欢调和折中的，譬如你说，这屋子太暗，须在这里开一个窗，大家一定不允许的。但如果你主张拆掉屋顶他们就来调和，愿意开窗了。</p>\n<p>——《无声的中国》</p>\n<p><strong>10、没出息</strong></p>\n<p>中国大约太老了，社会上事无大小，都恶劣不堪，像一只黑色的染缸，无论加进甚么新东西去，都变成漆黑。</p>\n<p>可是除了再想法子来改革之外，也再没有别的路。</p>\n<p>我看一切理想家，不是怀念“过去”，就是“希望将来”，而对于“现在”这一个题目，都缴了白卷，因为谁也开不出药方。</p>\n<p>所有最好的药方即所谓“希望将来”的就是。</p>\n<p>——《两地书》</p>\n<p><strong>11、漠然</strong></p>\n<p>凡有一人的主张，得了赞和，是促其前进的；得了反对，是促其奋斗的；独有叫喊于生人中，而生人并无反应，既非赞同，也无反对，如置身毫无边际的荒原，无可措手的了，这是怎样的悲哀呵……</p>\n<p>——《&lt;呐喊&gt;自序》</p>\n<p><strong>12、冷血</strong></p>\n<p>中国人自己诚然不善于战争，却并没有诅咒战争；自己诚然不愿出战，却并未同情于不愿出战的他人；虽然想到自己，却没有想到他人的自己。</p>\n<p>——《一个青年的梦译者序二》</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16545675217232.jpeg\" alt=\"图片\"></p>\n<p><strong>13、怯弱、懒惰、巧滑</strong></p>\n<p>中国人的不敢正视各方面，用瞒和骗，造出奇妙的逃路来，而自以为正路。在这路上，就证明着国民性的怯弱、懒惰而又巧滑。一天一天的满足，即一天一天的堕落，但却又觉得日见其光荣。</p>\n<p>在事实上，亡国一次，即添加几个殉难的忠臣，后来每不想光复旧物，而只去赞美那几个忠臣；遭劫一次，即造成一群不辱的烈女，事过之后，也每每不思惩凶、自卫，却只顾歌咏那一群烈女。</p>\n<p>——《论睁了眼看》</p>\n<p><strong>14、麻木者是胜利者</strong></p>\n<p>中国各处是壁，像“鬼打墙”一般，使你随时能“碰”。能打这墙的，能碰而不感到痛苦的，是胜利者。</p>\n<p>——《碰壁之后》</p>\n<p><strong>15、拒绝改变</strong></p>\n<p>我独不解中国人何以于旧状况那么心平气和，于较新的机运就这么疾首蹙额；于已成之局那么委曲求全，于初兴之事就这么求全责备？</p>\n<p>——《这个与那个》</p>\n<p><strong>16、多疑</strong></p>\n<p>中国人不疑自己的多疑。</p>\n<p>——《我要骗人》</p>\n<p><strong>17、看热闹</strong></p>\n<p>群众，尤其是中国的──永远是戏剧的看客。牺牲上场，如果显得慷慨，他们就看了悲壮剧；如果显得觳觫（即恐惧颤抖），他们就看了滑稽剧。北京的羊肉铺常有几个人张嘴看剥羊，仿佛颇为愉快，人的牺牲能给他们的益处，也不过如此。而况事后走不几步，他们并这一点也就忘了。</p>\n<p>——《娜拉走后怎样》</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16545675217233.jpeg\" alt=\"图片\"></p>\n<p><strong>18、懦弱</strong></p>\n<p>中国一向就少有失败的英雄，少有韧性的反抗，少有敢单身鏖战的武人，少有敢抚哭叛徒的吊客；见胜兆则纷纷聚集，见败兆则纷纷逃亡。</p>\n<p>——《这个和那个》</p>\n<p><strong>19、阴暗</strong></p>\n<p>我们中国人对于不是自己的东西，或者将不为自己所有的东西，总要破坏了才快活的。</p>\n<p>——《记谈话》</p>\n<p><strong>20、个人主义</strong></p>\n<p>从生活窘迫过来的人，一到了有钱，容易变成两种情形：一种是理想世界，替处同一境遇的人着想，便成为人道主义；一种是甚么都是自己挣起来，从前的遭遇，使他觉得甚么都是冷酷，便流为个人主义。我们中国大概是变成个人主义者多。</p>\n<p>——《文艺与政治的歧途》</p>\n<hr>\n<p><strong>01</strong></p>\n<p>愿中国青年都摆脱冷气，只是向上走，不必听自暴自弃者流的话。能做事的做事，能发声的发声。有一分热，发一分光。就令萤火一般，也可以在黑暗里发一点光，不必等候炬火。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16545677612981.jpeg\" alt=\"图片\"></p>\n<p><strong>02</strong></p>\n<p>沉着、勇猛，有辨别，不自私。</p>\n<p><strong>03</strong></p>\n<p>我们目下的当务之急是：一要生存，二要温饱，三要发展。</p>\n<p><strong>04</strong></p>\n<p>必须敢于正视，这才可望敢想、敢说、敢做、敢当。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16545677612982.jpeg\" alt=\"图片\"></p>\n<p><strong>05</strong></p>\n<p>事实是毫无情面的东西，它能将空言打得粉碎。</p>\n<p><strong>06</strong></p>\n<p>贪安稳就没有自由，要自由就要历些危险。只有这两条路。</p>\n<p><strong>07</strong></p>\n<p>假使做事要面面顾到，那就什么事都不能做了。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16545677612983.jpeg\" alt=\"图片\"></p>\n<p><strong>08</strong></p>\n<p>明言着轻蔑什么人，并不是十足的轻蔑。惟沉默是最高的轻蔑——最高的轻蔑是无言，而且连眼珠也不转过去。</p>\n<p><strong>9</strong></p>\n<p>宁可与敌人明打，不欲受同人暗算。</p>\n<p><strong>10</strong></p>\n<p>青年们先可以将中国变成一个有声的中国。大胆地说话，勇敢地进行，忘掉一切利害，推开了古人，将自己的真心的话发表出来。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16545677612984.jpeg\" alt=\"图片\"></p>\n<p><strong>11</strong></p>\n<p>时间，每天得到的都是二十四小时，可是一天的时间给勤勉的人带来智慧与力量，给懒散的人只能留下一片悔恨。</p>\n<p><strong>12</strong></p>\n<p>怀疑并不是缺点。总是疑，而并不下断语，这才是缺点。</p>\n<p><strong>13</strong></p>\n<p>做一件事，无论大小，倘无恒心，是很不好的。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16545677612985.jpeg\" alt=\"图片\"></p>\n<p><strong>14</strong></p>\n<p>我们和朋友在一起，可以脱掉衣服，但上阵要穿甲。</p>\n<p><strong>15</strong></p>\n<p>改造自己，总比禁止别人来的难。</p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16545675217234.jpeg",
      "date_published": "2022-06-20T00:00:00.000Z",
      "date_modified": "2022-06-09T09:00:12.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "essay"
      ]
    },
    {
      "title": "JSP和JSTL获取服务器参数",
      "url": "https://blog.ciberviler.top/dev/JSP%E5%92%8CJSTL%E8%8E%B7%E5%8F%96%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%82%E6%95%B0.html",
      "id": "https://blog.ciberviler.top/dev/JSP%E5%92%8CJSTL%E8%8E%B7%E5%8F%96%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%82%E6%95%B0.html",
      "summary": "JSP和JSTL获取服务器参数",
      "content_html": "<h1 id=\"jsp和jstl获取服务器参数\" tabindex=\"-1\"> JSP和JSTL获取服务器参数</h1>\n<div><pre><code>&lt;%@ page language=&quot;java&quot; import=&quot;java.util.*&quot; pageEncoding=&quot;UTF-8&quot;%&gt;\n\n&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;JSP和JSTL获取服务器参数&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\nJSP方式&lt;br/&gt;\n&lt;%\n\nString SERVER_NAME = request.getServerName();\n\nString SERVER_SOFTWARE = getServletContext().getServerInfo();\n\nString SERVER_PROTOCOL = request.getProtocol();\n\nInteger SERVER_PORT = request.getServerPort();\n\nString REQUEST_METHOD = request.getMethod();\n\nString PATH_INFO = request.getPathInfo();\n\nString PATH_TRANSLATED = request.getPathTranslated();\n\nString SCRIPT_NAME = request.getServletPath();\n\nString DOCUMENT_ROOT = request.getRealPath(&quot;/&quot;);\n\nString QUERY_STRING = request.getQueryString();\n\nString REMOTE_HOST = request.getRemoteHost();\n\nString REMOTE_ADDR = request.getRemoteAddr();\n\nString AUTH_TYPE = request.getAuthType();\n\nString REMOTE_USER = request.getRemoteUser();\n\nString CONTENT_TYPE = request.getContentType();\n\nInteger CONTENT_LENGTH = request.getContentLength();\n\nString HTTP_ACCEPT = request.getHeader(&quot;Accept&quot;);\n\nString HTTP_USER_AGENT = request.getHeader(&quot;User-Agent&quot;);\n\nString HTTP_REFERER = request.getHeader(&quot;Referer&quot;);\n\nHashMap infoMap = new HashMap();\n\ninfoMap.put(&quot;SERVER_NAME&quot;, SERVER_NAME);\n\ninfoMap.put(&quot;SERVER_SOFTWARE&quot;, SERVER_SOFTWARE);\n\ninfoMap.put(&quot;SERVER_PROTOCOL&quot;, SERVER_PROTOCOL);\n\ninfoMap.put(&quot;SERVER_PORT&quot;, SERVER_PORT);\ninfoMap.put(&quot;REQUEST_METHOD&quot;, REQUEST_METHOD);\n\ninfoMap.put(&quot;PATH_INFO&quot;, PATH_INFO);\n\ninfoMap.put(&quot;PATH_TRANSLATED&quot;, PATH_TRANSLATED);\n\ninfoMap.put(&quot;SCRIPT_NAME&quot;, SCRIPT_NAME);\n\ninfoMap.put(&quot;DOCUMENT_ROOT&quot;, DOCUMENT_ROOT);\n\ninfoMap.put(&quot;QUERY_STRING&quot;, QUERY_STRING);\n\ninfoMap.put(&quot;REMOTE_HOST&quot;, REMOTE_HOST);\n\ninfoMap.put(&quot;REMOTE_ADDR&quot;, REMOTE_ADDR);\n\ninfoMap.put(&quot;AUTH_TYPE&quot;, AUTH_TYPE);\n\ninfoMap.put(&quot;REMOTE_USER&quot;, REMOTE_USER);\n\ninfoMap.put(&quot;CONTENT_TYPE&quot;, CONTENT_TYPE);\n\ninfoMap.put(&quot;CONTENT_LENGTH&quot;, CONTENT_LENGTH);\n\ninfoMap.put(&quot;HTTP_ACCEPT&quot;, HTTP_ACCEPT);\n\ninfoMap.put(&quot;HTTP_USER_AGENT&quot;, HTTP_USER_AGENT);\n\ninfoMap.put(&quot;HTTP_REFERER&quot;, HTTP_REFERER);\n\nIterator it = infoMap.keySet().iterator();\n\n%&gt;\n\n&lt;%\nwhile (it.hasNext()) {\nObject o = it.next();\n%&gt;\n　　&lt;%=o%&gt;\n　　&lt;%=infoMap.get(o)%&gt;\n　　&lt;% out.println(&quot;&lt;br&gt;&quot;); }%&gt;\n&lt;br/&gt;\n\nJSTL方式&lt;br/&gt;\n${pageContext.request} |取得请求对象&lt;br&gt;\n${pageContext.session} |取得session对象&lt;br&gt;\n${pageContext.request.queryString} |取得请求的参数字符串&lt;br&gt;\n${pageContext.request.requestURL} |取得请求的URL，但不包括请求之参数字符串&lt;br&gt;\n${pageContext.request.contextPath} |服务的web application的名称&lt;br&gt;\n${pageContext.request.method} |取得HTTP的方法(GET、POST)&lt;br&gt;\n${pageContext.request.protocol} |取得使用的协议(HTTP/1.1、HTTP/1.0)&lt;br&gt;\n${pageContext.request.remoteUser} |取得用户名称&lt;br&gt;\n${pageContext.session.new} |判断session是否为新的，所谓新的session，表示刚由server产生而client尚未使用&lt;br&gt;\n${pageContext.session.id} |取得session的ID&lt;br&gt;\n\n${header[&quot;User-Agent&quot;]}|用户浏览器的版本&lt;br/&gt;\n${header[&quot;Host&quot;]}|IP&lt;br/&gt;\n${pageContext.request.remoteAddr } |取得用户的IP地址&lt;br&gt;\n${pageContext.servletContext.serverInfo}|取得主机端的服务信息&lt;br&gt;\n${pageContext.request.serverPort}|端口信息&lt;br&gt;\n${pageContext.request.serverName}|服务器名称&lt;br&gt;\n${pageContext.request.remoteHost}|客户机名称&lt;br&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "date_published": "2022-06-22T00:00:00.000Z",
      "date_modified": "2022-06-09T03:50:24.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "检测网络联通性&generate_204服务汇总",
      "url": "https://blog.ciberviler.top/other/generate_204%E6%9C%8D%E5%8A%A1%E6%B1%87%E6%80%BB.html",
      "id": "https://blog.ciberviler.top/other/generate_204%E6%9C%8D%E5%8A%A1%E6%B1%87%E6%80%BB.html",
      "summary": "检测网络联通性&generate_204服务汇总",
      "content_html": "<h1 id=\"检测网络联通性-generate-204服务汇总\" tabindex=\"-1\"> 检测网络联通性&amp;generate_204服务汇总</h1>\n<p><a href=\"http://www.gstatic.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.gstatic.com/generate_204</a></p>\n<p><a href=\"http://connect.rom.miui.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://connect.rom.miui.com/generate_204</a></p>\n<p><a href=\"http://www.google.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.google.com/generate_204</a></p>\n<p><a href=\"http://cp.cloudflare.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://cp.cloudflare.com/generate_204</a></p>\n<p><a href=\"http://www.qualcomm.cn/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.qualcomm.cn/generate_204</a></p>\n<p>Google： <a href=\"http://www.gstatic.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.gstatic.com/generate_204</a></p>\n<p><a href=\"http://maps.google.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://maps.google.com/generate_204</a></p>\n<p><a href=\"http://mt0.google.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://mt0.google.com/generate_204</a></p>\n<p><a href=\"http://mt1.google.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://mt1.google.com/generate_204</a></p>\n<p><a href=\"http://mt2.google.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://mt2.google.com/generate_204</a></p>\n<p><a href=\"http://mt3.google.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://mt3.google.com/generate_204</a></p>\n<p><a href=\"http://clients3.google.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://clients3.google.com/generate_204</a></p>\n<p>V2ex： <a href=\"https://www.v2ex.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.v2ex.com/generate_204</a></p>\n<p>（不建议使用，因为只支持 https，不支持 http，连接相对耗费资源，对于 wifi 需要跳转认证的情况支持页不好）</p>\n<p>小米： <a href=\"http://connect.rom.miui.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://connect.rom.miui.com/generate_204</a></p>\n<p>华为： <a href=\"http://connectivitycheck.platform.hicloud.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://connectivitycheck.platform.hicloud.com/generate_204</a></p>\n<p>Vivo： <a href=\"http://wifi.vivo.com.cn/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://wifi.vivo.com.cn/generate_204</a></p>\n<table>\n<thead>\n<tr>\n<th>服务提供者</th>\n<th>链接</th>\n<th>大陆体验</th>\n<th>境外体验</th>\n<th>http/https</th>\n<th>IP Version</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Google</td>\n<td><a href=\"http://www.gstatic.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.gstatic.com/generate_204</a></td>\n<td>5</td>\n<td>10</td>\n<td>204⁄204</td>\n<td>4+6</td>\n</tr>\n<tr>\n<td>Google</td>\n<td><a href=\"http://www.google-analytics.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.google-analytics.com/generate_204</a></td>\n<td>6</td>\n<td>10</td>\n<td>204⁄204</td>\n<td>4+6</td>\n</tr>\n<tr>\n<td>Google</td>\n<td><a href=\"http://www.google.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.google.com/generate_204</a></td>\n<td>0</td>\n<td>10</td>\n<td>204⁄204</td>\n<td>4+6</td>\n</tr>\n<tr>\n<td>Google</td>\n<td><a href=\"http://connectivitycheck.gstatic.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://connectivitycheck.gstatic.com/generate_204</a></td>\n<td>4</td>\n<td>10</td>\n<td>204⁄204</td>\n<td>4+6</td>\n</tr>\n<tr>\n<td>Apple</td>\n<td><a href=\"http://captive.apple.com/\" target=\"_blank\" rel=\"noopener noreferrer\">http://captive.apple.com</a></td>\n<td>3</td>\n<td>10</td>\n<td>200⁄200</td>\n<td>4+6</td>\n</tr>\n<tr>\n<td>Apple</td>\n<td><a href=\"http://www.apple.com/library/test/success.html\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.apple.com/library/test/success.html</a></td>\n<td>7</td>\n<td>10</td>\n<td>200⁄200</td>\n<td>4+6</td>\n</tr>\n<tr>\n<td>MicroSoft</td>\n<td><a href=\"http://www.msftconnecttest.com/connecttest.txt\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.msftconnecttest.com/connecttest.txt</a></td>\n<td>5</td>\n<td>10</td>\n<td>200/error</td>\n<td>4</td>\n</tr>\n<tr>\n<td>Cloudflare</td>\n<td><a href=\"http://cp.cloudflare.com/\" target=\"_blank\" rel=\"noopener noreferrer\">http://cp.cloudflare.com/</a></td>\n<td>4</td>\n<td>10</td>\n<td>204⁄204</td>\n<td>4+6</td>\n</tr>\n<tr>\n<td>Firefox</td>\n<td><a href=\"http://detectportal.firefox.com/success.txt\" target=\"_blank\" rel=\"noopener noreferrer\">http://detectportal.firefox.com/success.txt</a></td>\n<td>5</td>\n<td>10</td>\n<td>200⁄200</td>\n<td>4+6</td>\n</tr>\n<tr>\n<td>V2ex</td>\n<td><a href=\"http://www.v2ex.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.v2ex.com/generate_204</a></td>\n<td>0</td>\n<td>10</td>\n<td>204⁄301</td>\n<td>4+6</td>\n</tr>\n<tr>\n<td>小米</td>\n<td><a href=\"http://connect.rom.miui.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://connect.rom.miui.com/generate_204</a></td>\n<td>10</td>\n<td>4</td>\n<td>204⁄204</td>\n<td>4</td>\n</tr>\n<tr>\n<td>华为</td>\n<td><a href=\"http://connectivitycheck.platform.hicloud.com/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://connectivitycheck.platform.hicloud.com/generate_204</a></td>\n<td>10</td>\n<td>5</td>\n<td>204⁄204</td>\n<td>4</td>\n</tr>\n<tr>\n<td>Vivo</td>\n<td><a href=\"http://wifi.vivo.com.cn/generate_204\" target=\"_blank\" rel=\"noopener noreferrer\">http://wifi.vivo.com.cn/generate_204</a></td>\n<td>10</td>\n<td>5</td>\n<td>204⁄204</td>\n<td>4</td>\n</tr>\n</tbody>\n</table>\n<p>以上<strong>大陆</strong>指中国大陆，<strong>境外</strong>指非中国大陆。</p>\n<p><strong>体验</strong>目前仅进行粗略测试延迟，大概率实际不符，仅作参考。</p>\n<p><strong>http/https</strong>一列表示使用指定协议进行请求，返回的状态码。部分场合对状态码要求较严格。</p>\n",
      "date_published": "2022-04-02T00:00:00.000Z",
      "date_modified": "2022-06-09T03:49:58.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "Thanox 墓碑情景模式",
      "url": "https://blog.ciberviler.top/daily/Thanox%E5%A2%93%E7%A2%91%E6%83%85%E6%99%AF%E6%A8%A1%E5%BC%8F.html",
      "id": "https://blog.ciberviler.top/daily/Thanox%E5%A2%93%E7%A2%91%E6%83%85%E6%99%AF%E6%A8%A1%E5%BC%8F.html",
      "summary": "Thanox 墓碑情景模式",
      "content_html": "<h1 id=\"thanox墓碑情景模式\" tabindex=\"-1\"> Thanox墓碑情景模式</h1>\n<h2 id=\"最终合并2022-06-06\" tabindex=\"-1\"> 最终合并2022.06.06</h2>\n<p>分为两个版本，普通版和音频焦点版，根据自己需求选一个</p>\n<p>搭配<a href=\"https://github.com/myflavor/NoANR/releases/\" target=\"_blank\" rel=\"noopener noreferrer\">NoANR(点击下载)</a></p>\n<p><a href=\"https://coolstars.lanzoum.com/in97305v6ewj\" target=\"_blank\" rel=\"noopener noreferrer\">Thanox3.9.9(点击下载)</a>\n<a href=\"https://github.com/Tornaco/Thanox/releases\" target=\"_blank\" rel=\"noopener noreferrer\">github</a></p>\n<p><a href=\"https://xlc.lanzouh.com/ixU2G062x56d\" target=\"_blank\" rel=\"noopener noreferrer\">Thanox3.9.9row</a></p>\n<h3 id=\"普通版\" tabindex=\"-1\"> 普通版</h3>\n<div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"NoActive\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\"普通版-应用进入后台冻结进程\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>-1</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span> <span>[</span>\n            <span>\"if(thanos.getActivityManager().isPkgSmartStandByEnabled(to)){su.exe(\\\"kill -CONT `pgrep -f \\\"+ to + \\\"`\\\");su.exe(\\\"appops set \\\" +to + \\\" WAKE_LOCK default\\\")}\"</span><span>,</span>\n            <span>\"if(!thanos.getActivityManager().isPkgSmartStandByEnabled(from)){break}\"</span><span>,</span>\n            <span>\"foreach (rule : thanos.getActivityManager().getAllStandbyRules()){if(rule.startsWith(\\\"KEEP\\\") &amp;&amp; rule.contains(from + \\\"/\\\")){break}}\"</span><span>,</span>\n            <span>\"su.exe(\\\"appops set \\\" + from + \\\" WAKE_LOCK ignore\\\");\"</span><span>,</span>\n            <span>\"Thread.sleep(2000);\"</span><span>,</span>\n            <span>\"if(activity.getFrontAppPackage()!=from &amp;&amp; !thanos.windowManager.hasVisibleWindows(from)){su.exe(\\\"kill -STOP `pgrep -f \\\"+ from +\\\"`\\\")};\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"音频焦点版\" tabindex=\"-1\"> 音频焦点版</h3>\n<div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"NoActive\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\" 音频焦点版-应用进入后台冻结进程\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>-1</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span> <span>[</span>\n            <span>\"if(thanos.getActivityManager().isPkgSmartStandByEnabled(to)){su.exe(\\\"kill -CONT `pgrep -f \\\"+ to + \\\"`\\\");su.exe(\\\"appops set \\\" +to + \\\" WAKE_LOCK default\\\")}\"</span><span>,</span>\n            <span>\"if(!thanos.getActivityManager().isPkgSmartStandByEnabled(from)){break}\"</span><span>,</span>\n            <span>\"foreach (rule : thanos.getActivityManager().getAllStandbyRules()){if(rule.startsWith(\\\"KEEP\\\") &amp;&amp; rule.contains(from + \\\"/\\\")){break}}\"</span><span>,</span>\n            <span>\"if(su.exe(\\\"dumpsys audio|grep client:|grep -v died|cut -d ' ' -f 6\\\").out.contains(from)){break}\"</span><span>,</span>\n            <span>\"su.exe(\\\"appops set \\\" + from + \\\" WAKE_LOCK ignore\\\");\"</span><span>,</span>\n            <span>\"Thread.sleep(2000);\"</span><span>,</span>\n            <span>\"if(activity.getFrontAppPackage()!=from &amp;&amp; !thanos.windowManager.hasVisibleWindows(from)){su.exe(\\\"kill -STOP `pgrep -f \\\"+ from +\\\"`\\\")};\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"NoActive(Plus)\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\" 音频焦点版-应用通知移除冻结进程\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>1</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"notificationRemoved &amp;&amp; thanos.getActivityManager().isPkgSmartStandByEnabled(pkgName)\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span> <span>[</span>\n            <span>\"foreach (rule : thanos.getActivityManager().getAllStandbyRules()){if(rule.startsWith(\\\"KEEP\\\") &amp;&amp; rule.contains(pkgName + \\\"/\\\")){break}}\"</span><span>,</span>\n            <span>\"su.exe(\\\"appops set \\\" + pkgName + \\\" WAKE_LOCK ignore\\\");\"</span><span>,</span>\n            <span>\"if(activity.getFrontAppPackage()!=from &amp;&amp; !thanos.windowManager.hasVisibleWindows(pkgName)){su.exe(\\\"kill -STOP `pgrep -f \\\"+ pkgName +\\\"`\\\")};\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_2022-06-05更新\" tabindex=\"-1\"> 2022.06.05更新</h2>\n<p>不再使用whiteApps全局变量，使用乖巧规则，即乖巧KEEP规则就是白名单</p>\n<h3 id=\"解冻-通用\" tabindex=\"-1\"> 解冻(通用)</h3>\n<div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"解冻进程(通用)\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\"当应用进入前台时解冻进程\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>1</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged &amp;&amp; thanos.getActivityManager().isPkgSmartStandByEnabled(to)\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span> <span>[</span>\n            <span>\"su.exe(\\\"kill -CONT `pgrep -f \\\"+ to + \\\"`\\\");\"</span><span>,</span>\n            <span>\"su.exe(\\\"appops set \\\" +to + \\\" WAKE_LOCK default\\\");\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>冻结有两个版本，一个普通版，一个跳过音频焦点版（获得音频焦点的应用不会被冻结，大部分音乐播放器在播放的时候都会获取音频焦点，暂停时取消焦点，部分流氓APP暂停不会取消音频焦点，由于是从shell取的值，可能部分机子会有问题？）\n全局变量whiteApps可添加白名单APP跳过墓碑仅乖巧</p>\n<h3 id=\"普通版-1\" tabindex=\"-1\"> 普通版</h3>\n<div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"冻结进程(AppOps)\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\"普通版-当应用进入后台时设置AppOps\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>1</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged &amp;&amp; thanos.getActivityManager().isPkgSmartStandByEnabled(from)\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span> <span>[</span>\n            <span>\"foreach (rule : thanos.getActivityManager().getAllStandbyRules()){if(rule.startsWith(\\\"KEEP\\\") &amp;&amp; rule.contains(from + \\\"/\\\")){break}}\"</span><span>,</span>\n            <span>\"su.exe(\\\"appops set \\\" + from + \\\" WAKE_LOCK ignore\\\");\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"冻结进程\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\"普通版-当应用进入后台时冻结进程\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n        <span>\"delay\"</span><span>:</span> <span>2000</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged &amp;&amp; thanos.getActivityManager().isPkgSmartStandByEnabled(from)\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span> <span>[</span>\n            <span>\"foreach (rule : thanos.getActivityManager().getAllStandbyRules()){if(rule.startsWith(\\\"KEEP\\\") &amp;&amp; rule.contains(from + \\\"/\\\")){break}}\"</span><span>,</span>\n            <span>\"if(activity.getFrontAppPackage()!=from &amp;&amp; !thanos.windowManager.hasVisibleWindows(from)){su.exe(\\\"kill -STOP `pgrep -f \\\"+ from +\\\"`\\\")};\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"跳过音频焦点版\" tabindex=\"-1\"> 跳过音频焦点版</h3>\n<p>（推荐开启乖巧模式跳过通知的应用或者设置乖巧规则）</p>\n<div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"冻结进程(AppOps)\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\"跳过音频焦点版-当应用进入后台时设置AppOps\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>1</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged &amp;&amp; thanos.getActivityManager().isPkgSmartStandByEnabled(from)\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span> <span>[</span>\n            <span>\"foreach (rule : thanos.getActivityManager().getAllStandbyRules()){if(rule.startsWith(\\\"KEEP\\\") &amp;&amp; rule.contains(from + \\\"/\\\")){break}}\"</span><span>,</span>\n            <span>\"if(su.exe(\\\"dumpsys audio|grep client:|grep -v died|cut -d ' ' -f 6\\\").out.contains(from)){break}\"</span><span>,</span>\n            <span>\"su.exe(\\\"appops set \\\" + from + \\\" WAKE_LOCK ignore\\\");\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"冻结进程\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\"跳过音频焦点版-当应用进入后台时冻结进程\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n        <span>\"delay\"</span><span>:</span> <span>2000</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged &amp;&amp; thanos.getActivityManager().isPkgSmartStandByEnabled(from)\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span> <span>[</span>\n            <span>\"foreach (rule : thanos.getActivityManager().getAllStandbyRules()){if(rule.startsWith(\\\"KEEP\\\") &amp;&amp; rule.contains(from + \\\"/\\\")){break}}\"</span><span>,</span>\n            <span>\"if(su.exe(\\\"dumpsys audio|grep client:|grep -v died|cut -d ' ' -f 6\\\").out.contains(from)){break}\"</span><span>,</span>\n            <span>\"if(activity.getFrontAppPackage()!=from &amp;&amp; !thanos.windowManager.hasVisibleWindows(from)){su.exe(\\\"kill -STOP `pgrep -f \\\"+ from +\\\"`\\\")};\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"冻结进程(增强)\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\"跳过音频焦点版-当应用通知移除时冻结进程\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>1</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"notificationRemoved &amp;&amp; thanos.getActivityManager().isPkgSmartStandByEnabled(pkgName)\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span> <span>[</span>\n            <span>\"foreach (rule : thanos.getActivityManager().getAllStandbyRules()){if(rule.startsWith(\\\"KEEP\\\") &amp;&amp; rule.contains(pkgName + \\\"/\\\")){break}}\"</span><span>,</span>\n            <span>\"su.exe(\\\"appops set \\\" + pkgName + \\\" WAKE_LOCK ignore\\\");\"</span><span>,</span>\n            <span>\"if(activity.getFrontAppPackage()!=from &amp;&amp; !thanos.windowManager.hasVisibleWindows(pkgName)){su.exe(\\\"kill -STOP `pgrep -f \\\"+ pkgName +\\\"`\\\")};\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"合并\" tabindex=\"-1\"> 合并</h2>\n<h3 id=\"合并冻结\" tabindex=\"-1\"> 合并冻结</h3>\n<div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"冻结进程(合并)\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\"当应用进入后台时冻结进程\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>-1</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged &amp;&amp; thanos.getActivityManager().isPkgSmartStandByEnabled(from)\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span> <span>[</span>\n            <span>\"foreach (rule : thanos.getActivityManager().getAllStandbyRules()){if(rule.startsWith(\\\"KEEP\\\") &amp;&amp; rule.contains(from + \\\"/\\\")){break}}\"</span><span>,</span>\n            <span>\"su.exe(\\\"appops set \\\" + from + \\\" WAKE_LOCK ignore\\\");\"</span><span>,</span>\n            <span>\"Thread.sleep(2000);\"</span><span>,</span>\n            <span>\"if(activity.getFrontAppPackage()!=from &amp;&amp; !thanos.windowManager.hasVisibleWindows(from)){su.exe(\\\"kill -STOP `pgrep -f \\\"+ from +\\\"`\\\")};\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"合并解冻\" tabindex=\"-1\"> 合并解冻</h3>\n<div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"解冻进程(合并)\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\"当应用进入前台时解冻进程\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>1</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged &amp;&amp; thanos.getActivityManager().isPkgSmartStandByEnabled(to)\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span> <span>[</span>\n            <span>\"su.exe(\\\"kill -CONT `pgrep -f \\\"+ to + \\\"`\\\");\"</span><span>,</span>\n            <span>\"su.exe(\\\"appops set \\\" +to + \\\" WAKE_LOCK default\\\");\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"微信\" tabindex=\"-1\"> 微信</h2>\n<h3 id=\"微信保活\" tabindex=\"-1\"> 微信保活</h3>\n<div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"微信保活(包)\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\"微信被杀死时，启动微信进程\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>1</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"pkgKilled == true &amp;&amp; pkgName==\\\"com.tencent.mm\\\"\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span> <span>[</span>\n            <span>\"Thread.sleep(4000);\"</span><span>,</span>\n            <span>\"activity.launchProcessForPackage(\\\"com.tencent.mm\\\")\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"微信保活-自改\" tabindex=\"-1\"> 微信保活(自改)</h3>\n<div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"微信保活双服务(自改)\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\"微信被杀死时，启动微信进程\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>1</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"pkgKilled == true &amp;&amp; pkgName==\\\"com.tencent.mm\\\"\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span> <span>[</span>\n            <span>\"Thread.sleep(4000);\"</span><span>,</span>\n            <span>\"su.exe('am start-foreground-service com.tencent.mm/com.tencent.mm.booter.CoreService');\"</span><span>,</span>\n            <span>\"su.exe('am start-foreground-service com.tencent.mm/com.tencent.mm.service.ProcessService$MMProcessService');\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"微信保活3-自改\" tabindex=\"-1\"> 微信保活3(自改)</h3>\n<div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"微信保活多服务(自改)\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\"微信被杀死时，启动微信进程\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>1</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"pkgKilled == true &amp;&amp; pkgName==\\\"com.tencent.mm\\\"\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span> <span>[</span>\n            <span>\"Thread.sleep(4000);\"</span><span>,</span>\n            <span>\"su.exe('am start-foreground-service com.tencent.mm/com.tencent.mm.booter.CoreService');\"</span><span>,</span>\n            <span>\"Thread.sleep(200);\"</span><span>,</span>\n            <span>\"su.exe('am start-foreground-service com.tencent.mm/com.tencent.mm.service.ProcessService$MMProcessService');\"</span><span>,</span>\n            <span>\"Thread.sleep(200);\"</span><span>,</span>\n            <span>\"su.exe('am start-foreground-service com.tencent.mm/com.tencent.mm.ipcinvoker.wx_extension.service.MainProcessIPCService');\"</span><span>,</span>\n            <span>\"Thread.sleep(200);\"</span><span>,</span>\n            <span>\"su.exe('am start-foreground-service com.tencent.mm/com.tencent.mm.ipcinvoker.wx_extension.service.PushProcessIPCService');\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"微信进程优化\" tabindex=\"-1\"> 微信进程优化</h3>\n<div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"微信进程优化\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\"优化保留双进程\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; from == \\\"com.tencent.mm\\\"\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span> <span>[</span>\n            <span>\"Thread.sleep(8000);\"</span><span>,</span>\n            <span>\"su.exe(\\\"ps -ef|grep com.tencent.mm:|grep -v :push|grep -v grep|awk '{print $2}'|xargs kill -9\\\")\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"qq\" tabindex=\"-1\"> QQ</h2>\n<h3 id=\"qq保活\" tabindex=\"-1\"> QQ保活</h3>\n<div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"QQ保活\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\"QQ被杀死时，启动QQ进程\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>1</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"pkgKilled == true &amp;&amp; (pkgName == \\\"com.tencent.mobileqq\\\")\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span>\n        <span>[</span>\n            <span>\"Thread.sleep(4000);\"</span><span>,</span>\n            <span>\"su.exe('am start-foreground-service com.tencent.mobileqq/com.tencent.mobileqq.msf.service.MsfService');\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"qq保活2\" tabindex=\"-1\"> QQ保活2</h3>\n<div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"QQ保活(包)\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\"QQ被杀死时，启动QQ进程\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>1</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"pkgKilled == true &amp;&amp; pkgName==\\\"com.tencent.mobileqq\\\"\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span> <span>[</span>\n            <span>\"Thread.sleep(4000);\"</span><span>,</span>\n            <span>\"activity.launchProcessForPackage(\\\"com.tencent.mobileqq\\\")\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"qq保活3\" tabindex=\"-1\"> QQ保活3</h3>\n<div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"QQ保活多服务(自改)\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\"QQ被杀死时，启动QQ进程\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>1</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"pkgKilled == true &amp;&amp; (pkgName == \\\"com.tencent.mobileqq\\\")\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span>\n        <span>[</span>\n            <span>\"Thread.sleep(4000);\"</span><span>,</span>\n            <span>\"activity.launchProcessForPackage(\\\"com.tencent.mobileqq\\\")\"</span><span>,</span>\n            <span>\"Thread.sleep(400);\"</span><span>,</span>\n            <span>\"su.exe('am start-foreground-service com.tencent.mobileqq/com.tencent.mobileqq.msf.service.MsfService');\"</span><span>,</span>\n            <span>\"Thread.sleep(400);\"</span><span>,</span>\n            <span>\"su.exe('am start-foreground-service com.tencent.mobileqq/com.tencent.mobileqq.msf.service.MSFAliveJobService');\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"qq进程优化\" tabindex=\"-1\"> QQ进程优化</h3>\n<div><pre><code><span>[</span>\n    <span>{</span>\n        <span>\"name\"</span><span>:</span> <span>\"QQ进程优化\"</span><span>,</span>\n        <span>\"description\"</span><span>:</span> <span>\"优化保留双进程\"</span><span>,</span>\n        <span>\"priority\"</span><span>:</span> <span>2</span><span>,</span>\n        <span>\"condition\"</span><span>:</span> <span>\"frontPkgChanged == true &amp;&amp; from == \\\"com.tencent.mobileqq\\\"\"</span><span>,</span>\n        <span>\"actions\"</span><span>:</span> <span>[</span>\n        <span>\"Thread.sleep(5000);\"</span><span>,</span>\n        <span>\"su.exe(\\\"ps -ef|grep com.tencent.mobileqq:|grep -v :MSF|grep -v grep|awk '{print $2}'|xargs kill -9\\\")\"</span>\n        <span>]</span>\n    <span>}</span>\n<span>]</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "date_published": "2022-06-21T00:00:00.000Z",
      "date_modified": "2022-06-28T07:32:04.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "daily"
      ]
    },
    {
      "title": "通过Nginx来实现禁止国外IP访问网站",
      "url": "https://blog.ciberviler.top/dev/%E9%80%9A%E8%BF%87Nginx%E6%9D%A5%E5%AE%9E%E7%8E%B0%E7%A6%81%E6%AD%A2%E5%9B%BD%E5%A4%96IP%E8%AE%BF%E9%97%AE%E7%BD%91%E7%AB%99.html",
      "id": "https://blog.ciberviler.top/dev/%E9%80%9A%E8%BF%87Nginx%E6%9D%A5%E5%AE%9E%E7%8E%B0%E7%A6%81%E6%AD%A2%E5%9B%BD%E5%A4%96IP%E8%AE%BF%E9%97%AE%E7%BD%91%E7%AB%99.html",
      "content_html": "<h1 id=\"通过nginx来实现禁止国外ip访问网站\" tabindex=\"-1\"> 通过Nginx来实现禁止国外IP访问网站</h1>\n<p>前言： 先来说说为啥要写这篇文章，之前小编看了下nginx 的访问日志，发现每天有好多国外的IP地址来访问我的网站，并且访问的内容基本上都是恶意的。因此 我决定 禁止国外IP 来访问我的网站</p>\n<p>想要实现这个功能有很多方法，下面我就来介绍基于 NGINX的ngx_http_geoip2模块 来禁止国外IP 访问网站</p>\n<p><strong>一、安装geoip2扩展依赖</strong></p>\n<div><pre><code><span>[</span>root@fxkj ~<span>]</span><span># yum install libmaxminddb-devel -y</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p><strong>二、下载ngx_http_geoip2_module模块</strong></p>\n<div><pre><code><span>[</span>root@fxkj tmp<span>]</span><span>#  git clone https://github.com/leev/ngx_http_geoip2_module.git</span>\n<span>[</span>ro tmp<span>]</span><span># </span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p><strong>三、解压模块到指定路径</strong></p>\n<p>我这里解压到/usr/local 目录下</p>\n<div><pre><code><span>[</span>root@fxkj tmp<span>]</span><span># mv ngx_http_geoip2_module/ /usr/local/</span>\n<span>[</span>root@fxkj local<span>]</span><span># ll ngx_http_geoip2_module/</span>\ntotal <span>60</span>\n-rw-r--r-- <span>1</span> root root  <span>1199</span> Aug <span>13</span> <span>17</span>:20 config\n-rw-r--r-- <span>1</span> root root  <span>1311</span> Aug <span>13</span> <span>17</span>:20 LICENSE\n-rw-r--r-- <span>1</span> root root <span>23525</span> Aug <span>13</span> <span>17</span>:20 ngx_http_geoip2_module.c\n-rw-r--r-- <span>1</span> root root <span>21029</span> Aug <span>13</span> <span>17</span>:20 ngx_stream_geoip2_module.c\n-rw-r--r-- <span>1</span> root root  <span>3640</span> Aug <span>13</span> <span>17</span>:20 README.md\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>四、安装nginx 模块</strong></p>\n<p>首先说明下环境，我的nginx 版本是 1.16 , 在网上查了下 安装 ngx_http_geoip2 模块至少需要 1.18 版本及以上，因此此次安装我是 升级nginx1.18，添加 ngx_http_geoip2 模块。</p>\n<ul>\n<li>下载nginx 1.18 版本</li>\n</ul>\n<div><pre><code>[root@fxkj tmp]# wget http://nginx.org/download/nginx-1.18.0.tar.gz\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><ul>\n<li>解压nginx1.18 软件包并 升级为 nginx1.18 ，添加 ngx_http_geoip2 模块</li>\n</ul>\n<p>需要注意：</p>\n<p><strong>1、升级nginx, 添加nginx 模块 只需要 编译 然后 make\n不需要 make instll 不然线上的nginx 会被新版本nginx 完完整整的替换掉</strong></p>\n<p><strong>2、编译前 需要看下 nginx 当前安装了哪些模块</strong></p>\n<div><pre><code>**<span>[</span>root@fxkj tmp<span>]</span><span># /usr/local/nginx/sbin/nginx -V**</span>\n\n**nginx version: nginx/1.16.0**\n\n**built by gcc <span>4.8</span>.5 <span>20150623</span> <span>(</span>Red Hat <span>4.8</span>.5-39<span>)</span> <span>(</span>GCC<span>)</span>**\n\n**built with OpenSSL <span>1.0</span>.2k-fips <span>26</span> Jan <span>2017</span>**\n\n**TLS SNI support enabled**\n\n**configure arguments: --with-http_stub_status_module --prefix<span>=</span>/usr/local/nginx --user<span>=</span>nginx --group<span>=</span>nginx --with-http_ssl_module --with-stream**\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>编译安装</p>\n<div><pre><code><span>[</span>root@fxkj tmp<span>]</span><span># tar -xf nginx-1.18.0.tar.gz </span>\n<span>[</span>root@fxkj tmp<span>]</span><span># cd nginx-1.18.0/</span>\n<span>[</span>root@fxkj nginx-1.18.0<span>]</span><span># ./configure --with-http_stub_status_module \\</span>\n --prefix<span>=</span>/usr/local/nginx <span>\\</span>\n --user<span>=</span>nginx --group<span>=</span>nginx --with-http_ssl_module --with-stream <span>\\</span>\n --add-module<span>=</span>/usr/local/ngx_http_geoip2_module\n<span>[</span>root@fxkj nginx-1.18.0<span>]</span><span># make</span>\n<span>[</span>root@fxkj nginx-1.18.0<span>]</span><span># cp /usr/loca/nginx/sbin/nginx /usr/loca/nginx/sbin/nginx1.16    #备份</span>\n<span>[</span>root@fxkj nginx-1.18.0<span>]</span><span># cp objs/nginx /usr/local/nginx/sbin/    #用新的去覆盖旧的</span>\n<span>[</span>root@fxkj nginx-1.18.0<span>]</span><span># pkill nginx     #杀死nginx</span>\n<span>[</span>root@fxkj nginx-1.18.0<span>]</span><span># /usr/local/nginx/sbin/nginx    #再次启动Nginx</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>查看nginx 版本 以及安装的模块</p>\n<div><pre><code><span>[</span>root@fxkj nginx-1.18.0<span>]</span><span># /usr/local/nginx/sbin/nginx -V</span>\n\nnginx version: nginx/1.18.0\n\nbuilt by gcc <span>4.8</span>.5 <span>20150623</span> <span>(</span>Red Hat <span>4.8</span>.5-39<span>)</span> <span>(</span>GCC<span>)</span>\n\nbuilt with OpenSSL <span>1.0</span>.2k-fips <span>26</span> Jan <span>2017</span>\n\nTLS SNI support enabled\n\nconfigure arguments: --with-http_stub_status_module --prefix<span>=</span>/usr/local/nginx --user<span>=</span>nginx --group<span>=</span>nginx --with-http_ssl_module --with-stream **--add-module<span>=</span>/usr/local/ngx_http_geoip2_module**\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>五、下载最新的IP地址数据库文件</strong></p>\n<p>模块安装成功后，还要在 Nginx 里指定数据库，在安装运行库时默认安装了两个，位于 /usr/share/GeoIP/ 目录下，一个只有 IPv4，一个包含 IPv4 和 IPv6：</p>\n<p>登录 <a href=\"http://www.maxmind.com\" target=\"_blank\" rel=\"noopener noreferrer\">www.maxmind.com</a> 网址，创建账户 下载最新的库文件（账户创建就不演示了）</p>\n<p>点击左侧 ，Download Files</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/a965a80a0e354dde96ba5fa1091cf86f.png\" alt=\"通过Nginx来实现禁止国外IP访问网站\"></p>\n<p>选择 GeoLite2 Country ，点击 Download GZIP 下载即可</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/c3e087baa970419593541115de1ad8be.png\" alt=\"通过Nginx来实现禁止国外IP访问网站\"></p>\n<p>上传到 /usr/share/GeoIP/ 下并解压</p>\n<div><pre><code><span>[</span>root@fxkj local<span>]</span><span># cd /usr/share/GeoIP/</span>\n<span>[</span>root@fxkj GeoIP<span>]</span><span># ll</span>\ntotal <span>69612</span>\nlrwxrwxrwx. <span>1</span> root root       <span>17</span> Mar  <span>7</span>  <span>2019</span> GeoIP.dat -<span>></span> GeoIP-initial.dat\n-rw-r--r--. <span>1</span> root root  <span>1242574</span> Oct <span>30</span>  <span>2018</span> GeoIP-initial.dat\nlrwxrwxrwx. <span>1</span> root root       <span>19</span> Mar  <span>7</span>  <span>2019</span> GeoIPv6.dat -<span>></span> GeoIPv6-initial.dat\n-rw-r--r--. <span>1</span> root root  <span>2322773</span> Oct <span>30</span>  <span>2018</span> GeoIPv6-initial.dat\n-rw-r--r--  <span>1</span> root root  <span>3981623</span> Aug <span>12</span> 02:37 GeoLite2-Country.mmdb\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><strong>六、配置nginx 配置文件</strong></p>\n<p><strong>修改前 先备份配置文件</strong></p>\n<p>[root@fxkj ~]# cp /usr/local/nginx/conf/nginx.conf /usr/local/nginx/conf/nginx.conf-bak</p>\n<p>[root@fxkj ~]# vim /usr/local/nginx/conf/nginx.conf</p>\n<p>在http 中添加 几行，定义数据库文件位置</p>\n<div><pre><code>geoip2 /usr/share/GeoIP/GeoLite2-City.mmdb <span>{</span>\nauto_reload 5m<span>;</span>\n<span>$geoip2_data_country_code</span> country iso_code<span>;</span>\n<span>}</span>\n  map <span>$geoip2_data_country_code</span> <span>$allowed_country</span> <span>{</span>\n                default <span>yes</span><span>;</span>\n                CN no<span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/bfc6d7c990cf41b08b13280b8ee9f0e8.png\" alt=\"通过Nginx来实现禁止国外IP访问网站\"></p>\n<p>在 server 中的 location 下 添加 条件</p>\n<p>如果满足IP 是国外IP 就 执行下面的return 动作，我这里定义了3种, 注释了其中两个。</p>\n<p>当访问IP 是国外IP ，直接返回404</p>\n<div><pre><code><span>if</span> <span>(</span><span>$allowed_country</span> <span>=</span> <span>yes</span><span>)</span> <span>{</span>\n       <span># return https://www.baidu.com;</span>\n       <span># return /home/japan;</span>\n        <span>return</span> <span>404</span><span>;</span>\n          <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/58effbcb1b4d4422b637a238d8371051.png\" alt=\"通过Nginx来实现禁止国外IP访问网站\"></p>\n<p>修改完毕后， 检测下配置文件，重新加载下 nginx</p>\n<div><pre><code><span>[</span>root@fxkj ~<span>]</span><span># /usr/local/nginx/sbin/nginx -t</span>\nnginx: the configuration <span>file</span> /usr/local/nginx/conf/nginx.conf syntax is ok\nnginx: configuration <span>file</span> /usr/local/nginx/conf/nginx.conf <span>test</span> is successful\n<span>[</span>roo@fxkj ~<span>]</span><span># /usr/local/nginx/sbin/nginx -s reload</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p><strong>7、模拟测试验证</strong></p>\n<p><strong>使用海外节点的服务器去访问网站</strong></p>\n<p>这里我的IP 是 来自于韩国</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/fca231769f3c40458a321bdca7c356f1.png\" alt=\"通过Nginx来实现禁止国外IP访问网站\"></p>\n<p>可以看到访问网站报错 404 Not Found</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/ac732b838fd84cf9a1ba52a27c13d76d.png\" alt=\"通过Nginx来实现禁止国外IP访问网站\"></p>\n<p>我们再来看下nginx 的访问日志</p>\n<div><pre><code><span>\"13.125.1.194 - - [14/Aug/2020:16:15:51 +0800] \"</span>GET /favicon.ico HTTP/1.1<span>\" **404** 548 \"</span>https://www.fxkjnj.com/<span>\" \"</span>Mozilla/5.0 <span>(</span>Windows NT <span>10.0</span><span>;</span> Win64<span>;</span> x64<span>)</span> AppleWebKit/537.36 <span>(</span>KHTML, like Gecko<span>)</span> Chrome/84.0.4147.125 Safari/537.36\"\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/e74537e1a7b4476098d4e68a38203704.png\" alt=\"通过Nginx来实现禁止国外IP访问网站\"></p>\n<p>到此 我们通过Nginx来实现禁止国外IP访问网站 就结束了</p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/a965a80a0e354dde96ba5fa1091cf86f.png",
      "date_published": "2022-06-19T00:00:00.000Z",
      "date_modified": "2022-06-03T02:53:13.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "一个减少MIUI动画掉帧的方法",
      "url": "https://blog.ciberviler.top/daily/%E4%B8%80%E4%B8%AA%E5%87%8F%E5%B0%91MIUI%E5%8A%A8%E7%94%BB%E6%8E%89%E5%B8%A7%E7%9A%84%E6%96%B9%E6%B3%95.html",
      "id": "https://blog.ciberviler.top/daily/%E4%B8%80%E4%B8%AA%E5%87%8F%E5%B0%91MIUI%E5%8A%A8%E7%94%BB%E6%8E%89%E5%B8%A7%E7%9A%84%E6%96%B9%E6%B3%95.html",
      "content_html": "<h1 id=\"一个减少miui动画掉帧的方法\" tabindex=\"-1\"> 一个减少MIUI动画掉帧的方法</h1>\n<p>分享一个减少MIUI12动画掉帧的方法。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16542238760163.jpeg\" alt=\"图片\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16542238760162.jpeg\" alt=\"图片\"></p>\n<p>应用管理找到系统跟踪清除数据\n然后进入开发者选项中的系统跟踪选择关闭跟踪可调试应用\n（没有停用hw叠加层，动画也更流畅了）</p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16542238760163.jpeg",
      "date_published": "2022-06-18T00:00:00.000Z",
      "date_modified": "2022-06-03T02:53:04.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "daily"
      ]
    },
    {
      "title": "七大排序（代码+动图演示）",
      "url": "https://blog.ciberviler.top/algorithm/%E4%B8%83%E5%A4%A7%E6%8E%92%E5%BA%8F.html",
      "id": "https://blog.ciberviler.top/algorithm/%E4%B8%83%E5%A4%A7%E6%8E%92%E5%BA%8F.html",
      "content_html": "<h1 id=\"七大排序-代码-动图演示\" tabindex=\"-1\"> 七大排序（代码+动图演示）</h1>\n<h2 id=\"_1-排序的概念及其运用\" tabindex=\"-1\"> 1.排序的概念及其运用</h2>\n<h3 id=\"_1-1排序的概念\" tabindex=\"-1\"> 1.1排序的概念</h3>\n<blockquote>\n<p><strong>排序</strong>：所谓排序，就是使一串记录，按照其中的某个或某些关键字的大小，递增或递减的排列起来的操作。</p>\n<p><strong>稳定性</strong>：假定在待排序的记录序列中，存在多个具有相同的关键字的记录，若经过排序，这些记录的相对次 序保持不变，即在原序列中，r[i]=r[j]，且r[i]在r[j]之前，而在排序后的序列中，r[i]仍在r[j]之前，则称这种排 序算法是稳定的；否则称为不稳定的。</p>\n<p><strong>稳定性的意义</strong>：在根据多种属性进行排序时会有巨大的意义。比如我们先对学生按照学号进行了排序，再对学生进行了按照成绩进行排序，此时学号和成绩成为了两种决定因素，如果我们在按照成绩进行排序时，所使用的算法是不具有稳定性的，那么在对成绩排序后，之前根据学号进行的排序就没有意义了，此时就会出现相同成绩，但是学号靠后的在前面，反之，如果我们选择的排序具有稳定性，那么成绩相同，学号靠前的应该在前面。</p>\n<p><strong>内部排序</strong>：数据元素全部放在内存中的排序。</p>\n<p><strong>外部排序</strong>：数据元素太多不能同时放在内存中，根据排序过程的要求不能在内外存之间移动数据的排序。<strong>一般数据是存储在磁盘中的。</strong></p>\n</blockquote>\n<p>区分内外排序：</p>\n<table>\n<thead>\n<tr>\n<th>排序类型</th>\n<th>数据存储</th>\n<th>访问速度</th>\n<th>支持的访问形式</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>内排序</td>\n<td>数据在内存中（数组）</td>\n<td>快</td>\n<td>下标随机访问</td>\n</tr>\n<tr>\n<td>外排序</td>\n<td>数据在磁盘中，数据量很大</td>\n<td>慢</td>\n<td>串行访问</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"_1-2-排序的运用\" tabindex=\"-1\"> 1.2 排序的运用</h3>\n<p>下面就是按价格对手机进行排序：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/6341d7a797684a31ae2e6f567c9057fd.png\" alt=\"image-20220424103625642\"></p>\n<p>下面是根据综合得分对大学进行排名：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/d2d1f6a92aca95da78de2198ce021a3d.png\" alt=\"image-20220424103843298\"></p>\n<h3 id=\"_1-3-常见的排序算法\" tabindex=\"-1\"> 1.3 常见的排序算法</h3>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/800519b135762278631075369f949b9c.png\" alt=\"image-20220424104112902\"></p>\n<h2 id=\"_2-常见排序算法的实现\" tabindex=\"-1\"> 2. 常见排序算法的实现</h2>\n<h3 id=\"_2-1-插入排序\" tabindex=\"-1\"> 2.1 插入排序</h3>\n<h4 id=\"_2-1-1-基本思想\" tabindex=\"-1\"> 2.1.1 基本思想</h4>\n<p>直接插入排序是一种简单的插入排序法，其基本思想是：</p>\n<p><strong>把待排序的记录按其关键码值的大小逐个插入到一个已经排好序的有序序列中，直到所有的记录插入完为止，得到一个新的有序序列 。</strong></p>\n<p>简单来说就是：有一个有序区间，插入一个数据，依旧保持它有序。</p>\n<h4 id=\"_2-1-2直接插入排序\" tabindex=\"-1\"> 2.1.2直接插入排序</h4>\n<p><strong>当插入第i(i&gt;=1)个元素时，前面的array[0],array[1],…,array[i-1]已经排好序，此时用array[i]的排序码与 array[i-1],array[i-2],…的排序码顺序进行比较，找到插入位置即将array[i]插入，原来位置上的元素顺序后移。</strong></p>\n<p>动图展示：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/627d7b9813a49e036cd717b3d60b50d0.gif\" alt=\"20210223174254141\"></p>\n<p>代码实现：（此处排的是升序）</p>\n<div><pre><code>void InsertSort(int *a,int n)\n{\n\tfor (int i = 0; i &lt; n-1;i++)//end:[0:n-2]  end+1:[1:n-1]\n\t{\n\t\tint end = i;\n\t\t//[0,end]有序 把[end+1]插入进去，保持它依旧有序\n\t\tint tmp = a[end + 1];\n\t\twhile (end &gt;= 0)\n\t\t{\n\t\t\tif (tmp &lt; a[end])//降序就是把 &lt; 变为 &gt; \n\t\t\t{\n\t\t\t\ta[end + 1] = a[end];\n\t\t\t\t--end;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\ta[end + 1] = tmp;\n\t\t//此处有两种情况，第一种就是数据到了应该插入的位置（非a[0]），另一种就是数据要插入到a[0]的位置\n\t}\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><blockquote>\n<p>直接插入排序的特性总结：</p>\n<ol>\n<li>元素集合越接近有序，直接插入排序算法的时间效率越高</li>\n<li>时间复杂度：O(N^2) 最坏的情况（逆序）：1 + 2 + ······ + N 时间复杂度：O(N2) 最好：（有序）O(N)</li>\n<li>空间复杂度：O(1)，它是一种稳定的排序算法</li>\n<li>稳定性：稳定</li>\n</ol>\n</blockquote>\n<h4 id=\"_2-1-3-希尔排序\" tabindex=\"-1\"> 2.1.3 希尔排序</h4>\n<blockquote>\n<p>希尔排序（ShellSort）又称为“缩小增量排序”。是1959年由D.L.Shell提出来的。该方法的基本思想是：<strong>先将整个待排元素序列分割成若干个子序列（由相隔某个“增量”的元素组成的）分别进行直接插入排序，然后依次缩减增量再进行排序，待整个序列中的元素基本有序（增量足够小）时，再对全体元素进行一次直接插入排序</strong>。因为直接插入排序在元素基本有序的情况下（接近最好情况），效率是很高的，因此希尔排序在时间效率上比前两种方法有较大提高。</p>\n</blockquote>\n<p>具体做法：首先确定一组增量d0，d1，d2，d3，…,dt-1()其中n&gt;d0&gt;d1&gt;…&gt;dt-1=1),对于i=0,1,2,…,t-1,依次进行下面的各趟处理:根据当前增量di将n个元素分成di个组,每组中元素的下标相隔为di;再对各组中元素进行直接插入排序.</p>\n<p>动图展示：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/76f44ea58c9e4af381670fe28e1ce217.gif\" alt=\"v2-f9616f6892819e579a2d4ab10256a732_b\"></p>\n<p>1、<strong>预排序：大的数更快的到后面去，小的数更快的到前面去，尽可能地接近有序。</strong></p>\n<p>举例：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/78da1877163e9f0987a1f73d42667a0f.png\" alt=\"image-20220417091054918\"></p>\n<p>gap为几，就将数字划分为几组数据，然后分别对这几组数据进行插入排序，例如在上面地例子中，首先对9、5、8、5进行插入排序，然后对1、7、4进行插入排序，然后再对2、6、3进行插入排序。这就是预排序。</p>\n<blockquote>\n<p>问：gap的大小和预排序后的数据有什么关系？</p>\n<p>答：如果gap越小，数据跳跃越慢，但是预排序后的数据就越接近有序；如果gap越大，大的数据可以更快的到达最后，小的数据可以更快的到达前面，但它越不接近有序，只能说是相对有序。</p>\n</blockquote>\n<blockquote>\n<p>问：希尔排序就一定比直接插入排序快吗？</p>\n<p>答：不一定，当所给数组本来就是升序或者接近升序的时候，进行的预排序就相当于是无用功，相当于是白做的，此时的效率就不如直接插入排序了。当然，这种情况是很少的，一般所给的数据都是乱序或者接近逆序的，所以这种情况一般不去考虑。</p>\n</blockquote>\n<p>2、<strong>直接插入排序</strong></p>\n<p><strong>直接插入排序就是gap为1时候的排序，就是直接插入排序，由于此时地数据已经接近有序，所以插入排序起来更为容易。</strong></p>\n<blockquote>\n<p>问：插入排序的效率在哪体现呢？</p>\n<p>答：在间隔gap个数据进行插入排序时，相当于一次跨越gap个数据进行移动，这样从本质上来看相对于直接插入排序节省了很多次循环所花费的时间，下面举个例子来看：</p>\n</blockquote>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/3660714e7c614d97bbee9b2d7f7c2352.png\" alt=\"image-20220417092754508\"></p>\n<blockquote>\n<p>在经过一次gap为3的插入排序后，较小的三个数字3、2、1已经排到了最前面，中间的三个数字6、5、4已经到了中间，较大的三个数字9、8、7已经到了最后，这样我们在进行直接插入排序的时候，1只需要移动两次就能到达最前面，而如果没有进行gap为3的那次预排序的话，1需要移动8次进行8次循环才能到达它需要到达的位置，这就是希尔排序提高的效率所在。</p>\n</blockquote>\n<p>代码：</p>\n<div><pre><code>//希尔排序:传统写法\nvoid ShellSort(int* a, int n)\n{\n\tint gap = n;\n\twhile (gap &gt; 1)//这个地方不能是&gt;=1，因为经过后面的控制后，gap始终大于1，如果是&gt;=1，就会陷入死循环\n\t{\n\t\tgap = gap / 3 + 1;//保证最后一次一定是1，即最后有一次直接插入排序\n\t\tfor (int k = 0; k &lt; gap; k++)\n\t\t{\n\t\t\tfor (int i = k; i &lt; n - gap; i += gap)//为什么是n - gap?因为最后一个end是n-1-gap,end+gap一定小于n\n\t\t\t{\n\t\t\t\tint end = i;\n\t\t\t\tint tmp = a[end + gap];\n\t\t\t\twhile (end &gt;= 0)\n\t\t\t\t{\n\t\t\t\t\tif (tmp &lt; a[end])\n\t\t\t\t\t{\n\t\t\t\t\t\ta[end + gap] = a[end];\n\t\t\t\t\t\tend -= gap;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\ta[end + gap] = tmp;\n\t\t\t}\n\t\t}\n\t}\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>下面是希尔排序的优化写法：</p>\n<p><strong>将四层循环变为3层循环，当然，效率并没有提升，只是将代码的循环层数减少了一层，两者时间复杂度其实并没有太大的区别</strong></p>\n<div><pre><code>//希尔排序：优化写法\nvoid ShellSort(int* a, int n)\n{\n\tint gap = n;\n\twhile (gap &gt; 1)//这个地方不能是&gt;=1，因为经过后面的控制后，gap始终大于1，如果是&gt;=1，就会陷入死循环\n\t{\n\t\tgap =gap/3 + 1;//保证最后一次一定是1，即最后有一次直接插入排序\n\t\tfor (int i = 0; i &lt; n - gap; ++i)//为什么是n - gap?因为最后一个end是n-1-gap,end+gap一定小于n\n\t\t{\n\t\t\tint end = i;\n\t\t\tint tmp = a[end + gap];\n\t\t\twhile (end &gt;= 0)\n\t\t\t{\n\t\t\t\tif (tmp &lt; a[end])\n\t\t\t\t{\n\t\t\t\t\ta[end + gap] = a[end];\n\t\t\t\t\tend -= gap;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\ta[end + gap] = tmp;\n\t\t}\n\t}\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>希尔排序的特性总结：</p>\n<blockquote>\n<ol>\n<li>\n<p>希尔排序是对直接插入排序的优化。</p>\n</li>\n<li>\n<p>当gap &gt; 1时都是预排序，目的是让数组更接近于有序。当gap == 1时，数组已经接近有序的了，这样就 会很快。这样整体而言，可以达到优化的效果。我们实现后可以进行性能测试的对比。</p>\n</li>\n<li>\n<p>希尔排序的时间复杂度不好计算，因为gap的取值方法很多，导致很难去计算，因此在好些书中给出的 希尔排序的时间复杂度都不固定：</p>\n<p>《数据结构(C语言版)》— 严蔚敏</p>\n</li>\n</ol>\n</blockquote>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/5b8e5ee2709631acece6763009ed51c5.png\" alt=\"image-20220417104317401\"></p>\n<blockquote>\n<p>《数据结构-用面相对象方法与C++描述》— 殷人昆</p>\n</blockquote>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/11267f038cd6ddce4e0cfcd02e5a9a0b.png\" alt=\"image-20220417104337855\"></p>\n<blockquote>\n<p>因为我们的gap是按照Knuth提出的方式取值的，而且Knuth进行了大量的实验统计，我们就暂时按照：==O(n1.25)到O(1.6*n1.25)==来算</p>\n<ol start=\"4\">\n<li>稳定性：不稳定</li>\n</ol>\n</blockquote>\n<blockquote>\n<p>如果我们自己算希尔排序的时间复杂度的话：</p>\n<p><strong>预排序</strong>：</p>\n<p>gap很大时，数据跳的很快，差不多是O(N)，内层循环几乎忽略不计，跳跃的很快（每次跳跃gap次）。</p>\n<p>gap很小时，数据很接近有序，几乎不需要挪动，此时差不多也是O(N)。</p>\n<p><strong>最外层循环：</strong></p>\n<p>总共循环log3N次</p>\n<p>所以我们粗略进行计算的时候时间复杂度：O(N*log3N)</p>\n</blockquote>\n<h3 id=\"_2-2-选择排序\" tabindex=\"-1\"> 2.2 选择排序</h3>\n<h4 id=\"_2-2-1-基本思想\" tabindex=\"-1\"> 2.2.1 基本思想</h4>\n<p>每一次从待排序的数据元素中选出最小（或最大）的一个元素，存放在序列的起始位置，直到全部待排序的数据元素排完 。</p>\n<h4 id=\"_2-2-2-直接选择排序\" tabindex=\"-1\"> 2.2.2 直接选择排序</h4>\n<ul>\n<li>在元素集合array[i]–array[n-1]中选择关键码最大(小)的数据元素</li>\n<li>若它不是这组元素中的最后一个(第一个)元素，则将它与这组元素中的最后一个（第一个）元素交换</li>\n<li>在剩余的array[i]–array[n-2]（array[i+1]–array[n-1]）集合中，重复上述步骤，直到集合剩余1个元素</li>\n</ul>\n<p>动态图：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/a2c7cbf6ea0c17a87a4b0831d7c60cec.gif\" alt=\"SEL\"></p>\n<blockquote>\n<p>直接选择排序的特性总结：</p>\n<ol>\n<li>直接选择排序思考非常好理解，但是效率不是很好。实际中很少使用</li>\n<li>时间复杂度：O(N^2)</li>\n<li>空间复杂度：O(1)</li>\n<li>稳定性：不稳定</li>\n</ol>\n</blockquote>\n<p>选择排序代码实现：</p>\n<div><pre><code>void SelectSort(int* a, int n)\n{\n\t\n\tint left = 0;\n\tint right = n - 1;\n\twhile (left &lt; right)\n\t{\n\t\tint maxi = left;\n\t\tint mini = left;\n        //下面为什么是左开右闭区间？因为maxi和mini已经假设left是最小或者最大的数了，所以不必再包含left了，但是rightb\n\t\tfor (int i = left + 1; i &lt;= right; i++)\n\t\t{\n\t\t\tif (a[i] &lt; a[mini])\n\t\t\t{\n\t\t\t\tmini = i;\n\t\t\t}\n\t\t\tif (a[i] &gt; a[maxi])\n\t\t\t{\n\t\t\t\tmaxi = i;\n\t\t\t}\n\t\t}\n\t\tSwap(&amp;a[left], &amp;a[mini]);\n\t\t//如果left和maxi重叠，在将mini和left交换之后，mini此时就等于maxi\n\t\tif (left == maxi)\n\t\t{\n\t\t\tmaxi = mini;\n\t\t}\n\t\tSwap(&amp;a[right], &amp;a[maxi]);\n\t\tleft++;\n\t\tright--;\n\t}\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_2-2-3-堆排序\" tabindex=\"-1\"> 2.2.3 堆排序</h4>\n<p>堆排序(Heapsort)是指利用堆积树（堆）这种数据结构所设计的一种排序算法，它是选择排序的一种。它是 通过堆来进行选择数据。需要注意的是排升序要建大堆，排降序建小堆。</p>\n<h3 id=\"_2-3-交换排序\" tabindex=\"-1\"> 2.3 交换排序</h3>\n<blockquote>\n<p>基本思想：所谓交换，就是根据序列中两个记录键值的比较结果来对换这两个记录在序列中的位置，交换排序的特点是：将键值较大的记录向序列的尾部移动，键值较小的记录向序列的前部移动。</p>\n</blockquote>\n<h4 id=\"_2-3-1冒泡排序\" tabindex=\"-1\"> 2.3.1冒泡排序</h4>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/8b8b46206ecca895870276ca5149d2c1.gif\" alt=\"1145616330\"></p>\n<p>代码：</p>\n<div><pre><code>void BubbleSort(int* a, int n)\n{\n\tfor (int i = 0; i &lt; n; i++)\n\t{\n        int exange = 0;\n\t\tfor (int j = 0; j &lt; n - i - 1; j++)\n\t\t{\n\t\t\tif (a[j] &gt; a[j + 1])\n\t\t\t{\n\t\t\t\tSwap(&amp;a[j], &amp;a[j + 1]);\n                exange = 1;\n\t\t\t}\n\t\t}\n        if(exange == 0)//当有序的时候直接退出\n            break;\n\t}\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>冒泡排序的特性总结：</p>\n<p>1.冒泡排序是一种非常容易理解的排序</p>\n<p>2.时间复杂度：O(N^2) 最好情况：顺序有序：O(N)（最少得执行一次内层循环）</p>\n<p>3.空间复杂度：O(1)</p>\n<p>4.稳定性：稳定</p>\n<h4 id=\"冒泡排序与插入排序的比较\" tabindex=\"-1\"> 冒泡排序与插入排序的比较</h4>\n<p>相比之下，插入排序会更好一些，例如下面的这种情况：</p>\n<div><pre><code>1 2 3 4 5 6 8 7\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>这种情况下插入排序要比较8此，但是冒泡排序要比较7 + 6 = 13次。当然。此时的时间复杂度都是O(N)。</p>\n<p>但是在局部有序的情况下：</p>\n<div><pre><code>3 4 2 8 7 9 5 9\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>冒泡排序的优化基本不会体现出什么价值，但是插入排序却能充分利用局部有序的情况，使比较次数减少。</p>\n<p><strong>总结：如果是顺序有序的情况，那么插入和冒泡是一样的；但是如果是局部有序，或者接近有序，那么插入的适应性更好，比较次数更少。</strong></p>\n<h3 id=\"_2-3-2-快速排序\" tabindex=\"-1\"> 2.3.2 快速排序</h3>\n<h4 id=\"_2-3-2-1-快速排序的代码实现-三种思路\" tabindex=\"-1\"> 2.3.2.1 快速排序的代码实现（三种思路）</h4>\n<p>快速排序是Hoare于1962年提出的一种二叉树结构的交换排序方法，其基本思想为：<strong>任取待排序元素序列中的某元素作为基准值，按照该排序码将待排序集合分割成两子序列，左子序列中所有元素均小于基准值，右子序列中所有元素均大于基准值，然后最左右子序列重复该过程，直到所有元素都排列在相应位置上为止</strong>。</p>\n<div><pre><code>// 假设按照升序对array数组中[left, right)区间中的元素进行排序\nvoid QuickSort(int array[], int left, int right)\n{\n\tif (right - left &lt;= 1)\n\t\treturn;\n\n\t// 按照基准值对array数组的 [left, right)区间中的元素进行划分\n\tint div = partion(array, left, right);\n\n\t// 划分成功后以div为边界形成了左右两部分 [left, div) 和 [div+1, right)\n\t// 递归排[left, div)\n\tQuickSort(array, left, div);\n\n\t// 递归排[div+1, right)\n\tQuickSort(array, div + 1, right);\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>上述为快速排序递归实现的主框架，发现与二叉树前序遍历规则非常像，我们在写递归框架时可想想二叉树前序遍历规则即可快速写出来，后续只需分析如何按照基准值来对区间中数据进行划分的方式即可。</p>\n<p>将区间按照基准值划分为左右两半部分的常见方式有：</p>\n<ol>\n<li>\n<p><strong>hoare版本</strong></p>\n<p>单趟排序：选出一个key，一般是第一个数或者最后一个数</p>\n<p>要求：左边的值都比key要小，右边的值都比key要大。</p>\n<p>动图展示：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/e2ef543195516b5ef4c44adc5eabce70.gif\" alt=\"hoare\"></p>\n<p>图像展示：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20fadbe0e8794591ce048476c67ef15a.png\" alt=\"image-20220417161341875\"></p>\n<p>总结：R找比key小的值，L找比key大的值，找到后交换，再重复上述过程，相遇之后，把相遇位置的值跟key交换。</p>\n<p>问：当数字数目为偶数的时候，是否会出现不相遇的情况或者如何保证相遇位置的值一定比key小呢？</p>\n<p>答：不会，因为R总是先于L移动，总会找到一个比key小的位置，即使L的后面不是一个小于key的数字，此时的R也会到达L所处的位置，因为之前经过交换，此时一定是一个比key小的数字。简单来收就是只有两种情况：R去碰L，或者L去碰R，无论哪一种，两者相遇的地方都是一个比key小的位置。</p>\n<p>问：如果右边作key，那么第一轮排序后会变成什么样子的？</p>\n<p>答：第一轮排序后如图所示：\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/b5d1140514dca8c0ff1931e554984ee9.png\" alt=\"image-20220417170238685\"></p>\n<p>此时要注意必须让左边先走，为了保证相遇点一定是一个比key大的数据。</p>\n<p>快速排序单趟排序写法思路：</p>\n<p>初始代码：</p>\n<div><pre><code>int PartSort(int *a,int left,int right)//快速排序单趟排序\n{\n\tint keyi = left;\n\twhile (left &lt; right)\n\t{\n\t\t//右边找小\n\t\twhile (a[right] &gt; a[keyi])\n\t\t{\n\t\t\tright--;\n\t\t}\n\t\t//左边找大\n\t\twhile (a[left] &lt; a[keyi])\n\t\t{\n\t\t\tleft++;\n\t\t}\n        Swap(&amp;a[left], &amp;a[right]);\n\t}\n    Swap(&amp;a[keyi], &amp;a[left]);\n    return left;//返回相遇的位置\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div></li>\n</ol>\n<p>很明显，上面的代码并不完善，无法处理两种情况，即下面的两种情况：</p>\n<p><code>1 2 3 4 5</code></p>\n<p><code>5 5 2 3 5</code>在这种情况下就会陷入死循环，因为5不大于5，right始终无法进行–操作，left也同样无法进行++操作，此时就会陷入死循环。</p>\n<p>此时进行优化，在相等的时候也要进行–操作：</p>\n<div><pre><code>   int PartSort(int *a,int left,int right)//快速排序单趟排序\n   {\n   \tint keyi = left;\n   \twhile (left &lt; right)\n   \t{\n   \t\t//右边找小\n   \t\twhile (a[right] &gt;= a[keyi])\n   \t\t{\n   \t\t\tright--;\n   \t\t}\n   \t\t//左边找大\n   \t\twhile (a[left] &lt;= a[keyi])\n   \t\t{\n   \t\t\tleft++;\n   \t\t}\n           Swap(&amp;a[left], &amp;a[right]);\n   \t}\n       Swap(&amp;a[keyi], &amp;a[left]);\n       return left;//返回相遇的位置\n   }\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>此时又出现了新的问题：如果right找不到比key小的，就会出现越界的风险，所以在进行<code>a[right]&gt;=a[keyi]</code>条件判断的前面还要加上一个条件，下面是代码的进一步优化：（最终版）</p>\n<div><pre><code>int PartSort(int *a,int left,int right)//快速排序单趟排序\n{\n\tint keyi = left;\n\twhile (left &lt; right)\n\t{\n\t\t//右边找小\n\t\twhile (left&lt;right &amp;&amp; a[right] &gt;= a[keyi])\n\t\t{\n\t\t\tright--;\n\t\t}\n\t\t//左边找大\n\t\twhile (left &lt; right &amp;&amp; a[left] &lt;= a[keyi])\n\t\t{\n\t\t\tleft++;\n\t\t}\n        Swap(&amp;a[left], &amp;a[right]);\n\t}\n    Swap(&amp;a[keyi], &amp;a[left]);\n    return left;//返回相遇的位置\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>此时进行接下来的分析及操作：</p>\n<p><strong>此时keyi所在的数据就不需要再进行移动了，已经放在了正确的位置。如果keyi的左边有序，右边再有序，那么整体就是有序的</strong>。此时就需要运用分治的思想，此时分别对右边进行单趟排序的递归，直到所有数据都有序，然后重复上面的数据，直到只有一个数据时为止，此时退出递归，整体就是有序的。</p>\n<p><strong>快速排序主函数代码：</strong></p>\n<div><pre><code>   void QuickSort(int* a,int begin,int end)\n{\n   \t//当出现错位或者二者相等的时候就停止\n   \tif (begin &gt;= end)\n   \t\treturn;\n   \n   \tint keyi = PartSort(a, begin, end);\n   \t//分割出了两个子区间：[begin,keyi-1]keyi[keyi+1,end]\n   \tQuickSort(a, begin, keyi - 1);\n   \tQuickSort(a, keyi+1, end);\n   }\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><blockquote>\n<p><strong>问：return的条件判断为什么是<code>begin &gt;= end</code>？而不能只是一个==呢？</strong></p>\n<p><strong>答：比如当进入这个函数时，begin = 0，end = 2，keyi = 1，此时就会出现两个区间，就是[0,0]和[2,1]，如果只是相等的话，判断前面的条件自然没有什么问题，但是判断后面的不存在的区间时就不行了。</strong></p>\n</blockquote>\n<ol start=\"2\">\n<li>\n<p>挖坑法</p>\n<p>动图展示：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2ffc140a0e4bf8d13f559eb0fbe6345a.gif\" alt=\"挖坑法\"></p>\n<p>代码：</p>\n<div><pre><code>int PartSort2(int* a, int left, int right)\n{\n\tint key = a[left];\n\tint hole = left;//记录坑的下标\n\twhile (left &lt; right)\n\t{\n\t\twhile (left&lt;right&amp;&amp; a[right] &gt;= key)//从右边找小于key的\n\t\t{\n\t\t\tright--;\n\t\t}\n\t\ta[hole] = a[right];//把找到的值放到坑位上去\n\t\thole = right;//形成新的坑\n\t\twhile (left&lt;right&amp;&amp;a[left] &lt;= key)//从左边找大于key的\n\t\t{\n\t\t\tleft++;\n\t\t}\n\t\ta[hole] = a[left];//把找到的值放到坑位上去\n\t\thole = left;//形成新的坑\n\t}\n\ta[left] = key;//将key放到相遇的位置上去（相遇的位置一定是坑）\n\treturn left;//返回相遇位置的下标\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><blockquote>\n<p><strong>问：挖坑法和hoare有什么区别吗？两个的效率是否一样？挖坑法是否就一定比hoare方法好呢？</strong></p>\n<p><strong>答：挖坑法和hoare方法没有本质的区别，两个的时间复杂度也都是一样的，不存在谁优谁劣的问题，两者的好坏并没有严格的限定，挖坑法相对hoare方法来说，更容易理解，hoare方法过于抽象，有些不太好理解。需要注意的是：在使用两种方法经过第一轮排序后形成的结果并不一定是相同的，或者说二者大多数情况下都是不相同的，只有少数情况下才是相同的。</strong></p>\n</blockquote>\n</li>\n<li>\n<p>前后指针法</p>\n<p>动图展示：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/6a192f147c7020e2f75021611f0eadfc.gif\" alt=\"前后指针\"></p>\n<p>代码：</p>\n<div><pre><code>//left作keyi\nint PartSort3(int* a, int left, int right)\n{\n\tint keyi = left;\n\tint prev = left;\n\tint cur = left + 1;\n\twhile (cur &lt;= right)\n\t{\n\t\t//下面这一行代码的作用：当cur遇到比a[keyi]小的值后++prev，并且防止自己跟自己进行交换\n\t\tif (a[cur] &lt; a[keyi] &amp;&amp; a[++prev]!= a[cur])\n\t\t\tSwap(&amp;a[cur], &amp;a[prev]);\n\n\t\tcur++;\n\t}\n\tSwap(&amp;a[prev], &amp;a[keyi]);//将a[prev]和a[keyi]进行交换\n\treturn prev;\n}\n//right作keyi\nint PartSort3(int* a, int left, int right)\n{\n\tint keyi = right;\n\tint cur = left;\n\tint prev = left - 1;\n\twhile (cur&lt;right)\n\t{\n\t\tif (a[cur] &lt; a[keyi] &amp;&amp; a[++prev] != a[cur])\n\t\t{\n\t\t\tSwap(&amp;a[cur], &amp;a[prev]);\n\t\t}\n\t\tcur++;\n\t}\n\tSwap(&amp;a[++prev], &amp;a[keyi]);\n\treturn prev;\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><blockquote>\n<p><strong>prev和cur的关系：</strong></p>\n<p><strong>1、cur还没遇到比key大的值时，prev紧跟着cur，一前一后。</strong></p>\n<p><strong>2、cur遇到比key大的值时，prev和cur之间间隔着一段比key大的值的区间。</strong></p>\n</blockquote>\n</li>\n</ol>\n<h4 id=\"_2-3-2-2-时间复杂度\" tabindex=\"-1\"> 2.3.2.2 时间复杂度</h4>\n<p>快速排序的时间复杂度：</p>\n<p>最好情况：每次选的都是中位数O(N*log2N)</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/822e6a187d4fc340de2346382edcff5e.png\" alt=\"image-20220419170635866\"></p>\n<p>最坏情况：每次选的key是最小的或最大的O(N2)</p>\n<h4 id=\"_2-3-2-3-快速排序的优化\" tabindex=\"-1\"> 2.3.2.3 快速排序的优化</h4>\n<p><strong>1.随机选key</strong></p>\n<p><strong>2.三数选中</strong></p>\n<div><pre><code>int GetMidIndex(int*a,int  left,int  right)\n{\n\tint mid = left + (right- left) / 2;\n\tif (a[left] &lt; a[mid])// left mid\n\t{\n\t\tif (a[mid] &lt; a[right])//left mid right\n\t\t{\n\t\t\treturn mid;\n\t\t}\n\t\telse if (a[left] &gt; a[right])//right left mid\n\t\t{\n\t\t\treturn left;\n\t\t}\n\t\telse//left right mid\n\t\t{\n\t\t\treturn right;\n\t\t}\n\t}\n\telse//mid   left\n\t{\n\t\tif (a[right] &gt; a[left])//mid left right\n\t\t{\n\t\t\treturn left;\n\t\t}\n\t\telse if (a[mid] &lt; a[right])//mid right left\n\t\t{\n\t\t\treturn right;\n\t\t}\n\t\telse//right mid left\n\t\t{\n\t\t\treturn mid;\n\t\t}\n\t}\n}\n\n//left作keyi\nint PartSort3(int* a, int left, int right)\n{\n\tint midi = GetMidIndex(a, left, right);\n    Swap(&amp;a[midi], &amp;a[left]);\n\tint keyi = left;\n\tint prev = left;\n\tint cur = left + 1;\n\twhile (cur &lt;= right)\n\t{\n\t\t//下面这一行代码的作用：当cur遇到比a[keyi]小的值后++prev，并且防止自己跟自己进行交换\n\t\tif (a[cur] &lt; a[keyi] &amp;&amp; a[++prev]!= a[cur])\n\t\t\tSwap(&amp;a[cur], &amp;a[prev]);\n\n\t\tcur++;\n\t}\n\tSwap(&amp;a[prev], &amp;a[keyi]);//将a[prev]和a[keyi]进行交换\n\treturn prev;\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>注意：三数取中法依然无法完全解决针对某种特殊情况序列复杂度变为O(n2)的情况。</p>\n<p>3.小区间优化</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1a67e55fa6d320383e8a72b03a386d1f.png\" alt=\"image-20220419192053842\"></p>\n<p><strong>快排递归调用就是展开简化图就是一个二叉树，我们从上图中可以看到，快速排序的主要花销在数据比较少的时候，就是begin和end之间的数比较少或者begin和end相等的时候，这个时候的递归次数相当多，我们可以在数字比较少的时候去调用其它的排序函数，以此来达到优化开快排的目的。</strong></p>\n<p>简而言之：区间很小时，不再使用递归划分的思路让它有序，而是直接使用插入排序对小区间排序，减少递归调用。</p>\n<p>代码：</p>\n<div><pre><code>void QuickSort(int* a,int begin,int end)\n{\n\t//当出现错位或者二者相等的时候就停止\n\tif (begin &gt;= end)\n\t\treturn;\n\t\n\t//小区间直接使用插入排序控制有序\n\tif (end - begin &lt;= 10)\n\t{\n\t\tInsertSort(a + begin, end - begin + 1);\n\t}\n\tint keyi = PartSort3(a, begin, end);\n\t//分割出了两个子区间：[begin,keyi-1]keyi[keyi+1,end]\n\tQuickSort(a, begin, keyi - 1);\n\tQuickSort(a, keyi+1, end);\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_2-3-2-3-快速排序非递归\" tabindex=\"-1\"> 2.3.2.3 快速排序非递归</h4>\n<p>两种思路进行实现：</p>\n<h5 id=\"_2-3-2-3-1-栈模拟递归实现\" tabindex=\"-1\"> 2.3.2.3.1 栈模拟递归实现</h5>\n<p>思路：</p>\n<p><strong>将需要使用到的下标放到栈上临时存储（为什么只存下标？因为PartSort()函数只需要用到函数名和下标），然后使用栈的性质，每当拿出一对下标时，将得到的新下标依次压入栈中，这样，始终都是先对右边的下标进行排序，模拟了递归的性质。</strong></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/079858f522d812594312eab72b433dcb.png\" alt=\"image-20220422195516422\"></p>\n<p>代码实现：</p>\n<div><pre><code>//快速排序的非递归形式1：通过栈来实现\nvoid QuickSort3(int* a, int begin, int end)\n{\n\tST st;\n\tStackInit(&amp;st);\n\tStackPush(&amp;st, begin);\n\tStackPush(&amp;st, end);\n\twhile (!StackEmpty(&amp;st))\n\t{\n\t\tint end = StackTop(&amp;st);\n\t\tStackPop(&amp;st);\n\t\tint begin = StackTop(&amp;st);\n\t\tStackPop(&amp;st);\n\t\tint keyi = PartSort(a, begin, end);\n\t\t//[begin , keyi - 1] [keyi+1,end]\n\t\tif (begin &lt; keyi - 1)\n\t\t{\n\t\t\tStackPush(&amp;st, begin);\n\t\t\tStackPush(&amp;st, keyi - 1);\n\t\t}\n\t\tif (keyi + 1 &lt; end)\n\t\t{\n\t\t\tStackPush(&amp;st, keyi + 1);\n\t\t\tStackPush(&amp;st, end);\n\t\t}\n\t}\n\tStackDestory(&amp;st);\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h5 id=\"_2-2-2-3-2-队列模拟二叉树遍历实现\" tabindex=\"-1\"> 2.2.2.3.2 队列模拟二叉树遍历实现</h5>\n<p>思路：</p>\n<p>将需要使用到的下标放到队列中来进行临时存储，每次从队列中拿出一对下标时，又将新形成的下标放入到队列中去，直到队列为空时停止。</p>\n<p>图示：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/f0c813bb9c8eccf06e81e5e78dddb445.png\" alt=\"image-20220422204533821\"></p>\n<p>代码：</p>\n<div><pre><code>//快速排序的非递归形式1：通过队列来实现\nvoid QuickSort3(int* a, int begin, int end)\n{\n\tQueue q;\n\tQueueInit(&amp;q);\n\tQueuePush(&amp;q, begin);\n\tQueuePush(&amp;q, end);\n\twhile (!QueueEmpty(&amp;q))\n\t{\n\t\tint left = QueueFront(&amp;q);\n\t\tQueuePop(&amp;q);\n\t\tint right = QueueFront(&amp;q);\n\t\tQueuePop(&amp;q);\n\t\tint keyi = PartSort(a, left, end);//[left,keyi-1][keyi+1,right]\n\t\tif (left &lt; keyi - 1)\n\t\t{\n\t\t\tQueuePush(&amp;q, left);\n\t\t\tQueuePush(&amp;q, keyi - 1);\n\t\t}\n\t\tif (keyi + 1 &lt; right)\n\t\t{\n\t\t\tQueuePush(&amp;q, keyi + 1);\n\t\t\tQueuePush(&amp;q, right);\n\t\t}\n\t}\n\tQueueDestory(&amp;q);\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"_2-4-归并排序\" tabindex=\"-1\"> 2.4 归并排序</h3>\n<h4 id=\"_2-4-1-基本思想\" tabindex=\"-1\"> 2.4.1 基本思想</h4>\n<p><strong>归并排序（MERGE-SORT）是建立在归并操作上的一种有效的排序算法,该算法是采用分治法（Divide and Conquer）的一个非常典型的应用。将已有序的子序列合并，得到完全有序的序列；即先使每个子序列有 序，再使子序列段间有序。若将两个有序表合并成一个有序表，称为二路归并。 归并排序</strong></p>\n<p>核心步骤：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/409b11fc280352b94999019532a04a6b.png\" alt=\"image-20220422210059119\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/982cc6fad502de29d4af238100569cdf.gif\" alt=\"查看源图像\"></p>\n<h4 id=\"_2-4-2-归并排序的实现\" tabindex=\"-1\"> 2.4.2 归并排序的实现</h4>\n<h5 id=\"_2-4-2-1-方法一-递归版\" tabindex=\"-1\"> 2.4.2.1 方法一：递归版</h5>\n<p>分解思路：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/c82035cdcc62be64dedd60a1668eddec.png\" alt=\"image-20220423161317000\"></p>\n<p>归并思路：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/4ac55bc76b4845fd6ccfeeca35191d92.png\" alt=\"image-20220423162141519\"></p>\n<p>代码：</p>\n<div><pre><code>//归并排序\nvoid _MergeSort(int* a, int begin, int end,int*tmp)//辅助函数\n{\n\tif (begin &gt;= end)\n\t{\n\t\treturn;\n\t}\n\tint mid = (begin + end) / 2;\n\t//[begin,mid][mid+1,end]\n\t_MergeSort(a, begin, mid, tmp);\n\t_MergeSort(a, mid + 1, end, tmp);\n\t//此处必须这样划分区间，如果划分为[begin,mid-1][mid,end]时就会出现死循环的现象,比如[1,2]\n\t//归并\n\tint begin1 = begin, end1 = mid;//begin1和end1用来控制第一个区间\n\tint begin2 = mid + 1, end2 = end;//begin2和end2用来控制第二个区间\n\tint index = begin;//下标每次都从begin位置开始\n\twhile (begin1 &lt;= end1 &amp;&amp; begin2 &lt;= end2)//当两个区间有一个区间到达最后时就停止\n\t{\n\t\tif (a[begin1] &lt; a[begin2])\n\t\t{\n\t\t\ttmp[index++] = a[begin1++];\n\t\t}\n\t\telse\n\t\t{\n\t\t\ttmp[index++] = a[begin2++];\n\t\t}\n\t}\n\twhile (begin1 &lt;= end1)//如果第一个区间没有结束就从第一个区间继续挪动数据\n\t{\n\t\ttmp[index++] = a[begin1++];\n\t}\n\twhile (begin2 &lt;= end2)//如果第二个区间没有结束就从第二个区间继续把挪动数据\n\t{\n\t\ttmp[index++] = a[begin2++];\n\t}\n\tmemcpy(a+begin, tmp+begin, (end - begin + 1) * sizeof(int));//运用内存拷贝函数\n}\nvoid MergeSort(int* a,int n)\n{\n\tint* tmp = (int*)malloc(sizeof(int) * n);//开辟临时数组空间\n\tassert(tmp);//防止开辟失败\n\t_MergeSort(a, 0, n - 1,tmp);\n\tfree(tmp);\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h5 id=\"_2-4-2-2-方法二-非递归版\" tabindex=\"-1\"> 2.4.2.2 方法二：非递归版</h5>\n<p>第一个版本：</p>\n<div><pre><code>void MergeSort(int* a, int n)\n{\n\tint* tmp = (int*)malloc(sizeof(int) * n);\n\tassert(tmp);\n\tint gap = 1;\n\twhile (gap&lt;n)\n\t{\n\t\tfor (int i = 0;i&lt;n;i+=2*gap)//为什么在gap前面有一个2，因为是两组数据进行归并\n\t\t{\n\t\t\tint begin1 = i, end1 = i + gap - 1;\n\t\t\tint begin2 = i+gap, end2 = i + 2 * gap - 1;\n\t\t\tint index = i;\n            //printf(&quot;[%d,%d] [%d,%d]\\n&quot;, begin1 , end1 , begin2 , end2);\n\t\t\twhile (begin1 &lt;= end1 &amp;&amp; begin2 &lt;= end2)\n\t\t\t{\n\t\t\t\tif (a[begin1] &lt; a[begin2])\n\t\t\t\t{\n\t\t\t\t\ttmp[index++] = a[begin1++];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttmp[index++] = a[begin2++];\n\t\t\t\t}\n\t\t\t}\n\t\t\twhile (begin1 &lt;= end1)\n\t\t\t{\n\t\t\t\ttmp[index++] = a[begin1++];\n\t\t\t}\n\t\t\twhile (begin2 &lt;= end2)\n\t\t\t{\n\t\t\t\ttmp[index++] = a[begin2++];\n\t\t\t}\n\t\t}\n\t\tmemcpy(a, tmp, n*sizeof(int));\n\t\tgap *= 2;\n\t}\n\tfree(tmp);\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>上面的代码经过打印，在测试非2的幂次方个数目的数组时程序就会出现问题，例如当我们测试10个数时看一下打印的下标：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2f5e6483ad4313ba5adaedf519b4a551.png\" alt=\"image-20220423185520974\"></p>\n<p>发生了越界（总共有10个数字，下标最大为9，所以程序出现了问题）</p>\n<p>下面将进行一次修正，将越界的下标数字强制修改为n-1，修正部分的代码如下所示：</p>\n<div><pre><code>if (end1 &gt;= n)\n{\n\tend1 = n - 1;\n}\nif (begin2 &gt;= n)\n{\n\tbegin2 = n - 1;\n}\nif (end2 &gt;= n)\n{\n\tend2 = n - 1;\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>修正后打印结果为：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/0c096d16fb242c92fbe5abb24b518524.png\" alt=\"image-20220423190011161\"></p>\n<p><strong>此时程序依旧不对，为什么？因为index会发生越界，当下标为[8,9]和[9,9]的时候，程序会在<code>while(begin1 &lt;= end1 &amp;&amp; begin2 &lt;= end2)</code>这个位置进入循环两次，然后此时index会变成10（最开始的index为8），然后后面因为<code>begin2==end2</code>会再次进入循环，此时的index就会出现越界访问的现象。</strong></p>\n<p>此处进行分析：如果end1越界，我们是可以修正的，如果end2越界，begin2没有越界，我们也是可以修正end2的，如果begin2越界了，那么第二个区间就会直接不存在，此时需要再对上面的代码进行修改。</p>\n<div><pre><code>if (end1 &gt;= n)\n{\n\tend1 = n - 1;\n}\nif (begin2 &gt;= n)\n{\n\tbegin2 = n;\n    end2 = n - 1;\n}\nif (end2 &gt;= n)\n{\n\tend2 = n - 1;\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>修改的部分就是：如果begin2越界，直接让[begin2,end2]这个区间不存在即可。</p>\n<p>完整代码如下所示：</p>\n<div><pre><code>void MergeSort(int* a, int n)\n{\n\tint* tmp = (int*)malloc(sizeof(int) * n);\n\tassert(tmp);\n\tint gap = 1;\n\twhile (gap&lt;n)\n\t{\n\t\tfor (int i = 0;i&lt;n;i+=2*gap)//为什么在gap前面有一个2，因为是两组数据进行归并\n\t\t{\n\t\t\tint begin1 = i, end1 = i + gap - 1;\n\t\t\tint begin2 = i+gap, end2 = i + 2 * gap - 1;\n\t\t\t//end1越界\n\t\t\tif (end1 &gt;= n)\n\t\t\t{\n\t\t\t\tend1 = n - 1;\n\t\t\t}\n\t\t\t//begin2越界\n\t\t\tif (begin2 &gt;= n)\n\t\t\t{\n\t\t\t\tbegin2 = n;\n\t\t\t\tend2 = n - 1;\n\t\t\t}\n\t\t\t//只有end2越界\n\t\t\tif (end2 &gt;= n)\n\t\t\t{\n\t\t\t\tend2 = n - 1;\n\t\t\t}\n\t\t\t\n\t\t\tint index = i;\n\t\t\t\n\t\t\twhile (begin1 &lt;= end1 &amp;&amp; begin2 &lt;= end2)\n\t\t\t{\n\t\t\t\tif (a[begin1] &lt; a[begin2])\n\t\t\t\t{\n\t\t\t\t\ttmp[index++] = a[begin1++];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttmp[index++] = a[begin2++];\n\t\t\t\t}\n\t\t\t}\n\t\t\twhile (begin1 &lt;= end1)\n\t\t\t{\n\t\t\t\ttmp[index++] = a[begin1++];\n\t\t\t}\n\t\t\t\n\t\t\twhile (begin2 &lt;= end2)\n\t\t\t{\n\t\t\t\ttmp[index++] = a[begin2++];\n\t\t\t}\n\t\t}\n\t\tmemcpy(a, tmp, n*sizeof(int));\n\t\tgap *= 2;\n\t}\n\tfree(tmp);\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_2-4-3-归并排序的外排序\" tabindex=\"-1\"> 2.4.3 归并排序的外排序</h4>\n<h5 id=\"_2-4-3-1-归并外排序的思想\" tabindex=\"-1\"> 2.4.3.1 归并外排序的思想</h5>\n<p><strong>思想：当所要排序的的数据量太多或者文件太大，无法直接在内存里排序，而需要依赖外部设备时，就会使用到外部排序。</strong></p>\n<blockquote>\n<p>算法描述：</p>\n<ol>\n<li>将所要排序的文件平均分割成若干个可以加载到内存中的小文件</li>\n<li>将每个小文件中的数据加载到内存中，使用快速排序法或者其它排序方法将每个小文件中的数据排成有序</li>\n<li>将内存中有序的数据重新写回到文件中，此时达到了文件中归并的先决条件</li>\n</ol>\n</blockquote>\n<ol>\n<li>\n<p>归并思路如下图所示：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/fd64f57d8edc5f293c35abcfd1fff68f.png\" alt=\"image-20220425150548589\"></p>\n<p>上图中的(1)和(2)和(3)和(4)分别是第一次归并、第二次归并、第三次归并和第四次归并，后面的没有再列举出来。</p>\n<p>注意：实际中的归并思路有很多种，并不是只有这一种，此处把这个思路列举出来只是为了后面的应用举例。</p>\n</li>\n</ol>\n<h4 id=\"_2-4-3-2-归并外排序的实现\" tabindex=\"-1\"> 2.4.3.2 归并外排序的实现</h4>\n<p>归并排序外排序函数代码：</p>\n<div><pre><code>//归并排序的文件排序\n//file1和file2是要被归并的文件，mfile是存放归并后的数据的文件\nvoid _MergeFile(const char*file1, const char*file2,const char* mfile)\n{\n    //将三个文件打开\n\tFILE* fout1 = fopen(file1, &quot;r&quot;);\n\tif (fout1 == NULL)\n\t{\n\t\tprintf(&quot;打开文件失败！\\n&quot;);\n\t\texit(-1);\n\t}\n\n\tFILE* fout2 = fopen(file2, &quot;r&quot;);\n\tif (fout2 == NULL)\n\t{\n\t\tprintf(&quot;打开文件失败！\\n&quot;);\n\t\texit(-1);\n\t}\n\n\tFILE* fin = fopen(mfile, &quot;w&quot;);\n\tif (fin == NULL)\n\t{\n\t\tprintf(&quot;打开文件失败！\\n&quot;);\n\t\texit(-1);\n\t}\n\t//开始归并\n\tint num1, num2;//存储file1和file2中读取的数据\n    //先从文件中读取出一个数据，ret1是为了判断是否读取结束，如果等于EOF就说明已经读取结束\n\tint ret1 = fscanf(fout1, &quot;%d\\n&quot;, &amp;num1);\n\tint ret2 = fscanf(fout2, &quot;%d\\n&quot;, &amp;num2);\n    //存放新的数据\n\twhile (ret1!= EOF &amp;&amp; ret2 != EOF)//当有一个文件读取结束时读取就结束\n\t{\n        //此处是因为要排升序，所以将小的数据读入新的文件中\n\t\tif (num1 &lt; num2)\n\t\t{\n\t\t\tfprintf(fin, &quot;%d\\n&quot;, num1);//将小的数据num1读入新的文件中\n\t\t\tret1 = fscanf(fout1, &quot;%d\\n&quot;, &amp;num1);//重新读入新的数据\n\t\t}\n\t\telse\n\t\t{\n\t\t\tfprintf(fin, &quot;%d\\n&quot;, num2);//同上\n\t\t\tret2 = fscanf(fout2, &quot;%d\\n&quot;, &amp;num2);\n\t\t}\n\t}\n    //如果存在未读取完的文件，将剩余的数据读取到新的文件mfile中\n\twhile (ret1!=EOF)\n\t{\n\t\tfprintf(fin, &quot;%d\\n&quot;, num1);\n\t\tret1 = fscanf(fout1, &quot;%d\\n&quot;, &amp;num1);\n\t}\n\twhile (ret2!=EOF)\n\t{\n\t\tfprintf(fin, &quot;%d\\n&quot;, num2);\n\t\tret2 = fscanf(fout1, &quot;%d\\n&quot;, &amp;num2);\n\t}\n\tfclose(fout1);\n\tfclose(fout2);\n\tfclose(fin);\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_2-4-3-3-归并外排序使用举例\" tabindex=\"-1\"> 2.4.3.3 归并外排序使用举例</h4>\n<p>这个例子中有文件file，此文件中总共是有100个数据，我们是要将它分成10组，每组数据有10个数据，每个数据放在一个文件中，文件名从<code>1到10</code>，然后存放新文件的名字最开始是<code>12</code>，表示这个文件要存放文件1和2归并后的数据，同理，后面的123就是存放文件12和3归并后的数据。</p>\n<p>代码实现：</p>\n<div><pre><code>void MergeSortFile(const char* file)//此处的file是要被排序的文件\n{\n\tFILE* fout = fopen(file, &quot;r&quot;);\n\tif (fout == NULL)\n\t{\n\t\tprintf(&quot;打开文件失败！\\n&quot;);\n\t\texit(-1);\n\t}\n\t//分割成一段一段数据，内存排序后写到小文件\n\tint n = 10;\n\tint a[10];\n\tint i = 0;\n\tint num = 0;\n\tchar subfile[20] = { 0 };\n\tint filei = 1;\n\twhile (fscanf(fout, &quot;%d\\n&quot;, &amp;num) != EOF)\n\t{\n\t\tif (i &lt; n-1)//前9个数据进去\n\t\t{\n\t\t\ta[i++] = num;\n\t\t}\n\t\telse\n\t\t{\n\t\t\ta[i] = num;//这是第10个数据\n\t\t\tQuickSort(a, 0, n - 1);\n\t\t\tsprintf(subfile, &quot;%d&quot;, filei++);\n\t\t\tFILE* fin = fopen(subfile, &quot;w&quot;);\n\t\t\tif (fin == NULL)\n\t\t\t{\n\t\t\t\tprintf(&quot;打开文件失败\\n&quot;);\n\t\t\t\texit(-1);\n\t\t\t}\n\t\t\tfor (int i = 0; i &lt; n; i++)\n\t\t\t{\n\t\t\t\tfprintf(fin, &quot;%d\\n&quot;, a[i]);\n\t\t\t}\n\t\t\tfclose(fin);\n\t\t\ti = 0;\n\t\t\tmemset(a, 0, sizeof(int)*n);\n\t\t}\n\t}\n\t//利用互相归并到文件，实现整体有序\n\t//····\n\tchar mfile[100] = &quot;12&quot;;\n\tchar file1[100] = &quot;1&quot;;\n\tchar file2[100] = &quot;2&quot;;\n\tfor (int i = 2; i &lt;= n; i++)\n\t{\n\t\t//读取file1和file2，进行归并出mfile\n\t\t_MergeFile(file1, file2, mfile);//将file1和file2进行归并到mfile中\t\n\t\tstrcpy(file1, mfile);//此处将mfile的名字复制给file1\n\t\tsprintf(file2, &quot;%d&quot;, i+1);\n\t\tsprintf(mfile, &quot;%s%d&quot;, mfile,i + 1);\n\t}\n\tfclose(fout);\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_2-4-4-归并排序的特性总结\" tabindex=\"-1\"> 2.4.4 归并排序的特性总结</h4>\n<ol>\n<li>归并的缺点在于需要O(N)的空间复杂度，归并排序的思考更多的是解决在磁盘中的外排序问题。</li>\n<li>时间复杂度：O(N*logN)\n如何理解归并排序的时间复杂度？\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/57c171c5539166024671fba819d5533b.png\" alt=\"image-20220423205120424\"></li>\n<li>空间复杂度：O(N)\n注意：实际上应该是O(N + log2N)（N是开辟的数组的空间，log2N是开辟栈帧的层数（递归版本，非递归就没有），log2N太小，可以看成是常数，几乎忽略不计，所以就是O(N)）</li>\n<li>稳定性：稳定</li>\n</ol>\n<h3 id=\"_2-5-七大排序性能测试比较\" tabindex=\"-1\"> 2.5 七大排序性能测试比较</h3>\n<h4 id=\"_2-5-1-测试比较代码\" tabindex=\"-1\"> 2.5.1 测试比较代码</h4>\n<p>代码：</p>\n<div><pre><code>// 测试排序的性能对比\nvoid TestOP()\n{\n\tsrand((unsigned)time(0));\n\tconst int N = 100000;\n\tint* a1 = (int*)malloc(sizeof(int) * N);\n\tint* a2 = (int*)malloc(sizeof(int) * N);\n\tint* a3 = (int*)malloc(sizeof(int) * N);\n\tint* a4 = (int*)malloc(sizeof(int) * N);\n\tint* a5 = (int*)malloc(sizeof(int) * N);\n\tint* a6 = (int*)malloc(sizeof(int) * N);\n\tint* a7 = (int*)malloc(sizeof(int) * N);\n\tassert(a1);\n\tassert(a2);\n\tassert(a3);\n\tassert(a4);\n\tassert(a5);\n\tassert(a6);\n\tassert(a7);\n\n\tfor (int i = 0; i&lt;N; i++)\n\t{\n\t\ta1[i] = rand();\n\t\ta1[i] = N-i;\n\t\ta2[i] = a1[i];\n\t\ta3[i] = a1[i];\n\t\ta4[i] = a1[i];\n\t\ta5[i] = a1[i];\n\t\ta6[i] = a1[i];\n\t\ta7[i] = a1[i];\n\t}\n\tint begin1 = clock();\n\tInsertSort(a1, N);\n\tint end1 = clock();\n\tint begin2 = clock();\n\tShellSort(a2, N);\n\tint end2 = clock();\n\tint begin3 = clock();\n\tSelectSort(a3, N);\n\tint end3 = clock();\n\tint begin4 = clock();\n\tHeapSort(a4, N);\n\tint end4 = clock();\n\tint begin5 = clock();\n\tQuickSort(a5, 0, N - 1);\n\tint end5 = clock();\n\tint begin6 = clock();\n\tMergeSort(a6, N);\n\tint end6 = clock();\n\tint begin7 = clock();\n\tBubbleSort(a7, N);\n\tint end7 = clock();\n\tprintf(&quot;InsertSort:%d\\n&quot;, end1 - begin1);\n\tprintf(&quot;ShellSort:%d\\n&quot;, end2 - begin2);\n\tprintf(&quot;SelectSort:%d\\n&quot;, end3 - begin3);\n\tprintf(&quot;HeapSort:%d\\n&quot;, end4 - begin4);\n\tprintf(&quot;QuickSort:%d\\n&quot;, end5 - begin5);\n\tprintf(&quot;MergeSort:%d\\n&quot;, end6 - begin6);\n\tprintf(&quot;BubbleSort:%d\\n&quot;, end7 - begin7);\n\n\tfree(a1);\n\tfree(a2);\n\tfree(a3);\n\tfree(a4);\n\tfree(a5);\n\tfree(a6);\n\tfree(a7);\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_2-5-2-测试比较结果\" tabindex=\"-1\"> 2.5.2 测试比较结果</h4>\n<p>注意：在VS2019release版本下进行测试，此时编译器进行了一系列优化。</p>\n<p>当N为10000时：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/272d7fcd1c7f55637c2cdbcb574d25f2.png\" alt=\"image-20220423221717247\"></p>\n<p>当N为100000时：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/84905c3c406f63c1d0094334b37d5394.png\" alt=\"image-20220423221808048\"></p>\n<p>此时继续进行测试快速排序、堆排序、希尔排序、归并排序：</p>\n<p>当N为1000000：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/e793df554c6fe4802b1d8760d8b8a427.png\" alt=\"image-20220423221907517\"></p>\n<p>当N为10000000：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/45545554598f0000996cfaba74b5f33e.png\" alt=\"image-20220423221948756\"></p>\n<p>当N为20000000：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/e466a1ec3265678865ceea33d613a66e.png\" alt=\"image-20220423222352147\"></p>\n<h3 id=\"_2-6-非比较排序\" tabindex=\"-1\"> 2.6 非比较排序</h3>\n<h4 id=\"_2-6-1-计数排序\" tabindex=\"-1\"> 2.6.1 计数排序</h4>\n<h5 id=\"_2-6-1-1-计数排序的思想\" tabindex=\"-1\"> 2.6.1.1 计数排序的思想</h5>\n<p>思想：计数排序又称为鸽巢原理，是对哈希直接定址法的变形应用。 操作步骤：</p>\n<ol>\n<li>统计相同元素出现次数</li>\n<li>根据统计的结果将序列回收到原来的序列中</li>\n</ol>\n<p>图示：\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/8ff0ea2f54b5a345787eb2ac52513ed3.png\" alt=\"image-20220424121029857\"></p>\n<p>代码：</p>\n<div><pre><code>void CountSort(int* a,int n)\n{\n\t//求出最大值和最小值\n\tint max = a[0];\n\tint min = a[0];\n\tfor (int i = 1; i &lt; n; i++)\n\t{\n\t\tif (a[i] &gt; max)\n\t\t{\n\t\t\tmax = a[i];\n\t\t}\n\t\tif (a[i] &lt; min)\n\t\t{\n\t\t\tmin = a[i];\n\t\t}\n\t}\n\tint size = max - min + 1;//映射表数组的大小\n\t//建立映射数组\n\tint* countArray = (int*)calloc(size,sizeof(int));\n\tassert(countArray);\n\t//计数\n\tfor (int i = 0; i &lt; n; i++)\n\t{\n\t\tcountArray[a[i] - min]++;\n\t}\n\t//放回到原来的数组中：排序\n\tint j = 0;//j用来记录原来数组的下标\n\tfor (int i = 0; i &lt; size; i++)//i用来记录映射表数组元素的小标\n\t{\n\t\twhile(countArray[i]--)\n\t\t{\n\t\t\ta[j++] = i + min;\n\t\t}\n\t}\n}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h5 id=\"_2-6-1-2-计数排序的复杂度\" tabindex=\"-1\"> 2.6.1.2 计数排序的复杂度</h5>\n<blockquote>\n<p>时间复杂度：O(N + range)</p>\n<p>空间复杂度：O(range)</p>\n</blockquote>\n<p><strong>注意：range = max - min +1</strong></p>\n<p>说明：计数排序适用于范围集中的数据</p>\n<p>注意：计数排序支持负数但是不支持浮点数、字符串等。</p>\n<h2 id=\"_3-排序算法复杂度及稳定性分析\" tabindex=\"-1\"> 3.排序算法复杂度及稳定性分析</h2>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/06054fbb0eb0066e3dc1bbb5aff69b55.png\" alt=\"image-20220424150445356\"></p>\n<p>稳定性分析：</p>\n<p>直接插入排序：稳定。</p>\n<p>希尔排序：不稳定。<strong>相同的数可能被分配到不同的gap组中。</strong></p>\n<p>选择排序：不稳定。如下图所示：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/e715fdf6491b319305f1d9e11e4a008e.png\" alt=\"image-20220424150957648\"></p>\n<p>在上图中，选出最小的数字1，和前面的3交换之后两个3的相对位置就发生了交换，说明选择排序是不稳定的。</p>\n<p>堆排序：不稳定。如下图所示：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/7382f7031da7b403a9057df9f74a81d3.png\" alt=\"image-20220424151402859\"></p>\n<p>此时是一个大堆，我们想要得到的是升序的数据，此时如果将8和4进行交换后，此时两个8的相对位置就发生了改变，所以堆排序不具有稳定性。</p>\n<p>冒泡排序：稳定。</p>\n<p>快速排序：不稳定。因为最终keyi要放到中间去。</p>\n<p>归并排序：稳定。因为在归并的时候，左边的先下就始终是稳定的。</p>\n<p>图表总结：</p>\n<table>\n<thead>\n<tr>\n<th>排序方法</th>\n<th>平均情况</th>\n<th>最好情况</th>\n<th>最坏情况</th>\n<th>辅助空间</th>\n<th>稳定性</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>冒泡排序</td>\n<td>O(n2)</td>\n<td>O(n2)</td>\n<td>O(n2)</td>\n<td>O(1)</td>\n<td>稳定</td>\n</tr>\n<tr>\n<td>简单选择排序</td>\n<td>O(n2)</td>\n<td>O(n2)</td>\n<td>O(n2)</td>\n<td>O(1)</td>\n<td>不稳定</td>\n</tr>\n<tr>\n<td>直接插入排序</td>\n<td>O(n2)</td>\n<td>O(n)</td>\n<td>O(n2)</td>\n<td>O(1)</td>\n<td>稳定</td>\n</tr>\n<tr>\n<td>希尔排序</td>\n<td>O(nlog2n)~O(n2)</td>\n<td>O(n1.3)</td>\n<td>O(n2)</td>\n<td>O(1)</td>\n<td>不稳定</td>\n</tr>\n<tr>\n<td>堆排序</td>\n<td>O(nlog2n)</td>\n<td>O(nlog2n)</td>\n<td>O(nlog2n)</td>\n<td>O(1)</td>\n<td>不稳定</td>\n</tr>\n<tr>\n<td>归并排序</td>\n<td>O(nlog2n)</td>\n<td>O(nlog2n)</td>\n<td>O(nlog2n)</td>\n<td>O(n)</td>\n<td>稳定</td>\n</tr>\n<tr>\n<td>快速排序</td>\n<td>O(nlog2n)</td>\n<td>O(nlog2n)</td>\n<td>O(n2)</td>\n<td>O(log2n)~O(n)</td>\n<td>不稳定</td>\n</tr>\n</tbody>\n</table>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/6341d7a797684a31ae2e6f567c9057fd.png",
      "date_published": "2022-06-15T00:00:00.000Z",
      "date_modified": "2022-05-30T04:24:37.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "algorithm"
      ]
    },
    {
      "title": "图片防盗链的破解和反破解",
      "url": "https://blog.ciberviler.top/other/%E5%9B%BE%E7%89%87%E9%98%B2%E7%9B%97%E9%93%BE%E7%9A%84%E7%A0%B4%E8%A7%A3%E5%92%8C%E5%8F%8D%E7%A0%B4%E8%A7%A3.html",
      "id": "https://blog.ciberviler.top/other/%E5%9B%BE%E7%89%87%E9%98%B2%E7%9B%97%E9%93%BE%E7%9A%84%E7%A0%B4%E8%A7%A3%E5%92%8C%E5%8F%8D%E7%A0%B4%E8%A7%A3.html",
      "content_html": "<h1 id=\"图片防盗链的破解和反破解\" tabindex=\"-1\"> 图片防盗链的破解和反破解</h1>\n<h2 id=\"原理\" tabindex=\"-1\"> 原理</h2>\n<blockquote>\n<p>注：这里有个很有趣的就是 Referrer 和 Referer 的故事了感兴趣的自行去了解下</p>\n</blockquote>\n<p>我们先来了解了解防盗链的原理，<strong>在 http 协议中，如果从一个页面跳到另一个页面，header字段里面会带个 Referer。图片服务器通过检测 Referer 是否来自规定域名，来进行防盗链。</strong></p>\n<p>如果盗用网站是 <strong>https</strong> 的 协议，而图片链接是 http 的话，则从 https 向 http 发起的请求会因为安全性的规定，而不带 referer，从而实现防盗链的绕过。官方输出图片的时候，判断了来源(Referer)，就是从哪个网站访问这个图片，如果是你的网站去加载这个图片，那么 Referer 就是： <code>你的网站地址</code>；你的网址肯定没在官方的白名单内，( <code>当然作为可操作性极强的浏览器来说 referer 是完全可以伪造一个官方的 URL 这样也也就也可以饶过限制🚫</code>)所以就看不到图片了。</p>\n<p>因此，若不发送 Referer，也就是没有来源。那么官方那边，就认为是从浏览器直接访问的，所以就能加载正常的图片了。</p>\n<h2 id=\"目的\" tabindex=\"-1\"> 目的</h2>\n<p><strong>盗链</strong>是指在自己的页面上展示一些并不在自己服务器上的内容。通常的做法是通过技术手段获得它人服务器上的资源地址，绕过别人的资源展示页面，直接在自己的页面上向最终用户提供此内容。比较常见的是一些小站盗用大站的资源（ <code>图片、音乐、视频</code>），对于这些小站来说，通过盗链的方法可以减轻自己服务器的负担，因为真实的空间和流量均是来自别人的服务器。对大站造成的影响确实徒徒增加了服务器压力，用户还不是自己的😅</p>\n<p>于是乎防盗链就是防止这种行为的产生，实施防盗链系统后，因为屏蔽了那些盗链的间接资源请求，从而可以大大减轻服务器及带宽的压力，也正如此，越来越多的站点都开始实施防盗链技术。</p>\n<h2 id=\"实现\" tabindex=\"-1\"> 实现</h2>\n<blockquote>\n<p>nginx</p>\n</blockquote>\n<div><pre><code>location ~* \\.(gif|jpg|png|bmp)$ {        valid_referers none blocked *.ttlsa.com server_names ~\\.google\\. ~\\.baidu\\.;        if ($invalid_referer) {                return 403;        \n    }}\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>以上所有来至 <code>xxx.com</code>和域名中包含 <code>google</code>和 <code>baidu</code>的站点都可以访问到当前站点的图片,如果来源域名（白名单列表）不在这个列表中。</p>\n<p>那么 <code>$invalid_referer</code>等于 1，在if语句中返回一个 403 给用户，这样用户便会看到一个 403 的页面,如果使用下面的 <code>rewrite</code>，那么盗链的图片都会显示 403.jpg。</p>\n<blockquote>\n<p>apache</p>\n</blockquote>\n<p>在根目录下创建 <code>.htaccess</code> 文件</p>\n<div><pre><code>RewriteEngine OnRewriteCond %{HTTP_REFERER} !^$ [NC]RewriteCond %{HTTP_REFERER} !phpddt.com [NC]RewriteCond %{HTTP_REFERER} !google.com [NC]RewriteCond %{HTTP_REFERER} !baidu.com.com [NC]RewriteCond %{HTTP_REFERER} !feedburner.com [NC]RewriteCond %{HTTP_REFERER} !feedsky.com [NC]RewriteRule .*\\.(rar|zip)$ http://www.xxx.com/ [R,NC,L]\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>这段话也可写在 <code>Apache</code>配置文件当中</p>\n<p><code>.htaccess</code>文件将影响其所在的目录及其子目录。你可以将其放在根目录或项目的子目录</p>\n<p>上面这段代码也是很容易理解的：</p>\n<div><pre><code>RewriteCond %{HTTP_REFERER} !^$ [NC]\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>允许空的来源，即用户浏览器手动属于则允许访问文件。</p>\n<div><pre><code>RewriteCond %{HTTP_REFERER} !phpddt.com [NC]\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>允许站点自身访问，同理，后面还要允许百度，谷歌，和一些订阅源访问。</p>\n<div><pre><code>RewriteRule .*\\.(rar|zip)$ http://www.xxx.com/ [R,NC,L]\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>这里可以设置防止盗链的类型，如果盗链可以跳转到网站首页，本站没有做图片防盗链，如果你做图片防盗链可以设置被盗链的替代图片：</p>\n<div><pre><code>RewriteRule .*\\.(gif|jpg|png)$ http://xxx.com/logo.png [R,NC,L]\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h2 id=\"破解\" tabindex=\"-1\"> 破解</h2>\n<p>😄道高一尺魔高一丈既然知道原理那么就来看看一些常用的破解方案如果你有更好的记得给我留言。</p>\n<ol>\n<li>\n<p>如果盗用图片资源是 <code>http</code>协议那么盗用网址可以使用 https 去请求会因为安全性的规定，而不带 <code>referer</code>，从而实现防盗链的绕过。</p>\n</li>\n<li>\n<p>在 HTML 代码的 head 中添加一句</p>\n<div><pre><code>&lt;meta name=\"referrer\" content=\"no-referrer\" />\n</code></pre><div aria-hidden=\"true\"><div></div></div></div></li>\n</ol>\n<div><pre><code>&lt;img referrer=\"no-referrer|origin|unsafe-url\" src=\"{item.src}\"/>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><ol>\n<li><code>https://images.weserv.nl/?url=</code>${你的图片地址}``</li>\n</ol>\n<p>因为网址是国外的速度有点慢效果还行，目的就是返回一个不受限制的图片，但是 GIF 格式会返回jpg也就是没有了动画效果。</p>\n<ol start=\"5\">\n<li>利用 <code>iframe</code>伪造请求 <code>referer</code></li>\n</ol>\n<div><pre><code>function showImg( url ) {    var frameid = 'frameimg' + Math.random();    window.img = '&lt;img id=\"img\" src=\\''+url+'?'+Math.random()+'\\' />    &lt;script>window.onload = function() { parent.document.getElementById    (\\''+frameid+'\\').height = document.getElementById(\\'img\\').height    +\\'px\\'; }&lt;'+'/script>';    document.write('&lt;iframe id=\"'+frameid+'\" src=\"javascript:parent.img;    \" frameBorder=\"0\" scrolling=\"no\" width=\"100%\">&lt;/iframe>');}\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><ol start=\"6\">\n<li>前面也提到来可以服务端伪造请求头具体不同的语言自行搜索对应方案，这里就不一一列举了。</li>\n</ol>\n<h2 id=\"反破解\" tabindex=\"-1\"> 反破解</h2>\n<p>既然有破解就当然有常用的防御机制😄</p>\n<ol>\n<li>不允许 <code>referer</code>为空（不建议，因在某些开启隐私模式的浏览器中，或 https 页面引用下， <code>referer</code>是空的）</li>\n<li>地址变更（ <code>lighttpd</code>的是根据有效时间， <code>nginx</code>的根据是 <code>md5</code>，IP地址变化）</li>\n<li>登录校验（如必须登录网站帐号后才能访问）</li>\n</ol>\n<p>以下是防止网站被镜像，被 <code>iframe</code></p>\n<p><strong>1. 防止网站被镜像（被恶意解析和转发等）</strong></p>\n<p>现象：他人域名访问到的是我的网站解析的 ip 地址我的</p>\n<p>解决方法：</p>\n<p>http.ini里可以这样写</p>\n<div><pre><code>\"RewriteCond Host: !^www.web\\.cn$  RewriteRule (.*) http\\://www\\.web\\.cn$1 [I,RP]\"\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>.htaccess里可以这样写</p>\n<div><pre><code>“RewriteCond %{HTTP_HOST} !^www.web.cn$ [NC] RewriteRule ^(.*)$ http://www.web.cn/$1 [L,R=301]”\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>代码的意思非常简单：访问这个网站的域名如果不是 &quot;<a href=\"http://www.web.cn\" target=\"_blank\" rel=\"noopener noreferrer\">www.web.cn</a>&quot; 就自动跳转到 &quot;<a href=\"http://www.web.cn\" target=\"_blank\" rel=\"noopener noreferrer\">www.web.cn</a>&quot; 上。这样设置就不怕自己辛辛苦苦维护的网站被别人镜像了。</p>\n<p><strong>2. 防止网址被 iframe</strong></p>\n<p>代码：在页面底部或其它公用部位加入如下代码</p>\n<div><pre><code>&lt;script type=”text/javascript>    if(window!=parent)   window.top.location.href = window.location.href; &lt; /script>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>代码的意思也很简单，用js方法检测地址栏域名是不是当前网站绑定的域名，如果不是，则跳转到绑定的域名上来，这样就不怕网站被别人 <code>iframe</code>了。</p>\n",
      "date_published": "2022-06-14T00:00:00.000Z",
      "date_modified": "2022-05-30T04:24:29.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "E5 调用API续订服务：Microsoft 365 E5 Renew X",
      "url": "https://blog.ciberviler.top/other/Microsoft-365-E5-RenewX.html",
      "id": "https://blog.ciberviler.top/other/Microsoft-365-E5-RenewX.html",
      "content_html": "<h1 id=\"e5-调用api续订服务-microsoft-365-e5-renew-x\" tabindex=\"-1\"> E5 调用API续订服务：Microsoft 365 E5 Renew X</h1>\n<p>Microsoft 365 E5 Renew X是一款网页版的E5续订服务，其依赖网页浏览器呈现支持用户多端操作，完全将E5账户API调用托管在了服务器端因此用户无需电脑也可使用。</p>\n<h2 id=\"microsoft-365-e5-renew-x-由来\" tabindex=\"-1\"> Microsoft 365 E5 Renew X 由来</h2>\n<p>Microsoft 365 E5 Renew X为Microsoft 365 E5 Web的升级版，相对于旧版其增强了管理功能且更容易部署，API调用内核继承于续订桌面版软件Microsoft 365 E5 Renew Plus。</p>\n<h2 id=\"主要功能\" tabindex=\"-1\"> 主要功能</h2>\n<h3 id=\"用户端\" tabindex=\"-1\"> 用户端</h3>\n<ul>\n<li><strong>两种可选的调用权限</strong>：用户未登录作为守护程序调用(需要客户端密码)、程序以登录用户身份直接调用(需要账户密码)</li>\n<li><strong>API种类齐全</strong>：41/30个可选的Microsoft Graph REST API Beta中的API(未来可能会继续添加)</li>\n<li><strong>完全随机的API调用模式</strong>：从已选定的API序列中随机抽取一个或几个进行调用（个数和API随机）</li>\n<li><strong>完全随机的API调用时间间隔</strong>：随机区段1000s-2000s固定</li>\n<li><strong>完全随机的API内容(仅部分API支持)</strong>：发送邮件的内容随机 Onedirve上传文件的内容随机</li>\n<li><strong>邮件通知服务</strong>：支持设置通知邮箱，调用异常会通过邮件通知无需反复登录查看</li>\n</ul>\n<h3 id=\"部署端\" tabindex=\"-1\"> 部署端</h3>\n<ul>\n<li><strong>平台兼容性</strong>：<a href=\"http://xn--Asp-hb0er53o.Net\" target=\"_blank\" rel=\"noopener noreferrer\">使用Asp.Net</a> Core 作为跨平台框架增适用于 <strong>Windows|Linux|MacOS x64|x86|ARM64|ARM</strong></li>\n<li><strong>灵活部署</strong>：支持<strong>开放站点部署</strong>和<strong>私享部署</strong>，私享部署不再强制要求配置Https和OAuth</li>\n<li><strong>无需数据库</strong>：不需要后台数据库支持，前后台一体化程序</li>\n<li><strong>用户后台管理</strong>：可修改用户的E5账户数量，以及封删管理</li>\n<li><strong>系统状态监视</strong>：系统占用率一目了然，可控的站点注册通道更容易控制系统用户数量</li>\n<li><strong>自定义页面</strong>：支持自定义HTML静态页面，可设置支付宝、微信收款码</li>\n<li><strong>显示ICP备案</strong>：支持ICP备案文字显示，可在国内备案建站</li>\n<li><strong>无人值守 运行自动暂停</strong>：可自动暂停有错误率过高的账号API调用</li>\n<li><strong>无人值守 自动恢复运行</strong>：可定期自动恢复全部账号的API调用，防止因微软网络原因触发大量账号停止API调用进而导致的账号续期失败</li>\n</ul>\n<h1 id=\"用户端使用教程-请勿开启账号的双重验证功能\" tabindex=\"-1\"> 用户端使用教程**(请勿开启账号的双重验证功能)**</h1>\n<h2 id=\"可用站点\" tabindex=\"-1\"> 可用站点</h2>\n<h3 id=\"主站\" tabindex=\"-1\"> 主站</h3>\n<p><a href=\"https://e5.sundayrx.net/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>主站：https://e5.sundayrx.net（由 SundayRX 运营）(可登录不可注册)</strong></a></p>\n<p><a href=\"https://ms-e5-renew.leeskyler.top:11015/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>分站：https://ms-e5-renew.leeskyler.top:11015（由 leeskyler 运营）(已关停)</strong></a></p>\n<p><a href=\"https://ms-e5-renew-3.eastern.moe/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>分站：https://ms-e5-renew-3.eastern.moe（由 leeskyler 运营）(已关停)</strong></a></p>\n<h3 id=\"自建共享站点\" tabindex=\"-1\"> 自建共享站点</h3>\n<p><a href=\"https://ew.chirmyram.com/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>自建共享站：https://ew.chirmyram.com（由 七米蓝 运营）(可登录不可注册)</strong></a></p>\n<p><a href=\"https://e5.hm0420.cc/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>自建共享站：https://e5.hm0420.cc（由 小冰酱 运营）</strong></a></p>\n<p><a href=\"https://ms-e5.hm0420.cc/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>自建共享站：https://ms-e5.hm0420.cc（由 小冰酱 运营）</strong></a></p>\n<p><a href=\"https://e5.xzh.gs/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>自建共享站：https://e5.xzh.gs（由 XZH 运营）</strong></a></p>\n<p><a href=\"https://e5.tianli0.top/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>自建共享站：https://e5.tianli0.top（由 Tinali 运营）</strong></a></p>\n<p><a href=\"https://renew.lrize.xyz/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>自建共享站：https://renew.lrize.xyz（由 Lrize、 运营）</strong></a></p>\n<p><a href=\"https://e5zh.xyz/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>自建共享站：https://e5zh.xyz（由 z 运营）</strong></a></p>\n<h2 id=\"_1-注册azure应用程序\" tabindex=\"-1\"> 1 注册Azure应用程序</h2>\n<h3 id=\"_1-1-应用注册\" tabindex=\"-1\"> 1.1 应用注册</h3>\n<ol>\n<li><a href=\"https://portal.azure.com/#home\" target=\"_blank\" rel=\"noopener noreferrer\">点击登录 Azure</a>或<a href=\"https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade\" target=\"_blank\" rel=\"noopener noreferrer\">点击直接进入Azure应用注册</a>，登录账号使用申请到的Microsoft 365 E5的<strong>管理员账户</strong>（账户名类似XXXX@YYYY.onmicrosoft.com格式）。\n2.登录完成后点击右上角的“门户”按钮进入Azure管理中心，在搜索栏内输入“应用注册”，点击进入<a href=\"https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade\" target=\"_blank\" rel=\"noopener noreferrer\">（若应用注册搜索不到请点击此处直接进入）</a>。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200618170032256-165380585664583.png\" alt=\"图片\">\n3.单击“新注册”按钮\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2020061817051341-165380585814786.png\" alt=\"图片\">\n4.配置应用 应用名称随意写、注意可访问性选项选择最后一项、重定向URL暂时不填 、完成后点击注册\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200618170801323-165380585941389.png\" alt=\"图片\"></li>\n</ol>\n<h3 id=\"_1-2-配置应用重定向url-身份验证\" tabindex=\"-1\"> 1.2 配置应用重定向URL（身份验证）</h3>\n<p>1.先点击“概述”，然后点击“添加重定向URL”，进入重定向URL配置界面，<strong>下图中的应用程序(客户端)ID即为&quot;客户端ID&quot;</strong>。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2020061817121972-165380586091892.png\" alt=\"图片\">\n2.点击“添加平台”，再点击“移动和桌面应用程序”，\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200618171501396-165380586226995.png\" alt=\"图片\">\n3.继续勾选中第一个URL，最后点击底部的“配置”，该URL为“<a href=\"https://login.microsoftonline.com/common/oauth2/nativeclient%E2%80%9D%E4%B9%9F%E5%8F%AF%E6%89%8B%E5%8A%A8%E6%B7%BB%E5%8A%A0%E3%80%82\" target=\"_blank\" rel=\"noopener noreferrer\">https://login.microsoftonline.com/common/oauth2/nativeclient”也可手动添加。</a>\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200618171651338-165380586350298.png\" alt=\"图片\">\n4.配置默认客户端类型将应用程序视为公共客户端 点击切换按钮为“是” ，最后点击“保存”按钮保存。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200618171850779-1653805864822101.png\" alt=\"图片\"></p>\n<h2 id=\"_2-配置应用程序的api权限-重要\" tabindex=\"-1\"> 2 配置应用程序的API权限（重要）</h2>\n<p><strong>小白提示：建议选择“委托的权限(用户登录)”该权限类型，调用API较多，操作步骤较少简单粗暴，调用成功几率高</strong></p>\n<p>注册的应用程序API权限类型有两种，其主要区别如下表所示：</p>\n<table>\n<thead>\n<tr>\n<th>权限类型</th>\n<th><strong>委托的权限(用户登录)</strong></th>\n<th><strong>应用程序权限(非用户登录)</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>官方释义</td>\n<td>应用程序必须以登录用户身份访问API</td>\n<td>应用程序在用户未登录的情况下作为后台服务或守护程序运行</td>\n</tr>\n<tr>\n<td>需要的信息</td>\n<td>账户名称+账户密码+应用程序(客户端)ID</td>\n<td>账户名称+客户端机密+应用程序(客户端)ID</td>\n</tr>\n<tr>\n<td>功能影响</td>\n<td>程序中所有API均可调用</td>\n<td>部分API权限受限无法调用(官方限制)</td>\n</tr>\n<tr>\n<td>API权限配置</td>\n<td>可由PC版程序自动配置添加API权限</td>\n<td>必须手动配置API权限</td>\n</tr>\n<tr>\n<td>显示颜色标识</td>\n<td>蓝色</td>\n<td>深青色</td>\n</tr>\n</tbody>\n</table>\n<p><strong>以下是登录或非登录所需要的权限列表</strong>：\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20201102171130141.png\" alt=\"图片\"></p>\n<p>最后根据所选的API权限类型在：<strong>2.1 选择“委托的权限(用户登录)”类型的API</strong>或者<strong>2.2 选择“应用程序权限(非用户登录)”类型的API</strong>中选择性阅读。</p>\n<h3 id=\"_2-1-选择-委托的权限-用户登录-类型的api\" tabindex=\"-1\"> 2.1 选择“委托的权限(用户登录)”类型的API</h3>\n<h4 id=\"手动配置api权限\" tabindex=\"-1\"> 手动配置API权限</h4>\n<p>1.点击“API权限”-“添加权限”-“Microsoft Graph”\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2020061819283823-1653805868573106.png\" alt=\"图片\">\n2.选择“委托的权限”<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200618172538991-1653805869901109.png\" alt=\"图片\">\n3.根据编辑页面中列出的API权限需求表（注意在程序中切换为&quot;<strong>登录</strong>“）来勾选所对应的API权限，全部选择完成后点击&quot;添加权限”。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20201102171303292.png\" alt=\"图片\">\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200618172627969-1653805874862114.png\" alt=\"图片\">\n添加完成的效果如图\n<strong>如果没有“代表XXX授予管理员同意”按钮 说明该账号不是管理员账号 换登管理员账号创建应用</strong>\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20201112111140479.png\" alt=\"图片\"></p>\n<p>4.最后点击代表XXX授予管理员同意,对话框选择“是”（该图包含了当前程序“委托的权限(用户登录)”全部API所需要的权限）。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20201112110505347.png\" alt=\"图片\"></p>\n<h3 id=\"_2-2-选择-应用程序权限-非用户登录-类型的api\" tabindex=\"-1\"> 2.2 选择“应用程序权限(非用户登录)”类型的API</h3>\n<h4 id=\"_2-2-1-手动配置api权限\" tabindex=\"-1\"> 2.2.1 手动配置API权限</h4>\n<p>1.点击“API权限”-“添加权限”-“Microsoft Graph”\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2020061819283823-1653805879510121.png\" alt=\"图片\">\n2.选择“应用程序权限”\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200801120027971-1653805882870124.png\" alt=\"图片\">\n3.根据编辑页面中列出的API权限需求表（注意在程序中切换为&quot;<strong>非登录</strong>“）来勾选所对应的API权限，全部选择完成后点击&quot;添加权限”。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20201102171349129.png\" alt=\"图片\">\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200618172627969-1653805884862127.png\" alt=\"图片\">\n添加完成的效果如图\n<strong>如果没有“代表XXX授予管理员同意”按钮 说明该账号不是管理员账号 换登管理员账号创建应用</strong>\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200801120623311-1653805887894132.png\" alt=\"图片\">\n4.最后点击代表XXX授予管理员同意,对话框选择“是”（该图包含了当前程序“应用程序权限(非用户登录)”全部API所需要的权限）。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200801120818260-1653805889622135.png\" alt=\"图片\"></p>\n<h4 id=\"_2-2-2-创建客户端密码\" tabindex=\"-1\"> 2.2.2 创建客户端密码</h4>\n<p>1.点击“证书密码”-“新客户端密码”-“24个月”-“添加”\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210609101116972-1653805890998138.png\" alt=\"图片\">\n2.点击“值”该列中的“复制”（不要复制&quot;ID&quot;列中的值），并立即将该密码保存至电脑，<strong>保存的值即为“客户端密码”</strong>， 注：该值必须立即保存，退出该页面后将永远无法查看。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2020120711360840.jpeg\" alt=\"图片\"></p>\n<h2 id=\"_3-将账号api调用托管至服务\" tabindex=\"-1\"> 3 将账号API调用托管至服务</h2>\n<h5 id=\"创建一个新的e5子账户-可选步骤\" tabindex=\"-1\"> 创建一个新的E5子账户(可选步骤)</h5>\n<p>登入E5管理员账户进入管理员界面，创建一个新的子账户，使用这个子账户登录程序调用API。\n为什么建议这样做：Microsoft 365 E5 Renew中的部分API包含了写操作，例如邮件和Onedrive的API，这些API在随机模式下会生成大量垃圾邮件和文件（虽然单独为此设立了一个文件夹），部分人可能会对此行为非常介意，而且程序频繁的读写可能会对您正常使用账户造成影响，因此不建议使用管理员账户登录。</p>\n<h3 id=\"_3-1-进入网站注册并登录账户\" tabindex=\"-1\"> 3.1 进入网站注册并登录账户</h3>\n<p>从一开始的可用站点，选择站点进入（记住无论使用任何人运营网站显示内容都是基本相同的）</p>\n<p>从两种登录中任选一个，这里不建议选择GitHub登录（GitHub的第三方登录很迷经常性崩溃）</p>\n<p>第一次登录账户系统会显示注册成功，然后再登录一次即可登录进入系统\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3VuZGF5Ulg=,size_20,color_FFFFFF,t_70,g_se,x_16.png\" alt=\"请添加图片描述\"></p>\n<h3 id=\"_3-2-激活您的账户\" tabindex=\"-1\"> 3.2 激活您的账户</h3>\n<p>阅读并同意用户协议，点击激活账户\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAU3VuZGF5Ulg=,size_20,color_FFFFFF,t_70,g_se,x_16-1653805902079145.png\" alt=\"请添加图片描述\"></p>\n<h3 id=\"_3-3-添加一个e5账户的运行配置信息\" tabindex=\"-1\"> 3.3 添加一个E5账户的运行配置信息</h3>\n<p>在成功登录系统后，页面会自动跳转到“主页”页面，在“账户详情”页面点击“添加运行账号”按钮，前往“账户运行配置”页面\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2375b23f6de74f5e9d9ff37bca1e7dcc.png\" alt=\"请添加图片描述\"></p>\n<p>在账户运行配置页面中填写账户信息，且登录调用填写账户密码、非登录调用填写客户端密码，并选择自己选定的调用方式，注意调用方式不要选错了！！！ 最后点击“添加运行账号”按钮完成配置。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/eb5d982940a340719b4b5dbd1a46420c.png\" alt=\"请添加图片描述\">\n由于前后台数据同步需要时间，任何添加账户或者修改账户配置信息的操作都不会立即被后台执行。</p>\n<p>返回用户页面查看账户信息中的“配置同步状态”，如果显示为“正在运行”表明配置已经上传至后台，修改账户配置成功。\n<strong>警示：配置成功了也要定期来看看自己的账户是否在正常运行（虽然有邮件通知服务），但也建议每月查看一次账户状态！！！</strong><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/3b2651537fee45088202efd02cad6d74.png\" alt=\"请添加图片描述\"></p>\n<h3 id=\"_3-4-设置一个通知邮箱-可选\" tabindex=\"-1\"> 3.4 设置一个通知邮箱（可选）</h3>\n<p>在任何页面下 点击右上角“用户名-账户设置”，进入个人信息设置\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/8229363a593549bbb884960e65875673.png\" alt=\"请添加图片描述\">\n记住你的UID，出现任何问题请使用这个UID与你所选站点的管理员沟通\n编辑你的邮箱 并点击保存\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/fea87de6e5774a319c4b4a2e818d3341.png\" alt=\"请添加图片描述\"></p>\n<h1 id=\"部署端-请勿使用任何cookie缓存加速服务\" tabindex=\"-1\"> 部署端**(请勿使用任何Cookie缓存加速服务)**</h1>\n<h2 id=\"服务下载-作为站长务必注意查看主站中-关于-页面中的程序发布时间-及时更新服务程序\" tabindex=\"-1\"> 服务下载(作为站长务必注意查看<strong>主站</strong>中“<strong>关于</strong>”页面中的<strong>程序发布时间</strong>，及时更新服务程序)</h2>\n<h3 id=\"传统方式\" tabindex=\"-1\"> 传统方式</h3>\n<p><a href=\"https://sundayrx.lanzoui.com/aW09Lsss75g\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>下载服务程序源文件（https://sundayrx.lanzoui.com/aW09Lsss75g）</strong></a></p>\n<p><a href=\"https://docs-1.leeskyler.top/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>参阅 Skyler的部署帮助文档（https://docs-1.leeskyler.top）</strong></a>\n<a href=\"https://www.gladtbam.top/posts/37680/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>参阅 Gladtbam的部署帮助文档 （https://www.gladtbam.top/posts/37680）</strong></a></p>\n<h3 id=\"docker方式\" tabindex=\"-1\"> Docker方式</h3>\n<p><a href=\"https://blog.csdn.net/qq_40605167/article/details/122888580\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>参阅 韩韩的Docker版部署帮助文档（https://blog.csdn.net/qq_40605167/article/details/122888580）</strong></a>\n<a href=\"https://www.gladtbam.top/posts/22256/\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>参阅 Gladtbam的Docker版部署帮助文档（https://www.gladtbam.top/posts/22256/）</strong></a>\n<a href=\"https://www.bilibili.com/read/cv16338214\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>参阅 Curious的部署帮助文档 （https://www.bilibili.com/read/cv16338214）</strong></a></p>\n<h2 id=\"传统方式服务部署\" tabindex=\"-1\"> 传统方式服务部署</h2>\n<h3 id=\"安装运行环境\" tabindex=\"-1\"> 安装运行环境</h3>\n<p><em>以下示例可能不完全包含全部操作系统，但无论是哪种系统都要安装 <strong><a href=\"http://Asp.Net\" target=\"_blank\" rel=\"noopener noreferrer\">Asp.Net</a> Core 3.1 SDK</strong>支持包，服务程序运行依赖于这个包也只依赖这一个包，只要成功安装了<strong><a href=\"http://Asp.Net\" target=\"_blank\" rel=\"noopener noreferrer\">Asp.Net</a> Core 3.1 SDK</strong>支持包，服务程序就可以正常运行！</em>\n详情请参阅<a href=\"https://docs.microsoft.com/zh-cn/dotnet/core/install/\" target=\"_blank\" rel=\"noopener noreferrer\">在 Windows、Linux 和 macOS 上安装 .NET</a></p>\n<h4 id=\"windows\" tabindex=\"-1\"> Windows</h4>\n<p>前往<a href=\"https://dotnet.microsoft.com/download/dotnet/3.1%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85**%E6%9C%80%E6%96%B0%E7%9A%84Asp.Net\" target=\"_blank\" rel=\"noopener noreferrer\">https://dotnet.microsoft.com/download/dotnet/3.1下载安装**最新的Asp.Net</a> Core 3.1 SDK** 安装包</p>\n<h4 id=\"ubuntu\" tabindex=\"-1\"> Ubuntu</h4>\n<p>详情请参阅<a href=\"https://docs.microsoft.com/zh-cn/dotnet/core/install/linux-ubuntu\" target=\"_blank\" rel=\"noopener noreferrer\">在 Ubuntu 上安装 .NET SDK 或 .NET 运行时</a></p>\n<p><strong>Ubuntu 21.04</strong></p>\n<div><pre><code><span>wget</span> https://packages.microsoft.com/config/ubuntu/21.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb\n<span>sudo</span> dpkg -i packages-microsoft-prod.deb\n<span>rm</span> packages-microsoft-prod.deb\n<span>123</span>\n<span>sudo</span> <span>apt-get</span> update<span>;</span> <span>\\</span>\n  <span>sudo</span> <span>apt-get</span> <span>install</span> -y apt-transport-https <span>&amp;&amp;</span> <span>\\</span>\n  <span>sudo</span> <span>apt-get</span> update <span>&amp;&amp;</span> <span>\\</span>\n  <span>sudo</span> <span>apt-get</span> <span>install</span> -y aspnetcore-runtime-3.1\n<span>1234</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"centos\" tabindex=\"-1\"> CentOS</h4>\n<p>详情请参阅<a href=\"https://docs.microsoft.com/zh-cn/dotnet/core/install/linux-centos\" target=\"_blank\" rel=\"noopener noreferrer\">在 CentOS 上安装 .NET SDK 或 .NET 运行时</a></p>\n<p><strong>CentOS 8</strong>\n<code>sudo dnf install dotnet-sdk-3.1</code>\n<strong>CentOS 7</strong>\n<code>sudo rpm -Uvh https://packages.microsoft.com/config/centos/7/packages-microsoft-prod.rpm</code>\n<code>sudo yum install dotnet-sdk-3.1</code></p>\n<h4 id=\"macos\" tabindex=\"-1\"> MacOS</h4>\n<p>前往<a href=\"https://dotnet.microsoft.com/download/dotnet/3.1%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85**%E6%9C%80%E6%96%B0%E7%9A%84Asp.Net\" target=\"_blank\" rel=\"noopener noreferrer\">https://dotnet.microsoft.com/download/dotnet/3.1下载安装**最新的Asp.Net</a> Core 3.1 SDK** 安装包</p>\n<h3 id=\"填写配置信息\" tabindex=\"-1\"> 填写配置信息</h3>\n<p>*<strong>站点拥有开放和私用两种模式，请根据自己的部署目的来选择对应的教程来阅读！*\n*配置文件是Deploy/Config.xml 务必打开并修改默认的管理员登录密码*</strong></p>\n<h4 id=\"开放站点\" tabindex=\"-1\"> 开放站点</h4>\n<p><em>开放站点必须使用全链路HTTPS，即便是使用了Nginx反向代理也必须设置HTTPS为启用状态</em></p>\n<p><strong>Configuration.ShareSite.Enable</strong>设置为true</p>\n<h5 id=\"https-ssl证书\" tabindex=\"-1\"> HTTPS SSL证书</h5>\n<h6 id=\"方式1-服务程序kestrel—-https-—外部internet\" tabindex=\"-1\"> 方式1：服务程序Kestrel—(HTTPS)—外部Internet</h6>\n<p><em>准备一个PFX格式的SSL证书文件，放置在Deploy文件夹中</em></p>\n<p><strong>Configuration.HTTPS.Enable</strong>设置为true\n<strong>Configuration.HTTPS.Certificate</strong>设置为PFX文件的名称带后缀名\n<strong>Configuration.HTTPS.Password</strong>设置为PFX文件的密码</p>\n<h6 id=\"方式2-服务程序kestrel—-https-localhost-—nginx-iis-apache—-https-外部访问域名-—外部internet\" tabindex=\"-1\"> 方式2：服务程序Kestrel—(HTTPS localhost)—Nginx/IIS/Apache—(HTTPS 外部访问域名)—外部Internet</h6>\n<p><em>反向代理服务器部分请自行配置</em></p>\n<p>执行下列两个命令 以创建localhsot HTTPS证书 该证书时效为1年\n<code>dotnet dev-certs https --clean</code>\n<code>dotnet dev-certs https --trust</code></p>\n<p><strong>Configuration.HTTPS.Enable</strong>设置为true\n<strong>Configuration.HTTPS.Certificate</strong>设置为空（什么都不要填）\n<strong>Configuration.HTTPS.Password</strong>设置为空（什么都不要填）</p>\n<h5 id=\"microsoft-oauth\" tabindex=\"-1\"> Microsoft OAuth</h5>\n<h5 id=\"github-oauth\" tabindex=\"-1\"> Github OAuth</h5>\n<h5 id=\"smtp邮件服务\" tabindex=\"-1\"> SMTP邮件服务</h5>\n<p><em>准备一个可以使用SMTP服务发信的邮箱</em></p>\n<p><strong>Configuration.ShareSite.SMTP.Email</strong>设置为 发件人邮箱地址\n<strong>Configuration.ShareSite.SMTP.Password</strong>设置为 邮箱密钥\n<strong>Configuration.ShareSite.SMTP.Host</strong>设置为 发件人邮箱的SMTP服务器地址 (<a href=\"http://xn--Outlooksmtp-n68qh3ew6ck78eimyb.office365.com\" target=\"_blank\" rel=\"noopener noreferrer\">以Outlook为例子是smtp.office365.com</a>)</p>\n<h4 id=\"私用\" tabindex=\"-1\"> 私用</h4>\n<p><em>在私用模式下不用准备任何配置信息，填写好登录密码端口即可使用！</em></p>\n<h5 id=\"启用https-选配\" tabindex=\"-1\"> 启用HTTPS（选配）</h5>\n<p><em>若要启用HTTPS请在下面选择一种合适的方式来实现</em></p>\n<h6 id=\"方式1-服务程序kestrel—-https-—外部internet-1\" tabindex=\"-1\"> 方式1：服务程序Kestrel—(HTTPS)—外部Internet</h6>\n<p><em>准备一个PFX格式的SSL证书文件，放置在Deploy文件夹中</em></p>\n<p><strong>Configuration.HTTPS.Enable</strong>设置为true\n<strong>Configuration.HTTPS.Certificate</strong>设置为PFX文件的名称带后缀名\n<strong>Configuration.HTTPS.Password</strong>设置为PFX文件的密码</p>\n<h6 id=\"方式2-服务程序kestrel—-http-—nginx-iis-apache—-https-外部访问域名-—外部internet\" tabindex=\"-1\"> 方式2：服务程序Kestrel—(HTTP)—Nginx/IIS/Apache—(HTTPS 外部访问域名)—外部Internet</h6>\n<p><em>反向代理服务器部分请自行配置</em></p>\n<p><strong>Configuration.HTTPS.Enable</strong>设置为false</p>\n<h3 id=\"启动服务程序\" tabindex=\"-1\"> 启动服务程序</h3>\n<p>在任何系统下，打开命令行定位到程序目录 运行<code>dotnet Microsoft365_E5_Renew_X.dll</code>命令即可启动</p>\n<h3 id=\"管理员登录\" tabindex=\"-1\"> 管理员登录</h3>\n<h4 id=\"非oauth后台登录-开放或私享部署皆可用\" tabindex=\"-1\"> 非OAuth后台登录（开放或私享部署皆可用）</h4>\n<p>管理员登录路由 <code>/Admin/Login</code> 默认密码在配置文件Deploy/Config.xml中更改</p>\n<h4 id=\"oauth认证登录-仅开放部署可用\" tabindex=\"-1\"> OAuth认证登录（仅开放部署可用）</h4>\n<h5 id=\"设置管理员oauth登录的oauthid\" tabindex=\"-1\"> 设置管理员OAuth登录的OAuthID</h5>\n<p>使用想要关联的OAuth账号（Microsoft/Github）在任意站点登录/注册均可看到此账号的OAuthID,记录此ID</p>\n<p>通过管理员密码登录自己的站点：管理员功能-用户列表 找到管理员账户 点击“编辑”按钮填写记录的OAuthID 保存</p>\n<p>直接在主登录页面使用与管理员账户关联的OAuth账号登录即可</p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200618170032256-165380585664583.png",
      "date_published": "2022-06-12T00:00:00.000Z",
      "date_modified": "2022-05-29T06:33:39.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "E5 调用API续订程序：Microsoft 365 E5 Renew Plus",
      "url": "https://blog.ciberviler.top/other/Microsoft-365-E5-RenewPlus.html",
      "id": "https://blog.ciberviler.top/other/Microsoft-365-E5-RenewPlus.html",
      "content_html": "<h1 id=\"e5-调用api续订程序-microsoft-365-e5-renew-plus\" tabindex=\"-1\"> E5 调用API续订程序：Microsoft 365 E5 Renew Plus</h1>\n<h2 id=\"microsoft-365-e5-renew-plus的由来\" tabindex=\"-1\"> Microsoft 365 E5 Renew Plus的由来</h2>\n<p>Microsoft 365 E5 Renew Plus为Microsoft 365 E5 Renew的升级版，其功能性，易用性，美观程度上都要强于旧版。</p>\n<h2 id=\"主要功能\" tabindex=\"-1\"> 主要功能</h2>\n<ul>\n<li><strong>支持开机自启动后台调用</strong>：使用简单方便，无需购买服务器部署，本地应用程序即开即用</li>\n<li><strong>两种可选的调用权限</strong>：用户未登录作为守护程序调用(需要客户端密码)、程序以登录用户身份直接调用(需要账户密码)</li>\n<li><strong>自动配置API权限</strong>：登录调用的API权限支持由程序自动配置</li>\n<li><strong>API种类齐全</strong>：43个可选的Microsoft Graph REST API Beta中的API(未来可能会继续添加)</li>\n<li><strong>完全随机的API选用模式</strong>：从已选定的API序列中随机抽取一个或几个进行调用（个数和API随机）</li>\n<li><strong>完全随机的API调用顺序</strong>：每轮API的调用先后顺序随机</li>\n<li><strong>完全随机的API内容(仅部分API支持)</strong>：POST写类型的API的上传内容随机</li>\n<li><strong>完全随机的API调用时间间隔</strong>：随机区段500s-86400s自定义</li>\n<li><strong>每日工作时间自定义</strong>：在日常工作时间进行调用，适用于从不关机重启的服务器设备</li>\n<li><strong>每周工作日自定义</strong>：在每周的工作日进行调用，适用于从不关机重启的服务器设备</li>\n<li><strong>运行智能暂停</strong>：防止因持续在错误配置下运行而导致的账户封禁</li>\n<li><strong>运行配置自动保存</strong>：可保存运行配置，无需反复设置</li>\n<li><strong>无限制账号个数</strong>：理论上允许无限制个数账号后台自动调用</li>\n<li><strong>支持自定义客户端密钥</strong>：允许非登录调用使用自定义密钥</li>\n<li><strong>自定义美化界面</strong>：支持自定义背景图片（半透明度以及毛玻璃效果）、亚克力背景</li>\n</ul>\n<h2 id=\"主界面\" tabindex=\"-1\"> 主界面</h2>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/b23cb7e4945747fca6e88b5c36e80e08.png\" alt=\"图片\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/185cfc81a55746eb8d915e6f0923d1ca.png\" alt=\"图片\"></p>\n<h2 id=\"运行结果查看\" tabindex=\"-1\"> 运行结果查看</h2>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210323150719810.png\" alt=\"图片\"></p>\n<h1 id=\"入群须知\" tabindex=\"-1\"> <strong>入群须知</strong></h1>\n<ul>\n<li><strong>使用本系列产品只是增加E5续订概率，并不能保证100%续订成功</strong></li>\n<li><strong>续订操作有些许技术门槛，且需要具备一定的自学能力</strong></li>\n<li><strong>每个人的时间都是宝贵的，遇到问题先查阅<a href=\"https://sundayrx.coding.net/s/78f69c8a-8620-4d53-bad2-c4b365fed1a0\" target=\"_blank\" rel=\"noopener noreferrer\">帮助文档</a>，实在无法解决时再发起提问(<a href=\"https://sundayrx.coding.net/s/78f69c8a-8620-4d53-bad2-c4b365fed1a0/4\" target=\"_blank\" rel=\"noopener noreferrer\">提问的艺术</a>)</strong></li>\n</ul>\n<h4 id=\"qq交流群-254058945\" tabindex=\"-1\"> <strong>QQ交流群：254058945</strong></h4>\n<h4 id=\"tg交流群-https-t-me-ms365e5renew\" tabindex=\"-1\"> <strong>TG交流群：<a href=\"https://t.me/MS365E5Renew\" target=\"_blank\" rel=\"noopener noreferrer\">https://t.me/MS365E5Renew</a></strong></h4>\n<h1 id=\"软件下载\" tabindex=\"-1\"> 软件下载</h1>\n<h3 id=\"受支持的操作系统及运行环境安装\" tabindex=\"-1\"> 受支持的操作系统及运行环境安装</h3>\n<table>\n<thead>\n<tr>\n<th>操作系统</th>\n<th>版本</th>\n<th>CPU架构</th>\n<th>.NET 6.0 （必选）</th>\n<th>WebView 2（可选）</th>\n<th>补丁（必选）</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Windows Client</td>\n<td>7 SP1(<a href=\"https://docs.microsoft.com/zh-cn/troubleshoot/windows-client/windows-7-eos-faq/windows-7-extended-security-updates-faq\" target=\"_blank\" rel=\"noopener noreferrer\">ESU</a>) 、8.1</td>\n<td>x64</td>\n<td><a href=\"https://dotnet.microsoft.com/download/dotnet/6.0/runtime\" target=\"_blank\" rel=\"noopener noreferrer\">下载.Net 6.0 Desktop</a></td>\n<td><a href=\"https://go.microsoft.com/fwlink/p/?LinkId=2124703\" target=\"_blank\" rel=\"noopener noreferrer\">下载WebView 2</a></td>\n<td><a href=\"https://blog.simplix.info/update7/\" target=\"_blank\" rel=\"noopener noreferrer\">下载ESU</a></td>\n</tr>\n<tr>\n<td>Windows 10 Client</td>\n<td>Version 1607+</td>\n<td>Arm64、x64</td>\n<td><a href=\"https://dotnet.microsoft.com/download/dotnet/6.0/runtime\" target=\"_blank\" rel=\"noopener noreferrer\">下载.Net 6.0 Desktop</a></td>\n<td><a href=\"https://go.microsoft.com/fwlink/p/?LinkId=2124703\" target=\"_blank\" rel=\"noopener noreferrer\">下载WebView 2</a></td>\n<td>不需要</td>\n</tr>\n<tr>\n<td>Windows 11 Client</td>\n<td>无限制</td>\n<td>Arm64、x64</td>\n<td><a href=\"https://dotnet.microsoft.com/download/dotnet/6.0/runtime\" target=\"_blank\" rel=\"noopener noreferrer\">下载.Net 6.0 Desktop</a></td>\n<td>不需要</td>\n<td>不需要</td>\n</tr>\n<tr>\n<td>Windows Server</td>\n<td>Version 2012+</td>\n<td>x64</td>\n<td><a href=\"https://dotnet.microsoft.com/download/dotnet/6.0/runtime\" target=\"_blank\" rel=\"noopener noreferrer\">下载.Net 6.0 Desktop</a></td>\n<td><a href=\"https://go.microsoft.com/fwlink/p/?LinkId=2124703\" target=\"_blank\" rel=\"noopener noreferrer\">下载WebView 2</a></td>\n<td>不需要</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"各版本下载地址-建议添加白名单运行\" tabindex=\"-1\"> 各版本下载地址（建议添加白名单运行）</h3>\n<table>\n<thead>\n<tr>\n<th>软件版本</th>\n<th>文件说明</th>\n<th>LanZou</th>\n<th>OneDrive</th>\n<th>杀软报告</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>包含框架(推荐)</strong></td>\n<td>无需额外安装运行环境，可直接运行</td>\n<td><a href=\"https://sundayrx.lanzouq.com/2R2AByh83333\" target=\"_blank\" rel=\"noopener noreferrer\"><strong>下载</strong></a></td>\n<td><a href=\"https://sundayrx-my.sharepoint.com/:u:/g/personal/api1_sundayrx_onmicrosoft_com/EbjsV4mOxBlBoE39mBxFpqsBk51BF4y_T4Cs0OB4hV7OsQ?e=HGIlhE\" target=\"_blank\" rel=\"noopener noreferrer\">下载</a></td>\n<td><a href=\"https://www.virustotal.com/gui/file/80e435ef79dbd3869e00d5515c4240237d40c598cd50519fd97184a78889512f\" target=\"_blank\" rel=\"noopener noreferrer\">VirusTotal</a></td>\n</tr>\n<tr>\n<td>普通版本</td>\n<td>需要安装 .NET 6 Desktop Runtime x64</td>\n<td><a href=\"https://sundayrx.lanzoui.com/vqTrXlR5LrWjP3F\" target=\"_blank\" rel=\"noopener noreferrer\">下载</a></td>\n<td><a href=\"https://sundayrx-my.sharepoint.com/:u:/g/personal/api1_sundayrx_onmicrosoft_com/EbI_I-ohJ4BCuK821xnIoz0BTUBFHPZs3whXbVW06YLPfQ?e=vPozqH\" target=\"_blank\" rel=\"noopener noreferrer\">下载</a></td>\n<td><a href=\"https://www.virustotal.com/gui/file/80e435ef79dbd3869e00d5515c4240237d40c598cd50519fd97184a78889512f\" target=\"_blank\" rel=\"noopener noreferrer\">VirusTotal</a></td>\n</tr>\n<tr>\n<td>历史版本(弃用)</td>\n<td>更兼容Windows 7，已停止更新</td>\n<td><a href=\"https://sundayrx.lanzouq.com/2R2AByh8333\" target=\"_blank\" rel=\"noopener noreferrer\">下载</a></td>\n<td><a href=\"https://sundayrx-my.sharepoint.com/:u:/g/personal/api1_sundayrx_onmicrosoft_com/EayqKNMm9IFMgSVVcNtTWJABAnZrViM3cHrthqP6VG6c2w?e=v9Zetz\" target=\"_blank\" rel=\"noopener noreferrer\">下载</a></td>\n<td><a href=\"https://www.virustotal.com/gui/file/80e435ef79dbd3869e00d5515c4240237d40c598cd50519fd97184a78889512f\" target=\"_blank\" rel=\"noopener noreferrer\">VirusTotal</a></td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"使用教程-请勿开启账号的双重验证功能\" tabindex=\"-1\"> 使用教程**(请勿开启账号的双重验证功能)**</h1>\n<h2 id=\"_0-如何导入旧版本程序中的账号信息-老用户升级用-新用户请无视\" tabindex=\"-1\"> 0 如何导入旧版本程序中的账号信息？（老用户升级用 新用户请无视）</h2>\n<h3 id=\"_0-1-复制旧版本程序账户信息\" tabindex=\"-1\"> 0.1 复制旧版本程序账户信息</h3>\n<p>打开旧版本程序根目录下的Account.txt文件，依照每行复制一个账号信息（不支持多行识别）。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210323143621396.png\" alt=\"图片\"></p>\n<h3 id=\"_0-2-导入账户信息到新版本程序中\" tabindex=\"-1\"> 0.2 导入账户信息到新版本程序中</h3>\n<p>打开新版本程序点击“开始运行”-“添加账号”，在弹出的“添加账号”窗口中找到右上角的剪切板图标，点击后程序会自动识别复制的账号信息，如果复制的内容没有错误程序会自动识别调用类型并填充所有空白项，检查无误后单击“确定”按钮完成一个账号信息的导入。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210323143246326.png\" alt=\"图片\"></p>\n<h2 id=\"_1-注册azure应用程序\" tabindex=\"-1\"> 1 注册Azure应用程序</h2>\n<h3 id=\"_1-1-应用注册\" tabindex=\"-1\"> 1.1 应用注册</h3>\n<ol>\n<li><a href=\"https://portal.azure.com/#home\" target=\"_blank\" rel=\"noopener noreferrer\">点击登录 Azure</a>或<a href=\"https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade\" target=\"_blank\" rel=\"noopener noreferrer\">点击直接进入Azure应用注册</a>，登录账号使用申请到的Microsoft 365 E5的<strong>管理员账户</strong>（账户名类似XXXX@YYYY.onmicrosoft.com格式）。\n2.登录完成后点击右上角的“门户”按钮进入Azure管理中心，在搜索栏内输入“应用注册”，点击进入<a href=\"https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade\" target=\"_blank\" rel=\"noopener noreferrer\">（若应用注册搜索不到请点击此处直接进入）</a>。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200618170032256.png\" alt=\"图片\">\n3.单击“新注册”按钮\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2020061817051341.png\" alt=\"图片\">\n4.配置应用 应用名称随意写、注意可访问性选项选择最后一项、重定向URL暂时不填 、完成后点击注册\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200618170801323.png\" alt=\"图片\"></li>\n</ol>\n<h3 id=\"_1-2-配置应用重定向url-身份验证\" tabindex=\"-1\"> 1.2 配置应用重定向URL（身份验证）</h3>\n<p>1.先点击“概述”，然后点击“添加重定向URL”，进入重定向URL配置界面，<strong>下图中的应用程序(客户端)ID即为&quot;客户端ID&quot;</strong>。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2020061817121972.png\" alt=\"图片\">\n2.点击“添加平台”，再点击“移动和桌面应用程序”，\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200618171501396.png\" alt=\"图片\">\n3.继续勾选中第一个URL，最后点击底部的“配置”，该URL为“<a href=\"https://login.microsoftonline.com/common/oauth2/nativeclient%E2%80%9D%E4%B9%9F%E5%8F%AF%E6%89%8B%E5%8A%A8%E6%B7%BB%E5%8A%A0%E3%80%82\" target=\"_blank\" rel=\"noopener noreferrer\">https://login.microsoftonline.com/common/oauth2/nativeclient”也可手动添加。</a>\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200618171651338.png\" alt=\"图片\">\n4.配置默认客户端类型将应用程序视为公共客户端 点击切换按钮为“是” ，最后点击“保存”按钮保存。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200618171850779.png\" alt=\"图片\"></p>\n<h2 id=\"_2-配置应用程序的api权限-重要\" tabindex=\"-1\"> 2 配置应用程序的API权限（重要）</h2>\n<p><strong>小白提示：建议选择“委托的权限(用户登录)”该权限类型，调用API较多，操作步骤较少简单粗暴，调用成功几率高</strong></p>\n<p>注册的应用程序API权限类型有两种，其主要区别如下表所示：</p>\n<table>\n<thead>\n<tr>\n<th>权限类型</th>\n<th><strong>委托的权限(用户登录)</strong></th>\n<th><strong>应用程序权限(非用户登录)</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>官方释义</td>\n<td>应用程序必须以登录用户身份访问API</td>\n<td>应用程序在用户未登录的情况下作为后台服务或守护程序运行</td>\n</tr>\n<tr>\n<td>需要的信息</td>\n<td>账户名称+账户密码+应用程序(客户端)ID</td>\n<td>账户名称+客户端机密+应用程序(客户端)ID</td>\n</tr>\n<tr>\n<td>功能影响</td>\n<td>程序中所有API均可调用</td>\n<td>部分API权限受限无法调用(官方限制)</td>\n</tr>\n<tr>\n<td>API权限配置</td>\n<td>可由程序自动配置添加API权限</td>\n<td>必须手动配置API权限</td>\n</tr>\n<tr>\n<td>程序颜色标识</td>\n<td>蓝色</td>\n<td>深青色</td>\n</tr>\n</tbody>\n</table>\n<p>根据所选的API权限类型在：<strong>2.1 选择“委托的权限(用户登录)”类型的API</strong>或者<strong>2.2 选择“应用程序权限(非用户登录)”类型的API</strong>中选择性阅读。</p>\n<h3 id=\"_2-1-选择-委托的权限-用户登录-类型的api\" tabindex=\"-1\"> 2.1 选择“委托的权限(用户登录)”类型的API</h3>\n<h4 id=\"_2-1-1-使用程序自动请求配置api权限\" tabindex=\"-1\"> 2.1.1 使用程序自动请求配置API权限</h4>\n<p>1.点击“添加账号”，API调用方式选择“登陆调用”，正确填写“MS365 E5账号”和“应用程序（客户端）ID”后点击“启动自动授权”。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210308150608437.png\" alt=\"图片\"></p>\n<p>2.在弹出的登陆页面中输入你的管理员账户名和密码登录（<strong>该账户必须为全局管理员账户且拥有该客户端ID的控制权限</strong>），登录成功时弹出“请求征得许可界面”，滚动到页面最底部勾选“代表组织同意”，最后点击“接受”。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200628135742984.png\" alt=\"图片\">\n3.判断是否添加API权限成功：首先程序提示授权成功，其次用管理员账户登录Azure查看应用的API权限，发现所有需求的权限全部添加或可以成功调用均视为已添加成功。\nng)\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210323142238814.png\" alt=\"图片\"></p>\n<h4 id=\"_2-1-2-手动配置api权限\" tabindex=\"-1\"> 2.1.2 手动配置API权限</h4>\n<p>1.点击“API权限”-“添加权限”-“Microsoft Graph”\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2020061819283823.png\" alt=\"图片\">\n2.选择“委托的权限”<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200618172538991.png\" alt=\"图片\">\n3.根据下方列出的API权限需求表来勾选所对应的API权限，全部选择完成后点击&quot;添加权限&quot;。</p>\n<p><strong>BookingsAppointment.ReadWrite.All; Calendars.Read; Contacts.Read; Directory.Read.All;\nFiles.Read.All; Files.ReadWrite.All; Group.Read.All; Mail.Read; Mail.Send; MailboxSettings.Read;\nNotes.Read.All; People.Read.All; Presence.Read.All; Sites.Read.All; Tasks.ReadWrite; User.Read.All;</strong></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200618172627969.png\" alt=\"图片\">\n添加完成的效果如图\n<strong>如果没有“代表XXX授予管理员同意”按钮 说明该账号不是管理员账号 换登管理员账号创建应用</strong>\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20201112111140479.png\" alt=\"图片\">\n4.最后点击代表XXX授予管理员同意,对话框选择“是”（该图包含了当前程序“委托的权限(用户登录)”全部API所需要的权限)。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20201112110505347.png\" alt=\"图片\"></p>\n<h3 id=\"_2-2-选择-应用程序权限-非用户登录-类型的api\" tabindex=\"-1\"> 2.2 选择“应用程序权限(非用户登录)”类型的API</h3>\n<h4 id=\"_2-2-1-手动配置api权限\" tabindex=\"-1\"> 2.2.1 手动配置API权限</h4>\n<p>1.点击“API权限”-“添加权限”-“Microsoft Graph”\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2020061819283823-165380581365141.png\" alt=\"图片\">\n2.选择“应用程序权限”\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200801120027971.png\" alt=\"图片\">\n3.根据程序中列出的API权限需求表来勾选所对应的API权限，全部选择完成后点击&quot;添加权限&quot;。\n<strong>Calendars.Read; Contacts.Read; Directory.Read.All; Files.Read.All; Files.ReadWrite.All; Mail.Read;\nMail.Send; MailboxSettings.Read; Notes.Read.All; Sites.Read.All; User.Read.All;</strong>\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200618172627969-165380581693146.png\" alt=\"图片\">\n添加完成的效果如图\n<strong>如果没有“代表XXX授予管理员同意”按钮 说明该账号不是管理员账号 换登管理员账号创建应用</strong>\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200801120623311.png\" alt=\"图片\">\n4.最后点击代表XXX授予管理员同意,对话框选择“是”（该图包含了当前程序“应用程序权限(非用户登录)”全部API所需要的权限）。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200801120818260.png\" alt=\"图片\"></p>\n<h4 id=\"_2-2-2-创建客户端密码\" tabindex=\"-1\"> 2.2.2 创建客户端密码</h4>\n<p>1.点击“证书密码”-“新客户端密码”-“24个月”-“添加”\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210609101116972.png\" alt=\"图片\"></p>\n<p>2.点击“值”该列中的“复制”（不要复制&quot;ID&quot;列中的值），并立即将该密码保存至电脑，<strong>保存的值即为“客户端密码”</strong>， 注：该值必须立即保存，退出该页面后将永远无法查看。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2020120711360840.jpeg\" alt=\"图片\"></p>\n<h2 id=\"_3-使用程序进行api调用\" tabindex=\"-1\"> 3 使用程序进行API调用</h2>\n<h5 id=\"创建一个新的e5子账户-可选步骤\" tabindex=\"-1\"> 创建一个新的E5子账户(可选步骤)</h5>\n<p>登入E5管理员账户进入管理员界面，创建一个新的子账户，使用这个子账户登录程序调用API。\n为什么建议这样做：Microsoft 365 E5 Renew Plus中的部分API包含了写操作，例如Onedrive的API，这些API在随机模式下会生成大量垃圾邮件和文件（虽然单独为此设立了一个文件夹），部分人可能会对此行为非常介意，而且程序频繁的读写可能会对您正常使用账户造成影响，因此不建议使用管理员账户登录。</p>\n<h3 id=\"_3-1-添加一个账户\" tabindex=\"-1\"> 3.1 添加一个账户</h3>\n<p>点击“开始运行”-“添加账号”\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/a4451a28afdb4b01b18f566feaf07759.png\" alt=\"图片\"></p>\n<p>这里可以切换API调用方式但也需要更改对应的填写内容</p>\n<p>登录调用方式填写\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210307154000125.png\" alt=\"图片\">\n非登录调用方式填写\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210307154255163.png\" alt=\"图片\"></p>\n<p>最后点击确定\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/202103071542145.png\" alt=\"图片\"></p>\n<h3 id=\"_3-2-开始运行\" tabindex=\"-1\"> 3.2 开始运行</h3>\n<p>点击“开始运行”\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/60b549fee8464ba08722d38b4cb999c0.png\" alt=\"图片\"></p>\n<h1 id=\"写在最后面\" tabindex=\"-1\"> 写在最后面</h1>\n<h2 id=\"关闭e5账户登录双重验证\" tabindex=\"-1\"> 关闭E5账户登录双重验证</h2>\n<p><a href=\"https://account.activedirectory.windowsazure.com/UserManagement/MultifactorVerification.aspx\" target=\"_blank\" rel=\"noopener noreferrer\">点击进入Office 365 E5账户多重身份验证管理</a>，按照下图配置即可关闭E5账户登录的双重验证。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210519091511446.png\" alt=\"图片\">\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210519091736252.png\" alt=\"图片\"></p>\n<h2 id=\"关闭azure中api调用的双重验证\" tabindex=\"-1\"> 关闭Azure中API调用的双重验证</h2>\n<p><a href=\"https://aad.portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/Overview\" target=\"_blank\" rel=\"noopener noreferrer\">点击进入Azure Active Directory管理中心</a>，按照下图配置即可关闭Azure中API调用的双重验证。\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20201010153543698.png\" alt=\"图片\"></p>\n<h2 id=\"查询续订剩余天数\" tabindex=\"-1\"> 查询续订剩余天数</h2>\n<p><a href=\"https://developer.microsoft.com/zh-cn/microsoft-365/profile\" target=\"_blank\" rel=\"noopener noreferrer\">点击查询续订剩余天数(使用申请E5账号的账户登录)</a></p>\n<h2 id=\"关于续订\" tabindex=\"-1\"> 关于续订</h2>\n<p>E5续订执行是微软统一的具有一定时间周期的续订，如果你的E5订阅剩余天数少于等于30天、并收到了未检测到开发活动的警告邮件且仪表盘显示标红文字“此订阅处于非活动状态且即将过期”，请不要慌张。根据微软客服官方说法是：“订阅只有在剩余最后1天才给续期”，然而根据众多E5账号的续订情况来统计，大部分账号是在少于30天续期的，极少欧洲人是在大于30天的时候续期。</p>\n<p>本人E5账户收到过两次未活跃警告，微软客服解释说：这种警告邮件属于系统自动发送的(邮件会在剩余第30天的时候发送)，无需理会它，至于出现文字标红文字“此订阅处于非活动状态且即将过期”，也为系统自动提示，只要保证仪表盘上的文字标注为“<strong>可续订</strong> E5的订阅”就可以了，即便是真的过期了没有续上也是可以从仪表盘申诉的。</p>\n<h3 id=\"仪表盘变化\" tabindex=\"-1\"> 仪表盘变化</h3>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2020082317495235.png\" alt=\"图片\">\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20210129090340925.png\" alt=\"图片\"></p>\n<h3 id=\"续订邮件\" tabindex=\"-1\"> 续订邮件</h3>\n<p>第一次续订\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200820125542472.jpeg\" alt=\"图片\">\n第二次续订\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20201031134336350.png\" alt=\"图片\"></p>\n<h3 id=\"警告邮件\" tabindex=\"-1\"> 警告邮件</h3>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20200820125531157.jpeg\" alt=\"图片\"></p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/b23cb7e4945747fca6e88b5c36e80e08.png",
      "date_published": "2022-06-12T00:00:00.000Z",
      "date_modified": "2022-05-29T06:33:31.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "快速排序",
      "url": "https://blog.ciberviler.top/algorithm/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F.html",
      "id": "https://blog.ciberviler.top/algorithm/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F.html",
      "summary": "快速排序",
      "content_html": "<h1 id=\"快速排序\" tabindex=\"-1\"> 快速排序</h1>\n<h2 id=\"一、简介\" tabindex=\"-1\"> 一、简介</h2>\n<p>快速排序（Quick sort）是对冒泡排序的一种改进，是非常重要且应用比较广泛的一种高效率排序算法。</p>\n<h2 id=\"二、算法思路\" tabindex=\"-1\"> 二、算法思路</h2>\n<p>快速排序是通过多次比较和交换来实现排序，在一趟排序中把将要排序的数据分成两个独立的部分，对这两部分进行排序使得其中一部分所有数据比另一部分都要小，然后继续递归排序这两部分，最终实现所有数据有序。</p>\n<p>大致步骤如下：</p>\n<h3 id=\"第一种\" tabindex=\"-1\"> 第一种 ：</h3>\n<ul>\n<li>\n<p>1.首先设置一个分界值也就是基准值又是也称为监视哨，通过该分界值将数据分割成两部分。</p>\n</li>\n<li>\n<p>2.将大于或等于分界值的数据集中到右边，小于分界值的数据集中到左边。一趟排序过后，左边部分中各个数据元素都小于分界值，而右边部分中各数据元素都大于或等于分界值，且右边部分个数据元素皆大于左边所有数据元素。</p>\n</li>\n<li>\n<p>3.然后，左边和右边的数据可以看成两组不同的部分，重复上述1和2步骤</p>\n</li>\n<li>\n<p>当左右两部分都有序时，整个数据就完成了排序。</p>\n</li>\n</ul>\n<h3 id=\"第二种\" tabindex=\"-1\"> 第二种 ：</h3>\n<ul>\n<li>\n<p>1.从序列中选择一个轴点元素pivot从最后一个元素向前遍历我们的策略是：每次选择第0位置的元素为轴点元素</p>\n</li>\n<li>\n<p>2.利用pivot将数组分割成2个子数组将小于pivot的元素放在pivot的左侧将大于pivot的元素放在pivot的右侧将等于pivot的元素放在pivot的哪侧都可以，本文选择左侧</p>\n</li>\n<li>\n<p>3.对子序列进行步骤1和步骤2操作直到不能再分割(子序列中只剩下一个元素)</p>\n</li>\n</ul>\n<p>先介绍了下快排的执行流程，脑海中先有个大致的思路。总结一下就是先把一个大数组通过第一个元素将之分割成2个小的数组，并且以该轴点为界，小于它的在左边，大于它的在右边，然后递归对2个小数组执行步骤1、2操作，直到不能再分割。也许理解了一部分，别担心，接下来我会通过一个例子来带你走一遍上述的流程。</p>\n<h2 id=\"三、算法步骤图解\" tabindex=\"-1\"> 三、算法步骤图解</h2>\n<p>首先设置三个参数，first指向区间左端，last指向区间右端，key为当前的分界值。</p>\n<p>从待排序的数据元素中选取一个通常为第一个作为基准值元素（key）key=num[0]，设置双指针first指向区间左端，last指向区间右端。</p>\n<h3 id=\"例子演示一\" tabindex=\"-1\"> <strong>例子演示一</strong></h3>\n<p>首先设置三个参数，first指向区间左端，last指向区间右端，key为当前的分界值。</p>\n<p>从待排序的数据元素中选取一个通常为第一个作为基准值元素（key）key=num[0]，设置双指针first指向区间左端，last指向区间右端。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/978b84a9b541a0db3b191993bc9fbd62.png\" alt=\"图片\"></p>\n<p><strong>一、</strong></p>\n<p>key 首先与 num[last] 进行比较，如果 num[last]&lt;key，则num[first]=num[last]将这个比key小的数放到左边去，如果num[last]&gt;=key则- -last，再拿num[last]与key进行比较，直到num[last]&lt;key交换元素为止。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/47163d859bc7517570716e1853e67ebb.png\" alt=\"图片\"></p>\n<p><strong>二、</strong>\nnum[last]&lt;key交换元素后，转向左边部分，用num[first]与key进行比较，如果num[first]&lt;key,则++first，然后继续进行比较，直至num[first]&gt;key,则将num[last]=num[first]。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/41a9849c2ee0619ca10dca2f0c942251.png\" alt=\"图片\">\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/c3098c79e69a9547ce8996b310ebf296.png\" alt=\"图片\"></p>\n<p><strong>三、</strong>\n重复上述一二步骤</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1e415f1728b314dfc9cd1c90b1dcd9af.png\" alt=\"图片\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/ea40064bf09b7cce290866b0b47061aa.png\" alt=\"图片\">\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/50a1d73bad725027a2029378d10fbe8d.png\" alt=\"图片\">\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/a958b26d073c9bb0028b7a789934edfc.png\" alt=\"图片\">\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/9d32ef4a4b40b025e3d1c55793e6b168.png\" alt=\"图片\">\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/f9094712d3320eba982b4afe01b9eaa5.png\" alt=\"图片\">\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/4f16335e5225369f133a2c93a70efcf4.png\" alt=\"图片\">\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/a0b398c6f9c2600cc551a4e21b35ccf4.png\" alt=\"图片\">\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/4c1e553a89a57abe4ceaf726d7f52924.png\" alt=\"图片\"></p>\n<p><strong>四、</strong>\n第一趟排序结束，得到[2,11,15,20,9,5] <em><strong>23</strong></em> [56,45,35] 然后对左右子数列进行同样的操作。</p>\n<p><em><strong>2</strong></em> [11,15,20,9,5] <em><strong>23</strong></em> [35,45] <em><strong>56</strong></em></p>\n<p><em><strong>2</strong></em> [5,9] <em><strong>11</strong></em> [20,15] <em><strong>23 35 45 56</strong></em></p>\n<p><em><strong>2 5 9 11 15 20 23 35 45 56</strong></em></p>\n<p>完成从小到大的排序</p>\n<h3 id=\"例子演示二\" tabindex=\"-1\"> <strong>例子演示二</strong></h3>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/d53f8794a4c27d1ecff02604e5162266dfc43863.png\" alt=\"img\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/8b82b9014a90f60307aca9253bd63c13b151ed84.png\" alt=\"img\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/7aec54e736d12f2e95af5d264e065a6a8435681e.png\" alt=\"img\"></p>\n<p><strong>(注：图片中的单词start与begin同义)</strong></p>\n<p><strong>解释下调头的事情：</strong></p>\n<p>开始的时候是从end往前遍历大于pivot的值就end++；小于pivot的值时，end不变，并且将end指向的值替换begin指向的值，begin++从beigin往后遍历小于pivot的值就begin++；小于pivot的值时，begin不变，并且将begin指向的值替换end指向的值，end++这样交替进行</p>\n<h3 id=\"动图演示\" tabindex=\"-1\"> 动图演示</h3>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/quickSort.gif\" alt=\"img\"></p>\n<h2 id=\"四、算法性能分析\" tabindex=\"-1\"> 四、算法性能分析</h2>\n<p><strong>最好情况</strong>\n每次数据元素都能平均的分成两个部分。得到一个完全二叉树。如果有n个数据元素，那么数的深度为\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/cc536403e247bf6f9b83d29d2ab656ae.png\" alt=\"图片\">\n时间复杂度为O(nlogn)</p>\n<p><strong>最坏情况</strong>\n在最坏的情况下，这个数仅有右子树或左子树，比较次数为 （n-1）+（n-2) + (n-3) + … +1=n*(n-1)/2 ,因此时间复杂度为O(n^2),在待排序数据元素已经有序的情况下快速排序时间复杂度最高</p>\n<p>空间复杂度为O(n）\n快速排序是一种不稳定的排序算法，会改变数据元素的相对位置，也是内排序中平均效率最高的排序算法。</p>\n<h2 id=\"五、代码实现\" tabindex=\"-1\"> 五、代码实现</h2>\n<h3 id=\"c\" tabindex=\"-1\"> <strong>C</strong></h3>\n<div><pre><code><span>void</span> <span>quick_sort</span><span>(</span><span>int</span> <span>*</span>num<span>,</span><span>int</span> l<span>,</span><span>int</span> r<span>)</span><span>{</span>\n\t<span>//如果小于等于1个数据元素·直接返回结束快排函数 r为数组元素总个数</span>\n\t<span>if</span><span>(</span>l<span>+</span><span>1</span><span>>=</span>r<span>)</span><span>{</span>\n\t\t<span>return</span> <span>;</span>\n\t<span>}</span>\n\t<span>int</span> first<span>=</span>l<span>,</span>last<span>=</span>r<span>-</span><span>1</span><span>,</span>key<span>=</span>num<span>[</span>first<span>]</span><span>;</span>\n\t<span>while</span><span>(</span>first<span>&lt;</span>last<span>)</span><span>{</span>\n\t\t<span>while</span><span>(</span>first<span>&lt;</span>last<span>&amp;&amp;</span>num<span>[</span>last<span>]</span><span>>=</span>key<span>)</span><span>{</span>\n\t\t\t<span>--</span>last<span>;</span>\n\t\t<span>}</span>\n\t\t<span>//如果值小于 key分界值 交换 </span>\n\t\tnum<span>[</span>first<span>]</span><span>=</span>num<span>[</span>last<span>]</span><span>;</span>\n\t\t<span>while</span><span>(</span>first<span>&lt;</span>last<span>&amp;&amp;</span>num<span>[</span>first<span>]</span><span>&lt;</span>key<span>)</span><span>{</span>\n\t\t\t<span>++</span>first<span>;</span>\n\t\t<span>}</span>\n\t\t<span>//如果值大于key分界值 交换 </span>\n\t\tnum<span>[</span>last<span>]</span><span>=</span>num<span>[</span>first<span>]</span><span>;</span>\n\t<span>}</span>\n\tnum<span>[</span>first<span>]</span><span>=</span>key<span>;</span>\n\t<span>//递归左右部分进行快排 </span>\n\t<span>quick_sort</span><span>(</span>num<span>,</span>l<span>,</span>first<span>)</span><span>;</span>\n\t<span>quick_sort</span><span>(</span>num<span>,</span>first<span>+</span><span>1</span><span>,</span>r<span>)</span><span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"java\" tabindex=\"-1\"> <strong>Java</strong></h3>\n<div><pre><code><span>public</span> <span>static</span> <span>int</span><span>[</span><span>]</span> <span>quick_sort</span><span>(</span><span>int</span><span>[</span><span>]</span> num<span>,</span> <span>int</span> l<span>,</span> <span>int</span> r<span>)</span><span>{</span>\n<span>//r为数组元素总个数，last下标等于r-1</span>\n        <span>int</span> first<span>=</span>l<span>,</span>last<span>=</span>r<span>-</span><span>1</span><span>,</span>key<span>=</span>num<span>[</span>first<span>]</span><span>;</span>\n        <span>while</span><span>(</span>first<span>&lt;</span>last<span>)</span><span>{</span>\n            <span>while</span><span>(</span>first<span>&lt;</span>last<span>&amp;&amp;</span>num<span>[</span>last<span>]</span><span>>=</span>key<span>)</span><span>{</span>\n                <span>--</span>last<span>;</span>\n            <span>}</span>\n            <span>//如果值小于 key分界值 交换</span>\n            num<span>[</span>first<span>]</span><span>=</span>num<span>[</span>last<span>]</span><span>;</span>\n            <span>while</span><span>(</span>first<span>&lt;</span>last<span>&amp;&amp;</span>num<span>[</span>first<span>]</span><span>&lt;</span>key<span>)</span><span>{</span>\n                <span>++</span>first<span>;</span>\n            <span>}</span>\n            <span>//如果值大于key分界值 交换</span>\n            num<span>[</span>last<span>]</span><span>=</span>num<span>[</span>first<span>]</span><span>;</span>\n        <span>}</span>\n        num<span>[</span>first<span>]</span><span>=</span>key<span>;</span>\n        <span>//递归左右部分进行快排</span>\n         <span>if</span> <span>(</span>first<span>></span>l<span>)</span> <span>{</span>\n             num<span>=</span><span>quick_sort</span><span>(</span>num<span>,</span> l<span>,</span> first<span>)</span><span>;</span>\n         <span>}</span>\n        <span>if</span> <span>(</span>first<span>+</span><span>1</span><span>&lt;</span>r<span>)</span><span>{</span>\n            num<span>=</span><span>quick_sort</span><span>(</span>num<span>,</span>first<span>+</span><span>1</span><span>,</span>r<span>)</span><span>;</span>\n        <span>}</span>\n        <span>return</span> num<span>;</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"六、视频\" tabindex=\"-1\"> 六、视频</h2>\n<video id=\"video\" controls=\"\" preload=\"none\" width=\"720px\">\n      <source id=\"mp4\" src=\"http://alist.ciberviler.top/d/ecloud180/videos/blogVideo/quickSort.mp4\" type=\"video/mp4\">\n</video>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/978b84a9b541a0db3b191993bc9fbd62.png",
      "date_published": "2022-05-30T00:00:00.000Z",
      "date_modified": "2022-05-29T03:37:51.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "algorithm"
      ]
    },
    {
      "title": "算法",
      "url": "https://blog.ciberviler.top/algorithm/",
      "id": "https://blog.ciberviler.top/algorithm/",
      "summary": "各类算法，刷题",
      "content_html": "<p align=\"center\"> \n  <img src=\"https://metrics.lecoq.io/xlc520?template=classic&isocalendar=1&languages=1&people=1&activity=1&achievements=1&lines=1&repositories=1&notable=1&introduction=1&pagespeed=1&repositories=100&repositories.batch=100&repositories.forks=false&repositories.affiliations=owner&isocalendar.duration=full-year&languages.limit=8&languages.threshold=0%&languages.colors=github&languages.sections=most-used&languages.indepth=false&languages.analysis.timeout=15&languages.categories=markup%2C programming&languages.recent.categories=markup%2C programming&languages.recent.load=300&languages.recent.days=14&people.limit=24&people.identicons=false&people.identicons.hide=false&people.size=28&people.types=followers%2C following&people.shuffle=false&activity.limit=5&activity.load=300&activity.days=14&activity.visibility=all&activity.timestamps=false&activity.filter=all&achievements.threshold=C&achievements.secrets=true&achievements.display=detailed&achievements.limit=0&notable.from=organization&notable.repositories=false&notable.indepth=false&notable.types=commit&repositories.featured= xlc520%2Fxlc520.github.io&introduction.title=true&pagespeed.url=xlc520.github.io&pagespeed.detailed=false&pagespeed.screenshot=false&config.timezone=Asia%2FShanghai\" /> \n</p>\n<p align=\"center\"> \n  您是第  <img src=\"https://profile-counter.glitch.me/xlc520/count.svg\" />  位访问者\n</p>",
      "date_published": "2022-05-28T00:00:00.000Z",
      "date_modified": "2022-05-28T14:45:05.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "algorithm"
      ]
    },
    {
      "title": "牛客网-华为机试",
      "url": "https://blog.ciberviler.top/algorithm/%E7%89%9B%E5%AE%A2%E7%BD%91-%E5%8D%8E%E4%B8%BA%E6%9C%BA%E8%AF%95.html",
      "id": "https://blog.ciberviler.top/algorithm/%E7%89%9B%E5%AE%A2%E7%BD%91-%E5%8D%8E%E4%B8%BA%E6%9C%BA%E8%AF%95.html",
      "summary": "华为笔试面试机考在线练习",
      "content_html": "<h1 id=\"牛客网-华为机试\" tabindex=\"-1\"> 牛客网-华为机试</h1>\n<h2 id=\"hj1-字符串最后一个单词的长度\" tabindex=\"-1\"> <strong>HJ1</strong> <strong>字符串最后一个单词的长度</strong></h2>\n<h3 id=\"描述\" tabindex=\"-1\"> 描述</h3>\n<p>计算字符串最后一个单词的长度，单词以空格隔开，字符串长度小于5000。（注：字符串末尾不以空格为结尾）</p>\n<h3 id=\"输入描述\" tabindex=\"-1\"> 输入描述：</h3>\n<p>输入一行，代表要计算的字符串，非空，长度小于5000。</p>\n<h3 id=\"输出描述\" tabindex=\"-1\"> 输出描述：</h3>\n<p>输出一个整数，表示输入字符串最后一个单词的长度。</p>\n<h3 id=\"示例1\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>hello nowcoder\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>输出：</p>\n<div><pre><code>8\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>说明：</p>\n<div><pre><code>最后一个单词为nowcoder，长度为8   \n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h3 id=\"代码\" tabindex=\"-1\"> 代码：</h3>\n<ul>\n<li>方法一: 系统函数</li>\n</ul>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Scanner</span></span><span>;</span>\n\n<span>// 注意类名必须为 Main, 不要有任何 package xxx 信息</span>\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>{</span>\n        <span>Scanner</span> sc <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>String</span> str <span>=</span> sc<span>.</span><span>nextLine</span><span>(</span><span>)</span><span>;</span>\n        <span>String</span><span>[</span><span>]</span> s <span>=</span> str<span>.</span><span>split</span><span>(</span><span>\" \"</span><span>)</span><span>;</span> <span>//正则表达式实用性更强( str.split(\"\\\\s+\"))</span>\n        <span>int</span> length <span>=</span> s<span>[</span>s<span>.</span>length <span>-</span> <span>1</span><span>]</span><span>.</span><span>length</span><span>(</span><span>)</span><span>;</span>\n        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>length<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><ul>\n<li>方法二: 反过来打印</li>\n</ul>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Scanner</span></span><span>;</span>\n\n<span>// 注意类名必须为 Main, 不要有任何 package xxx 信息</span>\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>{</span>\n        <span>Scanner</span> sc <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>String</span> str <span>=</span> sc<span>.</span><span>nextLine</span><span>(</span><span>)</span><span>;</span>\n        <span>int</span> length <span>=</span> str<span>.</span><span>length</span><span>(</span><span>)</span><span>;</span>\n        <span>int</span> count <span>=</span> <span>0</span><span>;</span>\n        <span>for</span> <span>(</span><span>int</span> i <span>=</span> length <span>-</span> <span>1</span><span>;</span> i <span>>=</span> <span>0</span><span>;</span> i<span>--</span><span>)</span> <span>{</span>\n            <span>if</span> <span>(</span>str<span>.</span><span>charAt</span><span>(</span>i<span>)</span><span>==</span><span>' '</span><span>)</span> <span>{</span> <span>// 或者 if (str.substring(i, i + 1).equals(\" \")) {</span>\n                <span>break</span><span>;</span>\n            <span>}</span>\n            count<span>++</span><span>;</span>\n        <span>}</span>\n        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>count<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"hj2-计算某字符出现次数\" tabindex=\"-1\"> <strong>HJ2</strong> <strong>计算某字符出现次数</strong></h2>\n<h3 id=\"描述-1\" tabindex=\"-1\"> 描述</h3>\n<p>写出一个程序，接受一个由字母、数字和空格组成的字符串，和一个字符，然后输出输入字符串中该字符的出现次数。（不区分大小写字母）</p>\n<p>数据范围： 1 \\le n \\le 1000 \\1≤<em>n</em>≤1000</p>\n<h3 id=\"输入描述-1\" tabindex=\"-1\"> 输入描述：</h3>\n<p>第一行输入一个由字母和数字以及空格组成的字符串，第二行输入一个字符。</p>\n<h3 id=\"输出描述-1\" tabindex=\"-1\"> 输出描述：</h3>\n<p>输出输入字符串中含有该字符的个数。（不区分大小写字母）</p>\n<h3 id=\"示例1-1\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>ABCabc\nA\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>输出：</p>\n<div><pre><code>2\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h3 id=\"代码-1\" tabindex=\"-1\"> 代码：</h3>\n<ul>\n<li>一、</li>\n</ul>\n<div><pre><code><span>/**\n     * 二：计算某字符出现的次数\n     * 1.接收输入的第一个字符串，并转换为小写。（完整字符串str1）\n     * 2.接收输入的第二个字符串，并转换为小写。（单个字符str2）\n     * 3.将str1中的str2字符串全部替换为 “”\n     * 4.用str1.length-str2.length = 出现次数\n     */</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Scanner</span></span><span>;</span>\n\n<span>// 注意类名必须为 Main, 不要有任何 package xxx 信息</span>\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span><span>{</span>\n        <span>Scanner</span> input <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>// 完整字符串</span>\n        <span>String</span> str1 <span>=</span> input<span>.</span><span>nextLine</span><span>(</span><span>)</span><span>.</span><span>toLowerCase</span><span>(</span><span>)</span><span>;</span>\n        <span>// 单个字符串</span>\n        <span>String</span> str2 <span>=</span> input<span>.</span><span>nextLine</span><span>(</span><span>)</span><span>.</span><span>toLowerCase</span><span>(</span><span>)</span><span>;</span>\n        <span>// 完整字符的长度-单个字符长度 = 出现的次数</span>\n        <span>int</span> num <span>=</span> str1<span>.</span><span>length</span><span>(</span><span>)</span> <span>-</span> str1<span>.</span><span>replaceAll</span><span>(</span>str2<span>,</span><span>\"\"</span><span>)</span><span>.</span><span>length</span><span>(</span><span>)</span><span>;</span>\n        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>num<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><ul>\n<li>二、</li>\n</ul>\n<div><pre><code>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Scanner</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span>regex<span>.</span></span><span>Matcher</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span>regex<span>.</span></span><span>Pattern</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>{</span>\n        <span>Scanner</span> scanner <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>String</span> string <span>=</span> scanner<span>.</span><span>nextLine</span><span>(</span><span>)</span><span>;</span>\n        <span>String</span> character <span>=</span> scanner<span>.</span><span>nextLine</span><span>(</span><span>)</span><span>;</span>\n        <span>Pattern</span> compile <span>=</span> <span>Pattern</span><span>.</span><span>compile</span><span>(</span>character<span>,</span> <span>Pattern</span><span>.</span>CASE_INSENSITIVE<span>)</span><span>;</span>\n        <span>Matcher</span> matcher <span>=</span> compile<span>.</span><span>matcher</span><span>(</span>string<span>)</span><span>;</span>\n        <span>int</span> count <span>=</span> <span>0</span><span>;</span>\n        <span>while</span> <span>(</span>matcher<span>.</span><span>find</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n            count<span>++</span><span>;</span>\n        <span>}</span>\n        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>count<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"hj3-明明的随机数\" tabindex=\"-1\"> <strong>HJ3</strong> <strong>明明的随机数</strong></h2>\n<h3 id=\"描述-2\" tabindex=\"-1\"> 描述</h3>\n<p>明明生成了N<em>N</em>个1到500之间的随机整数。请你删去其中重复的数字，即相同的数字只保留一个，把其余相同的数去掉，然后再把这些数从小到大排序，按照排好的顺序输出。</p>\n<p>数据范围： 1 \\le n \\le 1000 \\1≤<em>n</em>≤1000 ，输入的数字大小满足 1 \\le val \\le 500 \\1≤<em>v<strong>a</strong>l</em>≤500</p>\n<h3 id=\"输入描述-2\" tabindex=\"-1\"> 输入描述：</h3>\n<p>第一行先输入随机整数的个数 N 。 接下来的 N 行每行输入一个整数，代表明明生成的随机数。 具体格式可以参考下面的&quot;示例&quot;。</p>\n<h3 id=\"输出描述-2\" tabindex=\"-1\"> 输出描述：</h3>\n<p>输出多行，表示输入数据处理后的结果</p>\n<h3 id=\"示例1-2\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>3\n2\n2\n1\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>输出：</p>\n<div><pre><code>1\n2\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>说明：</p>\n<div><pre><code>输入解释：\n第一个数字是3，也即这个小样例的N=3，说明用计算机生成了3个1到500之间的随机整数，接下来每行一个随机数字，共3行，也即这3个随机数字为：\n2\n2\n1\n所以样例的输出为：\n1\n2     \n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"代码-2\" tabindex=\"-1\"> 代码：</h3>\n<p>一、</p>\n<p>题目有两个要求：</p>\n<ul>\n<li>去重</li>\n<li>排序</li>\n</ul>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Test</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>{</span>\n        <span>Scanner</span> sc <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>//获取个数</span>\n        <span>int</span> num <span>=</span> sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n        <span>//创建TreeSet进行去重排序</span>\n        <span>TreeSet</span> set <span>=</span> <span>new</span> <span>TreeSet</span><span>(</span><span>)</span><span>;</span>\n        <span>//输入</span>\n        <span>for</span><span>(</span><span>int</span> i <span>=</span><span>0</span> <span>;</span> i <span>&lt;</span> num <span>;</span>i<span>++</span><span>)</span><span>{</span>\n            set<span>.</span><span>add</span><span>(</span>sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>}</span>\n        <span>//输出</span>\n        <span>Iterator</span> iterator <span>=</span> set<span>.</span><span>iterator</span><span>(</span><span>)</span><span>;</span>\n        <span>while</span> <span>(</span>iterator<span>.</span><span>hasNext</span><span>(</span><span>)</span><span>)</span><span>{</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>iterator<span>.</span><span>next</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>二、</p>\n<p>主要的思路就是空间换时间，还有利用数组的下标。</p>\n<ol>\n<li>创建一个1001个数字的数组，在输入一个1-1000的数字时将改数组对应下标的值改为1。</li>\n<li>然后再从小到大循环数组中值为1的下标输出，因为下标本身有序的因此就不用排序。</li>\n</ol>\n<div><pre><code>    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>{</span>\n        <span>Scanner</span> scanner <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>while</span> <span>(</span>scanner<span>.</span><span>hasNext</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n            <span>int</span> num <span>=</span> scanner<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n            <span>int</span><span>[</span><span>]</span> arr <span>=</span> <span>new</span> <span>int</span><span>[</span><span>1001</span><span>]</span><span>;</span>\n            <span>for</span> <span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> num<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n                <span>int</span> n <span>=</span> scanner<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n                arr<span>[</span>n<span>]</span> <span>=</span> <span>1</span><span>;</span>\n            <span>}</span>\n            <span>for</span> <span>(</span><span>int</span> i <span>=</span> <span>1</span><span>;</span> i <span>&lt;</span> arr<span>.</span>length<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n                <span>if</span> <span>(</span>arr<span>[</span>i<span>]</span> <span>==</span> <span>1</span><span>)</span> <span>{</span>\n                    <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>i<span>)</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n        <span>}</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"hj4-字符串分隔\" tabindex=\"-1\"> <strong>HJ4</strong> <strong>字符串分隔</strong></h2>\n<h3 id=\"描述-3\" tabindex=\"-1\"> 描述</h3>\n<p>•输入一个字符串，请按长度为8拆分每个输入字符串并进行输出；</p>\n<p>•长度不是8整数倍的字符串请在后面补数字0，空字符串不处理。</p>\n<h3 id=\"输入描述-3\" tabindex=\"-1\"> 输入描述：</h3>\n<p>连续输入字符串(每个字符串长度小于等于100)</p>\n<h3 id=\"输出描述-3\" tabindex=\"-1\"> 输出描述：</h3>\n<p>依次输出所有分割后的长度为8的新字符串</p>\n<h3 id=\"示例1-3\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>abc\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>输出：</p>\n<div><pre><code>abc00000\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h3 id=\"代码-3\" tabindex=\"-1\"> 代码：</h3>\n<h4 id=\"一、\" tabindex=\"-1\"> 一、</h4>\n<p>思路</p>\n<ol>\n<li>需要输入字符串，用到Scanner和hasNext()。\n（1）建立 Scanner sc = new Scanner(<a href=\"http://System.in\" target=\"_blank\" rel=\"noopener noreferrer\">System.in</a>);\n（2）判断有无输入用sc.hasNext().接收字符串使用sc.nextLine().</li>\n<li>一次性接受全部的字符串，对8取余，获知需要补0的位数。使用StringBuilder中的append()函数进行字符串修改，别忘了toString()。\n字符串缓冲区的建立：StringBuilder sb = new StringBuilder();</li>\n<li>输出时，截取前8位进行输出，并更新字符串。用到str.substring()函数：\n（1）str.substring(i)意为截取从字符索引第i位到末尾的字符串。\n（2）str.substring(i,j)意为截取索引第i位到第（j-1）位字符串。包含i，不包含j。</li>\n</ol>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n<span>public</span> <span>class</span> <span>Main</span><span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span><span>{</span>\n        <span>Scanner</span> sc <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>while</span><span>(</span>sc<span>.</span><span>hasNext</span><span>(</span><span>)</span><span>)</span><span>{</span>\n            <span>String</span> str <span>=</span> sc<span>.</span><span>nextLine</span><span>(</span><span>)</span><span>;</span>\n            <span>StringBuilder</span> sb <span>=</span> <span>new</span> <span>StringBuilder</span><span>(</span><span>)</span><span>;</span><span>//牢记字符串缓冲区的建立语法</span>\n            sb<span>.</span><span>append</span><span>(</span>str<span>)</span><span>;</span><span>//字符串缓冲区的加入</span>\n            <span>int</span> size <span>=</span> str<span>.</span><span>length</span><span>(</span><span>)</span><span>;</span>\n            <span>int</span> addZero <span>=</span> <span>8</span> <span>-</span> size<span>%</span><span>8</span><span>;</span><span>//addzero的可能值包括8</span>\n            <span>while</span><span>(</span><span>(</span>addZero <span>></span> <span>0</span><span>)</span><span>&amp;&amp;</span><span>(</span>addZero<span>&lt;</span><span>8</span><span>)</span><span>)</span><span>{</span><span>//注意边界调节，避免addzero=8</span>\n                sb<span>.</span><span>append</span><span>(</span><span>\"0\"</span><span>)</span><span>;</span><span>//使用‘’或“”都可</span>\n                addZero<span>--</span><span>;</span>\n            <span>}</span>\n            <span>String</span> str1 <span>=</span> sb<span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span>\n            <span>while</span><span>(</span>str1<span>.</span><span>length</span><span>(</span><span>)</span><span>></span><span>0</span><span>)</span><span>{</span>\n                <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>str1<span>.</span><span>substring</span><span>(</span><span>0</span><span>,</span><span>8</span><span>)</span><span>)</span><span>;</span>\n                str1 <span>=</span> str1<span>.</span><span>substring</span><span>(</span><span>8</span><span>)</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"二、\" tabindex=\"-1\"> 二、</h4>\n<div><pre><code><span>/**\n*1.输入字符串大于8时，递归截取前8位输入，直至小于8位时进入循环补0\n*2.字符串小于8时直接跳到循环补0操作，补满至8位时打印输出\n*3.正好等于8位或为空字符串时，直接打印输出\n*/</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Scanner</span></span><span>;</span>\n\n<span>// 注意类名必须为 Main, 不要有任何 package xxx 信息</span>\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>{</span>\n        <span>Scanner</span> in <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>while</span> <span>(</span>in<span>.</span><span>hasNextLine</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n            <span>String</span> s<span>=</span>in<span>.</span><span>nextLine</span><span>(</span><span>)</span><span>;</span>\n            <span>while</span><span>(</span>s<span>.</span><span>length</span><span>(</span><span>)</span><span>></span><span>8</span><span>)</span><span>{</span>\n                <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>s<span>.</span><span>substring</span><span>(</span><span>0</span><span>,</span><span>8</span><span>)</span><span>)</span><span>;</span>\n                s<span>=</span>s<span>.</span><span>substring</span><span>(</span><span>8</span><span>)</span><span>;</span>\n            <span>}</span>\n            <span>while</span><span>(</span>s<span>.</span><span>length</span><span>(</span><span>)</span><span>&lt;</span><span>8</span><span>&amp;&amp;</span>s<span>.</span><span>length</span><span>(</span><span>)</span><span>></span><span>0</span><span>)</span><span>{</span>\n                s<span>+=</span><span>\"0\"</span><span>;</span>\n            <span>}</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>s<span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"三、\" tabindex=\"-1\"> 三、</h4>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Scanner</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>{</span>\n        <span>Scanner</span> sc <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>String</span> str<span>;</span>\n        <span>while</span> <span>(</span>sc<span>.</span><span>hasNext</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n            str <span>=</span> sc<span>.</span><span>nextLine</span><span>(</span><span>)</span><span>;</span>\n            <span>while</span> <span>(</span>str<span>.</span><span>length</span><span>(</span><span>)</span> <span>></span> <span>8</span><span>)</span> <span>{</span>\n                 <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>str<span>.</span><span>substring</span><span>(</span><span>0</span><span>,</span> <span>8</span><span>)</span><span>)</span><span>;</span>\n                 str <span>=</span> str<span>.</span><span>substring</span><span>(</span><span>8</span><span>)</span><span>;</span>\n            <span>}</span>\n            str <span>=</span> str <span>+</span> <span>\"00000000\"</span><span>;</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>str<span>.</span><span>substring</span><span>(</span><span>0</span><span>,</span> <span>8</span><span>)</span><span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"hj5-进制转换\" tabindex=\"-1\"> <strong>HJ5</strong> <strong>进制转换</strong></h2>\n<h3 id=\"描述-4\" tabindex=\"-1\"> 描述</h3>\n<p>写出一个程序，接受一个十六进制的数，输出该数值的十进制表示。</p>\n<p>数据范围：保证结果在 1 \\le n \\le 2^{31}-1 \\1≤<em>n</em>≤231−1</p>\n<h3 id=\"输入描述-4\" tabindex=\"-1\"> 输入描述：</h3>\n<p>输入一个十六进制的数值字符串。</p>\n<h3 id=\"输出描述-4\" tabindex=\"-1\"> 输出描述：</h3>\n<p>输出该数值的十进制字符串。不同组的测试用例用\\n隔开。</p>\n<h3 id=\"示例1-4\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>0xAA\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>输出：</p>\n<div><pre><code>170\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h3 id=\"代码-4\" tabindex=\"-1\"> 代码：</h3>\n<h4 id=\"一、python3解法\" tabindex=\"-1\"> 一、python3解法</h4>\n<div><pre><code><span>while</span> <span>True</span><span>:</span>\n    <span>try</span><span>:</span>\n        <span>print</span><span>(</span><span>int</span><span>(</span><span>input</span><span>(</span><span>)</span><span>,</span><span>16</span><span>)</span><span>)</span>\n    <span>except</span><span>:</span>\n        <span>break</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>while</span> <span>True</span><span>:</span>\n    <span>try</span><span>:</span>\n        number <span>=</span> <span>input</span><span>(</span><span>)</span>\n        n <span>=</span> <span>len</span><span>(</span>number<span>)</span>\n        dic <span>=</span> <span>{</span><span>'0'</span><span>:</span><span>0</span><span>,</span><span>'1'</span><span>:</span><span>1</span><span>,</span><span>'2'</span><span>:</span><span>2</span><span>,</span><span>'3'</span><span>:</span><span>3</span><span>,</span><span>'4'</span><span>:</span><span>4</span><span>,</span><span>'5'</span><span>:</span><span>5</span><span>,</span><span>'6'</span><span>:</span><span>6</span><span>,</span><span>'7'</span><span>:</span><span>7</span><span>,</span><span>'8'</span><span>:</span><span>8</span><span>,</span><span>'9'</span><span>:</span><span>9</span><span>,</span><span>'A'</span><span>:</span><span>10</span><span>,</span><span>'B'</span><span>:</span><span>11</span><span>,</span><span>'C'</span><span>:</span><span>12</span><span>,</span><span>'D'</span><span>:</span><span>13</span><span>,</span><span>'E'</span><span>:</span><span>14</span><span>,</span><span>'F'</span><span>:</span><span>15</span><span>}</span>\n        final <span>=</span> <span>0</span>\n        <span>for</span> i <span>in</span> <span>range</span><span>(</span><span>2</span><span>,</span>n<span>)</span><span>:</span>\n            final <span>+=</span> dic<span>[</span>number<span>[</span>i<span>]</span><span>]</span><span>*</span><span>(</span><span>16</span><span>**</span><span>(</span>n<span>-</span>i<span>-</span><span>1</span><span>)</span><span>)</span>\n        <span>print</span><span>(</span>final<span>)</span>\n    <span>except</span><span>:</span>\n        <span>break</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"二、java\" tabindex=\"-1\"> 二、Java</h4>\n<ul>\n<li>substring(int a,int b)方法可以截断字符串，当只有一个参数时，截取范围是[a,length-1],当有两个参数时，截取范围是[a,b-1]。</li>\n<li>Integer.parseInt(String s,int a)方法可以转换进制，将字符串转换为“a”进制，只有一个参数s时，转换为10进制。</li>\n</ul>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>io<span>.</span></span><span>*</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span><span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>throws</span> <span>Exception</span><span>{</span>\n        <span>Scanner</span> sc <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>while</span><span>(</span>sc<span>.</span><span>hasNextLine</span><span>(</span><span>)</span><span>)</span><span>{</span>\n            <span>String</span> s <span>=</span> sc<span>.</span><span>nextLine</span><span>(</span><span>)</span><span>;</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>Integer</span><span>.</span><span>parseInt</span><span>(</span>s<span>.</span><span>substring</span><span>(</span><span>2</span><span>,</span>s<span>.</span><span>length</span><span>(</span><span>)</span><span>)</span><span>,</span><span>16</span><span>)</span><span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Scanner</span></span><span>;</span>\n<span>public</span> <span>class</span> <span>Main</span><span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span><span>{</span>\n        <span>Scanner</span> in <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>while</span><span>(</span>in<span>.</span><span>hasNext</span><span>(</span><span>)</span><span>)</span><span>{</span>\n            <span>String</span> str <span>=</span> in<span>.</span><span>nextLine</span><span>(</span><span>)</span><span>;</span>\n            <span>String</span> s1 <span>=</span> str<span>.</span><span>substring</span><span>(</span><span>2</span><span>)</span><span>;</span>\n            <span>int</span> a <span>=</span> <span>Integer</span><span>.</span><span>valueOf</span><span>(</span>s1<span>,</span><span>16</span><span>)</span><span>;</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>a<span>)</span><span>;</span>\n        <span>}</span>   \n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"hj8-合并表记录\" tabindex=\"-1\"> <strong>HJ8</strong> <strong>合并表记录</strong></h2>\n<h3 id=\"描述-5\" tabindex=\"-1\"> 描述</h3>\n<p>数据表记录包含表索引index和数值value（int范围的正整数），请对表索引相同的记录进行合并，即将相同索引的数值进行求和运算，输出按照index值升序进行输出。</p>\n<p>提示:</p>\n<p>0 &lt;= index &lt;= 11111111</p>\n<p>1 &lt;= value &lt;= 100000</p>\n<h3 id=\"输入描述-5\" tabindex=\"-1\"> 输入描述：</h3>\n<p>先输入键值对的个数n（1 &lt;= n &lt;= 500）\n接下来n行每行输入成对的index和value值，以空格隔开</p>\n<h3 id=\"输出描述-5\" tabindex=\"-1\"> 输出描述：</h3>\n<p>输出合并后的键值对（多行）</p>\n<h3 id=\"示例1-5\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>4\n0 1\n0 2\n1 2\n3 4\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>输出：</p>\n<div><pre><code>0 3\n1 2\n3 4\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h3 id=\"示例2\" tabindex=\"-1\"> 示例2</h3>\n<p>输入：</p>\n<div><pre><code>3\n0 1\n0 2\n8 9\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>输出：</p>\n<div><pre><code>0 3\n8 9\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h3 id=\"代码-5\" tabindex=\"-1\"> 代码：</h3>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>io<span>.</span></span><span>*</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span><span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>throws</span> <span>Exception</span><span>{</span>\n        <span>Scanner</span> sc <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>TreeMap</span><span><span>&lt;</span><span>Integer</span><span>,</span> <span>Integer</span><span>></span></span> map <span>=</span> <span>new</span> <span>TreeMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span> <span>// 输出结果要求有序！</span>\n       <span>while</span><span>(</span>sc<span>.</span><span>hasNextInt</span><span>(</span><span>)</span><span>)</span><span>{</span>\n            <span>int</span> n <span>=</span> sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n            <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> n<span>;</span> <span>++</span>i<span>)</span><span>{</span>\n                <span>int</span> a <span>=</span> sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n                <span>int</span> b <span>=</span> sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n                map<span>.</span><span>put</span><span>(</span>a<span>,</span>map<span>.</span><span>getOrDefault</span><span>(</span>a<span>,</span><span>0</span><span>)</span> <span>+</span> b<span>)</span><span>;</span>\n            <span>}</span>\n       <span>}</span>\n       <span>for</span> <span>(</span><span>Integer</span> i <span>:</span> map<span>.</span><span>keySet</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n           <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>i <span>+</span> <span>\" \"</span> <span>+</span> map<span>.</span><span>get</span><span>(</span>i<span>)</span><span>)</span><span>;</span>\n       <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span> agv<span>[</span><span>]</span><span>)</span> <span>{</span>\n      <span>Scanner</span> scanner <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n      <span>int</span> tableSize <span>=</span> scanner<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n      <span>Map</span><span><span>&lt;</span><span>Integer</span><span>,</span> <span>Integer</span><span>></span></span> table <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span>tableSize<span>)</span><span>;</span>\n      <span>for</span> <span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> tableSize<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n          <span>int</span> key <span>=</span> scanner<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n          <span>int</span> value <span>=</span> scanner<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n          <span>if</span> <span>(</span>table<span>.</span><span>containsKey</span><span>(</span>key<span>)</span><span>)</span> <span>{</span>\n              table<span>.</span><span>put</span><span>(</span>key<span>,</span> table<span>.</span><span>get</span><span>(</span>key<span>)</span> <span>+</span> value<span>)</span><span>;</span>\n          <span>}</span> <span>else</span> <span>{</span>\n              table<span>.</span><span>put</span><span>(</span>key<span>,</span> value<span>)</span><span>;</span>\n          <span>}</span>\n      <span>}</span>\n       <span>for</span> <span>(</span><span>Integer</span> key <span>:</span> table<span>.</span><span>keySet</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n          <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span> key <span>+</span> <span>\" \"</span> <span>+</span> table<span>.</span><span>get</span><span>(</span>key<span>)</span><span>)</span><span>;</span>\n      <span>}</span>\n  <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"hj14-字符串排序\" tabindex=\"-1\"> <strong>HJ14</strong> <strong>字符串排序</strong></h2>\n<h3 id=\"描述-6\" tabindex=\"-1\"> 描述</h3>\n<p>给定 n 个字符串，请对 n 个字符串按照字典序排列。</p>\n<p>数据范围： 1 \\le n \\le 1000 \\1≤<em>n</em>≤1000 ，字符串长度满足 1 \\le len \\le 100 \\1≤<em>l<strong>e</strong>n</em>≤100</p>\n<h3 id=\"输入描述-6\" tabindex=\"-1\"> 输入描述：</h3>\n<p>输入第一行为一个正整数n(1≤n≤1000),下面n行为n个字符串(字符串长度≤100),字符串中只含有大小写字母。</p>\n<h3 id=\"输出描述-6\" tabindex=\"-1\"> 输出描述：</h3>\n<p>数据输出n行，输出结果为按照字典序排列的字符串。</p>\n<h3 id=\"示例1-6\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>9\ncap\nto\ncat\ncard\ntwo\ntoo\nup\nboat\nboot\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>输出：</p>\n<div><pre><code>boat\nboot\ncap\ncard\ncat\nto\ntoo\ntwo\nup\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>只需要按字典排列字符串，可以调用Arrays.sort API，也可以使用PriorityQueue，还可以自己实现Comparator，三种方法测试了一下用时相差不大。</p>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>io<span>.</span></span><span>*</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>throws</span> <span>IOException</span> <span>{</span>\n        <span>withPriorityQueue</span><span>(</span><span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>// 方法一: 调用API Arrays.sort</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>withArraysAPI</span><span>(</span><span>)</span> <span>throws</span> <span>IOException</span> <span>{</span>\n        <span>BufferedReader</span> br <span>=</span> <span>new</span> <span>BufferedReader</span><span>(</span><span>new</span> <span>InputStreamReader</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>)</span><span>;</span>\n        <span>int</span> n <span>=</span> <span>Integer</span><span>.</span><span>parseInt</span><span>(</span>br<span>.</span><span>readLine</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>String</span><span>[</span><span>]</span> ss <span>=</span> <span>new</span> <span>String</span><span>[</span>n<span>]</span><span>;</span>\n        <span>for</span> <span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> n<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            ss<span>[</span>i<span>]</span> <span>=</span> br<span>.</span><span>readLine</span><span>(</span><span>)</span><span>;</span>\n        <span>}</span>\n        br<span>.</span><span>close</span><span>(</span><span>)</span><span>;</span>\n\n        <span>Arrays</span><span>.</span><span>sort</span><span>(</span>ss<span>)</span><span>;</span>\n\n        <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> n<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>ss<span>[</span>i<span>]</span><span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n\n    <span>// 方法二: 使用PriorityQueue</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>withPriorityQueue</span><span>(</span><span>)</span> <span>throws</span> <span>IOException</span> <span>{</span>\n        <span>BufferedReader</span> br <span>=</span> <span>new</span> <span>BufferedReader</span><span>(</span><span>new</span> <span>InputStreamReader</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>)</span><span>;</span>\n        <span>int</span> n <span>=</span> <span>Integer</span><span>.</span><span>parseInt</span><span>(</span>br<span>.</span><span>readLine</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>PriorityQueue</span><span><span>&lt;</span><span>String</span><span>></span></span> pq <span>=</span> <span>new</span> <span>PriorityQueue</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        <span>String</span> s <span>=</span> <span>\"\"</span><span>;</span>\n        <span>while</span> <span>(</span><span>(</span>s <span>=</span> br<span>.</span><span>readLine</span><span>(</span><span>)</span><span>)</span> <span>!=</span> <span>null</span><span>)</span> <span>{</span>\n            pq<span>.</span><span>offer</span><span>(</span>s<span>)</span><span>;</span>\n        <span>}</span>\n        br<span>.</span><span>close</span><span>(</span><span>)</span><span>;</span>\n\n        <span>while</span> <span>(</span><span>!</span>pq<span>.</span><span>isEmpty</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>pq<span>.</span><span>poll</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>}</span>        \n    <span>}</span>\n\n    <span>// 方法三: 使用list并自己实现Comparator, 比较能体现算法的思路</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>withComparator</span><span>(</span><span>)</span> <span>throws</span> <span>IOException</span> <span>{</span>\n        <span>BufferedReader</span> br <span>=</span> <span>new</span> <span>BufferedReader</span><span>(</span><span>new</span> <span>InputStreamReader</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>)</span><span>;</span>\n        <span>int</span> n <span>=</span> <span>Integer</span><span>.</span><span>parseInt</span><span>(</span>br<span>.</span><span>readLine</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>List</span><span><span>&lt;</span><span>String</span><span>></span></span> list <span>=</span> <span>new</span> <span>ArrayList</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        <span>String</span> s <span>=</span> <span>\"\"</span><span>;</span>\n        <span>while</span> <span>(</span><span>(</span>s <span>=</span> br<span>.</span><span>readLine</span><span>(</span><span>)</span><span>)</span> <span>!=</span> <span>null</span><span>)</span> <span>{</span>\n            list<span>.</span><span>add</span><span>(</span>s<span>)</span><span>;</span>\n        <span>}</span>\n        br<span>.</span><span>close</span><span>(</span><span>)</span><span>;</span>\n\n        list<span>.</span><span>sort</span><span>(</span><span>new</span> <span>Comparator</span><span><span>&lt;</span><span>String</span><span>></span></span><span>(</span><span>)</span> <span>{</span>\n            <span>@Override</span>\n            <span>public</span> <span>int</span> <span>compare</span><span>(</span><span>String</span> s1<span>,</span> <span>String</span> s2<span>)</span> <span>{</span>\n                <span>int</span> i <span>=</span> <span>0</span><span>;</span>\n                <span>while</span> <span>(</span>i <span>&lt;</span> s1<span>.</span><span>length</span><span>(</span><span>)</span> <span>&amp;&amp;</span> i <span>&lt;</span> s2<span>.</span><span>length</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n                    <span>if</span> <span>(</span>s1<span>.</span><span>charAt</span><span>(</span>i<span>)</span> <span>!=</span> s2<span>.</span><span>charAt</span><span>(</span>i<span>)</span><span>)</span> <span>{</span>\n                        <span>return</span> <span>(</span>s1<span>.</span><span>charAt</span><span>(</span>i<span>)</span> <span>></span> s2<span>.</span><span>charAt</span><span>(</span>i<span>)</span><span>)</span><span>?</span> <span>1</span><span>:</span> <span>-</span><span>1</span><span>;</span>\n                    <span>}</span>\n                    i<span>++</span><span>;</span>\n                <span>}</span>\n                <span>if</span> <span>(</span>s1<span>.</span><span>length</span><span>(</span><span>)</span> <span>==</span> s2<span>.</span><span>length</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n                    <span>return</span> <span>0</span><span>;</span>\n                <span>}</span> <span>else</span> <span>{</span>\n                    <span>return</span> <span>(</span>s1<span>.</span><span>length</span><span>(</span><span>)</span> <span>></span> s2<span>.</span><span>length</span><span>(</span><span>)</span><span>)</span><span>?</span> <span>1</span><span>:</span> <span>-</span><span>1</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n        <span>}</span><span>)</span><span>;</span>\n\n        <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> list<span>.</span><span>size</span><span>(</span><span>)</span><span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>list<span>.</span><span>get</span><span>(</span>i<span>)</span><span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>  \n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"hj20-密码验证合格程序\" tabindex=\"-1\"> <strong>HJ20</strong> <strong>密码验证合格程序</strong></h2>\n<h3 id=\"描述-7\" tabindex=\"-1\"> 描述</h3>\n<p>密码要求:</p>\n<p>1.长度超过8位</p>\n<p>2.包括大小写字母.数字.其它符号,以上四种至少三种</p>\n<p>3.不能有长度大于2的包含公共元素的子串重复 （注：其他符号不含空格或换行）</p>\n<p>数据范围：输入的字符串长度满足 1 \\le n \\le 100 \\1≤<em>n</em>≤100</p>\n<h4 id=\"输入描述-7\" tabindex=\"-1\"> 输入描述：</h4>\n<p>一组字符串。</p>\n<h4 id=\"输出描述-7\" tabindex=\"-1\"> 输出描述：</h4>\n<p>如果符合要求输出：OK，否则输出NG</p>\n<h3 id=\"示例1-7\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>021Abc9000\n021Abc9Abc1\n021ABC9000\n021$bc9000\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>复制</p>\n<p>输出：</p>\n<div><pre><code>OK\nNG\nNG\nOK\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><h3 id=\"题目主要信息\" tabindex=\"-1\"> 题目主要信息</h3>\n<p>1、检验输入的密码是否合格</p>\n<p>2、密码要求如下</p>\n<ul>\n<li>\n<p>长度超过8位</p>\n</li>\n<li>\n<p>密码要求:</p>\n<p>1.长度超过8位</p>\n<p>2.包括大小写字母.数字.其它符号,以上四种至少三种</p>\n<p>3.不能有长度大于2的不含公共元素的子串重复 （注：其他符号不含空格或换行）</p>\n</li>\n</ul>\n<h3 id=\"方法一-暴力\" tabindex=\"-1\"> 方法一：暴力</h3>\n<h4 id=\"具体方法\" tabindex=\"-1\"> 具体方法</h4>\n<p>按照密码的要求，依次遍历验证即可。</p>\n<p>1、首先验证长度是否大于8，不满足直接输出NG并继续 2、验证是否包含三种以上的字符 3、验证是否存在重复子串，并且长度大于等于3 这里主要给出第三步的详解，前两步的直接遍历求解即可。 第三步可以使用类似窗口的方法，因为要求最长重复子串不能大于2，所以就把窗口的大小设置为3。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/4C136CEEE2387171DC8F01C8018C819E.gif\" alt=\"alt\"></p>\n<h4 id=\"java代码\" tabindex=\"-1\"> Java代码</h4>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>io<span>.</span></span><span>BufferedReader</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>io<span>.</span></span><span>IOException</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>io<span>.</span></span><span>InputStreamReader</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>throws</span> <span>IOException</span> <span>{</span>\n        <span>BufferedReader</span> bf <span>=</span> <span>new</span> <span>BufferedReader</span><span>(</span><span>new</span> <span>InputStreamReader</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>)</span><span>;</span>\n        <span>String</span> s<span>;</span>\n        <span>while</span><span>(</span><span>(</span>s <span>=</span> bf<span>.</span><span>readLine</span><span>(</span><span>)</span><span>)</span><span>!=</span><span>null</span><span>)</span><span>{</span>\n            <span>//1.长度超过8位</span>\n            <span>if</span><span>(</span>s<span>.</span><span>length</span><span>(</span><span>)</span> <span>&lt;=</span> <span>8</span><span>)</span><span>{</span>\n                <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"NG\"</span><span>)</span><span>;</span>\n                <span>continue</span><span>;</span>\n            <span>}</span>\n            <span>//2.包括大小写字母.数字.其它符号,以上四种至少三种</span>\n            <span>int</span> count<span>[</span><span>]</span> <span>=</span> <span>new</span> <span>int</span><span>[</span><span>4</span><span>]</span><span>;</span><span>//记录出现个数</span>\n            <span>for</span><span>(</span><span>int</span> i<span>=</span><span>0</span><span>;</span>i<span>&lt;</span>s<span>.</span><span>length</span><span>(</span><span>)</span><span>;</span>i<span>++</span><span>)</span><span>{</span>\n                <span>if</span><span>(</span>s<span>.</span><span>charAt</span><span>(</span>i<span>)</span> <span>>=</span> <span>'A'</span><span>&amp;&amp;</span> s<span>.</span><span>charAt</span><span>(</span>i<span>)</span><span>&lt;=</span><span>'Z'</span> <span>)</span><span>{</span>\n                    count<span>[</span><span>0</span><span>]</span> <span>=</span> <span>1</span><span>;</span>\n                <span>}</span><span>else</span> <span>if</span><span>(</span>s<span>.</span><span>charAt</span><span>(</span>i<span>)</span> <span>>=</span> <span>'a'</span><span>&amp;&amp;</span> s<span>.</span><span>charAt</span><span>(</span>i<span>)</span><span>&lt;=</span><span>'z'</span> <span>)</span><span>{</span>\n                    count<span>[</span><span>1</span><span>]</span> <span>=</span> <span>1</span><span>;</span>\n                <span>}</span><span>else</span> <span>if</span><span>(</span>s<span>.</span><span>charAt</span><span>(</span>i<span>)</span> <span>>=</span> <span>'0'</span><span>&amp;&amp;</span> s<span>.</span><span>charAt</span><span>(</span>i<span>)</span><span>&lt;=</span><span>'9'</span> <span>)</span><span>{</span>\n                    count<span>[</span><span>2</span><span>]</span> <span>=</span> <span>1</span><span>;</span>\n                <span>}</span><span>else</span> <span>{</span>\n                    count<span>[</span><span>3</span><span>]</span> <span>=</span> <span>1</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n            <span>if</span><span>(</span>count<span>[</span><span>0</span><span>]</span><span>+</span>count<span>[</span><span>1</span><span>]</span><span>+</span>count<span>[</span><span>2</span><span>]</span><span>+</span>count<span>[</span><span>3</span><span>]</span><span>&lt;</span><span>3</span><span>)</span><span>{</span>\n                <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"NG\"</span><span>)</span><span>;</span>\n                <span>continue</span><span>;</span>\n            <span>}</span>\n            <span>//3.不能有长度大于2的不含公共元素的子串重复 （注：其他符号不含空格或换行）</span>\n            <span>if</span><span>(</span><span>getString</span><span>(</span>s<span>,</span><span>0</span><span>,</span><span>3</span><span>)</span><span>)</span><span>{</span>\n                <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"NG\"</span><span>)</span><span>;</span>\n                <span>continue</span><span>;</span>\n            <span>}</span> <span>else</span> <span>{</span>\n                <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"OK\"</span><span>)</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n    <span>}</span>\n    <span>//检测是否存在长度大于3的重复子串</span>\n     <span>static</span> <span>boolean</span> <span>getString</span><span>(</span><span>String</span> str<span>,</span><span>int</span> l<span>,</span><span>int</span> r<span>)</span> <span>{</span>\n         <span>if</span> <span>(</span>r <span>>=</span> str<span>.</span><span>length</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n             <span>return</span> <span>false</span><span>;</span>\n         <span>}</span>\n         <span>if</span> <span>(</span>str<span>.</span><span>substring</span><span>(</span>r<span>)</span><span>.</span><span>contains</span><span>(</span>str<span>.</span><span>substring</span><span>(</span>l<span>,</span> r<span>)</span><span>)</span><span>)</span> <span>{</span>\n             <span>return</span> <span>true</span><span>;</span>\n         <span>}</span> <span>else</span> <span>{</span>\n             <span>return</span> <span>getString</span><span>(</span>str<span>,</span> l <span>+</span> <span>1</span><span>,</span> r <span>+</span> <span>1</span><span>)</span><span>;</span>\n         <span>}</span>\n     <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"复杂度分析\" tabindex=\"-1\"> 复杂度分析</h4>\n<ul>\n<li>时间复杂度：O(n2)O(n^2)<em>O</em>(<em>n</em>2)，n为单次密码长度，验证重复子串两层循环遍历字符串</li>\n<li>空间复杂度：O(1)O(1)<em>O</em>(1)，字符串s属于必要空间</li>\n</ul>\n<h3 id=\"方法二-正则表达式\" tabindex=\"-1\"> 方法二：正则表达式</h3>\n<h4 id=\"具体做法\" tabindex=\"-1\"> 具体做法</h4>\n<p>匹配小写字母、大写字母、数字、其他字符，还是匹配串中前后连续三个一样的字符，我们都可以用正则表达式。只要把正则表达式写出来即可</p>\n<h4 id=\"java代码-1\" tabindex=\"-1\"> Java代码</h4>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>io<span>.</span></span><span>BufferedReader</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>io<span>.</span></span><span>IOException</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>io<span>.</span></span><span>InputStreamReader</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span>regex<span>.</span></span><span>Matcher</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span>regex<span>.</span></span><span>Pattern</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>throws</span> <span>IOException</span> <span>{</span>\n        <span>BufferedReader</span> bf <span>=</span> <span>new</span> <span>BufferedReader</span><span>(</span><span>new</span> <span>InputStreamReader</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>)</span><span>;</span>\n        <span>String</span> s<span>;</span>\n        <span>while</span> <span>(</span><span>(</span>s <span>=</span> bf<span>.</span><span>readLine</span><span>(</span><span>)</span><span>)</span><span>!=</span><span>null</span><span>)</span> <span>{</span>\n            <span>// 长度check, 相同长度超2的子串重复check</span>\n            <span>if</span> <span>(</span>s<span>.</span><span>length</span><span>(</span><span>)</span> <span>&lt;=</span> <span>8</span> <span>)</span> <span>{</span>\n                <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"NG\"</span><span>)</span><span>;</span>\n                <span>continue</span><span>;</span>\n            <span>}</span>\n            <span>// 大小写字母.数字.其它符号check</span>\n            <span>String</span><span>[</span><span>]</span> regexes <span>=</span> <span>{</span><span>\"\\\\d\"</span><span>,</span> <span>\"[a-z]\"</span><span>,</span> <span>\"[A-Z]\"</span><span>,</span> <span>\"[^\\\\da-zA-Z]\"</span><span>}</span><span>;</span>\n            <span>int</span> types <span>=</span> <span>0</span><span>;</span>\n            <span>for</span> <span>(</span><span>String</span> re <span>:</span> regexes<span>)</span> <span>{</span>\n                <span>Pattern</span> p <span>=</span> <span>Pattern</span><span>.</span><span>compile</span><span>(</span>re<span>)</span><span>;</span>\n                <span>Matcher</span> m <span>=</span> p<span>.</span><span>matcher</span><span>(</span>s<span>)</span><span>;</span>\n                <span>if</span> <span>(</span>m<span>.</span><span>find</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n                    types <span>+=</span> <span>1</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n            <span>if</span><span>(</span>types<span>&lt;</span><span>3</span><span>)</span><span>{</span>\n                <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"NG\"</span><span>)</span><span>;</span>\n                <span>continue</span><span>;</span>\n            <span>}</span>\n          <span>//匹配串前后连续3个字符一样的 </span>\n         <span>//public String replaceAll(String replacement)</span>\n\t\t <span>//替换模式与给定替换字符串相匹配的输入中存在长度大于2的不含公共元素的子串重复 删除一个重复字串长度显然变短了 这时输入NG</span>\n            <span>if</span><span>(</span>s<span>.</span><span>replaceAll</span><span>(</span><span>\"(.{3,})(?=.{3,}\\\\1)\"</span><span>,</span> <span>\"\"</span><span>)</span><span>.</span><span>length</span><span>(</span><span>)</span> <span>&lt;</span> s<span>.</span><span>length</span><span>(</span><span>)</span><span>)</span><span>{</span>\n                <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"NG\"</span><span>)</span><span>;</span>\n                <span>continue</span><span>;</span>\n            <span>}</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"OK\"</span><span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"复杂度分析-1\" tabindex=\"-1\"> 复杂度分析</h4>\n<ul>\n<li>时间复杂度：O(n)O(n)<em>O</em>(<em>n</em>)，正则表达式匹配复杂度为O(n)O(n)<em>O</em>(<em>n</em>)</li>\n<li>空间复杂度：O(1)O(1)<em>O</em>(1)，常数级空间，字符串s属于必要空间</li>\n</ul>\n<h2 id=\"hj23-删除字符串中出现次数最少的字符\" tabindex=\"-1\"> <strong>HJ23</strong> <strong>删除字符串中出现次数最少的字符</strong></h2>\n<h3 id=\"描述-8\" tabindex=\"-1\"> 描述</h3>\n<p>实现删除字符串中出现次数最少的字符，若出现次数最少的字符有多个，则把出现次数最少的字符都删除。输出删除这些单词后的字符串，字符串中其它字符保持原来的顺序。</p>\n<p>数据范围：输入的字符串长度满足 1 \\le n \\le 20 \\1≤<em>n</em>≤20 ，保证输入的字符串中仅出现小写字母</p>\n<h3 id=\"输入描述-8\" tabindex=\"-1\"> 输入描述：</h3>\n<p>字符串只包含小写英文字母, 不考虑非法输入，输入的字符串长度小于等于20个字节。</p>\n<h3 id=\"输出描述-8\" tabindex=\"-1\"> 输出描述：</h3>\n<p>删除字符串中出现次数最少的字符后的字符串。</p>\n<h3 id=\"示例1-8\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>aabcddd\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>输出：</p>\n<div><pre><code>aaddd\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h3 id=\"_1-哈希表-时间o-n-空间o-1\" tabindex=\"-1\"> 1.哈希表，时间O(N)，空间O(1)</h3>\n<div><pre><code><span>public</span> <span>String</span> <span>delete</span><span>(</span><span>String</span> str<span>)</span> <span>{</span>\n        <span>// Map记录每个字母的次数</span>\n        <span>Map</span><span><span>&lt;</span><span>Character</span><span>,</span> <span>Integer</span><span>></span></span> map <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        <span>for</span> <span>(</span><span>char</span> ch <span>:</span> str<span>.</span><span>toCharArray</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n            map<span>.</span><span>put</span><span>(</span>ch<span>,</span> map<span>.</span><span>getOrDefault</span><span>(</span>ch<span>,</span> <span>0</span><span>)</span> <span>+</span> <span>1</span><span>)</span><span>;</span>\n        <span>}</span>\n        <span>// 快速找出最少次数</span>\n        <span>int</span> min <span>=</span> <span>Integer</span><span>.</span>MAX_VALUE<span>;</span>\n        <span>for</span> <span>(</span><span>int</span> times <span>:</span> map<span>.</span><span>values</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n            min <span>=</span> <span>Math</span><span>.</span><span>min</span><span>(</span>min<span>,</span> times<span>)</span><span>;</span>\n        <span>}</span>\n        <span>StringBuilder</span> res <span>=</span> <span>new</span> <span>StringBuilder</span><span>(</span><span>)</span><span>;</span>\n        <span>for</span> <span>(</span><span>char</span> ch <span>:</span> str<span>.</span><span>toCharArray</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n            <span>if</span> <span>(</span>map<span>.</span><span>get</span><span>(</span>ch<span>)</span> <span>!=</span> min<span>)</span> <span>{</span>\n                res<span>.</span><span>append</span><span>(</span>ch<span>)</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n        <span>return</span> res<span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span>\n    <span>}</span>\n \n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>{</span>\n        <span>Main</span> solution <span>=</span> <span>new</span> <span>Main</span><span>(</span><span>)</span><span>;</span>\n        <span>Scanner</span> in <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>while</span> <span>(</span>in<span>.</span><span>hasNextLine</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n            <span>String</span> str <span>=</span> in<span>.</span><span>nextLine</span><span>(</span><span>)</span><span>;</span>\n            <span>String</span> res <span>=</span> solution<span>.</span><span>delete</span><span>(</span>str<span>)</span><span>;</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>res<span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"_2\" tabindex=\"-1\"> 2.</h3>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Collections</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>HashMap</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Scanner</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>{</span>\n        <span>Scanner</span> scanner <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>while</span> <span>(</span>scanner<span>.</span><span>hasNext</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n            <span>String</span> s <span>=</span> scanner<span>.</span><span>nextLine</span><span>(</span><span>)</span><span>;</span>\n            <span>char</span><span>[</span><span>]</span> chars <span>=</span> s<span>.</span><span>toCharArray</span><span>(</span><span>)</span><span>;</span>\n            <span>//统计每个字母的数量</span>\n            <span>HashMap</span><span><span>&lt;</span><span>Character</span><span>,</span> <span>Integer</span><span>></span></span> map <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n            <span>for</span> <span>(</span><span>char</span> aChar <span>:</span> chars<span>)</span> <span>{</span>\n                map<span>.</span><span>put</span><span>(</span>aChar<span>,</span> <span>(</span>map<span>.</span><span>getOrDefault</span><span>(</span>aChar<span>,</span> <span>0</span><span>)</span> <span>+</span> <span>1</span><span>)</span><span>)</span><span>;</span>\n            <span>}</span>\n            <span>//找到数量最少的字符数量</span>\n            <span>Collection</span><span><span>&lt;</span><span>Integer</span><span>></span></span> values <span>=</span> map<span>.</span><span>values</span><span>(</span><span>)</span><span>;</span>\n            <span>Integer</span> min <span>=</span> <span>Collections</span><span>.</span><span>min</span><span>(</span>values<span>)</span><span>;</span>\n\n            <span>//用空字符串替换该字母</span>\n            <span>for</span> <span>(</span><span>Character</span> character <span>:</span> map<span>.</span><span>keySet</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n                <span>if</span> <span>(</span>map<span>.</span><span>get</span><span>(</span>character<span>)</span> <span>==</span> min<span>)</span><span>{</span>\n                    s <span>=</span> s<span>.</span><span>replaceAll</span><span>(</span><span>String</span><span>.</span><span>valueOf</span><span>(</span>character<span>)</span><span>,</span> <span>\"\"</span><span>)</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>s<span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><ol start=\"3\">\n<li></li>\n</ol>\n<p>题目主要意思</p>\n<p>1、删除一个字符串中出现次数最少的字符，若多个字符出现次数一样，都删除。</p>\n<p>2、字符串需要保持原来的顺序</p>\n<p>3、字符串只包含小写字母</p>\n<p>4、多行输入输出</p>\n<h3 id=\"方法一-暴力法\" tabindex=\"-1\"> 方法一：暴力法</h3>\n<h4 id=\"具体做法-1\" tabindex=\"-1\"> 具体做法</h4>\n<ol>\n<li>直接遍历字符串，将字符串存入到数组中，将字符串转成ASCII格式的，也就是都在128个ASCII里，设置一个26大小的数组即可，因为题目里说了只包含小写字母。</li>\n<li>遍历字符串后将字符对应的ASCII的个数存入对应的数组中。</li>\n<li>遍历数组找到最小的个数</li>\n<li>遍历数组，如果当前字符出现的个数等于最小个数，则被替换掉。</li>\n</ol>\n<h4 id=\"java代码-2\" tabindex=\"-1\"> Java代码</h4>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>io<span>.</span></span><span>*</span></span><span>;</span>\n<span>public</span> <span>class</span> <span>Main</span><span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span><span>throws</span> <span>IOException</span><span>{</span>\n        <span>BufferedReader</span> bf <span>=</span> <span>new</span> <span>BufferedReader</span><span>(</span><span>new</span> <span>InputStreamReader</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>)</span><span>;</span>\n        <span>String</span> str <span>;</span>\n        <span>while</span> <span>(</span><span>(</span>str <span>=</span> bf<span>.</span><span>readLine</span><span>(</span><span>)</span><span>)</span> <span>!=</span> <span>null</span> <span>&amp;&amp;</span> <span>!</span>str<span>.</span><span>equals</span><span>(</span><span>\"\"</span><span>)</span><span>)</span> <span>{</span>\n            <span>char</span> <span>[</span><span>]</span>chars <span>=</span> str<span>.</span><span>toCharArray</span><span>(</span><span>)</span><span>;</span>\n            <span>// 题目所给出的都是小写字母 共计26个 a~z</span>\n            <span>int</span><span>[</span><span>]</span> temp <span>=</span> <span>new</span> <span>int</span><span>[</span><span>26</span><span>]</span><span>;</span>\n            <span>for</span> <span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> chars<span>.</span>length<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n                <span>//找到当前字符在数组中的位置 比如97对应的是a的ASCII码，</span>\n                <span>int</span> index <span>=</span> chars<span>[</span>i<span>]</span> <span>-</span> <span>97</span><span>;</span>\n                temp<span>[</span>index<span>]</span> <span>=</span> temp<span>[</span>index<span>]</span> <span>+</span> <span>1</span><span>;</span>\n            <span>}</span>\n            <span>//找到次数最少的个数 </span>\n            <span>int</span> min <span>=</span> <span>Integer</span><span>.</span>MAX_VALUE<span>;</span>\n            <span>for</span> <span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> <span>26</span><span>;</span> i<span>++</span><span>)</span> <span>{</span>\n                <span>// 跳过</span>\n                <span>if</span> <span>(</span>temp<span>[</span>i<span>]</span> <span>!=</span> <span>0</span><span>)</span> <span>{</span>\n                    min <span>=</span> <span>Math</span><span>.</span><span>min</span><span>(</span>min<span>,</span>temp<span>[</span>i<span>]</span><span>)</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n            <span>// 开始删除最小 </span>\n            <span>for</span> <span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> <span>26</span><span>;</span> i<span>++</span><span>)</span> <span>{</span>\n                <span>if</span> <span>(</span>temp<span>[</span>i<span>]</span> <span>==</span> min<span>)</span> <span>{</span>\n                    <span>char</span> ch <span>=</span> <span>(</span><span>char</span><span>)</span> <span>(</span><span>'a'</span> <span>+</span> i<span>)</span><span>;</span>\n                    str <span>=</span> str<span>.</span><span>replace</span><span>(</span>ch <span>+</span> <span>\"\"</span><span>,</span> <span>\"\"</span><span>)</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>str<span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"复杂度分析-2\" tabindex=\"-1\"> 复杂度分析</h4>\n<ul>\n<li>时间复杂度：O(n)O(n)<em>O</em>(<em>n</em>),需要遍历字符串和数组。</li>\n<li>空间复杂度：O(n)O(n)<em>O</em>(<em>n</em>),临时数组temp。</li>\n</ul>\n<h3 id=\"方法二-借助hashmap来存储\" tabindex=\"-1\"> 方法二：借助HashMap来存储</h3>\n<h4 id=\"具体做法-2\" tabindex=\"-1\"> 具体做法</h4>\n<p>遍历字符串，将字符存入HashMap中，在遍历HashMap找到最小的values，在遍历一遍HashMap把不等于最小values的记录，最后输出。</p>\n<p>举例说明：aabcddd</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/D5EF2862C00A21BBFC433ECCC33C4476.gif\" alt=\"alt\"></p>\n<h4 id=\"java代码-3\" tabindex=\"-1\"> Java代码</h4>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>io<span>.</span></span><span>BufferedReader</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>io<span>.</span></span><span>IOException</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>io<span>.</span></span><span>InputStreamReader</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>HashMap</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>String</span> <span>delete</span><span>(</span><span>String</span> str<span>)</span> <span>{</span>\n        <span>// Map记录每个字母的次数</span>\n        <span>HashMap</span><span><span>&lt;</span><span>Character</span><span>,</span> <span>Integer</span><span>></span></span> map <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        <span>for</span> <span>(</span><span>char</span> ch <span>:</span> str<span>.</span><span>toCharArray</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n            <span>//将每个字符存入其中</span>\n            map<span>.</span><span>put</span><span>(</span>ch<span>,</span> map<span>.</span><span>getOrDefault</span><span>(</span>ch<span>,</span> <span>1</span><span>)</span> <span>+</span> <span>1</span><span>)</span><span>;</span>\n        <span>}</span>\n        <span>// 快速找出最少次数</span>\n        <span>int</span> min <span>=</span> <span>Integer</span><span>.</span>MAX_VALUE<span>;</span>\n        <span>for</span> <span>(</span><span>int</span> times <span>:</span> map<span>.</span><span>values</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n            min <span>=</span> <span>Math</span><span>.</span><span>min</span><span>(</span>min<span>,</span> times<span>)</span><span>;</span>\n        <span>}</span>\n        <span>//最后输出的值</span>\n        <span>StringBuilder</span> result <span>=</span> <span>new</span> <span>StringBuilder</span><span>(</span><span>)</span><span>;</span>\n        <span>for</span> <span>(</span><span>char</span> ch <span>:</span> str<span>.</span><span>toCharArray</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n            <span>if</span> <span>(</span>map<span>.</span><span>get</span><span>(</span>ch<span>)</span> <span>!=</span> min<span>)</span> <span>{</span>\n                result<span>.</span><span>append</span><span>(</span>ch<span>)</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n        <span>return</span> result<span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>throws</span> <span>IOException</span> <span>{</span>\n        <span>BufferedReader</span> bf <span>=</span> <span>new</span> <span>BufferedReader</span><span>(</span><span>new</span> <span>InputStreamReader</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>)</span><span>;</span>\n        <span>String</span> s<span>;</span>\n        <span>while</span> <span>(</span><span>(</span>s <span>=</span> bf<span>.</span><span>readLine</span><span>(</span><span>)</span><span>)</span><span>!=</span><span>null</span><span>)</span> <span>{</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>delete</span><span>(</span>s<span>)</span><span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"复杂度分析-3\" tabindex=\"-1\"> 复杂度分析</h4>\n<ul>\n<li>时间复杂度：O(n),需要多次遍历字符串和Map，但都不存在嵌套遍历。</li>\n<li>空间复杂度：O(n),借助了Map存储</li>\n</ul>\n<h2 id=\"hj25-数据分类处理\" tabindex=\"-1\"> <strong>HJ25</strong> <strong>数据分类处理</strong></h2>\n<h3 id=\"描述-9\" tabindex=\"-1\"> 描述</h3>\n<p>信息社会，有海量的数据需要分析处理，比如公安局分析身份证号码、 QQ 用户、手机号码、银行帐号等信息及活动记录。</p>\n<p>采集输入大数据和分类规则，通过大数据分类处理程序，将大数据分类输出。</p>\n<p>数据范围：1 \\le I,R \\le 100 \\1≤<em>I</em>,<em>R</em>≤100 ，输入的整数大小满足 0 \\le val \\le 2^{31}-1\\0≤<em>v<strong>a</strong>l</em>≤231−1</p>\n<h3 id=\"输入描述-9\" tabindex=\"-1\"> 输入描述：</h3>\n<p>一组输入整数序列I和一组规则整数序列R，I和R序列的第一个整数为序列的个数（个数不包含第一个整数）；整数范围为0~(2^31)-1，序列个数不限</p>\n<h3 id=\"输出描述-9\" tabindex=\"-1\"> 输出描述：</h3>\n<p>从R依次中取出R，对I进行处理，找到满足条件的I：</p>\n<p>I整数对应的数字需要连续包含R对应的数字。比如R为23，I为231，那么I包含了R，条件满足 。</p>\n<p>按R从小到大的顺序:</p>\n<p>(1)先输出R；</p>\n<p>(2)再输出满足条件的I的个数；</p>\n<p>(3)然后输出满足条件的I在I序列中的位置索引(从0开始)；</p>\n<p>(4)最后再输出I。</p>\n<p>附加条件：</p>\n<p>(1)R需要从小到大排序。相同的R只需要输出索引小的以及满足条件的I，索引大的需要过滤掉</p>\n<p>(2)如果没有满足条件的I，对应的R不用输出</p>\n<p>(3)最后需要在输出序列的第一个整数位置记录后续整数序列的个数(不包含“个数”本身)</p>\n<p>序列I：15,123,456,786,453,46,7,5,3,665,453456,745,456,786,453,123（第一个15表明后续有15个整数）</p>\n<p>序列R：5,6,3,6,3,0（第一个5表明后续有5个整数）</p>\n<p>输出：<em>30, 3,6,0,123</em>,3,453,7,3,9,453456,13,453,14,123,6,7,1,456,2,786,4,46,8,665,9,453456,11,456,12,786</p>\n<p>说明：</p>\n<p><em>30</em>----后续有30个整数</p>\n<p><em>3</em>----从小到大排序，第一个R为0，但没有满足条件的I，不输出0，而下一个R是3</p>\n<p><em>6---</em> <em>存在6个包含3的I</em></p>\n<p><em>0---</em> <em>123所在的原序号为0</em></p>\n<p><em>123---</em> <em>123包含3，满足条件</em></p>\n<h3 id=\"示例1-9\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>15 123 456 786 453 46 7 5 3 665 453456 745 456 786 453 123\n5 6 3 6 3 0\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>输出：</p>\n<div><pre><code>30 3 6 0 123 3 453 7 3 9 453456 13 453 14 123 6 7 1 456 2 786 4 46 8 665 9 453456 11 456 12 786\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>说明：</p>\n<div><pre><code>将序列R：5,6,3,6,3,0（第一个5表明后续有5个整数）排序去重后，可得0,3,6。\n序列I没有包含0的元素。\n序列I中包含3的元素有：I[0]的值为123、I[3]的值为453、I[7]的值为3、I[9]的值为453456、I[13]的值为453、I[14]的值为123。\n序列I中包含6的元素有：I[1]的值为456、I[2]的值为786、I[4]的值为46、I[8]的值为665、I[9]的值为453456、I[11]的值为456、I[12]的值为786。\n最后按题目要求的格式进行输出即可。    \n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>题目主要信息</p>\n<p>1、 一组输入整数序列I和一组规则整数序列R，I和R序列的第一个整数为序列的个数（个数不包含第一个整数）；整数范围为0~(2^31)-1，序列个数不限</p>\n<p>2、 从R依次中取出R[i]，对I进行处理，找到满足条件的I</p>\n<p>3、按R[i]从小到大的顺序:</p>\n<p>(1)先输出R[i]；</p>\n<p>(2)再输出满足条件的I的个数；</p>\n<p>(3)然后输出满足条件的I在I序列中的位置索引(从0开始)；</p>\n<p>(4)最后再输出I。</p>\n<p>4、附加条件：</p>\n<p>(1)R[i]需要从小到大排序。相同的R[i]只需要输出索引小的以及满足条件的I，索引大的需要过滤掉</p>\n<p>(2)如果没有满足条件的I，对应的R[i]不用输出</p>\n<p>(3)最后需要在输出序列的第一个整数位置记录后续整数序列的个数(不包含“个数”本身)</p>\n<h3 id=\"方法一-直接暴力求解\" tabindex=\"-1\"> 方法一：直接暴力求解</h3>\n<h4 id=\"具体方法-1\" tabindex=\"-1\"> 具体方法</h4>\n<p>遍历每个R[i]，并遍历每个I[i]是否符合要求，符合的话就记录。</p>\n<p>Java代码</p>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>io<span>.</span></span><span>*</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span><span>//数据分类处理</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>throws</span> <span>IOException</span> <span>{</span>\n        <span>BufferedReader</span> br <span>=</span> <span>new</span> <span>BufferedReader</span><span>(</span><span>new</span> <span>InputStreamReader</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>)</span><span>;</span>\n        <span>String</span> str<span>;</span>\n        <span>while</span> <span>(</span><span>(</span>str <span>=</span> br<span>.</span><span>readLine</span><span>(</span><span>)</span><span>)</span> <span>!=</span> <span>null</span><span>)</span> <span>{</span>\n            <span>if</span> <span>(</span>str<span>.</span><span>equals</span><span>(</span><span>\"\"</span><span>)</span><span>)</span> <span>continue</span><span>;</span>\n            <span>//需要过了的I</span>\n            <span>String</span><span>[</span><span>]</span> <span>I</span> <span>=</span> str<span>.</span><span>split</span><span>(</span><span>\" \"</span><span>)</span><span>;</span>\n            <span>// R</span>\n            <span>String</span><span>[</span><span>]</span> temp <span>=</span> br<span>.</span><span>readLine</span><span>(</span><span>)</span><span>.</span><span>split</span><span>(</span><span>\" \"</span><span>)</span><span>;</span>\n            <span>long</span><span>[</span><span>]</span> <span>R</span> <span>=</span> <span>new</span> <span>long</span><span>[</span><span>Integer</span><span>.</span><span>parseInt</span><span>(</span>temp<span>[</span><span>0</span><span>]</span><span>)</span><span>]</span><span>;</span>\n            <span>for</span> <span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> <span>R</span><span>.</span>length<span>;</span> i<span>++</span><span>)</span> <span>R</span><span>[</span>i<span>]</span> <span>=</span> <span>Long</span><span>.</span><span>parseLong</span><span>(</span>temp<span>[</span>i<span>+</span><span>1</span><span>]</span><span>)</span><span>;</span>\n            <span>//先对R进行排序 然后在依次遍历</span>\n            <span>Arrays</span><span>.</span><span>sort</span><span>(</span><span>R</span><span>)</span><span>;</span>\n            <span>//最终的结果记录 </span>\n            <span>StringBuilder</span> result <span>=</span> <span>new</span> <span>StringBuilder</span><span>(</span><span>)</span><span>;</span>\n            <span>int</span> count <span>=</span> <span>0</span><span>;</span>\n            <span>for</span> <span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> <span>R</span><span>.</span>length<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n                <span>//当R中的值相等的时候 只保留第一个出现的 </span>\n                <span>if</span> <span>(</span>i <span>></span> <span>0</span> <span>&amp;&amp;</span> <span>R</span><span>[</span>i<span>]</span> <span>==</span> <span>R</span><span>[</span>i<span>-</span><span>1</span><span>]</span><span>)</span> <span>continue</span><span>;</span>\n                <span>//需要进行匹配的字符 </span>\n                <span>String</span> pattern <span>=</span> <span>R</span><span>[</span>i<span>]</span> <span>+</span> <span>\"\"</span><span>;</span>\n                <span>int</span> num <span>=</span> <span>0</span><span>;</span>\n                <span>StringBuilder</span> index <span>=</span> <span>new</span> <span>StringBuilder</span><span>(</span><span>)</span><span>;</span>\n                <span>for</span> <span>(</span><span>int</span> j <span>=</span> <span>1</span><span>;</span> j <span>&lt;</span> <span>I</span><span>.</span>length<span>;</span> j<span>++</span><span>)</span> <span>{</span>\n                    <span>//说明出现了 找到位置</span>\n                    <span>if</span> <span>(</span><span>I</span><span>[</span>j<span>]</span><span>.</span><span>indexOf</span><span>(</span>pattern<span>)</span> <span>!=</span> <span>-</span><span>1</span><span>)</span> <span>{</span>\n                        num<span>++</span><span>;</span>\n                        index<span>.</span><span>append</span><span>(</span><span>\" \"</span><span>)</span><span>.</span><span>append</span><span>(</span>j<span>-</span><span>1</span><span>)</span><span>.</span><span>append</span><span>(</span><span>\" \"</span><span>)</span><span>.</span><span>append</span><span>(</span><span>I</span><span>[</span>j<span>]</span><span>)</span><span>;</span>\n                    <span>}</span>\n                <span>}</span>\n                <span>//说明存在跟此时R[i]匹配的I</span>\n                <span>if</span> <span>(</span>num <span>></span> <span>0</span><span>)</span><span>{</span>\n                    result<span>.</span><span>append</span><span>(</span><span>\" \"</span><span>)</span><span>.</span><span>append</span><span>(</span><span>R</span><span>[</span>i<span>]</span><span>)</span><span>.</span><span>append</span><span>(</span><span>\" \"</span><span>)</span><span>.</span><span>append</span><span>(</span>num<span>)</span><span>.</span><span>append</span><span>(</span>index<span>)</span><span>;</span>\n                    count <span>+=</span> num<span>*</span><span>2</span><span>+</span><span>2</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>count <span>+</span> result<span>.</span><span>toString</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"复杂度分析-4\" tabindex=\"-1\"> 复杂度分析</h4>\n<ul>\n<li>时间复杂度：O(nm+mlogm)O(nm+mlogm)<em>O</em>(<em>n**m</em>+<em>m<strong>l</strong>o<strong>g</strong>m</em>)，需要两层for循环遍历，一层遍历R一层遍历I，另外就是进行了排序的操作。</li>\n<li>空间复杂度：O(1)O(1)<em>O</em>(1) ,都是常数级别变量</li>\n</ul>\n<h3 id=\"方法二-借助map\" tabindex=\"-1\"> 方法二：借助Map</h3>\n<h4 id=\"具体做法-3\" tabindex=\"-1\"> 具体做法</h4>\n<p>在每一轮遍历I的过程中，将当前I[i]存入到Map中，并以key和value的形式，其中key是当前元素的下标，value为当前元素的值。</p>\n<p>最终在遍历Map,将结果存入到最终的result结果中。</p>\n<h4 id=\"java代码-4\" tabindex=\"-1\"> Java代码</h4>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>{</span>\n        <span>Scanner</span> sc <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>while</span> <span>(</span>sc<span>.</span><span>hasNext</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n            <span>int</span> num <span>=</span> sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n            <span>//读取I</span>\n            <span>String</span><span>[</span><span>]</span> array <span>=</span> <span>new</span> <span>String</span><span>[</span>num<span>]</span><span>;</span>\n            <span>for</span> <span>(</span><span>int</span> i <span>=</span><span>0</span><span>;</span> i<span>&lt;</span>num<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n                array<span>[</span>i<span>]</span> <span>=</span> <span>String</span><span>.</span><span>valueOf</span><span>(</span>sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>)</span><span>;</span>\n            <span>}</span>\n            <span>//读取R</span>\n            <span>int</span> rnum <span>=</span> sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n            <span>Set</span><span><span>&lt;</span><span>Integer</span><span>></span></span> set <span>=</span> <span>new</span> <span>TreeSet</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n            <span>for</span> <span>(</span><span>int</span> i <span>=</span><span>0</span><span>;</span> i<span>&lt;</span>rnum<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n                set<span>.</span><span>add</span><span>(</span>sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>)</span><span>;</span>\n            <span>}</span>\n\n\n            <span>StringBuilder</span> result <span>=</span> <span>new</span> <span>StringBuilder</span><span>(</span><span>)</span><span>;</span>\n            <span>int</span> count <span>=</span> <span>0</span><span>;</span><span>//记录符合的个数</span>\n            <span>//遍历 R</span>\n            <span>for</span> <span>(</span><span>int</span> i <span>:</span> set<span>)</span> <span>{</span>\n                <span>int</span> j <span>=</span> <span>0</span><span>;</span><span>//记录I的每个元素的index</span>\n                <span>Map</span><span><span>&lt;</span><span>Integer</span><span>,</span> <span>String</span><span>></span></span> map <span>=</span> <span>new</span> <span>TreeMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n                <span>//在I中寻找符合要求的I[i]</span>\n                <span>for</span> <span>(</span><span>String</span> str <span>:</span> array<span>)</span> <span>{</span>\n                    <span>if</span> <span>(</span>str<span>.</span><span>contains</span><span>(</span><span>String</span><span>.</span><span>valueOf</span><span>(</span>i<span>)</span><span>)</span><span>)</span><span>{</span>\n                        map<span>.</span><span>put</span><span>(</span>j<span>,</span> str<span>)</span><span>;</span>\n                    <span>}</span>\n                    j<span>++</span><span>;</span>\n                <span>}</span>\n                <span>//如果Map非空 则存入result中 </span>\n                <span>if</span> <span>(</span><span>!</span>map<span>.</span><span>isEmpty</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n                    <span>if</span> <span>(</span>count <span>></span> <span>0</span><span>)</span> <span>{</span>\n                        result<span>.</span><span>append</span><span>(</span><span>\" \"</span><span>)</span><span>;</span>\n                    <span>}</span>\n                    result<span>.</span><span>append</span><span>(</span>i<span>)</span><span>.</span><span>append</span><span>(</span><span>\" \"</span><span>)</span><span>.</span><span>append</span><span>(</span>map<span>.</span><span>size</span><span>(</span><span>)</span><span>)</span><span>;</span>\n                    count <span>+=</span><span>2</span><span>;</span><span>//多两个数组 </span>\n                    <span>for</span> <span>(</span><span>Map<span>.</span>Entry</span><span><span>&lt;</span><span>Integer</span><span>,</span> <span>String</span><span>></span></span> entry <span>:</span> map<span>.</span><span>entrySet</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n                        count<span>+=</span><span>2</span><span>;</span>\n                        result<span>.</span><span>append</span><span>(</span><span>\" \"</span><span>)</span><span>.</span><span>append</span><span>(</span>entry<span>.</span><span>getKey</span><span>(</span><span>)</span><span>)</span><span>.</span><span>append</span><span>(</span><span>\" \"</span><span>)</span><span>.</span><span>append</span><span>(</span>entry<span>.</span><span>getValue</span><span>(</span><span>)</span><span>)</span><span>;</span>\n                    <span>}</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n            <span>if</span> <span>(</span>count <span>></span> <span>0</span><span>)</span> <span>{</span>\n                <span>StringBuilder</span> result2 <span>=</span> <span>new</span> <span>StringBuilder</span><span>(</span><span>)</span><span>;</span>\n                result2<span>.</span><span>append</span><span>(</span>count<span>)</span><span>.</span><span>append</span><span>(</span><span>\" \"</span><span>)</span><span>.</span><span>append</span><span>(</span>result<span>.</span><span>toString</span><span>(</span><span>)</span><span>)</span><span>;</span>\n                <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>result2<span>.</span><span>toString</span><span>(</span><span>)</span><span>)</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"复杂度分析-5\" tabindex=\"-1\"> 复杂度分析</h4>\n<ul>\n<li>时间复杂度：O(nm+mlog2m)O(nm+mlog2m)<em>O</em>(<em>n**m</em>+<em>m<strong>l</strong>o**g</em>2<em>m</em>)，需要两层for循环遍历，一层遍历R一层遍历I，另外就是进行了排序的操作。</li>\n<li>空间复杂度：O(n)O(n)<em>O</em>(<em>n</em>)，辅助空间为哈希表的长度.</li>\n</ul>\n<h3 id=\"方法三\" tabindex=\"-1\"> 方法三：</h3>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n<span>public</span> <span>class</span> <span>Main</span><span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span><span>{</span>\n        <span>/*\n         根据题解可知：整数序列I 和 规则整数序列R\n         1、是根据R中元素到I序列中进行匹配查询并将I序列中出现的R[i]的索引(index)和I[i]的值进行记录\n         2、定义集合用于记录待查找条件R[i]和R[i]出现的次数(count),最后将第一步得到的集合放进来即可，此处也可使用StringBuffer\n         */</span>\n        <span>Scanner</span> scanner <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>while</span><span>(</span>scanner<span>.</span><span>hasNext</span><span>(</span><span>)</span><span>)</span><span>{</span>\n            <span>int</span> <span>In</span> <span>=</span> scanner<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span> <span>//整数序列I的个数</span>\n            <span>String</span><span>[</span><span>]</span> <span>I_arr</span> <span>=</span>  <span>new</span> <span>String</span><span>[</span><span>In</span><span>]</span><span>;</span>\n            <span>for</span><span>(</span><span>int</span> i<span>=</span><span>0</span><span>;</span>i<span>&lt;</span><span>In</span><span>;</span>i<span>++</span><span>)</span><span>{</span>\n                <span>I_arr</span><span>[</span>i<span>]</span><span>=</span> <span>String</span><span>.</span><span>valueOf</span><span>(</span>scanner<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>)</span><span>;</span>\n            <span>}</span>\n            \n            <span>int</span> <span>Rn</span> <span>=</span> scanner<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span><span>//规则整数序列R的个数</span>\n            <span>Set</span><span><span>&lt;</span><span>Integer</span><span>></span></span> <span>R_set</span> <span>=</span> <span>new</span> <span>TreeSet</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span><span>//使用TreeSet进行排序和去重</span>\n            <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i<span>&lt;</span><span>Rn</span><span>;</span> i<span>++</span><span>)</span><span>{</span>\n                <span>R_set</span><span>.</span><span>add</span><span>(</span>scanner<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>)</span><span>;</span>\n            <span>}</span>\n            \n            <span>List</span><span><span>&lt;</span><span>Integer</span><span>></span></span> <span>I_list</span> <span>=</span> <span>new</span> <span>ArrayList</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span><span>//用于存储整数序列I</span>\n            <span>List</span><span><span>&lt;</span><span>Integer</span><span>></span></span> <span>R_list</span> <span>=</span> <span>new</span> <span>ArrayList</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span><span>//用于存储规则整数序列R</span>\n            <span>for</span><span>(</span><span>int</span> item <span>:</span> <span>R_set</span><span>)</span><span>{</span>\n               <span>int</span> count <span>=</span> <span>0</span><span>;</span><span>//统计R中元素在I中出现的次数</span>\n               <span>for</span><span>(</span><span>int</span> i <span>=</span><span>0</span><span>;</span> i<span>&lt;</span><span>I_arr</span><span>.</span>length<span>;</span> i<span>++</span><span>)</span><span>{</span>\n                   <span>if</span><span>(</span><span>I_arr</span><span>[</span>i<span>]</span><span>.</span><span>contains</span><span>(</span><span>String</span><span>.</span><span>valueOf</span><span>(</span>item<span>)</span><span>)</span><span>)</span><span>{</span>\n                       count<span>++</span><span>;</span>\n                       <span>I_list</span><span>.</span><span>add</span><span>(</span>i<span>)</span><span>;</span>\n                       <span>I_list</span><span>.</span><span>add</span><span>(</span><span>Integer</span><span>.</span><span>valueOf</span><span>(</span><span>I_arr</span><span>[</span>i<span>]</span><span>)</span><span>)</span><span>;</span>\n                   <span>}</span>\n               <span>}</span>\n               <span>if</span><span>(</span>count<span>></span><span>0</span><span>)</span><span>{</span>\n                   <span>R_list</span><span>.</span><span>add</span><span>(</span>item<span>)</span><span>;</span>\n                   <span>R_list</span><span>.</span><span>add</span><span>(</span>count<span>)</span><span>;</span>\n                   <span>R_list</span><span>.</span><span>addAll</span><span>(</span><span>I_list</span><span>)</span><span>;</span>\n               <span>}</span>\n               <span>I_list</span><span>.</span><span>clear</span><span>(</span><span>)</span><span>;</span>\n            <span>}</span>\n            <span>System</span><span>.</span>out<span>.</span><span>print</span><span>(</span><span>R_list</span><span>.</span><span>size</span><span>(</span><span>)</span><span>+</span><span>\" \"</span><span>)</span><span>;</span>\n            <span>for</span><span>(</span><span>Integer</span> i<span>:</span><span>R_list</span><span>)</span><span>{</span>\n                <span>System</span><span>.</span>out<span>.</span><span>print</span><span>(</span>i<span>+</span><span>\" \"</span><span>)</span><span>;</span>\n            <span>}</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"hj27-查找兄弟单词\" tabindex=\"-1\"> <strong>HJ27</strong> <strong>查找兄弟单词</strong></h2>\n<h3 id=\"描述-10\" tabindex=\"-1\"> 描述</h3>\n<p>定义一个单词的“兄弟单词”为：交换该单词字母顺序（注：可以交换任意次），而不添加、删除、修改原有的字母就能生成的单词。</p>\n<p>兄弟单词要求和原来的单词不同。例如： ab 和 ba 是兄弟单词。 ab 和 ab 则不是兄弟单词。</p>\n<p>现在给定你 n 个单词，另外再给你一个单词 x ，让你寻找 x 的兄弟单词里，按字典序排列后的第 k 个单词是什么？</p>\n<p>注意：字典中可能有重复单词。</p>\n<p>数据范围：1 \\le n \\le 1000 \\1≤<em>n</em>≤1000 ，输入的字符串长度满足 1 \\le len(str) \\le 10 \\1≤<em>l<strong>e</strong>n</em>(<em>s<strong>t</strong>r</em>)≤10 ， 1 \\le k &lt; n \\1≤<em>k</em>&lt;<em>n</em></p>\n<h3 id=\"输入描述-10\" tabindex=\"-1\"> 输入描述：</h3>\n<p>输入只有一行。 先输入字典中单词的个数n，再输入n个单词作为字典单词。 然后输入一个单词x 最后后输入一个整数k</p>\n<h3 id=\"输出描述-10\" tabindex=\"-1\"> 输出描述：</h3>\n<p>第一行输出查找到x的兄弟单词的个数m 第二行输出查找到的按照字典顺序排序后的第k个兄弟单词，没有符合第k个的话则不用输出。</p>\n<h3 id=\"示例1-10\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>3 abc bca cab abc 1\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>复制</p>\n<p>输出：</p>\n<div><pre><code>2\nbca\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>复制</p>\n<h3 id=\"示例2-1\" tabindex=\"-1\"> 示例2</h3>\n<p>输入：</p>\n<div><pre><code>6 cab ad abcd cba abc bca abc 1\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>输出：</p>\n<div><pre><code>3\nbca\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>说明：</p>\n<div><pre><code>abc的兄弟单词有cab cba bca，所以输出3\n经字典序排列后，变为bca cab cba，所以第1个字典序兄弟单词为bca       \n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h3 id=\"代码-6\" tabindex=\"-1\"> 代码：</h3>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n<span>/**\n * 功能描述: <span><span><span>&lt;</span>br</span><span>></span></span>\n * @Param: 输入：\n * 6 cab ad abcd cba abc bca abc 1\n * 复制\n * 输出：\n * 3\n * bca\n * 复制\n * 说明：\n * abc的兄弟单词有cab cba bca，所以输出3\n * 经字典序排列后，变为bca cab cba，所以第1个字典序兄弟单词为bca\n * @Return:\n * @Author: guokun\n * @Date: 2021/10/13 14:18\n */</span>\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>{</span>\n        <span>Scanner</span> scanner <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>while</span> <span>(</span>scanner<span>.</span><span>hasNext</span><span>(</span><span>)</span><span>)</span><span>{</span>\n            <span>String</span><span>[</span><span>]</span> ss <span>=</span> scanner<span>.</span><span>nextLine</span><span>(</span><span>)</span><span>.</span><span>split</span><span>(</span><span>\" \"</span><span>)</span><span>;</span>\n            <span>Integer</span> a <span>=</span> <span>Integer</span><span>.</span><span>parseInt</span><span>(</span>ss<span>[</span><span>0</span><span>]</span><span>)</span><span>;</span>\n            <span>String</span> x <span>=</span> ss<span>[</span>ss<span>.</span>length<span>-</span><span>2</span><span>]</span><span>;</span>\n            <span>Integer</span> k <span>=</span> <span>Integer</span><span>.</span><span>parseInt</span><span>(</span>ss<span>[</span>ss<span>.</span>length<span>-</span><span>1</span><span>]</span><span>)</span><span>;</span>\n            <span>List</span><span><span>&lt;</span><span>String</span><span>></span></span> list <span>=</span> <span>new</span> <span>ArrayList</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n\n            <span>for</span> <span>(</span><span>int</span> i <span>=</span> <span>1</span><span>;</span> i <span>&lt;=</span>a <span>;</span> i<span>++</span><span>)</span> <span>{</span>\n                <span>if</span> <span>(</span><span>isBrother</span><span>(</span>x<span>,</span>ss<span>[</span>i<span>]</span><span>)</span><span>)</span><span>{</span>\n                        list<span>.</span><span>add</span><span>(</span>ss<span>[</span>i<span>]</span><span>)</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n            <span>int</span> size <span>=</span> list<span>.</span><span>size</span><span>(</span><span>)</span><span>;</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>size<span>)</span><span>;</span>\n            <span>if</span> <span>(</span>size<span>>=</span>k<span>)</span><span>{</span>\n                <span>Collections</span><span>.</span><span>sort</span><span>(</span>list<span>)</span><span>;</span>\n                <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>list<span>.</span><span>get</span><span>(</span>k<span>-</span><span>1</span><span>)</span><span>)</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n    <span>}</span>\n        <span>public</span> <span>static</span> <span>boolean</span> <span>isBrother</span><span>(</span><span>String</span> x<span>,</span><span>String</span> y<span>)</span><span>{</span>\n            <span>if</span> <span>(</span>x<span>.</span><span>length</span><span>(</span><span>)</span><span>!=</span>y<span>.</span><span>length</span><span>(</span><span>)</span><span>||</span>y<span>.</span><span>equals</span><span>(</span>x<span>)</span><span>)</span><span>{</span>\n                <span>return</span> <span>false</span><span>;</span>\n            <span>}</span>\n            <span>char</span><span>[</span><span>]</span> s <span>=</span> x<span>.</span><span>toCharArray</span><span>(</span><span>)</span><span>;</span>\n            <span>char</span><span>[</span><span>]</span> j<span>=</span> y<span>.</span><span>toCharArray</span><span>(</span><span>)</span><span>;</span>\n            <span>Arrays</span><span>.</span><span>sort</span><span>(</span>s<span>)</span><span>;</span>\n            <span>Arrays</span><span>.</span><span>sort</span><span>(</span>j<span>)</span><span>;</span>\n            <span>return</span> <span>new</span> <span>String</span><span>(</span>s<span>)</span><span>.</span><span>equals</span><span>(</span><span>new</span> <span>String</span><span>(</span>j<span>)</span><span>)</span><span>;</span>\n        <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>1、对n个单词升序排序</p>\n<p>2、第n个单词和 x 相等 和 长度不一致的跳过</p>\n<p>3、对第n个单词 和 x 的每个字符升序排序，并比较是否相等，如果相等则为兄弟单词。</p>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span><span>{</span>\n\n<span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span><span>{</span>\n    <span>Scanner</span> in <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n    <span>while</span><span>(</span>in<span>.</span><span>hasNext</span><span>(</span><span>)</span><span>)</span><span>{</span>\n        <span>int</span> num <span>=</span> in<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n        <span>List</span><span><span>&lt;</span><span>String</span><span>></span></span> datas <span>=</span> <span>new</span> <span>ArrayList</span><span>(</span><span>)</span><span>;</span>\n        <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>0</span> <span>;</span> i <span>&lt;</span> num <span>;</span> i<span>++</span><span>)</span><span>{</span>\n            datas<span>.</span><span>add</span><span>(</span>in<span>.</span><span>next</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>}</span>\n        <span>String</span> x <span>=</span> in<span>.</span><span>next</span><span>(</span><span>)</span><span>;</span>\n        <span>char</span><span>[</span><span>]</span> xs <span>=</span> x<span>.</span><span>toCharArray</span><span>(</span><span>)</span><span>;</span><span>//取反</span>\n        <span>int</span> index <span>=</span> in<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n        <span>Collections</span><span>.</span><span>sort</span><span>(</span>datas<span>)</span><span>;</span>\n        <span>int</span> count <span>=</span> <span>0</span><span>;</span>\n        <span>String</span> k <span>=</span> <span>\"\"</span><span>;</span>\n        <span>for</span><span>(</span><span>String</span> str <span>:</span> datas<span>)</span><span>{</span>\n            <span>if</span><span>(</span>x<span>.</span><span>equals</span><span>(</span>str<span>)</span> <span>||</span> x<span>.</span><span>length</span><span>(</span><span>)</span> <span>!=</span> str<span>.</span><span>length</span><span>(</span><span>)</span><span>)</span><span>{</span>\n                <span>continue</span><span>;</span> <span>//字符串一样 和 长度不一样的跳过</span>\n            <span>}</span>\n            <span>char</span><span>[</span><span>]</span> strs <span>=</span> str<span>.</span><span>toCharArray</span><span>(</span><span>)</span><span>;</span>\n            <span>Arrays</span><span>.</span><span>sort</span><span>(</span>xs<span>)</span><span>;</span>\n            <span>Arrays</span><span>.</span><span>sort</span><span>(</span>strs<span>)</span><span>;</span>\n            <span>if</span><span>(</span><span>!</span><span>Arrays</span><span>.</span><span>equals</span><span>(</span>strs<span>,</span>xs<span>)</span><span>)</span><span>{</span>\n                <span>continue</span><span>;</span><span>//升序排序不相等，跳过</span>\n            <span>}</span>\n            count <span>+=</span> <span>1</span><span>;</span> <span>// 满足条件的累加</span>\n            <span>if</span> <span>(</span>count <span>==</span> index<span>)</span> <span>{</span>\n                k <span>=</span> str<span>;</span><span>//第K个兄弟单词</span>\n            <span>}</span>\n        <span>}</span>\n        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>count<span>)</span><span>;</span>\n        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>k<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"hj28-素数伴侣\" tabindex=\"-1\"> <strong>HJ28</strong> <strong>素数伴侣</strong></h2>\n<h3 id=\"描述-11\" tabindex=\"-1\"> 描述</h3>\n<p>题目描述\n若两个正整数的和为素数，则这两个正整数称之为“素数伴侣”，如2和5、6和13，它们能应用于通信加密。现在密码学会请你设计一个程序，从已有的 N （ N 为偶数）个正整数中挑选出若干对组成“素数伴侣”，挑选方案多种多样，例如有4个正整数：2，5，6，13，如果将5和6分为一组中只能得到一组“素数伴侣”，而将2和5、6和13编组将得到两组“素数伴侣”，能组成“素数伴侣”最多的方案称为“最佳方案”，当然密码学会希望你寻找出“最佳方案”。</p>\n<p>输入:</p>\n<p>有一个正偶数 n ，表示待挑选的自然数的个数。后面给出 n 个具体的数字。</p>\n<p>输出:</p>\n<p>输出一个整数 K ，表示你求得的“最佳方案”组成“素数伴侣”的对数。</p>\n<p>数据范围： 1 \\le n \\le 100 \\1≤<em>n</em>≤100 ，输入的数据大小满足 2 \\le val \\le 30000 \\2≤<em>v<strong>a</strong>l</em>≤30000</p>\n<h3 id=\"输入描述-11\" tabindex=\"-1\"> 输入描述：</h3>\n<p>输入说明\n1 输入一个正偶数 n\n2 输入 n 个整数</p>\n<h3 id=\"输出描述-11\" tabindex=\"-1\"> 输出描述：</h3>\n<p>求得的“最佳方案”组成“素数伴侣”的对数。</p>\n<h3 id=\"示例1-11\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>4\n2 5 6 13\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>输出：</p>\n<div><pre><code>2\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h3 id=\"示例2-2\" tabindex=\"-1\"> 示例2</h3>\n<p>输入：</p>\n<div><pre><code>2\n3 6\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>输出：</p>\n<div><pre><code>0\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h3 id=\"题意整理。\" tabindex=\"-1\"> 题意整理。</h3>\n<ul>\n<li>输入N（N为偶数）个正整数，从其中挑选出若干对组成“素数伴侣”。</li>\n<li>问怎么挑选，可以使得“素数伴侣”的对数最多。</li>\n<li>如果两个正整数的和为素数，则这两个正整数称之为“素数伴侣”。</li>\n</ul>\n<h3 id=\"方法一-匈牙利算法\" tabindex=\"-1\"> 方法一（匈牙利算法）</h3>\n<h4 id=\"_1-解题思路\" tabindex=\"-1\"> 1.解题思路</h4>\n<ul>\n<li>首先定义两个list容器，分别存储输入整数中的奇数和偶数。</li>\n<li>然后利用匈牙利算法找到“素数伴侣”对数最多时的配对数。匈牙利算法的核心思想是先到先得，能让就让。</li>\n<li>最后输出“素数伴侣”最多时的对数。</li>\n</ul>\n<p>图解展示（匈牙利算法）：\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/0AA5426578FB65FAEA9C18632CFAFCFC.jpeg\" alt=\"alt\"></p>\n<p>举例说明：如图所示，首先A1和B2配对（先到先得），然后轮到A2，A2也可以和B2配对，这时候B2发现A1还可以和B4配对，所以放弃了A1，选择和A2组成伴侣（能让就让）。接着A3直接和B1配对（先到先得）。最后A4尝试与B4配对，但是这样A1就只能与B2配对，而A2就找不到伴侣了，一层层递归下来，发现不可行，所以A4不能与B4配对。</p>\n<h4 id=\"_2-代码实现\" tabindex=\"-1\"> 2.代码实现</h4>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Scanner</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>ArrayList</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span><span>{</span>\n    \n    <span>static</span> <span>int</span> max<span>=</span><span>0</span><span>;</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span><span>{</span>\n        <span>//标准输入</span>\n        <span>Scanner</span> sc<span>=</span><span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>while</span><span>(</span>sc<span>.</span><span>hasNext</span><span>(</span><span>)</span><span>)</span><span>{</span>\n            <span>//输入正偶数</span>\n            <span>int</span> n<span>=</span>sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n            <span>//用于记录输入的n个整数</span>\n            <span>int</span><span>[</span><span>]</span> arr<span>=</span><span>new</span> <span>int</span><span>[</span>n<span>]</span><span>;</span>\n            <span>//用于存储所有的奇数</span>\n            <span>ArrayList</span><span><span>&lt;</span><span>Integer</span><span>></span></span> odds<span>=</span><span>new</span> <span>ArrayList</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n            <span>//用于存储所有的偶数</span>\n            <span>ArrayList</span><span><span>&lt;</span><span>Integer</span><span>></span></span> evens<span>=</span><span>new</span> <span>ArrayList</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n            <span>for</span><span>(</span><span>int</span> i<span>=</span><span>0</span><span>;</span>i<span>&lt;</span>n<span>;</span>i<span>++</span><span>)</span><span>{</span>\n                arr<span>[</span>i<span>]</span><span>=</span>sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n                <span>//将奇数添加到odds</span>\n                <span>if</span><span>(</span>arr<span>[</span>i<span>]</span><span>%</span><span>2</span><span>==</span><span>1</span><span>)</span><span>{</span>\n                    odds<span>.</span><span>add</span><span>(</span>arr<span>[</span>i<span>]</span><span>)</span><span>;</span>\n                <span>}</span>\n                <span>//将偶数添加到evens</span>\n                <span>if</span><span>(</span>arr<span>[</span>i<span>]</span><span>%</span><span>2</span><span>==</span><span>0</span><span>)</span><span>{</span>\n                    evens<span>.</span><span>add</span><span>(</span>arr<span>[</span>i<span>]</span><span>)</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n            <span>//下标对应已经匹配的偶数的下标，值对应这个偶数的伴侣</span>\n            <span>int</span><span>[</span><span>]</span> matcheven<span>=</span><span>new</span> <span>int</span><span>[</span>evens<span>.</span><span>size</span><span>(</span><span>)</span><span>]</span><span>;</span>\n            <span>//记录伴侣的对数</span>\n            <span>int</span> count<span>=</span><span>0</span><span>;</span>\n            <span>for</span><span>(</span><span>int</span> j<span>=</span><span>0</span><span>;</span>j<span>&lt;</span>odds<span>.</span><span>size</span><span>(</span><span>)</span><span>;</span>j<span>++</span><span>)</span><span>{</span>\n                <span>//用于标记对应的偶数是否查找过</span>\n                <span>boolean</span><span>[</span><span>]</span> v<span>=</span><span>new</span> <span>boolean</span><span>[</span>evens<span>.</span><span>size</span><span>(</span><span>)</span><span>]</span><span>;</span>\n                <span>//如果匹配上，则计数加1</span>\n                <span>if</span><span>(</span><span>find</span><span>(</span>odds<span>.</span><span>get</span><span>(</span>j<span>)</span><span>,</span>matcheven<span>,</span>evens<span>,</span>v<span>)</span><span>)</span><span>{</span>\n                    count<span>++</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>count<span>)</span><span>;</span>\n        <span>}</span>   \n    <span>}</span>\n    \n    <span>//判断奇数x能否找到伴侣</span>\n    <span>private</span> <span>static</span> <span>boolean</span> <span>find</span><span>(</span><span>int</span> x<span>,</span><span>int</span><span>[</span><span>]</span> matcheven<span>,</span><span>ArrayList</span><span><span>&lt;</span><span>Integer</span><span>></span></span> evens<span>,</span><span>boolean</span><span>[</span><span>]</span> v<span>)</span><span>{</span>\n        <span>for</span><span>(</span><span>int</span> i<span>=</span><span>0</span><span>;</span>i<span>&lt;</span>evens<span>.</span><span>size</span><span>(</span><span>)</span><span>;</span>i<span>++</span><span>)</span><span>{</span>\n            <span>//该位置偶数没被访问过，并且能与x组成素数伴侣</span>\n            <span>if</span><span>(</span><span>isPrime</span><span>(</span>x<span>+</span>evens<span>.</span><span>get</span><span>(</span>i<span>)</span><span>)</span><span>&amp;&amp;</span>v<span>[</span>i<span>]</span><span>==</span><span>false</span><span>)</span><span>{</span>\n                v<span>[</span>i<span>]</span><span>=</span><span>true</span><span>;</span>\n                <span>/*如果i位置偶数还没有伴侣，则与x组成伴侣，如果已经有伴侣，并且这个伴侣能重新找到新伴侣，\n                则把原来伴侣让给别人，自己与x组成伴侣*/</span>\n                <span>if</span><span>(</span>matcheven<span>[</span>i<span>]</span><span>==</span><span>0</span><span>||</span><span>find</span><span>(</span>matcheven<span>[</span>i<span>]</span><span>,</span>matcheven<span>,</span>evens<span>,</span>v<span>)</span><span>)</span><span>{</span>\n                    matcheven<span>[</span>i<span>]</span><span>=</span>x<span>;</span>\n                    <span>return</span> <span>true</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n        <span>}</span>\n        <span>return</span> <span>false</span><span>;</span>\n    <span>}</span>\n    <span>//判断x是否是素数</span>\n    <span>private</span> <span>static</span> <span>boolean</span> <span>isPrime</span><span>(</span><span>int</span> x<span>)</span><span>{</span>\n        <span>if</span><span>(</span>x<span>==</span><span>1</span><span>)</span> <span>return</span> <span>false</span><span>;</span>\n        <span>//如果能被2到根号x整除，则一定不是素数</span>\n        <span>for</span><span>(</span><span>int</span> i<span>=</span><span>2</span><span>;</span>i<span>&lt;=</span><span>(</span><span>int</span><span>)</span><span>Math</span><span>.</span><span>sqrt</span><span>(</span>x<span>)</span><span>;</span>i<span>++</span><span>)</span><span>{</span>\n            <span>if</span><span>(</span>x<span>%</span>i<span>==</span><span>0</span><span>)</span><span>{</span>\n                <span>return</span> <span>false</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n        <span>return</span> <span>true</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_3-复杂度分析\" tabindex=\"-1\"> 3.复杂度分析</h4>\n<ul>\n<li>时间复杂度：假设输入的奇数的数目为p，输入的偶数的数目为q，则find函数的时间复杂度为O(q2)O(q<sup>2)*O*(*q*2)，因为循环内还嵌套了一个递归，虽然还有一个判断是否是素数的函数，但是题目中输入的数据范围在1-100之间，所以这个判断素数的函数的时间复杂度为O(1)O(1)*O*(1)。最坏情况下，奇数和偶数的数目相等，均为n/2n/2*n*/2，此时find函数的复杂度为O(n2)O(n</sup>2)<em>O</em>(<em>n</em>2)，需要对所有的奇数执行find，所以时间复杂度为O(n3)O(n^3)<em>O</em>(<em>n</em>3)。</li>\n<li>空间复杂度：需要额外大小为p和q的list容器分别存储对应的奇数和偶数，p、q均不大于n，所以空间复杂度为O(n)O(n)<em>O</em>(<em>n</em>)。</li>\n</ul>\n<h3 id=\"方法二-利用io流\" tabindex=\"-1\"> 方法二（利用io流）</h3>\n<h4 id=\"_1-解题思路-1\" tabindex=\"-1\"> 1.解题思路</h4>\n<p>思路和方法一基本一致，不同的是通过io流操作来处理输入的数据。</p>\n<h4 id=\"_2-代码实现-1\" tabindex=\"-1\"> 2.代码实现</h4>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>io<span>.</span></span><span>*</span></span><span>;</span>\n<span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>ArrayList</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span><span>{</span>\n    \n    <span>static</span> <span>int</span> max<span>=</span><span>0</span><span>;</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>throws</span> <span>Exception</span><span>{</span>\n        <span>//io输入</span>\n        <span>BufferedReader</span> br<span>=</span><span>new</span> <span>BufferedReader</span><span>(</span><span>new</span> <span>InputStreamReader</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>)</span><span>;</span>\n        <span>String</span> s<span>;</span>\n        <span>while</span><span>(</span><span>(</span>s<span>=</span>br<span>.</span><span>readLine</span><span>(</span><span>)</span><span>)</span><span>!=</span><span>null</span><span>)</span><span>{</span>\n            <span>//输入正偶数n</span>\n            <span>int</span> n<span>=</span><span>Integer</span><span>.</span><span>parseInt</span><span>(</span>s<span>)</span><span>;</span>\n            <span>//输入n个整数</span>\n            <span>String</span><span>[</span><span>]</span> arr<span>=</span>br<span>.</span><span>readLine</span><span>(</span><span>)</span><span>.</span><span>split</span><span>(</span><span>\" \"</span><span>)</span><span>;</span> \n            <span>//用于存储所有的奇数</span>\n            <span>ArrayList</span><span><span>&lt;</span><span>Integer</span><span>></span></span> odds<span>=</span><span>new</span> <span>ArrayList</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n            <span>//用于存储所有的偶数</span>\n            <span>ArrayList</span><span><span>&lt;</span><span>Integer</span><span>></span></span> evens<span>=</span><span>new</span> <span>ArrayList</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n            <span>for</span><span>(</span><span>int</span> i<span>=</span><span>0</span><span>;</span>i<span>&lt;</span>n<span>;</span>i<span>++</span><span>)</span><span>{</span>\n                <span>int</span> num<span>=</span><span>Integer</span><span>.</span><span>parseInt</span><span>(</span>arr<span>[</span>i<span>]</span><span>)</span><span>;</span>\n                <span>//将奇数添加到odds</span>\n                <span>if</span><span>(</span>num<span>%</span><span>2</span><span>==</span><span>1</span><span>)</span><span>{</span>\n                    odds<span>.</span><span>add</span><span>(</span>num<span>)</span><span>;</span>\n                <span>}</span>\n                <span>//将偶数添加到evens</span>\n                <span>if</span><span>(</span>num<span>%</span><span>2</span><span>==</span><span>0</span><span>)</span><span>{</span>\n                    evens<span>.</span><span>add</span><span>(</span>num<span>)</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n            <span>//下标对应已经匹配的偶数的下标，值对应这个偶数的伴侣</span>\n            <span>int</span><span>[</span><span>]</span> matcheven<span>=</span><span>new</span> <span>int</span><span>[</span>evens<span>.</span><span>size</span><span>(</span><span>)</span><span>]</span><span>;</span>\n            <span>//记录伴侣的对数</span>\n            <span>int</span> count<span>=</span><span>0</span><span>;</span>\n            <span>for</span><span>(</span><span>int</span> j<span>=</span><span>0</span><span>;</span>j<span>&lt;</span>odds<span>.</span><span>size</span><span>(</span><span>)</span><span>;</span>j<span>++</span><span>)</span><span>{</span>\n                <span>//用于标记对应的偶数是否查找过</span>\n                <span>boolean</span><span>[</span><span>]</span> v<span>=</span><span>new</span> <span>boolean</span><span>[</span>evens<span>.</span><span>size</span><span>(</span><span>)</span><span>]</span><span>;</span>\n                <span>//如果匹配上，则计数加1</span>\n                <span>if</span><span>(</span><span>find</span><span>(</span>odds<span>.</span><span>get</span><span>(</span>j<span>)</span><span>,</span>matcheven<span>,</span>evens<span>,</span>v<span>)</span><span>)</span><span>{</span>\n                    count<span>++</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>count<span>)</span><span>;</span>\n        <span>}</span>   \n    <span>}</span>\n    \n    <span>//判断奇数x能否找到伴侣</span>\n    <span>private</span> <span>static</span> <span>boolean</span> <span>find</span><span>(</span><span>int</span> x<span>,</span><span>int</span><span>[</span><span>]</span> matcheven<span>,</span><span>ArrayList</span><span><span>&lt;</span><span>Integer</span><span>></span></span> evens<span>,</span><span>boolean</span><span>[</span><span>]</span> v<span>)</span><span>{</span>\n        <span>for</span><span>(</span><span>int</span> i<span>=</span><span>0</span><span>;</span>i<span>&lt;</span>evens<span>.</span><span>size</span><span>(</span><span>)</span><span>;</span>i<span>++</span><span>)</span><span>{</span>\n            <span>//该位置偶数没被访问过，并且能与x组成素数伴侣</span>\n            <span>if</span><span>(</span><span>isPrime</span><span>(</span>x<span>+</span>evens<span>.</span><span>get</span><span>(</span>i<span>)</span><span>)</span><span>&amp;&amp;</span>v<span>[</span>i<span>]</span><span>==</span><span>false</span><span>)</span><span>{</span>\n                v<span>[</span>i<span>]</span><span>=</span><span>true</span><span>;</span>\n                <span>/*如果i位置偶数还没有伴侣，则与x组成伴侣，如果已经有伴侣，并且这个伴侣能重新找到新伴侣，\n                则把原来伴侣让给别人，自己与x组成伴侣*/</span>\n                <span>if</span><span>(</span>matcheven<span>[</span>i<span>]</span><span>==</span><span>0</span><span>||</span><span>find</span><span>(</span>matcheven<span>[</span>i<span>]</span><span>,</span>matcheven<span>,</span>evens<span>,</span>v<span>)</span><span>)</span><span>{</span>\n                    matcheven<span>[</span>i<span>]</span><span>=</span>x<span>;</span>\n                    <span>return</span> <span>true</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n        <span>}</span>\n        <span>return</span> <span>false</span><span>;</span>\n    <span>}</span>\n    <span>//判断x是否是素数</span>\n    <span>private</span> <span>static</span> <span>boolean</span> <span>isPrime</span><span>(</span><span>int</span> x<span>)</span><span>{</span>\n        <span>if</span><span>(</span>x<span>==</span><span>1</span><span>)</span> <span>return</span> <span>false</span><span>;</span>\n        <span>//如果能被2到根号x整除，则一定不是素数</span>\n        <span>for</span><span>(</span><span>int</span> i<span>=</span><span>2</span><span>;</span>i<span>&lt;=</span><span>(</span><span>int</span><span>)</span><span>Math</span><span>.</span><span>sqrt</span><span>(</span>x<span>)</span><span>;</span>i<span>++</span><span>)</span><span>{</span>\n            <span>if</span><span>(</span>x<span>%</span>i<span>==</span><span>0</span><span>)</span><span>{</span>\n                <span>return</span> <span>false</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n        <span>return</span> <span>true</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h4 id=\"_3-复杂度分析-1\" tabindex=\"-1\"> 3.复杂度分析</h4>\n<ul>\n<li>时间复杂度：假设输入的奇数的数目为p，输入的偶数的数目为q，则find函数的时间复杂度为O(q2)O(q<sup>2)*O*(*q*2)，因为循环内还嵌套了一个递归，虽然还有一个判断是否是素数的函数，但是题目中输入的数据范围在1-100之间，所以这个判断素数的函数的时间复杂度为O(1)O(1)*O*(1)。最坏情况下，奇数和偶数的数目相等，均为n/2n/2*n*/2，此时find函数的复杂度为O(n2)O(n</sup>2)<em>O</em>(<em>n</em>2)，需要对所有的奇数执行find，所以时间复杂度为O(n3)O(n^3)<em>O</em>(<em>n</em>3)。</li>\n<li>空间复杂度：需要额外大小为p和q的list容器分别存储对应的奇数和偶数，p、q均不大于n，所以空间复杂度为O(n)O(n)<em>O</em>(<em>n</em>)。</li>\n</ul>\n<h2 id=\"hj33-整数与ip地址间的转换\" tabindex=\"-1\"> <strong>HJ33</strong> <strong>整数与IP地址间的转换</strong></h2>\n<h3 id=\"描述-12\" tabindex=\"-1\"> 描述</h3>\n<p>原理：ip地址的每段可以看成是一个0-255的整数，把每段拆分成一个二进制形式组合起来，然后把这个二进制数转变成\n一个长整数。\n举例：一个ip地址为10.0.3.193\n每段数字       相对应的二进制数\n10          00001010\n0          00000000\n3          00000011\n193         11000001</p>\n<p>组合起来即为：00001010 00000000 00000011 11000001,转换为10进制数就是：167773121，即该IP地址转换后的数字就是它了。</p>\n<p>数据范围：保证输入的是合法的 IP 序列</p>\n<h3 id=\"输入描述-12\" tabindex=\"-1\"> 输入描述：</h3>\n<p>输入\n1 输入IP地址\n2 输入10进制型的IP地址</p>\n<h3 id=\"输出描述-12\" tabindex=\"-1\"> 输出描述：</h3>\n<p>输出\n1 输出转换成10进制的IP地址\n2 输出转换后的IP地址</p>\n<h3 id=\"示例1-12\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>10.0.3.193\n167969729\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><p>输出：</p>\n<div><pre><code>167773121\n10.3.3.193\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h3 id=\"题目主要信息-1\" tabindex=\"-1\"> 题目主要信息</h3>\n<p>1、将ip地址转化为长整数</p>\n<p>2、将长整数转换为ip地址</p>\n<h3 id=\"方法一-通过二进制进行转换\" tabindex=\"-1\"> 方法一:通过二进制进行转换</h3>\n<h3 id=\"具体方法-2\" tabindex=\"-1\"> 具体方法</h3>\n<p>在问题中有两个转换过程，一个是将ip地址转换为长整数，一个是将长整数转换为ip地址，通过题目中的转换过程进行转换。 对于ip地址转换成长整数： 1、将ip地址切割成四段数字 2、每段数字用8位2二进制数字表示 3、将四段二进制数字组合 4、将二进制数字转换成长整数 对于长整数转换成ip地址则步骤相反 1、将长整数转换成32位二进制数字 2、将32位二进制数字进行切割 3、将每段的二进制数字转换为十进制数字 4、形成ip地址</p>\n<h3 id=\"java代码-5\" tabindex=\"-1\"> Java代码</h3>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Scanner</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span><span>{</span>\n        <span>Scanner</span> sc <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>while</span><span>(</span>sc<span>.</span><span>hasNext</span><span>(</span><span>)</span><span>)</span><span>{</span>\n            <span>String</span> s <span>=</span> sc<span>.</span><span>next</span><span>(</span><span>)</span><span>;</span>\n            <span>if</span><span>(</span>s<span>.</span><span>contains</span><span>(</span><span>\".\"</span><span>)</span><span>)</span><span>{</span>\n                <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>ip2num</span><span>(</span>s<span>)</span><span>)</span><span>;</span>\n            <span>}</span><span>else</span><span>{</span>\n                <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>num2ip</span><span>(</span><span>Long</span><span>.</span><span>parseLong</span><span>(</span>s<span>)</span><span>)</span><span>)</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n    <span>}</span>\n\n    <span>public</span> <span>static</span> <span>long</span> <span>ip2num</span><span>(</span><span>String</span> ip<span>)</span><span>{</span>\n        <span>String</span><span>[</span><span>]</span> iip <span>=</span> ip<span>.</span><span>split</span><span>(</span><span>\"\\\\.\"</span><span>)</span><span>;</span>\n        <span>StringBuilder</span> sb <span>=</span> <span>new</span> <span>StringBuilder</span><span>(</span><span>)</span><span>;</span>\n        <span>for</span><span>(</span><span>int</span> i<span>=</span><span>0</span><span>;</span> i<span>&lt;</span><span>4</span><span>;</span> i<span>++</span><span>)</span><span>{</span>\n            <span>int</span> num <span>=</span> <span>Integer</span><span>.</span><span>parseInt</span><span>(</span>iip<span>[</span>i<span>]</span><span>)</span><span>;</span>  <span>// 拆分</span>\n            <span>String</span> num2 <span>=</span> <span>Integer</span><span>.</span><span>toBinaryString</span><span>(</span>num<span>)</span><span>;</span>  <span>//转换为二进制</span>\n            <span>while</span><span>(</span>num2<span>.</span><span>length</span><span>(</span><span>)</span><span>&lt;</span><span>8</span><span>)</span><span>{</span>\n                num2 <span>=</span> <span>\"0\"</span> <span>+</span> num2<span>;</span>  <span>// 拼接</span>\n            <span>}</span>\n            sb<span>.</span><span>append</span><span>(</span>num2<span>)</span><span>;</span>\n        <span>}</span>\n        <span>return</span> <span>Long</span><span>.</span><span>parseLong</span><span>(</span>sb<span>.</span><span>toString</span><span>(</span><span>)</span><span>,</span> <span>2</span><span>)</span><span>;</span>  <span>// 转化为10进制</span>\n    <span>}</span>\n\n    <span>public</span> <span>static</span> <span>String</span> <span>num2ip</span><span>(</span><span>long</span> num<span>)</span><span>{</span>\n        <span>String</span> num2 <span>=</span> <span>Long</span><span>.</span><span>toBinaryString</span><span>(</span>num<span>)</span><span>;</span>  <span>//转换为2进制</span>\n        <span>while</span><span>(</span>num2<span>.</span><span>length</span><span>(</span><span>)</span><span>&lt;</span><span>32</span><span>)</span><span>{</span>\n            num2 <span>=</span> <span>\"0\"</span> <span>+</span> num2<span>;</span>\n        <span>}</span>\n        <span>String</span><span>[</span><span>]</span> ans <span>=</span> <span>new</span> <span>String</span><span>[</span><span>4</span><span>]</span><span>;</span>\n        <span>for</span><span>(</span><span>int</span> i<span>=</span><span>0</span><span>;</span> i<span>&lt;</span><span>4</span><span>;</span> i<span>++</span><span>)</span><span>{</span>\n            <span>String</span> s <span>=</span> num2<span>.</span><span>substring</span><span>(</span><span>8</span><span>*</span>i<span>,</span> <span>8</span><span>*</span>i<span>+</span><span>8</span><span>)</span><span>;</span>  <span>//拆分</span>\n            s <span>=</span> <span>Integer</span><span>.</span><span>toString</span><span>(</span><span>Integer</span><span>.</span><span>parseInt</span><span>(</span>s<span>,</span> <span>2</span><span>)</span><span>)</span><span>;</span>  <span>//转化为10进制</span>\n            ans<span>[</span>i<span>]</span> <span>=</span> s<span>;</span>\n        <span>}</span>\n        <span>return</span> <span>String</span><span>.</span><span>join</span><span>(</span><span>\".\"</span><span>,</span> ans<span>)</span><span>;</span>  <span>//拼接</span>\n    <span>}</span>\n<span>}</span>\n\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"复杂度分析-6\" tabindex=\"-1\"> 复杂度分析</h3>\n<ul>\n<li>时间复杂度：O(1)O(1)<em>O</em>(1)，均为常数级别的转换</li>\n<li>空间复杂度：O(1)O(1)<em>O</em>(1)</li>\n</ul>\n<h3 id=\"方法二-直接转换-10进制和256进制\" tabindex=\"-1\"> 方法二：直接转换（10进制和256进制）</h3>\n<h3 id=\"具体方法-3\" tabindex=\"-1\"> 具体方法</h3>\n<p>在第一种方法中，我们通过二进制进行转换，但是仔细分析之后，我们发现，二进制在转换过程中并没有起到作用，再进行重新分析，我们可以发现，ip地址实际上是256进制下的四位数字，所以我们可以直接进行转换，将10进制转化为256进制。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/A2CB19422F49F00D316AB0AFCA62827D.png\" alt=\"alt\"></p>\n<h3 id=\"java代码-6\" tabindex=\"-1\"> Java代码</h3>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Scanner</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span><span>{</span>\n        <span>Scanner</span> sc <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>while</span><span>(</span>sc<span>.</span><span>hasNext</span><span>(</span><span>)</span><span>)</span><span>{</span>\n            <span>String</span> s <span>=</span> sc<span>.</span><span>next</span><span>(</span><span>)</span><span>;</span>\n            <span>if</span><span>(</span>s<span>.</span><span>contains</span><span>(</span><span>\".\"</span><span>)</span><span>)</span><span>{</span>\n                <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>ip2num</span><span>(</span>s<span>)</span><span>)</span><span>;</span>\n            <span>}</span><span>else</span><span>{</span>\n                <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>num2ip</span><span>(</span><span>Long</span><span>.</span><span>parseLong</span><span>(</span>s<span>)</span><span>)</span><span>)</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n    <span>}</span>\n\n    <span>public</span> <span>static</span> <span>long</span> <span>ip2num</span><span>(</span><span>String</span> ip<span>)</span><span>{</span>\n        <span>String</span><span>[</span><span>]</span> iip <span>=</span> ip<span>.</span><span>split</span><span>(</span><span>\"\\\\.\"</span><span>)</span><span>;</span>\n        <span>Long</span> ans <span>=</span> <span>(</span><span>long</span><span>)</span><span>0</span><span>;</span>\n        <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i<span>&lt;</span><span>4</span><span>;</span> i<span>++</span><span>)</span><span>{</span>\n            ans <span>=</span> ans <span>*</span> <span>256</span> <span>+</span> <span>Long</span><span>.</span><span>parseLong</span><span>(</span>iip<span>[</span>i<span>]</span><span>)</span><span>;</span>\n        <span>}</span>\n        <span>return</span> ans<span>;</span>\n    <span>}</span>\n\n    <span>public</span> <span>static</span> <span>String</span> <span>num2ip</span><span>(</span><span>long</span> num<span>)</span><span>{</span>\n        <span>String</span><span>[</span><span>]</span> ans <span>=</span> <span>new</span> <span>String</span><span>[</span><span>4</span><span>]</span><span>;</span>\n        <span>for</span><span>(</span><span>int</span> i<span>=</span><span>3</span><span>;</span> i<span>>=</span><span>0</span><span>;</span> i<span>--</span><span>)</span><span>{</span>\n            ans<span>[</span>i<span>]</span> <span>=</span> <span>Long</span><span>.</span><span>toString</span><span>(</span>num <span>%</span> <span>256</span><span>)</span><span>;</span>\n            num <span>=</span> num <span>/</span> <span>256</span><span>;</span>\n        <span>}</span>\n        <span>return</span> <span>String</span><span>.</span><span>join</span><span>(</span><span>\".\"</span><span>,</span> ans<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"复杂度分析-7\" tabindex=\"-1\"> 复杂度分析</h3>\n<ul>\n<li>时间复杂度：O(1)O(1)<em>O</em>(1)，均为常数级别的转换</li>\n<li>空间复杂度：O(1)O(1)<em>O</em>(1)</li>\n</ul>\n<h2 id=\"hj41-称砝码\" tabindex=\"-1\"> <strong>HJ41</strong> <strong>称砝码</strong></h2>\n<h3 id=\"描述-13\" tabindex=\"-1\"> 描述</h3>\n<p>现有n种砝码，重量互不相等，分别为 m1,m2,m3…mn ；\n每种砝码对应的数量为 x1,x2,x3...xn 。现在要用这些砝码去称物体的重量(放在同一侧)，问能称出多少种不同的重量。</p>\n<p>注：</p>\n<p>称重重量包括 0</p>\n<p>数据范围：每组输入数据满足 1 \\le n \\le 10 \\1≤<em>n</em>≤10 ， 1 \\le m_i \\le 2000 \\1≤<em>m**i</em>≤2000 ， 1 \\le x_i \\le 10 \\1≤<em>x**i</em>≤10</p>\n<h3 id=\"输入描述-13\" tabindex=\"-1\"> 输入描述：</h3>\n<p>对于每组测试数据：\n第一行：n --- 砝码的种数(范围[1,10])\n第二行：m1 m2 m3 ... mn --- 每种砝码的重量(范围[1,2000])\n第三行：x1 x2 x3 .... xn --- 每种砝码对应的数量(范围[1,10])</p>\n<h3 id=\"输出描述-13\" tabindex=\"-1\"> 输出描述：</h3>\n<p>利用给定的砝码可以称出的不同的重量数</p>\n<h3 id=\"示例1-13\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>2\n1 2\n2 1\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>输出：</p>\n<div><pre><code>5\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>说明：</p>\n<div><pre><code>可以表示出0，1，2，3，4五种重量。   \n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>hashset去重，三层循环，遍历砝码，遍历砝码个数，遍历当前set的结果</p>\n<h3 id=\"代码-7\" tabindex=\"-1\"> 代码：</h3>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>{</span>\n        <span>Scanner</span> in <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>while</span> <span>(</span>in<span>.</span><span>hasNextInt</span><span>(</span><span>)</span><span>)</span> <span>{</span> <span>// 注意 while 处理多个 case</span>\n            <span>HashSet</span><span><span>&lt;</span><span>Integer</span><span>></span></span> set <span>=</span> <span>new</span> <span>HashSet</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span><span>//存放所有可能的结果，不用担心重复问题</span>\n            set<span>.</span><span>add</span><span>(</span><span>0</span><span>)</span><span>;</span><span>//初始化为0</span>\n            <span>int</span> n <span>=</span> in<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span><span>//个数</span>\n            <span>int</span><span>[</span><span>]</span> w <span>=</span> <span>new</span> <span>int</span><span>[</span>n<span>]</span><span>;</span>\n            <span>int</span><span>[</span><span>]</span> nums <span>=</span> <span>new</span> <span>int</span><span>[</span>n<span>]</span><span>;</span>\n            <span>for</span><span>(</span><span>int</span> i<span>=</span><span>0</span><span>;</span>i<span>&lt;</span>n<span>;</span>i<span>++</span><span>)</span><span>{</span>\n                w<span>[</span>i<span>]</span> <span>=</span> in<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span><span>//砝码的重量</span>\n            <span>}</span>\n            <span>for</span><span>(</span><span>int</span> i<span>=</span><span>0</span><span>;</span>i<span>&lt;</span>n<span>;</span>i<span>++</span><span>)</span><span>{</span>\n                nums<span>[</span>i<span>]</span> <span>=</span> in<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span><span>//砝码个数</span>\n            <span>}</span>\n            <span>for</span><span>(</span><span>int</span> i<span>=</span><span>0</span><span>;</span>i<span>&lt;</span>n<span>;</span>i<span>++</span><span>)</span><span>{</span><span>//遍历砝码</span>\n                <span>ArrayList</span><span><span>&lt;</span><span>Integer</span><span>></span></span> list <span>=</span> <span>new</span> <span>ArrayList</span><span><span>&lt;</span><span>></span></span><span>(</span>set<span>)</span><span>;</span><span>//取当前所有的结果</span>\n                <span>for</span><span>(</span><span>int</span> j<span>=</span><span>1</span><span>;</span>j<span>&lt;=</span>nums<span>[</span>i<span>]</span><span>;</span>j<span>++</span><span>)</span><span>{</span><span>//遍历个数</span>\n                    <span>for</span><span>(</span><span>int</span> k<span>=</span><span>0</span><span>;</span>k<span>&lt;</span>list<span>.</span><span>size</span><span>(</span><span>)</span><span>;</span>k<span>++</span><span>)</span><span>{</span>\n                        set<span>.</span><span>add</span><span>(</span>list<span>.</span><span>get</span><span>(</span>k<span>)</span> <span>+</span> w<span>[</span>i<span>]</span> <span>*</span> j<span>)</span><span>;</span>\n                    <span>}</span>\n                <span>}</span>\n            <span>}</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>set<span>.</span><span>size</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"hj60-查找组成一个偶数最接近的两个素数\" tabindex=\"-1\"> <strong>HJ60</strong> <strong>查找组成一个偶数最接近的两个素数</strong></h2>\n<h3 id=\"描述-14\" tabindex=\"-1\"> 描述</h3>\n<p>任意一个偶数（大于2）都可以由2个素数组成，组成偶数的2个素数有很多种情况，本题目要求输出组成指定偶数的两个素数差值最小的素数对。</p>\n<p>数据范围：输入的数据满足 4 \\le n \\le 1000 \\4≤<em>n</em>≤1000</p>\n<h3 id=\"输入描述-14\" tabindex=\"-1\"> 输入描述：</h3>\n<p>输入一个大于2的偶数</p>\n<h3 id=\"输出描述-14\" tabindex=\"-1\"> 输出描述：</h3>\n<p>从小到大输出两个素数</p>\n<h3 id=\"示例1-14\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>20\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>输出：</p>\n<div><pre><code>7\n13\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h2 id=\"示例2-3\" tabindex=\"-1\"> 示例2</h2>\n<p>输入：</p>\n<div><pre><code>4\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>输出：</p>\n<div><pre><code>2\n2\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h3 id=\"穷举优化\" tabindex=\"-1\"> 穷举优化</h3>\n<p><strong>解题思路：</strong></p>\n<p>采取从中间向两边枚举的方式，这样贪心的控制住两素数之差距离最小的这个限制</p>\n<p><strong>算法流程</strong>：</p>\n<ul>\n<li>对于每个数字，从最接近的两个中位数开始处理判断是否素数</li>\n<li>如果两个组成偶数的数字都是素数，因为是从最接近的两个数开始枚举，因此一旦都是素数则输出并返回，得到结果</li>\n</ul>\n<p><strong>Java 版本代码如下：</strong></p>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n \n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>{</span>\n        <span>Scanner</span> scanner <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>while</span> <span>(</span>scanner<span>.</span><span>hasNext</span><span>(</span><span>)</span><span>)</span><span>{</span>\n        \t<span>int</span> num <span>=</span> scanner<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n        \t<span>solution</span><span>(</span>num<span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n\n    <span>private</span> <span>static</span> <span>void</span> <span>solution</span><span>(</span><span>int</span> num<span>)</span> <span>{</span>\n        <span>//如num=10, 遍历:5,6,7,8</span>\n        <span>// 从最接近的两个中位数开始处理判断</span>\n        <span>for</span><span>(</span><span>int</span> i <span>=</span> num <span>/</span> <span>2</span><span>;</span> i <span>&lt;</span> num <span>-</span> <span>1</span><span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            <span>if</span><span>(</span><span>isPrime</span><span>(</span>i<span>)</span> <span>&amp;&amp;</span> <span>isPrime</span><span>(</span>num <span>-</span> i<span>)</span><span>)</span> <span>{</span>\n                <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>(</span>num <span>-</span> i<span>)</span> <span>+</span> <span>\"\\n\"</span> <span>+</span> i<span>)</span><span>;</span>\n                <span>return</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n    <span>}</span>\n    <span>// 判断是否素数</span>\n    <span>private</span> <span>static</span> <span>boolean</span> <span>isPrime</span><span>(</span><span>int</span> num<span>)</span> <span>{</span>\n        <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>2</span><span>;</span> i <span>&lt;=</span> <span>Math</span><span>.</span><span>sqrt</span><span>(</span>num<span>)</span><span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            <span>if</span><span>(</span>num <span>%</span> i <span>==</span> <span>0</span><span>)</span> <span>{</span>\n                <span>return</span> <span>false</span><span>;</span>\n            <span>}</span>\n        <span>}</span> \n        <span>return</span> <span>true</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"hj68-成绩排序\" tabindex=\"-1\"> <strong>HJ68</strong> <strong>成绩排序</strong></h2>\n<h3 id=\"描述-15\" tabindex=\"-1\"> 描述</h3>\n<p>给定一些同学的信息（名字，成绩）序列，请你将他们的信息按照成绩从高到低或从低到高的排列,相同成绩</p>\n<p>都按先录入排列在前的规则处理。</p>\n<p>例示：\njack   70\npeter   96\nTom    70\nsmith   67</p>\n<p>从高到低 成绩\npeter   96\njack   70\nTom    70\nsmith   67</p>\n<p>从低到高</p>\n<p>smith   67</p>\n<p>jack   70</p>\n<p>Tom    70</p>\n<p>peter   96</p>\n<p>注：0代表从高到低，1代表从低到高</p>\n<p>数据范围：人数：1\\le n \\le 200\\1≤<em>n</em>≤200</p>\n<p>进阶：时间复杂度：O(nlogn)*O*(<em>n<strong>l</strong>o<strong>g</strong>n</em>) ，空间复杂度：O(n)*O*(<em>n</em>)</p>\n<h3 id=\"输入描述-15\" tabindex=\"-1\"> 输入描述：</h3>\n<p>第一行输入要排序的人的个数n，第二行输入一个整数表示排序的方式，之后n行分别输入他们的名字和成绩，以一个空格隔开</p>\n<h3 id=\"输出描述-15\" tabindex=\"-1\"> 输出描述：</h3>\n<p>按照指定方式输出名字和成绩，名字和成绩之间以一个空格隔开</p>\n<h3 id=\"示例1-15\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>3\n0\nfang 90\nyang 50\nning 70\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>输出：</p>\n<div><pre><code>fang 90\nning 70\nyang 50\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><h3 id=\"示例2-4\" tabindex=\"-1\"> 示例2</h3>\n<p>输入：</p>\n<div><pre><code>3\n1\nfang 90\nyang 50\nning 70\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>输出：</p>\n<div><pre><code>yang 50\nning 70\nfang 90\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p><strong>算法流程</strong>：</p>\n<ul>\n<li>通过一个二维数组，每一行包括姓名编号，成绩，将输入的姓名用编号代替，第二列保存成绩</li>\n<li>自定义排序\n<ul>\n<li>倒序，按第二列的成绩降序排列,如果相等的话，返回0，顺序不变，因为默认编号是升序的，符合题意</li>\n<li>升序则 按成绩升序排序</li>\n</ul>\n</li>\n<li>最后根据已经排序后的数组，顺序输出结果</li>\n</ul>\n<h3 id=\"代码-8\" tabindex=\"-1\"> 代码：</h3>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span><span>{</span>\n        <span>Scanner</span> sc <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>HashMap</span><span><span>&lt;</span><span>Integer</span><span>,</span><span>String</span><span>></span></span> map <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        <span>while</span><span>(</span>sc<span>.</span><span>hasNextLine</span><span>(</span><span>)</span><span>)</span><span>{</span>\n            <span>// 学生成绩数</span>\n            <span>int</span> n <span>=</span> <span>Integer</span><span>.</span><span>parseInt</span><span>(</span>sc<span>.</span><span>nextLine</span><span>(</span><span>)</span><span>)</span><span>;</span>\n            <span>//1是升序，0是降序</span>\n            <span>int</span> flag <span>=</span> <span>Integer</span><span>.</span><span>parseInt</span><span>(</span>sc<span>.</span><span>nextLine</span><span>(</span><span>)</span><span>)</span><span>;</span>\n            <span>// 每一行包括姓名编号，成绩</span>\n            <span>int</span><span>[</span><span>]</span><span>[</span><span>]</span> score <span>=</span> <span>new</span> <span>int</span><span>[</span>n<span>]</span><span>[</span><span>2</span><span>]</span><span>;</span>\n            <span>for</span><span>(</span><span>int</span> i<span>=</span><span>0</span><span>;</span>i<span>&lt;</span>n<span>;</span>i<span>++</span><span>)</span><span>{</span>\n                <span>String</span><span>[</span><span>]</span> nameAndScore <span>=</span> sc<span>.</span><span>nextLine</span><span>(</span><span>)</span><span>.</span><span>split</span><span>(</span><span>\" \"</span><span>)</span><span>;</span>\n                <span>// 学生用编号代替</span>\n                score<span>[</span>i<span>]</span><span>[</span><span>0</span><span>]</span> <span>=</span> i<span>;</span>\n                score<span>[</span>i<span>]</span><span>[</span><span>1</span><span>]</span> <span>=</span> <span>Integer</span><span>.</span><span>parseInt</span><span>(</span>nameAndScore<span>[</span><span>1</span><span>]</span><span>)</span><span>;</span>\n                map<span>.</span><span>put</span><span>(</span>i<span>,</span>nameAndScore<span>[</span><span>0</span><span>]</span><span>)</span><span>;</span>\n            <span>}</span>\n            <span>// 自定义排序</span>\n            <span>Arrays</span><span>.</span><span>sort</span><span>(</span>score<span>,</span><span>(</span>o1<span>,</span>o2<span>)</span> <span>-></span><span>{</span>\n                <span>// 倒序，按第二列的成绩降序排列,如果相等的话，返回0，顺序不变，因为默认编号是升序的，符合题意</span>\n                <span>if</span><span>(</span>flag<span>==</span><span>0</span><span>)</span><span>{</span>\n                    <span>return</span> o2<span>[</span><span>1</span><span>]</span> <span>-</span> o1<span>[</span><span>1</span><span>]</span><span>;</span>\n                <span>}</span><span>else</span><span>{</span>\n                    <span>// 按成绩升序排序</span>\n                    <span>return</span> o1<span>[</span><span>1</span><span>]</span> <span>-</span> o2<span>[</span><span>1</span><span>]</span><span>;</span>\n                <span>}</span>\n            <span>}</span><span>)</span><span>;</span>\n            <span>// 根据已经排序后的数组，顺序输出结果</span>\n            <span>for</span><span>(</span><span>int</span> i<span>=</span><span>0</span><span>;</span>i<span>&lt;</span>n<span>;</span>i<span>++</span><span>)</span><span>{</span>\n                <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>map<span>.</span><span>get</span><span>(</span>score<span>[</span>i<span>]</span><span>[</span><span>0</span><span>]</span><span>)</span> <span>+</span> <span>\" \"</span> <span>+</span> score<span>[</span>i<span>]</span><span>[</span><span>1</span><span>]</span><span>)</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"hj101-输入整型数组和排序标识-对其元素按照升序或降序进行排序\" tabindex=\"-1\"> <strong>HJ101</strong> <strong>输入整型数组和排序标识，对其元素按照升序或降序进行排序</strong></h2>\n<h3 id=\"描述-16\" tabindex=\"-1\"> 描述</h3>\n<p>输入整型数组和排序标识，对其元素按照升序或降序进行排序</p>\n<p>数据范围： 1 \\le n \\le 1000 \\1≤<em>n</em>≤1000 ，元素大小满足 0 \\le val \\le 100000 \\0≤<em>v<strong>a</strong>l</em>≤100000</p>\n<h3 id=\"输入描述-16\" tabindex=\"-1\"> 输入描述：</h3>\n<p>第一行输入数组元素个数\n第二行输入待排序的数组，每个数用空格隔开\n第三行输入一个整数0或1。0代表升序排序，1代表降序排序</p>\n<h3 id=\"输出描述-16\" tabindex=\"-1\"> 输出描述：</h3>\n<p>输出排好序的数字</p>\n<h3 id=\"示例1-16\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>8\n1 2 4 9 3 55 64 25\n0\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>输出：</p>\n<div><pre><code>1 2 3 4 9 25 55 64\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h3 id=\"示例2-5\" tabindex=\"-1\"> 示例2</h3>\n<p>输入：</p>\n<div><pre><code>5\n1 2 3 4 5\n1\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>输出：</p>\n<div><pre><code>5 4 3 2 1\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><blockquote>\n<p>Scanner有多次输入，且存在输入数字组成数组的情况 建议使用while(sc.hasNext()) 判断是否存在下次输入，并按业务录入数字组成数组</p>\n</blockquote>\n<blockquote>\n<p>Arrays.sort方法可以对Integer数组 按Comparator自定义比较器执行排序，注意参数o1,o2, 左-右（o1-o2）是升序排序; 右-左（o2-o1）是降序排序;</p>\n</blockquote>\n<blockquote>\n<p>题解源代码</p>\n</blockquote>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n<span>public</span> <span>class</span> <span>Main</span><span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span><span>{</span>\n        <span>Scanner</span> sc <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n   \n        <span>//有多次输入，且存在输入数字组成数组的情况</span>\n        <span>while</span><span>(</span>sc<span>.</span><span>hasNext</span><span>(</span><span>)</span><span>)</span><span>{</span>\n            <span>//第一行输入数组元素个数</span>\n             <span>int</span> arrCount <span>=</span> sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n            <span>//第二行输入待排序的数组，每个数用空格隔开</span>\n            <span>Integer</span><span>[</span><span>]</span> arr <span>=</span> <span>new</span> <span>Integer</span><span>[</span>arrCount<span>]</span><span>;</span>\n            <span>//录入 arrCount 个 数字，组成数组</span>\n            <span>for</span><span>(</span><span>int</span> i<span>=</span><span>0</span><span>;</span>i<span>&lt;</span>arrCount<span>;</span>i<span>++</span><span>)</span><span>{</span>\n                arr<span>[</span>i<span>]</span> <span>=</span> sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n            <span>}</span>\n            <span>//第三行输入一个整数0或1。0代表升序排序，1代表降序排序</span>\n            <span>int</span> flagSort <span>=</span> sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n            \n            <span>if</span><span>(</span>flagSort<span>==</span><span>0</span><span>)</span><span>{</span>\n                <span>Arrays</span><span>.</span><span>sort</span><span>(</span>arr<span>,</span><span>new</span> <span>Comparator</span><span><span>&lt;</span><span>Integer</span><span>></span></span><span>(</span><span>)</span><span>{</span>\n                    <span>public</span> <span>int</span> <span>compare</span><span>(</span><span>Integer</span> o1 <span>,</span><span>Integer</span> o2<span>)</span><span>{</span>\n                        <span>return</span> o1<span>-</span>o2<span>;</span>\n                    <span>}</span>\n                <span>}</span><span>)</span><span>;</span>\n            <span>}</span>\n            <span>if</span><span>(</span>flagSort<span>==</span><span>1</span><span>)</span><span>{</span>\n                <span>Arrays</span><span>.</span><span>sort</span><span>(</span>arr<span>,</span><span>new</span> <span>Comparator</span><span><span>&lt;</span><span>Integer</span><span>></span></span><span>(</span><span>)</span><span>{</span>\n                    <span>public</span> <span>int</span> <span>compare</span><span>(</span><span>Integer</span> o1 <span>,</span><span>Integer</span> o2<span>)</span><span>{</span>\n                        <span>return</span> o2<span>-</span>o1<span>;</span>\n                    <span>}</span>\n                <span>}</span><span>)</span><span>;</span>\n            <span>}</span>\n      \n            <span>for</span><span>(</span><span>Integer</span> m <span>:</span> arr<span>)</span><span>{</span>\n                <span>System</span><span>.</span>out<span>.</span><span>print</span><span>(</span>m <span>+</span> <span>\" \"</span><span>)</span><span>;</span>\n            <span>}</span>\n            <span>break</span><span>;</span>\n        <span>}</span>\n        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>)</span><span>;</span>\n  \n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><ol start=\"2\">\n<li></li>\n</ol>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n<span>public</span> <span>class</span> <span>Main</span><span>{</span>\n\t<span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span><span>{</span>\n\t\t<span>Scanner</span> sc <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n\t\t<span>while</span><span>(</span>sc<span>.</span><span>hasNext</span><span>(</span><span>)</span><span>)</span><span>{</span>\n\t\t\t<span>int</span> n <span>=</span> sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span><span>//接收数组长度</span>\n\t\t\t<span>int</span><span>[</span><span>]</span> arr <span>=</span> <span>new</span> <span>int</span><span>[</span>n<span>]</span><span>;</span><span>//创建数组</span>\n\n\t\t\t<span>for</span> <span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> n<span>;</span> i<span>++</span><span>)</span> <span>{</span><span>//数组填入</span>\n\t\t\t\tarr<span>[</span>i<span>]</span> <span>=</span> sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n\t\t\t<span>}</span>\n\t\t\t\n\t\t\t<span>int</span> flag <span>=</span> sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span><span>//接收排序标识</span>\n\t\t\t<span>Arrays</span><span>.</span><span>sort</span><span>(</span>arr<span>)</span><span>;</span><span>//数组排序</span>\n\n\t\t\t<span>if</span> <span>(</span>flag <span>==</span> <span>0</span><span>)</span> <span>{</span><span>//正序输出</span>\n\t\t\t\t<span>for</span><span>(</span><span>int</span> i <span>=</span><span>0</span><span>;</span> i <span>&lt;</span> arr<span>.</span>length<span>;</span> i<span>++</span><span>)</span><span>{</span>\n\t\t\t\t\t<span>System</span><span>.</span>out<span>.</span><span>print</span><span>(</span>arr<span>[</span>i<span>]</span> <span>+</span> <span>\" \"</span><span>)</span><span>;</span>\n\t\t\t\t<span>}</span> \n\t\t\t<span>}</span>\n\t\t\t<span>else</span> <span>{</span><span>//逆序输出</span>\n\t\t\t\t\t<span>for</span><span>(</span><span>int</span> i <span>=</span> arr<span>.</span>length <span>-</span> <span>1</span><span>;</span> i <span>>=</span> <span>0</span><span>;</span> i<span>--</span><span>)</span><span>{</span>\n\t\t\t\t\t\t<span>System</span><span>.</span>out<span>.</span><span>print</span><span>(</span>arr<span>[</span>i<span>]</span> <span>+</span> <span>\" \"</span><span>)</span><span>;</span>\n\t\t\t\t\t<span>}</span>\n\t\t\t<span>}</span>\n\t\t<span>}</span>\n\t<span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"hj106-字符逆序\" tabindex=\"-1\"> <strong>HJ106</strong> <strong>字符逆序</strong></h2>\n<h3 id=\"描述-17\" tabindex=\"-1\"> 描述</h3>\n<p>将一个字符串str的内容颠倒过来，并输出。</p>\n<p>数据范围：1 \\le len(str) \\le 10000\\1≤<em>l<strong>e</strong>n</em>(<em>s<strong>t</strong>r</em>)≤10000</p>\n<h3 id=\"输入描述-17\" tabindex=\"-1\"> 输入描述：</h3>\n<p>输入一个字符串，可以有空格</p>\n<h3 id=\"输出描述-17\" tabindex=\"-1\"> 输出描述：</h3>\n<p>输出逆序的字符串</p>\n<h3 id=\"示例1-17\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>I am a student\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>输出：</p>\n<div><pre><code>tneduts a ma I\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h3 id=\"示例2-6\" tabindex=\"-1\"> 示例2</h3>\n<p>输入：</p>\n<div><pre><code>nowcoder\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>输出：</p>\n<div><pre><code>redocwon\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h3 id=\"代码-9\" tabindex=\"-1\"> 代码：</h3>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span><span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span><span>{</span>\n        <span>Scanner</span> scan <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>String</span> input <span>=</span> scan<span>.</span><span>nextLine</span><span>(</span><span>)</span><span>;</span>\n        <span>StringBuilder</span> res <span>=</span> <span>new</span> <span>StringBuilder</span><span>(</span>input<span>)</span><span>;</span>\n        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>res<span>.</span><span>reverse</span><span>(</span><span>)</span><span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"hj108-求最小公倍数\" tabindex=\"-1\"> <strong>HJ108</strong> <strong>求最小公倍数</strong></h2>\n<h3 id=\"描述-18\" tabindex=\"-1\"> 描述</h3>\n<p>正整数A和正整数B 的最小公倍数是指 能被A和B整除的最小的正整数值，设计一个算法，求输入A和B的最小公倍数。</p>\n<p>数据范围：1 \\le a,b \\le 100000 \\1≤<em>a</em>,<em>b</em>≤100000</p>\n<h3 id=\"输入描述-18\" tabindex=\"-1\"> 输入描述：</h3>\n<p>输入两个正整数A和B。</p>\n<h3 id=\"输出描述-18\" tabindex=\"-1\"> 输出描述：</h3>\n<p>输出A和B的最小公倍数。</p>\n<h3 id=\"示例1-18\" tabindex=\"-1\"> 示例1</h3>\n<p>输入：</p>\n<div><pre><code>5 7\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>输出：</p>\n<div><pre><code>35\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h3 id=\"示例2-7\" tabindex=\"-1\"> 示例2</h3>\n<p>输入：</p>\n<div><pre><code>2 4\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>输出：</p>\n<div><pre><code>4\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h3 id=\"代码-10\" tabindex=\"-1\"> 代码：</h3>\n<p>a，b的最大公约数为gcd（a，b），最小公倍数的公式为：\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/right}{gcd(a%2Cb)}.svg\" alt=\"图片说明\">\n此题说是正数，所以绝对值无所谓了。我们可以发现题目带了‘递归’的标签，那么就用递归来实现gcd，既是面向题目编程，又方便了自己，一举两得。</p>\n<p>gcd的算法是根据Euclidean algorithm来的，拿维基百科的例子来说：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/equation.svg\" alt=\"图片说明\"></p>\n<blockquote>\n<p>计算<em>a</em> = 1071和<em>b</em> = 462的最大公约数的过程如下：从1071中不断减去462直到小于462（可以减2次，即商<em>q</em>0 = 2），余数是147：</p>\n<p>1071 = 2 × 462 + 147.</p>\n<p>然后从462中不断减去147直到小于147（可以减3次，即<em>q</em>1 = 3），余数是21：</p>\n<p>462 = 3 × 147 + 21.</p>\n<p>再从147中不断减去21直到小于21（可以减7次，即<em>q</em>2 = 7），没有余数：</p>\n<p>147 = 7 × 21 + 0.</p>\n<p>此时，余数是0，所以1071和462的<strong>最大公约数</strong>是21。</p>\n</blockquote>\n<div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>*</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span><span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span><span>{</span>\n        <span>Scanner</span> sc <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>while</span><span>(</span>sc<span>.</span><span>hasNextInt</span><span>(</span><span>)</span><span>)</span><span>{</span>\n            <span>int</span> a <span>=</span> sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n            <span>int</span> b <span>=</span> sc<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n            <span>for</span><span>(</span><span>int</span> i <span>=</span> <span>Math</span><span>.</span><span>min</span><span>(</span>a<span>,</span>b<span>)</span><span>;</span> i <span>></span> <span>0</span><span>;</span> i<span>--</span><span>)</span><span>{</span>\n                <span>if</span><span>(</span>a<span>%</span>i <span>==</span> <span>0</span> <span>&amp;&amp;</span> b<span>%</span>i <span>==</span> <span>0</span><span>)</span><span>{</span>\n                    <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>a<span>*</span>b<span>/</span>i<span>)</span><span>;</span>\n                    <span>break</span><span>;</span>\n                <span>}</span>\n            <span>}</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><div><pre><code><span>import</span> <span><span>java<span>.</span>util<span>.</span></span><span>Scanner</span></span><span>;</span>\n\n<span>public</span> <span>class</span> <span>Main</span> <span>{</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>{</span>\n        <span>Scanner</span> in <span>=</span> <span>new</span> <span>Scanner</span><span>(</span><span>System</span><span>.</span>in<span>)</span><span>;</span>\n        <span>while</span> <span>(</span>in<span>.</span><span>hasNextInt</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n            <span>int</span> a <span>=</span> in<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n            <span>int</span> b <span>=</span> in<span>.</span><span>nextInt</span><span>(</span><span>)</span><span>;</span>\n            <span>int</span> lcm <span>=</span> a<span>*</span>b <span>/</span> <span>gcd</span><span>(</span>a<span>,</span>b<span>)</span><span>;</span>\n            <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>lcm<span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n\n    <span>public</span> <span>static</span> <span>int</span> <span>gcd</span><span>(</span><span>int</span> a<span>,</span> <span>int</span> b<span>)</span> <span>{</span>\n            <span>if</span> <span>(</span>b<span>==</span><span>0</span><span>)</span> <span>return</span> a<span>;</span>\n            <span>return</span> <span>gcd</span><span>(</span>b<span>,</span>a<span>%</span>b<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/4C136CEEE2387171DC8F01C8018C819E.gif",
      "date_published": "2022-05-31T00:00:00.000Z",
      "date_modified": "2022-05-31T13:51:34.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "algorithm"
      ]
    },
    {
      "title": "Springboot利用ThreadPoolTaskExecutor多线程批量插入百万级数据",
      "url": "https://blog.ciberviler.top/dev/Springboot%E5%88%A9%E7%94%A8ThreadPoolTaskExecutor%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E7%99%BE%E4%B8%87%E7%BA%A7%E6%95%B0%E6%8D%AE.html",
      "id": "https://blog.ciberviler.top/dev/Springboot%E5%88%A9%E7%94%A8ThreadPoolTaskExecutor%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E7%99%BE%E4%B8%87%E7%BA%A7%E6%95%B0%E6%8D%AE.html",
      "summary": "Springboot利用ThreadPoolTaskExecutor多线程批量插入百万级数据",
      "content_html": "<h1 id=\"springboot利用threadpooltaskexecutor多线程批量插入百万级数据\" tabindex=\"-1\"> Springboot利用ThreadPoolTaskExecutor多线程批量插入百万级数据</h1>\n<h2 id=\"前言\" tabindex=\"-1\"> 前言</h2>\n<p>开发目的：提高百万级数据插入效率。</p>\n<p>采取方案：利用ThreadPoolTaskExecutor多线程批量插入。</p>\n<p>采用技术：springboot2.1.1+mybatisPlus3.0.6+swagger2.5.0+Lombok1.18.4+postgresql+ThreadPoolTaskExecutor等。</p>\n<h2 id=\"具体实现细节\" tabindex=\"-1\"> <strong>具体实现细节</strong></h2>\n<h3 id=\"application-dev-properties添加线程池配置信息\" tabindex=\"-1\"> application-dev.properties添加线程池配置信息</h3>\n<div><pre><code># 异步线程配置\n# 配置核心线程数\nasync.executor.thread.core_pool_size = 30\n# 配置最大线程数\nasync.executor.thread.max_pool_size = 30\n# 配置队列大小\nasync.executor.thread.queue_capacity = 99988\n# 配置线程池中的线程的名称前缀\nasync.executor.thread.name.prefix = async-importDB-\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"spring容器注入线程池bean对象\" tabindex=\"-1\"> spring容器注入线程池bean对象</h3>\n<div><pre><code><span>@Configuration</span>\n \n<span>@EnableAsync</span>\n \n<span>@Slf4j</span>\n \n<span>public</span> <span>class</span> <span>ExecutorConfig</span> <span>{</span>\n    <span>@Value</span><span>(</span><span>\"${async.executor.thread.core_pool_size}\"</span><span>)</span>\n    <span>private</span> <span>int</span> corePoolSize<span>;</span>\n    <span>@Value</span><span>(</span><span>\"${async.executor.thread.max_pool_size}\"</span><span>)</span>\n    <span>private</span> <span>int</span> maxPoolSize<span>;</span>\n    <span>@Value</span><span>(</span><span>\"${async.executor.thread.queue_capacity}\"</span><span>)</span>\n    <span>private</span> <span>int</span> queueCapacity<span>;</span>\n    <span>@Value</span><span>(</span><span>\"${async.executor.thread.name.prefix}\"</span><span>)</span>\n    <span>private</span> <span>String</span> namePrefix<span>;</span>\n \n    <span>@Bean</span><span>(</span>name <span>=</span> <span>\"asyncServiceExecutor\"</span><span>)</span>\n    <span>public</span> <span>Executor</span> <span>asyncServiceExecutor</span><span>(</span><span>)</span> <span>{</span>\n        log<span>.</span><span>warn</span><span>(</span><span>\"start asyncServiceExecutor\"</span><span>)</span><span>;</span>\n        <span>//在这里修改</span>\n        <span>ThreadPoolTaskExecutor</span> executor <span>=</span> <span>new</span> <span>VisiableThreadPoolTaskExecutor</span><span>(</span><span>)</span><span>;</span>\n        <span>//配置核心线程数</span>\n        executor<span>.</span><span>setCorePoolSize</span><span>(</span>corePoolSize<span>)</span><span>;</span>\n        <span>//配置最大线程数</span>\n        executor<span>.</span><span>setMaxPoolSize</span><span>(</span>maxPoolSize<span>)</span><span>;</span>\n        <span>//配置队列大小</span>\n        executor<span>.</span><span>setQueueCapacity</span><span>(</span>queueCapacity<span>)</span><span>;</span>\n        <span>//配置线程池中的线程的名称前缀</span>\n        executor<span>.</span><span>setThreadNamePrefix</span><span>(</span>namePrefix<span>)</span><span>;</span>\n        <span>// rejection-policy：当pool已经达到max size的时候，如何处理新任务</span>\n        <span>// CALLER_RUNS：不在新线程中执行任务，而是有调用者所在的线程来执行</span>\n        executor<span>.</span><span>setRejectedExecutionHandler</span><span>(</span><span>new</span> <span>ThreadPoolExecutor<span>.</span>CallerRunsPolicy</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>//执行初始化</span>\n        executor<span>.</span><span>initialize</span><span>(</span><span>)</span><span>;</span>\n        <span>return</span> executor<span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"创建异步线程-业务类\" tabindex=\"-1\"> 创建异步线程 业务类</h3>\n<div><pre><code><span>@Service</span>\n \n<span>@Slf4j</span>\n \n<span>public</span> <span>class</span> <span>AsyncServiceImpl</span> <span>implements</span> <span>AsyncService</span> <span>{</span>\n<span>@Override</span>\n    <span>@Async</span><span>(</span><span>\"asyncServiceExecutor\"</span><span>)</span>\n    <span>public</span> <span>void</span> <span>executeAsync</span><span>(</span><span>List</span><span><span>&lt;</span><span>LogOutputResult</span><span>></span></span> logOutputResults<span>,</span> <span>LogOutputResultMapper</span> logOutputResultMapper<span>,</span> <span>CountDownLatch</span> countDownLatch<span>)</span> <span>{</span>\n        <span>try</span><span>{</span>\n            log<span>.</span><span>warn</span><span>(</span><span>\"start executeAsync\"</span><span>)</span><span>;</span>\n            <span>//异步线程要做的事情</span>\n            logOutputResultMapper<span>.</span><span>addLogOutputResultBatch</span><span>(</span>logOutputResults<span>)</span><span>;</span>\n            log<span>.</span><span>warn</span><span>(</span><span>\"end executeAsync\"</span><span>)</span><span>;</span>\n        <span>}</span><span>finally</span> <span>{</span>\n            countDownLatch<span>.</span><span>countDown</span><span>(</span><span>)</span><span>;</span><span>// 很关键, 无论上面程序是否异常必须执行countDown,否则await无法释放</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"创建多线程批量插入具体业务方法\" tabindex=\"-1\"> 创建多线程批量插入具体业务方法</h3>\n<div><pre><code>@Override\n    public int testMultiThread() {\n        List<span><span><span>&lt;</span>LogOutputResult</span><span>></span></span> logOutputResults = getTestData();\n        //测试每100条数据插入开一个线程\n        List&lt;List<span><span><span>&lt;</span>LogOutputResult</span><span>></span></span>> lists = ConvertHandler.splitList(logOutputResults, 100);\n        CountDownLatch countDownLatch = new CountDownLatch(lists.size());\n        for (List<span><span><span>&lt;</span>LogOutputResult</span><span>></span></span> listSub:lists) {\n            asyncService.executeAsync(listSub, logOutputResultMapper,countDownLatch);\n        }\n        try {\n            countDownLatch.await(); //保证之前的所有的线程都执行完成，才会走下面的；\n            // 这样就可以在下面拿到所有线程执行完的集合结果\n        } catch (Exception e) {\n            log.error(\"阻塞异常:\"+e.getMessage());\n        }\n        return logOutputResults.size();\n    }\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"模拟2000003-条数据进行测试\" tabindex=\"-1\"> 模拟2000003 条数据进行测试</h3>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20191225121702208.png\" alt=\"img\"></p>\n<p>多线程 测试 2000003 耗时如下：耗时1.67分钟</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2019122512171971.png\" alt=\"img\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20191225121745132.png\" alt=\"img\"></p>\n<p>本次开启30个线程，截图如下：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20191225121812550.png\" alt=\"img\"></p>\n<p>单线程测试2000003 耗时如下：耗时5.75分钟</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20191225121832495.png\" alt=\"img\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20191225121848593.png\" alt=\"img\"></p>\n<h3 id=\"检查多线程入库的数据-检查是否存在重复入库的问题\" tabindex=\"-1\"> 检查多线程入库的数据，检查是否存在重复入库的问题：</h3>\n<p>根据id分组，查看是否有id重复的数据，通过sql语句检查，没有发现重复入库的问题</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2019122512191274.png\" alt=\"img\"></p>\n<p>检查数据完整性： 通过sql语句查询，多线程录入数据完整\n<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/20191225122051393.png\" alt=\"img\"></p>\n<h2 id=\"测试结果\" tabindex=\"-1\"> 测试结果</h2>\n<p>不同线程数测试：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/2019122512213611.png\" alt=\"img\"></p>\n<p><img src=\"https://img-blog.csdnimg.cn/20191225122203925.png\" alt=\"img\"></p>\n<h2 id=\"总结\" tabindex=\"-1\"> 总结</h2>\n<p>通过以上测试案列，同样是导入2000003 条数据，多线程耗时1.67分钟，单线程耗时5.75分钟。通过对不同线程数的测试，发现不是线程数越多越好，具体多少合适，网上有一个不成文的算法：</p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/20191225121702208.png",
      "date_published": "2022-06-10T00:00:00.000Z",
      "date_modified": "2022-05-28T14:44:42.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "使用CloudFlareWorkers反代网站",
      "url": "https://blog.ciberviler.top/script/%E4%BD%BF%E7%94%A8CloudFlareWorkers%E5%8F%8D%E4%BB%A3%E7%BD%91%E7%AB%99.html",
      "id": "https://blog.ciberviler.top/script/%E4%BD%BF%E7%94%A8CloudFlareWorkers%E5%8F%8D%E4%BB%A3%E7%BD%91%E7%AB%99.html",
      "content_html": "<h1 id=\"使用cloudflareworkers反代网站\" tabindex=\"-1\"> 使用CloudFlareWorkers反代网站</h1>\n<p>给出三种反代源码。</p>\n<h2 id=\"镜像整个网站\" tabindex=\"-1\"> 镜像整个网站</h2>\n<div><pre><code><span>// 替换成你想镜像的站点</span>\n<span>const</span> upstream <span>=</span> <span>'www.google.com'</span>\n \n<span>// 如果那个站点有专门的移动适配站点，否则保持和上面一致</span>\n<span>const</span> upstream_mobile <span>=</span> <span>'www.google.com'</span>\n \n<span>// 你希望禁止哪些国家访问</span>\n<span>const</span> blocked_region <span>=</span> <span>[</span><span>'RU'</span><span>]</span>\n \n<span>// 禁止自访问</span>\n<span>const</span> blocked_ip_address <span>=</span> <span>[</span><span>'0.0.0.0'</span><span>,</span> <span>'127.0.0.1'</span><span>]</span>\n \n<span>// 替换成你想镜像的站点</span>\n<span>const</span> replace_dict <span>=</span> <span>{</span>\n    <span>'$upstream'</span><span>:</span> <span>'$custom_domain'</span><span>,</span>\n    <span>'//www.google.com'</span><span>:</span> <span>''</span>\n<span>}</span>\n \n<span>//以下内容都不用动</span>\n<span>addEventListener</span><span>(</span><span>'fetch'</span><span>,</span> <span>event</span> <span>=></span> <span>{</span>\n    event<span>.</span><span>respondWith</span><span>(</span><span>fetchAndApply</span><span>(</span>event<span>.</span>request<span>)</span><span>)</span><span>;</span>\n<span>}</span><span>)</span>\n \n<span>async</span> <span>function</span> <span>fetchAndApply</span><span>(</span><span>request</span><span>)</span> <span>{</span>\n \n    <span>const</span> region <span>=</span> request<span>.</span>headers<span>.</span><span>get</span><span>(</span><span>'cf-ipcountry'</span><span>)</span><span>.</span><span>toUpperCase</span><span>(</span><span>)</span><span>;</span>\n    <span>const</span> ip_address <span>=</span> request<span>.</span>headers<span>.</span><span>get</span><span>(</span><span>'cf-connecting-ip'</span><span>)</span><span>;</span>\n    <span>const</span> user_agent <span>=</span> request<span>.</span>headers<span>.</span><span>get</span><span>(</span><span>'user-agent'</span><span>)</span><span>;</span>\n \n    <span>let</span> response <span>=</span> <span>null</span><span>;</span>\n    <span>let</span> url <span>=</span> <span>new</span> <span>URL</span><span>(</span>request<span>.</span>url<span>)</span><span>;</span>\n    <span>let</span> url_host <span>=</span> url<span>.</span>host<span>;</span>\n \n    <span>if</span> <span>(</span>url<span>.</span>protocol <span>==</span> <span>'http:'</span><span>)</span> <span>{</span>\n        url<span>.</span>protocol <span>=</span> <span>'https:'</span>\n        response <span>=</span> Response<span>.</span><span>redirect</span><span>(</span>url<span>.</span>href<span>)</span><span>;</span>\n        <span>return</span> response<span>;</span>\n    <span>}</span>\n \n    <span>if</span> <span>(</span><span>await</span> <span>device_status</span><span>(</span>user_agent<span>)</span><span>)</span> <span>{</span>\n        upstream_domain <span>=</span> upstream\n    <span>}</span> <span>else</span> <span>{</span>\n        upstream_domain <span>=</span> upstream_mobile\n    <span>}</span>\n \n    url<span>.</span>host <span>=</span> upstream_domain<span>;</span>\n \n    <span>if</span> <span>(</span>blocked_region<span>.</span><span>includes</span><span>(</span>region<span>)</span><span>)</span> <span>{</span>\n        response <span>=</span> <span>new</span> <span>Response</span><span>(</span><span>'Access denied: WorkersProxy is not available in your region yet.'</span><span>,</span> <span>{</span>\n            <span>status</span><span>:</span> <span>403</span>\n        <span>}</span><span>)</span><span>;</span>\n    <span>}</span> <span>else</span> <span>if</span><span>(</span>blocked_ip_address<span>.</span><span>includes</span><span>(</span>ip_address<span>)</span><span>)</span><span>{</span>\n        response <span>=</span> <span>new</span> <span>Response</span><span>(</span><span>'Access denied: Your IP address is blocked by WorkersProxy.'</span><span>,</span> <span>{</span>\n            <span>status</span><span>:</span> <span>403</span>\n        <span>}</span><span>)</span><span>;</span>\n    <span>}</span> <span>else</span><span>{</span>\n        <span>let</span> method <span>=</span> request<span>.</span>method<span>;</span>\n        <span>let</span> request_headers <span>=</span> request<span>.</span>headers<span>;</span>\n        <span>let</span> new_request_headers <span>=</span> <span>new</span> <span>Headers</span><span>(</span>request_headers<span>)</span><span>;</span>\n \n        new_request_headers<span>.</span><span>set</span><span>(</span><span>'Host'</span><span>,</span> upstream_domain<span>)</span><span>;</span>\n        new_request_headers<span>.</span><span>set</span><span>(</span><span>'Referer'</span><span>,</span> url<span>.</span>href<span>)</span><span>;</span>\n \n        <span>let</span> original_response <span>=</span> <span>await</span> <span>fetch</span><span>(</span>url<span>.</span>href<span>,</span> <span>{</span>\n            <span>method</span><span>:</span> method<span>,</span>\n            <span>headers</span><span>:</span> new_request_headers\n        <span>}</span><span>)</span>\n \n        <span>let</span> original_response_clone <span>=</span> original_response<span>.</span><span>clone</span><span>(</span><span>)</span><span>;</span>\n        <span>let</span> original_text <span>=</span> <span>null</span><span>;</span>\n        <span>let</span> response_headers <span>=</span> original_response<span>.</span>headers<span>;</span>\n        <span>let</span> new_response_headers <span>=</span> <span>new</span> <span>Headers</span><span>(</span>response_headers<span>)</span><span>;</span>\n        <span>let</span> status <span>=</span> original_response<span>.</span>status<span>;</span>\n \n        new_response_headers<span>.</span><span>set</span><span>(</span><span>'access-control-allow-origin'</span><span>,</span> <span>'*'</span><span>)</span><span>;</span>\n        new_response_headers<span>.</span><span>set</span><span>(</span><span>'access-control-allow-credentials'</span><span>,</span> <span>true</span><span>)</span><span>;</span>\n        new_response_headers<span>.</span><span>delete</span><span>(</span><span>'content-security-policy'</span><span>)</span><span>;</span>\n        new_response_headers<span>.</span><span>delete</span><span>(</span><span>'content-security-policy-report-only'</span><span>)</span><span>;</span>\n        new_response_headers<span>.</span><span>delete</span><span>(</span><span>'clear-site-data'</span><span>)</span><span>;</span>\n \n        <span>const</span> content_type <span>=</span> new_response_headers<span>.</span><span>get</span><span>(</span><span>'content-type'</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span>content_type<span>.</span><span>includes</span><span>(</span><span>'text/html'</span><span>)</span> <span>&amp;&amp;</span> content_type<span>.</span><span>includes</span><span>(</span><span>'UTF-8'</span><span>)</span><span>)</span> <span>{</span>\n            original_text <span>=</span> <span>await</span> <span>replace_response_text</span><span>(</span>original_response_clone<span>,</span> upstream_domain<span>,</span> url_host<span>)</span><span>;</span>\n        <span>}</span> <span>else</span> <span>{</span>\n            original_text <span>=</span> original_response_clone<span>.</span>body\n        <span>}</span>\n \n        response <span>=</span> <span>new</span> <span>Response</span><span>(</span>original_text<span>,</span> <span>{</span>\n            status<span>,</span>\n            <span>headers</span><span>:</span> new_response_headers\n        <span>}</span><span>)</span>\n    <span>}</span>\n    <span>return</span> response<span>;</span>\n<span>}</span>\n \n<span>async</span> <span>function</span> <span>replace_response_text</span><span>(</span><span>response<span>,</span> upstream_domain<span>,</span> host_name</span><span>)</span> <span>{</span>\n    <span>let</span> text <span>=</span> <span>await</span> response<span>.</span><span>text</span><span>(</span><span>)</span>\n \n    <span>var</span> i<span>,</span> j<span>;</span>\n    <span>for</span> <span>(</span>i <span>in</span> replace_dict<span>)</span> <span>{</span>\n        j <span>=</span> replace_dict<span>[</span>i<span>]</span>\n        <span>if</span> <span>(</span>i <span>==</span> <span>'$upstream'</span><span>)</span> <span>{</span>\n            i <span>=</span> upstream_domain\n        <span>}</span> <span>else</span> <span>if</span> <span>(</span>i <span>==</span> <span>'$custom_domain'</span><span>)</span> <span>{</span>\n            i <span>=</span> host_name\n        <span>}</span>\n \n        <span>if</span> <span>(</span>j <span>==</span> <span>'$upstream'</span><span>)</span> <span>{</span>\n            j <span>=</span> upstream_domain\n        <span>}</span> <span>else</span> <span>if</span> <span>(</span>j <span>==</span> <span>'$custom_domain'</span><span>)</span> <span>{</span>\n            j <span>=</span> host_name\n        <span>}</span>\n \n        <span>let</span> re <span>=</span> <span>new</span> <span>RegExp</span><span>(</span>i<span>,</span> <span>'g'</span><span>)</span>\n        text <span>=</span> text<span>.</span><span>replace</span><span>(</span>re<span>,</span> j<span>)</span><span>;</span>\n    <span>}</span>\n    <span>return</span> text<span>;</span>\n<span>}</span>\n \n<span>async</span> <span>function</span> <span>device_status</span> <span>(</span><span>user_agent_info</span><span>)</span> <span>{</span>\n    <span>var</span> agents <span>=</span> <span>[</span><span>\"Android\"</span><span>,</span> <span>\"iPhone\"</span><span>,</span> <span>\"SymbianOS\"</span><span>,</span> <span>\"Windows Phone\"</span><span>,</span> <span>\"iPad\"</span><span>,</span> <span>\"iPod\"</span><span>]</span><span>;</span>\n    <span>var</span> flag <span>=</span> <span>true</span><span>;</span>\n    <span>for</span> <span>(</span><span>var</span> v <span>=</span> <span>0</span><span>;</span> v <span>&lt;</span> agents<span>.</span>length<span>;</span> v<span>++</span><span>)</span> <span>{</span> <span>if</span> <span>(</span>user_agent_info<span>.</span><span>indexOf</span><span>(</span>agents<span>[</span>v<span>]</span><span>)</span> <span>></span> <span>0</span><span>)</span> <span>{</span>\n            flag <span>=</span> <span>false</span><span>;</span>\n            <span>break</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n    <span>return</span> flag<span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"镜像网站带密码访问\" tabindex=\"-1\"> 镜像网站带密码访问</h2>\n<div><pre><code><span>// 替换成你想镜像的站点</span>\n<span>const</span> upstream <span>=</span> <span>'google.com'</span>\n \n<span>// 如果那个站点有专门的移动适配站点，否则保持和上面一致</span>\n<span>const</span> upstream_mobile <span>=</span> <span>'m.google.com'</span>\n \n<span>// 密码访问</span>\n \n<span>const</span> openAuth <span>=</span> <span>false</span>\n<span>const</span> username <span>=</span> <span>'username'</span>\n<span>const</span> password <span>=</span> <span>'password'</span>\n \n<span>// 你希望禁止哪些国家访问</span>\n<span>const</span> blocked_region <span>=</span> <span>[</span><span>'RU'</span><span>]</span>\n \n<span>// 禁止自访问</span>\n<span>const</span> blocked_ip_address <span>=</span> <span>[</span><span>'0.0.0.0'</span><span>,</span> <span>'127.0.0.1'</span><span>]</span>\n \n<span>// 替换成你想镜像的站点</span>\n<span>const</span> replace_dict <span>=</span> <span>{</span>\n    <span>'$upstream'</span><span>:</span> <span>'$custom_domain'</span><span>,</span>\n    <span>'//google.com'</span><span>:</span> <span>''</span>\n<span>}</span>\n \n<span>function</span> <span>unauthorized</span><span>(</span><span>)</span> <span>{</span>\n  <span>return</span> <span>new</span> <span>Response</span><span>(</span><span>'Unauthorized'</span><span>,</span> <span>{</span>\n    <span>headers</span><span>:</span> <span>{</span>\n      <span>'WWW-Authenticate'</span><span>:</span> <span>'Basic realm=\"goindex\"'</span><span>,</span>\n      <span>'Access-Control-Allow-Origin'</span><span>:</span> <span>'*'</span>\n    <span>}</span><span>,</span>\n    <span>status</span><span>:</span> <span>401</span>\n  <span>}</span><span>)</span><span>;</span>\n<span>}</span>\n \n<span>function</span> <span>parseBasicAuth</span><span>(</span><span>auth</span><span>)</span> <span>{</span>\n    <span>try</span> <span>{</span>\n      <span>return</span> <span>atob</span><span>(</span>auth<span>.</span><span>split</span><span>(</span><span>' '</span><span>)</span><span>.</span><span>pop</span><span>(</span><span>)</span><span>)</span><span>.</span><span>split</span><span>(</span><span>':'</span><span>)</span><span>;</span>\n    <span>}</span> <span>catch</span> <span>(</span>e<span>)</span> <span>{</span>\n      <span>return</span> <span>[</span><span>]</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n \n<span>function</span> <span>doBasicAuth</span><span>(</span><span>request</span><span>)</span> <span>{</span>\n  <span>const</span> auth <span>=</span> request<span>.</span>headers<span>.</span><span>get</span><span>(</span><span>'Authorization'</span><span>)</span><span>;</span>\n \n  <span>if</span> <span>(</span><span>!</span>auth <span>||</span> <span>!</span><span><span>/</span><span>^Basic [A-Za-z0-9._~+/-]+=*$</span><span>/</span><span>i</span></span><span>.</span><span>test</span><span>(</span>auth<span>)</span><span>)</span> <span>{</span>\n    <span>return</span> <span>false</span><span>;</span>\n  <span>}</span>\n \n  <span>const</span> <span>[</span>user<span>,</span> pass<span>]</span> <span>=</span> <span>parseBasicAuth</span><span>(</span>auth<span>)</span><span>;</span>\n  <span>return</span> user <span>===</span> username <span>&amp;&amp;</span> pass <span>===</span> password<span>;</span>\n<span>}</span>\n \n \n<span>async</span> <span>function</span> <span>fetchAndApply</span><span>(</span><span>request</span><span>)</span> <span>{</span>\n  <span>if</span> <span>(</span>request<span>.</span>method <span>===</span> <span>'OPTIONS'</span><span>)</span> <span>// allow preflight request</span>\n    <span>return</span> <span>new</span> <span>Response</span><span>(</span><span>''</span><span>,</span> <span>{</span>\n      <span>status</span><span>:</span> <span>200</span><span>,</span>\n      <span>headers</span><span>:</span> <span>{</span>\n        <span>'Access-Control-Allow-Origin'</span><span>:</span> <span>'*'</span><span>,</span>\n        <span>'Access-Control-Allow-Headers'</span><span>:</span> <span>'*'</span><span>,</span>\n        <span>'Access-Control-Allow-Methods'</span><span>:</span> <span>'GET, POST, PUT, HEAD, OPTIONS'</span>\n      <span>}</span>\n    <span>}</span><span>)</span><span>;</span>\n \n  <span>if</span> <span>(</span>openAuth <span>&amp;&amp;</span> <span>!</span><span>doBasicAuth</span><span>(</span>request<span>)</span><span>)</span> <span>{</span>\n    <span>return</span> <span>unauthorized</span><span>(</span><span>)</span><span>;</span>\n  <span>}</span>\n    <span>const</span> region <span>=</span> request<span>.</span>headers<span>.</span><span>get</span><span>(</span><span>'cf-ipcountry'</span><span>)</span><span>.</span><span>toUpperCase</span><span>(</span><span>)</span><span>;</span>\n    <span>const</span> ip_address <span>=</span> request<span>.</span>headers<span>.</span><span>get</span><span>(</span><span>'cf-connecting-ip'</span><span>)</span><span>;</span>\n    <span>const</span> user_agent <span>=</span> request<span>.</span>headers<span>.</span><span>get</span><span>(</span><span>'user-agent'</span><span>)</span><span>;</span>\n \n    <span>let</span> response <span>=</span> <span>null</span><span>;</span>\n    <span>let</span> url <span>=</span> <span>new</span> <span>URL</span><span>(</span>request<span>.</span>url<span>)</span><span>;</span>\n    <span>let</span> url_host <span>=</span> url<span>.</span>host<span>;</span>\n \n    <span>if</span> <span>(</span>url<span>.</span>protocol <span>==</span> <span>'http:'</span><span>)</span> <span>{</span>\n        url<span>.</span>protocol <span>=</span> <span>'https:'</span>\n        response <span>=</span> Response<span>.</span><span>redirect</span><span>(</span>url<span>.</span>href<span>)</span><span>;</span>\n        <span>return</span> response<span>;</span>\n    <span>}</span>\n \n    <span>if</span> <span>(</span><span>await</span> <span>device_status</span><span>(</span>user_agent<span>)</span><span>)</span> <span>{</span>\n        upstream_domain <span>=</span> upstream\n    <span>}</span> <span>else</span> <span>{</span>\n        upstream_domain <span>=</span> upstream_mobile\n    <span>}</span>\n \n    url<span>.</span>host <span>=</span> upstream_domain<span>;</span>\n \n    <span>if</span> <span>(</span>blocked_region<span>.</span><span>includes</span><span>(</span>region<span>)</span><span>)</span> <span>{</span>\n        response <span>=</span> <span>new</span> <span>Response</span><span>(</span><span>'Access denied: WorkersProxy is not available in your region yet.'</span><span>,</span> <span>{</span>\n            <span>status</span><span>:</span> <span>403</span>\n        <span>}</span><span>)</span><span>;</span>\n    <span>}</span> <span>else</span> <span>if</span><span>(</span>blocked_ip_address<span>.</span><span>includes</span><span>(</span>ip_address<span>)</span><span>)</span><span>{</span>\n        response <span>=</span> <span>new</span> <span>Response</span><span>(</span><span>'Access denied: Your IP address is blocked by WorkersProxy.'</span><span>,</span> <span>{</span>\n            <span>status</span><span>:</span> <span>403</span>\n        <span>}</span><span>)</span><span>;</span>\n    <span>}</span> <span>else</span><span>{</span>\n        <span>let</span> method <span>=</span> request<span>.</span>method<span>;</span>\n        <span>let</span> request_headers <span>=</span> request<span>.</span>headers<span>;</span>\n        <span>let</span> new_request_headers <span>=</span> <span>new</span> <span>Headers</span><span>(</span>request_headers<span>)</span><span>;</span>\n \n        new_request_headers<span>.</span><span>set</span><span>(</span><span>'Host'</span><span>,</span> upstream_domain<span>)</span><span>;</span>\n        new_request_headers<span>.</span><span>set</span><span>(</span><span>'Referer'</span><span>,</span> url<span>.</span>href<span>)</span><span>;</span>\n \n        <span>let</span> original_response <span>=</span> <span>await</span> <span>fetch</span><span>(</span>url<span>.</span>href<span>,</span> <span>{</span>\n            <span>method</span><span>:</span> method<span>,</span>\n            <span>headers</span><span>:</span> new_request_headers\n        <span>}</span><span>)</span>\n \n        <span>let</span> original_response_clone <span>=</span> original_response<span>.</span><span>clone</span><span>(</span><span>)</span><span>;</span>\n        <span>let</span> original_text <span>=</span> <span>null</span><span>;</span>\n        <span>let</span> response_headers <span>=</span> original_response<span>.</span>headers<span>;</span>\n        <span>let</span> new_response_headers <span>=</span> <span>new</span> <span>Headers</span><span>(</span>response_headers<span>)</span><span>;</span>\n        <span>let</span> status <span>=</span> original_response<span>.</span>status<span>;</span>\n \n        new_response_headers<span>.</span><span>set</span><span>(</span><span>'access-control-allow-origin'</span><span>,</span> <span>'*'</span><span>)</span><span>;</span>\n        new_response_headers<span>.</span><span>set</span><span>(</span><span>'access-control-allow-credentials'</span><span>,</span> <span>true</span><span>)</span><span>;</span>\n        new_response_headers<span>.</span><span>delete</span><span>(</span><span>'content-security-policy'</span><span>)</span><span>;</span>\n        new_response_headers<span>.</span><span>delete</span><span>(</span><span>'content-security-policy-report-only'</span><span>)</span><span>;</span>\n        new_response_headers<span>.</span><span>delete</span><span>(</span><span>'clear-site-data'</span><span>)</span><span>;</span>\n \n        <span>const</span> content_type <span>=</span> new_response_headers<span>.</span><span>get</span><span>(</span><span>'content-type'</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span>content_type<span>.</span><span>includes</span><span>(</span><span>'text/html'</span><span>)</span> <span>&amp;&amp;</span> content_type<span>.</span><span>includes</span><span>(</span><span>'UTF-8'</span><span>)</span><span>)</span> <span>{</span>\n            original_text <span>=</span> <span>await</span> <span>replace_response_text</span><span>(</span>original_response_clone<span>,</span> upstream_domain<span>,</span> url_host<span>)</span><span>;</span>\n        <span>}</span> <span>else</span> <span>{</span>\n            original_text <span>=</span> original_response_clone<span>.</span>body\n        <span>}</span>\n \n        response <span>=</span> <span>new</span> <span>Response</span><span>(</span>original_text<span>,</span> <span>{</span>\n            status<span>,</span>\n            <span>headers</span><span>:</span> new_response_headers\n        <span>}</span><span>)</span>\n    <span>}</span>\n    <span>return</span> response<span>;</span>\n<span>}</span>\n \n<span>addEventListener</span><span>(</span><span>'fetch'</span><span>,</span> <span>event</span> <span>=></span> <span>{</span>\n    event<span>.</span><span>respondWith</span><span>(</span><span>fetchAndApply</span><span>(</span>event<span>.</span>request<span>)</span><span>.</span><span>catch</span><span>(</span><span>err</span> <span>=></span> <span>{</span>\n      console<span>.</span><span>error</span><span>(</span>err<span>)</span><span>;</span>\n      <span>new</span> <span>Response</span><span>(</span><span>JSON</span><span>.</span><span>stringify</span><span>(</span>err<span>.</span>stack<span>)</span><span>,</span> <span>{</span>\n        <span>status</span><span>:</span> <span>500</span><span>,</span>\n        <span>headers</span><span>:</span> <span>{</span>\n          <span>'Content-Type'</span><span>:</span> <span>'application/json'</span>\n        <span>}</span>\n      <span>}</span><span>)</span><span>;</span>\n    <span>}</span><span>)</span><span>)</span><span>;</span>\n<span>}</span><span>)</span>\n \n \n<span>async</span> <span>function</span> <span>replace_response_text</span><span>(</span><span>response<span>,</span> upstream_domain<span>,</span> host_name</span><span>)</span> <span>{</span>\n    <span>let</span> text <span>=</span> <span>await</span> response<span>.</span><span>text</span><span>(</span><span>)</span>\n \n    <span>var</span> i<span>,</span> j<span>;</span>\n    <span>for</span> <span>(</span>i <span>in</span> replace_dict<span>)</span> <span>{</span>\n        j <span>=</span> replace_dict<span>[</span>i<span>]</span>\n        <span>if</span> <span>(</span>i <span>==</span> <span>'$upstream'</span><span>)</span> <span>{</span>\n            i <span>=</span> upstream_domain\n        <span>}</span> <span>else</span> <span>if</span> <span>(</span>i <span>==</span> <span>'$custom_domain'</span><span>)</span> <span>{</span>\n            i <span>=</span> host_name\n        <span>}</span>\n \n        <span>if</span> <span>(</span>j <span>==</span> <span>'$upstream'</span><span>)</span> <span>{</span>\n            j <span>=</span> upstream_domain\n        <span>}</span> <span>else</span> <span>if</span> <span>(</span>j <span>==</span> <span>'$custom_domain'</span><span>)</span> <span>{</span>\n            j <span>=</span> host_name\n        <span>}</span>\n \n        <span>let</span> re <span>=</span> <span>new</span> <span>RegExp</span><span>(</span>i<span>,</span> <span>'g'</span><span>)</span>\n        text <span>=</span> text<span>.</span><span>replace</span><span>(</span>re<span>,</span> j<span>)</span><span>;</span>\n    <span>}</span>\n    <span>return</span> text<span>;</span>\n<span>}</span>\n \n<span>async</span> <span>function</span> <span>device_status</span> <span>(</span><span>user_agent_info</span><span>)</span> <span>{</span>\n    <span>var</span> agents <span>=</span> <span>[</span><span>\"Android\"</span><span>,</span> <span>\"iPhone\"</span><span>,</span> <span>\"SymbianOS\"</span><span>,</span> <span>\"Windows Phone\"</span><span>,</span> <span>\"iPad\"</span><span>,</span> <span>\"iPod\"</span><span>]</span><span>;</span>\n    <span>var</span> flag <span>=</span> <span>true</span><span>;</span>\n    <span>for</span> <span>(</span><span>var</span> v <span>=</span> <span>0</span><span>;</span> v <span>&lt;</span> agents<span>.</span>length<span>;</span> v<span>++</span><span>)</span> <span>{</span> <span>if</span> <span>(</span>user_agent_info<span>.</span><span>indexOf</span><span>(</span>agents<span>[</span>v<span>]</span><span>)</span> <span>></span> <span>0</span><span>)</span> <span>{</span>\n            flag <span>=</span> <span>false</span><span>;</span>\n            <span>break</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n    <span>return</span> flag<span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"镜像网站指定目录\" tabindex=\"-1\"> 镜像网站指定目录</h2>\n<div><pre><code><span>// 你要镜像的网站.</span>\n<span>const</span> upstream <span>=</span> <span>'objectstorage.ap-seoul-1.oraclecloud.com'</span>\n \n<span>// 镜像网站的目录，比如你想镜像某个网站的二级目录则填写二级目录的目录名，镜像 google 用不到，默认即可.</span>\n<span>const</span> upstream_path <span>=</span> <span>'/test/'</span>\n \n<span>// 镜像站是否有手机访问专用网址，没有则填一样的.</span>\n<span>const</span> upstream_mobile <span>=</span> <span>'objectstorage.ap-seoul-1.oraclecloud.com'</span>\n \n<span>// 屏蔽国家和地区.</span>\n<span>const</span> blocked_region <span>=</span> <span>[</span><span>''</span><span>]</span>\n \n<span>// 屏蔽 IP 地址.</span>\n<span>const</span> blocked_ip_address <span>=</span> <span>[</span><span>'0.0.0.0'</span><span>,</span> <span>'127.0.0.1'</span><span>]</span>\n \n<span>// 镜像站是否开启 HTTPS.</span>\n<span>const</span> https <span>=</span> <span>true</span>\n \n<span>// 文本替换.填你要镜像的网站</span>\n<span>const</span> replace_dict <span>=</span> <span>{</span>\n    <span>'$upstream'</span><span>:</span> <span>'$custom_domain'</span><span>,</span>\n    <span>'//objectstorage.ap-seoul-1.oraclecloud.com'</span><span>:</span> <span>''</span>\n<span>}</span>\n \n<span>// 以下保持默认，不要动</span>\n<span>addEventListener</span><span>(</span><span>'fetch'</span><span>,</span> <span>event</span> <span>=></span> <span>{</span>\n    event<span>.</span><span>respondWith</span><span>(</span><span>fetchAndApply</span><span>(</span>event<span>.</span>request<span>)</span><span>)</span><span>;</span>\n<span>}</span><span>)</span>\n \n<span>async</span> <span>function</span> <span>fetchAndApply</span><span>(</span><span>request</span><span>)</span> <span>{</span>\n \n    <span>const</span> region <span>=</span> request<span>.</span>headers<span>.</span><span>get</span><span>(</span><span>'cf-ipcountry'</span><span>)</span><span>.</span><span>toUpperCase</span><span>(</span><span>)</span><span>;</span>\n    <span>const</span> ip_address <span>=</span> request<span>.</span>headers<span>.</span><span>get</span><span>(</span><span>'cf-connecting-ip'</span><span>)</span><span>;</span>\n    <span>const</span> user_agent <span>=</span> <span>\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36\"</span>\n \n    <span>let</span> response <span>=</span> <span>null</span><span>;</span>\n    <span>let</span> url <span>=</span> <span>new</span> <span>URL</span><span>(</span>request<span>.</span>url<span>)</span><span>;</span>\n    <span>let</span> url_hostname <span>=</span> url<span>.</span>hostname<span>;</span>\n \n    <span>if</span> <span>(</span>https <span>==</span> <span>true</span><span>)</span> <span>{</span>\n        url<span>.</span>protocol <span>=</span> <span>'https:'</span><span>;</span>\n    <span>}</span> <span>else</span> <span>{</span>\n        url<span>.</span>protocol <span>=</span> <span>'http:'</span><span>;</span>\n    <span>}</span>\n \n    <span>if</span> <span>(</span><span>await</span> <span>device_status</span><span>(</span>user_agent<span>)</span><span>)</span> <span>{</span>\n        <span>var</span> upstream_domain <span>=</span> upstream<span>;</span>\n    <span>}</span> <span>else</span> <span>{</span>\n        <span>var</span> upstream_domain <span>=</span> upstream_mobile<span>;</span>\n    <span>}</span>\n \n    url<span>.</span>host <span>=</span> upstream_domain<span>;</span>\n    <span>if</span> <span>(</span>url<span>.</span>pathname <span>==</span> <span>'/'</span><span>)</span> <span>{</span>\n        url<span>.</span>pathname <span>=</span> upstream_path<span>;</span>\n    <span>}</span> <span>else</span> <span>{</span>\n        url<span>.</span>pathname <span>=</span> upstream_path <span>+</span> url<span>.</span>pathname<span>;</span>\n    <span>}</span>\n \n    <span>if</span> <span>(</span>blocked_region<span>.</span><span>includes</span><span>(</span>region<span>)</span><span>)</span> <span>{</span>\n        response <span>=</span> <span>new</span> <span>Response</span><span>(</span><span>'Access denied: WorkersProxy is not available in your region yet.'</span><span>,</span> <span>{</span>\n            <span>status</span><span>:</span> <span>403</span>\n        <span>}</span><span>)</span><span>;</span>\n    <span>}</span> <span>else</span> <span>if</span> <span>(</span>blocked_ip_address<span>.</span><span>includes</span><span>(</span>ip_address<span>)</span><span>)</span> <span>{</span>\n        response <span>=</span> <span>new</span> <span>Response</span><span>(</span><span>'Access denied: Your IP address is blocked by WorkersProxy.'</span><span>,</span> <span>{</span>\n            <span>status</span><span>:</span> <span>403</span>\n        <span>}</span><span>)</span><span>;</span>\n    <span>}</span> <span>else</span> <span>{</span>\n        <span>let</span> method <span>=</span> request<span>.</span>method<span>;</span>\n        <span>let</span> request_headers <span>=</span> request<span>.</span>headers<span>;</span>\n        <span>let</span> new_request_headers <span>=</span> <span>new</span> <span>Headers</span><span>(</span>request_headers<span>)</span><span>;</span>\n \n        new_request_headers<span>.</span><span>set</span><span>(</span><span>'Host'</span><span>,</span> url<span>.</span>hostname<span>)</span><span>;</span>\n        new_request_headers<span>.</span><span>set</span><span>(</span><span>'Referer'</span><span>,</span> url<span>.</span>hostname<span>)</span><span>;</span>\n \n        <span>let</span> original_response <span>=</span> <span>await</span> <span>fetch</span><span>(</span>url<span>.</span>href<span>,</span> <span>{</span>\n            <span>method</span><span>:</span> method<span>,</span>\n            <span>headers</span><span>:</span> new_request_headers\n        <span>}</span><span>)</span>\n \n        <span>let</span> original_response_clone <span>=</span> original_response<span>.</span><span>clone</span><span>(</span><span>)</span><span>;</span>\n        <span>let</span> original_text <span>=</span> <span>null</span><span>;</span>\n        <span>let</span> response_headers <span>=</span> original_response<span>.</span>headers<span>;</span>\n        <span>let</span> new_response_headers <span>=</span> <span>new</span> <span>Headers</span><span>(</span>response_headers<span>)</span><span>;</span>\n        <span>let</span> status <span>=</span> original_response<span>.</span>status<span>;</span>\n \n        new_response_headers<span>.</span><span>set</span><span>(</span><span>'access-control-allow-origin'</span><span>,</span> <span>'*'</span><span>)</span><span>;</span>\n        new_response_headers<span>.</span><span>set</span><span>(</span><span>'access-control-allow-credentials'</span><span>,</span> <span>true</span><span>)</span><span>;</span>\n        new_response_headers<span>.</span><span>delete</span><span>(</span><span>'content-security-policy'</span><span>)</span><span>;</span>\n        new_response_headers<span>.</span><span>delete</span><span>(</span><span>'content-security-policy-report-only'</span><span>)</span><span>;</span>\n        new_response_headers<span>.</span><span>delete</span><span>(</span><span>'clear-site-data'</span><span>)</span><span>;</span>\n \n        <span>const</span> content_type <span>=</span> new_response_headers<span>.</span><span>get</span><span>(</span><span>'content-type'</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span>content_type<span>.</span><span>includes</span><span>(</span><span>'text/html'</span><span>)</span> <span>&amp;&amp;</span> content_type<span>.</span><span>includes</span><span>(</span><span>'UTF-8'</span><span>)</span><span>)</span> <span>{</span>\n            original_text <span>=</span> <span>await</span> <span>replace_response_text</span><span>(</span>original_response_clone<span>,</span> upstream_domain<span>,</span> url_hostname<span>)</span><span>;</span>\n        <span>}</span> <span>else</span> <span>{</span>\n            original_text <span>=</span> original_response_clone<span>.</span>body\n        <span>}</span>\n \n        response <span>=</span> <span>new</span> <span>Response</span><span>(</span>original_text<span>,</span> <span>{</span>\n            status<span>,</span>\n            <span>headers</span><span>:</span> new_response_headers\n        <span>}</span><span>)</span>\n    <span>}</span>\n    <span>return</span> response<span>;</span>\n<span>}</span>\n \n<span>async</span> <span>function</span> <span>replace_response_text</span><span>(</span><span>response<span>,</span> upstream_domain<span>,</span> host_name</span><span>)</span> <span>{</span>\n    <span>let</span> text <span>=</span> <span>await</span> response<span>.</span><span>text</span><span>(</span><span>)</span>\n \n    <span>var</span> i<span>,</span> j<span>;</span>\n    <span>for</span> <span>(</span>i <span>in</span> replace_dict<span>)</span> <span>{</span>\n        j <span>=</span> replace_dict<span>[</span>i<span>]</span>\n        <span>if</span> <span>(</span>i <span>==</span> <span>'$upstream'</span><span>)</span> <span>{</span>\n            i <span>=</span> upstream_domain\n        <span>}</span> <span>else</span> <span>if</span> <span>(</span>i <span>==</span> <span>'$custom_domain'</span><span>)</span> <span>{</span>\n            i <span>=</span> host_name\n        <span>}</span>\n \n        <span>if</span> <span>(</span>j <span>==</span> <span>'$upstream'</span><span>)</span> <span>{</span>\n            j <span>=</span> upstream_domain\n        <span>}</span> <span>else</span> <span>if</span> <span>(</span>j <span>==</span> <span>'$custom_domain'</span><span>)</span> <span>{</span>\n            j <span>=</span> host_name\n        <span>}</span>\n \n        <span>let</span> re <span>=</span> <span>new</span> <span>RegExp</span><span>(</span>i<span>,</span> <span>'g'</span><span>)</span>\n        text <span>=</span> text<span>.</span><span>replace</span><span>(</span>re<span>,</span> j<span>)</span><span>;</span>\n    <span>}</span>\n    <span>return</span> text<span>;</span>\n<span>}</span>\n \n \n<span>async</span> <span>function</span> <span>device_status</span><span>(</span><span>user_agent_info</span><span>)</span> <span>{</span>\n    <span>var</span> agents <span>=</span> <span>[</span><span>\"Android\"</span><span>,</span> <span>\"iPhone\"</span><span>,</span> <span>\"SymbianOS\"</span><span>,</span> <span>\"Windows Phone\"</span><span>,</span> <span>\"iPad\"</span><span>,</span> <span>\"iPod\"</span><span>]</span><span>;</span>\n    <span>var</span> flag <span>=</span> <span>true</span><span>;</span>\n    <span>for</span> <span>(</span><span>var</span> v <span>=</span> <span>0</span><span>;</span> v <span>&lt;</span> agents<span>.</span>length<span>;</span> v<span>++</span><span>)</span> <span>{</span>\n        <span>if</span> <span>(</span>user_agent_info<span>.</span><span>indexOf</span><span>(</span>agents<span>[</span>v<span>]</span><span>)</span> <span>></span> <span>0</span><span>)</span> <span>{</span>\n            flag <span>=</span> <span>false</span><span>;</span>\n            <span>break</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n    <span>return</span> flag<span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"注意\" tabindex=\"-1\"> 注意：</h2>\n<p>如果出现：</p>\n<p>“需要网站所有者处理的错误:网站密钥的网域无效”</p>\n<p>Google reCAPTCHA V3.0无效. “网站所有者的错误：密钥类型无效”</p>\n<h3 id=\"解决方法\" tabindex=\"-1\"> 解决方法：</h3>\n<p>在代码中修改<code>new_request_headers.set('Referer'.......</code>，为对应的反代网站</p>\n<div><pre><code>new_request_headers<span>.</span><span>set</span><span>(</span><span>'Referer'</span><span>,</span> <span>'https://github.com'</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div>",
      "date_published": "2022-06-09T00:00:00.000Z",
      "date_modified": "2022-05-27T11:24:46.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Script"
      ]
    },
    {
      "title": "谷歌Gmail注册显示此号码不能验证的解决办法",
      "url": "https://blog.ciberviler.top/other/%E8%B0%B7%E6%AD%8CGmail%E6%B3%A8%E5%86%8C%E6%98%BE%E7%A4%BA%E6%AD%A4%E5%8F%B7%E7%A0%81%E4%B8%8D%E8%83%BD%E9%AA%8C%E8%AF%81%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95.html",
      "id": "https://blog.ciberviler.top/other/%E8%B0%B7%E6%AD%8CGmail%E6%B3%A8%E5%86%8C%E6%98%BE%E7%A4%BA%E6%AD%A4%E5%8F%B7%E7%A0%81%E4%B8%8D%E8%83%BD%E9%AA%8C%E8%AF%81%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95.html",
      "content_html": "<h1 id=\"谷歌gmail注册显示此号码不能验证的解决办法\" tabindex=\"-1\"> 谷歌Gmail注册显示此号码不能验证的解决办法</h1>\n<p>谷歌账号注册中国手机号不能验证，很多同学在注册谷歌账号时经常会遇到这个问题，一直卡在电话号码验证上，是国内手机号不能通过谷歌的验证吗？</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-165365038994811.png\" alt=\"img\"></p>\n<p>基本都不是号码本身引起的，换新号码往往也没用，这里介绍几个靠谱的Gmail邮箱注册教程：</p>\n<p>网上很多方法不能注册成功，说明目前使用的网络IP质量不行，需要找一个纯净的IP。</p>\n<p>什么是纯净的IP？简单的讲就是这个IP用的人越少越好。</p>\n<p>谷歌能否申请成功最关键的不是用哪个国家的手机号，而是需要一个纯净的IP，申请之前我们首先需要确认谷歌注册手机号无法进行验证两种状态。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536503899481.png\" alt=\"img\"></p>\n<p><strong>状态①：</strong>“无法用于验证”说明手机号之前没有注册过谷歌这种比较好解决只需要按照下面的方法操作即可</p>\n<p><strong>状态②：</strong>“多次用于验证”说明手机号之前注册过谷歌或者尝试很多次,需要冷却。注册过等一个月/没有注册过等三天左右，这个状态不要再进行尝试，注册不了。</p>\n<p><strong>目前网上绝大部分解决谷歌注册手机号无法进行验证显示“此电话号码无法用于进行验证”的教程都是以下两种:</strong></p>\n<p>**方法一：**通过QQ邮箱APP注册。这种方法很简单在这里就不做过多介绍,但是不是很建议通过这种渠道注册。</p>\n<p>具体原因是:由于国内网络限制,不借助上网工具是不能访问google的,那为什么通过QQ邮箱能够访问,是因为APP自带的联网工具,但是每天通过这个APP的单个IP去注册的用户可以说是成千上万,势必多账户关联引起谷歌的特殊关照,我们接到反馈很多小伙伴注册成功几个小时就报异常了。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536503899482.jpeg\" alt=\"img\"></p>\n<p>**方法二：**切换chrome浏览器的语言完成注册。这种方法还是有小伙伴注册不成功，经过本人实战前后加起来注册了20000+个谷歌号总结出的经验，谷歌号能否注册成功最关键不是使用什么语言，也不是使用哪个国家的手机号决定的，而是需要的是一个纯净的网络IP。</p>\n<p>下面就给大家分享一下这种方法容易被忽略的步骤。①首先需要做的是清楚浏览器的历史记录</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536503899483.jpeg\" alt=\"img\"></p>\n<p>【重点】这里很关键容易被忽略，这里需要选择高级保证浏览器的所有缓存全部被清理干净，清理后关闭浏览器器</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536503899494.jpeg\" alt=\"img\"></p>\n<p>②【重点】首先链接到一个使用人数较少的代理网络，在开始注册谷歌账号之前先使用IP查询工具，查询你现在所接入网络的所在国家。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536503899495.jpeg\" alt=\"img\"></p>\n<p>③点击chrome浏览器右上角的菜单按钮→选择“设置”→高级→语言→添加日语并置顶同时移除其他语言</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536503899496.jpeg\" alt=\"img\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536503899497.jpeg\" alt=\"img\"></p>\n<p>【重点】如果通过查询你的IP是其他国家，就添加相应国家的语言即可。我这里的IP是日本，所以我就把浏览器设置成日语，网上的教程都是直接叫设置成英语。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536503899498.jpeg\" alt=\"img\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536503899499.jpeg\" alt=\"img\"></p>\n<p>④【重点】完成这个步骤以后再次清除浏览缓存，并关闭浏览器， ⑤再次打开chrome浏览器进入谷歌主页点击右上角蓝色注册按钮，依次操作即可。即可注册成功。</p>\n<p>注册几分钟就成功了。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-165365038994910.jpeg\" alt=\"img\"></p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-165365038994811.png",
      "date_published": "2022-06-06T00:00:00.000Z",
      "date_modified": "2022-05-27T11:24:40.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "新版QQ修改彩色颜色字体代码教程",
      "url": "https://blog.ciberviler.top/other/%E6%96%B0%E7%89%88QQ%E4%BF%AE%E6%94%B9%E5%BD%A9%E8%89%B2%E9%A2%9C%E8%89%B2%E5%AD%97%E4%BD%93%E4%BB%A3%E7%A0%81%E6%95%99%E7%A8%8B.html",
      "id": "https://blog.ciberviler.top/other/%E6%96%B0%E7%89%88QQ%E4%BF%AE%E6%94%B9%E5%BD%A9%E8%89%B2%E9%A2%9C%E8%89%B2%E5%AD%97%E4%BD%93%E4%BB%A3%E7%A0%81%E6%95%99%E7%A8%8B.html",
      "summary": "Other",
      "content_html": "<h1 id=\"新版qq修改彩色颜色字体代码教程\" tabindex=\"-1\"> 新版QQ修改彩色颜色字体代码教程</h1>\n<p>QQ群彩色昵称，</p>\n<p>玩过的都知道，以前是可以直接设置的，但新版QQ群昵称好像不太行！效果自测！</p>\n<p>这里我就分享 <strong>两类</strong> 颜色代码吧，用的话把后面的颜色替换成自己的昵称就行了其实找一个旧版QQ，复制好改完的昵称就会在剪切板显示颜色代码</p>\n<p>q群改群昵称颜色代码合集（ <strong>需要SVIP</strong> ） 不喜勿喷，不喜勿喷，不喜勿喷！</p>\n<h2 id=\"文字教程\" tabindex=\"-1\"> 文字教程：</h2>\n<p>复制你需要的颜色到群昵称输入框内，然后删除文字(是删文字 不要删到代码)再打上你自己需要设置的群昵称即可！</p>\n<p>记住名称放前面代码放后面，别搞错了，搞错了就提示有非法字符！就设置不成功咯！</p>\n<h2 id=\"详细教程如下\" tabindex=\"-1\"> 详细教程如下:</h2>\n<p>随便找一个群，找到编辑群昵称 选择自己想修改的颜色，这里我举例红色，红色代码是&lt;&amp;ÿÿ5@&gt;红色，我们把红色二个文字删掉，直接把&lt;&amp;ÿÿ5@&gt;复制粘贴到群昵称编辑里面，点击确定，我们来看看效果如何滑稽</p>\n<h2 id=\"纯色昵称代码\" tabindex=\"-1\"> 纯色昵称代码：</h2>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536501289982.jpeg\" alt=\"img\"></p>\n<div><pre><code>&lt;&amp;ÿĀĀĀ>黑色\n\n&lt;&amp;ÿÿ5@>红色\n\n&lt;&amp;ÿÿ]>粉色\n\n&lt;&amp;ÿÒUÐ>紫色\n\n&lt;&amp;ÿÇý>蓝色\n\n&lt;&amp;ÿÄW>绿色\n  \n&lt;&amp;ÿÿÏP>黄色\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h3 id=\"彩色昵称代码\" tabindex=\"-1\"> 彩色昵称代码</h3>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536501289981.jpeg\" alt=\"img\"></p>\n<p>代码如下</p>\n<div><pre><code>&lt;&amp;ÿĀĀĀ>黑色\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code>&lt;&amp;ÿÿ5@>红色\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code>&lt;&amp;ÿÿ]>粉色\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code>&lt;&amp;ÿÒUÐ>紫色\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code>&lt;&amp;ÿÇý>蓝色\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code>&lt;&amp;ÿÄW>绿色\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code>&lt;&amp;ÿÿÏP>黄色\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code>&lt;%ĀĀÐ>初春\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code>&lt;%ĀĀÑ>冬梅\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code><span>&lt;</span><span>%</span>ĀĀÒ<span>></span>高级灰\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code><span>&lt;</span><span>%</span>ĀĀÓ<span>></span>黄昏\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code><span>&lt;</span><span>%</span>ĀĀÔ<span>></span>科技感\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code><span>&lt;</span><span>%</span>ĀĀÕ<span>></span>马卡龙\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code><span>&lt;</span><span>%</span>ĀĀÖ<span>></span>霓虹闪烁\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code><span>&lt;</span><span>%</span>ĀĀ×<span>></span>日出\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code><span>&lt;</span><span>%</span>ĀĀØ<span>></span>盛夏\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code><span>&lt;</span><span>%</span>ĀĀÙ<span>></span>糖果冰纷\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code><span>&lt;</span><span>%</span>ĀĀÚ<span>></span>晚秋\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code><span>&lt;</span><span>%</span>ĀĀÛ<span>></span>夜空\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code><span>&lt;</span><span>%</span>ĀĀÜ<span>></span>粉黛\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code><span>&lt;</span><span>%</span>ĀĀÝ<span>></span>朝夕\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><div><pre><code><span>&lt;</span><span>%</span>ĀĀÞ<span>></span>潮流\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><h2 id=\"效果展示\" tabindex=\"-1\"> 效果展示</h2>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536501289982.png\" alt=\"img\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536501289983.jpeg\" alt=\"img\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536501289984.jpeg\" alt=\"img\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536501289985.jpeg\" alt=\"img\"></p>\n<p>效果图来源于网络，若无意侵权，联系删除即可！</p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536501289982.jpeg",
      "date_published": "2022-06-04T00:00:00.000Z",
      "date_modified": "2022-05-27T11:24:33.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "QQ动态群聊昵称代码",
      "url": "https://blog.ciberviler.top/other/QQ%E5%8A%A8%E6%80%81%E7%BE%A4%E8%81%8A%E6%98%B5%E7%A7%B0%E4%BB%A3%E7%A0%81.html",
      "id": "https://blog.ciberviler.top/other/QQ%E5%8A%A8%E6%80%81%E7%BE%A4%E8%81%8A%E6%98%B5%E7%A7%B0%E4%BB%A3%E7%A0%81.html",
      "content_html": "<h1 id=\"qq动态群聊昵称代码\" tabindex=\"-1\"> QQ动态群聊昵称代码</h1>\n<h2 id=\"代码\" tabindex=\"-1\"> 代码</h2>\n<ul>\n<li>会变色钻石 <code>&lt;$ǿĀD&gt;钻石&lt;$ǿĀD&gt;</code> 效果图：</li>\n</ul>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536500405884.png\" alt=\"img\"></p>\n<p>钻石</p>\n<ul>\n<li>手掌比心 <code>&lt;$ÿĀ&quot;&gt;比心&lt;$ÿĀ&quot;&gt;</code> 效果图：</li>\n</ul>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536500405881.png\" alt=\"img\"></p>\n<p>比心</p>\n<ul>\n<li>滑稽 <code>&lt;$²&gt;滑稽&lt;$²&gt;</code> 效果图：</li>\n</ul>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536500405882.png\" alt=\"img\"></p>\n<p>滑稽</p>\n<ul>\n<li>可爱的手掌 <code>&lt;$ÿĀ&gt;小手&lt;$ÿĀ&gt;</code> 效果图：</li>\n</ul>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536500405883.png\" alt=\"img\"></p>\n<p>会动的小手</p>\n<h2 id=\"注意\" tabindex=\"-1\"> 注意</h2>\n<p>用代码改完群聊名称后不会立即显示，可以重新进去一次群资料即可刷新出来。</p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/1620-16536500405884.png",
      "date_published": "2022-06-02T00:00:00.000Z",
      "date_modified": "2022-05-27T11:24:25.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "other"
      ]
    },
    {
      "title": "服务器入侵排查",
      "url": "https://blog.ciberviler.top/linux/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%85%A5%E4%BE%B5%E6%8E%92%E6%9F%A5.html",
      "id": "https://blog.ciberviler.top/linux/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%85%A5%E4%BE%B5%E6%8E%92%E6%9F%A5.html",
      "content_html": "<h1 id=\"服务器入侵排查\" tabindex=\"-1\"> 服务器入侵排查</h1>\n<h3 id=\"_1-入侵者可能会删除机器的日志信息\" tabindex=\"-1\"> 1.<strong>入侵者可能会删除机器的日志信息</strong></h3>\n<p>可以查看日志信息是否还存在或者是否被清空，相关命令示例：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165357407084712.png\" alt=\"图片\"></p>\n<h3 id=\"_2-入侵者可能创建一个新的存放用户名及密码文件\" tabindex=\"-1\"> 2.<strong>入侵者可能创建一个新的存放用户名及密码文件</strong></h3>\n<p>可以查看/etc/passwd及/etc/shadow文件，相关命令示例：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535740708461.png\" alt=\"图片\"></p>\n<h3 id=\"_3-入侵者可能修改用户名及密码文件\" tabindex=\"-1\"> 3.<strong>入侵者可能修改用户名及密码文件</strong></h3>\n<p>可以查看/etc/passwd及/etc/shadow文件内容进行鉴别，相关命令示例：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535740708462.png\" alt=\"图片\"></p>\n<h3 id=\"_4-查看机器最近成功登陆的事件和最后一次不成功的登陆事\" tabindex=\"-1\"> 4.<strong>查看机器最近成功登陆的事件和最后一次不成功的登陆事</strong></h3>\n<p>对应日志“/var/log/lastlog”，相关命令示例：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535740708473.png\" alt=\"图片\"></p>\n<h3 id=\"_5-查看机器当前登录的全部用户\" tabindex=\"-1\"> 5.<strong>查看机器当前登录的全部用户</strong></h3>\n<p>对应日志文件“/var/run/utmp”，相关命令示例：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535740708474.png\" alt=\"图片\"></p>\n<h3 id=\"_6-查看机-器创建以来登陆过的用户\" tabindex=\"-1\"> 6.*<em>查看机***<em>器创建以来登陆过的用户</em></em></h3>\n<p>对应日志文件“/var/log/wtmp”，相关命令示例：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535740708475.png\" alt=\"图片\"></p>\n<h3 id=\"_7-查看机器所有用户的连接时间-小时\" tabindex=\"-1\"> 7.<strong>查看机器所有用户的连接时间（小时）</strong></h3>\n<p>对应日志文件“/var/log/wtmp”，相关命令示例：<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535740708476.png\" alt=\"图片\"></p>\n<h3 id=\"_8-如果发现机器产生了异常流量\" tabindex=\"-1\"> 8.<strong>如果发现机器产生了异常流量</strong></h3>\n<p>可以使用命令“tcpdump”抓取网络包查看流量情况或者使用工具”iperf”查看流量情况</p>\n<h3 id=\"_9-可以查看-var-log-secure日志文件\" tabindex=\"-1\"> 9.<strong>可以查看/var/log/secure日志文件</strong></h3>\n<p>尝试发现入侵者的信息，相关命令示例：<img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535740708477.png\" alt=\"图片\"></p>\n<h3 id=\"_10-查询异常进程所对应的执行脚本文件\" tabindex=\"-1\"> 10.查询异常进程所对应的执行脚本文件</h3>\n<p>a.top命令查看异常进程对应的PID</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535740708478.jpeg\" alt=\"图片\"></p>\n<p>b.在虚拟文件系统目录查找该进程的可执行文件</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535740708479.png\" alt=\"图片\"></p>\n<h3 id=\"_11-如果确认机器已被入侵-重要文件已被删除-可以尝试找回被删除的文件note\" tabindex=\"-1\"> 11.如果确认机器已被入侵，重要文件已被删除，可以尝试找回被删除的文件Note:</h3>\n<p>1、当进程打开了某个文件时，只要该进程保持打开该文件，即使将其删除，它依然存在于磁盘中。这意味着，进程并不知道文件已经被删除，它仍然可以向打开该文件时提供给它的文件描述符进行读取和写入。除了该进程之外，这个文件是不可见的，因为已经删除了其相应的目录索引节点。</p>\n<p>2、在/proc 目录下，其中包含了反映内核和进程树的各种文件。/proc目录挂载的是在内存中所映射的一块区域，所以这些文件和目录并不存在于磁盘中，因此当我们对这些文件进行读取和写入时，实际上是在从内存中获取相关信息。大多数与 lsof 相关的信息都存储于以进程的 PID 命名的目录中，即 /proc/1234 中包含的是 PID 为 1234 的进程的信息。每个进程目录中存在着各种文件，它们可以使得应用程序简单地了解进程的内存空间、文件描述符列表、指向磁盘上的文件的符号链接和其他系统信息。lsof 程序使用该信息和其他关于内核内部状态的信息来产生其输出。所以lsof 可以显示进程的文件描述符和相关的文件名等信息。也就是我们通过访问进程的文件描述符可以找到该文件的相关信息。</p>\n<p>3、当系统中的某个文件被意外地删除了，只要这个时候系统中还有进程正在访问该文件，那么我们就可以通过lsof从/proc目录下恢复该文件的内容。</p>\n<p>假设入侵者将/var/log/secure文件删除掉了，尝试将/var/log/secure文件恢复的方法可以参考如下：</p>\n<p>a.查看/var/log/secure文件，发现已经没有该文件</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165357407084710.png\" alt=\"图片\"></p>\n<p>b.使用lsof命令查看当前是否有进程打开/var/log/secure，</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165357407084711.png\" alt=\"图片\"></p>\n<p>c.从上面的信息可以看到 PID 1264（rsyslogd）打开文件的文件描述符为4。同时还可以看到/var/log/ secure已经标记为被删除了。因此我们可以在/proc/1264/fd/4（fd下的每个以数字命名的文件表示进程对应的文件描述符）中查看相应的信息，如下：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165357407084812.jpeg\" alt=\"图片\"></p>\n<p>d.从上面的信息可以看出，查看/proc/1264/fd/4就可以得到所要恢复的数据。如果可以通过文件描述符查看相应的数据，那么就可以使用I/O重定向将其重定向到文件中，如:</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165357407084813.png\" alt=\"图片\"></p>\n<p>e.再次查看/var/log/secure，发现该文件已经存在。对于许多应用程序，尤其是日志文件和数据库，这种恢复删除文件的方法非常有用。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165357407084814.jpeg\" alt=\"图片\"></p>\n<p><strong>版权申明：内容来源网络，版权归原创者所有。除非无法确认，都会标明作者及出处，如有侵权，烦请告知，我们会立即删除!</strong></p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-165357407084712.png",
      "date_published": "2022-06-07T00:00:00.000Z",
      "date_modified": "2022-05-27T07:56:31.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Linux"
      ]
    },
    {
      "title": "搞定 SpringBoot 接口恶意刷新和暴力请求",
      "url": "https://blog.ciberviler.top/dev/%E6%90%9E%E5%AE%9ASpringBoot%E6%8E%A5%E5%8F%A3%E6%81%B6%E6%84%8F%E5%88%B7%E6%96%B0%E5%92%8C%E6%9A%B4%E5%8A%9B%E8%AF%B7%E6%B1%82.html",
      "id": "https://blog.ciberviler.top/dev/%E6%90%9E%E5%AE%9ASpringBoot%E6%8E%A5%E5%8F%A3%E6%81%B6%E6%84%8F%E5%88%B7%E6%96%B0%E5%92%8C%E6%9A%B4%E5%8A%9B%E8%AF%B7%E6%B1%82.html",
      "content_html": "<h1 id=\"搞定-springboot-接口恶意刷新和暴力请求\" tabindex=\"-1\"> 搞定 SpringBoot 接口恶意刷新和暴力请求</h1>\n<p>在实际项目使用中，必须要考虑服务的安全性，当服务部署到互联网以后，就要考虑服务被恶意请求和暴力攻击的情况，下面的教程，通过<code>intercept</code>和<code>redis</code>针对<code>url+ip</code>在一定时间内访问的次数来将ip禁用，可以根据自己的需求进行相应的修改，来打打自己的目的；</p>\n<p>首先工程为springboot框架搭建，不再详细叙述。</p>\n<p>首先创建一个自定义的拦截器类，也是最核心的代码：</p>\n<div><pre><code><span>/**\n * <span>@package</span>: com.technicalinterest.group.interceptor\n * <span>@className</span>: IpUrlLimitInterceptor\n * <span>@description</span>: ip+url重复请求现在拦截器\n * <span>@author</span>: Shuyu.Wang\n * <span>@since</span>: 0.1\n **/</span>\n<span>@Slf4j</span>\n<span>public</span> <span>class</span> <span>IpUrlLimitInterceptor</span> <span>implements</span> <span>HandlerInterceptor</span> <span>{</span>\n \n \n <span>private</span> <span>RedisUtil</span> <span>getRedisUtil</span><span>(</span><span>)</span> <span>{</span>\n  <span>return</span>  <span>SpringContextUtil</span><span>.</span><span>getBean</span><span>(</span><span>RedisUtil</span><span>.</span><span>class</span><span>)</span><span>;</span>\n <span>}</span>\n \n <span>private</span> <span>static</span> <span>final</span> <span>String</span> LOCK_IP_URL_KEY<span>=</span><span>\"lock_ip_\"</span><span>;</span>\n \n <span>private</span> <span>static</span> <span>final</span> <span>String</span> IP_URL_REQ_TIME<span>=</span><span>\"ip_url_times_\"</span><span>;</span>\n \n <span>private</span> <span>static</span> <span>final</span> <span>long</span> LIMIT_TIMES<span>=</span><span>5</span><span>;</span>\n \n <span>private</span> <span>static</span> <span>final</span> <span>int</span> IP_LOCK_TIME<span>=</span><span>60</span><span>;</span>\n \n <span>@Override</span>\n <span>public</span> <span>boolean</span> <span>preHandle</span><span>(</span><span>HttpServletRequest</span> httpServletRequest<span>,</span> <span>HttpServletResponse</span> httpServletResponse<span>,</span> <span>Object</span> o<span>)</span> <span>throws</span> <span>Exception</span> <span>{</span>\n  log<span>.</span><span>info</span><span>(</span><span>\"request请求地址uri={},ip={}\"</span><span>,</span> httpServletRequest<span>.</span><span>getRequestURI</span><span>(</span><span>)</span><span>,</span> <span>IpAdrressUtil</span><span>.</span><span>getIpAdrress</span><span>(</span>httpServletRequest<span>)</span><span>)</span><span>;</span>\n  <span>if</span> <span>(</span><span>ipIsLock</span><span>(</span><span>IpAdrressUtil</span><span>.</span><span>getIpAdrress</span><span>(</span>httpServletRequest<span>)</span><span>)</span><span>)</span><span>{</span>\n   log<span>.</span><span>info</span><span>(</span><span>\"ip访问被禁止={}\"</span><span>,</span><span>IpAdrressUtil</span><span>.</span><span>getIpAdrress</span><span>(</span>httpServletRequest<span>)</span><span>)</span><span>;</span>\n   <span>ApiResult</span> result <span>=</span> <span>new</span> <span>ApiResult</span><span>(</span><span>ResultEnum</span><span>.</span>LOCK_IP<span>)</span><span>;</span>\n   <span>returnJson</span><span>(</span>httpServletResponse<span>,</span> JSON<span>.</span><span>toJSONString</span><span>(</span>result<span>)</span><span>)</span><span>;</span>\n   <span>return</span> <span>false</span><span>;</span>\n  <span>}</span>\n  <span>if</span><span>(</span><span>!</span><span>addRequestTime</span><span>(</span><span>IpAdrressUtil</span><span>.</span><span>getIpAdrress</span><span>(</span>httpServletRequest<span>)</span><span>,</span>httpServletRequest<span>.</span><span>getRequestURI</span><span>(</span><span>)</span><span>)</span><span>)</span><span>{</span>\n   <span>ApiResult</span> result <span>=</span> <span>new</span> <span>ApiResult</span><span>(</span><span>ResultEnum</span><span>.</span>LOCK_IP<span>)</span><span>;</span>\n   <span>returnJson</span><span>(</span>httpServletResponse<span>,</span> JSON<span>.</span><span>toJSONString</span><span>(</span>result<span>)</span><span>)</span><span>;</span>\n   <span>return</span> <span>false</span><span>;</span>\n  <span>}</span>\n  <span>return</span> <span>true</span><span>;</span>\n <span>}</span>\n \n <span>@Override</span>\n <span>public</span> <span>void</span> <span>postHandle</span><span>(</span><span>HttpServletRequest</span> httpServletRequest<span>,</span> <span>HttpServletResponse</span> httpServletResponse<span>,</span> <span>Object</span> o<span>,</span> <span>ModelAndView</span> modelAndView<span>)</span> <span>throws</span> <span>Exception</span> <span>{</span>\n \n <span>}</span>\n \n <span>@Override</span>\n <span>public</span> <span>void</span> <span>afterCompletion</span><span>(</span><span>HttpServletRequest</span> httpServletRequest<span>,</span> <span>HttpServletResponse</span> httpServletResponse<span>,</span> <span>Object</span> o<span>,</span> <span>Exception</span> e<span>)</span> <span>throws</span> <span>Exception</span> <span>{</span>\n \n <span>}</span>\n \n <span>/**\n  * @Description: 判断ip是否被禁用\n  * <span>@author</span>: shuyu.wang\n  * <span>@date</span>: 2019-10-12 13:08\n  * <span>@param</span> <span>ip</span>\n  * <span>@return</span> java.lang.Boolean\n  */</span>\n <span>private</span> <span>Boolean</span> <span>ipIsLock</span><span>(</span><span>String</span> ip<span>)</span><span>{</span>\n  <span>RedisUtil</span> redisUtil<span>=</span><span>getRedisUtil</span><span>(</span><span>)</span><span>;</span>\n  <span>if</span><span>(</span>redisUtil<span>.</span><span>hasKey</span><span>(</span>LOCK_IP_URL_KEY<span>+</span>ip<span>)</span><span>)</span><span>{</span>\n   <span>return</span> <span>true</span><span>;</span>\n  <span>}</span>\n  <span>return</span> <span>false</span><span>;</span>\n <span>}</span>\n <span>/**\n  * @Description: 记录请求次数\n  * <span>@author</span>: shuyu.wang\n  * <span>@date</span>: 2019-10-12 17:18\n  * <span>@param</span> <span>ip</span>\n  * <span>@param</span> <span>uri</span>\n  * <span>@return</span> java.lang.Boolean\n  */</span>\n <span>private</span> <span>Boolean</span> <span>addRequestTime</span><span>(</span><span>String</span> ip<span>,</span><span>String</span> uri<span>)</span><span>{</span>\n  <span>String</span> key<span>=</span>IP_URL_REQ_TIME<span>+</span>ip<span>+</span>uri<span>;</span>\n  <span>RedisUtil</span> redisUtil<span>=</span><span>getRedisUtil</span><span>(</span><span>)</span><span>;</span>\n  <span>if</span> <span>(</span>redisUtil<span>.</span><span>hasKey</span><span>(</span>key<span>)</span><span>)</span><span>{</span>\n   <span>long</span> time<span>=</span>redisUtil<span>.</span><span>incr</span><span>(</span>key<span>,</span><span>(</span><span>long</span><span>)</span><span>1</span><span>)</span><span>;</span>\n   <span>if</span> <span>(</span>time<span>>=</span>LIMIT_TIMES<span>)</span><span>{</span>\n    redisUtil<span>.</span><span>getLock</span><span>(</span>LOCK_IP_URL_KEY<span>+</span>ip<span>,</span>ip<span>,</span>IP_LOCK_TIME<span>)</span><span>;</span>\n    <span>return</span> <span>false</span><span>;</span>\n   <span>}</span>\n  <span>}</span><span>else</span> <span>{</span>\n   redisUtil<span>.</span><span>getLock</span><span>(</span>key<span>,</span><span>(</span><span>long</span><span>)</span><span>1</span><span>,</span><span>1</span><span>)</span><span>;</span>\n  <span>}</span>\n  <span>return</span> <span>true</span><span>;</span>\n <span>}</span>\n \n <span>private</span> <span>void</span> <span>returnJson</span><span>(</span><span>HttpServletResponse</span> response<span>,</span> <span>String</span> json<span>)</span> <span>throws</span> <span>Exception</span> <span>{</span>\n  <span>PrintWriter</span> writer <span>=</span> <span>null</span><span>;</span>\n  response<span>.</span><span>setCharacterEncoding</span><span>(</span><span>\"UTF-8\"</span><span>)</span><span>;</span>\n  response<span>.</span><span>setContentType</span><span>(</span><span>\"text/json; charset=utf-8\"</span><span>)</span><span>;</span>\n  <span>try</span> <span>{</span>\n   writer <span>=</span> response<span>.</span><span>getWriter</span><span>(</span><span>)</span><span>;</span>\n   writer<span>.</span><span>print</span><span>(</span>json<span>)</span><span>;</span>\n  <span>}</span> <span>catch</span> <span>(</span><span>IOException</span> e<span>)</span> <span>{</span>\n   log<span>.</span><span>error</span><span>(</span><span>\"LoginInterceptor response error ---> {}\"</span><span>,</span> e<span>.</span><span>getMessage</span><span>(</span><span>)</span><span>,</span> e<span>)</span><span>;</span>\n  <span>}</span> <span>finally</span> <span>{</span>\n   <span>if</span> <span>(</span>writer <span>!=</span> <span>null</span><span>)</span> <span>{</span>\n    writer<span>.</span><span>close</span><span>(</span><span>)</span><span>;</span>\n   <span>}</span>\n  <span>}</span>\n <span>}</span>\n \n \n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>代码中redis的使用的是分布式锁的形式，这样可以最大程度保证线程安全和功能的实现效果。代码中设置的是1S内同一个接口通过同一个ip访问5次，就将该ip禁用1个小时，根据自己项目需求可以自己适当修改，实现自己想要的功能；</p>\n<p>redis分布式锁的关键代码:</p>\n<div><pre><code><span>/**\n * <span>@package</span>: com.shuyu.blog.util\n * <span>@className</span>: RedisUtil\n * <span>@description</span>:\n * <span>@author</span>: Shuyu.Wang\n * <span>@since</span>: 0.1\n **/</span>\n<span>@Component</span>\n<span>@Slf4j</span>\n<span>public</span> <span>class</span> <span>RedisUtil</span> <span>{</span>\n \n <span>private</span> <span>static</span> <span>final</span> <span>Long</span> SUCCESS <span>=</span> <span>1L</span><span>;</span>\n \n <span>@Autowired</span>\n <span>private</span> <span>RedisTemplate</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>></span></span> redisTemplate<span>;</span>\n <span>// =============================common============================</span>\n \n \n \n <span>/**\n  * 获取锁\n  * <span>@param</span> <span>lockKey</span>\n  * <span>@param</span> <span>value</span>\n  * <span>@param</span> <span>expireTime</span>：单位-秒\n  * <span>@return</span>\n  */</span>\n <span>public</span> <span>boolean</span> <span>getLock</span><span>(</span><span>String</span> lockKey<span>,</span> <span>Object</span> value<span>,</span> <span>int</span> expireTime<span>)</span> <span>{</span>\n  <span>try</span> <span>{</span>\n   log<span>.</span><span>info</span><span>(</span><span>\"添加分布式锁key={},expireTime={}\"</span><span>,</span>lockKey<span>,</span>expireTime<span>)</span><span>;</span>\n   <span>String</span> script <span>=</span> <span>\"if redis.call('setNx',KEYS[1],ARGV[1]) then if redis.call('get',KEYS[1])==ARGV[1] then return redis.call('expire',KEYS[1],ARGV[2]) else return 0 end end\"</span><span>;</span>\n   <span>RedisScript</span><span><span>&lt;</span><span>String</span><span>></span></span> redisScript <span>=</span> <span>new</span> <span>DefaultRedisScript</span><span><span>&lt;</span><span>></span></span><span>(</span>script<span>,</span> <span>String</span><span>.</span><span>class</span><span>)</span><span>;</span>\n   <span>Object</span> result <span>=</span> redisTemplate<span>.</span><span>execute</span><span>(</span>redisScript<span>,</span> <span>Collections</span><span>.</span><span>singletonList</span><span>(</span>lockKey<span>)</span><span>,</span> value<span>,</span> expireTime<span>)</span><span>;</span>\n   <span>if</span> <span>(</span>SUCCESS<span>.</span><span>equals</span><span>(</span>result<span>)</span><span>)</span> <span>{</span>\n    <span>return</span> <span>true</span><span>;</span>\n   <span>}</span>\n  <span>}</span> <span>catch</span> <span>(</span><span>Exception</span> e<span>)</span> <span>{</span>\n   e<span>.</span><span>printStackTrace</span><span>(</span><span>)</span><span>;</span>\n  <span>}</span>\n  <span>return</span> <span>false</span><span>;</span>\n <span>}</span>\n \n <span>/**\n  * 释放锁\n  * <span>@param</span> <span>lockKey</span>\n  * <span>@param</span> <span>value</span>\n  * <span>@return</span>\n  */</span>\n <span>public</span> <span>boolean</span> <span>releaseLock</span><span>(</span><span>String</span> lockKey<span>,</span> <span>String</span> value<span>)</span> <span>{</span>\n  <span>String</span> script <span>=</span> <span>\"if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end\"</span><span>;</span>\n  <span>RedisScript</span><span><span>&lt;</span><span>String</span><span>></span></span> redisScript <span>=</span> <span>new</span> <span>DefaultRedisScript</span><span><span>&lt;</span><span>></span></span><span>(</span>script<span>,</span> <span>String</span><span>.</span><span>class</span><span>)</span><span>;</span>\n  <span>Object</span> result <span>=</span> redisTemplate<span>.</span><span>execute</span><span>(</span>redisScript<span>,</span> <span>Collections</span><span>.</span><span>singletonList</span><span>(</span>lockKey<span>)</span><span>,</span> value<span>)</span><span>;</span>\n  <span>if</span> <span>(</span>SUCCESS<span>.</span><span>equals</span><span>(</span>result<span>)</span><span>)</span> <span>{</span>\n   <span>return</span> <span>true</span><span>;</span>\n  <span>}</span>\n  <span>return</span> <span>false</span><span>;</span>\n <span>}</span>\n \n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>最后将上面自定义的拦截器通过<code>registry.addInterceptor</code>添加一下，就生效了；</p>\n<div><pre><code><span>@Configuration</span>\n<span>@Slf4j</span>\n<span>public</span> <span>class</span> <span>MyWebAppConfig</span> <span>extends</span> <span>WebMvcConfigurerAdapter</span> <span>{</span>\n    <span>@Bean</span>\n <span>IpUrlLimitInterceptor</span> <span>getIpUrlLimitInterceptor</span><span>(</span><span>)</span><span>{</span>\n     <span>return</span> <span>new</span> <span>IpUrlLimitInterceptor</span><span>(</span><span>)</span><span>;</span>\n <span>}</span>\n \n <span>@Override</span>\n    <span>public</span> <span>void</span> <span>addInterceptors</span><span>(</span><span>InterceptorRegistry</span> registry<span>)</span> <span>{</span>\n  registry<span>.</span><span>addInterceptor</span><span>(</span><span>getIpUrlLimitInterceptor</span><span>(</span><span>)</span><span>)</span><span>.</span><span>addPathPatterns</span><span>(</span><span>\"/**\"</span><span>)</span><span>;</span>\n        <span>super</span><span>.</span><span>addInterceptors</span><span>(</span>registry<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>自己可以写一个for循环来测试方面的功能，这里就不详细介绍了。</p>\n",
      "date_published": "2022-06-05T00:00:00.000Z",
      "date_modified": "2022-05-27T07:56:12.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    },
    {
      "title": "9个很酷的CMD命令",
      "url": "https://blog.ciberviler.top/pc/9%E4%B8%AA%E5%BE%88%E9%85%B7%E7%9A%84CMD%E5%91%BD%E4%BB%A4.html",
      "id": "https://blog.ciberviler.top/pc/9%E4%B8%AA%E5%BE%88%E9%85%B7%E7%9A%84CMD%E5%91%BD%E4%BB%A4.html",
      "content_html": "<h1 id=\"_9个很酷的cmd命令\" tabindex=\"-1\"> 9个很酷的CMD命令</h1>\n<h2 id=\"ipconfig\" tabindex=\"-1\"> <strong>ipconfig</strong></h2>\n<p>功能：查询本机IP地址</p>\n<p>操作方法：只要在在打开的cmd命令界面中输入“ipconfig”就可以了。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535737928341.png\" alt=\"图片\"></p>\n<h2 id=\"msg\" tabindex=\"-1\"> <strong>msg</strong></h2>\n<p>功能：向对方电脑发送一条文本提示</p>\n<p>操作方法：首先你要知道对方的IP地址，接下来输入命令“msg /server:对方电脑IP * ”。在“*”后输入你要发送的内容即可。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535737928331.png\" alt=\"图片\"></p>\n<h2 id=\"net-user\" tabindex=\"-1\"> <strong>Net user</strong></h2>\n<p>功能：查看本机账户情况</p>\n<p>操作方法：和ipconfig一样，net user也有很多衍生的命令后缀，比方说“net user xxx 123456 /add”，输入后就会在系统中创建一个名为“xxx”的新用户，而新用户密码则是“123456”。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535737928342.png\" alt=\"图片\"></p>\n<h2 id=\"net-share\" tabindex=\"-1\"> <strong>Net share</strong></h2>\n<p>作用：查看共享资源</p>\n<p>操作方法：在cmd界面中输入“net share”查看所有已共享资源，然后输入“net share 要删除的共享文件夹 /delete”就可以啦！</p>\n<p><img src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" alt=\"图片\"></p>\n<h2 id=\"nslookup\" tabindex=\"-1\"> <strong>Nslookup</strong></h2>\n<p>作用：检查网站IP地址</p>\n<p>操作方法：在提示符状态输入“nslookup 对方网站域名”，哒哒哒哒……结果出来了！</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535737928343.png\" alt=\"图片\"></p>\n<h2 id=\"netsh-wlan-show\" tabindex=\"-1\"> <strong>Netsh wlan show</strong></h2>\n<p>作用：探秘Wi-Fi配置文件</p>\n<p>操作方法：在提示符状态输入命令“netsh wlan show profile SSID key=clear”，输入完成后Windows会自动返回当前已连接WIFI的详细信息，包括SSID和连接密码。当前这里有一个前提，那就是你现在已经成功连接了。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535737928344.png\" alt=\"图片\"></p>\n<h2 id=\"telnet\" tabindex=\"-1\"> <strong>telnet</strong></h2>\n<p>作用：看电影《星球大战》</p>\n<p>操作方法：在提示符状态输入命令“telnet <a href=\"http://towel.blinkenlights.nl\" target=\"_blank\" rel=\"noopener noreferrer\">towel.blinkenlights.nl</a>”，输入完成后稍等一会即可，电影会自动开演</p>\n<p><img src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" alt=\"图片\"></p>\n<h2 id=\"\" tabindex=\"-1\"> <strong>|</strong></h2>\n<p>作用：将命令结果输出到剪贴板</p>\n<p>操作方法：在需要导出结果的命令后方添加“|”，再加入导出位置就可以了。比方说“| clip”是导出到剪贴板，“| xxx.txt”是导出到xxx.txt。总之，你需要什么地方用，就放到哪儿，“|”支持绝大多数CMD指令。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535737928345.png\" alt=\"图片\"></p>\n<h2 id=\"-1\" tabindex=\"-1\"> <strong>&amp;&amp;</strong></h2>\n<p>作用：将多个命令“连接”起来，一步运行多组命令</p>\n<p>操作方法：&amp;&amp;是CMD里一项“命令连接”语句，直接放在要连接的命令行中间即可。效果就是下图所示，一次输入后CMD会顺序执行所有命令。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535737928346.png\" alt=\"图片\"></p>\n<p>--- EOF ---</p>\n",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535737928341.png",
      "date_published": "2022-06-03T00:00:00.000Z",
      "date_modified": "2022-05-27T07:56:04.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "pc"
      ]
    },
    {
      "title": "Quartz - 任务调度框架整合使用",
      "url": "https://blog.ciberviler.top/dev/Quartz%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88%E4%BD%BF%E7%94%A8.html",
      "id": "https://blog.ciberviler.top/dev/Quartz%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88%E4%BD%BF%E7%94%A8.html",
      "content_html": "<h1 id=\"quartz-任务调度框架整合使用\" tabindex=\"-1\"> Quartz - 任务调度框架整合使用</h1>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535411548287.png\" alt=\"图片\"></p>\n<p>各种实现自定义定时任务的方案，从Quartz到Xxl-job，再到Elastic-job，能聊的都聊了一圈儿；刚刚好手头有一份关于 Quartz 的保姆级教程，在这里分享给大家；</p>\n<h2 id=\"_1前言\" tabindex=\"-1\"> 1前言</h2>\n<p>项目中遇到一个，需要 客户自定任务启动时间 的需求。原来一直都是在项目里硬编码一些定时器，所以没有学习过。</p>\n<p>很多开源的项目管理框架都已经做了 Quartz 的集成。我们居然连这么常用得东西居然没有做成模块化，实在是不应该。</p>\n<p>Quartz是<code>OpenSymphony</code>开源组织在<code>Job scheduling</code>领域又一个开源项目，完全由Java开发，可以用来执行定时任务，类似于<code>java.util.Timer</code>。但是相较于Timer， Quartz增加了很多功能：</p>\n<ul>\n<li>持久性作业 - 就是保持调度定时的状态;</li>\n<li>作业管理 - 对调度作业进行有效的管理;</li>\n</ul>\n<p>官方文档：</p>\n<ul>\n<li><a href=\"http://www.quartz-scheduler.org/documentation/\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.quartz-scheduler.org/documentation/</a></li>\n<li><a href=\"http://www.quartz-scheduler.org/api/2.3.0/index.html\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.quartz-scheduler.org/api/2.3.0/index.html</a></li>\n</ul>\n<h2 id=\"_2基础使用\" tabindex=\"-1\"> 2基础使用</h2>\n<p>Quartz 的核心类有以下三部分：</p>\n<ul>\n<li><strong>任务 Job ：</strong> 需要实现的任务类，实现 <code>execute()</code> 方法，执行后完成任务。</li>\n<li><strong>触发器 Trigger ：</strong> 包括 <code>SimpleTrigger</code> 和 <code>CronTrigger</code>。</li>\n<li><strong>调度器 Scheduler ：</strong> 任务调度器，负责基于 <code>Trigger</code>触发器，来执行 Job任务。</li>\n</ul>\n<p>主要关系如下：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535411548281.png\" alt=\"图片\"></p>\n<h2 id=\"_3demo\" tabindex=\"-1\"> 3Demo</h2>\n<p>按照官网的 Demo，搭建一个纯 maven 项目，添加依赖：</p>\n<div><pre><code><span>&lt;!-- 核心包 --></span>\n<span><span><span>&lt;</span>dependency</span><span>></span></span>\n    <span><span><span>&lt;</span>groupId</span><span>></span></span>org.quartz-scheduler<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n    <span><span><span>&lt;</span>artifactId</span><span>></span></span>quartz<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n    <span><span><span>&lt;</span>version</span><span>></span></span>2.3.0<span><span><span>&lt;/</span>version</span><span>></span></span>\n<span><span><span>&lt;/</span>dependency</span><span>></span></span>\n<span>&lt;!-- 工具包 --></span>\n<span><span><span>&lt;</span>dependency</span><span>></span></span>\n    <span><span><span>&lt;</span>groupId</span><span>></span></span>org.quartz-scheduler<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n    <span><span><span>&lt;</span>artifactId</span><span>></span></span>quartz-jobs<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n    <span><span><span>&lt;</span>version</span><span>></span></span>2.3.0<span><span><span>&lt;/</span>version</span><span>></span></span>\n<span><span><span>&lt;/</span>dependency</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>新建一个任务，实现了 <code>org.quartz.Job</code> 接口：</p>\n<div><pre><code><span>public</span> <span>class</span> <span>MyJob</span> <span>implements</span> <span>Job</span> <span>{</span>\n    <span>@Override</span>\n    <span>public</span> <span>void</span> <span>execute</span><span>(</span><span>JobExecutionContext</span> context<span>)</span> <span>throws</span> <span>JobExecutionException</span> <span>{</span>\n        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"任务被执行了。。。\"</span><span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>main 方法，创建调度器、jobDetail 实例、trigger 实例、执行：</p>\n<div><pre><code><span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>throws</span> <span>Exception</span> <span>{</span>\n    <span>// 1.创建调度器 Scheduler</span>\n    <span>SchedulerFactory</span> factory <span>=</span> <span>new</span> <span>StdSchedulerFactory</span><span>(</span><span>)</span><span>;</span>\n    <span>Scheduler</span> scheduler <span>=</span> factory<span>.</span><span>getScheduler</span><span>(</span><span>)</span><span>;</span>\n\n    <span>// 2.创建JobDetail实例，并与MyJob类绑定(Job执行内容)</span>\n    <span>JobDetail</span> job <span>=</span> <span>JobBuilder</span><span>.</span><span>newJob</span><span>(</span><span>MyJob</span><span>.</span><span>class</span><span>)</span>\n        <span>.</span><span>withIdentity</span><span>(</span><span>\"job1\"</span><span>,</span> <span>\"group1\"</span><span>)</span>\n        <span>.</span><span>build</span><span>(</span><span>)</span><span>;</span>\n\n    <span>// 3.构建Trigger实例,每隔30s执行一次</span>\n    <span>Trigger</span> trigger <span>=</span> <span>TriggerBuilder</span><span>.</span><span>newTrigger</span><span>(</span><span>)</span>\n        <span>.</span><span>withIdentity</span><span>(</span><span>\"trigger1\"</span><span>,</span> <span>\"group1\"</span><span>)</span>\n        <span>.</span><span>startNow</span><span>(</span><span>)</span>\n        <span>.</span><span>withSchedule</span><span>(</span><span>simpleSchedule</span><span>(</span><span>)</span>\n                      <span>.</span><span>withIntervalInSeconds</span><span>(</span><span>30</span><span>)</span>\n                      <span>.</span><span>repeatForever</span><span>(</span><span>)</span><span>)</span>\n        <span>.</span><span>build</span><span>(</span><span>)</span><span>;</span>\n\n    <span>// 4.执行，开启调度器</span>\n    scheduler<span>.</span><span>scheduleJob</span><span>(</span>job<span>,</span> trigger<span>)</span><span>;</span>\n    <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>System</span><span>.</span><span>currentTimeMillis</span><span>(</span><span>)</span><span>)</span><span>;</span>\n    scheduler<span>.</span><span>start</span><span>(</span><span>)</span><span>;</span>\n\n    <span>//主线程睡眠1分钟，然后关闭调度器</span>\n    <span>TimeUnit</span><span>.</span>MINUTES<span>.</span><span>sleep</span><span>(</span><span>1</span><span>)</span><span>;</span>\n    scheduler<span>.</span><span>shutdown</span><span>(</span><span>)</span><span>;</span>\n    <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>System</span><span>.</span><span>currentTimeMillis</span><span>(</span><span>)</span><span>)</span><span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>日志打印情况：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535411548282.png\" alt=\"图片\"></p>\n<h2 id=\"_4jobdetail\" tabindex=\"-1\"> 4JobDetail</h2>\n<p>JobDetail 的作用是绑定 Job，是一个任务实例，它为 Job 添加了许多扩展参数。</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535411548293.png\" alt=\"图片\"></p>\n<p>每次<code>Scheduler</code>调度执行一个Job的时候，首先会拿到对应的Job，然后创建该Job实例，再去执行Job中的<code>execute()</code>的内容，任务执行结束后，关联的Job对象实例会被释放，且会被JVM GC清除。</p>\n<p><strong>为什么设计成JobDetail + Job，不直接使用Job？</strong></p>\n<p>JobDetail 定义的是任务数据，而真正的执行逻辑是在Job中。</p>\n<p>这是因为任务是有可能并发执行，如果Scheduler直接使用Job，就会存在对同一个Job实例并发访问的问题。</p>\n<p>而<code>JobDetail &amp; Job</code> 方式，Sheduler每次执行，都会根据JobDetail创建一个新的Job实例，这样就可以 规避并发访问 的问题。</p>\n<h2 id=\"_5jobexecutioncontext\" tabindex=\"-1\"> 5JobExecutionContext</h2>\n<ul>\n<li>当 <code>Scheduler</code> 调用一个 job，就会将 <code>JobExecutionContext</code> 传递给 Job 的 <code>execute()</code> 方法;</li>\n<li>Job 能通过 <code>JobExecutionContext</code> 对象访问到 Quartz 运行时候的环境以及 Job 本身的明细数据。</li>\n</ul>\n<p>任务实现的 <code>execute()</code> 方法，可以通过 context 参数获取。</p>\n<div><pre><code><span>public</span> <span>interface</span> <span>Job</span> <span>{</span>\n    <span>void</span> <span>execute</span><span>(</span><span>JobExecutionContext</span> context<span>)</span>\n        <span>throws</span> <span>JobExecutionException</span><span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><p>在 <code>Builder</code> 建造过程中，可以使用如下方法：</p>\n<div><pre><code><span>usingJobData</span><span>(</span><span>\"tiggerDataMap\"</span><span>,</span> <span>\"测试传参\"</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>在 <code>execute</code> 方法中获取：</p>\n<div><pre><code>context<span>.</span><span>getTrigger</span><span>(</span><span>)</span><span>.</span><span>getJobDataMap</span><span>(</span><span>)</span><span>.</span><span>get</span><span>(</span><span>\"tiggerDataMap\"</span><span>)</span><span>;</span>\ncontext<span>.</span><span>getJobDetail</span><span>(</span><span>)</span><span>.</span><span>getJobDataMap</span><span>(</span><span>)</span><span>.</span><span>get</span><span>(</span><span>\"tiggerDataMap\"</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h2 id=\"_6job-状态参数\" tabindex=\"-1\"> 6Job 状态参数</h2>\n<p>有状态的 job 可以理解为多次 job调用期间可以持有一些状态信息，这些状态信息存储在 <code>JobDataMap</code> 中。</p>\n<p>而默认的无状态 job，每次调用时都会创建一个新的 <code>JobDataMap</code>。</p>\n<p>示例如下：</p>\n<div><pre><code><span>//多次调用 Job 的时候，将参数保留在 JobDataMap</span>\n<span>@PersistJobDataAfterExecution</span>\n<span>public</span> <span>class</span> <span>JobStatus</span> <span>implements</span> <span>Job</span> <span>{</span>\n    <span>@Override</span>\n    <span>public</span> <span>void</span> <span>execute</span><span>(</span><span>JobExecutionContext</span> context<span>)</span> <span>throws</span> <span>JobExecutionException</span> <span>{</span>\n        <span>long</span> count <span>=</span> <span>(</span><span>long</span><span>)</span> context<span>.</span><span>getJobDetail</span><span>(</span><span>)</span><span>.</span><span>getJobDataMap</span><span>(</span><span>)</span><span>.</span><span>get</span><span>(</span><span>\"count\"</span><span>)</span><span>;</span>\n        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"当前执行，第\"</span> <span>+</span> count <span>+</span> <span>\"次\"</span><span>)</span><span>;</span>\n        context<span>.</span><span>getJobDetail</span><span>(</span><span>)</span><span>.</span><span>getJobDataMap</span><span>(</span><span>)</span><span>.</span><span>put</span><span>(</span><span>\"count\"</span><span>,</span> <span>++</span>count<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n<span>JobDetail</span> job <span>=</span> <span>JobBuilder</span><span>.</span><span>newJob</span><span>(</span><span>JobStatus</span><span>.</span><span>class</span><span>)</span>\n                <span>.</span><span>withIdentity</span><span>(</span><span>\"statusJob\"</span><span>,</span> <span>\"group1\"</span><span>)</span>\n                <span>.</span><span>usingJobData</span><span>(</span><span>\"count\"</span><span>,</span> <span>1L</span><span>)</span>\n                <span>.</span><span>build</span><span>(</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>输出结果：</p>\n<div><pre><code>当前执行，第1次\n<span>[</span>main<span>]</span> INFO org.quartz.core.QuartzScheduler - Scheduler DefaultQuartzScheduler_<span>$_NON_CLUSTERED</span> started.\n当前执行，第2次\n当前执行，第3次\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div></div></div><h2 id=\"_7trigger\" tabindex=\"-1\"> 7Trigger</h2>\n<h3 id=\"定时启动-关闭\" tabindex=\"-1\"> 定时启动/关闭</h3>\n<p><code>Trigger</code> 可以设置任务的开始结束时间， <code>Scheduler</code> 会根据参数进行触发。</p>\n<div><pre><code><span>Calendar</span> instance <span>=</span> <span>Calendar</span><span>.</span><span>getInstance</span><span>(</span><span>)</span><span>;</span>\n<span>Date</span> startTime <span>=</span> instance<span>.</span><span>getTime</span><span>(</span><span>)</span><span>;</span>\ninstance<span>.</span><span>add</span><span>(</span><span>Calendar</span><span>.</span>MINUTE<span>,</span> <span>1</span><span>)</span><span>;</span>\n<span>Date</span> endTime <span>=</span> instance<span>.</span><span>getTime</span><span>(</span><span>)</span><span>;</span>\n\n<span>// 3.构建Trigger实例</span>\n<span>Trigger</span> trigger <span>=</span> <span>TriggerBuilder</span><span>.</span><span>newTrigger</span><span>(</span><span>)</span>\n    <span>.</span><span>withIdentity</span><span>(</span><span>\"trigger1\"</span><span>,</span> <span>\"group1\"</span><span>)</span>\n    <span>// 开始时间</span>\n    <span>.</span><span>startAt</span><span>(</span>startTime<span>)</span>\n    <span>// 结束时间</span>\n    <span>.</span><span>endAt</span><span>(</span>endTime<span>)</span>\n    <span>.</span><span>build</span><span>(</span><span>)</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>在 job 中也能拿到对应的时间，并进行业务判断</p>\n<div><pre><code><span>public</span> <span>void</span> <span>execute</span><span>(</span><span>JobExecutionContext</span> context<span>)</span> <span>throws</span> <span>JobExecutionException</span> <span>{</span>\n    <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>\"任务执行。。。\"</span><span>)</span><span>;</span>\n    <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>context<span>.</span><span>getTrigger</span><span>(</span><span>)</span><span>.</span><span>getStartTime</span><span>(</span><span>)</span><span>)</span><span>;</span>\n    <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>context<span>.</span><span>getTrigger</span><span>(</span><span>)</span><span>.</span><span>getEndTime</span><span>(</span><span>)</span><span>)</span><span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>运行结果：</p>\n<div><pre><code><span>[</span>main<span>]</span> INFO <span><span>org<span>.</span>quartz<span>.</span>impl<span>.</span></span>StdSchedulerFactory</span> <span>-</span> <span>Quartz</span> scheduler version<span>:</span> <span>2.3</span><span>.0</span>\n<span>1633149326723</span>\n任务执行。。。\n<span>Sat</span> <span>Oct</span> <span>02</span> <span>12</span><span>:</span><span>35</span><span>:</span><span>26</span> CST <span>2021</span>\n<span>Sat</span> <span>Oct</span> <span>02</span> <span>12</span><span>:</span><span>36</span><span>:</span><span>26</span> CST <span>2021</span>\n<span>[</span>main<span>]</span> INFO <span><span>org<span>.</span>quartz<span>.</span>core<span>.</span></span>QuartzScheduler</span> <span>-</span> <span>Scheduler</span> <span>DefaultQuartzScheduler_</span>$_NON_CLUSTERED started<span>.</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_8simpletrigger\" tabindex=\"-1\"> 8SimpleTrigger</h2>\n<p>这是比较简单的一类触发器，用它能实现很多基础的应用。使用它的主要场景包括：</p>\n<ul>\n<li>\n<p><strong>在指定时间段内，执行一次任务</strong></p>\n<p>最基础的 Trigger 不设置循环，设置开始时间。</p>\n</li>\n<li>\n<p><strong>在指定时间段内，循环执行任务</strong></p>\n<p>在 1 基础上加上循环间隔。可以指定 永远循环、运行指定次数</p>\n<div><pre><code><span>TriggerBuilder</span><span>.</span><span>newTrigger</span><span>(</span><span>)</span>\n    <span>.</span><span>withSchedule</span><span>(</span><span>SimpleScheduleBuilder</span>\n                  <span>.</span><span>simpleSchedule</span><span>(</span><span>)</span>\n                  <span>.</span><span>withIntervalInSeconds</span><span>(</span><span>30</span><span>)</span>\n                  <span>.</span><span>repeatForever</span><span>(</span><span>)</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><blockquote>\n<p><code>withRepeatCount(count)</code> 是重复次数，实际运行次数为 <code>count+1</code></p>\n</blockquote>\n<div><pre><code><span>TriggerBuilder</span><span>.</span><span>newTrigger</span><span>(</span><span>)</span>\n    <span>.</span><span>withSchedule</span><span>(</span><span>SimpleScheduleBuilder</span>\n                  <span>.</span><span>simpleSchedule</span><span>(</span><span>)</span>\n                  <span>.</span><span>withIntervalInSeconds</span><span>(</span><span>30</span><span>)</span>\n                  <span>.</span><span>withRepeatCount</span><span>(</span><span>5</span><span>)</span><span>)</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div></li>\n<li>\n<p><strong>立即开始，指定时间结束</strong></p>\n<p>这个，略。</p>\n</li>\n</ul>\n<h2 id=\"_9crontrigger\" tabindex=\"-1\"> 9CronTrigger</h2>\n<p><code>CronTrigger</code> 是基于日历的任务调度器，在实际应用中更加常用。</p>\n<p>虽然很常用，但是知识点都一样，只是可以通过表达式来设置时间而已。</p>\n<p>使用方式就是绑定调度器时换一下：</p>\n<div><pre><code>TriggerBuilder.newTrigger().withSchedule(CronScheduleBuilder.cronSchedule(\"* * * * * ?\"))\n</code></pre><div aria-hidden=\"true\"><div></div></div></div><p>Cron 表达式这里不介绍，贴个图跳过</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535411548294.png\" alt=\"图片\"></p>\n<p>顺便推荐一个非常好用的Cron 表达式在线生成，反解析的工具：<a href=\"http://www.matools.com/cron\" target=\"_blank\" rel=\"noopener noreferrer\">www.matools.com/cron</a> 非常好用，点几下，就能得到自己想要的cron表达式；</p>\n<h2 id=\"_10springboot-整合\" tabindex=\"-1\"> 10SpringBoot 整合</h2>\n<p>下面集成应用截图来自 Ruoyi 框架：</p>\n<p><img src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" alt=\"图片\"></p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535411548295.png\" alt=\"图片\"></p>\n<p>从上面的截图中，可以看到这个定时任务模块实现了：</p>\n<ul>\n<li>cron表达式定时执行</li>\n<li>并发执行</li>\n<li>错误策略</li>\n<li>启动执行、暂停执行</li>\n</ul>\n<p>如果再加上：设置启动时间、停止时间 就更好了。不过启停时间只是调用两个方法而已，也就不写了。</p>\n<p>这一部分就主要是看 RuoYi 框架 代码，然后加一点我需要用的功能。</p>\n<p>前端部分就不写了，全部用 swagger 代替，一些基础字段也删除了，仅复制主体功能。</p>\n<p>已完成代码示例：</p>\n<blockquote>\n<p><a href=\"https://gitee.com/qianwei4712/code-of-shiva/tree/master/quartz\" target=\"_blank\" rel=\"noopener noreferrer\">https://gitee.com/qianwei4712/code-of-shiva/tree/master/quartz</a></p>\n</blockquote>\n<h2 id=\"_11环境准备\" tabindex=\"-1\"> 11环境准备</h2>\n<p>从 springboot 2.4.10 开始，添加 quartz 的 maven 依赖：</p>\n<div><pre><code><span>&lt;!--  Quartz 任务调度 --></span>\n<span><span><span>&lt;</span>dependency</span><span>></span></span>\n    <span><span><span>&lt;</span>groupId</span><span>></span></span>org.springframework.boot<span><span><span>&lt;/</span>groupId</span><span>></span></span>\n    <span><span><span>&lt;</span>artifactId</span><span>></span></span>spring-boot-starter-quartz<span><span><span>&lt;/</span>artifactId</span><span>></span></span>\n<span><span><span>&lt;/</span>dependency</span><span>></span></span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div></div></div><p>application 配置文件：</p>\n<div><pre><code><span># 开发环境配置</span>\n<span>server</span><span>:</span>\n  <span># 服务器的HTTP端口</span>\n  <span>port</span><span>:</span> <span>80</span>\n  <span>servlet</span><span>:</span>\n    <span># 应用的访问路径</span>\n    <span>context-path</span><span>:</span> /\n  <span>tomcat</span><span>:</span>\n    <span># tomcat的URI编码</span>\n    <span>uri-encoding</span><span>:</span> UTF<span>-</span><span>8</span>\n\n<span>spring</span><span>:</span>\n  <span>datasource</span><span>:</span>\n    <span>username</span><span>:</span> root\n    <span>password</span><span>:</span> root\n    <span>url</span><span>:</span> jdbc<span>:</span>mysql<span>:</span>//127.0.0.1<span>:</span>3306/quartz<span>?</span>useUnicode=true<span>&amp;characterEncoding=utf-8&amp;useSSL=true</span>\n    <span>driver-class-name</span><span>:</span> com.mysql.cj.jdbc.Driver\n\n    <span># HikariPool 较佳配置</span>\n    <span>hikari</span><span>:</span>\n      <span># 客户端（即您）等待来自池的连接的最大毫秒数</span>\n      <span>connection-timeout</span><span>:</span> <span>60000</span>\n      <span># 控制将测试连接的活动性的最长时间</span>\n      <span>validation-timeout</span><span>:</span> <span>3000</span>\n      <span># 控制允许连接在池中保持空闲状态的最长时间</span>\n      <span>idle-timeout</span><span>:</span> <span>60000</span>\n\n      <span>login-timeout</span><span>:</span> <span>5</span>\n      <span># 控制池中连接的最大生存期</span>\n      <span>max-lifetime</span><span>:</span> <span>60000</span>\n      <span># 控制允许池达到的最大大小，包括空闲和使用中的连接</span>\n      <span>maximum-pool-size</span><span>:</span> <span>10</span>\n      <span># 控制HikariCP尝试在池中维护的最小空闲连接数</span>\n      <span>minimum-idle</span><span>:</span> <span>10</span>\n      <span># 控制默认情况下从池获得的连接是否处于只读模式</span>\n      <span>read-only</span><span>:</span> <span>false</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>Quartz 自带有数据库模式，脚本都是现成的：</p>\n<p>下载这个脚本：</p>\n<blockquote>\n<p><a href=\"https://gitee.com/qianwei4712/code-of-shiva/blob/master/quartz/quartz.sql\" target=\"_blank\" rel=\"noopener noreferrer\">https://gitee.com/qianwei4712/code-of-shiva/blob/master/quartz/quartz.sql</a></p>\n</blockquote>\n<p>保存任务的数据库表：</p>\n<div><pre><code><span>CREATE</span> <span>TABLE</span> <span><span>`</span>quartz_job<span>`</span></span> <span>(</span>\n  <span><span>`</span>job_id<span>`</span></span> <span>bigint</span><span>(</span><span>20</span><span>)</span> <span>NOT</span> <span>NULL</span> <span>AUTO_INCREMENT</span> <span>COMMENT</span> <span>'任务ID'</span><span>,</span>\n  <span><span>`</span>job_name<span>`</span></span> <span>varchar</span><span>(</span><span>64</span><span>)</span> <span>NOT</span> <span>NULL</span> <span>DEFAULT</span> <span>''</span> <span>COMMENT</span> <span>'任务名称'</span><span>,</span>\n  <span><span>`</span>job_group<span>`</span></span> <span>varchar</span><span>(</span><span>64</span><span>)</span> <span>NOT</span> <span>NULL</span> <span>DEFAULT</span> <span>'DEFAULT'</span> <span>COMMENT</span> <span>'任务组名'</span><span>,</span>\n  <span><span>`</span>invoke_target<span>`</span></span> <span>varchar</span><span>(</span><span>500</span><span>)</span> <span>NOT</span> <span>NULL</span> <span>COMMENT</span> <span>'调用目标字符串'</span><span>,</span>\n  <span><span>`</span>cron_expression<span>`</span></span> <span>varchar</span><span>(</span><span>255</span><span>)</span> <span>DEFAULT</span> <span>''</span> <span>COMMENT</span> <span>'cron执行表达式'</span><span>,</span>\n  <span><span>`</span>misfire_policy<span>`</span></span> <span>varchar</span><span>(</span><span>20</span><span>)</span> <span>DEFAULT</span> <span>'3'</span> <span>COMMENT</span> <span>'计划执行错误策略（1立即执行 2执行一次 3放弃执行）'</span><span>,</span>\n  <span><span>`</span>concurrent<span>`</span></span> <span>char</span><span>(</span><span>1</span><span>)</span> <span>DEFAULT</span> <span>'1'</span> <span>COMMENT</span> <span>'是否并发执行（0允许 1禁止）'</span><span>,</span>\n  <span><span>`</span>status<span>`</span></span> <span>char</span><span>(</span><span>1</span><span>)</span> <span>DEFAULT</span> <span>'0'</span> <span>COMMENT</span> <span>'状态（0正常 1暂停）'</span><span>,</span>\n  <span><span>`</span>remark<span>`</span></span> <span>varchar</span><span>(</span><span>500</span><span>)</span> <span>DEFAULT</span> <span>''</span> <span>COMMENT</span> <span>'备注信息'</span><span>,</span>\n  <span>PRIMARY</span> <span>KEY</span> <span>(</span><span><span>`</span>job_id<span>`</span></span><span>,</span><span><span>`</span>job_name<span>`</span></span><span>,</span><span><span>`</span>job_group<span>`</span></span><span>)</span>\n<span>)</span> <span>ENGINE</span><span>=</span><span>InnoDB</span> <span>AUTO_INCREMENT</span><span>=</span><span>2</span> <span>DEFAULT</span> <span>CHARSET</span><span>=</span>utf8 <span>COMMENT</span><span>=</span><span>'定时任务调度表'</span><span>;</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>最后准备一个任务方法：</p>\n<div><pre><code><span>@Slf4j</span>\n<span>@Component</span><span>(</span><span>\"mysqlJob\"</span><span>)</span>\n<span>public</span> <span>class</span> <span>MysqlJob</span> <span>{</span>\n    <span>protected</span> <span>final</span> <span>Logger</span> logger <span>=</span> <span>LoggerFactory</span><span>.</span><span>getLogger</span><span>(</span><span>this</span><span>.</span><span>getClass</span><span>(</span><span>)</span><span>)</span><span>;</span>\n    <span>public</span> <span>void</span> <span>execute</span><span>(</span><span>String</span> param<span>)</span> <span>{</span>\n        logger<span>.</span><span>info</span><span>(</span><span>\"执行 Mysql Job，当前时间：{}，任务参数：{}\"</span><span>,</span> <span>LocalDateTime</span><span>.</span><span>now</span><span>(</span><span>)</span><span>.</span><span>format</span><span>(</span><span>DateTimeFormatter</span><span>.</span><span>ofPattern</span><span>(</span><span>\"yyyy-MM-dd HH:mm:ss\"</span><span>)</span><span>)</span><span>,</span> param<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_12核心代码\" tabindex=\"-1\"> 12核心代码</h2>\n<p><code>ScheduleConfig</code> 配置代码类：</p>\n<div><pre><code><span>@Configuration</span>\n<span>public</span> <span>class</span> <span>ScheduleConfig</span> <span>{</span>\n\n    <span>@Bean</span>\n    <span>public</span> <span>SchedulerFactoryBean</span> <span>schedulerFactoryBean</span><span>(</span><span>DataSource</span> dataSource<span>)</span> <span>{</span>\n        <span>SchedulerFactoryBean</span> factory <span>=</span> <span>new</span> <span>SchedulerFactoryBean</span><span>(</span><span>)</span><span>;</span>\n        factory<span>.</span><span>setDataSource</span><span>(</span>dataSource<span>)</span><span>;</span>\n\n        <span>// quartz参数</span>\n        <span>Properties</span> prop <span>=</span> <span>new</span> <span>Properties</span><span>(</span><span>)</span><span>;</span>\n        prop<span>.</span><span>put</span><span>(</span><span>\"org.quartz.scheduler.instanceName\"</span><span>,</span> <span>\"shivaScheduler\"</span><span>)</span><span>;</span>\n        prop<span>.</span><span>put</span><span>(</span><span>\"org.quartz.scheduler.instanceId\"</span><span>,</span> <span>\"AUTO\"</span><span>)</span><span>;</span>\n        <span>// 线程池配置</span>\n        prop<span>.</span><span>put</span><span>(</span><span>\"org.quartz.threadPool.class\"</span><span>,</span> <span>\"org.quartz.simpl.SimpleThreadPool\"</span><span>)</span><span>;</span>\n        prop<span>.</span><span>put</span><span>(</span><span>\"org.quartz.threadPool.threadCount\"</span><span>,</span> <span>\"20\"</span><span>)</span><span>;</span>\n        prop<span>.</span><span>put</span><span>(</span><span>\"org.quartz.threadPool.threadPriority\"</span><span>,</span> <span>\"5\"</span><span>)</span><span>;</span>\n        <span>// JobStore配置</span>\n        prop<span>.</span><span>put</span><span>(</span><span>\"org.quartz.jobStore.class\"</span><span>,</span> <span>\"org.quartz.impl.jdbcjobstore.JobStoreTX\"</span><span>)</span><span>;</span>\n        <span>// 集群配置</span>\n        prop<span>.</span><span>put</span><span>(</span><span>\"org.quartz.jobStore.isClustered\"</span><span>,</span> <span>\"true\"</span><span>)</span><span>;</span>\n        prop<span>.</span><span>put</span><span>(</span><span>\"org.quartz.jobStore.clusterCheckinInterval\"</span><span>,</span> <span>\"15000\"</span><span>)</span><span>;</span>\n        prop<span>.</span><span>put</span><span>(</span><span>\"org.quartz.jobStore.maxMisfiresToHandleAtATime\"</span><span>,</span> <span>\"1\"</span><span>)</span><span>;</span>\n        prop<span>.</span><span>put</span><span>(</span><span>\"org.quartz.jobStore.txIsolationLevelSerializable\"</span><span>,</span> <span>\"true\"</span><span>)</span><span>;</span>\n\n        <span>// sqlserver 启用</span>\n        <span>// prop.put(\"org.quartz.jobStore.selectWithLockSQL\", \"SELECT * FROM {0}LOCKS UPDLOCK WHERE LOCK_NAME = ?\");</span>\n        prop<span>.</span><span>put</span><span>(</span><span>\"org.quartz.jobStore.misfireThreshold\"</span><span>,</span> <span>\"12000\"</span><span>)</span><span>;</span>\n        prop<span>.</span><span>put</span><span>(</span><span>\"org.quartz.jobStore.tablePrefix\"</span><span>,</span> <span>\"QRTZ_\"</span><span>)</span><span>;</span>\n        factory<span>.</span><span>setQuartzProperties</span><span>(</span>prop<span>)</span><span>;</span>\n\n        factory<span>.</span><span>setSchedulerName</span><span>(</span><span>\"shivaScheduler\"</span><span>)</span><span>;</span>\n        <span>// 延时启动</span>\n        factory<span>.</span><span>setStartupDelay</span><span>(</span><span>1</span><span>)</span><span>;</span>\n        factory<span>.</span><span>setApplicationContextSchedulerContextKey</span><span>(</span><span>\"applicationContextKey\"</span><span>)</span><span>;</span>\n        <span>// 可选，QuartzScheduler</span>\n        <span>// 启动时更新己存在的Job，这样就不用每次修改targetObject后删除qrtz_job_details表对应记录了</span>\n        factory<span>.</span><span>setOverwriteExistingJobs</span><span>(</span><span>true</span><span>)</span><span>;</span>\n        <span>// 设置自动启动，默认为true</span>\n        factory<span>.</span><span>setAutoStartup</span><span>(</span><span>true</span><span>)</span><span>;</span>\n\n        <span>return</span> factory<span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p><code>ScheduleUtils</code> 调度工具类，这是本篇中最核心的代码：</p>\n<div><pre><code><span>public</span> <span>class</span> <span>ScheduleUtils</span> <span>{</span>\n    <span>/**\n     * 得到quartz任务类\n     *\n     * <span>@param</span> <span>job</span> 执行计划\n     * <span>@return</span> 具体执行任务类\n     */</span>\n    <span>private</span> <span>static</span> <span>Class</span><span><span>&lt;</span><span>?</span> <span>extends</span> <span>Job</span><span>></span></span> <span>getQuartzJobClass</span><span>(</span><span>QuartzJob</span> job<span>)</span> <span>{</span>\n        <span>boolean</span> isConcurrent <span>=</span> <span>\"0\"</span><span>.</span><span>equals</span><span>(</span>job<span>.</span><span>getConcurrent</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        <span>return</span> isConcurrent <span>?</span> <span>QuartzJobExecution</span><span>.</span><span>class</span> <span>:</span> <span>QuartzDisallowConcurrentExecution</span><span>.</span><span>class</span><span>;</span>\n    <span>}</span>\n\n    <span>/**\n     * 构建任务触发对象\n     */</span>\n    <span>public</span> <span>static</span> <span>TriggerKey</span> <span>getTriggerKey</span><span>(</span><span>Long</span> jobId<span>,</span> <span>String</span> jobGroup<span>)</span> <span>{</span>\n        <span>return</span> <span>TriggerKey</span><span>.</span><span>triggerKey</span><span>(</span><span>ScheduleConstants</span><span>.</span>TASK_CLASS_NAME <span>+</span> jobId<span>,</span> jobGroup<span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>/**\n     * 构建任务键对象\n     */</span>\n    <span>public</span> <span>static</span> <span>JobKey</span> <span>getJobKey</span><span>(</span><span>Long</span> jobId<span>,</span> <span>String</span> jobGroup<span>)</span> <span>{</span>\n        <span>return</span> <span>JobKey</span><span>.</span><span>jobKey</span><span>(</span><span>ScheduleConstants</span><span>.</span>TASK_CLASS_NAME <span>+</span> jobId<span>,</span> jobGroup<span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>/**\n     * 创建定时任务\n     */</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>createScheduleJob</span><span>(</span><span>Scheduler</span> scheduler<span>,</span> <span>QuartzJob</span> job<span>)</span> <span>throws</span> <span>Exception</span> <span>{</span>\n        <span>Class</span><span><span>&lt;</span><span>?</span> <span>extends</span> <span>Job</span><span>></span></span> jobClass <span>=</span> <span>getQuartzJobClass</span><span>(</span>job<span>)</span><span>;</span>\n        <span>// 构建job信息</span>\n        <span>Long</span> jobId <span>=</span> job<span>.</span><span>getJobId</span><span>(</span><span>)</span><span>;</span>\n        <span>String</span> jobGroup <span>=</span> job<span>.</span><span>getJobGroup</span><span>(</span><span>)</span><span>;</span>\n        <span>JobDetail</span> jobDetail <span>=</span> <span>JobBuilder</span><span>.</span><span>newJob</span><span>(</span>jobClass<span>)</span><span>.</span><span>withIdentity</span><span>(</span><span>getJobKey</span><span>(</span>jobId<span>,</span> jobGroup<span>)</span><span>)</span><span>.</span><span>build</span><span>(</span><span>)</span><span>;</span>\n\n        <span>// 表达式调度构建器</span>\n        <span>CronScheduleBuilder</span> cronScheduleBuilder <span>=</span> <span>CronScheduleBuilder</span><span>.</span><span>cronSchedule</span><span>(</span>job<span>.</span><span>getCronExpression</span><span>(</span><span>)</span><span>)</span><span>;</span>\n        cronScheduleBuilder <span>=</span> <span>handleCronScheduleMisfirePolicy</span><span>(</span>job<span>,</span> cronScheduleBuilder<span>)</span><span>;</span>\n\n        <span>// 按新的cronExpression表达式构建一个新的trigger</span>\n        <span>CronTrigger</span> trigger <span>=</span> <span>TriggerBuilder</span><span>.</span><span>newTrigger</span><span>(</span><span>)</span><span>.</span><span>withIdentity</span><span>(</span><span>getTriggerKey</span><span>(</span>jobId<span>,</span> jobGroup<span>)</span><span>)</span>\n                <span>.</span><span>withSchedule</span><span>(</span>cronScheduleBuilder<span>)</span><span>.</span><span>build</span><span>(</span><span>)</span><span>;</span>\n\n        <span>// 放入参数，运行时的方法可以获取</span>\n        jobDetail<span>.</span><span>getJobDataMap</span><span>(</span><span>)</span><span>.</span><span>put</span><span>(</span><span>ScheduleConstants</span><span>.</span>TASK_PROPERTIES<span>,</span> job<span>)</span><span>;</span>\n\n        <span>// 判断是否存在</span>\n        <span>if</span> <span>(</span>scheduler<span>.</span><span>checkExists</span><span>(</span><span>getJobKey</span><span>(</span>jobId<span>,</span> jobGroup<span>)</span><span>)</span><span>)</span> <span>{</span>\n            <span>// 防止创建时存在数据问题 先移除，然后在执行创建操作</span>\n            scheduler<span>.</span><span>deleteJob</span><span>(</span><span>getJobKey</span><span>(</span>jobId<span>,</span> jobGroup<span>)</span><span>)</span><span>;</span>\n        <span>}</span>\n\n        scheduler<span>.</span><span>scheduleJob</span><span>(</span>jobDetail<span>,</span> trigger<span>)</span><span>;</span>\n\n        <span>// 暂停任务</span>\n        <span>if</span> <span>(</span>job<span>.</span><span>getStatus</span><span>(</span><span>)</span><span>.</span><span>equals</span><span>(</span><span>ScheduleConstants<span>.</span>Status</span><span>.</span>PAUSE<span>.</span><span>getValue</span><span>(</span><span>)</span><span>)</span><span>)</span> <span>{</span>\n            scheduler<span>.</span><span>pauseJob</span><span>(</span><span>ScheduleUtils</span><span>.</span><span>getJobKey</span><span>(</span>jobId<span>,</span> jobGroup<span>)</span><span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n\n    <span>/**\n     * 设置定时任务策略\n     */</span>\n    <span>public</span> <span>static</span> <span>CronScheduleBuilder</span> <span>handleCronScheduleMisfirePolicy</span><span>(</span><span>QuartzJob</span> job<span>,</span> <span>CronScheduleBuilder</span> cb<span>)</span>\n            <span>throws</span> <span>Exception</span> <span>{</span>\n        <span>switch</span> <span>(</span>job<span>.</span><span>getMisfirePolicy</span><span>(</span><span>)</span><span>)</span> <span>{</span>\n            <span>case</span> <span>ScheduleConstants</span><span>.</span>MISFIRE_DEFAULT<span>:</span>\n                <span>return</span> cb<span>;</span>\n            <span>case</span> <span>ScheduleConstants</span><span>.</span>MISFIRE_IGNORE_MISFIRES<span>:</span>\n                <span>return</span> cb<span>.</span><span>withMisfireHandlingInstructionIgnoreMisfires</span><span>(</span><span>)</span><span>;</span>\n            <span>case</span> <span>ScheduleConstants</span><span>.</span>MISFIRE_FIRE_AND_PROCEED<span>:</span>\n                <span>return</span> cb<span>.</span><span>withMisfireHandlingInstructionFireAndProceed</span><span>(</span><span>)</span><span>;</span>\n            <span>case</span> <span>ScheduleConstants</span><span>.</span>MISFIRE_DO_NOTHING<span>:</span>\n                <span>return</span> cb<span>.</span><span>withMisfireHandlingInstructionDoNothing</span><span>(</span><span>)</span><span>;</span>\n            <span>default</span><span>:</span>\n                <span>throw</span> <span>new</span> <span>Exception</span><span>(</span><span>\"The task misfire policy '\"</span> <span>+</span> job<span>.</span><span>getMisfirePolicy</span><span>(</span><span>)</span>\n                        <span>+</span> <span>\"' cannot be used in cron schedule tasks\"</span><span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>这里可以看到，在完成任务与触发器的关联后，如果是暂停状态，会先让调度器停止任务。</p>\n<p><code>AbstractQuartzJob</code> 抽象任务：</p>\n<div><pre><code><span>public</span> <span>abstract</span> <span>class</span> <span>AbstractQuartzJob</span> <span>implements</span> <span>Job</span> <span>{</span>\n    <span>private</span> <span>static</span> <span>final</span> <span>Logger</span> log <span>=</span> <span>LoggerFactory</span><span>.</span><span>getLogger</span><span>(</span><span>AbstractQuartzJob</span><span>.</span><span>class</span><span>)</span><span>;</span>\n\n    <span>/**\n     * 线程本地变量\n     */</span>\n    <span>private</span> <span>static</span> <span>ThreadLocal</span><span><span>&lt;</span><span>Date</span><span>></span></span> threadLocal <span>=</span> <span>new</span> <span>ThreadLocal</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n\n    <span>@Override</span>\n    <span>public</span> <span>void</span> <span>execute</span><span>(</span><span>JobExecutionContext</span> context<span>)</span> <span>throws</span> <span>JobExecutionException</span> <span>{</span>\n        <span>QuartzJob</span> job <span>=</span> <span>new</span> <span>QuartzJob</span><span>(</span><span>)</span><span>;</span>\n        <span>BeanUtils</span><span>.</span><span>copyBeanProp</span><span>(</span>job<span>,</span> context<span>.</span><span>getMergedJobDataMap</span><span>(</span><span>)</span><span>.</span><span>get</span><span>(</span><span>ScheduleConstants</span><span>.</span>TASK_PROPERTIES<span>)</span><span>)</span><span>;</span>\n        <span>try</span> <span>{</span>\n            <span>before</span><span>(</span>context<span>,</span> job<span>)</span><span>;</span>\n            <span>if</span> <span>(</span>job <span>!=</span> <span>null</span><span>)</span> <span>{</span>\n                <span>doExecute</span><span>(</span>context<span>,</span> job<span>)</span><span>;</span>\n            <span>}</span>\n            <span>after</span><span>(</span>context<span>,</span> job<span>,</span> <span>null</span><span>)</span><span>;</span>\n        <span>}</span> <span>catch</span> <span>(</span><span>Exception</span> e<span>)</span> <span>{</span>\n            log<span>.</span><span>error</span><span>(</span><span>\"任务执行异常  - ：\"</span><span>,</span> e<span>)</span><span>;</span>\n            <span>after</span><span>(</span>context<span>,</span> job<span>,</span> e<span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n\n    <span>/**\n     * 执行前\n     *\n     * <span>@param</span> <span>context</span> 工作执行上下文对象\n     * <span>@param</span> <span>job</span>     系统计划任务\n     */</span>\n    <span>protected</span> <span>void</span> <span>before</span><span>(</span><span>JobExecutionContext</span> context<span>,</span> <span>QuartzJob</span> job<span>)</span> <span>{</span>\n        threadLocal<span>.</span><span>set</span><span>(</span><span>new</span> <span>Date</span><span>(</span><span>)</span><span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>/**\n     * 执行后\n     *\n     * <span>@param</span> <span>context</span> 工作执行上下文对象\n     * <span>@param</span> <span>sysJob</span>  系统计划任务\n     */</span>\n    <span>protected</span> <span>void</span> <span>after</span><span>(</span><span>JobExecutionContext</span> context<span>,</span> <span>QuartzJob</span> sysJob<span>,</span> <span>Exception</span> e<span>)</span> <span>{</span>\n\n    <span>}</span>\n\n    <span>/**\n     * 执行方法，由子类重载\n     *\n     * <span>@param</span> <span>context</span> 工作执行上下文对象\n     * <span>@param</span> <span>job</span>     系统计划任务\n     * <span>@throws</span> <span><span>Exception</span></span> 执行过程中的异常\n     */</span>\n    <span>protected</span> <span>abstract</span> <span>void</span> <span>doExecute</span><span>(</span><span>JobExecutionContext</span> context<span>,</span> <span>QuartzJob</span> job<span>)</span> <span>throws</span> <span>Exception</span><span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><blockquote>\n<p>这个类将原本 <code>execute</code> 方法执行的任务，下放到了子类重载的 <code>doExecute</code> 方法中</p>\n</blockquote>\n<p>同时准备实现，分了允许并发和不允许并发，差别就是一个注解：</p>\n<div><pre><code><span>public</span> <span>class</span> <span>QuartzJobExecution</span> <span>extends</span> <span>AbstractQuartzJob</span> <span>{</span>\n    <span>@Override</span>\n    <span>protected</span> <span>void</span> <span>doExecute</span><span>(</span><span>JobExecutionContext</span> context<span>,</span> <span>QuartzJob</span> job<span>)</span> <span>throws</span> <span>Exception</span> <span>{</span>\n        <span>JobInvokeUtil</span><span>.</span><span>invokeMethod</span><span>(</span>job<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n<span>@DisallowConcurrentExecution</span>\n<span>public</span> <span>class</span> <span>QuartzDisallowConcurrentExecution</span> <span>extends</span> <span>AbstractQuartzJob</span> <span>{</span>\n    <span>@Override</span>\n    <span>protected</span> <span>void</span> <span>doExecute</span><span>(</span><span>JobExecutionContext</span> context<span>,</span> <span>QuartzJob</span> job<span>)</span> <span>throws</span> <span>Exception</span> <span>{</span>\n        <span>JobInvokeUtil</span><span>.</span><span>invokeMethod</span><span>(</span>job<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>最后由 <code>JobInvokeUtil</code> 通过反射，进行实际的方法调用：</p>\n<div><pre><code><span>public</span> <span>class</span> <span>JobInvokeUtil</span> <span>{</span>\n    <span>/**\n     * 执行方法\n     *\n     * <span>@param</span> <span>job</span> 系统任务\n     */</span>\n    <span>public</span> <span>static</span> <span>void</span> <span>invokeMethod</span><span>(</span><span>QuartzJob</span> job<span>)</span> <span>throws</span> <span>Exception</span> <span>{</span>\n        <span>String</span> invokeTarget <span>=</span> job<span>.</span><span>getInvokeTarget</span><span>(</span><span>)</span><span>;</span>\n        <span>String</span> beanName <span>=</span> <span>getBeanName</span><span>(</span>invokeTarget<span>)</span><span>;</span>\n        <span>String</span> methodName <span>=</span> <span>getMethodName</span><span>(</span>invokeTarget<span>)</span><span>;</span>\n        <span>List</span><span>&lt;</span><span>Object</span><span>[</span><span>]</span><span>></span> methodParams <span>=</span> <span>getMethodParams</span><span>(</span>invokeTarget<span>)</span><span>;</span>\n\n        <span>if</span> <span>(</span><span>!</span><span>isValidClassName</span><span>(</span>beanName<span>)</span><span>)</span> <span>{</span>\n            <span>Object</span> bean <span>=</span> <span>SpringUtils</span><span>.</span><span>getBean</span><span>(</span>beanName<span>)</span><span>;</span>\n            <span>invokeMethod</span><span>(</span>bean<span>,</span> methodName<span>,</span> methodParams<span>)</span><span>;</span>\n        <span>}</span> <span>else</span> <span>{</span>\n            <span>Object</span> bean <span>=</span> <span>Class</span><span>.</span><span>forName</span><span>(</span>beanName<span>)</span><span>.</span><span>newInstance</span><span>(</span><span>)</span><span>;</span>\n            <span>invokeMethod</span><span>(</span>bean<span>,</span> methodName<span>,</span> methodParams<span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n\n    <span>/**\n     * 调用任务方法\n     *\n     * <span>@param</span> <span>bean</span>         目标对象\n     * <span>@param</span> <span>methodName</span>   方法名称\n     * <span>@param</span> <span>methodParams</span> 方法参数\n     */</span>\n    <span>private</span> <span>static</span> <span>void</span> <span>invokeMethod</span><span>(</span><span>Object</span> bean<span>,</span> <span>String</span> methodName<span>,</span> <span>List</span><span>&lt;</span><span>Object</span><span>[</span><span>]</span><span>></span> methodParams<span>)</span>\n            <span>throws</span> <span>NoSuchMethodException</span><span>,</span> <span>SecurityException</span><span>,</span> <span>IllegalAccessException</span><span>,</span> <span>IllegalArgumentException</span><span>,</span>\n            <span>InvocationTargetException</span> <span>{</span>\n        <span>if</span> <span>(</span><span>StringUtils</span><span>.</span><span>isNotNull</span><span>(</span>methodParams<span>)</span> <span>&amp;&amp;</span> methodParams<span>.</span><span>size</span><span>(</span><span>)</span> <span>></span> <span>0</span><span>)</span> <span>{</span>\n            <span>Method</span> method <span>=</span> bean<span>.</span><span>getClass</span><span>(</span><span>)</span><span>.</span><span>getDeclaredMethod</span><span>(</span>methodName<span>,</span> <span>getMethodParamsType</span><span>(</span>methodParams<span>)</span><span>)</span><span>;</span>\n            method<span>.</span><span>invoke</span><span>(</span>bean<span>,</span> <span>getMethodParamsValue</span><span>(</span>methodParams<span>)</span><span>)</span><span>;</span>\n        <span>}</span> <span>else</span> <span>{</span>\n            <span>Method</span> method <span>=</span> bean<span>.</span><span>getClass</span><span>(</span><span>)</span><span>.</span><span>getDeclaredMethod</span><span>(</span>methodName<span>)</span><span>;</span>\n            method<span>.</span><span>invoke</span><span>(</span>bean<span>)</span><span>;</span>\n        <span>}</span>\n    <span>}</span>\n\n    <span>/**\n     * 校验是否为为class包名\n     *\n     * <span>@param</span> <span>invokeTarget</span> 名称\n     * <span>@return</span> true是 false否\n     */</span>\n    <span>public</span> <span>static</span> <span>boolean</span> <span>isValidClassName</span><span>(</span><span>String</span> invokeTarget<span>)</span> <span>{</span>\n        <span>return</span> <span>StringUtils</span><span>.</span><span>countMatches</span><span>(</span>invokeTarget<span>,</span> <span>\".\"</span><span>)</span> <span>></span> <span>1</span><span>;</span>\n    <span>}</span>\n\n    <span>/**\n     * 获取bean名称\n     *\n     * <span>@param</span> <span>invokeTarget</span> 目标字符串\n     * <span>@return</span> bean名称\n     */</span>\n    <span>public</span> <span>static</span> <span>String</span> <span>getBeanName</span><span>(</span><span>String</span> invokeTarget<span>)</span> <span>{</span>\n        <span>String</span> beanName <span>=</span> <span>StringUtils</span><span>.</span><span>substringBefore</span><span>(</span>invokeTarget<span>,</span> <span>\"(\"</span><span>)</span><span>;</span>\n        <span>return</span> <span>StringUtils</span><span>.</span><span>substringBeforeLast</span><span>(</span>beanName<span>,</span> <span>\".\"</span><span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>/**\n     * 获取bean方法\n     *\n     * <span>@param</span> <span>invokeTarget</span> 目标字符串\n     * <span>@return</span> method方法\n     */</span>\n    <span>public</span> <span>static</span> <span>String</span> <span>getMethodName</span><span>(</span><span>String</span> invokeTarget<span>)</span> <span>{</span>\n        <span>String</span> methodName <span>=</span> <span>StringUtils</span><span>.</span><span>substringBefore</span><span>(</span>invokeTarget<span>,</span> <span>\"(\"</span><span>)</span><span>;</span>\n        <span>return</span> <span>StringUtils</span><span>.</span><span>substringAfterLast</span><span>(</span>methodName<span>,</span> <span>\".\"</span><span>)</span><span>;</span>\n    <span>}</span>\n\n    <span>/**\n     * 获取method方法参数相关列表\n     *\n     * <span>@param</span> <span>invokeTarget</span> 目标字符串\n     * <span>@return</span> method方法相关参数列表\n     */</span>\n    <span>public</span> <span>static</span> <span>List</span><span>&lt;</span><span>Object</span><span>[</span><span>]</span><span>></span> <span>getMethodParams</span><span>(</span><span>String</span> invokeTarget<span>)</span> <span>{</span>\n        <span>String</span> methodStr <span>=</span> <span>StringUtils</span><span>.</span><span>substringBetween</span><span>(</span>invokeTarget<span>,</span> <span>\"(\"</span><span>,</span> <span>\")\"</span><span>)</span><span>;</span>\n        <span>if</span> <span>(</span><span>StringUtils</span><span>.</span><span>isEmpty</span><span>(</span>methodStr<span>)</span><span>)</span> <span>{</span>\n            <span>return</span> <span>null</span><span>;</span>\n        <span>}</span>\n        <span>String</span><span>[</span><span>]</span> methodParams <span>=</span> methodStr<span>.</span><span>split</span><span>(</span><span>\",\"</span><span>)</span><span>;</span>\n        <span>List</span><span>&lt;</span><span>Object</span><span>[</span><span>]</span><span>></span> classs <span>=</span> <span>new</span> <span>LinkedList</span><span><span>&lt;</span><span>></span></span><span>(</span><span>)</span><span>;</span>\n        <span>for</span> <span>(</span><span>int</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> methodParams<span>.</span>length<span>;</span> i<span>++</span><span>)</span> <span>{</span>\n            <span>String</span> str <span>=</span> <span>StringUtils</span><span>.</span><span>trimToEmpty</span><span>(</span>methodParams<span>[</span>i<span>]</span><span>)</span><span>;</span>\n            <span>// String字符串类型，包含'</span>\n            <span>if</span> <span>(</span><span>StringUtils</span><span>.</span><span>contains</span><span>(</span>str<span>,</span> <span>\"'\"</span><span>)</span><span>)</span> <span>{</span>\n                classs<span>.</span><span>add</span><span>(</span><span>new</span> <span>Object</span><span>[</span><span>]</span><span>{</span><span>StringUtils</span><span>.</span><span>replace</span><span>(</span>str<span>,</span> <span>\"'\"</span><span>,</span> <span>\"\"</span><span>)</span><span>,</span> <span>String</span><span>.</span><span>class</span><span>}</span><span>)</span><span>;</span>\n            <span>}</span>\n            <span>// boolean布尔类型，等于true或者false</span>\n            <span>else</span> <span>if</span> <span>(</span><span>StringUtils</span><span>.</span><span>equals</span><span>(</span>str<span>,</span> <span>\"true\"</span><span>)</span> <span>||</span> <span>StringUtils</span><span>.</span><span>equalsIgnoreCase</span><span>(</span>str<span>,</span> <span>\"false\"</span><span>)</span><span>)</span> <span>{</span>\n                classs<span>.</span><span>add</span><span>(</span><span>new</span> <span>Object</span><span>[</span><span>]</span><span>{</span><span>Boolean</span><span>.</span><span>valueOf</span><span>(</span>str<span>)</span><span>,</span> <span>Boolean</span><span>.</span><span>class</span><span>}</span><span>)</span><span>;</span>\n            <span>}</span>\n            <span>// long长整形，包含L</span>\n            <span>else</span> <span>if</span> <span>(</span><span>StringUtils</span><span>.</span><span>containsIgnoreCase</span><span>(</span>str<span>,</span> <span>\"L\"</span><span>)</span><span>)</span> <span>{</span>\n                classs<span>.</span><span>add</span><span>(</span><span>new</span> <span>Object</span><span>[</span><span>]</span><span>{</span><span>Long</span><span>.</span><span>valueOf</span><span>(</span><span>StringUtils</span><span>.</span><span>replaceIgnoreCase</span><span>(</span>str<span>,</span> <span>\"L\"</span><span>,</span> <span>\"\"</span><span>)</span><span>)</span><span>,</span> <span>Long</span><span>.</span><span>class</span><span>}</span><span>)</span><span>;</span>\n            <span>}</span>\n            <span>// double浮点类型，包含D</span>\n            <span>else</span> <span>if</span> <span>(</span><span>StringUtils</span><span>.</span><span>containsIgnoreCase</span><span>(</span>str<span>,</span> <span>\"D\"</span><span>)</span><span>)</span> <span>{</span>\n                classs<span>.</span><span>add</span><span>(</span><span>new</span> <span>Object</span><span>[</span><span>]</span><span>{</span><span>Double</span><span>.</span><span>valueOf</span><span>(</span><span>StringUtils</span><span>.</span><span>replaceIgnoreCase</span><span>(</span>str<span>,</span> <span>\"D\"</span><span>,</span> <span>\"\"</span><span>)</span><span>)</span><span>,</span> <span>Double</span><span>.</span><span>class</span><span>}</span><span>)</span><span>;</span>\n            <span>}</span>\n            <span>// 其他类型归类为整形</span>\n            <span>else</span> <span>{</span>\n                classs<span>.</span><span>add</span><span>(</span><span>new</span> <span>Object</span><span>[</span><span>]</span><span>{</span><span>Integer</span><span>.</span><span>valueOf</span><span>(</span>str<span>)</span><span>,</span> <span>Integer</span><span>.</span><span>class</span><span>}</span><span>)</span><span>;</span>\n            <span>}</span>\n        <span>}</span>\n        <span>return</span> classs<span>;</span>\n    <span>}</span>\n\n    <span>/**\n     * 获取参数类型\n     *\n     * <span>@param</span> <span>methodParams</span> 参数相关列表\n     * <span>@return</span> 参数类型列表\n     */</span>\n    <span>public</span> <span>static</span> <span>Class</span><span><span>&lt;</span><span>?</span><span>></span></span><span>[</span><span>]</span> <span>getMethodParamsType</span><span>(</span><span>List</span><span>&lt;</span><span>Object</span><span>[</span><span>]</span><span>></span> methodParams<span>)</span> <span>{</span>\n        <span>Class</span><span><span>&lt;</span><span>?</span><span>></span></span><span>[</span><span>]</span> classs <span>=</span> <span>new</span> <span>Class</span><span><span>&lt;</span><span>?</span><span>></span></span><span>[</span>methodParams<span>.</span><span>size</span><span>(</span><span>)</span><span>]</span><span>;</span>\n        <span>int</span> index <span>=</span> <span>0</span><span>;</span>\n        <span>for</span> <span>(</span><span>Object</span><span>[</span><span>]</span> os <span>:</span> methodParams<span>)</span> <span>{</span>\n            classs<span>[</span>index<span>]</span> <span>=</span> <span>(</span><span>Class</span><span><span>&lt;</span><span>?</span><span>></span></span><span>)</span> os<span>[</span><span>1</span><span>]</span><span>;</span>\n            index<span>++</span><span>;</span>\n        <span>}</span>\n        <span>return</span> classs<span>;</span>\n    <span>}</span>\n\n    <span>/**\n     * 获取参数值\n     *\n     * <span>@param</span> <span>methodParams</span> 参数相关列表\n     * <span>@return</span> 参数值列表\n     */</span>\n    <span>public</span> <span>static</span> <span>Object</span><span>[</span><span>]</span> <span>getMethodParamsValue</span><span>(</span><span>List</span><span>&lt;</span><span>Object</span><span>[</span><span>]</span><span>></span> methodParams<span>)</span> <span>{</span>\n        <span>Object</span><span>[</span><span>]</span> classs <span>=</span> <span>new</span> <span>Object</span><span>[</span>methodParams<span>.</span><span>size</span><span>(</span><span>)</span><span>]</span><span>;</span>\n        <span>int</span> index <span>=</span> <span>0</span><span>;</span>\n        <span>for</span> <span>(</span><span>Object</span><span>[</span><span>]</span> os <span>:</span> methodParams<span>)</span> <span>{</span>\n            classs<span>[</span>index<span>]</span> <span>=</span> <span>(</span><span>Object</span><span>)</span> os<span>[</span><span>0</span><span>]</span><span>;</span>\n            index<span>++</span><span>;</span>\n        <span>}</span>\n        <span>return</span> classs<span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>启动程序后可以看到，调度器已经启动：</p>\n<div><pre><code>2021-10-06 16:26:05.162  INFO 10764 --- [shivaScheduler]] o.s.s.quartz.SchedulerFactoryBean        : Starting Quartz Scheduler now, after delay of 1 seconds\n2021-10-06 16:26:05.306  INFO 10764 --- [shivaScheduler]] org.quartz.core.QuartzScheduler          : Scheduler shivaScheduler_$_DESKTOP-OKMJ1351633508761366 started.\n</code></pre><div aria-hidden=\"true\"><div></div><div></div></div></div><h2 id=\"_13新增调度任务\" tabindex=\"-1\"> 13新增调度任务</h2>\n<p>添加任务，使用如下 json 进行请求：</p>\n<div><pre><code><span>{</span>\n  <span>\"concurrent\"</span><span>:</span> <span>\"1\"</span><span>,</span>\n  <span>\"cronExpression\"</span><span>:</span> <span>\"0/10 * * * * ?\"</span><span>,</span>\n  <span>\"invokeTarget\"</span><span>:</span> <span>\"mysqlJob.execute('got it!!!')\"</span><span>,</span>\n  <span>\"jobGroup\"</span><span>:</span> <span>\"mysqlGroup\"</span><span>,</span>\n  <span>\"jobId\"</span><span>:</span> <span>9</span><span>,</span>\n  <span>\"jobName\"</span><span>:</span> <span>\"新增 mysqlJob 任务\"</span><span>,</span>\n  <span>\"misfirePolicy\"</span><span>:</span> <span>\"1\"</span><span>,</span>\n  <span>\"remark\"</span><span>:</span> <span>\"\"</span><span>,</span>\n  <span>\"status\"</span><span>:</span> <span>\"0\"</span>\n<span>}</span>\n<span>@Override</span>\n<span>@Transactional</span><span>(</span>rollbackFor <span>=</span> <span>Exception</span><span>.</span><span>class</span><span>)</span>\n<span>public</span> <span>int</span> <span>insertJob</span><span>(</span><span>QuartzJob</span> job<span>)</span> <span>throws</span> <span>Exception</span> <span>{</span>\n    <span>// 先将任务设置为暂停状态</span>\n    job<span>.</span><span>setStatus</span><span>(</span><span>ScheduleConstants<span>.</span>Status</span><span>.</span>PAUSE<span>.</span><span>getValue</span><span>(</span><span>)</span><span>)</span><span>;</span>\n    <span>int</span> rows <span>=</span> quartzMapper<span>.</span><span>insert</span><span>(</span>job<span>)</span><span>;</span>\n    <span>if</span> <span>(</span>rows <span>></span> <span>0</span><span>)</span> <span>{</span>\n        <span>ScheduleUtils</span><span>.</span><span>createScheduleJob</span><span>(</span>scheduler<span>,</span> job<span>)</span><span>;</span>\n    <span>}</span>\n    <span>return</span> rows<span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>先将任务设置为暂停状态，数据库插入成功后，在调度器创建任务。</p>\n<p>再手动启动任务，根据 ID 来启动任务：</p>\n<p><img src=\"http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535411548296.png\" alt=\"图片\"></p>\n<p>实现代码：</p>\n<div><pre><code><span>@Override</span>\n    <span>public</span> <span>int</span> <span>changeStatus</span><span>(</span><span>Long</span> jobId<span>,</span> <span>String</span> status<span>)</span> <span>throws</span> <span>SchedulerException</span> <span>{</span>\n        <span>int</span> rows <span>=</span> quartzMapper<span>.</span><span>changeStatus</span><span>(</span>jobId<span>,</span> status<span>)</span><span>;</span>\n        <span>if</span> <span>(</span>rows <span>==</span> <span>0</span><span>)</span> <span>{</span>\n            <span>return</span> rows<span>;</span>\n        <span>}</span>\n        <span>//更新成功，需要改调度器内任务的状态</span>\n        <span>//拿到整个任务</span>\n        <span>QuartzJob</span> job <span>=</span> quartzMapper<span>.</span><span>selectJobById</span><span>(</span>jobId<span>)</span><span>;</span>\n        <span>//根据状态来启动或者关闭</span>\n        <span>if</span> <span>(</span><span>ScheduleConstants<span>.</span>Status</span><span>.</span>NORMAL<span>.</span><span>getValue</span><span>(</span><span>)</span><span>.</span><span>equals</span><span>(</span>status<span>)</span><span>)</span> <span>{</span>\n            rows <span>=</span> <span>resumeJob</span><span>(</span>job<span>)</span><span>;</span>\n        <span>}</span> <span>else</span> <span>if</span> <span>(</span><span>ScheduleConstants<span>.</span>Status</span><span>.</span>PAUSE<span>.</span><span>getValue</span><span>(</span><span>)</span><span>.</span><span>equals</span><span>(</span>status<span>)</span><span>)</span> <span>{</span>\n            rows <span>=</span> <span>pauseJob</span><span>(</span>job<span>)</span><span>;</span>\n        <span>}</span>\n        <span>return</span> rows<span>;</span>\n    <span>}</span>\n<span>@Override</span>\n<span>public</span> <span>int</span> <span>resumeJob</span><span>(</span><span>QuartzJob</span> job<span>)</span> <span>throws</span> <span>SchedulerException</span> <span>{</span>\n    <span>Long</span> jobId <span>=</span> job<span>.</span><span>getJobId</span><span>(</span><span>)</span><span>;</span>\n    <span>String</span> jobGroup <span>=</span> job<span>.</span><span>getJobGroup</span><span>(</span><span>)</span><span>;</span>\n    job<span>.</span><span>setStatus</span><span>(</span><span>ScheduleConstants<span>.</span>Status</span><span>.</span>NORMAL<span>.</span><span>getValue</span><span>(</span><span>)</span><span>)</span><span>;</span>\n    <span>int</span> rows <span>=</span> quartzMapper<span>.</span><span>updateById</span><span>(</span>job<span>)</span><span>;</span>\n    <span>if</span> <span>(</span>rows <span>></span> <span>0</span><span>)</span> <span>{</span>\n        scheduler<span>.</span><span>resumeJob</span><span>(</span><span>ScheduleUtils</span><span>.</span><span>getJobKey</span><span>(</span>jobId<span>,</span> jobGroup<span>)</span><span>)</span><span>;</span>\n    <span>}</span>\n    <span>return</span> rows<span>;</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><p>暂停任务的代码也相同。</p>\n<p>调用启动后可以看到控制台打印日志：</p>\n<div><pre><code>2021-10-06 20:36:30.018  INFO 8536 --- [eduler_Worker-3] cn.shiva.quartz.job.MysqlJob             : 执行 Mysql Job，当前时间：2021-10-06 20:36:30，任务参数：got it!!!\n2021-10-06 20:36:40.016  INFO 8536 --- [eduler_Worker-4] cn.shiva.quartz.job.MysqlJob             : 执行 Mysql Job，当前时间：2021-10-06 20:36:40，任务参数：got it!!!\n2021-10-06 20:36:50.017  INFO 8536 --- [eduler_Worker-5] cn.shiva.quartz.job.MysqlJob             : 执行 Mysql Job，当前时间：2021-10-06 20:36:50，任务参数：got it!!!\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div></div></div><p>如果涉及到任务修改，需要在调度器先删除原有任务，重新创建调度任务。</p>\n<h3 id=\"启动初始化任务\" tabindex=\"-1\"> 启动初始化任务</h3>\n<p>这部分倒是比较简单，初始化的时候清空原有任务，重新创建就好了：</p>\n<div><pre><code><span>/**\n  * 项目启动时，初始化定时器 主要是防止手动修改数据库导致未同步到定时任务处理（注：不能手动修改数据库ID和任务组名，否则会导致脏数据）\n  */</span>\n<span>@PostConstruct</span>\n<span>public</span> <span>void</span> <span>init</span><span>(</span><span>)</span> <span>throws</span> <span>Exception</span> <span>{</span>\n    scheduler<span>.</span><span>clear</span><span>(</span><span>)</span><span>;</span>\n    <span>List</span><span><span>&lt;</span><span>QuartzJob</span><span>></span></span> jobList <span>=</span> quartzMapper<span>.</span><span>selectJobAll</span><span>(</span><span>)</span><span>;</span>\n    <span>for</span> <span>(</span><span>QuartzJob</span> job <span>:</span> jobList<span>)</span> <span>{</span>\n        <span>ScheduleUtils</span><span>.</span><span>createScheduleJob</span><span>(</span>scheduler<span>,</span> job<span>)</span><span>;</span>\n    <span>}</span>\n<span>}</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div><h2 id=\"_14其他说明\" tabindex=\"-1\"> 14其他说明</h2>\n<h3 id=\"并发执行\" tabindex=\"-1\"> 并发执行</h3>\n<p>上面有并发和非并发的区别，通过 <code>@DisallowConcurrentExecution</code> 注解来实现阻止并发。</p>\n<p>Quartz定时任务默认都是并发执行的，不会等待上一次任务执行完毕，只要间隔时间到就会执行, 如果定时任执行太长，会长时间占用资源，导致其它任务堵塞。</p>\n<p><code>@DisallowConcurrentExecution</code> 禁止并发执行多个相同定义的JobDetail, 这个注解是加在Job类上的, 但意思并不是不能同时执行多个Job, 而是不能并发执行同一个<code>Job Definition</code>(由JobDetail定义), 但是可以同时执行多个不同的JobDetail。</p>\n<p>举例说明，我们有一个Job类,叫做SayHelloJob, 并在这个Job上加了这个注解, 然后在这个Job上定义了很多个<code>JobDetail</code>, <code>如sayHelloToJoeJobDetail</code>, <code>sayHelloToMikeJobDetail</code>, 那么当scheduler启动时, 不会并发执行多个<code>sayHelloToJoeJobDetail</code>或者<code>sayHelloToMikeJobDetail</code>, 但可以同时执行<code>sayHelloToJoeJobDetail</code>跟<code>sayHelloToMikeJobDetail</code></p>\n<p><code>@PersistJobDataAfterExecution</code> 同样, 也是加在Job上。表示当正常执行完Job后, JobDataMap中的数据应该被改动, 以被下一次调用时用。</p>\n<p>当使用 <code>@PersistJobDataAfterExecution</code> 注解时, 为了避免并发时, 存储数据造成混乱, 强烈建议把 <code>@DisallowConcurrentExecution</code> 注解也加上。</p>\n<p>测试代码，设定的时间间隔为3秒,但job执行时间是5秒,设置 <code>@DisallowConcurrentExecution</code>以 后程序会等任务执行完毕以后再去执行,否则会在3秒时再启用新的线程执行。</p>\n<h3 id=\"阻止特定时间运行\" tabindex=\"-1\"> 阻止特定时间运行</h3>\n<p>仍然是通过调度器实现的：</p>\n<div><pre><code><span>//2014-8-15这一天不执行任何任务</span>\n<span>Calendar</span> c <span>=</span> <span>new</span> <span>GregorianCalendar</span><span>(</span><span>2014</span><span>,</span> <span>7</span><span>,</span> <span>15</span><span>)</span><span>;</span>\ncal<span>.</span><span>setDayExcluded</span><span>(</span>c<span>,</span> <span>true</span><span>)</span><span>;</span>\nscheduler<span>.</span><span>addCalendar</span><span>(</span><span>\"exclude\"</span><span>,</span> cal<span>,</span> <span>false</span><span>,</span> <span>false</span><span>)</span><span>;</span>\n\n<span>//...中间省略</span>\n<span>TriggerBuilder</span><span>.</span><span>newTrigger</span><span>(</span><span>)</span><span>.</span><span>modifiedByCalendar</span><span>(</span><span>\"exclude\"</span><span>)</span><span>.</span><span>.</span><span>.</span><span>.</span>\n</code></pre><div aria-hidden=\"true\"><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div></div>",
      "image": "http://alist.ciberviler.top/d/ecloud180/images/blogImage/640-16535411548287.png",
      "date_published": "2022-06-01T00:00:00.000Z",
      "date_modified": "2022-05-26T05:05:28.000Z",
      "authors": [
        {
          "name": "xlc520"
        }
      ],
      "tags": [
        "Java"
      ]
    }
  ]
}