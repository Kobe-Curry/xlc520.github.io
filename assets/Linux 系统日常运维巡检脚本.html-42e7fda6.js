const s=JSON.parse(`{"key":"v-0586aedb","path":"/linux/Linux%20%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%B8%B8%E8%BF%90%E7%BB%B4%E5%B7%A1%E6%A3%80%E8%84%9A%E6%9C%AC.html","title":"Linux 系统日常运维巡检脚本","lang":"zh-CN","frontmatter":{"author":"xlc520","title":"Linux 系统日常运维巡检脚本","description":"Linux 系统日常运维巡检脚本 Linux 系统日常巡检脚本，巡检内容包含了，磁盘，内存 cpu 进程 文件更改 用户登录等一系列的操作 直接用就行了。 报告以邮件发送到邮箱 在log下生成巡检报告。 #!/bin/bash #主机信息每日巡检 IPADDR=$(ifconfig eth0|grep 'inet addr'|awk -F '[ :]' '{print $13}') #环境变量PATH没设好，在cron里执行时有很多命令会找不到 export PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin source /etc/profile [ $(id -u) -gt 0 ] &amp;&amp; echo \\"请用root用户执行此脚本！\\" &amp;&amp; exit 1 centosVersion=$(awk '{print $(NF-1)}' /etc/redhat-release) VERSION=\\"2020-03-16\\" #日志相关 PROGPATH=\`echo $0 | sed -e 's,[\\\\\\\\/][^\\\\\\\\/][^\\\\\\\\/]*$,,'\` [ -f $PROGPATH ] &amp;&amp; PROGPATH=\\".\\" LOGPATH=\\"$PROGPATH/log\\" [ -e $LOGPATH ] || mkdir $LOGPATH RESULTFILE=\\"$LOGPATH/HostDailyCheck-$IPADDR-\`date +%Y%m%d\`.txt\\" #定义报表的全局变量 report_DateTime=\\"\\" #日期 ok report_Hostname=\\"\\" #主机名 ok report_OSRelease=\\"\\" #发行版本 ok report_Kernel=\\"\\" #内核 ok report_Language=\\"\\" #语言/编码 ok report_LastReboot=\\"\\" #最近启动时间 ok report_Uptime=\\"\\" #运行时间（天） ok report_CPUs=\\"\\" #CPU数量 ok report_CPUType=\\"\\" #CPU类型 ok report_Arch=\\"\\" #CPU架构 ok report_MemTotal=\\"\\" #内存总容量(MB) ok report_MemFree=\\"\\" #内存剩余(MB) ok report_MemUsedPercent=\\"\\" #内存使用率% ok report_DiskTotal=\\"\\" #硬盘总容量(GB) ok report_DiskFree=\\"\\" #硬盘剩余(GB) ok report_DiskUsedPercent=\\"\\" #硬盘使用率% ok report_InodeTotal=\\"\\" #Inode总量 ok report_InodeFree=\\"\\" #Inode剩余 ok report_InodeUsedPercent=\\"\\" #Inode使用率 ok report_IP=\\"\\" #IP地址 ok report_MAC=\\"\\" #MAC地址 ok report_Gateway=\\"\\" #默认网关 ok report_DNS=\\"\\" #DNS ok report_Listen=\\"\\" #监听 ok report_Selinux=\\"\\" #Selinux ok report_Firewall=\\"\\" #防火墙 ok report_USERs=\\"\\" #用户 ok report_USEREmptyPassword=\\"\\" #空密码用户 ok report_USERTheSameUID=\\"\\" #相同ID的用户 ok report_PasswordExpiry=\\"\\" #密码过期（天） ok report_RootUser=\\"\\" #root用户 ok report_Sudoers=\\"\\" #sudo授权 ok report_SSHAuthorized=\\"\\" #SSH信任主机 ok report_SSHDProtocolVersion=\\"\\" #SSH协议版本 ok report_SSHDPermitRootLogin=\\"\\" #允许root远程登录 ok report_DefunctProsess=\\"\\" #僵尸进程数量 ok report_SelfInitiatedService=\\"\\" #自启动服务数量 ok report_SelfInitiatedProgram=\\"\\" #自启动程序数量 ok report_RuningService=\\"\\" #运行中服务数 ok report_Crontab=\\"\\" #计划任务数 ok report_Syslog=\\"\\" #日志服务 ok report_SNMP=\\"\\" #SNMP OK report_NTP=\\"\\" #NTP ok report_JDK=\\"\\" #JDK版本 ok function version(){ echo \\"\\" echo \\"\\" echo \\"系统巡检脚本：Version $VERSION\\" } function getCpuStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ CPU检查 #############################\\" Physical_CPUs=$(grep \\"physical id\\" /proc/cpuinfo| sort | uniq | wc -l) Virt_CPUs=$(grep \\"processor\\" /proc/cpuinfo | wc -l) CPU_Kernels=$(grep \\"cores\\" /proc/cpuinfo|uniq| awk -F ': ' '{print $2}') CPU_Type=$(grep \\"model name\\" /proc/cpuinfo | awk -F ': ' '{print $2}' | sort | uniq) CPU_Arch=$(uname -m) echo \\"物理CPU个数:$Physical_CPUs\\" echo \\"逻辑CPU个数:$Virt_CPUs\\" echo \\"每CPU核心数:$CPU_Kernels\\" echo \\" CPU型号:$CPU_Type\\" echo \\" CPU架构:$CPU_Arch\\" #报表信息 report_CPUs=$Virt_CPUs #CPU数量 report_CPUType=$CPU_Type #CPU类型 report_Arch=$CPU_Arch #CPU架构 } function getMemStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 内存检查 ############################\\" if [[ $centosVersion &lt; 7 ]];then free -mo else free -h fi #报表信息 MemTotal=$(grep MemTotal /proc/meminfo| awk '{print $2}') #KB MemFree=$(grep MemFree /proc/meminfo| awk '{print $2}') #KB let MemUsed=MemTotal-MemFree MemPercent=$(awk \\"BEGIN {if($MemTotal==0){printf 100}else{printf \\\\\\"%.2f\\\\\\",$MemUsed*100/$MemTotal}}\\") report_MemTotal=\\"$((MemTotal/1024))\\"\\"MB\\" #内存总容量(MB) report_MemFree=\\"$((MemFree/1024))\\"\\"MB\\" #内存剩余(MB) report_MemUsedPercent=\\"$(awk \\"BEGIN {if($MemTotal==0){printf 100}else{printf \\\\\\"%.2f\\\\\\",$MemUsed*100/$MemTotal}}\\")\\"\\"%\\" #内存使用率% } function getDiskStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 磁盘检查 ############################\\" df -hiP | sed 's/Mounted on/Mounted/'&gt; /tmp/inode df -hTP | sed 's/Mounted on/Mounted/'&gt; /tmp/disk join /tmp/disk /tmp/inode | awk '{print $1,$2,\\"|\\",$3,$4,$5,$6,\\"|\\",$8,$9,$10,$11,\\"|\\",$12}'| column -t #报表信息 diskdata=$(df -TP | sed '1d' | awk '$2!=\\"tmpfs\\"{print}') #KB disktotal=$(echo \\"$diskdata\\" | awk '{total+=$3}END{print total}') #KB diskused=$(echo \\"$diskdata\\" | awk '{total+=$4}END{print total}') #KB diskfree=$((disktotal-diskused)) #KB diskusedpercent=$(echo $disktotal $diskused | awk '{if($1==0){printf 100}else{printf \\"%.2f\\",$2*100/$1}}') inodedata=$(df -iTP | sed '1d' | awk '$2!=\\"tmpfs\\"{print}') inodetotal=$(echo \\"$inodedata\\" | awk '{total+=$3}END{print total}') inodeused=$(echo \\"$inodedata\\" | awk '{total+=$4}END{print total}') inodefree=$((inodetotal-inodeused)) inodeusedpercent=$(echo $inodetotal $inodeused | awk '{if($1==0){printf 100}else{printf \\"%.2f\\",$2*100/$1}}') report_DiskTotal=$((disktotal/1024/1024))\\"GB\\" #硬盘总容量(GB) report_DiskFree=$((diskfree/1024/1024))\\"GB\\" #硬盘剩余(GB) report_DiskUsedPercent=\\"$diskusedpercent\\"\\"%\\" #硬盘使用率% report_InodeTotal=$((inodetotal/1000))\\"K\\" #Inode总量 report_InodeFree=$((inodefree/1000))\\"K\\" #Inode剩余 report_InodeUsedPercent=\\"$inodeusedpercent\\"\\"%\\" #Inode使用率% } function getSystemStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 系统检查 ############################\\" if [ -e /etc/sysconfig/i18n ];then default_LANG=\\"$(grep \\"LANG=\\" /etc/sysconfig/i18n | grep -v \\"^#\\" | awk -F '\\"' '{print $2}')\\" else default_LANG=$LANG fi export LANG=\\"en_US.UTF-8\\" Release=$(cat /etc/redhat-release 2&gt;/dev/null) Kernel=$(uname -r) OS=$(uname -o) Hostname=$(uname -n) SELinux=$(/usr/sbin/sestatus | grep \\"SELinux status: \\" | awk '{print $3}') LastReboot=$(who -b | awk '{print $3,$4}') uptime=$(uptime | sed 's/.*up \\\\([^,]*\\\\), .*/\\\\1/') echo \\" 系统：$OS\\" echo \\" 发行版本：$Release\\" echo \\" 内核：$Kernel\\" echo \\" 主机名：$Hostname\\" echo \\" SELinux：$SELinux\\" echo \\"语言/编码：$default_LANG\\" echo \\" 当前时间：$(date +'%F %T')\\" echo \\" 最后启动：$LastReboot\\" echo \\" 运行时间：$uptime\\" #报表信息 report_DateTime=$(date +\\"%F %T\\") #日期 report_Hostname=\\"$Hostname\\" #主机名 report_OSRelease=\\"$Release\\" #发行版本 report_Kernel=\\"$Kernel\\" #内核 report_Language=\\"$default_LANG\\" #语言/编码 report_LastReboot=\\"$LastReboot\\" #最近启动时间 report_Uptime=\\"$uptime\\" #运行时间（天） report_Selinux=\\"$SELinux\\" export LANG=\\"$default_LANG\\" } function getServiceStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 服务检查 ############################\\" echo \\"\\" if [[ $centosVersion &gt; 7 ]];then conf=$(systemctl list-unit-files --type=service --state=enabled --no-pager | grep \\"enabled\\") process=$(systemctl list-units --type=service --state=running --no-pager | grep \\".service\\") #报表信息 report_SelfInitiatedService=\\"$(echo \\"$conf\\" | wc -l)\\" #自启动服务数量 report_RuningService=\\"$(echo \\"$process\\" | wc -l)\\" #运行中服务数量 else conf=$(/sbin/chkconfig | grep -E \\":on|:启用\\") process=$(/sbin/service --status-all 2&gt;/dev/null | grep -E \\"is running|正在运行\\") #报表信息 report_SelfInitiatedService=\\"$(echo \\"$conf\\" | wc -l)\\" #自启动服务数量 report_RuningService=\\"$(echo \\"$process\\" | wc -l)\\" #运行中服务数量 fi echo \\"服务配置\\" echo \\"--------\\" echo \\"$conf\\" | column -t echo \\"\\" echo \\"正在运行的服务\\" echo \\"--------------\\" echo \\"$process\\" } function getAutoStartStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 自启动检查 ##########################\\" conf=$(grep -v \\"^#\\" /etc/rc.d/rc.local| sed '/^$/d') echo \\"$conf\\" #报表信息 report_SelfInitiatedProgram=\\"$(echo $conf | wc -l)\\" #自启动程序数量 } function getLoginStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 登录检查 ############################\\" last | head } function getNetworkStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 网络检查 ############################\\" if [[ $centosVersion &lt; 7 ]];then /sbin/ifconfig -a | grep -v packets | grep -v collisions | grep -v inet6 else #ip a for i in $(ip link | grep BROADCAST | awk -F: '{print $2}');do ip add show $i | grep -E \\"BROADCAST|global\\"| awk '{print $2}' | tr '\\\\n' ' ' ;echo \\"\\" ;done fi GATEWAY=$(ip route | grep default | awk '{print $3}') DNS=$(grep nameserver /etc/resolv.conf| grep -v \\"#\\" | awk '{print $2}' | tr '\\\\n' ',' | sed 's/,$//') echo \\"\\" echo \\"网关：$GATEWAY \\" echo \\" DNS：$DNS\\" #报表信息 IP=$(ip -f inet addr | grep -v 127.0.0.1 | grep inet | awk '{print $NF,$2}' | tr '\\\\n' ',' | sed 's/,$//') MAC=$(ip link | grep -v \\"LOOPBACK\\\\|loopback\\" | awk '{print $2}' | sed 'N;s/\\\\n//' | tr '\\\\n' ',' | sed 's/,$//') report_IP=\\"$IP\\" #IP地址 report_MAC=$MAC #MAC地址 report_Gateway=\\"$GATEWAY\\" #默认网关 report_DNS=\\"$DNS\\" #DNS } function getListenStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 监听检查 ############################\\" TCPListen=$(ss -ntul | column -t) echo \\"$TCPListen\\" #报表信息 report_Listen=\\"$(echo \\"$TCPListen\\"| sed '1d' | awk '/tcp/ {print $5}' | awk -F: '{print $NF}' | sort | uniq | wc -l)\\" } function getCronStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 计划任务检查 ########################\\" Crontab=0 for shell in $(grep -v \\"/sbin/nologin\\" /etc/shells);do for user in $(grep \\"$shell\\" /etc/passwd| awk -F: '{print $1}');do crontab -l -u $user &gt;/dev/null 2&gt;&amp;1 status=$? if [ $status -eq 0 ];then echo \\"$user\\" echo \\"--------\\" crontab -l -u $user let Crontab=Crontab+$(crontab -l -u $user | wc -l) echo \\"\\" fi done done #计划任务 find /etc/cron* -type f | xargs -i ls -l {} | column -t let Crontab=Crontab+$(find /etc/cron* -type f | wc -l) #报表信息 report_Crontab=\\"$Crontab\\" #计划任务数 } function getHowLongAgo(){ # 计算一个时间戳离现在有多久了 datetime=\\"$*\\" [ -z \\"$datetime\\" ] &amp;&amp; echo \\"错误的参数：getHowLongAgo() $*\\" Timestamp=$(date +%s -d \\"$datetime\\") #转化为时间戳 Now_Timestamp=$(date +%s) Difference_Timestamp=$(($Now_Timestamp-$Timestamp)) days=0;hours=0;minutes=0; sec_in_day=$((60*60*24)); sec_in_hour=$((60*60)); sec_in_minute=60 while (( $(($Difference_Timestamp-$sec_in_day)) &gt; 1 )) do let Difference_Timestamp=Difference_Timestamp-sec_in_day let days++ done while (( $(($Difference_Timestamp-$sec_in_hour)) &gt; 1 )) do let Difference_Timestamp=Difference_Timestamp-sec_in_hour let hours++ done echo \\"$days 天 $hours 小时前\\" } function getUserLastLogin(){ # 获取用户最近一次登录的时间，含年份 # 很遗憾last命令不支持显示年份，只有\\"last -t YYYYMMDDHHMMSS\\"表示某个时间之间的登录，我 # 们只能用最笨的方法了，对比今天之前和今年元旦之前（或者去年之前和前年之前……）某个用户 # 登录次数，如果登录统计次数有变化，则说明最近一次登录是今年。 username=$1 : \${username:=\\"\`whoami\`\\"} thisYear=$(date +%Y) oldesYear=$(last | tail -n1 | awk '{print $NF}') while(( $thisYear &gt;= $oldesYear));do loginBeforeToday=$(last $username | grep $username | wc -l) loginBeforeNewYearsDayOfThisYear=$(last $username -t $thisYear\\"0101000000\\" | grep $username | wc -l) if [ $loginBeforeToday -eq 0 ];then echo \\"从未登录过\\" break elif [ $loginBeforeToday -gt $loginBeforeNewYearsDayOfThisYear ];then lastDateTime=$(last -i $username | head -n1 | awk '{for(i=4;i&lt;(NF-2);i++)printf\\"%s \\",$i}')\\" $thisYear\\" #格式如: Sat Nov 2 20:33 2015 lastDateTime=$(date \\"+%Y-%m-%d %H:%M:%S\\" -d \\"$lastDateTime\\") echo \\"$lastDateTime\\" break else thisYear=$((thisYear-1)) fi done } function getUserStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 用户检查 ############################\\" #/etc/passwd 最后修改时间 pwdfile=\\"$(cat /etc/passwd)\\" Modify=$(stat /etc/passwd | grep Modify | tr '.' ' ' | awk '{print $2,$3}') echo \\"/etc/passwd 最后修改时间：$Modify ($(getHowLongAgo $Modify))\\" echo \\"\\" echo \\"特权用户\\" echo \\"--------\\" RootUser=\\"\\" for user in $(echo \\"$pwdfile\\" | awk -F: '{print $1}');do if [ $(id -u $user) -eq 0 ];then echo \\"$user\\" RootUser=\\"$RootUser,$user\\" fi done echo \\"\\" echo \\"用户列表\\" echo \\"--------\\" USERs=0 echo \\"$( echo \\"用户名 UID GID HOME SHELL 最后一次登录\\" for shell in $(grep -v \\"/sbin/nologin\\" /etc/shells);do for username in $(grep \\"$shell\\" /etc/passwd| awk -F: '{print $1}');do userLastLogin=\\"$(getUserLastLogin $username)\\" echo \\"$pwdfile\\" | grep -w \\"$username\\" |grep -w \\"$shell\\"| awk -F: -v lastlogin=\\"$(echo \\"$userLastLogin\\" | tr ' ' '_')\\" '{print $1,$3,$4,$6,$7,lastlogin}' done let USERs=USERs+$(echo \\"$pwdfile\\" | grep \\"$shell\\"| wc -l) done )\\" | column -t echo \\"\\" echo \\"空密码用户\\" echo \\"----------\\" USEREmptyPassword=\\"\\" for shell in $(grep -v \\"/sbin/nologin\\" /etc/shells);do for user in $(echo \\"$pwdfile\\" | grep \\"$shell\\" | cut -d: -f1);do r=$(awk -F: '$2==\\"!!\\"{print $1}' /etc/shadow | grep -w $user) if [ ! -z $r ];then echo $r USEREmptyPassword=\\"$USEREmptyPassword,\\"$r fi done done echo \\"\\" echo \\"相同ID的用户\\" echo \\"------------\\" USERTheSameUID=\\"\\" UIDs=$(cut -d: -f3 /etc/passwd | sort | uniq -c | awk '$1&gt;1{print $2}') for uid in $UIDs;do echo -n \\"$uid\\"; USERTheSameUID=\\"$uid\\" r=$(awk -F: 'ORS=\\"\\";$3=='\\"$uid\\"'{print \\":\\",$1}' /etc/passwd) echo \\"$r\\" echo \\"\\" USERTheSameUID=\\"$USERTheSameUID $r,\\" done #报表信息 report_USERs=\\"$USERs\\" #用户 report_USEREmptyPassword=$(echo $USEREmptyPassword | sed 's/^,//') report_USERTheSameUID=$(echo $USERTheSameUID | sed 's/,$//') report_RootUser=$(echo $RootUser | sed 's/^,//') #特权用户 } function getPasswordStatus { echo \\"\\" echo \\"\\" echo \\"############################ 密码检查 ############################\\" pwdfile=\\"$(cat /etc/passwd)\\" echo \\"\\" echo \\"密码过期检查\\" echo \\"------------\\" result=\\"\\" for shell in $(grep -v \\"/sbin/nologin\\" /etc/shells);do for user in $(echo \\"$pwdfile\\" | grep \\"$shell\\" | cut -d: -f1);do get_expiry_date=$(/usr/bin/chage -l $user | grep 'Password expires' | cut -d: -f2) if [[ $get_expiry_date = ' never' || $get_expiry_date = 'never' ]];then printf \\"%-15s 永不过期\\\\n\\" $user result=\\"$result,$user:never\\" else password_expiry_date=$(date -d \\"$get_expiry_date\\" \\"+%s\\") current_date=$(date \\"+%s\\") diff=$(($password_expiry_date-$current_date)) let DAYS=$(($diff/(60*60*24))) printf \\"%-15s %s天后过期\\\\n\\" $user $DAYS result=\\"$result,$user:$DAYS days\\" fi done done report_PasswordExpiry=$(echo $result | sed 's/^,//') echo \\"\\" echo \\"密码策略检查\\" echo \\"------------\\" grep -v \\"#\\" /etc/login.defs | grep -E \\"PASS_MAX_DAYS|PASS_MIN_DAYS|PASS_MIN_LEN|PASS_WARN_AGE\\" } function getSudoersStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ Sudoers检查 #########################\\" conf=$(grep -v \\"^#\\" /etc/sudoers| grep -v \\"^Defaults\\" | sed '/^$/d') echo \\"$conf\\" echo \\"\\" #报表信息 report_Sudoers=\\"$(echo $conf | wc -l)\\" } function getInstalledStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 软件检查 ############################\\" rpm -qa --last | head | column -t } function getProcessStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 进程检查 ############################\\" if [ $(ps -ef | grep defunct | grep -v grep | wc -l) -ge 1 ];then echo \\"\\" echo \\"僵尸进程\\"; echo \\"--------\\" ps -ef | head -n1 ps -ef | grep defunct | grep -v grep fi echo \\"\\" echo \\"内存占用TOP10\\" echo \\"-------------\\" echo -e \\"PID %MEM RSS COMMAND $(ps aux | awk '{print $2, $4, $6, $11}' | sort -k3rn | head -n 10 )\\"| column -t echo \\"\\" echo \\"CPU占用TOP10\\" echo \\"------------\\" top b -n1 | head -17 | tail -11 #报表信息 report_DefunctProsess=\\"$(ps -ef | grep defunct | grep -v grep|wc -l)\\" } function getJDKStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ JDK检查 #############################\\" java -version 2&gt;/dev/null if [ $? -eq 0 ];then java -version 2&gt;&amp;1 fi echo \\"JAVA_HOME=\\\\\\"$JAVA_HOME\\\\\\"\\" #报表信息 report_JDK=\\"$(java -version 2&gt;&amp;1 | grep version | awk '{print $1,$3}' | tr -d '\\"')\\" } function getSyslogStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ syslog检查 ##########################\\" echo \\"服务状态：$(getState rsyslog)\\" echo \\"\\" echo \\"/etc/rsyslog.conf\\" echo \\"-----------------\\" cat /etc/rsyslog.conf 2&gt;/dev/null | grep -v \\"^#\\" | grep -v \\"^\\\\\\\\$\\" | sed '/^$/d' | column -t #报表信息 report_Syslog=\\"$(getState rsyslog)\\" } function getFirewallStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 防火墙检查 ##########################\\" #防火墙状态，策略等 if [[ $centosVersion &lt; 7 ]];then /etc/init.d/iptables status &gt;/dev/null 2&gt;&amp;1 status=$? if [ $status -eq 0 ];then s=\\"active\\" elif [ $status -eq 3 ];then s=\\"inactive\\" elif [ $status -eq 4 ];then s=\\"permission denied\\" else s=\\"unknown\\" fi else s=\\"$(getState iptables)\\" fi echo \\"iptables: $s\\" echo \\"\\" echo \\"/etc/sysconfig/iptables\\" echo \\"-----------------------\\" cat /etc/sysconfig/iptables 2&gt;/dev/null #报表信息 report_Firewall=\\"$s\\" } function getSNMPStatus(){ #SNMP服务状态，配置等 echo \\"\\" echo \\"\\" echo \\"############################ SNMP检查 ############################\\" status=\\"$(getState snmpd)\\" echo \\"服务状态：$status\\" echo \\"\\" if [ -e /etc/snmp/snmpd.conf ];then echo \\"/etc/snmp/snmpd.conf\\" echo \\"--------------------\\" cat /etc/snmp/snmpd.conf 2&gt;/dev/null | grep -v \\"^#\\" | sed '/^$/d' fi #报表信息 report_SNMP=\\"$(getState snmpd)\\" } function getState(){ if [[ $centosVersion &lt; 7 ]];then if [ -e \\"/etc/init.d/$1\\" ];then if [ \`/etc/init.d/$1 status 2&gt;/dev/null | grep -E \\"is running|正在运行\\" | wc -l\` -ge 1 ];then r=\\"active\\" else r=\\"inactive\\" fi else r=\\"unknown\\" fi else #CentOS 7+ r=\\"$(systemctl is-active $1 2&gt;&amp;1)\\" fi echo \\"$r\\" } function getSSHStatus(){ #SSHD服务状态，配置,受信任主机等 echo \\"\\" echo \\"\\" echo \\"############################ SSH检查 #############################\\" #检查受信任主机 pwdfile=\\"$(cat /etc/passwd)\\" echo \\"服务状态：$(getState sshd)\\" Protocol_Version=$(cat /etc/ssh/sshd_config | grep Protocol | awk '{print $2}') echo \\"SSH协议版本：$Protocol_Version\\" echo \\"\\" echo \\"信任主机\\" echo \\"--------\\" authorized=0 for user in $(echo \\"$pwdfile\\" | grep /bin/bash | awk -F: '{print $1}');do authorize_file=$(echo \\"$pwdfile\\" | grep -w $user | awk -F: '{printf $6\\"/.ssh/authorized_keys\\"}') authorized_host=$(cat $authorize_file 2&gt;/dev/null | awk '{print $3}' | tr '\\\\n' ',' | sed 's/,$//') if [ ! -z $authorized_host ];then echo \\"$user 授权 \\\\\\"$authorized_host\\\\\\" 无密码访问\\" fi let authorized=authorized+$(cat $authorize_file 2&gt;/dev/null | awk '{print $3}'|wc -l) done echo \\"\\" echo \\"是否允许ROOT远程登录\\" echo \\"--------------------\\" config=$(cat /etc/ssh/sshd_config | grep PermitRootLogin) firstChar=\${config:0:1} if [ $firstChar == \\"#\\" ];then PermitRootLogin=\\"yes\\" #默认是允许ROOT远程登录的 else PermitRootLogin=$(echo $config | awk '{print $2}') fi echo \\"PermitRootLogin $PermitRootLogin\\" echo \\"\\" echo \\"/etc/ssh/sshd_config\\" echo \\"--------------------\\" cat /etc/ssh/sshd_config | grep -v \\"^#\\" | sed '/^$/d' #报表信息 report_SSHAuthorized=\\"$authorized\\" #SSH信任主机 report_SSHDProtocolVersion=\\"$Protocol_Version\\" #SSH协议版本 report_SSHDPermitRootLogin=\\"$PermitRootLogin\\" #允许root远程登录 } function getNTPStatus(){ #NTP服务状态，当前时间，配置等 echo \\"\\" echo \\"\\" echo \\"############################ NTP检查 #############################\\" if [ -e /etc/ntp.conf ];then echo \\"服务状态：$(getState ntpd)\\" echo \\"\\" echo \\"/etc/ntp.conf\\" echo \\"-------------\\" cat /etc/ntp.conf 2&gt;/dev/null | grep -v \\"^#\\" | sed '/^$/d' fi #报表信息 report_NTP=\\"$(getState ntpd)\\" } function uploadHostDailyCheckReport(){ json=\\"{ \\\\\\"DateTime\\\\\\":\\\\\\"$report_DateTime\\\\\\", \\\\\\"Hostname\\\\\\":\\\\\\"$report_Hostname\\\\\\", \\\\\\"OSRelease\\\\\\":\\\\\\"$report_OSRelease\\\\\\", \\\\\\"Kernel\\\\\\":\\\\\\"$report_Kernel\\\\\\", \\\\\\"Language\\\\\\":\\\\\\"$report_Language\\\\\\", \\\\\\"LastReboot\\\\\\":\\\\\\"$report_LastReboot\\\\\\", \\\\\\"Uptime\\\\\\":\\\\\\"$report_Uptime\\\\\\", \\\\\\"CPUs\\\\\\":\\\\\\"$report_CPUs\\\\\\", \\\\\\"CPUType\\\\\\":\\\\\\"$report_CPUType\\\\\\", \\\\\\"Arch\\\\\\":\\\\\\"$report_Arch\\\\\\", \\\\\\"MemTotal\\\\\\":\\\\\\"$report_MemTotal\\\\\\", \\\\\\"MemFree\\\\\\":\\\\\\"$report_MemFree\\\\\\", \\\\\\"MemUsedPercent\\\\\\":\\\\\\"$report_MemUsedPercent\\\\\\", \\\\\\"DiskTotal\\\\\\":\\\\\\"$report_DiskTotal\\\\\\", \\\\\\"DiskFree\\\\\\":\\\\\\"$report_DiskFree\\\\\\", \\\\\\"DiskUsedPercent\\\\\\":\\\\\\"$report_DiskUsedPercent\\\\\\", \\\\\\"InodeTotal\\\\\\":\\\\\\"$report_InodeTotal\\\\\\", \\\\\\"InodeFree\\\\\\":\\\\\\"$report_InodeFree\\\\\\", \\\\\\"InodeUsedPercent\\\\\\":\\\\\\"$report_InodeUsedPercent\\\\\\", \\\\\\"IP\\\\\\":\\\\\\"$report_IP\\\\\\", \\\\\\"MAC\\\\\\":\\\\\\"$report_MAC\\\\\\", \\\\\\"Gateway\\\\\\":\\\\\\"$report_Gateway\\\\\\", \\\\\\"DNS\\\\\\":\\\\\\"$report_DNS\\\\\\", \\\\\\"Listen\\\\\\":\\\\\\"$report_Listen\\\\\\", \\\\\\"Selinux\\\\\\":\\\\\\"$report_Selinux\\\\\\", \\\\\\"Firewall\\\\\\":\\\\\\"$report_Firewall\\\\\\", \\\\\\"USERs\\\\\\":\\\\\\"$report_USERs\\\\\\", \\\\\\"USEREmptyPassword\\\\\\":\\\\\\"$report_USEREmptyPassword\\\\\\", \\\\\\"USERTheSameUID\\\\\\":\\\\\\"$report_USERTheSameUID\\\\\\", \\\\\\"PasswordExpiry\\\\\\":\\\\\\"$report_PasswordExpiry\\\\\\", \\\\\\"RootUser\\\\\\":\\\\\\"$report_RootUser\\\\\\", \\\\\\"Sudoers\\\\\\":\\\\\\"$report_Sudoers\\\\\\", \\\\\\"SSHAuthorized\\\\\\":\\\\\\"$report_SSHAuthorized\\\\\\", \\\\\\"SSHDProtocolVersion\\\\\\":\\\\\\"$report_SSHDProtocolVersion\\\\\\", \\\\\\"SSHDPermitRootLogin\\\\\\":\\\\\\"$report_SSHDPermitRootLogin\\\\\\", \\\\\\"DefunctProsess\\\\\\":\\\\\\"$report_DefunctProsess\\\\\\", \\\\\\"SelfInitiatedService\\\\\\":\\\\\\"$report_SelfInitiatedService\\\\\\", \\\\\\"SelfInitiatedProgram\\\\\\":\\\\\\"$report_SelfInitiatedProgram\\\\\\", \\\\\\"RuningService\\\\\\":\\\\\\"$report_RuningService\\\\\\", \\\\\\"Crontab\\\\\\":\\\\\\"$report_Crontab\\\\\\", \\\\\\"Syslog\\\\\\":\\\\\\"$report_Syslog\\\\\\", \\\\\\"SNMP\\\\\\":\\\\\\"$report_SNMP\\\\\\", \\\\\\"NTP\\\\\\":\\\\\\"$report_NTP\\\\\\", \\\\\\"JDK\\\\\\":\\\\\\"$report_JDK\\\\\\" }\\" #echo \\"$json\\" curl -l -H \\"Content-type: application/json\\" -X POST -d \\"$json\\" \\"$uploadHostDailyCheckReportApi\\" 2&gt;/dev/null } function getchage_file_24h() { echo \\"############################ 文件检查 #############################\\" check2=$(find / -name '*.sh' -mtime -1) check21=$(find / -name '*.asp' -mtime -1) check22=$(find / -name '*.php' -mtime -1) check23=$(find / -name '*.aspx' -mtime -1) check24=$(find / -name '*.jsp' -mtime -1) check25=$(find / -name '*.html' -mtime -1) check26=$(find / -name '*.htm' -mtime -1) check9=$(find / -name core -exec ls -l {} \\\\;) check10=$(cat /etc/crontab) check12=$(ls -alt /usr/bin | head -10) cat &lt;&lt;EOF ############################查看所有被修改过的文件返回最近24小时内的############################ \${check2} \${check21} \${check22} \${check23} \${check24} \${check25} \${check26} \${line} ############################检查定时文件的完整性############################ \${check10} \${line} ############################查看系统命令是否被替换############################ \${check12} \${line} EOF } function check(){ version getSystemStatus getCpuStatus getMemStatus getDiskStatus getNetworkStatus getListenStatus getProcessStatus getServiceStatus getAutoStartStatus getLoginStatus getCronStatus getUserStatus getPasswordStatus getSudoersStatus getJDKStatus getFirewallStatus getSSHStatus getSyslogStatus getSNMPStatus getNTPStatus getInstalledStatus getchage_file_24h } #执行检查并保存检查结果 check &gt; $RESULTFILE echo \\"检查结果：$RESULTFILE\\" echo -e \\"\`date \\"+%Y-%m-%d %H:%M:%S\\"\` 阿里云PHP企业平台巡检报告\\" | mail -a $RESULTFILE -s \\"阿里云PHP企业平台巡检报告\\" h@163.com END","date":"2023-01-22T00:00:00.000Z","category":["Linux"],"tag":["Linux"],"article":true,"timeline":true,"icon":"linux","password":null,"head":[["meta",{"property":"og:url","content":"https://blog.ciberviler.top/linux/Linux%20%E7%B3%BB%E7%BB%9F%E6%97%A5%E5%B8%B8%E8%BF%90%E7%BB%B4%E5%B7%A1%E6%A3%80%E8%84%9A%E6%9C%AC.html"}],["meta",{"property":"og:site_name","content":"StudyNote"}],["meta",{"property":"og:title","content":"Linux 系统日常运维巡检脚本"}],["meta",{"property":"og:description","content":"Linux 系统日常运维巡检脚本 Linux 系统日常巡检脚本，巡检内容包含了，磁盘，内存 cpu 进程 文件更改 用户登录等一系列的操作 直接用就行了。 报告以邮件发送到邮箱 在log下生成巡检报告。 #!/bin/bash #主机信息每日巡检 IPADDR=$(ifconfig eth0|grep 'inet addr'|awk -F '[ :]' '{print $13}') #环境变量PATH没设好，在cron里执行时有很多命令会找不到 export PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin source /etc/profile [ $(id -u) -gt 0 ] &amp;&amp; echo \\"请用root用户执行此脚本！\\" &amp;&amp; exit 1 centosVersion=$(awk '{print $(NF-1)}' /etc/redhat-release) VERSION=\\"2020-03-16\\" #日志相关 PROGPATH=\`echo $0 | sed -e 's,[\\\\\\\\/][^\\\\\\\\/][^\\\\\\\\/]*$,,'\` [ -f $PROGPATH ] &amp;&amp; PROGPATH=\\".\\" LOGPATH=\\"$PROGPATH/log\\" [ -e $LOGPATH ] || mkdir $LOGPATH RESULTFILE=\\"$LOGPATH/HostDailyCheck-$IPADDR-\`date +%Y%m%d\`.txt\\" #定义报表的全局变量 report_DateTime=\\"\\" #日期 ok report_Hostname=\\"\\" #主机名 ok report_OSRelease=\\"\\" #发行版本 ok report_Kernel=\\"\\" #内核 ok report_Language=\\"\\" #语言/编码 ok report_LastReboot=\\"\\" #最近启动时间 ok report_Uptime=\\"\\" #运行时间（天） ok report_CPUs=\\"\\" #CPU数量 ok report_CPUType=\\"\\" #CPU类型 ok report_Arch=\\"\\" #CPU架构 ok report_MemTotal=\\"\\" #内存总容量(MB) ok report_MemFree=\\"\\" #内存剩余(MB) ok report_MemUsedPercent=\\"\\" #内存使用率% ok report_DiskTotal=\\"\\" #硬盘总容量(GB) ok report_DiskFree=\\"\\" #硬盘剩余(GB) ok report_DiskUsedPercent=\\"\\" #硬盘使用率% ok report_InodeTotal=\\"\\" #Inode总量 ok report_InodeFree=\\"\\" #Inode剩余 ok report_InodeUsedPercent=\\"\\" #Inode使用率 ok report_IP=\\"\\" #IP地址 ok report_MAC=\\"\\" #MAC地址 ok report_Gateway=\\"\\" #默认网关 ok report_DNS=\\"\\" #DNS ok report_Listen=\\"\\" #监听 ok report_Selinux=\\"\\" #Selinux ok report_Firewall=\\"\\" #防火墙 ok report_USERs=\\"\\" #用户 ok report_USEREmptyPassword=\\"\\" #空密码用户 ok report_USERTheSameUID=\\"\\" #相同ID的用户 ok report_PasswordExpiry=\\"\\" #密码过期（天） ok report_RootUser=\\"\\" #root用户 ok report_Sudoers=\\"\\" #sudo授权 ok report_SSHAuthorized=\\"\\" #SSH信任主机 ok report_SSHDProtocolVersion=\\"\\" #SSH协议版本 ok report_SSHDPermitRootLogin=\\"\\" #允许root远程登录 ok report_DefunctProsess=\\"\\" #僵尸进程数量 ok report_SelfInitiatedService=\\"\\" #自启动服务数量 ok report_SelfInitiatedProgram=\\"\\" #自启动程序数量 ok report_RuningService=\\"\\" #运行中服务数 ok report_Crontab=\\"\\" #计划任务数 ok report_Syslog=\\"\\" #日志服务 ok report_SNMP=\\"\\" #SNMP OK report_NTP=\\"\\" #NTP ok report_JDK=\\"\\" #JDK版本 ok function version(){ echo \\"\\" echo \\"\\" echo \\"系统巡检脚本：Version $VERSION\\" } function getCpuStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ CPU检查 #############################\\" Physical_CPUs=$(grep \\"physical id\\" /proc/cpuinfo| sort | uniq | wc -l) Virt_CPUs=$(grep \\"processor\\" /proc/cpuinfo | wc -l) CPU_Kernels=$(grep \\"cores\\" /proc/cpuinfo|uniq| awk -F ': ' '{print $2}') CPU_Type=$(grep \\"model name\\" /proc/cpuinfo | awk -F ': ' '{print $2}' | sort | uniq) CPU_Arch=$(uname -m) echo \\"物理CPU个数:$Physical_CPUs\\" echo \\"逻辑CPU个数:$Virt_CPUs\\" echo \\"每CPU核心数:$CPU_Kernels\\" echo \\" CPU型号:$CPU_Type\\" echo \\" CPU架构:$CPU_Arch\\" #报表信息 report_CPUs=$Virt_CPUs #CPU数量 report_CPUType=$CPU_Type #CPU类型 report_Arch=$CPU_Arch #CPU架构 } function getMemStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 内存检查 ############################\\" if [[ $centosVersion &lt; 7 ]];then free -mo else free -h fi #报表信息 MemTotal=$(grep MemTotal /proc/meminfo| awk '{print $2}') #KB MemFree=$(grep MemFree /proc/meminfo| awk '{print $2}') #KB let MemUsed=MemTotal-MemFree MemPercent=$(awk \\"BEGIN {if($MemTotal==0){printf 100}else{printf \\\\\\"%.2f\\\\\\",$MemUsed*100/$MemTotal}}\\") report_MemTotal=\\"$((MemTotal/1024))\\"\\"MB\\" #内存总容量(MB) report_MemFree=\\"$((MemFree/1024))\\"\\"MB\\" #内存剩余(MB) report_MemUsedPercent=\\"$(awk \\"BEGIN {if($MemTotal==0){printf 100}else{printf \\\\\\"%.2f\\\\\\",$MemUsed*100/$MemTotal}}\\")\\"\\"%\\" #内存使用率% } function getDiskStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 磁盘检查 ############################\\" df -hiP | sed 's/Mounted on/Mounted/'&gt; /tmp/inode df -hTP | sed 's/Mounted on/Mounted/'&gt; /tmp/disk join /tmp/disk /tmp/inode | awk '{print $1,$2,\\"|\\",$3,$4,$5,$6,\\"|\\",$8,$9,$10,$11,\\"|\\",$12}'| column -t #报表信息 diskdata=$(df -TP | sed '1d' | awk '$2!=\\"tmpfs\\"{print}') #KB disktotal=$(echo \\"$diskdata\\" | awk '{total+=$3}END{print total}') #KB diskused=$(echo \\"$diskdata\\" | awk '{total+=$4}END{print total}') #KB diskfree=$((disktotal-diskused)) #KB diskusedpercent=$(echo $disktotal $diskused | awk '{if($1==0){printf 100}else{printf \\"%.2f\\",$2*100/$1}}') inodedata=$(df -iTP | sed '1d' | awk '$2!=\\"tmpfs\\"{print}') inodetotal=$(echo \\"$inodedata\\" | awk '{total+=$3}END{print total}') inodeused=$(echo \\"$inodedata\\" | awk '{total+=$4}END{print total}') inodefree=$((inodetotal-inodeused)) inodeusedpercent=$(echo $inodetotal $inodeused | awk '{if($1==0){printf 100}else{printf \\"%.2f\\",$2*100/$1}}') report_DiskTotal=$((disktotal/1024/1024))\\"GB\\" #硬盘总容量(GB) report_DiskFree=$((diskfree/1024/1024))\\"GB\\" #硬盘剩余(GB) report_DiskUsedPercent=\\"$diskusedpercent\\"\\"%\\" #硬盘使用率% report_InodeTotal=$((inodetotal/1000))\\"K\\" #Inode总量 report_InodeFree=$((inodefree/1000))\\"K\\" #Inode剩余 report_InodeUsedPercent=\\"$inodeusedpercent\\"\\"%\\" #Inode使用率% } function getSystemStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 系统检查 ############################\\" if [ -e /etc/sysconfig/i18n ];then default_LANG=\\"$(grep \\"LANG=\\" /etc/sysconfig/i18n | grep -v \\"^#\\" | awk -F '\\"' '{print $2}')\\" else default_LANG=$LANG fi export LANG=\\"en_US.UTF-8\\" Release=$(cat /etc/redhat-release 2&gt;/dev/null) Kernel=$(uname -r) OS=$(uname -o) Hostname=$(uname -n) SELinux=$(/usr/sbin/sestatus | grep \\"SELinux status: \\" | awk '{print $3}') LastReboot=$(who -b | awk '{print $3,$4}') uptime=$(uptime | sed 's/.*up \\\\([^,]*\\\\), .*/\\\\1/') echo \\" 系统：$OS\\" echo \\" 发行版本：$Release\\" echo \\" 内核：$Kernel\\" echo \\" 主机名：$Hostname\\" echo \\" SELinux：$SELinux\\" echo \\"语言/编码：$default_LANG\\" echo \\" 当前时间：$(date +'%F %T')\\" echo \\" 最后启动：$LastReboot\\" echo \\" 运行时间：$uptime\\" #报表信息 report_DateTime=$(date +\\"%F %T\\") #日期 report_Hostname=\\"$Hostname\\" #主机名 report_OSRelease=\\"$Release\\" #发行版本 report_Kernel=\\"$Kernel\\" #内核 report_Language=\\"$default_LANG\\" #语言/编码 report_LastReboot=\\"$LastReboot\\" #最近启动时间 report_Uptime=\\"$uptime\\" #运行时间（天） report_Selinux=\\"$SELinux\\" export LANG=\\"$default_LANG\\" } function getServiceStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 服务检查 ############################\\" echo \\"\\" if [[ $centosVersion &gt; 7 ]];then conf=$(systemctl list-unit-files --type=service --state=enabled --no-pager | grep \\"enabled\\") process=$(systemctl list-units --type=service --state=running --no-pager | grep \\".service\\") #报表信息 report_SelfInitiatedService=\\"$(echo \\"$conf\\" | wc -l)\\" #自启动服务数量 report_RuningService=\\"$(echo \\"$process\\" | wc -l)\\" #运行中服务数量 else conf=$(/sbin/chkconfig | grep -E \\":on|:启用\\") process=$(/sbin/service --status-all 2&gt;/dev/null | grep -E \\"is running|正在运行\\") #报表信息 report_SelfInitiatedService=\\"$(echo \\"$conf\\" | wc -l)\\" #自启动服务数量 report_RuningService=\\"$(echo \\"$process\\" | wc -l)\\" #运行中服务数量 fi echo \\"服务配置\\" echo \\"--------\\" echo \\"$conf\\" | column -t echo \\"\\" echo \\"正在运行的服务\\" echo \\"--------------\\" echo \\"$process\\" } function getAutoStartStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 自启动检查 ##########################\\" conf=$(grep -v \\"^#\\" /etc/rc.d/rc.local| sed '/^$/d') echo \\"$conf\\" #报表信息 report_SelfInitiatedProgram=\\"$(echo $conf | wc -l)\\" #自启动程序数量 } function getLoginStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 登录检查 ############################\\" last | head } function getNetworkStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 网络检查 ############################\\" if [[ $centosVersion &lt; 7 ]];then /sbin/ifconfig -a | grep -v packets | grep -v collisions | grep -v inet6 else #ip a for i in $(ip link | grep BROADCAST | awk -F: '{print $2}');do ip add show $i | grep -E \\"BROADCAST|global\\"| awk '{print $2}' | tr '\\\\n' ' ' ;echo \\"\\" ;done fi GATEWAY=$(ip route | grep default | awk '{print $3}') DNS=$(grep nameserver /etc/resolv.conf| grep -v \\"#\\" | awk '{print $2}' | tr '\\\\n' ',' | sed 's/,$//') echo \\"\\" echo \\"网关：$GATEWAY \\" echo \\" DNS：$DNS\\" #报表信息 IP=$(ip -f inet addr | grep -v 127.0.0.1 | grep inet | awk '{print $NF,$2}' | tr '\\\\n' ',' | sed 's/,$//') MAC=$(ip link | grep -v \\"LOOPBACK\\\\|loopback\\" | awk '{print $2}' | sed 'N;s/\\\\n//' | tr '\\\\n' ',' | sed 's/,$//') report_IP=\\"$IP\\" #IP地址 report_MAC=$MAC #MAC地址 report_Gateway=\\"$GATEWAY\\" #默认网关 report_DNS=\\"$DNS\\" #DNS } function getListenStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 监听检查 ############################\\" TCPListen=$(ss -ntul | column -t) echo \\"$TCPListen\\" #报表信息 report_Listen=\\"$(echo \\"$TCPListen\\"| sed '1d' | awk '/tcp/ {print $5}' | awk -F: '{print $NF}' | sort | uniq | wc -l)\\" } function getCronStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 计划任务检查 ########################\\" Crontab=0 for shell in $(grep -v \\"/sbin/nologin\\" /etc/shells);do for user in $(grep \\"$shell\\" /etc/passwd| awk -F: '{print $1}');do crontab -l -u $user &gt;/dev/null 2&gt;&amp;1 status=$? if [ $status -eq 0 ];then echo \\"$user\\" echo \\"--------\\" crontab -l -u $user let Crontab=Crontab+$(crontab -l -u $user | wc -l) echo \\"\\" fi done done #计划任务 find /etc/cron* -type f | xargs -i ls -l {} | column -t let Crontab=Crontab+$(find /etc/cron* -type f | wc -l) #报表信息 report_Crontab=\\"$Crontab\\" #计划任务数 } function getHowLongAgo(){ # 计算一个时间戳离现在有多久了 datetime=\\"$*\\" [ -z \\"$datetime\\" ] &amp;&amp; echo \\"错误的参数：getHowLongAgo() $*\\" Timestamp=$(date +%s -d \\"$datetime\\") #转化为时间戳 Now_Timestamp=$(date +%s) Difference_Timestamp=$(($Now_Timestamp-$Timestamp)) days=0;hours=0;minutes=0; sec_in_day=$((60*60*24)); sec_in_hour=$((60*60)); sec_in_minute=60 while (( $(($Difference_Timestamp-$sec_in_day)) &gt; 1 )) do let Difference_Timestamp=Difference_Timestamp-sec_in_day let days++ done while (( $(($Difference_Timestamp-$sec_in_hour)) &gt; 1 )) do let Difference_Timestamp=Difference_Timestamp-sec_in_hour let hours++ done echo \\"$days 天 $hours 小时前\\" } function getUserLastLogin(){ # 获取用户最近一次登录的时间，含年份 # 很遗憾last命令不支持显示年份，只有\\"last -t YYYYMMDDHHMMSS\\"表示某个时间之间的登录，我 # 们只能用最笨的方法了，对比今天之前和今年元旦之前（或者去年之前和前年之前……）某个用户 # 登录次数，如果登录统计次数有变化，则说明最近一次登录是今年。 username=$1 : \${username:=\\"\`whoami\`\\"} thisYear=$(date +%Y) oldesYear=$(last | tail -n1 | awk '{print $NF}') while(( $thisYear &gt;= $oldesYear));do loginBeforeToday=$(last $username | grep $username | wc -l) loginBeforeNewYearsDayOfThisYear=$(last $username -t $thisYear\\"0101000000\\" | grep $username | wc -l) if [ $loginBeforeToday -eq 0 ];then echo \\"从未登录过\\" break elif [ $loginBeforeToday -gt $loginBeforeNewYearsDayOfThisYear ];then lastDateTime=$(last -i $username | head -n1 | awk '{for(i=4;i&lt;(NF-2);i++)printf\\"%s \\",$i}')\\" $thisYear\\" #格式如: Sat Nov 2 20:33 2015 lastDateTime=$(date \\"+%Y-%m-%d %H:%M:%S\\" -d \\"$lastDateTime\\") echo \\"$lastDateTime\\" break else thisYear=$((thisYear-1)) fi done } function getUserStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 用户检查 ############################\\" #/etc/passwd 最后修改时间 pwdfile=\\"$(cat /etc/passwd)\\" Modify=$(stat /etc/passwd | grep Modify | tr '.' ' ' | awk '{print $2,$3}') echo \\"/etc/passwd 最后修改时间：$Modify ($(getHowLongAgo $Modify))\\" echo \\"\\" echo \\"特权用户\\" echo \\"--------\\" RootUser=\\"\\" for user in $(echo \\"$pwdfile\\" | awk -F: '{print $1}');do if [ $(id -u $user) -eq 0 ];then echo \\"$user\\" RootUser=\\"$RootUser,$user\\" fi done echo \\"\\" echo \\"用户列表\\" echo \\"--------\\" USERs=0 echo \\"$( echo \\"用户名 UID GID HOME SHELL 最后一次登录\\" for shell in $(grep -v \\"/sbin/nologin\\" /etc/shells);do for username in $(grep \\"$shell\\" /etc/passwd| awk -F: '{print $1}');do userLastLogin=\\"$(getUserLastLogin $username)\\" echo \\"$pwdfile\\" | grep -w \\"$username\\" |grep -w \\"$shell\\"| awk -F: -v lastlogin=\\"$(echo \\"$userLastLogin\\" | tr ' ' '_')\\" '{print $1,$3,$4,$6,$7,lastlogin}' done let USERs=USERs+$(echo \\"$pwdfile\\" | grep \\"$shell\\"| wc -l) done )\\" | column -t echo \\"\\" echo \\"空密码用户\\" echo \\"----------\\" USEREmptyPassword=\\"\\" for shell in $(grep -v \\"/sbin/nologin\\" /etc/shells);do for user in $(echo \\"$pwdfile\\" | grep \\"$shell\\" | cut -d: -f1);do r=$(awk -F: '$2==\\"!!\\"{print $1}' /etc/shadow | grep -w $user) if [ ! -z $r ];then echo $r USEREmptyPassword=\\"$USEREmptyPassword,\\"$r fi done done echo \\"\\" echo \\"相同ID的用户\\" echo \\"------------\\" USERTheSameUID=\\"\\" UIDs=$(cut -d: -f3 /etc/passwd | sort | uniq -c | awk '$1&gt;1{print $2}') for uid in $UIDs;do echo -n \\"$uid\\"; USERTheSameUID=\\"$uid\\" r=$(awk -F: 'ORS=\\"\\";$3=='\\"$uid\\"'{print \\":\\",$1}' /etc/passwd) echo \\"$r\\" echo \\"\\" USERTheSameUID=\\"$USERTheSameUID $r,\\" done #报表信息 report_USERs=\\"$USERs\\" #用户 report_USEREmptyPassword=$(echo $USEREmptyPassword | sed 's/^,//') report_USERTheSameUID=$(echo $USERTheSameUID | sed 's/,$//') report_RootUser=$(echo $RootUser | sed 's/^,//') #特权用户 } function getPasswordStatus { echo \\"\\" echo \\"\\" echo \\"############################ 密码检查 ############################\\" pwdfile=\\"$(cat /etc/passwd)\\" echo \\"\\" echo \\"密码过期检查\\" echo \\"------------\\" result=\\"\\" for shell in $(grep -v \\"/sbin/nologin\\" /etc/shells);do for user in $(echo \\"$pwdfile\\" | grep \\"$shell\\" | cut -d: -f1);do get_expiry_date=$(/usr/bin/chage -l $user | grep 'Password expires' | cut -d: -f2) if [[ $get_expiry_date = ' never' || $get_expiry_date = 'never' ]];then printf \\"%-15s 永不过期\\\\n\\" $user result=\\"$result,$user:never\\" else password_expiry_date=$(date -d \\"$get_expiry_date\\" \\"+%s\\") current_date=$(date \\"+%s\\") diff=$(($password_expiry_date-$current_date)) let DAYS=$(($diff/(60*60*24))) printf \\"%-15s %s天后过期\\\\n\\" $user $DAYS result=\\"$result,$user:$DAYS days\\" fi done done report_PasswordExpiry=$(echo $result | sed 's/^,//') echo \\"\\" echo \\"密码策略检查\\" echo \\"------------\\" grep -v \\"#\\" /etc/login.defs | grep -E \\"PASS_MAX_DAYS|PASS_MIN_DAYS|PASS_MIN_LEN|PASS_WARN_AGE\\" } function getSudoersStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ Sudoers检查 #########################\\" conf=$(grep -v \\"^#\\" /etc/sudoers| grep -v \\"^Defaults\\" | sed '/^$/d') echo \\"$conf\\" echo \\"\\" #报表信息 report_Sudoers=\\"$(echo $conf | wc -l)\\" } function getInstalledStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 软件检查 ############################\\" rpm -qa --last | head | column -t } function getProcessStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 进程检查 ############################\\" if [ $(ps -ef | grep defunct | grep -v grep | wc -l) -ge 1 ];then echo \\"\\" echo \\"僵尸进程\\"; echo \\"--------\\" ps -ef | head -n1 ps -ef | grep defunct | grep -v grep fi echo \\"\\" echo \\"内存占用TOP10\\" echo \\"-------------\\" echo -e \\"PID %MEM RSS COMMAND $(ps aux | awk '{print $2, $4, $6, $11}' | sort -k3rn | head -n 10 )\\"| column -t echo \\"\\" echo \\"CPU占用TOP10\\" echo \\"------------\\" top b -n1 | head -17 | tail -11 #报表信息 report_DefunctProsess=\\"$(ps -ef | grep defunct | grep -v grep|wc -l)\\" } function getJDKStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ JDK检查 #############################\\" java -version 2&gt;/dev/null if [ $? -eq 0 ];then java -version 2&gt;&amp;1 fi echo \\"JAVA_HOME=\\\\\\"$JAVA_HOME\\\\\\"\\" #报表信息 report_JDK=\\"$(java -version 2&gt;&amp;1 | grep version | awk '{print $1,$3}' | tr -d '\\"')\\" } function getSyslogStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ syslog检查 ##########################\\" echo \\"服务状态：$(getState rsyslog)\\" echo \\"\\" echo \\"/etc/rsyslog.conf\\" echo \\"-----------------\\" cat /etc/rsyslog.conf 2&gt;/dev/null | grep -v \\"^#\\" | grep -v \\"^\\\\\\\\$\\" | sed '/^$/d' | column -t #报表信息 report_Syslog=\\"$(getState rsyslog)\\" } function getFirewallStatus(){ echo \\"\\" echo \\"\\" echo \\"############################ 防火墙检查 ##########################\\" #防火墙状态，策略等 if [[ $centosVersion &lt; 7 ]];then /etc/init.d/iptables status &gt;/dev/null 2&gt;&amp;1 status=$? if [ $status -eq 0 ];then s=\\"active\\" elif [ $status -eq 3 ];then s=\\"inactive\\" elif [ $status -eq 4 ];then s=\\"permission denied\\" else s=\\"unknown\\" fi else s=\\"$(getState iptables)\\" fi echo \\"iptables: $s\\" echo \\"\\" echo \\"/etc/sysconfig/iptables\\" echo \\"-----------------------\\" cat /etc/sysconfig/iptables 2&gt;/dev/null #报表信息 report_Firewall=\\"$s\\" } function getSNMPStatus(){ #SNMP服务状态，配置等 echo \\"\\" echo \\"\\" echo \\"############################ SNMP检查 ############################\\" status=\\"$(getState snmpd)\\" echo \\"服务状态：$status\\" echo \\"\\" if [ -e /etc/snmp/snmpd.conf ];then echo \\"/etc/snmp/snmpd.conf\\" echo \\"--------------------\\" cat /etc/snmp/snmpd.conf 2&gt;/dev/null | grep -v \\"^#\\" | sed '/^$/d' fi #报表信息 report_SNMP=\\"$(getState snmpd)\\" } function getState(){ if [[ $centosVersion &lt; 7 ]];then if [ -e \\"/etc/init.d/$1\\" ];then if [ \`/etc/init.d/$1 status 2&gt;/dev/null | grep -E \\"is running|正在运行\\" | wc -l\` -ge 1 ];then r=\\"active\\" else r=\\"inactive\\" fi else r=\\"unknown\\" fi else #CentOS 7+ r=\\"$(systemctl is-active $1 2&gt;&amp;1)\\" fi echo \\"$r\\" } function getSSHStatus(){ #SSHD服务状态，配置,受信任主机等 echo \\"\\" echo \\"\\" echo \\"############################ SSH检查 #############################\\" #检查受信任主机 pwdfile=\\"$(cat /etc/passwd)\\" echo \\"服务状态：$(getState sshd)\\" Protocol_Version=$(cat /etc/ssh/sshd_config | grep Protocol | awk '{print $2}') echo \\"SSH协议版本：$Protocol_Version\\" echo \\"\\" echo \\"信任主机\\" echo \\"--------\\" authorized=0 for user in $(echo \\"$pwdfile\\" | grep /bin/bash | awk -F: '{print $1}');do authorize_file=$(echo \\"$pwdfile\\" | grep -w $user | awk -F: '{printf $6\\"/.ssh/authorized_keys\\"}') authorized_host=$(cat $authorize_file 2&gt;/dev/null | awk '{print $3}' | tr '\\\\n' ',' | sed 's/,$//') if [ ! -z $authorized_host ];then echo \\"$user 授权 \\\\\\"$authorized_host\\\\\\" 无密码访问\\" fi let authorized=authorized+$(cat $authorize_file 2&gt;/dev/null | awk '{print $3}'|wc -l) done echo \\"\\" echo \\"是否允许ROOT远程登录\\" echo \\"--------------------\\" config=$(cat /etc/ssh/sshd_config | grep PermitRootLogin) firstChar=\${config:0:1} if [ $firstChar == \\"#\\" ];then PermitRootLogin=\\"yes\\" #默认是允许ROOT远程登录的 else PermitRootLogin=$(echo $config | awk '{print $2}') fi echo \\"PermitRootLogin $PermitRootLogin\\" echo \\"\\" echo \\"/etc/ssh/sshd_config\\" echo \\"--------------------\\" cat /etc/ssh/sshd_config | grep -v \\"^#\\" | sed '/^$/d' #报表信息 report_SSHAuthorized=\\"$authorized\\" #SSH信任主机 report_SSHDProtocolVersion=\\"$Protocol_Version\\" #SSH协议版本 report_SSHDPermitRootLogin=\\"$PermitRootLogin\\" #允许root远程登录 } function getNTPStatus(){ #NTP服务状态，当前时间，配置等 echo \\"\\" echo \\"\\" echo \\"############################ NTP检查 #############################\\" if [ -e /etc/ntp.conf ];then echo \\"服务状态：$(getState ntpd)\\" echo \\"\\" echo \\"/etc/ntp.conf\\" echo \\"-------------\\" cat /etc/ntp.conf 2&gt;/dev/null | grep -v \\"^#\\" | sed '/^$/d' fi #报表信息 report_NTP=\\"$(getState ntpd)\\" } function uploadHostDailyCheckReport(){ json=\\"{ \\\\\\"DateTime\\\\\\":\\\\\\"$report_DateTime\\\\\\", \\\\\\"Hostname\\\\\\":\\\\\\"$report_Hostname\\\\\\", \\\\\\"OSRelease\\\\\\":\\\\\\"$report_OSRelease\\\\\\", \\\\\\"Kernel\\\\\\":\\\\\\"$report_Kernel\\\\\\", \\\\\\"Language\\\\\\":\\\\\\"$report_Language\\\\\\", \\\\\\"LastReboot\\\\\\":\\\\\\"$report_LastReboot\\\\\\", \\\\\\"Uptime\\\\\\":\\\\\\"$report_Uptime\\\\\\", \\\\\\"CPUs\\\\\\":\\\\\\"$report_CPUs\\\\\\", \\\\\\"CPUType\\\\\\":\\\\\\"$report_CPUType\\\\\\", \\\\\\"Arch\\\\\\":\\\\\\"$report_Arch\\\\\\", \\\\\\"MemTotal\\\\\\":\\\\\\"$report_MemTotal\\\\\\", \\\\\\"MemFree\\\\\\":\\\\\\"$report_MemFree\\\\\\", \\\\\\"MemUsedPercent\\\\\\":\\\\\\"$report_MemUsedPercent\\\\\\", \\\\\\"DiskTotal\\\\\\":\\\\\\"$report_DiskTotal\\\\\\", \\\\\\"DiskFree\\\\\\":\\\\\\"$report_DiskFree\\\\\\", \\\\\\"DiskUsedPercent\\\\\\":\\\\\\"$report_DiskUsedPercent\\\\\\", \\\\\\"InodeTotal\\\\\\":\\\\\\"$report_InodeTotal\\\\\\", \\\\\\"InodeFree\\\\\\":\\\\\\"$report_InodeFree\\\\\\", \\\\\\"InodeUsedPercent\\\\\\":\\\\\\"$report_InodeUsedPercent\\\\\\", \\\\\\"IP\\\\\\":\\\\\\"$report_IP\\\\\\", \\\\\\"MAC\\\\\\":\\\\\\"$report_MAC\\\\\\", \\\\\\"Gateway\\\\\\":\\\\\\"$report_Gateway\\\\\\", \\\\\\"DNS\\\\\\":\\\\\\"$report_DNS\\\\\\", \\\\\\"Listen\\\\\\":\\\\\\"$report_Listen\\\\\\", \\\\\\"Selinux\\\\\\":\\\\\\"$report_Selinux\\\\\\", \\\\\\"Firewall\\\\\\":\\\\\\"$report_Firewall\\\\\\", \\\\\\"USERs\\\\\\":\\\\\\"$report_USERs\\\\\\", \\\\\\"USEREmptyPassword\\\\\\":\\\\\\"$report_USEREmptyPassword\\\\\\", \\\\\\"USERTheSameUID\\\\\\":\\\\\\"$report_USERTheSameUID\\\\\\", \\\\\\"PasswordExpiry\\\\\\":\\\\\\"$report_PasswordExpiry\\\\\\", \\\\\\"RootUser\\\\\\":\\\\\\"$report_RootUser\\\\\\", \\\\\\"Sudoers\\\\\\":\\\\\\"$report_Sudoers\\\\\\", \\\\\\"SSHAuthorized\\\\\\":\\\\\\"$report_SSHAuthorized\\\\\\", \\\\\\"SSHDProtocolVersion\\\\\\":\\\\\\"$report_SSHDProtocolVersion\\\\\\", \\\\\\"SSHDPermitRootLogin\\\\\\":\\\\\\"$report_SSHDPermitRootLogin\\\\\\", \\\\\\"DefunctProsess\\\\\\":\\\\\\"$report_DefunctProsess\\\\\\", \\\\\\"SelfInitiatedService\\\\\\":\\\\\\"$report_SelfInitiatedService\\\\\\", \\\\\\"SelfInitiatedProgram\\\\\\":\\\\\\"$report_SelfInitiatedProgram\\\\\\", \\\\\\"RuningService\\\\\\":\\\\\\"$report_RuningService\\\\\\", \\\\\\"Crontab\\\\\\":\\\\\\"$report_Crontab\\\\\\", \\\\\\"Syslog\\\\\\":\\\\\\"$report_Syslog\\\\\\", \\\\\\"SNMP\\\\\\":\\\\\\"$report_SNMP\\\\\\", \\\\\\"NTP\\\\\\":\\\\\\"$report_NTP\\\\\\", \\\\\\"JDK\\\\\\":\\\\\\"$report_JDK\\\\\\" }\\" #echo \\"$json\\" curl -l -H \\"Content-type: application/json\\" -X POST -d \\"$json\\" \\"$uploadHostDailyCheckReportApi\\" 2&gt;/dev/null } function getchage_file_24h() { echo \\"############################ 文件检查 #############################\\" check2=$(find / -name '*.sh' -mtime -1) check21=$(find / -name '*.asp' -mtime -1) check22=$(find / -name '*.php' -mtime -1) check23=$(find / -name '*.aspx' -mtime -1) check24=$(find / -name '*.jsp' -mtime -1) check25=$(find / -name '*.html' -mtime -1) check26=$(find / -name '*.htm' -mtime -1) check9=$(find / -name core -exec ls -l {} \\\\;) check10=$(cat /etc/crontab) check12=$(ls -alt /usr/bin | head -10) cat &lt;&lt;EOF ############################查看所有被修改过的文件返回最近24小时内的############################ \${check2} \${check21} \${check22} \${check23} \${check24} \${check25} \${check26} \${line} ############################检查定时文件的完整性############################ \${check10} \${line} ############################查看系统命令是否被替换############################ \${check12} \${line} EOF } function check(){ version getSystemStatus getCpuStatus getMemStatus getDiskStatus getNetworkStatus getListenStatus getProcessStatus getServiceStatus getAutoStartStatus getLoginStatus getCronStatus getUserStatus getPasswordStatus getSudoersStatus getJDKStatus getFirewallStatus getSSHStatus getSyslogStatus getSNMPStatus getNTPStatus getInstalledStatus getchage_file_24h } #执行检查并保存检查结果 check &gt; $RESULTFILE echo \\"检查结果：$RESULTFILE\\" echo -e \\"\`date \\"+%Y-%m-%d %H:%M:%S\\"\` 阿里云PHP企业平台巡检报告\\" | mail -a $RESULTFILE -s \\"阿里云PHP企业平台巡检报告\\" h@163.com END"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:updated_time","content":"2023-01-23T12:28:07.000Z"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"xlc520"}],["meta",{"property":"article:tag","content":"Linux"}],["meta",{"property":"article:published_time","content":"2023-01-22T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-01-23T12:28:07.000Z"}]]},"headers":[],"git":{"createdTime":1674476887000,"updatedTime":1674476887000,"contributors":[{"name":"xlc520","email":"2215400217@qq.com","commits":1}]},"readingTime":{"minutes":11.22,"words":3365},"filePathRelative":"linux/Linux 系统日常运维巡检脚本.md","localizedDate":"2023年1月22日","excerpt":"<h1> Linux 系统日常运维巡检脚本</h1>\\n<p>Linux 系统日常巡检脚本，巡检内容包含了，磁盘，内存 cpu 进程 文件更改 用户登录等一系列的操作 直接用就行了。</p>\\n<p>报告以邮件发送到邮箱 在log下生成巡检报告。</p>\\n<div class=\\"language-bash line-numbers-mode\\" data-ext=\\"sh\\"><pre class=\\"language-bash\\"><code><span class=\\"token shebang important\\">#!/bin/bash</span>\\n<span class=\\"token comment\\">#主机信息每日巡检</span>\\n\\n<span class=\\"token assign-left variable\\">IPADDR</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">ifconfig</span> eth0<span class=\\"token operator\\">|</span><span class=\\"token function\\">grep</span> <span class=\\"token string\\">'inet addr'</span><span class=\\"token operator\\">|</span><span class=\\"token function\\">awk</span> <span class=\\"token parameter variable\\">-F</span> <span class=\\"token string\\">'[ :]'</span> <span class=\\"token string\\">'{print $13}'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token comment\\">#环境变量PATH没设好，在cron里执行时有很多命令会找不到</span>\\n<span class=\\"token builtin class-name\\">export</span> <span class=\\"token assign-left variable\\"><span class=\\"token environment constant\\">PATH</span></span><span class=\\"token operator\\">=</span>/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin\\n<span class=\\"token builtin class-name\\">source</span> /etc/profile\\n\\n<span class=\\"token punctuation\\">[</span> <span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">id</span> <span class=\\"token parameter variable\\">-u</span><span class=\\"token variable\\">)</span></span> <span class=\\"token parameter variable\\">-gt</span> <span class=\\"token number\\">0</span> <span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">&amp;&amp;</span> <span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"请用root用户执行此脚本！\\"</span> <span class=\\"token operator\\">&amp;&amp;</span> <span class=\\"token builtin class-name\\">exit</span> <span class=\\"token number\\">1</span>\\n<span class=\\"token assign-left variable\\">centosVersion</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{print $(NF-1)}'</span> /etc/redhat-release<span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">VERSION</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"2020-03-16\\"</span>\\n\\n<span class=\\"token comment\\">#日志相关</span>\\n<span class=\\"token assign-left variable\\">PROGPATH</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">\`</span><span class=\\"token builtin class-name\\">echo</span> $0 <span class=\\"token operator\\">|</span> <span class=\\"token function\\">sed</span> <span class=\\"token parameter variable\\">-e</span> <span class=\\"token string\\">'s,[\\\\\\\\/][^\\\\\\\\/][^\\\\\\\\/]*$,,'</span><span class=\\"token variable\\">\`</span></span>\\n<span class=\\"token punctuation\\">[</span> <span class=\\"token parameter variable\\">-f</span> <span class=\\"token variable\\">$PROGPATH</span> <span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">&amp;&amp;</span> <span class=\\"token assign-left variable\\">PROGPATH</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\".\\"</span>\\n<span class=\\"token assign-left variable\\">LOGPATH</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$PROGPATH</span>/log\\"</span>\\n<span class=\\"token punctuation\\">[</span> <span class=\\"token parameter variable\\">-e</span> <span class=\\"token variable\\">$LOGPATH</span> <span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">||</span> <span class=\\"token function\\">mkdir</span> <span class=\\"token variable\\">$LOGPATH</span>\\n<span class=\\"token assign-left variable\\">RESULTFILE</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$LOGPATH</span>/HostDailyCheck-<span class=\\"token variable\\">$IPADDR</span>-<span class=\\"token variable\\"><span class=\\"token variable\\">\`</span><span class=\\"token function\\">date</span> +%Y%m%d<span class=\\"token variable\\">\`</span></span>.txt\\"</span>\\n\\n\\n<span class=\\"token comment\\">#定义报表的全局变量</span>\\n<span class=\\"token assign-left variable\\">report_DateTime</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#日期 ok</span>\\n<span class=\\"token assign-left variable\\">report_Hostname</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#主机名 ok</span>\\n<span class=\\"token assign-left variable\\">report_OSRelease</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#发行版本 ok</span>\\n<span class=\\"token assign-left variable\\">report_Kernel</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#内核 ok</span>\\n<span class=\\"token assign-left variable\\">report_Language</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#语言/编码 ok</span>\\n<span class=\\"token assign-left variable\\">report_LastReboot</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#最近启动时间 ok</span>\\n<span class=\\"token assign-left variable\\">report_Uptime</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#运行时间（天） ok</span>\\n<span class=\\"token assign-left variable\\">report_CPUs</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#CPU数量 ok</span>\\n<span class=\\"token assign-left variable\\">report_CPUType</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#CPU类型 ok</span>\\n<span class=\\"token assign-left variable\\">report_Arch</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#CPU架构 ok</span>\\n<span class=\\"token assign-left variable\\">report_MemTotal</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#内存总容量(MB) ok</span>\\n<span class=\\"token assign-left variable\\">report_MemFree</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#内存剩余(MB) ok</span>\\n<span class=\\"token assign-left variable\\">report_MemUsedPercent</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#内存使用率% ok</span>\\n<span class=\\"token assign-left variable\\">report_DiskTotal</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#硬盘总容量(GB) ok</span>\\n<span class=\\"token assign-left variable\\">report_DiskFree</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#硬盘剩余(GB) ok</span>\\n<span class=\\"token assign-left variable\\">report_DiskUsedPercent</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#硬盘使用率% ok</span>\\n<span class=\\"token assign-left variable\\">report_InodeTotal</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#Inode总量 ok</span>\\n<span class=\\"token assign-left variable\\">report_InodeFree</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#Inode剩余 ok</span>\\n<span class=\\"token assign-left variable\\">report_InodeUsedPercent</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#Inode使用率 ok</span>\\n<span class=\\"token assign-left variable\\">report_IP</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#IP地址 ok</span>\\n<span class=\\"token assign-left variable\\">report_MAC</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#MAC地址 ok</span>\\n<span class=\\"token assign-left variable\\">report_Gateway</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#默认网关 ok</span>\\n<span class=\\"token assign-left variable\\">report_DNS</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#DNS ok</span>\\n<span class=\\"token assign-left variable\\">report_Listen</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#监听 ok</span>\\n<span class=\\"token assign-left variable\\">report_Selinux</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#Selinux ok</span>\\n<span class=\\"token assign-left variable\\">report_Firewall</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#防火墙 ok</span>\\n<span class=\\"token assign-left variable\\">report_USERs</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#用户 ok</span>\\n<span class=\\"token assign-left variable\\">report_USEREmptyPassword</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#空密码用户 ok</span>\\n<span class=\\"token assign-left variable\\">report_USERTheSameUID</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#相同ID的用户 ok </span>\\n<span class=\\"token assign-left variable\\">report_PasswordExpiry</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#密码过期（天） ok</span>\\n<span class=\\"token assign-left variable\\">report_RootUser</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#root用户 ok</span>\\n<span class=\\"token assign-left variable\\">report_Sudoers</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#sudo授权 ok</span>\\n<span class=\\"token assign-left variable\\">report_SSHAuthorized</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#SSH信任主机 ok</span>\\n<span class=\\"token assign-left variable\\">report_SSHDProtocolVersion</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#SSH协议版本 ok</span>\\n<span class=\\"token assign-left variable\\">report_SSHDPermitRootLogin</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#允许root远程登录 ok</span>\\n<span class=\\"token assign-left variable\\">report_DefunctProsess</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#僵尸进程数量 ok</span>\\n<span class=\\"token assign-left variable\\">report_SelfInitiatedService</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#自启动服务数量 ok</span>\\n<span class=\\"token assign-left variable\\">report_SelfInitiatedProgram</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#自启动程序数量 ok</span>\\n<span class=\\"token assign-left variable\\">report_RuningService</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#运行中服务数 ok</span>\\n<span class=\\"token assign-left variable\\">report_Crontab</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#计划任务数 ok</span>\\n<span class=\\"token assign-left variable\\">report_Syslog</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#日志服务 ok</span>\\n<span class=\\"token assign-left variable\\">report_SNMP</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#SNMP OK</span>\\n<span class=\\"token assign-left variable\\">report_NTP</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#NTP ok</span>\\n<span class=\\"token assign-left variable\\">report_JDK</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span> <span class=\\"token comment\\">#JDK版本 ok</span>\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">version</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"系统巡检脚本：Version <span class=\\"token variable\\">$VERSION</span>\\"</span>\\n<span class=\\"token punctuation\\">}</span>\\n\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">getCpuStatus</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"############################ CPU检查 #############################\\"</span>\\n<span class=\\"token assign-left variable\\">Physical_CPUs</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">grep</span> <span class=\\"token string\\">\\"physical id\\"</span> /proc/cpuinfo<span class=\\"token operator\\">|</span> <span class=\\"token function\\">sort</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">uniq</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">wc</span> <span class=\\"token parameter variable\\">-l</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">Virt_CPUs</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">grep</span> <span class=\\"token string\\">\\"processor\\"</span> /proc/cpuinfo <span class=\\"token operator\\">|</span> <span class=\\"token function\\">wc</span> <span class=\\"token parameter variable\\">-l</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">CPU_Kernels</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">grep</span> <span class=\\"token string\\">\\"cores\\"</span> /proc/cpuinfo<span class=\\"token operator\\">|</span><span class=\\"token function\\">uniq</span><span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token parameter variable\\">-F</span> <span class=\\"token string\\">': '</span> <span class=\\"token string\\">'{print $2}'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">CPU_Type</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">grep</span> <span class=\\"token string\\">\\"model name\\"</span> /proc/cpuinfo <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token parameter variable\\">-F</span> <span class=\\"token string\\">': '</span> <span class=\\"token string\\">'{print $2}'</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">sort</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">uniq</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">CPU_Arch</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">uname</span> <span class=\\"token parameter variable\\">-m</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"物理CPU个数:<span class=\\"token variable\\">$Physical_CPUs</span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"逻辑CPU个数:<span class=\\"token variable\\">$Virt_CPUs</span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"每CPU核心数:<span class=\\"token variable\\">$CPU_Kernels</span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\" CPU型号:<span class=\\"token variable\\">$CPU_Type</span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\" CPU架构:<span class=\\"token variable\\">$CPU_Arch</span>\\"</span>\\n<span class=\\"token comment\\">#报表信息</span>\\n<span class=\\"token assign-left variable\\">report_CPUs</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\">$Virt_CPUs</span> <span class=\\"token comment\\">#CPU数量</span>\\n<span class=\\"token assign-left variable\\">report_CPUType</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\">$CPU_Type</span> <span class=\\"token comment\\">#CPU类型</span>\\n<span class=\\"token assign-left variable\\">report_Arch</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\">$CPU_Arch</span> <span class=\\"token comment\\">#CPU架构</span>\\n<span class=\\"token punctuation\\">}</span>\\n\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">getMemStatus</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"############################ 内存检查 ############################\\"</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">[</span> <span class=\\"token variable\\">$centosVersion</span> <span class=\\"token operator\\">&lt;</span> <span class=\\"token number\\">7</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">then</span>\\n<span class=\\"token function\\">free</span> <span class=\\"token parameter variable\\">-mo</span>\\n<span class=\\"token keyword\\">else</span>\\n<span class=\\"token function\\">free</span> <span class=\\"token parameter variable\\">-h</span>\\n<span class=\\"token keyword\\">fi</span>\\n<span class=\\"token comment\\">#报表信息</span>\\n<span class=\\"token assign-left variable\\">MemTotal</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">grep</span> MemTotal /proc/meminfo<span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{print $2}'</span><span class=\\"token variable\\">)</span></span> <span class=\\"token comment\\">#KB</span>\\n<span class=\\"token assign-left variable\\">MemFree</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">grep</span> MemFree /proc/meminfo<span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{print $2}'</span><span class=\\"token variable\\">)</span></span> <span class=\\"token comment\\">#KB</span>\\n<span class=\\"token builtin class-name\\">let</span> <span class=\\"token assign-left variable\\">MemUsed</span><span class=\\"token operator\\">=</span>MemTotal-MemFree\\n<span class=\\"token assign-left variable\\">MemPercent</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">awk</span> <span class=\\"token string\\">\\"BEGIN {if(<span class=\\"token variable\\">$MemTotal</span>==0){printf 100}else{printf <span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>%.2f<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,<span class=\\"token variable\\">$MemUsed</span>*100/<span class=\\"token variable\\">$MemTotal</span>}}\\"</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">report_MemTotal</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\"><span class=\\"token variable\\">$((</span>MemTotal<span class=\\"token operator\\">/</span><span class=\\"token number\\">1024</span><span class=\\"token variable\\">))</span></span>\\"</span>\\"MB<span class=\\"token string\\">\\" #内存总容量(MB)\\nreport_MemFree=\\"</span><span class=\\"token variable\\"><span class=\\"token variable\\">$((</span>MemFree<span class=\\"token operator\\">/</span><span class=\\"token number\\">1024</span><span class=\\"token variable\\">))</span></span><span class=\\"token string\\">\\"\\"</span>MB<span class=\\"token string\\">\\" #内存剩余(MB)\\nreport_MemUsedPercent=\\"</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">awk</span> <span class=\\"token string\\">\\"BEGIN {if(<span class=\\"token variable\\">$MemTotal</span>==0){printf 100}else{printf <span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>%.2f<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,<span class=\\"token variable\\">$MemUsed</span>*100/<span class=\\"token variable\\">$MemTotal</span>}}\\"</span><span class=\\"token variable\\">)</span></span><span class=\\"token string\\">\\"\\"</span>%<span class=\\"token string\\">\\" #内存使用率%\\n}\\nfunction getDiskStatus(){\\necho \\"</span>\\"\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"############################ 磁盘检查 ############################\\"</span>\\n<span class=\\"token function\\">df</span> <span class=\\"token parameter variable\\">-hiP</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">sed</span> <span class=\\"token string\\">'s/Mounted on/Mounted/'</span><span class=\\"token operator\\">&gt;</span> /tmp/inode\\n<span class=\\"token function\\">df</span> <span class=\\"token parameter variable\\">-hTP</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">sed</span> <span class=\\"token string\\">'s/Mounted on/Mounted/'</span><span class=\\"token operator\\">&gt;</span> /tmp/disk \\n<span class=\\"token function\\">join</span> /tmp/disk /tmp/inode <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{print $1,$2,\\"|\\",$3,$4,$5,$6,\\"|\\",$8,$9,$10,$11,\\"|\\",$12}'</span><span class=\\"token operator\\">|</span> <span class=\\"token function\\">column</span> <span class=\\"token parameter variable\\">-t</span>\\n<span class=\\"token comment\\">#报表信息</span>\\n<span class=\\"token assign-left variable\\">diskdata</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">df</span> <span class=\\"token parameter variable\\">-TP</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">sed</span> <span class=\\"token string\\">'1d'</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'$2!=\\"tmpfs\\"{print}'</span><span class=\\"token variable\\">)</span></span> <span class=\\"token comment\\">#KB</span>\\n<span class=\\"token assign-left variable\\">disktotal</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$diskdata</span>\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{total+=$3}END{print total}'</span><span class=\\"token variable\\">)</span></span> <span class=\\"token comment\\">#KB</span>\\n<span class=\\"token assign-left variable\\">diskused</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$diskdata</span>\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{total+=$4}END{print total}'</span><span class=\\"token variable\\">)</span></span> <span class=\\"token comment\\">#KB</span>\\n<span class=\\"token assign-left variable\\">diskfree</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$((</span>disktotal<span class=\\"token operator\\">-</span>diskused<span class=\\"token variable\\">))</span></span> <span class=\\"token comment\\">#KB</span>\\n<span class=\\"token assign-left variable\\">diskusedpercent</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token builtin class-name\\">echo</span> $disktotal $diskused <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{if($1==0){printf 100}else{printf \\"%.2f\\",$2*100/$1}}'</span><span class=\\"token variable\\">)</span></span> \\n<span class=\\"token assign-left variable\\">inodedata</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">df</span> <span class=\\"token parameter variable\\">-iTP</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">sed</span> <span class=\\"token string\\">'1d'</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'$2!=\\"tmpfs\\"{print}'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">inodetotal</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$inodedata</span>\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{total+=$3}END{print total}'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">inodeused</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$inodedata</span>\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{total+=$4}END{print total}'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">inodefree</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$((</span>inodetotal<span class=\\"token operator\\">-</span>inodeused<span class=\\"token variable\\">))</span></span>\\n<span class=\\"token assign-left variable\\">inodeusedpercent</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token builtin class-name\\">echo</span> $inodetotal $inodeused <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{if($1==0){printf 100}else{printf \\"%.2f\\",$2*100/$1}}'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">report_DiskTotal</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$((</span>disktotal<span class=\\"token operator\\">/</span><span class=\\"token number\\">1024</span><span class=\\"token operator\\">/</span><span class=\\"token number\\">1024</span><span class=\\"token variable\\">))</span></span><span class=\\"token string\\">\\"GB\\"</span> <span class=\\"token comment\\">#硬盘总容量(GB)</span>\\n<span class=\\"token assign-left variable\\">report_DiskFree</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$((</span>diskfree<span class=\\"token operator\\">/</span><span class=\\"token number\\">1024</span><span class=\\"token operator\\">/</span><span class=\\"token number\\">1024</span><span class=\\"token variable\\">))</span></span><span class=\\"token string\\">\\"GB\\"</span> <span class=\\"token comment\\">#硬盘剩余(GB)</span>\\n<span class=\\"token assign-left variable\\">report_DiskUsedPercent</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$diskusedpercent</span>\\"</span>\\"%<span class=\\"token string\\">\\" #硬盘使用率%\\nreport_InodeTotal=<span class=\\"token variable\\"><span class=\\"token variable\\">$((</span>inodetotal<span class=\\"token operator\\">/</span><span class=\\"token number\\">1000</span><span class=\\"token variable\\">))</span></span>\\"</span>K<span class=\\"token string\\">\\" #Inode总量\\nreport_InodeFree=<span class=\\"token variable\\"><span class=\\"token variable\\">$((</span>inodefree<span class=\\"token operator\\">/</span><span class=\\"token number\\">1000</span><span class=\\"token variable\\">))</span></span>\\"</span>K<span class=\\"token string\\">\\" #Inode剩余\\nreport_InodeUsedPercent=\\"</span><span class=\\"token variable\\">$inodeusedpercent</span><span class=\\"token string\\">\\"\\"</span>%<span class=\\"token string\\">\\" #Inode使用率%\\n\\n}\\n\\nfunction getSystemStatus(){\\necho \\"</span>\\"\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"############################ 系统检查 ############################\\"</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span> <span class=\\"token parameter variable\\">-e</span> /etc/sysconfig/i18n <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">then</span>\\n<span class=\\"token assign-left variable\\">default_LANG</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">grep</span> <span class=\\"token string\\">\\"LANG=\\"</span> /etc/sysconfig/i18n <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-v</span> <span class=\\"token string\\">\\"^#\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token parameter variable\\">-F</span> <span class=\\"token string\\">'\\"'</span> <span class=\\"token string\\">'{print $2}'</span><span class=\\"token variable\\">)</span></span>\\"</span>\\n<span class=\\"token keyword\\">else</span>\\n<span class=\\"token assign-left variable\\">default_LANG</span><span class=\\"token operator\\">=</span><span class=\\"token environment constant\\">$LANG</span>\\n<span class=\\"token keyword\\">fi</span>\\n<span class=\\"token builtin class-name\\">export</span> <span class=\\"token assign-left variable\\"><span class=\\"token environment constant\\">LANG</span></span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"en_US.UTF-8\\"</span>\\n<span class=\\"token assign-left variable\\">Release</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">cat</span> /etc/redhat-release <span class=\\"token operator\\"><span class=\\"token file-descriptor important\\">2</span>&gt;</span>/dev/null<span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">Kernel</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">uname</span> <span class=\\"token parameter variable\\">-r</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">OS</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">uname</span> <span class=\\"token parameter variable\\">-o</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">Hostname</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">uname</span> <span class=\\"token parameter variable\\">-n</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">SELinux</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>/usr/sbin/sestatus <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token string\\">\\"SELinux status: \\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{print $3}'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">LastReboot</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">who</span> <span class=\\"token parameter variable\\">-b</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{print $3,$4}'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">uptime</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">uptime</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">sed</span> <span class=\\"token string\\">'s/.*up \\\\([^,]*\\\\), .*/\\\\1/'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\" 系统：<span class=\\"token variable\\">$OS</span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\" 发行版本：<span class=\\"token variable\\">$Release</span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\" 内核：<span class=\\"token variable\\">$Kernel</span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\" 主机名：<span class=\\"token variable\\">$Hostname</span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\" SELinux：<span class=\\"token variable\\">$SELinux</span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"语言/编码：<span class=\\"token variable\\">$default_LANG</span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\" 当前时间：<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">date</span> +<span class=\\"token string\\">'%F %T'</span><span class=\\"token variable\\">)</span></span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\" 最后启动：<span class=\\"token variable\\">$LastReboot</span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\" 运行时间：<span class=\\"token variable\\">$uptime</span>\\"</span>\\n<span class=\\"token comment\\">#报表信息</span>\\n<span class=\\"token assign-left variable\\">report_DateTime</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">date</span> +<span class=\\"token string\\">\\"%F %T\\"</span><span class=\\"token variable\\">)</span></span> <span class=\\"token comment\\">#日期</span>\\n<span class=\\"token assign-left variable\\">report_Hostname</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$Hostname</span>\\"</span> <span class=\\"token comment\\">#主机名</span>\\n<span class=\\"token assign-left variable\\">report_OSRelease</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$Release</span>\\"</span> <span class=\\"token comment\\">#发行版本</span>\\n<span class=\\"token assign-left variable\\">report_Kernel</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$Kernel</span>\\"</span> <span class=\\"token comment\\">#内核</span>\\n<span class=\\"token assign-left variable\\">report_Language</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$default_LANG</span>\\"</span> <span class=\\"token comment\\">#语言/编码</span>\\n<span class=\\"token assign-left variable\\">report_LastReboot</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$LastReboot</span>\\"</span> <span class=\\"token comment\\">#最近启动时间</span>\\n<span class=\\"token assign-left variable\\">report_Uptime</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$uptime</span>\\"</span> <span class=\\"token comment\\">#运行时间（天）</span>\\n<span class=\\"token assign-left variable\\">report_Selinux</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$SELinux</span>\\"</span>\\n<span class=\\"token builtin class-name\\">export</span> <span class=\\"token assign-left variable\\"><span class=\\"token environment constant\\">LANG</span></span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$default_LANG</span>\\"</span>\\n\\n<span class=\\"token punctuation\\">}</span>\\n\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">getServiceStatus</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"############################ 服务检查 ############################\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">[</span> <span class=\\"token variable\\">$centosVersion</span> <span class=\\"token operator\\">&gt;</span> <span class=\\"token number\\">7</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">then</span>\\n<span class=\\"token assign-left variable\\">conf</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>systemctl list-unit-files <span class=\\"token parameter variable\\">--type</span><span class=\\"token operator\\">=</span>service <span class=\\"token parameter variable\\">--state</span><span class=\\"token operator\\">=</span>enabled --no-pager <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token string\\">\\"enabled\\"</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">process</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>systemctl list-units <span class=\\"token parameter variable\\">--type</span><span class=\\"token operator\\">=</span>service <span class=\\"token parameter variable\\">--state</span><span class=\\"token operator\\">=</span>running --no-pager <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token string\\">\\".service\\"</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token comment\\">#报表信息</span>\\n<span class=\\"token assign-left variable\\">report_SelfInitiatedService</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$conf</span>\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">wc</span> <span class=\\"token parameter variable\\">-l</span><span class=\\"token variable\\">)</span></span>\\"</span> <span class=\\"token comment\\">#自启动服务数量</span>\\n<span class=\\"token assign-left variable\\">report_RuningService</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$process</span>\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">wc</span> <span class=\\"token parameter variable\\">-l</span><span class=\\"token variable\\">)</span></span>\\"</span> <span class=\\"token comment\\">#运行中服务数量</span>\\n<span class=\\"token keyword\\">else</span>\\n<span class=\\"token assign-left variable\\">conf</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>/sbin/chkconfig <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-E</span> <span class=\\"token string\\">\\":on|:启用\\"</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">process</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>/sbin/service --status-all <span class=\\"token operator\\"><span class=\\"token file-descriptor important\\">2</span>&gt;</span>/dev/null <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-E</span> <span class=\\"token string\\">\\"is running|正在运行\\"</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token comment\\">#报表信息</span>\\n<span class=\\"token assign-left variable\\">report_SelfInitiatedService</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$conf</span>\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">wc</span> <span class=\\"token parameter variable\\">-l</span><span class=\\"token variable\\">)</span></span>\\"</span> <span class=\\"token comment\\">#自启动服务数量</span>\\n<span class=\\"token assign-left variable\\">report_RuningService</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$process</span>\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">wc</span> <span class=\\"token parameter variable\\">-l</span><span class=\\"token variable\\">)</span></span>\\"</span> <span class=\\"token comment\\">#运行中服务数量</span>\\n<span class=\\"token keyword\\">fi</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"服务配置\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"--------\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$conf</span>\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">column</span> <span class=\\"token parameter variable\\">-t</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"正在运行的服务\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"--------------\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$process</span>\\"</span>\\n\\n<span class=\\"token punctuation\\">}</span>\\n\\n\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">getAutoStartStatus</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"############################ 自启动检查 ##########################\\"</span>\\n<span class=\\"token assign-left variable\\">conf</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-v</span> <span class=\\"token string\\">\\"^#\\"</span> /etc/rc.d/rc.local<span class=\\"token operator\\">|</span> <span class=\\"token function\\">sed</span> <span class=\\"token string\\">'/^$/d'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$conf</span>\\"</span>\\n<span class=\\"token comment\\">#报表信息</span>\\n<span class=\\"token assign-left variable\\">report_SelfInitiatedProgram</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token builtin class-name\\">echo</span> $conf <span class=\\"token operator\\">|</span> <span class=\\"token function\\">wc</span> <span class=\\"token parameter variable\\">-l</span><span class=\\"token variable\\">)</span></span>\\"</span> <span class=\\"token comment\\">#自启动程序数量</span>\\n<span class=\\"token punctuation\\">}</span>\\n\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">getLoginStatus</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"############################ 登录检查 ############################\\"</span>\\nlast <span class=\\"token operator\\">|</span> <span class=\\"token function\\">head</span>\\n<span class=\\"token punctuation\\">}</span>\\n\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">getNetworkStatus</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"############################ 网络检查 ############################\\"</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">[</span> <span class=\\"token variable\\">$centosVersion</span> <span class=\\"token operator\\">&lt;</span> <span class=\\"token number\\">7</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">then</span>\\n/sbin/ifconfig <span class=\\"token parameter variable\\">-a</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-v</span> packets <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-v</span> collisions <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-v</span> inet6\\n<span class=\\"token keyword\\">else</span>\\n<span class=\\"token comment\\">#ip a</span>\\n<span class=\\"token keyword\\">for</span> <span class=\\"token for-or-select variable\\">i</span> <span class=\\"token keyword\\">in</span> <span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">ip</span> <span class=\\"token function\\">link</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> BROADCAST <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> -F: <span class=\\"token string\\">'{print $2}'</span><span class=\\"token variable\\">)</span></span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">do</span> <span class=\\"token function\\">ip</span> <span class=\\"token function\\">add</span> show <span class=\\"token variable\\">$i</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-E</span> <span class=\\"token string\\">\\"BROADCAST|global\\"</span><span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{print $2}'</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">tr</span> <span class=\\"token string\\">'\\\\n'</span> <span class=\\"token string\\">' '</span> <span class=\\"token punctuation\\">;</span><span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span> <span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">done</span>\\n<span class=\\"token keyword\\">fi</span>\\n<span class=\\"token assign-left variable\\">GATEWAY</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">ip</span> route <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> default <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{print $3}'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">DNS</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">grep</span> nameserver /etc/resolv.conf<span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-v</span> <span class=\\"token string\\">\\"#\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{print $2}'</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">tr</span> <span class=\\"token string\\">'\\\\n'</span> <span class=\\"token string\\">','</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">sed</span> <span class=\\"token string\\">'s/,$//'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"网关：<span class=\\"token variable\\">$GATEWAY</span> \\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\" DNS：<span class=\\"token variable\\">$DNS</span>\\"</span>\\n<span class=\\"token comment\\">#报表信息</span>\\n<span class=\\"token assign-left variable\\">IP</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">ip</span> <span class=\\"token parameter variable\\">-f</span> inet addr <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-v</span> <span class=\\"token number\\">127.0</span>.0.1 <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> inet <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{print $NF,$2}'</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">tr</span> <span class=\\"token string\\">'\\\\n'</span> <span class=\\"token string\\">','</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">sed</span> <span class=\\"token string\\">'s/,$//'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">MAC</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">ip</span> <span class=\\"token function\\">link</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-v</span> <span class=\\"token string\\">\\"LOOPBACK\\\\|loopback\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{print $2}'</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">sed</span> <span class=\\"token string\\">'N;s/\\\\n//'</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">tr</span> <span class=\\"token string\\">'\\\\n'</span> <span class=\\"token string\\">','</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">sed</span> <span class=\\"token string\\">'s/,$//'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">report_IP</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$IP</span>\\"</span> <span class=\\"token comment\\">#IP地址</span>\\n<span class=\\"token assign-left variable\\">report_MAC</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\">$MAC</span> <span class=\\"token comment\\">#MAC地址</span>\\n<span class=\\"token assign-left variable\\">report_Gateway</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$GATEWAY</span>\\"</span> <span class=\\"token comment\\">#默认网关</span>\\n<span class=\\"token assign-left variable\\">report_DNS</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$DNS</span>\\"</span> <span class=\\"token comment\\">#DNS</span>\\n<span class=\\"token punctuation\\">}</span>\\n\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">getListenStatus</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"############################ 监听检查 ############################\\"</span>\\n<span class=\\"token assign-left variable\\">TCPListen</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>ss <span class=\\"token parameter variable\\">-ntul</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">column</span> <span class=\\"token parameter variable\\">-t</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$TCPListen</span>\\"</span>\\n<span class=\\"token comment\\">#报表信息</span>\\n<span class=\\"token assign-left variable\\">report_Listen</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$TCPListen</span>\\"</span><span class=\\"token operator\\">|</span> <span class=\\"token function\\">sed</span> <span class=\\"token string\\">'1d'</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'/tcp/ {print $5}'</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> -F: <span class=\\"token string\\">'{print $NF}'</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">sort</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">uniq</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">wc</span> <span class=\\"token parameter variable\\">-l</span><span class=\\"token variable\\">)</span></span>\\"</span>\\n<span class=\\"token punctuation\\">}</span>\\n\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">getCronStatus</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"############################ 计划任务检查 ########################\\"</span>\\n<span class=\\"token assign-left variable\\">Crontab</span><span class=\\"token operator\\">=</span><span class=\\"token number\\">0</span>\\n<span class=\\"token keyword\\">for</span> <span class=\\"token for-or-select variable\\">shell</span> <span class=\\"token keyword\\">in</span> <span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-v</span> <span class=\\"token string\\">\\"/sbin/nologin\\"</span> /etc/shells<span class=\\"token variable\\">)</span></span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">do</span>\\n<span class=\\"token keyword\\">for</span> <span class=\\"token for-or-select variable\\">user</span> <span class=\\"token keyword\\">in</span> <span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">grep</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$shell</span>\\"</span> /etc/passwd<span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> -F: <span class=\\"token string\\">'{print $1}'</span><span class=\\"token variable\\">)</span></span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">do</span>\\n<span class=\\"token function\\">crontab</span> <span class=\\"token parameter variable\\">-l</span> <span class=\\"token parameter variable\\">-u</span> <span class=\\"token variable\\">$user</span> <span class=\\"token operator\\">&gt;</span>/dev/null <span class=\\"token operator\\"><span class=\\"token file-descriptor important\\">2</span>&gt;</span><span class=\\"token file-descriptor important\\">&amp;1</span>\\n<span class=\\"token assign-left variable\\">status</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\">$?</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span> <span class=\\"token variable\\">$status</span> <span class=\\"token parameter variable\\">-eq</span> <span class=\\"token number\\">0</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">then</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$user</span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"--------\\"</span>\\n<span class=\\"token function\\">crontab</span> <span class=\\"token parameter variable\\">-l</span> <span class=\\"token parameter variable\\">-u</span> <span class=\\"token variable\\">$user</span>\\n<span class=\\"token builtin class-name\\">let</span> <span class=\\"token assign-left variable\\">Crontab</span><span class=\\"token operator\\">=</span>Crontab+<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">crontab</span> <span class=\\"token parameter variable\\">-l</span> <span class=\\"token parameter variable\\">-u</span> $user <span class=\\"token operator\\">|</span> <span class=\\"token function\\">wc</span> <span class=\\"token parameter variable\\">-l</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token keyword\\">fi</span>\\n<span class=\\"token keyword\\">done</span>\\n<span class=\\"token keyword\\">done</span>\\n<span class=\\"token comment\\">#计划任务</span>\\n<span class=\\"token function\\">find</span> /etc/cron* <span class=\\"token parameter variable\\">-type</span> f <span class=\\"token operator\\">|</span> <span class=\\"token function\\">xargs</span> <span class=\\"token parameter variable\\">-i</span> <span class=\\"token function\\">ls</span> <span class=\\"token parameter variable\\">-l</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">column</span> <span class=\\"token parameter variable\\">-t</span>\\n<span class=\\"token builtin class-name\\">let</span> <span class=\\"token assign-left variable\\">Crontab</span><span class=\\"token operator\\">=</span>Crontab+<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">find</span> /etc/cron* <span class=\\"token parameter variable\\">-type</span> f <span class=\\"token operator\\">|</span> <span class=\\"token function\\">wc</span> <span class=\\"token parameter variable\\">-l</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token comment\\">#报表信息</span>\\n<span class=\\"token assign-left variable\\">report_Crontab</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$Crontab</span>\\"</span> <span class=\\"token comment\\">#计划任务数</span>\\n<span class=\\"token punctuation\\">}</span>\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">getHowLongAgo</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n<span class=\\"token comment\\"># 计算一个时间戳离现在有多久了</span>\\n<span class=\\"token assign-left variable\\">datetime</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$*</span>\\"</span>\\n<span class=\\"token punctuation\\">[</span> <span class=\\"token parameter variable\\">-z</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$datetime</span>\\"</span> <span class=\\"token punctuation\\">]</span> <span class=\\"token operator\\">&amp;&amp;</span> <span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"错误的参数：getHowLongAgo() <span class=\\"token variable\\">$*</span>\\"</span>\\n<span class=\\"token assign-left variable\\">Timestamp</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">date</span> +%s <span class=\\"token parameter variable\\">-d</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$datetime</span>\\"</span><span class=\\"token variable\\">)</span></span> <span class=\\"token comment\\">#转化为时间戳</span>\\n<span class=\\"token assign-left variable\\">Now_Timestamp</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">date</span> +%s<span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">Difference_Timestamp</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$((</span>$Now_Timestamp<span class=\\"token operator\\">-</span>$Timestamp<span class=\\"token variable\\">))</span></span>\\n<span class=\\"token assign-left variable\\">days</span><span class=\\"token operator\\">=</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">;</span><span class=\\"token assign-left variable\\">hours</span><span class=\\"token operator\\">=</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">;</span><span class=\\"token assign-left variable\\">minutes</span><span class=\\"token operator\\">=</span><span class=\\"token number\\">0</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token assign-left variable\\">sec_in_day</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$((</span><span class=\\"token number\\">60</span><span class=\\"token operator\\">*</span><span class=\\"token number\\">60</span><span class=\\"token operator\\">*</span><span class=\\"token number\\">24</span><span class=\\"token variable\\">))</span></span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token assign-left variable\\">sec_in_hour</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$((</span><span class=\\"token number\\">60</span><span class=\\"token operator\\">*</span><span class=\\"token number\\">60</span><span class=\\"token variable\\">))</span></span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token assign-left variable\\">sec_in_minute</span><span class=\\"token operator\\">=</span><span class=\\"token number\\">60</span>\\n<span class=\\"token keyword\\">while</span> <span class=\\"token variable\\"><span class=\\"token punctuation\\">((</span> $<span class=\\"token punctuation\\">((</span>$Difference_Timestamp<span class=\\"token operator\\">-</span>$sec_in_day<span class=\\"token punctuation\\">))</span></span> <span class=\\"token operator\\">&gt;</span> <span class=\\"token number\\">1</span> <span class=\\"token punctuation\\">))</span>\\n<span class=\\"token keyword\\">do</span>\\n<span class=\\"token builtin class-name\\">let</span> <span class=\\"token assign-left variable\\">Difference_Timestamp</span><span class=\\"token operator\\">=</span>Difference_Timestamp-sec_in_day\\n<span class=\\"token builtin class-name\\">let</span> days++\\n<span class=\\"token keyword\\">done</span>\\n<span class=\\"token keyword\\">while</span> <span class=\\"token variable\\"><span class=\\"token punctuation\\">((</span> $<span class=\\"token punctuation\\">((</span>$Difference_Timestamp<span class=\\"token operator\\">-</span>$sec_in_hour<span class=\\"token punctuation\\">))</span></span> <span class=\\"token operator\\">&gt;</span> <span class=\\"token number\\">1</span> <span class=\\"token punctuation\\">))</span>\\n<span class=\\"token keyword\\">do</span>\\n<span class=\\"token builtin class-name\\">let</span> <span class=\\"token assign-left variable\\">Difference_Timestamp</span><span class=\\"token operator\\">=</span>Difference_Timestamp-sec_in_hour\\n<span class=\\"token builtin class-name\\">let</span> hours++\\n<span class=\\"token keyword\\">done</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$days</span> 天 <span class=\\"token variable\\">$hours</span> 小时前\\"</span>\\n<span class=\\"token punctuation\\">}</span>\\n\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">getUserLastLogin</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n<span class=\\"token comment\\"># 获取用户最近一次登录的时间，含年份</span>\\n<span class=\\"token comment\\"># 很遗憾last命令不支持显示年份，只有\\"last -t YYYYMMDDHHMMSS\\"表示某个时间之间的登录，我</span>\\n<span class=\\"token comment\\"># 们只能用最笨的方法了，对比今天之前和今年元旦之前（或者去年之前和前年之前……）某个用户</span>\\n<span class=\\"token comment\\"># 登录次数，如果登录统计次数有变化，则说明最近一次登录是今年。</span>\\n<span class=\\"token assign-left variable\\">username</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\">$1</span>\\n<span class=\\"token builtin class-name\\">:</span> <span class=\\"token variable\\">\${username<span class=\\"token operator\\">:=</span>\\"\`whoami\`\\"}</span>\\n<span class=\\"token assign-left variable\\">thisYear</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">date</span> +%Y<span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">oldesYear</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>last <span class=\\"token operator\\">|</span> <span class=\\"token function\\">tail</span> <span class=\\"token parameter variable\\">-n1</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{print $NF}'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token keyword\\">while</span><span class=\\"token variable\\"><span class=\\"token punctuation\\">((</span> $thisYear <span class=\\"token operator\\">&gt;=</span> $oldesYear<span class=\\"token punctuation\\">))</span></span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">do</span>\\n<span class=\\"token assign-left variable\\">loginBeforeToday</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>last $username <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> $username <span class=\\"token operator\\">|</span> <span class=\\"token function\\">wc</span> <span class=\\"token parameter variable\\">-l</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">loginBeforeNewYearsDayOfThisYear</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>last $username <span class=\\"token parameter variable\\">-t</span> $thisYear<span class=\\"token string\\">\\"0101000000\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> $username <span class=\\"token operator\\">|</span> <span class=\\"token function\\">wc</span> <span class=\\"token parameter variable\\">-l</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span> <span class=\\"token variable\\">$loginBeforeToday</span> <span class=\\"token parameter variable\\">-eq</span> <span class=\\"token number\\">0</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">then</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"从未登录过\\"</span>\\n<span class=\\"token builtin class-name\\">break</span>\\n<span class=\\"token keyword\\">elif</span> <span class=\\"token punctuation\\">[</span> <span class=\\"token variable\\">$loginBeforeToday</span> <span class=\\"token parameter variable\\">-gt</span> <span class=\\"token variable\\">$loginBeforeNewYearsDayOfThisYear</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">then</span>\\n<span class=\\"token assign-left variable\\">lastDateTime</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>last <span class=\\"token parameter variable\\">-i</span> $username <span class=\\"token operator\\">|</span> <span class=\\"token function\\">head</span> <span class=\\"token parameter variable\\">-n1</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> '<span class=\\"token punctuation\\">{</span>for<span class=\\"token punctuation\\">(</span>i<span class=\\"token operator\\">=</span><span class=\\"token number\\">4</span><span class=\\"token punctuation\\">;</span>i<span class=\\"token operator\\">&lt;</span><span class=\\"token punctuation\\">(</span>NF-2<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>i++<span class=\\"token variable\\">)</span></span><span class=\\"token builtin class-name\\">printf</span><span class=\\"token string\\">\\"%s \\"</span>,<span class=\\"token variable\\">$i</span><span class=\\"token punctuation\\">}</span><span class=\\"token string\\">')\\" $thisYear\\" #格式如: Sat Nov 2 20:33 2015\\nlastDateTime=$(date \\"+%Y-%m-%d %H:%M:%S\\" -d \\"$lastDateTime\\")\\necho \\"$lastDateTime\\"\\nbreak\\nelse\\nthisYear=$((thisYear-1))\\nfi\\ndone\\n\\n}\\n\\nfunction getUserStatus(){\\necho \\"\\"\\necho \\"\\"\\necho \\"############################ 用户检查 ############################\\"\\n#/etc/passwd 最后修改时间\\npwdfile=\\"$(cat /etc/passwd)\\"\\nModify=$(stat /etc/passwd | grep Modify | tr '</span><span class=\\"token builtin class-name\\">.</span><span class=\\"token string\\">' '</span> <span class=\\"token string\\">' | awk '</span><span class=\\"token punctuation\\">{</span>print <span class=\\"token variable\\">$2</span>,<span class=\\"token variable\\">$3</span><span class=\\"token punctuation\\">}</span><span class=\\"token string\\">')\\n\\necho \\"/etc/passwd 最后修改时间：$Modify ($(getHowLongAgo $Modify))\\"\\necho \\"\\"\\necho \\"特权用户\\"\\necho \\"--------\\"\\nRootUser=\\"\\"\\nfor user in $(echo \\"$pwdfile\\" | awk -F: '</span><span class=\\"token punctuation\\">{</span>print <span class=\\"token variable\\">$1</span><span class=\\"token punctuation\\">}</span><span class=\\"token string\\">');do\\nif [ $(id -u $user) -eq 0 ];then\\necho \\"$user\\"\\nRootUser=\\"$RootUser,$user\\"\\nfi\\ndone\\necho \\"\\"\\necho \\"用户列表\\"\\necho \\"--------\\"\\nUSERs=0\\necho \\"$(\\necho \\"用户名 UID GID HOME SHELL 最后一次登录\\"\\nfor shell in $(grep -v \\"/sbin/nologin\\" /etc/shells);do\\nfor username in $(grep \\"$shell\\" /etc/passwd| awk -F: '</span><span class=\\"token punctuation\\">{</span>print <span class=\\"token variable\\">$1</span><span class=\\"token punctuation\\">}</span><span class=\\"token string\\">');do\\nuserLastLogin=\\"$(getUserLastLogin $username)\\"\\necho \\"$pwdfile\\" | grep -w \\"$username\\" |grep -w \\"$shell\\"| awk -F: -v lastlogin=\\"$(echo \\"$userLastLogin\\" | tr '</span> <span class=\\"token string\\">' '</span>_<span class=\\"token string\\">')\\" '</span><span class=\\"token punctuation\\">{</span>print <span class=\\"token variable\\">$1</span>,<span class=\\"token variable\\">$3</span>,<span class=\\"token variable\\">$4</span>,<span class=\\"token variable\\">$6</span>,<span class=\\"token variable\\">$7</span>,lastlogin<span class=\\"token punctuation\\">}</span><span class=\\"token string\\">'\\ndone\\nlet USERs=USERs+$(echo \\"$pwdfile\\" | grep \\"$shell\\"| wc -l)\\ndone\\n)\\" | column -t\\necho \\"\\"\\necho \\"空密码用户\\"\\necho \\"----------\\"\\nUSEREmptyPassword=\\"\\"\\nfor shell in $(grep -v \\"/sbin/nologin\\" /etc/shells);do\\nfor user in $(echo \\"$pwdfile\\" | grep \\"$shell\\" | cut -d: -f1);do\\nr=$(awk -F: '</span><span class=\\"token variable\\">$2</span><span class=\\"token operator\\">==</span><span class=\\"token string\\">\\"!!\\"</span><span class=\\"token punctuation\\">{</span>print <span class=\\"token variable\\">$1</span><span class=\\"token punctuation\\">}</span><span class=\\"token string\\">' /etc/shadow | grep -w $user)\\nif [ ! -z $r ];then\\necho $r\\nUSEREmptyPassword=\\"$USEREmptyPassword,\\"$r\\nfi\\ndone \\ndone\\necho \\"\\"\\necho \\"相同ID的用户\\"\\necho \\"------------\\"\\nUSERTheSameUID=\\"\\"\\nUIDs=$(cut -d: -f3 /etc/passwd | sort | uniq -c | awk '</span><span class=\\"token variable\\">$1</span><span class=\\"token operator\\">&gt;</span><span class=\\"token number\\">1</span><span class=\\"token punctuation\\">{</span>print <span class=\\"token variable\\">$2</span><span class=\\"token punctuation\\">}</span><span class=\\"token string\\">')\\nfor uid in $UIDs;do\\necho -n \\"$uid\\";\\nUSERTheSameUID=\\"$uid\\"\\nr=$(awk -F: '</span><span class=\\"token assign-left variable\\">ORS</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"\\"</span><span class=\\"token punctuation\\">;</span><span class=\\"token variable\\">$3</span><span class=\\"token operator\\">==</span><span class=\\"token string\\">'\\"$uid\\"'</span><span class=\\"token punctuation\\">{</span>print <span class=\\"token string\\">\\":\\"</span>,<span class=\\"token variable\\">$1</span><span class=\\"token punctuation\\">}</span><span class=\\"token string\\">' /etc/passwd)\\necho \\"$r\\"\\necho \\"\\"\\nUSERTheSameUID=\\"$USERTheSameUID $r,\\"\\ndone\\n#报表信息\\nreport_USERs=\\"$USERs\\" #用户\\nreport_USEREmptyPassword=$(echo $USEREmptyPassword | sed '</span>s/^,//<span class=\\"token string\\">') \\nreport_USERTheSameUID=$(echo $USERTheSameUID | sed '</span>s/,$//<span class=\\"token string\\">') \\nreport_RootUser=$(echo $RootUser | sed '</span>s/^,//<span class=\\"token string\\">') #特权用户\\n}\\n\\n\\nfunction getPasswordStatus {\\necho \\"\\"\\necho \\"\\"\\necho \\"############################ 密码检查 ############################\\"\\npwdfile=\\"$(cat /etc/passwd)\\"\\necho \\"\\"\\necho \\"密码过期检查\\"\\necho \\"------------\\"\\nresult=\\"\\"\\nfor shell in $(grep -v \\"/sbin/nologin\\" /etc/shells);do\\nfor user in $(echo \\"$pwdfile\\" | grep \\"$shell\\" | cut -d: -f1);do\\nget_expiry_date=$(/usr/bin/chage -l $user | grep '</span>Password expires<span class=\\"token string\\">' | cut -d: -f2)\\nif [[ $get_expiry_date = '</span> never<span class=\\"token string\\">' || $get_expiry_date = '</span>never<span class=\\"token string\\">' ]];then\\nprintf \\"%-15s 永不过期\\\\n\\" $user\\nresult=\\"$result,$user:never\\"\\nelse\\npassword_expiry_date=$(date -d \\"$get_expiry_date\\" \\"+%s\\")\\ncurrent_date=$(date \\"+%s\\")\\ndiff=$(($password_expiry_date-$current_date))\\nlet DAYS=$(($diff/(60*60*24)))\\nprintf \\"%-15s %s天后过期\\\\n\\" $user $DAYS\\nresult=\\"$result,$user:$DAYS days\\"\\nfi\\ndone\\ndone\\nreport_PasswordExpiry=$(echo $result | sed '</span>s/^,//<span class=\\"token string\\">')\\n\\necho \\"\\"\\necho \\"密码策略检查\\"\\necho \\"------------\\"\\ngrep -v \\"#\\" /etc/login.defs | grep -E \\"PASS_MAX_DAYS|PASS_MIN_DAYS|PASS_MIN_LEN|PASS_WARN_AGE\\"\\n\\n\\n}\\n\\nfunction getSudoersStatus(){\\necho \\"\\"\\necho \\"\\"\\necho \\"############################ Sudoers检查 #########################\\"\\nconf=$(grep -v \\"^#\\" /etc/sudoers| grep -v \\"^Defaults\\" | sed '</span>/^$/d<span class=\\"token string\\">')\\necho \\"$conf\\"\\necho \\"\\"\\n#报表信息\\nreport_Sudoers=\\"$(echo $conf | wc -l)\\"\\n}\\n\\nfunction getInstalledStatus(){\\necho \\"\\"\\necho \\"\\"\\necho \\"############################ 软件检查 ############################\\"\\nrpm -qa --last | head | column -t \\n}\\n\\nfunction getProcessStatus(){\\necho \\"\\"\\necho \\"\\"\\necho \\"############################ 进程检查 ############################\\"\\nif [ $(ps -ef | grep defunct | grep -v grep | wc -l) -ge 1 ];then\\necho \\"\\"\\necho \\"僵尸进程\\";\\necho \\"--------\\"\\nps -ef | head -n1\\nps -ef | grep defunct | grep -v grep\\nfi\\necho \\"\\"\\necho \\"内存占用TOP10\\"\\necho \\"-------------\\"\\necho -e \\"PID %MEM RSS COMMAND\\n$(ps aux | awk '</span><span class=\\"token punctuation\\">{</span>print <span class=\\"token variable\\">$2</span>, <span class=\\"token variable\\">$4</span>, <span class=\\"token variable\\">$6</span>, <span class=\\"token variable\\">$11</span><span class=\\"token punctuation\\">}</span><span class=\\"token string\\">' | sort -k3rn | head -n 10 )\\"| column -t \\necho \\"\\"\\necho \\"CPU占用TOP10\\"\\necho \\"------------\\"\\ntop b -n1 | head -17 | tail -11\\n#报表信息\\nreport_DefunctProsess=\\"$(ps -ef | grep defunct | grep -v grep|wc -l)\\"\\n}\\n\\nfunction getJDKStatus(){\\necho \\"\\"\\necho \\"\\"\\necho \\"############################ JDK检查 #############################\\"\\njava -version 2&gt;/dev/null\\nif [ $? -eq 0 ];then\\njava -version 2&gt;&amp;1\\nfi\\necho \\"JAVA_HOME=\\\\\\"$JAVA_HOME\\\\\\"\\"\\n#报表信息\\nreport_JDK=\\"$(java -version 2&gt;&amp;1 | grep version | awk '</span><span class=\\"token punctuation\\">{</span>print <span class=\\"token variable\\">$1</span>,<span class=\\"token variable\\">$3</span><span class=\\"token punctuation\\">}</span><span class=\\"token string\\">' | tr -d '</span><span class=\\"token string\\">\\"')\\"</span>\\n<span class=\\"token punctuation\\">}</span>\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">getSyslogStatus</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"############################ syslog检查 ##########################\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"服务状态：<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>getState rsyslog<span class=\\"token variable\\">)</span></span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"/etc/rsyslog.conf\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"-----------------\\"</span>\\n<span class=\\"token function\\">cat</span> /etc/rsyslog.conf <span class=\\"token operator\\"><span class=\\"token file-descriptor important\\">2</span>&gt;</span>/dev/null <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-v</span> <span class=\\"token string\\">\\"^#\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-v</span> <span class=\\"token string\\">\\"^<span class=\\"token entity\\" title=\\"\\\\\\\\\\">\\\\\\\\</span>$\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">sed</span> <span class=\\"token string\\">'/^$/d'</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">column</span> <span class=\\"token parameter variable\\">-t</span>\\n<span class=\\"token comment\\">#报表信息</span>\\n<span class=\\"token assign-left variable\\">report_Syslog</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>getState rsyslog<span class=\\"token variable\\">)</span></span>\\"</span>\\n<span class=\\"token punctuation\\">}</span>\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">getFirewallStatus</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"############################ 防火墙检查 ##########################\\"</span>\\n<span class=\\"token comment\\">#防火墙状态，策略等</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">[</span> <span class=\\"token variable\\">$centosVersion</span> <span class=\\"token operator\\">&lt;</span> <span class=\\"token number\\">7</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">then</span>\\n/etc/init.d/iptables status <span class=\\"token operator\\">&gt;</span>/dev/null <span class=\\"token operator\\"><span class=\\"token file-descriptor important\\">2</span>&gt;</span><span class=\\"token file-descriptor important\\">&amp;1</span>\\n<span class=\\"token assign-left variable\\">status</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\">$?</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span> <span class=\\"token variable\\">$status</span> <span class=\\"token parameter variable\\">-eq</span> <span class=\\"token number\\">0</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">then</span>\\n<span class=\\"token assign-left variable\\">s</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"active\\"</span>\\n<span class=\\"token keyword\\">elif</span> <span class=\\"token punctuation\\">[</span> <span class=\\"token variable\\">$status</span> <span class=\\"token parameter variable\\">-eq</span> <span class=\\"token number\\">3</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">then</span>\\n<span class=\\"token assign-left variable\\">s</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"inactive\\"</span>\\n<span class=\\"token keyword\\">elif</span> <span class=\\"token punctuation\\">[</span> <span class=\\"token variable\\">$status</span> <span class=\\"token parameter variable\\">-eq</span> <span class=\\"token number\\">4</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">then</span>\\n<span class=\\"token assign-left variable\\">s</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"permission denied\\"</span>\\n<span class=\\"token keyword\\">else</span>\\n<span class=\\"token assign-left variable\\">s</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"unknown\\"</span>\\n<span class=\\"token keyword\\">fi</span>\\n<span class=\\"token keyword\\">else</span>\\n<span class=\\"token assign-left variable\\">s</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>getState iptables<span class=\\"token variable\\">)</span></span>\\"</span>\\n<span class=\\"token keyword\\">fi</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"iptables: <span class=\\"token variable\\">$s</span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"/etc/sysconfig/iptables\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"-----------------------\\"</span>\\n<span class=\\"token function\\">cat</span> /etc/sysconfig/iptables <span class=\\"token operator\\"><span class=\\"token file-descriptor important\\">2</span>&gt;</span>/dev/null\\n<span class=\\"token comment\\">#报表信息</span>\\n<span class=\\"token assign-left variable\\">report_Firewall</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$s</span>\\"</span>\\n<span class=\\"token punctuation\\">}</span>\\n\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">getSNMPStatus</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n<span class=\\"token comment\\">#SNMP服务状态，配置等</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"############################ SNMP检查 ############################\\"</span>\\n<span class=\\"token assign-left variable\\">status</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>getState snmpd<span class=\\"token variable\\">)</span></span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"服务状态：<span class=\\"token variable\\">$status</span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span> <span class=\\"token parameter variable\\">-e</span> /etc/snmp/snmpd.conf <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">then</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"/etc/snmp/snmpd.conf\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"--------------------\\"</span>\\n<span class=\\"token function\\">cat</span> /etc/snmp/snmpd.conf <span class=\\"token operator\\"><span class=\\"token file-descriptor important\\">2</span>&gt;</span>/dev/null <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-v</span> <span class=\\"token string\\">\\"^#\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">sed</span> <span class=\\"token string\\">'/^$/d'</span>\\n<span class=\\"token keyword\\">fi</span>\\n<span class=\\"token comment\\">#报表信息</span>\\n<span class=\\"token assign-left variable\\">report_SNMP</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>getState snmpd<span class=\\"token variable\\">)</span></span>\\"</span>\\n<span class=\\"token punctuation\\">}</span>\\n\\n\\n\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">getState</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">[</span> <span class=\\"token variable\\">$centosVersion</span> <span class=\\"token operator\\">&lt;</span> <span class=\\"token number\\">7</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">then</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span> <span class=\\"token parameter variable\\">-e</span> <span class=\\"token string\\">\\"/etc/init.d/<span class=\\"token variable\\">$1</span>\\"</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">then</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span> <span class=\\"token variable\\"><span class=\\"token variable\\">\`</span>/etc/init.d/$1 status <span class=\\"token operator\\"><span class=\\"token file-descriptor important\\">2</span>&gt;</span>/dev/null <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-E</span> <span class=\\"token string\\">\\"is running|正在运行\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">wc</span> <span class=\\"token parameter variable\\">-l</span><span class=\\"token variable\\">\`</span></span> <span class=\\"token parameter variable\\">-ge</span> <span class=\\"token number\\">1</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">then</span>\\n<span class=\\"token assign-left variable\\">r</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"active\\"</span>\\n<span class=\\"token keyword\\">else</span>\\n<span class=\\"token assign-left variable\\">r</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"inactive\\"</span>\\n<span class=\\"token keyword\\">fi</span>\\n<span class=\\"token keyword\\">else</span>\\n<span class=\\"token assign-left variable\\">r</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"unknown\\"</span>\\n<span class=\\"token keyword\\">fi</span>\\n<span class=\\"token keyword\\">else</span>\\n<span class=\\"token comment\\">#CentOS 7+</span>\\n<span class=\\"token assign-left variable\\">r</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>systemctl is-active $1 <span class=\\"token operator\\"><span class=\\"token file-descriptor important\\">2</span>&gt;</span><span class=\\"token file-descriptor important\\">&amp;1</span><span class=\\"token variable\\">)</span></span>\\"</span>\\n<span class=\\"token keyword\\">fi</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$r</span>\\"</span>\\n<span class=\\"token punctuation\\">}</span>\\n\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">getSSHStatus</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n<span class=\\"token comment\\">#SSHD服务状态，配置,受信任主机等</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"############################ SSH检查 #############################\\"</span>\\n<span class=\\"token comment\\">#检查受信任主机</span>\\n<span class=\\"token assign-left variable\\">pwdfile</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">cat</span> /etc/passwd<span class=\\"token variable\\">)</span></span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"服务状态：<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>getState sshd<span class=\\"token variable\\">)</span></span>\\"</span>\\n<span class=\\"token assign-left variable\\">Protocol_Version</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">cat</span> /etc/ssh/sshd_config <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> Protocol <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{print $2}'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"SSH协议版本：<span class=\\"token variable\\">$Protocol_Version</span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"信任主机\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"--------\\"</span>\\n<span class=\\"token assign-left variable\\">authorized</span><span class=\\"token operator\\">=</span><span class=\\"token number\\">0</span>\\n<span class=\\"token keyword\\">for</span> <span class=\\"token for-or-select variable\\">user</span> <span class=\\"token keyword\\">in</span> <span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$pwdfile</span>\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> /bin/bash <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> -F: <span class=\\"token string\\">'{print $1}'</span><span class=\\"token variable\\">)</span></span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">do</span>\\n<span class=\\"token assign-left variable\\">authorize_file</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$pwdfile</span>\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-w</span> $user <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> -F: <span class=\\"token string\\">'{printf $6\\"/.ssh/authorized_keys\\"}'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">authorized_host</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">cat</span> $authorize_file <span class=\\"token operator\\"><span class=\\"token file-descriptor important\\">2</span>&gt;</span>/dev/null <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{print $3}'</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">tr</span> <span class=\\"token string\\">'\\\\n'</span> <span class=\\"token string\\">','</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">sed</span> <span class=\\"token string\\">'s/,$//'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span> <span class=\\"token operator\\">!</span> <span class=\\"token parameter variable\\">-z</span> <span class=\\"token variable\\">$authorized_host</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">then</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$user</span> 授权 <span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$authorized_host</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span> 无密码访问\\"</span>\\n<span class=\\"token keyword\\">fi</span>\\n<span class=\\"token builtin class-name\\">let</span> <span class=\\"token assign-left variable\\">authorized</span><span class=\\"token operator\\">=</span>authorized+<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">cat</span> $authorize_file <span class=\\"token operator\\"><span class=\\"token file-descriptor important\\">2</span>&gt;</span>/dev/null <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{print $3}'</span><span class=\\"token operator\\">|</span><span class=\\"token function\\">wc</span> <span class=\\"token parameter variable\\">-l</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token keyword\\">done</span>\\n\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"是否允许ROOT远程登录\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"--------------------\\"</span>\\n<span class=\\"token assign-left variable\\">config</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">cat</span> /etc/ssh/sshd_config <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> PermitRootLogin<span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">firstChar</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\">\${config<span class=\\"token operator\\">:</span>0<span class=\\"token operator\\">:</span>1}</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span> <span class=\\"token variable\\">$firstChar</span> <span class=\\"token operator\\">==</span> <span class=\\"token string\\">\\"#\\"</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">then</span>\\n<span class=\\"token assign-left variable\\">PermitRootLogin</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"yes\\"</span> <span class=\\"token comment\\">#默认是允许ROOT远程登录的</span>\\n<span class=\\"token keyword\\">else</span>\\n<span class=\\"token assign-left variable\\">PermitRootLogin</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token builtin class-name\\">echo</span> $config <span class=\\"token operator\\">|</span> <span class=\\"token function\\">awk</span> <span class=\\"token string\\">'{print $2}'</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token keyword\\">fi</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"PermitRootLogin <span class=\\"token variable\\">$PermitRootLogin</span>\\"</span>\\n\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"/etc/ssh/sshd_config\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"--------------------\\"</span>\\n<span class=\\"token function\\">cat</span> /etc/ssh/sshd_config <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-v</span> <span class=\\"token string\\">\\"^#\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">sed</span> <span class=\\"token string\\">'/^$/d'</span>\\n\\n<span class=\\"token comment\\">#报表信息</span>\\n<span class=\\"token assign-left variable\\">report_SSHAuthorized</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$authorized</span>\\"</span> <span class=\\"token comment\\">#SSH信任主机</span>\\n<span class=\\"token assign-left variable\\">report_SSHDProtocolVersion</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$Protocol_Version</span>\\"</span> <span class=\\"token comment\\">#SSH协议版本</span>\\n<span class=\\"token assign-left variable\\">report_SSHDPermitRootLogin</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\">$PermitRootLogin</span>\\"</span> <span class=\\"token comment\\">#允许root远程登录</span>\\n<span class=\\"token punctuation\\">}</span>\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">getNTPStatus</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n<span class=\\"token comment\\">#NTP服务状态，当前时间，配置等</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"############################ NTP检查 #############################\\"</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span> <span class=\\"token parameter variable\\">-e</span> /etc/ntp.conf <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span><span class=\\"token keyword\\">then</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"服务状态：<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>getState ntpd<span class=\\"token variable\\">)</span></span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"/etc/ntp.conf\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"-------------\\"</span>\\n<span class=\\"token function\\">cat</span> /etc/ntp.conf <span class=\\"token operator\\"><span class=\\"token file-descriptor important\\">2</span>&gt;</span>/dev/null <span class=\\"token operator\\">|</span> <span class=\\"token function\\">grep</span> <span class=\\"token parameter variable\\">-v</span> <span class=\\"token string\\">\\"^#\\"</span> <span class=\\"token operator\\">|</span> <span class=\\"token function\\">sed</span> <span class=\\"token string\\">'/^$/d'</span>\\n<span class=\\"token keyword\\">fi</span>\\n<span class=\\"token comment\\">#报表信息</span>\\n<span class=\\"token assign-left variable\\">report_NTP</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"<span class=\\"token variable\\"><span class=\\"token variable\\">$(</span>getState ntpd<span class=\\"token variable\\">)</span></span>\\"</span>\\n<span class=\\"token punctuation\\">}</span>\\n\\n\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">uploadHostDailyCheckReport</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\n<span class=\\"token assign-left variable\\">json</span><span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"{\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>DateTime<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_DateTime</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>Hostname<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_Hostname</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>OSRelease<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_OSRelease</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>Kernel<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_Kernel</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>Language<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_Language</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>LastReboot<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_LastReboot</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>Uptime<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_Uptime</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>CPUs<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_CPUs</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>CPUType<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_CPUType</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>Arch<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_Arch</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>MemTotal<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_MemTotal</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>MemFree<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_MemFree</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>MemUsedPercent<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_MemUsedPercent</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>DiskTotal<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_DiskTotal</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>DiskFree<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_DiskFree</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>DiskUsedPercent<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_DiskUsedPercent</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>InodeTotal<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_InodeTotal</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>InodeFree<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_InodeFree</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>InodeUsedPercent<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_InodeUsedPercent</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>IP<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_IP</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>MAC<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_MAC</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>Gateway<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_Gateway</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>DNS<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_DNS</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>Listen<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_Listen</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>Selinux<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_Selinux</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>Firewall<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_Firewall</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>USERs<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_USERs</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>USEREmptyPassword<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_USEREmptyPassword</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>USERTheSameUID<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_USERTheSameUID</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>PasswordExpiry<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_PasswordExpiry</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>RootUser<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_RootUser</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>Sudoers<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_Sudoers</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>SSHAuthorized<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_SSHAuthorized</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>SSHDProtocolVersion<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_SSHDProtocolVersion</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>SSHDPermitRootLogin<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_SSHDPermitRootLogin</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>DefunctProsess<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_DefunctProsess</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>SelfInitiatedService<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_SelfInitiatedService</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>SelfInitiatedProgram<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_SelfInitiatedProgram</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>RuningService<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_RuningService</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>Crontab<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_Crontab</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>Syslog<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_Syslog</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>SNMP<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_SNMP</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>NTP<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_NTP</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>,\\n<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>JDK<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>:<span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span><span class=\\"token variable\\">$report_JDK</span><span class=\\"token entity\\" title=\\"\\\\&quot;\\">\\\\\\"</span>\\n}\\"</span>\\n<span class=\\"token comment\\">#echo \\"$json\\" </span>\\n<span class=\\"token function\\">curl</span> <span class=\\"token parameter variable\\">-l</span> <span class=\\"token parameter variable\\">-H</span> <span class=\\"token string\\">\\"Content-type: application/json\\"</span> <span class=\\"token parameter variable\\">-X</span> POST <span class=\\"token parameter variable\\">-d</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$json</span>\\"</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\">$uploadHostDailyCheckReportApi</span>\\"</span> <span class=\\"token operator\\"><span class=\\"token file-descriptor important\\">2</span>&gt;</span>/dev/null\\n<span class=\\"token punctuation\\">}</span>\\n\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">getchage_file_24h</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token punctuation\\">{</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"############################ 文件检查 #############################\\"</span>\\n    <span class=\\"token assign-left variable\\">check2</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">find</span> / <span class=\\"token parameter variable\\">-name</span> <span class=\\"token string\\">'*.sh'</span> <span class=\\"token parameter variable\\">-mtime</span> <span class=\\"token parameter variable\\">-1</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">check21</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">find</span> / <span class=\\"token parameter variable\\">-name</span> <span class=\\"token string\\">'*.asp'</span> <span class=\\"token parameter variable\\">-mtime</span> <span class=\\"token parameter variable\\">-1</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">check22</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">find</span> / <span class=\\"token parameter variable\\">-name</span> <span class=\\"token string\\">'*.php'</span> <span class=\\"token parameter variable\\">-mtime</span> <span class=\\"token parameter variable\\">-1</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">check23</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">find</span> / <span class=\\"token parameter variable\\">-name</span> <span class=\\"token string\\">'*.aspx'</span> <span class=\\"token parameter variable\\">-mtime</span> <span class=\\"token parameter variable\\">-1</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">check24</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">find</span> / <span class=\\"token parameter variable\\">-name</span> <span class=\\"token string\\">'*.jsp'</span> <span class=\\"token parameter variable\\">-mtime</span> <span class=\\"token parameter variable\\">-1</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">check25</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">find</span> / <span class=\\"token parameter variable\\">-name</span> <span class=\\"token string\\">'*.html'</span> <span class=\\"token parameter variable\\">-mtime</span> <span class=\\"token parameter variable\\">-1</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">check26</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">find</span> / <span class=\\"token parameter variable\\">-name</span> <span class=\\"token string\\">'*.htm'</span> <span class=\\"token parameter variable\\">-mtime</span> <span class=\\"token parameter variable\\">-1</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">check9</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">find</span> / <span class=\\"token parameter variable\\">-name</span> core <span class=\\"token parameter variable\\">-exec</span> <span class=\\"token function\\">ls</span> <span class=\\"token parameter variable\\">-l</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span> <span class=\\"token punctuation\\">\\\\</span><span class=\\"token punctuation\\">;</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">check10</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">cat</span> /etc/crontab<span class=\\"token variable\\">)</span></span>\\n<span class=\\"token assign-left variable\\">check12</span><span class=\\"token operator\\">=</span><span class=\\"token variable\\"><span class=\\"token variable\\">$(</span><span class=\\"token function\\">ls</span> <span class=\\"token parameter variable\\">-alt</span> /usr/bin <span class=\\"token operator\\">|</span> <span class=\\"token function\\">head</span> <span class=\\"token parameter variable\\">-10</span><span class=\\"token variable\\">)</span></span>\\n<span class=\\"token function\\">cat</span> <span class=\\"token operator\\">&lt;&lt;</span><span class=\\"token string\\">EOF\\n\\n############################查看所有被修改过的文件返回最近24小时内的############################\\n<span class=\\"token variable\\">\${check2}</span>\\n<span class=\\"token variable\\">\${check21}</span>\\n<span class=\\"token variable\\">\${check22}</span>\\n<span class=\\"token variable\\">\${check23}</span>\\n<span class=\\"token variable\\">\${check24}</span>\\n<span class=\\"token variable\\">\${check25}</span>\\n<span class=\\"token variable\\">\${check26}</span>\\n<span class=\\"token variable\\">\${line}</span>\\n\\n############################检查定时文件的完整性############################\\n<span class=\\"token variable\\">\${check10}</span>\\n<span class=\\"token variable\\">\${line}</span>\\n\\n############################查看系统命令是否被替换############################\\n<span class=\\"token variable\\">\${check12}</span>\\n<span class=\\"token variable\\">\${line}</span>\\nEOF</span>\\n<span class=\\"token punctuation\\">}</span>\\n\\n<span class=\\"token keyword\\">function</span> <span class=\\"token function-name function\\">check</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">{</span>\\nversion\\ngetSystemStatus\\ngetCpuStatus\\ngetMemStatus\\ngetDiskStatus\\ngetNetworkStatus\\ngetListenStatus\\ngetProcessStatus\\ngetServiceStatus\\ngetAutoStartStatus\\ngetLoginStatus\\ngetCronStatus\\ngetUserStatus\\ngetPasswordStatus\\ngetSudoersStatus\\ngetJDKStatus\\ngetFirewallStatus\\ngetSSHStatus\\ngetSyslogStatus\\ngetSNMPStatus\\ngetNTPStatus\\ngetInstalledStatus\\ngetchage_file_24h\\n<span class=\\"token punctuation\\">}</span>\\n\\n\\n<span class=\\"token comment\\">#执行检查并保存检查结果</span>\\ncheck <span class=\\"token operator\\">&gt;</span> <span class=\\"token variable\\">$RESULTFILE</span>\\n\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token string\\">\\"检查结果：<span class=\\"token variable\\">$RESULTFILE</span>\\"</span>\\n<span class=\\"token builtin class-name\\">echo</span> <span class=\\"token parameter variable\\">-e</span> <span class=\\"token string\\">\\"<span class=\\"token variable\\"><span class=\\"token variable\\">\`</span><span class=\\"token function\\">date</span> <span class=\\"token string\\">\\"+%Y-%m-%d %H:%M:%S\\"</span><span class=\\"token variable\\">\`</span></span> 阿里云PHP企业平台巡检报告\\"</span>  <span class=\\"token operator\\">|</span> mail <span class=\\"token parameter variable\\">-a</span> <span class=\\"token variable\\">$RESULTFILE</span> <span class=\\"token parameter variable\\">-s</span> <span class=\\"token string\\">\\"阿里云PHP企业平台巡检报告\\"</span> h@163.com\\n\\nEND\\n</code></pre><div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}`);export{s as data};
