import{_ as e}from"./plugin-vue_export-helper.21dcd24c.js";import{o,c,a as n,e as p,d as t,b as s,r as l}from"./app.250095a4.js";const u={},i=t(`<h2 id="\u4E00\u3001\u7EBF\u7A0B\u57FA\u7840" tabindex="-1"><a class="header-anchor" href="#\u4E00\u3001\u7EBF\u7A0B\u57FA\u7840" aria-hidden="true">#</a> \u4E00\u3001\u7EBF\u7A0B\u57FA\u7840</h2><h3 id="_1\u3001java\u591A\u7EBF\u7A0B\u76F8\u5173\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_1\u3001java\u591A\u7EBF\u7A0B\u76F8\u5173\u6982\u5FF5" aria-hidden="true">#</a> 1\u3001Java\u591A\u7EBF\u7A0B\u76F8\u5173\u6982\u5FF5</h3><h4 id="_1\u3001\u8FDB\u7A0B" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u8FDB\u7A0B" aria-hidden="true">#</a> 1\u3001\u8FDB\u7A0B</h4><p>\u662F\u7A0B\u5E8F\u7684\u2F00\u6B21\u6267\u2F8F\uFF0C\u662F\u7CFB\u7EDF\u8FDB\u2F8F\u8D44\u6E90\u5206\u914D\u548C\u8C03\u5EA6\u7684\u72EC\u2F74\u5355\u4F4D\uFF0C\u6BCF\u2F00\u4E2A\u8FDB\u7A0B\u90FD\u6709\u5B83\u2F83\u2F30\u7684\u5185\u5B58\u7A7A\u95F4\u548C\u7CFB\u7EDF\u8D44\u6E90</p><p>\u8FDB\u7A0B\uFF08Process\uFF09\u662F\u8BA1\u7B97\u673A\u4E2D\u7684\u7A0B\u5E8F\u5173\u4E8E\u67D0\u6570\u636E\u96C6\u5408\u4E0A\u7684\u4E00\u6B21\u8FD0\u884C\u6D3B\u52A8\uFF0C\u662F\u7CFB\u7EDF\u8FDB\u884C\u8D44\u6E90\u5206\u914D\u548C\u8C03\u5EA6\u7684\u57FA\u672C\u5355\u4F4D\uFF0C\u662F\u64CD\u4F5C\u7CFB\u7EDF\u7ED3\u6784\u7684\u57FA\u7840\u3002\u7A0B\u5E8F\u662F\u6307\u4EE4\u3001\u6570\u636E\u53CA\u5176\u7EC4\u7EC7\u5F62\u5F0F\u7684\u63CF\u8FF0\uFF0C\u8FDB\u7A0B\u662F\u7A0B\u5E8F\u7684\u5B9E\u4F53\u3002</p><p><strong>\u8FDB\u7A0B\u5177\u6709\u7684\u7279\u5F81\uFF1A</strong></p><ul><li><strong>\u52A8\u6001\u6027</strong>\uFF1A\u8FDB\u7A0B\u662F\u7A0B\u5E8F\u7684\u4E00\u6B21\u6267\u884C\u8FC7\u7A0B\uFF0C\u662F\u4E34\u65F6\u7684\uFF0C\u6709\u751F\u547D\u671F\u7684\uFF0C\u662F\u52A8\u6001\u4EA7\u751F\uFF0C\u52A8\u6001\u6D88\u4EA1\u7684</li><li><strong>\u5E76\u53D1\u6027</strong>\uFF1A\u4EFB\u4F55\u8FDB\u7A0B\u90FD\u53EF\u4EE5\u540C\u5176\u4ED6\u8FDB\u884C\u4E00\u8D77\u5E76\u53D1\u6267\u884C</li><li><strong>\u72EC\u7ACB\u6027</strong>\uFF1A\u8FDB\u7A0B\u662F\u7CFB\u7EDF\u8FDB\u884C\u8D44\u6E90\u5206\u914D\u548C\u8C03\u5EA6\u7684\u4E00\u4E2A\u72EC\u7ACB\u5355\u4F4D</li><li><strong>\u7ED3\u6784\u6027</strong>\uFF1A\u8FDB\u7A0B\u7531\u7A0B\u5E8F\uFF0C\u6570\u636E\u548C\u8FDB\u7A0B\u63A7\u5236\u5757\u4E09\u90E8\u5206\u7EC4\u6210</li></ul><p>\u6211\u4EEC\u7ECF\u5E38\u4F7F\u7528windows\u7CFB\u7EDF\uFF0C\u7ECF\u5E38\u4F1A\u770B\u89C1.exe\u540E\u7F00\u7684\u6587\u4EF6\uFF0C\u53CC\u51FB\u8FD9\u4E2A.exe\u6587\u4EF6\u7684\u65F6\u5019\uFF0C\u8FD9\u4E2A\u6587\u4EF6\u4E2D\u7684\u6307\u4EE4\u5C31\u4F1A\u88AB\u7CFB\u7EDF\u52A0\u8F7D\uFF0C\u90A3\u4E48\u6211\u4EEC\u5C31\u80FD\u5F97\u5230\u4E00\u4E2A\u5173\u4E8E\u8FD9\u4E2A.exe\u7A0B\u5E8F\u7684\u8FDB\u7A0B\u3002\u8FDB\u7A0B\u662F**\u201C\u6D3B\u201D**\u7684\uFF0C\u6216\u8005\u8BF4\u662F\u6B63\u5728\u88AB\u6267\u884C\u7684\u3002</p><h4 id="_2\u3001\u7EBF\u7A0B" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u7EBF\u7A0B" aria-hidden="true">#</a> 2\u3001\u7EBF\u7A0B</h4><p>\u5728\u540C\u2F00\u4E2A\u8FDB\u7A0B\u5185\u2F1C\u53EF\u4EE5\u6267\u2F8F\u591A\u4E2A\u4EFB\u52A1\uFF0C\u2F7D\u8FD9\u6BCF\u2F00\u4E2A\u4EFB\u52A1\u6211\u4EEC\u5C31\u53EF\u4EE5\u770B\u505A\u662F\u2F00\u4E2A\u7EBF\u7A0B \u2F00\u4E2A\u8FDB\u7A0B\u4F1A\u67091\u4E2A\u6216\u591A\u4E2A\u7EBF\u7A0B\u7684</p><p>\u7EBF\u7A0B\u662F\u8F7B\u91CF\u7EA7\u7684\u8FDB\u7A0B\uFF0C\u662F\u7A0B\u5E8F\u6267\u884C\u7684\u6700\u5C0F\u5355\u5143\uFF0C\u4F7F\u7528\u591A\u7EBF\u7A0B\u800C\u4E0D\u662F\u591A\u8FDB\u7A0B\u53BB\u8FDB\u884C\u5E76\u53D1\u7A0B\u5E8F\u7684\u8BBE\u8BA1\uFF0C\u662F\u56E0\u4E3A\u7EBF\u7A0B\u95F4\u7684\u5207\u6362\u548C\u8C03\u5EA6\u7684\u6210\u672C\u8FDC\u8FDC\u5C0F\u4E8E\u8FDB\u7A0B\u3002</p><h4 id="_3\u3001\u8FDB\u7A0B\u4E0E\u7EBF\u7A0B\u7684\u4E00\u4E2A\u7B80\u5355\u89E3\u91CA" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u8FDB\u7A0B\u4E0E\u7EBF\u7A0B\u7684\u4E00\u4E2A\u7B80\u5355\u89E3\u91CA" aria-hidden="true">#</a> 3\u3001\u8FDB\u7A0B\u4E0E\u7EBF\u7A0B\u7684\u4E00\u4E2A\u7B80\u5355\u89E3\u91CA</h4><p>\u8FDB\u7A0B\uFF08process\uFF09\u548C\u7EBF\u7A0B\uFF08thread\uFF09\u662F\u64CD\u4F5C\u7CFB\u7EDF\u7684\u57FA\u672C\u6982\u5FF5\uFF0C\u4F46\u662F\u5B83\u4EEC\u6BD4\u8F83\u62BD\u8C61\uFF0C\u4E0D\u5BB9\u6613\u638C\u63E1\u3002</p><p>1.\u8BA1\u7B97\u673A\u7684\u6838\u5FC3\u662FCPU\uFF0C\u5B83\u627F\u62C5\u4E86\u6240\u6709\u7684\u8BA1\u7B97\u4EFB\u52A1\u3002\u5B83\u5C31\u50CF\u4E00\u5EA7\u5DE5\u5382\uFF0C\u65F6\u523B\u5728\u8FD0\u884C\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/f65f6640-fde3-4f6f-be2a-aa05b6a3c1b9.png" alt="f65f6640-fde3-4f6f-be2a-aa05b6a3c1b9"></p><p>2.\u5047\u5B9A\u5DE5\u5382\u7684\u7535\u529B\u6709\u9650\uFF0C\u4E00\u6B21\u53EA\u80FD\u4F9B\u7ED9\u4E00\u4E2A\u8F66\u95F4\u4F7F\u7528\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C\u4E00\u4E2A\u8F66\u95F4\u5F00\u5DE5\u7684\u65F6\u5019\uFF0C\u5176\u4ED6\u8F66\u95F4\u90FD\u5FC5\u987B\u505C\u5DE5\u3002\u80CC\u540E\u7684\u542B\u4E49\u5C31\u662F\uFF0C\u5355\u4E2ACPU\u4E00\u6B21\u53EA\u80FD\u8FD0\u884C\u4E00\u4E2A\u4EFB\u52A1\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/aa874eba-0c27-4924-be97-9c853c009ca9.png" alt="aa874eba-0c27-4924-be97-9c853c009ca9"></p><p>3.\u8FDB\u7A0B\u5C31\u597D\u6BD4\u5DE5\u5382\u7684\u8F66\u95F4\uFF0C\u5B83\u4EE3\u8868CPU\u6240\u80FD\u5904\u7406\u7684\u5355\u4E2A\u4EFB\u52A1\u3002\u4EFB\u4E00\u65F6\u523B\uFF0CCPU\u603B\u662F\u8FD0\u884C\u4E00\u4E2A\u8FDB\u7A0B\uFF0C\u5176\u4ED6\u8FDB\u7A0B\u5904\u4E8E\u975E\u8FD0\u884C\u72B6\u6001\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/f03b160d-4e18-46a1-9158-913a4afdb2b2.png" alt="f03b160d-4e18-46a1-9158-913a4afdb2b2"></p><p>4.\u4E00\u4E2A\u8F66\u95F4\u91CC\uFF0C\u53EF\u4EE5\u6709\u5F88\u591A\u5DE5\u4EBA\u3002\u4ED6\u4EEC\u534F\u540C\u5B8C\u6210\u4E00\u4E2A\u4EFB\u52A1\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/9985e48b-92bd-434e-8a4e-6f85c95a8dbd.png" alt="9985e48b-92bd-434e-8a4e-6f85c95a8dbd"></p><p>5.\u7EBF\u7A0B\u5C31\u597D\u6BD4\u8F66\u95F4\u91CC\u7684\u5DE5\u4EBA\u3002\u4E00\u4E2A\u8FDB\u7A0B\u53EF\u4EE5\u5305\u62EC\u591A\u4E2A\u7EBF\u7A0B\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/3dc76caa-b3d9-4555-b8c4-c805bb97e03e.png" alt="3dc76caa-b3d9-4555-b8c4-c805bb97e03e"></p><p>6.\u8F66\u95F4\u7684\u7A7A\u95F4\u662F\u5DE5\u4EBA\u4EEC\u5171\u4EAB\u7684\uFF0C\u6BD4\u5982\u8BB8\u591A\u623F\u95F4\u662F\u6BCF\u4E2A\u5DE5\u4EBA\u90FD\u53EF\u4EE5\u8FDB\u51FA\u7684\u3002\u8FD9\u8C61\u5F81\u4E00\u4E2A\u8FDB\u7A0B\u7684\u5185\u5B58\u7A7A\u95F4\u662F\u5171\u4EAB\u7684\uFF0C\u6BCF\u4E2A\u7EBF\u7A0B\u90FD\u53EF\u4EE5\u4F7F\u7528\u8FD9\u4E9B\u5171\u4EAB\u5185\u5B58\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/b3ef804e-346b-4280-bb8d-809c9bd42853.png" alt="b3ef804e-346b-4280-bb8d-809c9bd42853"></p><p>7.\u53EF\u662F\uFF0C\u6BCF\u95F4\u623F\u95F4\u7684\u5927\u5C0F\u4E0D\u540C\uFF0C\u6709\u4E9B\u623F\u95F4\u6700\u591A\u53EA\u80FD\u5BB9\u7EB3\u4E00\u4E2A\u4EBA\uFF0C\u6BD4\u5982\u5395\u6240\u3002\u91CC\u9762\u6709\u4EBA\u7684\u65F6\u5019\uFF0C\u5176\u4ED6\u4EBA\u5C31\u4E0D\u80FD\u8FDB\u53BB\u4E86\u3002\u8FD9\u4EE3\u8868\u4E00\u4E2A\u7EBF\u7A0B\u4F7F\u7528\u67D0\u4E9B\u5171\u4EAB\u5185\u5B58\u65F6\uFF0C\u5176\u4ED6\u7EBF\u7A0B\u5FC5\u987B\u7B49\u5B83\u7ED3\u675F\uFF0C\u624D\u80FD\u4F7F\u7528\u8FD9\u4E00\u5757\u5185\u5B58\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/bea2bf20-2b08-484e-80b7-3e210d0e20df.png" alt="bea2bf20-2b08-484e-80b7-3e210d0e20df"></p><p>8.\u4E00\u4E2A\u9632\u6B62\u4ED6\u4EBA\u8FDB\u5165\u7684\u7B80\u5355\u65B9\u6CD5\uFF0C\u5C31\u662F\u95E8\u53E3\u52A0\u4E00\u628A\u9501\u3002\u5148\u5230\u7684\u4EBA\u9501\u4E0A\u95E8\uFF0C\u540E\u5230\u7684\u4EBA\u770B\u5230\u4E0A\u9501\uFF0C\u5C31\u5728\u95E8\u53E3\u6392\u961F\uFF0C\u7B49\u9501\u6253\u5F00\u518D\u8FDB\u53BB\u3002\u8FD9\u5C31\u53EB\u201D\u4E92\u65A5\u9501\u201D\uFF08Mutual exclusion\uFF0C\u7F29\u5199 Mutex\uFF09\uFF0C\u9632\u6B62\u591A\u4E2A\u7EBF\u7A0B\u540C\u65F6\u8BFB\u5199\u67D0\u4E00\u5757\u5185\u5B58\u533A\u57DF\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/876a4f82-7931-4674-ac6b-a6d04a88a5b1.png" alt="876a4f82-7931-4674-ac6b-a6d04a88a5b1"></p><p>9.\u8FD8\u6709\u4E9B\u623F\u95F4\uFF0C\u53EF\u4EE5\u540C\u65F6\u5BB9\u7EB3n\u4E2A\u4EBA\uFF0C\u6BD4\u5982\u53A8\u623F\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C\u5982\u679C\u4EBA\u6570\u5927\u4E8En\uFF0C\u591A\u51FA\u6765\u7684\u4EBA\u53EA\u80FD\u5728\u5916\u9762\u7B49\u7740\u3002\u8FD9\u597D\u6BD4\u67D0\u4E9B\u5185\u5B58\u533A\u57DF\uFF0C\u53EA\u80FD\u4F9B\u7ED9\u56FA\u5B9A\u6570\u76EE\u7684\u7EBF\u7A0B\u4F7F\u7528\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/ae960b3a-c0e8-4c3d-bbcb-bfc5ebbecb79.png" alt="ae960b3a-c0e8-4c3d-bbcb-bfc5ebbecb79"></p><p>10.\u8FD9\u65F6\u7684\u89E3\u51B3\u65B9\u6CD5\uFF0C\u5C31\u662F\u5728\u95E8\u53E3\u6302n\u628A\u94A5\u5319\u3002\u8FDB\u53BB\u7684\u4EBA\u5C31\u53D6\u4E00\u628A\u94A5\u5319\uFF0C\u51FA\u6765\u65F6\u518D\u628A\u94A5\u5319\u6302\u56DE\u539F\u5904\u3002\u540E\u5230\u7684\u4EBA\u53D1\u73B0\u94A5\u5319\u67B6\u7A7A\u4E86\uFF0C\u5C31\u77E5\u9053\u5FC5\u987B\u5728\u95E8\u53E3\u6392\u961F\u7B49\u7740\u4E86\u3002\u8FD9\u79CD\u505A\u6CD5\u53EB\u505A\u201D\u4FE1\u53F7\u91CF\u201D\uFF08Semaphore\uFF09\uFF0C\u7528\u6765\u4FDD\u8BC1\u591A\u4E2A\u7EBF\u7A0B\u4E0D\u4F1A\u4E92\u76F8\u51B2\u7A81\u3002</p><p>11.\u64CD\u4F5C\u7CFB\u7EDF\u7684\u8BBE\u8BA1\uFF0C\u56E0\u6B64\u53EF\u4EE5\u5F52\u7ED3\u4E3A\u4E09\u70B9\uFF1A \uFF081\uFF09\u4EE5\u591A\u8FDB\u7A0B\u5F62\u5F0F\uFF0C\u5141\u8BB8\u591A\u4E2A\u4EFB\u52A1\u540C\u65F6\u8FD0\u884C\uFF1B \uFF082\uFF09\u4EE5\u591A\u7EBF\u7A0B\u5F62\u5F0F\uFF0C\u5141\u8BB8\u5355\u4E2A\u4EFB\u52A1\u5206\u6210\u4E0D\u540C\u7684\u90E8\u5206\u8FD0\u884C\uFF1B \uFF083\uFF09\u63D0\u4F9B\u534F\u8C03\u673A\u5236\uFF0C\u4E00\u65B9\u9762\u9632\u6B62\u8FDB\u7A0B\u4E4B\u95F4\u548C\u7EBF\u7A0B\u4E4B\u95F4\u4EA7\u751F\u51B2\u7A81\uFF0C\u53E6\u4E00\u65B9\u9762\u5141\u8BB8\u8FDB\u7A0B\u4E4B\u95F4\u548C\u7EBF\u7A0B\u4E4B\u95F4\u5171\u4EAB\u8D44\u6E90\u3002</p><h4 id="_4\u3001\u7BA1\u7A0B" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u7BA1\u7A0B" aria-hidden="true">#</a> 4\u3001\u7BA1\u7A0B</h4><p>Monitor(\u76D1\u89C6\u5668)\uFF0C\u4E5F\u5C31\u662F\u6211\u4EEC\u5E73\u65F6\u6240\u8BF4\u7684\u9501</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Monitor\u5176\u5B9E\u662F\u4E00\u79CD\u540C\u6B65\u673A\u5236\uFF0C\u4ED6\u7684\u4E49\u52A1\u662F\u4FDD\u8BC1\uFF08\u540C\u4E00\u65F6\u95F4\uFF09\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B\u53EF\u4EE5\u8BBF\u95EE\u88AB\u4FDD\u62A4\u7684\u6570\u636E\u548C\u4EE3\u7801\u3002</span>
<span class="token comment">// JVM\u4E2D\u540C\u6B65\u662F\u57FA\u4E8E\u8FDB\u5165\u548C\u9000\u51FA\u76D1\u89C6\u5668\u5BF9\u8C61(Monitor,\u7BA1\u7A0B\u5BF9\u8C61)\u6765\u5B9E\u73B0\u7684\uFF0C\u6BCF\u4E2A\u5BF9\u8C61\u5B9E\u4F8B\u90FD\u4F1A\u6709\u4E00\u4E2AMonitor\u5BF9\u8C61\uFF0C</span>
<span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Monitor\u5BF9\u8C61\u4F1A\u548CJava\u5BF9\u8C61\u4E00\u540C\u521B\u5EFA\u5E76\u9500\u6BC1\uFF0C\u5B83\u5E95\u5C42\u662F\u7531C++\u8BED\u8A00\u6765\u5B9E\u73B0\u7684\u3002</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210904000040589.png" alt="image-20210904000040589"></p><h4 id="_5\u3001\u7EBF\u7A0B\u72B6\u6001" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u7EBF\u7A0B\u72B6\u6001" aria-hidden="true">#</a> 5\u3001\u7EBF\u7A0B\u72B6\u6001\uFF1F</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Thread.State</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">State</span> <span class="token punctuation">{</span>
    NEW<span class="token punctuation">,</span><span class="token punctuation">(</span>\u65B0\u5EFA<span class="token punctuation">)</span>
    RUNNABLE<span class="token punctuation">,</span>\uFF08\u51C6\u5907\u5C31\u7EEA\uFF09
    BLOCKED<span class="token punctuation">,</span>\uFF08\u963B\u585E\uFF09
    WAITING<span class="token punctuation">,</span>\uFF08\u4E0D\u89C1\u4E0D\u6563\uFF09
    TIMED_WAITING<span class="token punctuation">,</span>\uFF08\u8FC7\u65F6\u4E0D\u5019\uFF09
    TERMINATED<span class="token punctuation">;</span><span class="token punctuation">(</span>\u7EC8\u7ED3<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7EBF\u7A0B\u51E0\u4E2A\u72B6\u6001\u7684\u4ECB\u7ECD\uFF1A</p><ul><li><strong>New</strong>\uFF1A\u8868\u793A\u521A\u521A\u521B\u5EFA\u7684\u7EBF\u7A0B\uFF0C\u8FD9\u79CD\u7EBF\u7A0B\u8FD8\u6CA1\u6709\u5F00\u59CB\u6267\u884C</li><li><strong>RUNNABLE</strong>\uFF1A\u8FD0\u884C\u72B6\u6001\uFF0C\u7EBF\u7A0B\u7684start()\u65B9\u6CD5\u8C03\u7528\u540E\uFF0C\u7EBF\u7A0B\u4F1A\u5904\u4E8E\u8FD9\u79CD\u72B6\u6001</li><li><strong>BLOCKED</strong>\uFF1A\u963B\u585E\u72B6\u6001\u3002\u5F53\u7EBF\u7A0B\u5728\u6267\u884C\u7684\u8FC7\u7A0B\u4E2D\u9047\u5230\u4E86synchronized\u540C\u6B65\u5757\uFF0C\u4F46\u8FD9\u4E2A\u540C\u6B65\u5757\u88AB\u5176\u4ED6\u7EBF\u7A0B\u5DF2\u83B7\u53D6\u8FD8\u672A\u91CA\u653E\u65F6\uFF0C\u5F53\u524D\u7EBF\u7A0B\u5C06\u8FDB\u5165\u963B\u585E\u72B6\u6001\uFF0C\u4F1A\u6682\u505C\u6267\u884C\uFF0C\u76F4\u5230\u83B7\u53D6\u5230\u9501\u3002\u5F53\u7EBF\u7A0B\u83B7\u53D6\u5230\u9501\u4E4B\u540E\uFF0C\u53C8\u4F1A\u8FDB\u5165\u5230\u8FD0\u884C\u72B6\u6001\uFF08RUNNABLE\uFF09</li><li><strong>WAITING</strong>\uFF1A\u7B49\u5F85\u72B6\u6001\u3002\u548CTIME_WAITING\u90FD\u8868\u793A\u7B49\u5F85\u72B6\u6001\uFF0C\u533A\u522B\u662FWAITING\u4F1A\u8FDB\u5165\u4E00\u4E2A\u65E0\u65F6\u95F4\u9650\u5236\u7684\u7B49\uFF0C\u800CTIME_WAITING\u4F1A\u8FDB\u5165\u4E00\u4E2A\u6709\u9650\u7684\u65F6\u95F4\u7B49\u5F85\uFF0C\u90A3\u4E48\u7B49\u5F85\u7684\u7EBF\u7A0B\u7A76\u7ADF\u5728\u7B49\u4EC0\u4E48\u5462\uFF1F\u4E00\u822C\u6765\u8BF4\uFF0CWAITING\u7684\u7EBF\u7A0B\u6B63\u5F0F\u5728\u7B49\u5F85\u4E00\u4E9B\u7279\u6B8A\u7684\u4E8B\u4EF6\uFF0C\u6BD4\u5982\uFF0C\u901A\u8FC7wait()\u65B9\u6CD5\u7B49\u5F85\u7684\u7EBF\u7A0B\u5728\u7B49\u5F85notify()\u65B9\u6CD5\uFF0C\u800C\u901A\u8FC7join()\u65B9\u6CD5\u7B49\u5F85\u7684\u7EBF\u7A0B\u5219\u4F1A\u7B49\u5F85\u76EE\u6807\u7EBF\u7A0B\u7684\u7EC8\u6B62\u3002\u4E00\u65E6\u7B49\u5230\u671F\u671B\u7684\u4E8B\u4EF6\uFF0C\u7EBF\u7A0B\u5C31\u4F1A\u518D\u6B21\u8FDB\u5165RUNNABLE\u8FD0\u884C\u72B6\u6001\u3002</li><li><strong>TERMINATED</strong>\uFF1A\u8868\u793A\u7ED3\u675F\u72B6\u6001\uFF0C\u7EBF\u7A0B\u6267\u884C\u5B8C\u6BD5\u4E4B\u540E\u8FDB\u5165\u7ED3\u675F\u72B6\u6001\u3002</li></ul><p><strong>\u6CE8\u610F\uFF1A\u4ECENEW\u72B6\u6001\u51FA\u53D1\u540E\uFF0C\u7EBF\u7A0B\u4E0D\u80FD\u5728\u56DE\u5230NEW\u72B6\u6001\uFF0C\u540C\u7406\uFF0C\u5904\u7406TERMINATED\u72B6\u6001\u7684\u7EBF\u7A0B\u4E5F\u4E0D\u80FD\u5728\u56DE\u5230RUNNABLE\u72B6\u6001</strong></p><h4 id="_6\u3001wait-sleep\u7684\u533A\u522B" tabindex="-1"><a class="header-anchor" href="#_6\u3001wait-sleep\u7684\u533A\u522B" aria-hidden="true">#</a> 6\u3001wait/sleep\u7684\u533A\u522B\uFF1F</h4><p>\u529F\u80FD\u90FD\u662F\u5F53\u524D\u7EBF\u7A0B\u6682\u505C\uFF0C\u6709\u4EC0\u4E48\u533A\u522B\uFF1F</p><p>wait\u653E\u5F00\u624B\u53BB\u7761\uFF0C\u653E\u5F00\u624B\u91CC\u7684\u9501</p><p>sleep\u63E1\u7D27\u624B\u53BB\u7761\uFF0C\u9192\u4E86\u624B\u91CC\u8FD8\u6709\u9501</p><h3 id="_2\u3001\u7EBF\u7A0B\u7684\u57FA\u672C\u64CD\u4F5C" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u7EBF\u7A0B\u7684\u57FA\u672C\u64CD\u4F5C" aria-hidden="true">#</a> 2\u3001\u7EBF\u7A0B\u7684\u57FA\u672C\u64CD\u4F5C</h3><h4 id="_1\u3001\u65B0\u5EFA\u7EBF\u7A0B" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u65B0\u5EFA\u7EBF\u7A0B" aria-hidden="true">#</a> 1\u3001\u65B0\u5EFA\u7EBF\u7A0B</h4><p>\u65B0\u5EFA\u7EBF\u7A0B\u5F88\u7B80\u5355\u3002\u53EA\u9700\u8981\u4F7F\u7528new\u5173\u952E\u5B57\u521B\u5EFA\u4E00\u4E2A\u7EBF\u7A0B\u5BF9\u8C61\uFF0C\u7136\u540E\u8C03\u7528\u5B83\u7684start()\u542F\u52A8\u7EBF\u7A0B\u5373\u53EF\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u90A3\u4E48\u7EBF\u7A0Bstart()\u4E4B\u540E\uFF0C\u4F1A\u5E72\u4EC0\u4E48\u5462\uFF1F\u7EBF\u7A0B\u6709\u4E2Arun()\u65B9\u6CD5\uFF0Cstart()\u4F1A\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684\u7EBF\u7A0B\u5E76\u8BA9\u8FD9\u4E2A\u7EBF\u7A0B\u6267\u884Crun()\u65B9\u6CD5\u3002</p><p>\u8FD9\u91CC\u9700\u8981\u6CE8\u610F\uFF0C\u4E0B\u9762\u4EE3\u7801\u4E5F\u80FD\u901A\u8FC7\u7F16\u8BD1\uFF0C\u4E5F\u80FD\u6B63\u5E38\u6267\u884C\u3002\u4F46\u662F\uFF0C\u5374\u4E0D\u80FD\u65B0\u5EFA\u4E00\u4E2A\u7EBF\u7A0B\uFF0C\u800C\u662F\u5728\u5F53\u524D\u7EBF\u7A0B\u4E2D\u8C03\u7528run()\u65B9\u6CD5\uFF0C\u5C06run\u65B9\u6CD5\u53EA\u662F\u4F5C\u4E3A\u4E00\u4E2A\u666E\u901A\u7684\u65B9\u6CD5\u8C03\u7528\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread1<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6240\u4EE5\uFF0C\u5E0C\u671B\u5927\u5BB6\u6CE8\u610F\uFF0C\u8C03\u7528start\u65B9\u6CD5\u548C\u76F4\u63A5\u8C03\u7528run\u65B9\u6CD5\u7684\u533A\u522B\u3002</p><p><strong>start\u65B9\u6CD5\u662F\u542F\u52A8\u4E00\u4E2A\u7EBF\u7A0B\uFF0Crun\u65B9\u6CD5\u53EA\u4F1A\u5728\u57AB\u94B1\u7EBF\u7A0B\u4E2D\u4E32\u884C\u7684\u6267\u884Crun\u65B9\u6CD5\u4E2D\u7684\u4EE3\u7801\u3002</strong></p><p>\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C \u7EBF\u7A0B\u7684run\u65B9\u6CD5\u4EC0\u4E48\u90FD\u6CA1\u6709\uFF0C\u542F\u52A8\u4E00\u4E2A\u7EBF\u7A0B\u4E4B\u540E\u9A6C\u4E0A\u5C31\u7ED3\u675F\u4E86\uFF0C\u6240\u4EE5\u5982\u679C\u4F60\u9700\u8981\u7EBF\u7A0B\u505A\u70B9\u4EC0\u4E48\uFF0C\u9700\u8981\u628A\u60A8\u7684\u4EE3\u7801\u5199\u5230run\u65B9\u6CD5\u4E2D\uFF0C\u6240\u4EE5\u5FC5\u987B\u91CD\u5199run\u65B9\u6CD5\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Thread thread1 = new Thread() {            @Override            public void run() {                System.out.println(&quot;hello,\u6211\u662F\u4E00\u4E2A\u7EBF\u7A0B!&quot;);            }        };thread1.start();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4E0A\u9762\u662F\u4F7F\u7528\u533F\u540D\u5185\u90E8\u7C7B\u5B9E\u73B0\u7684\uFF0C\u91CD\u5199\u4E86Thread\u7684run\u65B9\u6CD5\uFF0C\u5E76\u4E14\u6253\u5370\u4E86\u4E00\u6761\u4FE1\u606F\u3002**\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u7EE7\u627FThread\u7C7B\uFF0C\u7136\u540E\u91CD\u5199run\u65B9\u6CD5\uFF0C\u6765\u81EA\u5B9A\u4E49\u4E00\u4E2A\u7EBF\u7A0B\u3002**\u4F46\u8003\u8651java\u662F\u5355\u7EE7\u627F\u7684\uFF0C\u4ECE\u6269\u5C55\u6027\u4E0A\u6765\u8BF4\uFF0C\u6211\u4EEC\u5B9E\u73B0\u4E00\u4E2A\u63A5\u53E3\u6765\u81EA\u5B9A\u4E49\u4E00\u4E2A\u7EBF\u7A0B\u66F4\u597D\u4E00\u4E9B\uFF0Cjava\u4E2D\u521A\u597D\u63D0\u4F9B\u4E86Runnable\u63A5\u53E3\u6765\u81EA\u5B9A\u4E49\u4E00\u4E2A\u7EBF\u7A0B\u3002</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>@FunctionalInterfacepublic interface Runnable {    public abstract void run();}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Thread\u7C7B\u6709\u4E00\u4E2A\u975E\u5E38\u91CD\u8981\u7684\u6784\u9020\u65B9\u6CD5\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public Thread(Runnable target)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u6211\u4EEC\u5728\u770B\u4E00\u4E0BThread\u7684run\u65B9\u6CD5\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>public void run() {        if (target != null) {            target.run();        }    }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5F53\u6211\u4EEC\u542F\u52A8\u7EBF\u7A0B\u7684start\u65B9\u6CD5\u4E4B\u540E\uFF0C\u7EBF\u7A0B\u4F1A\u6267\u884Crun\u65B9\u6CD5\uFF0Crun\u65B9\u6CD5\u4E2D\u4F1A\u8C03\u7528Thread\u6784\u9020\u65B9\u6CD5\u4F20\u5165\u7684target\u7684run\u65B9\u6CD5\u3002</p><p><strong>\u5B9E\u73B0Runnable\u63A5\u53E3\u662F\u6BD4\u8F83\u5E38\u89C1\u7684\u505A\u6CD5\uFF0C\u4E5F\u662F\u63A8\u8350\u7684\u505A\u6CD5\u3002</strong></p><h4 id="_2\u3001\u7EC8\u6B62\u7EBF\u7A0B" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u7EC8\u6B62\u7EBF\u7A0B" aria-hidden="true">#</a> 2\u3001\u7EC8\u6B62\u7EBF\u7A0B</h4><p>\u4E00\u822C\u6765\u8BF4\u7EBF\u7A0B\u6267\u884C\u5B8C\u6BD5\u5C31\u4F1A\u7ED3\u675F\uFF0C\u65E0\u9700\u624B\u52A8\u5173\u95ED\u3002\u4F46\u662F\u5982\u679C\u6211\u4EEC\u60F3\u5173\u95ED\u4E00\u4E2A\u6B63\u5728\u8FD0\u884C\u7684\u7EBF\u7A0B\uFF0C\u6709\u4EC0\u4E48\u65B9\u6CD5\u5462\uFF1F\u53EF\u4EE5\u770B\u4E00\u4E0BThread\u7C7B\u4E2D\u63D0\u4F9B\u4E86\u4E00\u4E2Astop()\u65B9\u6CD5\uFF0C\u8C03\u7528\u8FD9\u4E2A\u65B9\u6CD5\uFF0C\u5C31\u53EF\u4EE5\u7ACB\u5373\u5C06\u4E00\u4E2A\u7EBF\u7A0B\u7EC8\u6B62\uFF0C\u975E\u5E38\u65B9\u4FBF\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo01</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        thread1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;thread1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u5F53\u524D\u7EBF\u7A0B\u4F11\u77201\u79D2</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u5173\u95ED\u7EBF\u7A0Bthread1</span>
        thread1<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u8F93\u51FA\u7EBF\u7A0Bthread1\u7684\u72B6\u6001</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> thread1<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u5F53\u524D\u7EBF\u7A0B\u4F11\u77201\u79D2</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u8F93\u51FA\u7EBF\u7A0Bthread1\u7684\u72B6\u6001</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> thread1<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD0\u884C\u4EE3\u7801\uFF0C\u8F93\u51FA\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>18:02:15.312 [thread1] INFO com.itsoku.chat01.Demo01 - start
18:02:16.311 [main] INFO com.itsoku.chat01.Demo01 - RUNNABLE
18:02:17.313 [main] INFO com.itsoku.chat01.Demo01 - TERMINATED
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE3\u7801\u4E2D\u6709\u4E2A\u6B7B\u5FAA\u73AF\uFF0C\u8C03\u7528stop\u65B9\u6CD5\u4E4B\u540E\uFF0C\u7EBF\u7A0Bthread1\u7684\u72B6\u6001\u53D8\u4E3ATERMINATED\uFF08\u7ED3\u675F\u72B6\u6001\uFF09\uFF0C\u7EBF\u7A0B\u505C\u6B62\u4E86\u3002</p><p>\u6211\u4EEC\u4F7F\u7528idea\u6216\u8005eclipse\u7684\u65F6\u5019\uFF0C\u4F1A\u53D1\u73B0\u8FD9\u4E2A\u65B9\u6CD5\u662F\u4E00\u4E2A\u5E9F\u5F03\u7684\u65B9\u6CD5\uFF0C\u4E5F\u5C31\u662F\u8BF4\uFF0C\u5728\u5C06\u6765\uFF0Cjdk\u53EF\u80FD\u5C31\u4F1A\u79FB\u9664\u8BE5\u65B9\u6CD5\u3002</p><p>stop\u65B9\u6CD5\u4E3A\u4F55\u4F1A\u88AB\u5E9F\u5F03\u800C\u4E0D\u63A8\u8350\u4F7F\u7528\uFF1Fstop\u65B9\u6CD5\u8FC7\u4E8E\u66B4\u529B\uFF0C\u5F3A\u5236\u628A\u6B63\u5728\u6267\u884C\u7684\u65B9\u6CD5\u505C\u6B62\u4E86\u3002</p><p>\u5927\u5BB6\u662F\u5426\u9047\u5230\u8FC7\u8FD9\u6837\u7684\u573A\u666F\uFF1A<strong>\u7535\u529B\u7CFB\u7EDF\u9700\u8981\u7EF4\u4FEE\uFF0C\u6B64\u65F6\u54B1\u4EEC\u6B63\u5728\u5199\u4EE3\u7801\uFF0C\u7EF4\u4FEE\u4EBA\u5458\u76F4\u63A5\u5C06\u7535\u6E90\u5173\u95ED\u4E86\uFF0C\u4EE3\u7801\u8FD8\u6CA1\u4FDD\u5B58\u7684\uFF0C\u662F\u4E0D\u662F\u5F88\u5D29\u6E83\uFF0C\u8FD9\u79CD\u65B9\u5F0F\u5C31\u50CF\u76F4\u63A5\u8C03\u7528\u7EBF\u7A0B\u7684stop\u65B9\u6CD5\u7C7B\u4F3C\u3002\u7EBF\u7A0B\u6B63\u5728\u8FD0\u884C\u8FC7\u7A0B\u4E2D\uFF0C\u88AB\u5F3A\u5236\u7ED3\u675F\u4E86\uFF0C\u53EF\u80FD\u4F1A\u5BFC\u81F4\u4E00\u4E9B\u610F\u60F3\u4E0D\u5230\u7684\u540E\u679C\u3002\u53EF\u4EE5\u7ED9\u5927\u5BB6\u53D1\u9001\u4E00\u4E2A\u901A\u77E5\uFF0C\u544A\u8BC9\u5927\u5BB6\u4FDD\u5B58\u4E00\u4E0B\u624B\u5934\u7684\u5DE5\u4F5C\uFF0C\u5C06\u7535\u8111\u5173\u95ED\u3002</strong></p><h4 id="_3\u3001\u7EBF\u7A0B\u4E2D\u65AD" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u7EBF\u7A0B\u4E2D\u65AD" aria-hidden="true">#</a> 3\u3001\u7EBF\u7A0B\u4E2D\u65AD</h4><p>\u5728java\u4E2D\uFF0C\u7EBF\u7A0B\u4E2D\u65AD\u662F\u4E00\u79CD\u91CD\u8981\u7684\u7EBF\u7A0B\u5199\u4F5C\u673A\u5236\uFF0C\u4ECE\u8868\u9762\u4E0A\u7406\u89E3\uFF0C\u4E2D\u65AD\u5C31\u662F\u8BA9\u76EE\u6807\u7EBF\u7A0B\u505C\u6B62\u6267\u884C\u7684\u610F\u601D\uFF0C\u5B9E\u9645\u4E0A\u5E76\u975E\u5B8C\u5168\u5982\u6B64\u3002\u5728\u4E0A\u9762\u4E2D\uFF0C\u6211\u4EEC\u5DF2\u7ECF\u8BE6\u7EC6\u8BA8\u8BBA\u4E86stop\u65B9\u6CD5\u505C\u6B62\u7EBF\u7A0B\u7684\u574F\u5904\uFF0Cjdk\u4E2D\u63D0\u4F9B\u4E86\u66F4\u597D\u7684\u4E2D\u65AD\u7EBF\u7A0B\u7684\u65B9\u6CD5\u3002\u4E25\u683C\u7684\u8BF4\uFF0C\u7EBF\u7A0B\u4E2D\u65AD\u5E76\u4E0D\u4F1A\u4F7F\u7EBF\u7A0B\u7ACB\u5373\u9000\u51FA\uFF0C\u800C\u662F\u7ED9\u7EBF\u7A0B\u53D1\u9001\u4E00\u4E2A\u901A\u77E5\uFF0C\u544A\u77E5\u76EE\u6807\u7EBF\u7A0B\uFF0C\u6709\u4EBA\u5E0C\u671B\u4F60\u9000\u51FA\u4E86\uFF01\u81F3\u4E8E\u76EE\u6807\u7EBF\u7A0B\u63A5\u6536\u5230\u901A\u77E5\u4E4B\u540E\u5982\u4F55\u5904\u7406\uFF0C\u5219\u5B8C\u5168\u7531\u76EE\u6807\u7EBF\u7A0B\u81EA\u5DF1\u51B3\u5B9A\uFF0C\u8FD9\u70B9\u5F88\u91CD\u8981\uFF0C\u5982\u679C\u4E2D\u65AD\u540E\uFF0C\u7EBF\u7A0B\u7ACB\u5373\u65E0\u6761\u4EF6\u9000\u51FA\uFF0C\u6211\u4EEC\u53C8\u4F1A\u5230stop\u65B9\u6CD5\u7684\u8001\u95EE\u9898\u3002</p><p>Thread\u63D0\u4F9B\u4E863\u4E2A\u4E0E\u7EBF\u7A0B\u4E2D\u65AD\u6709\u5173\u7684\u65B9\u6CD5\uFF0C\u8FD93\u4E2A\u65B9\u6CD5\u5BB9\u6613\u6DF7\u6DC6\uFF0C\u5927\u5BB6\u6CE8\u610F\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//\u4E2D\u65AD\u7EBF\u7A0B</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//\u5224\u65AD\u7EBF\u7A0B\u662F\u5426\u88AB\u4E2D\u65AD</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//\u5224\u65AD\u7EBF\u7A0B\u662F\u5426\u88AB\u4E2D\u65AD\uFF0C\u5E76\u6E05\u9664\u5F53\u524D\u4E2D\u65AD\u72B6\u6001</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>interrupt()<strong>\u65B9\u6CD5\u662F\u4E00\u4E2A</strong>\u5B9E\u4F8B\u65B9\u6CD5</strong>\uFF0C\u5B83\u901A\u77E5\u76EE\u6807\u7EBF\u7A0B\u4E2D\u65AD\uFF0C\u4E5F\u5C31\u662F\u8BBE\u7F6E\u4E2D\u65AD\u6807\u5FD7\u4F4D\u4E3Atrue\uFF0C\u4E2D\u65AD\u6807\u5FD7\u4F4D\u8868\u793A\u5F53\u524D\u7EBF\u7A0B\u5DF2\u7ECF\u88AB\u4E2D\u65AD\u4E86\u3002<strong>isInterrupted()<strong>\u65B9\u6CD5\u4E5F\u662F\u4E00\u4E2A</strong>\u5B9E\u4F8B\u65B9\u6CD5</strong>\uFF0C\u5B83\u5224\u65AD\u5F53\u524D\u7EBF\u7A0B\u662F\u5426\u88AB\u4E2D\u65AD\uFF08\u901A\u8FC7\u68C0\u67E5\u4E2D\u65AD\u6807\u5FD7\u4F4D\uFF09\u3002\u6700\u540E\u4E00\u4E2A\u65B9\u6CD5<strong>interrupted()<strong>\u662F\u4E00\u4E2A</strong>\u9759\u6001\u65B9\u6CD5</strong>\uFF0C\u8FD4\u56DEboolean\u7C7B\u578B\uFF0C\u4E5F\u662F\u7528\u6765\u5224\u65AD\u5F53\u524D\u7EBF\u7A0B\u662F\u5426\u88AB\u4E2D\u65AD\uFF0C\u4F46\u662F\u540C\u65F6\u4F1A\u6E05\u9664\u5F53\u524D\u7EBF\u7A0B\u7684\u4E2D\u65AD\u6807\u5FD7\u4F4D\u7684\u72B6\u6001\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6211\u8981\u9000\u51FA\u4E86!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
thread1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;thread1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread1<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u4EE3\u7801\u4E2D\u6709\u4E2A\u6B7B\u5FAA\u73AF\uFF0Cinterrupt()\u65B9\u6CD5\u88AB\u8C03\u7528\u4E4B\u540E\uFF0C\u7EBF\u7A0B\u7684\u4E2D\u65AD\u6807\u5FD7\u5C06\u88AB\u7F6E\u4E3Atrue\uFF0C\u5FAA\u73AF\u4F53\u4E2D\u901A\u8FC7\u68C0\u67E5\u7EBF\u7A0B\u7684\u4E2D\u65AD\u6807\u5FD7\u662F\u5426\u4E3Ature\uFF08<code>this.isInterrupted()</code>\uFF09\u6765\u5224\u65AD\u7EBF\u7A0B\u662F\u5426\u9700\u8981\u9000\u51FA\u4E86\u3002</p><p>\u518D\u770B\u4E00\u79CD\u4E2D\u65AD\u7684\u65B9\u6CD5\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> isStop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>isStop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6211\u8981\u9000\u51FA\u4E86!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    thread1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;thread1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    isStop <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE3\u7801\u4E2D\u901A\u8FC7\u4E00\u4E2A\u53D8\u91CFisStop\u6765\u63A7\u5236\u7EBF\u7A0B\u662F\u5426\u505C\u6B62\u3002</p><p>\u901A\u8FC7\u53D8\u91CF\u63A7\u5236\u548C\u7EBF\u7A0B\u81EA\u5E26\u7684interrupt\u65B9\u6CD5\u6765\u4E2D\u65AD\u7EBF\u7A0B\u6709\u4EC0\u4E48\u533A\u522B\u5462\uFF1F</p><p>\u5982\u679C\u4E00\u4E2A\u7EBF\u7A0B\u8C03\u7528\u4E86sleep\u65B9\u6CD5\uFF0C\u4E00\u76F4\u5904\u4E8E\u4F11\u7720\u72B6\u6001\uFF0C\u901A\u8FC7\u53D8\u91CF\u63A7\u5236\uFF0C\u8FD8\u53EF\u4EE5\u4E2D\u65AD\u7EBF\u7A0B\u4E48\uFF1F\u5927\u5BB6\u53EF\u4EE5\u601D\u8003\u4E00\u4E0B\u3002</p><p>\u6B64\u65F6\u53EA\u80FD\u4F7F\u7528\u7EBF\u7A0B\u63D0\u4F9B\u7684interrupt\u65B9\u6CD5\u6765\u4E2D\u65AD\u7EBF\u7A0B\u4E86\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u4F11\u7720100\u79D2</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6211\u8981\u9000\u51FA\u4E86!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    thread1<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;thread1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    thread1<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8C03\u7528interrupt()\u65B9\u6CD5\u4E4B\u540E\uFF0C\u7EBF\u7A0B\u7684sleep\u65B9\u6CD5\u5C06\u4F1A\u629B\u51FA<code>InterruptedException</code>\u5F02\u5E38\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//\u4F11\u7720100\u79D2</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6211\u8981\u9000\u51FA\u4E86!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD0\u884C\u4E0A\u9762\u7684\u4EE3\u7801\uFF0C\u53D1\u73B0\u7A0B\u5E8F\u65E0\u6CD5\u7EC8\u6B62\u3002\u4E3A\u4EC0\u4E48\uFF1F</p><p>\u4EE3\u7801\u9700\u8981\u6539\u4E3A\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Thread</span> thread1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//\u4F11\u7720100\u79D2</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6211\u8981\u9000\u51FA\u4E86!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u4EE3\u7801\u53EF\u4EE5\u7EC8\u6B62\u3002</p><p><strong>\u6CE8\u610F\uFF1Asleep\u65B9\u6CD5\u7531\u4E8E\u4E2D\u65AD\u800C\u629B\u51FA\u5F02\u5E38\u4E4B\u540E\uFF0C\u7EBF\u7A0B\u7684\u4E2D\u65AD\u6807\u5FD7\u4F1A\u88AB\u6E05\u9664\uFF08\u7F6E\u4E3Afalse\uFF09\uFF0C\u6240\u4EE5\u5728\u5F02\u5E38\u4E2D\u9700\u8981\u6267\u884Cthis.interrupt()\u65B9\u6CD5\uFF0C\u5C06\u4E2D\u65AD\u6807\u5FD7\u4F4D\u7F6E\u4E3Atrue</strong></p><h4 id="_4\u3001\u7B49\u5F85-wait-\u548C\u901A\u77E5-notify" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u7B49\u5F85-wait-\u548C\u901A\u77E5-notify" aria-hidden="true">#</a> 4\u3001\u7B49\u5F85\uFF08wait\uFF09\u548C\u901A\u77E5\uFF08notify\uFF09</h4><p>\u4E3A\u4E86\u652F\u6301\u591A\u7EBF\u7A0B\u4E4B\u95F4\u7684\u534F\u4F5C\uFF0CJDK\u63D0\u4F9B\u4E86\u4E24\u4E2A\u975E\u5E38\u91CD\u8981\u7684\u65B9\u6CD5\uFF1A\u7B49\u5F85wait()\u65B9\u6CD5\u548C\u901A\u77E5notify()\u65B9\u6CD5\u3002\u8FD92\u4E2A\u65B9\u6CD5\u5E76\u4E0D\u662F\u5728Thread\u7C7B\u4E2D\u7684\uFF0C\u800C\u662F\u5728Object\u7C7B\u4E2D\u5B9A\u4E49\u7684\u3002\u8FD9\u610F\u5473\u7740\u6240\u6709\u7684\u5BF9\u8C61\u90FD\u53EF\u4EE5\u8C03\u7528\u8005\u4E24\u4E2A\u65B9\u6CD5\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5F53\u5728\u4E00\u4E2A\u5BF9\u8C61\u5B9E\u4F8B\u4E0A\u8C03\u7528wait()\u65B9\u6CD5\u540E\uFF0C\u5F53\u524D\u7EBF\u7A0B\u5C31\u4F1A\u5728\u8FD9\u4E2A\u5BF9\u8C61\u4E0A\u7B49\u5F85\u3002\u8FD9\u662F\u4EC0\u4E48\u610F\u601D\uFF1F\u6BD4\u5982\u5728\u7EBF\u7A0BA\u4E2D\uFF0C\u8C03\u7528\u4E86obj.wait()\u65B9\u6CD5\uFF0C\u90A3\u4E48\u7EBF\u7A0BA\u5C31\u4F1A\u505C\u6B62\u7EE7\u7EED\u6267\u884C\uFF0C\u8F6C\u4E3A\u7B49\u5F85\u72B6\u6001\u3002\u7B49\u5F85\u5230\u4EC0\u4E48\u65F6\u5019\u7ED3\u675F\u5462\uFF1F\u7EBF\u7A0BA\u4F1A\u4E00\u76F4\u7B49\u5230\u5176\u4ED6\u7EBF\u7A0B\u8C03\u7528obj.notify()\u65B9\u6CD5\u4E3A\u6B62\uFF0C\u8FD9\u65F6\uFF0Cobj\u5BF9\u8C61\u6210\u4E3A\u4E86\u591A\u4E2A\u7EBF\u7A0B\u4E4B\u95F4\u7684\u6709\u6548\u901A\u4FE1\u624B\u6BB5\u3002</p><p>\u90A3\u4E48wait()\u65B9\u6CD5\u548Cnotify()\u65B9\u6CD5\u662F\u5982\u4F55\u5DE5\u4F5C\u7684\u5462\uFF1F\u5982\u56FE2.5\u5C55\u793A\u4E86\u4E24\u8005\u7684\u5DE5\u4F5C\u8FC7\u7A0B\u3002\u5982\u679C\u4E00\u4E2A\u7EBF\u7A0B\u8C03\u7528\u4E86object.wait()\u65B9\u6CD5\uFF0C\u90A3\u4E48\u5B83\u5C31\u4F1A\u8FDB\u51FAobject\u5BF9\u8C61\u7684\u7B49\u5F85\u961F\u5217\u3002\u8FD9\u4E2A\u961F\u5217\u4E2D\uFF0C\u53EF\u80FD\u4F1A\u6709\u591A\u4E2A\u7EBF\u7A0B\uFF0C\u56E0\u4E3A\u7CFB\u7EDF\u53EF\u80FD\u8FD0\u884C\u591A\u4E2A\u7EBF\u7A0B\u540C\u65F6\u7B49\u5F85\u67D0\u4E00\u4E2A\u5BF9\u8C61\u3002\u5F53object.notify()\u65B9\u6CD5\u88AB\u8C03\u7528\u65F6\uFF0C\u5B83\u5C31\u4F1A\u4ECE\u8FD9\u4E2A\u961F\u5217\u4E2D\u968F\u673A\u9009\u62E9\u4E00\u4E2A\u7EBF\u7A0B\uFF0C\u5E76\u5C06\u5176\u5524\u9192\u3002\u8FD9\u91CC\u5E0C\u671B\u5927\u5BB6\u6CE8\u610F\u4E00\u4E0B\uFF0C\u8FD9\u4E2A\u9009\u62E9\u662F\u4E0D\u516C\u5E73\u7684\uFF0C\u5E76\u4E0D\u662F\u5148\u7B49\u5F85\u7EBF\u7A0B\u5C31\u4F1A\u4F18\u5148\u88AB\u9009\u62E9\uFF0C\u8FD9\u4E2A\u9009\u62E9\u5B8C\u5168\u662F\u968F\u673A\u7684\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/f950f73b-52a6-4ecd-a8cb-5422bcd3a44e.png" alt="f950f73b-52a6-4ecd-a8cb-5422bcd3a44e"></p><p>\u9664notify()\u65B9\u6CD5\u5916\uFF0CObject\u72EC\u4EAB\u8FD8\u6709\u4E00\u4E2AnofiyAll()\u65B9\u6CD5\uFF0C\u5B83\u548Cnotify()\u65B9\u6CD5\u7684\u529F\u80FD\u7C7B\u4F3C\uFF0C\u4E0D\u540C\u7684\u662F\uFF0C\u5B83\u4F1A\u5524\u9192\u5728\u8FD9\u4E2A\u7B49\u5F85\u961F\u5217\u4E2D\u6240\u6709\u7B49\u5F85\u7684\u7EBF\u7A0B\uFF0C\u800C\u4E0D\u662F\u968F\u673A\u9009\u62E9\u4E00\u4E2A\u3002</p><p>\u8FD9\u91CC\u5F3A\u8C03\u4E00\u70B9\uFF0CObject.wait()\u65B9\u6CD5\u5E76\u4E0D\u80FD\u968F\u4FBF\u8C03\u7528\u3002\u5B83\u5FC5\u987B\u5305\u542B\u5728\u5BF9\u5E94\u7684synchronize\u8BED\u53E5\u6C47\u603B\uFF0C\u65E0\u8BBA\u662Fwait()\u65B9\u6CD5\u6216\u8005notify()\u65B9\u6CD5\u90FD\u9700\u8981\u9996\u5148\u83B7\u53D6\u76EE\u6807\u72EC\u4EAB\u7684\u4E00\u4E2A\u76D1\u89C6\u5668\u3002\u56FE2.6\u663E\u793A\u4E86wait()\u65B9\u6CD5\u548Cnofiy()\u65B9\u6CD5\u7684\u5DE5\u4F5C\u6D41\u7A0B\u7EC6\u8282\u3002\u5176\u4E2DT1\u548CT2\u8868\u793A\u4E24\u4E2A\u7EBF\u7A0B\u3002T1\u5728\u6B63\u786E\u6267\u884Cwait()\u65B9\u6CD5\u94B1\uFF0C\u5FC5\u987B\u83B7\u5F97object\u5BF9\u8C61\u7684\u76D1\u89C6\u5668\u3002\u800Cwait()\u65B9\u6CD5\u5728\u6267\u884C\u540E\uFF0C\u4F1A\u91CA\u653E\u8FD9\u4E2A\u76D1\u89C6\u5668\u3002\u8FD9\u6837\u505A\u7684\u76EE\u7684\u662F\u4F7F\u5176\u4ED6\u7B49\u5F85\u5728object\u5BF9\u8C61\u4E0A\u7684\u7EBF\u7A0B\u4E0D\u81F3\u4E8E\u56E0\u4E3AT1\u7684\u4F11\u7720\u800C\u5168\u90E8\u65E0\u6CD5\u6B63\u5E38\u6267\u884C\u3002</p><p>\u7EBF\u7A0BT2\u5728notify()\u65B9\u6CD5\u8C03\u7528\u524D\uFF0C\u4E5F\u5FC5\u987B\u83B7\u5F97object\u5BF9\u8C61\u7684\u76D1\u89C6\u5668\u3002\u6240\u5E78\uFF0C\u6B64\u65F6T1\u5DF2\u7ECF\u91CA\u653E\u4E86\u8FD9\u4E2A\u76D1\u89C6\u5668\uFF0C\u56E0\u6B64\uFF0CT2\u53EF\u4EE5\u987A\u5229\u83B7\u5F97object\u5BF9\u8C61\u7684\u76D1\u89C6\u5668\u3002\u63A5\u7740\uFF0CT2\u6267\u884C\u4E86notify()\u65B9\u6CD5\u5C1D\u8BD5\u5524\u9192\u4E00\u4E2A\u7B49\u5F85\u7EBF\u7A0B\uFF0C\u8FD9\u91CC\u5047\u8BBE\u5524\u9192\u4E86T1\u3002T1\u5728\u88AB\u5524\u9192\u540E\uFF0C\u8981\u505A\u7684\u7B2C\u4E00\u4EF6\u4E8B\u5E76\u4E0D\u662F\u6267\u884C\u540E\u7EED\u4EE3\u7801\uFF0C\u800C\u662F\u8981\u5C1D\u8BD5\u91CD\u65B0\u83B7\u5F97object\u5BF9\u8C61\u7684\u76D1\u89C6\u5668\uFF0C\u800C\u8FD9\u4E2A\u76D1\u89C6\u5668\u4E5F\u6B63\u662FT1\u5728wait()\u65B9\u6CD5\u6267\u884C\u524D\u6240\u6301\u6709\u7684\u90A3\u4E2A\u3002\u5982\u679C\u6682\u65F6\u65E0\u6CD5\u83B7\u5F97\uFF0C\u5219T1\u8FD8\u5FC5\u987B\u7B49\u5F85\u8FD9\u4E2A\u76D1\u89C6\u5668\u3002\u5F53\u76D1\u89C6\u5668\u987A\u5229\u83B7\u5F97\u540E\uFF0CT1\u624D\u53EF\u4EE5\u5728\u771F\u6B63\u610F\u4E49\u4E0A\u7EE7\u7EED\u6267\u884C\u3002</p><p>\u7ED9\u5927\u5BB6\u4E0A\u4E2A\u4F8B\u5B50\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo06</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Object</span> object <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T1</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:T1 start!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:T1 wait for object&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    object<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:T1 end!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T2</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:T2 start\uFF0Cnotify one thread! &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                object<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:T2 end!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">T1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">T2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD0\u884C\u7ED3\u679C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1562934497212</span><span class="token operator">:</span>T1 start<span class="token operator">!</span>
<span class="token number">1562934497212</span><span class="token operator">:</span>T1 wait <span class="token keyword">for</span> object
<span class="token number">1562934497212</span><span class="token operator">:</span>T2 start\uFF0Cnotify one thread<span class="token operator">!</span>
<span class="token number">1562934497212</span><span class="token operator">:</span>T2 end<span class="token operator">!</span>
<span class="token number">1562934499213</span><span class="token operator">:</span>T1 end<span class="token operator">!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6CE8\u610F\u4E0B\u6253\u5370\u7ED3\u679C\uFF0CT2\u8C03\u7528notify\u65B9\u6CD5\u4E4B\u540E\uFF0CT1\u5E76\u4E0D\u80FD\u7ACB\u5373\u7EE7\u7EED\u6267\u884C\uFF0C\u800C\u662F\u8981\u7B49\u5F85T2\u91CA\u653Eobjec\u6295\u9012\u9501\u4E4B\u540E\uFF0CT1\u91CD\u65B0\u6210\u529F\u83B7\u53D6\u9501\u540E\uFF0C\u624D\u80FD\u7EE7\u7EED\u6267\u884C\u3002\u56E0\u6B64\u6700\u540E2\u884C\u65E5\u5FD7\u76F8\u5DEE\u4E862\u79D2\uFF08\u56E0\u4E3AT2\u8C03\u7528notify\u65B9\u6CD5\u540E\u4F11\u7720\u4E862\u79D2\uFF09\u3002</p><p><strong>\u6CE8\u610F\uFF1AObject.wait()\u65B9\u6CD5\u548CThread.sleep()\u65B9\u6CD5\u90FD\u53EF\u4EE5\u8BA9\u73B0\u573A\u7B49\u5F85\u82E5\u5E72\u65F6\u95F4\u3002\u9664wait()\u65B9\u6CD5\u53EF\u4EE5\u88AB\u5524\u9192\u5916\uFF0C\u53E6\u5916\u4E00\u4E2A\u4E3B\u8981\u7684\u533A\u522B\u5C31\u662Fwait()\u65B9\u6CD5\u4F1A\u91CA\u653E\u76EE\u6807\u5BF9\u8C61\u7684\u9501\uFF0C\u800CThread.sleep()\u65B9\u6CD5\u4E0D\u4F1A\u91CA\u653E\u9501\u3002</strong></p><p>\u518D\u7ED9\u5927\u5BB6\u8BB2\u89E3\u4E00\u4E0Bwait()\uFF0Cnotify()\uFF0CnotifyAll()\uFF0C\u52A0\u6DF1\u4E00\u4E0B\u7406\u89E3\uFF1A</p><p>\u53EF\u4EE5\u8FD9\u4E48\u7406\u89E3\uFF0Cobj\u5BF9\u8C61\u4E0A\u67092\u4E2A\u961F\u5217\uFF0C\u5982\u56FE1\uFF0C<strong>q1\uFF1A\u7B49\u5F85\u961F\u5217\uFF0Cq2\uFF1A\u51C6\u5907\u83B7\u53D6\u9501\u7684\u961F\u5217</strong>\uFF1B\u4E24\u4E2A\u961F\u5217\u90FD\u4E3A\u7A7A\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/5f1e0099-c802-4e79-803a-a5117e6666ff.png" alt="5f1e0099-c802-4e79-803a-a5117e6666ff"></p><p><strong>obj.wait()\u8FC7\u7A0B\uFF1A</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token function">synchronize</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
    obj<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5047\u5982\u67093\u4E2A\u7EBF\u7A0B\uFF0Ct1\u3001t2\u3001t3\u540C\u65F6\u6267\u884C\u4E0A\u9762\u4EE3\u7801\uFF0Ct1\u3001t2\u3001t3\u4F1A\u8FDB\u5165q2\u961F\u5217\uFF0C\u5982\u56FE2\uFF0C\u8FDB\u5165q2\u7684\u961F\u5217\u7684\u8FD9\u4E9B\u7EBF\u7A0B\u624D\u6709\u8D44\u683C\u53BB\u4E89\u62A2obj\u7684\u9501\uFF0C\u5047\u8BBEt1\u4E89\u62A2\u5230\u4E86\uFF0C\u90A3\u4E48t2\u3001t3\u673A\u578B\u5728q2\u4E2D\u7B49\u5F85\u7740\u83B7\u53D6\u9501\uFF0Ct1\u8FDB\u5165\u4EE3\u7801\u5757\u6267\u884Cwait()\u65B9\u6CD5\uFF0C\u6B64\u65F6t1\u4F1A\u8FDB\u5165q1\u961F\u5217\uFF0C\u7136\u540E\u7CFB\u7EDF\u4F1A\u901A\u77E5q2\u961F\u5217\u4E2D\u7684t2\u3001t3\u53BB\u4E89\u62A2obj\u7684\u9501\uFF0C\u62A2\u5230\u4E4B\u540E\u8FC7\u7A0B\u5982t1\u7684\u8FC7\u7A0B\u3002\u6700\u540Et1\u3001t2\u3001t3\u90FD\u8FDB\u5165\u4E86q1\u961F\u5217\uFF0C\u5982\u56FE3\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/6c5eec72-3303-40a5-b70d-6e24ba12d2de.png" alt="6c5eec72-3303-40a5-b70d-6e24ba12d2de"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/45fd3950-b371-4d46-a5df-2ce1c8303707.png" alt="45fd3950-b371-4d46-a5df-2ce1c8303707"></p><p>\u4E0A\u9762\u8FC7\u7A0B\u4E4B\u540E\uFF0C\u53C8\u6765\u4E86\u7EBF\u7A0Bt4\u6267\u884C\u4E86notify()\u65B9\u6CD5\uFF0C\u5982\u4E0B\uFF1A**</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token function">synchronize</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
    obj<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>t4\u4F1A\u83B7\u53D6\u5230obj\u7684\u9501\uFF0C\u7136\u540E\u6267\u884Cnotify()\u65B9\u6CD5\uFF0C\u7CFB\u7EDF\u4F1A\u4ECEq1\u961F\u5217\u4E2D\u968F\u673A\u53D6\u4E00\u4E2A\u7EBF\u7A0B\uFF0C\u5C06\u5176\u52A0\u5165\u5230q2\u961F\u5217\uFF0C\u5047\u5982t2\u8FD0\u6C14\u6BD4\u8F83\u597D\uFF0C\u88AB\u968F\u673A\u5230\u4E86\uFF0C\u7136\u540Et2\u8FDB\u5165\u4E86q2\u961F\u5217\uFF0C\u5982\u56FE4\uFF0C\u8FDB\u5165q2\u7684\u961F\u5217\u7684\u9501\u624D\u6709\u8D44\u683C\u4E89\u62A2obj\u7684\u9501\uFF0Ct4\u7EBF\u7A0B\u6267\u884C\u5B8C\u6BD5\u4E4B\u540E\uFF0C\u4F1A\u91CA\u653Eobj\u7684\u9501\uFF0C\u6B64\u65F6\u961F\u5217q2\u4E2D\u7684t2\u4F1A\u83B7\u53D6\u5230obj\u7684\u9501\uFF0C\u7136\u540E\u7EE7\u7EED\u6267\u884C\uFF0C\u6267\u884C\u5B8C\u6BD5\u4E4B\u540E\uFF0Cq1\u4E2D\u5305\u542Bt1\u3001t3\uFF0Cq2\u961F\u5217\u4E3A\u7A7A\uFF0C\u5982\u56FE5</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/fbf3b798-65f7-4b90-a614-66854fcce5fa.png" alt="fbf3b798-65f7-4b90-a614-66854fcce5fa"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/b3868bc9-3da0-474b-a48e-20f90c1335ee.png" alt="b3868bc9-3da0-474b-a48e-20f90c1335ee"></p><p><strong>\u63A5\u7740\u53C8\u6765\u4E86\u4E2At5\u961F\u5217\uFF0C\u6267\u884C\u4E86notifyAll()\u65B9\u6CD5\uFF0C\u5982\u4E0B\uFF1A</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token function">synchronize</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
    obj<span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.\u8C03\u7528obj.wait()\u65B9\u6CD5\uFF0C\u5F53\u524D\u7EBF\u7A0B\u4F1A\u52A0\u5165\u961F\u5217queue1\uFF0C\u7136\u540E\u4F1A\u91CA\u653Eobj\u5BF9\u8C61\u7684\u9501</p><p>t5\u4F1A\u83B7\u53D6\u5230obj\u7684\u9501\uFF0C\u7136\u540E\u6267\u884CnotifyAll()\u65B9\u6CD5\uFF0C\u7CFB\u7EDF\u4F1A\u5C06\u961F\u5217q1\u4E2D\u7684\u7EBF\u7A0B\u90FD\u79FB\u5230q2\u4E2D\uFF0C\u5982\u56FE6\uFF0Ct5\u7EBF\u7A0B\u6267\u884C\u5B8C\u6BD5\u4E4B\u540E\uFF0C\u4F1A\u91CA\u653Eobj\u7684\u9501\uFF0C\u6B64\u65F6\u961F\u5217q2\u4E2D\u7684t1\u3001t3\u4F1A\u4E89\u62A2obj\u7684\u9501\uFF0C\u4E89\u62A2\u5230\u7684\u7EE7\u7EED\u6267\u884C\uFF0C\u672A\u589E\u5F3A\u5230\u7684\u5E26\u9501\u91CA\u653E\u4E4B\u540E\uFF0C\u7CFB\u7EDF\u4F1A\u901A\u77E5q2\u4E2D\u7684\u7EBF\u7A0B\u7EE7\u7EED\u4E89\u62A2\u7D22\uFF0C\u7136\u540E\u7EE7\u7EED\u6267\u884C\uFF0C\u6700\u540E\u4E24\u4E2A\u961F\u5217\u4E2D\u90FD\u4E3A\u7A7A\u4E86\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/9e648015-c445-4e84-bd8c-a53a380cbd7f.png" alt="9e648015-c445-4e84-bd8c-a53a380cbd7f"></p><h4 id="_5\u3001\u6302\u8D77-suspend-\u548C\u7EE7\u7EED\u6267\u884C-resume-\u7EBF\u7A0B" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u6302\u8D77-suspend-\u548C\u7EE7\u7EED\u6267\u884C-resume-\u7EBF\u7A0B" aria-hidden="true">#</a> 5\u3001\u6302\u8D77\uFF08suspend\uFF09\u548C\u7EE7\u7EED\u6267\u884C\uFF08resume\uFF09\u7EBF\u7A0B</h4><p>Thread\u7C7B\u4E2D\u8FD8\u67092\u4E2A\u65B9\u6CD5\uFF0C\u5373<strong>\u7EBF\u7A0B\u6302\u8D77(suspend)<strong>\u548C</strong>\u7EE7\u7EED\u6267\u884C(resume)</strong>\uFF0C\u8FD92\u4E2A\u64CD\u4F5C\u662F\u4E00\u5BF9\u76F8\u53CD\u7684\u64CD\u4F5C\uFF0C\u88AB\u6302\u8D77\u7684\u7EBF\u7A0B\uFF0C\u5FC5\u987B\u8981\u7B49\u5230resume()\u65B9\u6CD5\u64CD\u4F5C\u540E\uFF0C\u624D\u80FD\u7EE7\u7EED\u6267\u884C\u3002\u7CFB\u7EDF\u4E2D\u5DF2\u7ECF\u6807\u6CE8\u77402\u4E2A\u65B9\u6CD5\u8FC7\u65F6\u4E86\uFF0C\u4E0D\u63A8\u8350\u4F7F\u7528\u3002</p><p>\u7CFB\u7EDF\u4E0D\u63A8\u8350\u4F7F\u7528suspend()\u65B9\u6CD5\u53BB\u6302\u8D77\u7EBF\u7A0B\u662F\u56E0\u4E3Asuspend()\u65B9\u6CD5\u5BFC\u81F4\u7EBF\u7A0B\u6682\u505C\u7684\u540C\u65F6\uFF0C\u5E76\u4E0D\u4F1A\u91CA\u653E\u4EFB\u4F55\u9501\u8D44\u6E90\u3002\u6B64\u65F6\uFF0C\u5176\u4ED6\u4EFB\u4F55\u7EBF\u7A0B\u60F3\u8981\u8BBF\u95EE\u88AB\u5B83\u5360\u7528\u7684\u9501\u65F6\uFF0C\u90FD\u4F1A\u88AB\u7275\u8FDE\uFF0C\u5BFC\u81F4\u65E0\u6CD5\u6B63\u5E38\u8FD0\u884C\uFF08\u5982\u56FE2.7\u6240\u793A\uFF09\u3002\u76F4\u5230\u5728\u5BF9\u5E94\u7684\u7EBF\u7A0B\u4E0A\u8FDB\u884C\u4E86resume()\u65B9\u6CD5\u64CD\u4F5C\uFF0C\u88AB\u6302\u8D77\u7684\u7EBF\u7A0B\u624D\u80FD\u7EE7\u7EED\uFF0C\u4ECE\u800C\u5176\u4ED6\u6240\u6709\u963B\u585E\u5728\u76F8\u5173\u9501\u4E0A\u7684\u7EBF\u7A0B\u4E5F\u53EF\u4EE5\u7EE7\u7EED\u6267\u884C\u3002\u4F46\u662F\uFF0C\u5982\u679Cresume()\u65B9\u6CD5\u64CD\u4F5C\u610F\u5916\u5730\u5728suspend()\u65B9\u6CD5\u524D\u5C31\u88AB\u6267\u884C\u4E86\uFF0C\u90A3\u4E48\u88AB\u6302\u8D77\u7684\u7EBF\u7A0B\u53EF\u80FD\u5F88\u96BE\u6709\u673A\u4F1A\u88AB\u7EE7\u7EED\u6267\u884C\u4E86\u3002\u5E76\u4E14\uFF0C\u66F4\u4E25\u91CD\u7684\u662F\uFF1A\u5B83\u6240\u5360\u7528\u7684\u9501\u4E0D\u4F1A\u88AB\u91CA\u653E\uFF0C\u56E0\u6B64\u53EF\u80FD\u4F1A\u5BFC\u81F4\u6574\u4E2A\u7CFB\u7EDF\u5DE5\u4F5C\u4E0D\u6B63\u5E38\u3002\u800C\u4E14\uFF0C\u5BF9\u4E8E\u88AB\u6302\u8D77\u7684\u7EBF\u7A0B\uFF0C\u4ECE\u5B83\u7EBF\u7A0B\u7684\u72B6\u6001\u4E0A\u770B\uFF0C\u5C45\u7136\u8FD8\u662F<strong>Runnable</strong>\u72B6\u6001\uFF0C\u8FD9\u4E5F\u4F1A\u5F71\u54CD\u6211\u4EEC\u961F\u7CFB\u7EDF\u5F53\u524D\u72B6\u6001\u7684\u5224\u65AD\u3002</p><p>\u4E0A\u4E2A\u4F8B\u5B50\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo07</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Object</span> object <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T1</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token function">T1</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;in &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T1</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T1</span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T1</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T1</span><span class="token punctuation">(</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD0\u884C\u4EE3\u7801\u8F93\u51FA\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>in t1
in t2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u4EEC\u4F1A\u53D1\u73B0\u7A0B\u5E8F\u4E0D\u4F1A\u7ED3\u675F\uFF0C\u7EBF\u7A0Bt2\u88AB\u6302\u8D77\u4E86\uFF0C\u5BFC\u81F4\u7A0B\u5E8F\u65E0\u6CD5\u7ED3\u675F\uFF0C\u4F7F\u7528jstack\u547D\u4EE4\u67E5\u770B\u7EBF\u7A0B\u5806\u6808\u4FE1\u606F\u53EF\u4EE5\u770B\u5230\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token string">&quot;t2&quot;</span> #<span class="token number">13</span> prio<span class="token operator">=</span><span class="token number">5</span> os_prio<span class="token operator">=</span><span class="token number">0</span> tid<span class="token operator">=</span><span class="token number">0x000000002796c000</span> nid<span class="token operator">=</span><span class="token number">0xa3c</span> runnable <span class="token punctuation">[</span><span class="token number">0x000000002867f000</span><span class="token punctuation">]</span>
   <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread<span class="token punctuation">.</span>State</span><span class="token operator">:</span> RUNNABLE
        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread</span><span class="token punctuation">.</span><span class="token function">suspend0</span><span class="token punctuation">(</span><span class="token class-name">Native</span> <span class="token class-name">Method</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread</span><span class="token punctuation">.</span><span class="token function">suspend</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1029</span><span class="token punctuation">)</span>
        at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat01<span class="token punctuation">.</span></span>Demo07</span>$T1<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo07</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">)</span>
        <span class="token operator">-</span> locked <span class="token generics"><span class="token punctuation">&lt;</span>0x0000000717372fc0<span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span>a <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Object</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53D1\u73B0t2\u7EBF\u7A0B\u5728<strong>suspend0</strong>\u5904\u88AB\u6302\u8D77\u4E86\uFF0Ct2\u7684\u72B6\u6001\u7ADF\u7136\u8FD8\u662FRUNNABLE\u72B6\u6001\uFF0C\u7EBF\u7A0B\u660E\u660E\u88AB\u6302\u8D77\u4E86\uFF0C\u72B6\u6001\u8FD8\u662F\u8FD0\u884C\u4E2D\u5BB9\u6613\u5BFC\u81F4\u6211\u4EEC\u961F\u5F53\u524D\u7CFB\u7EDF\u8FDB\u884C\u8BEF\u5224\uFF0C\u4EE3\u7801\u4E2D\u5DF2\u7ECF\u8C03\u7528resume()\u65B9\u6CD5\u4E86\uFF0C\u4F46\u662F\u7531\u4E8E\u65F6\u95F4\u5148\u540E\u987A\u5E8F\u7684\u7F18\u6545\uFF0Cresume\u5E76\u6CA1\u6709\u751F\u6548\uFF0C\u8FD9\u5BFC\u81F4\u4E86t2\u6C38\u8FDC\u6EF4\u88AB\u6302\u8D77\u4E86\uFF0C\u5E76\u4E14\u6C38\u8FDC\u5360\u7528\u4E86object\u7684\u9501\uFF0C\u8FD9\u5BF9\u4E8E\u7CFB\u7EDF\u6765\u8BF4\u53EF\u80FD\u662F\u81F4\u547D\u7684\u3002</p><h4 id="_6\u3001\u7B49\u5F85\u7EBF\u7A0B\u7ED3\u675F-join-\u548C\u8C26\u8BA9-yeild" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u7B49\u5F85\u7EBF\u7A0B\u7ED3\u675F-join-\u548C\u8C26\u8BA9-yeild" aria-hidden="true">#</a> 6\u3001\u7B49\u5F85\u7EBF\u7A0B\u7ED3\u675F\uFF08join\uFF09\u548C\u8C26\u8BA9\uFF08yeild\uFF09</h4><p>\u5F88\u591A\u65F6\u5019\uFF0C\u4E00\u4E2A\u7EBF\u7A0B\u7684\u8F93\u5165\u53EF\u80FD\u975E\u5E38\u4F9D\u8D56\u4E8E\u53E6\u5916\u4E00\u4E2A\u6216\u8005\u591A\u4E2A\u7EBF\u7A0B\u7684\u8F93\u51FA\uFF0C\u6B64\u65F6\uFF0C\u8FD9\u4E2A\u7EBF\u7A0B\u5C31\u9700\u8981\u7B49\u5F85\u4F9D\u8D56\u7684\u7EBF\u7A0B\u6267\u884C\u5B8C\u6BD5\uFF0C\u624D\u80FD\u7EE7\u7EED\u6267\u884C\u3002jdk\u63D0\u4F9B\u4E86join()\u64CD\u4F5C\u6765\u5B9E\u73B0\u8FD9\u4E2A\u529F\u80FD\u3002\u5982\u4E0B\u6240\u793A\uFF0C\u663E\u793A\u4E862\u4E2Ajoin()\u65B9\u6CD5\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">long</span> millis<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7B2C1\u4E2A\u65B9\u6CD5\u8868\u793A\u65E0\u9650\u7B49\u5F85\uFF0C\u5B83\u4F1A\u4E00\u76F4\u53EA\u662F\u5F53\u524D\u7EBF\u7A0B\u3002\u77E5\u9053\u76EE\u6807\u7EBF\u7A0B\u6267\u884C\u5B8C\u6BD5\u3002</p><p>\u7B2C2\u4E2A\u65B9\u6CD5\u6709\u4E2A\u53C2\u6570\uFF0C\u7528\u4E8E\u6307\u5B9A\u7B49\u5F85\u65F6\u95F4\uFF0C\u5982\u679C\u8D85\u8FC7\u4E86\u7ED9\u5B9A\u7684\u65F6\u95F4\u76EE\u6807\u7EBF\u7A0B\u8FD8\u5728\u6267\u884C\uFF0C\u5F53\u524D\u7EBF\u7A0B\u4E5F\u4F1A\u505C\u6B62\u7B49\u5F85\uFF0C\u800C\u7EE7\u7EED\u5F80\u4E0B\u6267\u884C\u3002</p><p>\u6BD4\u5982\uFF1A\u7EBF\u7A0BT1\u9700\u8981\u7B49\u5F85T2\u3001T3\u5B8C\u6210\u4E4B\u540E\u624D\u80FD\u7EE7\u7EED\u6267\u884C\uFF0C\u90A3\u4E48\u5728T1\u7EBF\u7A0B\u4E2D\u9700\u8981\u5206\u522B\u8C03\u7528T2\u548CT3\u7684join()\u65B9\u6CD5\u3002</p><p>\u4E0A\u4E2A\u793A\u4F8B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo08</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T1</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token function">T1</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,start &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                num<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,end &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T1</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T1</span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,num = &quot;</span> <span class="token operator">+</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6267\u884C\u7ED3\u679C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1562939889129</span><span class="token punctuation">,</span>start t1
<span class="token number">1562939891134</span><span class="token punctuation">,</span>end t1
<span class="token number">1562939891134</span><span class="token punctuation">,</span>num <span class="token operator">=</span> <span class="token number">10</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>num\u7684\u7ED3\u679C\u4E3A10\uFF0C1\u30013\u884C\u7684\u65F6\u95F4\u6233\u76F8\u5DEE2\u79D2\u5DE6\u53F3\uFF0C\u8BF4\u660E\u4E3B\u7EBF\u7A0B\u7B49\u5F85t1\u5B8C\u6210\u4E4B\u540E\u624D\u7EE7\u7EED\u6267\u884C\u7684\u3002</p><p>\u770B\u4E00\u4E0Bjdk1.8\u4E2DThread.join()\u65B9\u6CD5\u7684\u5B9E\u73B0\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">long</span> millis<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> base <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> now <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>millis <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;timeout value is negative&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>millis <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> delay <span class="token operator">=</span> millis <span class="token operator">-</span> now<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>delay <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">wait</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
            now <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> base<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECEjoin\u7684\u4EE3\u7801\u4E2D\u53EF\u4EE5\u770B\u51FA\uFF0C\u5728\u88AB\u7B49\u5F85\u7684\u7EBF\u7A0B\u4E0A\u4F7F\u7528\u4E86synchronize\uFF0C\u8C03\u7528\u4E86\u5B83\u7684wait()\u65B9\u6CD5\uFF0C\u7EBF\u7A0B\u6700\u540E\u6267\u884C\u5B8C\u6BD5\u4E4B\u540E\uFF0C<strong>\u7CFB\u7EDF\u4F1A\u81EA\u52A8\u8C03\u7528\u5B83\u7684notifyAll()\u65B9\u6CD5</strong>\uFF0C\u5524\u9192\u6240\u6709\u5728\u6B64\u7EBF\u7A0B\u4E0A\u7B49\u5F85\u7684\u5176\u4ED6\u7EBF\u7A0B\u3002</p><p><strong>\u6CE8\u610F\uFF1A\u88AB\u7B49\u5F85\u7684\u7EBF\u7A0B\u6267\u884C\u5B8C\u6BD5\u4E4B\u540E\uFF0C\u7CFB\u7EDF\u81EA\u52A8\u4F1A\u8C03\u7528\u8BE5\u7EBF\u7A0B\u7684notifyAll()\u65B9\u6CD5\u3002\u6240\u4EE5\u4E00\u822C\u60C5\u51B5\u4E0B\uFF0C\u6211\u4EEC\u4E0D\u8981\u53BB\u5728\u7EBF\u7A0B\u5BF9\u8C61\u4E0A\u4F7F\u7528wait()\u3001notify()\u3001notifyAll()\u65B9\u6CD5\u3002</strong></p><p>\u53E6\u5916\u4E00\u4E2A\u65B9\u6CD5\u662F<strong>Thread.yield()</strong>\uFF0C\u4ED6\u7684\u5B9A\u4E49\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>yield\u662F\u8C26\u8BA9\u7684\u610F\u601D\uFF0C\u8FD9\u662F\u4E00\u4E2A\u9759\u6001\u65B9\u6CD5\uFF0C\u4E00\u65E6\u6267\u884C\uFF0C\u5B83\u4F1A\u8BA9\u5F53\u524D\u7EBF\u7A0B\u51FA\u8BA9CPU\uFF0C\u4F46\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u51FA\u8BA9CPU\u5E76\u4E0D\u662F\u8BF4\u4E0D\u8BA9\u5F53\u524D\u7EBF\u7A0B\u6267\u884C\u4E86\uFF0C\u5F53\u524D\u7EBF\u7A0B\u5728\u51FA\u8BA9CPU\u540E\uFF0C\u8FD8\u4F1A\u8FDB\u884CCPU\u8D44\u6E90\u7684\u4E89\u593A\uFF0C\u4F46\u662F\u80FD\u5426\u518D\u62A2\u5230CPU\u7684\u6267\u884C\u6743\u5C31\u4E0D\u4E00\u5B9A\u4E86\u3002\u56E0\u6B64\uFF0C\u5BF9Thread.yield()\u65B9\u6CD5\u7684\u8C03\u7528\u597D\u50CF\u5C31\u662F\u5728\u8BF4\uFF1A\u6211\u5DF2\u7ECF\u5B8C\u6210\u4E86\u4E00\u4E9B\u4E3B\u8981\u7684\u5DE5\u4F5C\uFF0C\u6211\u53EF\u4EE5\u4F11\u606F\u4E00\u4E0B\u4E86\uFF0C\u53EF\u4EE5\u8BA9CPU\u7ED9\u5176\u4ED6\u7EBF\u7A0B\u4E00\u4E9B\u5DE5\u4F5C\u673A\u4F1A\u4E86\u3002</p><p>\u5982\u679C\u89C9\u5F97\u4E00\u4E2A\u7EBF\u7A0B\u4E0D\u592A\u91CD\u8981\uFF0C\u6216\u8005\u4F18\u5148\u7EA7\u6BD4\u8F83\u4F4E\uFF0C\u800C\u53C8\u62C5\u5FC3\u6B64\u7EBF\u7A0B\u4F1A\u8FC7\u591A\u7684\u5360\u7528CPU\u8D44\u6E90\uFF0C\u90A3\u4E48\u53EF\u4EE5\u5728\u9002\u5F53\u7684\u65F6\u5019\u8C03\u7528\u4E00\u4E0BThread.yield()\u65B9\u6CD5\uFF0C\u7ED9\u4E0E\u5176\u4ED6\u7EBF\u7A0B\u66F4\u591A\u7684\u673A\u4F1A\u3002</p><h4 id="_7\u3001\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#_7\u3001\u603B\u7ED3" aria-hidden="true">#</a> 7\u3001\u603B\u7ED3</h4><ol><li>\u521B\u5EFA\u7EBF\u7A0B\u76842\u4E2D\u65B9\u5F0F\uFF1A\u7EE7\u627FThread\u7C7B\uFF1B\u5B9E\u73B0Runnable\u63A5\u53E3</li><li>\u542F\u52A8\u7EBF\u7A0B\uFF1A\u8C03\u7528\u7EBF\u7A0B\u7684start()\u65B9\u6CD5</li><li>\u7EC8\u6B62\u7EBF\u7A0B\uFF1A\u8C03\u7528\u7EBF\u7A0B\u7684stop()\u65B9\u6CD5\uFF0C\u65B9\u6CD5\u5DF2\u8FC7\u65F6\uFF0C\u5EFA\u8BAE\u4E0D\u8981\u4F7F\u7528</li><li>\u7EBF\u7A0B\u4E2D\u65AD\u76F8\u5173\u7684\u65B9\u6CD5\uFF1A\u8C03\u7528\u7EBF\u7A0B<strong>\u5B9E\u4F8Binterrupt()\u65B9\u6CD5</strong>\u5C06\u4E2D\u65AD\u6807\u5FD7\u7F6E\u4E3Atrue\uFF1B\u4F7F\u7528**\u7EBF\u7A0B\u5B9E\u4F8B\u65B9\u6CD5isInterrupted()<strong>\u83B7\u53D6\u4E2D\u65AD\u6807\u5FD7\uFF1B\u8C03\u7528</strong>Thread\u7684\u9759\u6001\u65B9\u6CD5interrupted()**\u83B7\u53D6\u7EBF\u7A0B\u662F\u5426\u88AB\u4E2D\u65AD\uFF0C\u6B64\u65B9\u6CD5\u8C03\u7528\u4E4B\u540E\u4F1A\u6E05\u9664\u4E2D\u65AD\u6807\u5FD7\uFF08\u5C06\u4E2D\u65AD\u6807\u5FD7\u7F6E\u4E3Afalse\u4E86\uFF09</li><li>wait\u3001notify\u3001notifyAll\u65B9\u6CD5\uFF0C\u8FD9\u5757\u6BD4\u8F83\u96BE\u7406\u89E3\uFF0C\u53EF\u4EE5\u56DE\u8FC7\u5934\u53BB\u518D\u7406\u7406</li><li>\u7EBF\u7A0B\u6302\u8D77\u4F7F\u7528<strong>\u7EBF\u7A0B\u5B9E\u4F8B\u65B9\u6CD5suspend()</strong>\uFF0C\u6062\u590D\u7EBF\u7A0B\u4F7F\u7528<strong>\u7EBF\u7A0B\u5B9E\u4F8B\u65B9\u6CD5resume()</strong>\uFF0C\u8FD92\u4E2A\u65B9\u6CD5\u90FD\u8FC7\u65F6\u4E86\uFF0C\u4E0D\u5EFA\u8BAE\u4F7F\u7528</li><li>\u7B49\u5F85\u7EBF\u7A0B\u7ED3\u675F\uFF1A\u8C03\u7528<strong>\u7EBF\u7A0B\u5B9E\u4F8B\u65B9\u6CD5join()</strong></li><li>\u51FA\u8BA9cpu\u8D44\u6E90\uFF1A\u8C03\u7528<strong>\u7EBF\u7A0B\u9759\u6001\u65B9\u6CD5yeild()</strong></li></ol><h3 id="_2\u3001\u4E3A\u4EC0\u4E48\u591A\u7EBF\u7A0B\u6781\u5176\u91CD\u8981" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u4E3A\u4EC0\u4E48\u591A\u7EBF\u7A0B\u6781\u5176\u91CD\u8981" aria-hidden="true">#</a> 2\u3001\u4E3A\u4EC0\u4E48\u591A\u7EBF\u7A0B\u6781\u5176\u91CD\u8981\uFF1F\uFF1F\uFF1F</h3><ol><li>\u786C\u4EF6\u65B9\u9762 - \u6469\u5C14\u5B9A\u5F8B\u5931\u6548</li></ol><p>\u6469\u5C14\u5B9A\u5F8B\uFF1A \u5B83\u662F\u7531\u82F1\u7279\u5C14\u521B\u59CB\u4EBA\u4E4B\u4E00Gordon Moore(\u6208\u767B\xB7\u6469\u5C14)\u63D0\u51FA\u6765\u7684\u3002\u5176\u5185\u5BB9\u4E3A\uFF1A \u5F53\u4EF7\u683C\u4E0D\u53D8\u65F6\uFF0C\u96C6\u6210\u7535\u8DEF\u4E0A\u53EF\u5BB9\u7EB3\u7684\u5143\u5668\u4EF6\u7684\u6570\u76EE\u7EA6\u6BCF\u969418-24\u4E2A\u6708\u4FBF\u4F1A\u589E\u52A0\u4E00\u500D\uFF0C\u6027\u80FD\u4E5F\u5C06\u63D0\u5347\u4E00\u500D\u3002 \u6362\u8A00\u4E4B\uFF0C\u6BCF\u4E00\u7F8E\u5143\u6240\u80FD\u4E70\u5230\u7684\u7535\u8111\u6027\u80FD\uFF0C\u5C06\u6BCF\u969418-24\u4E2A\u6708\u7FFB\u4E00\u500D\u4EE5\u4E0A\u3002\u8FD9\u4E00\u5B9A\u5F8B\u63ED\u793A\u4E86\u4FE1\u606F\u6280\u672F\u8FDB\u6B65\u7684\u901F\u5EA6\u3002</p><p>\u53EF\u662F\u4ECE2003\u5E74\u5F00\u59CBCPU\u4E3B\u9891\u5DF2\u7ECF\u4E0D\u518D\u7FFB\u500D\uFF0C\u800C\u662F\u91C7\u7528\u591A\u6838\u800C\u4E0D\u662F\u66F4\u5FEB\u7684\u4E3B\u9891\u3002</p><p>\u6469\u5C14\u5B9A\u5F8B\u5931\u6548\u3002</p><p>\u5728\u4E3B\u9891\u4E0D\u518D\u63D0\u9AD8\u4E14\u6838\u6570\u5728\u4E0D\u65AD\u589E\u52A0\u7684\u60C5\u51B5\u4E0B\uFF0C\u8981\u60F3\u8BA9\u7A0B\u5E8F\u66F4\u5FEB\u5C31\u8981\u7528\u5230\u5E76\u884C\u6216\u5E76\u53D1\u7F16\u7A0B\u3002</p><ol start="2"><li>\u8F6F\u4EF6\u65B9\u9762</li></ol><p>\u9AD8\u5E76\u53D1\u7CFB\u7EDF\uFF0C\u5F02\u6B65+\u56DE\u8C03\u7B49\u751F\u4EA7\u9700\u6C42</p><h3 id="_3\u3001\u4ECEstart\u4E00\u4E2A\u7EBF\u7A0B\u8BF4\u8D77" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u4ECEstart\u4E00\u4E2A\u7EBF\u7A0B\u8BF4\u8D77" aria-hidden="true">#</a> 3\u3001\u4ECEstart\u4E00\u4E2A\u7EBF\u7A0B\u8BF4\u8D77</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Java\u7EBF\u7A0B\u7406\u89E3\u4EE5\u53CAopenjdk\u4E2D\u7684\u5B9E\u73B0</span>
<span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">start0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Java\u8BED\u8A00\u672C\u8EAB\u5E95\u5C42\u5C31\u662FC++\u8BED\u8A00</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,169),k=s("OpenJDK\u6E90\u7801\u7F51\u5740:"),r={href:"http://openjdk.java.net/",target:"_blank",rel:"noopener noreferrer"},d=s("http://openjdk.java.net/"),m=t(`<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>openjdk8\\hotspot\\src\\share\\vm\\runtime
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>\u66F4\u52A0\u5E95\u5C42\u7684C++\u6E90\u7801\u89E3\u8BFB</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>openjdk8\\jdk\\src\\share\\<span class="token keyword">native</span>\\java\\lang   thread<span class="token punctuation">.</span>c
java\u7EBF\u7A0B\u662F\u901A\u8FC7start\u7684\u65B9\u6CD5\u542F\u52A8\u6267\u884C\u7684\uFF0C\u4E3B\u8981\u5185\u5BB9\u5728<span class="token keyword">native</span>\u65B9\u6CD5start0\u4E2D\uFF0C<span class="token class-name">Openjdk</span>\u7684\u5199JNI\u4E00\u822C\u662F\u4E00\u4E00\u5BF9\u5E94\u7684\uFF0C<span class="token class-name">Thread</span><span class="token punctuation">.</span>java\u5BF9\u5E94\u7684\u5C31\u662F<span class="token class-name">Thread</span><span class="token punctuation">.</span>c start0\u5176\u5B9E\u5C31\u662F<span class="token class-name">JVM_StartThread</span>\u3002\u6B64\u65F6\u67E5\u770B\u6E90\u4EE3\u7801\u53EF\u4EE5\u770B\u5230\u5728jvm<span class="token punctuation">.</span>h\u4E2D\u627E\u5230\u4E86\u58F0\u660E\uFF0Cjvm<span class="token punctuation">.</span>cpp\u4E2D\u6709\u5B9E\u73B0\u3002    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210903235656449.png" alt="image-20210903235656449"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>openjdk8\\hotspot\\src\\share\\vm\\prims  jvm<span class="token punctuation">.</span>cpp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210903235812379.png" alt="image-20210903235812379"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210903235817486.png" alt="image-20210903235817486"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>openjdk8\\hotspot\\src\\share\\vm\\runtime  thread<span class="token punctuation">.</span>cpp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210903235840971.png" alt="image-20210903235840971"></p><h3 id="_4\u3001\u7528\u6237\u7EBF\u7A0B\u548C\u5B88\u62A4\u7EBF\u7A0B" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u7528\u6237\u7EBF\u7A0B\u548C\u5B88\u62A4\u7EBF\u7A0B" aria-hidden="true">#</a> 4\u3001\u7528\u6237\u7EBF\u7A0B\u548C\u5B88\u62A4\u7EBF\u7A0B</h3><p>Java\u7EBF\u7A0B\u5206\u4E3A\u7528\u6237\u7EBF\u7A0B\u548C\u5B88\u62A4\u7EBF\u7A0B\uFF0C\u7EBF\u7A0B\u7684daemon\u5C5E\u6027\u4E3Atrue\u8868\u793A\u662F\u5B88\u62A4\u7EBF\u7A0B\uFF0Cfalse\u8868\u793A\u662F\u7528\u6237\u7EBF\u7A0B</p><h4 id="\u5B88\u62A4\u7EBF\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u5B88\u62A4\u7EBF\u7A0B" aria-hidden="true">#</a> \u5B88\u62A4\u7EBF\u7A0B</h4><p>\u662F\u4E00\u79CD\u7279\u6B8A\u7684\u7EBF\u7A0B\uFF0C\u5728\u540E\u53F0\u9ED8\u9ED8\u5730\u5B8C\u6210\u4E00\u4E9B\u7CFB\u7EDF\u6027\u7684\u670D\u52A1\uFF0C\u6BD4\u5982\u5783\u573E\u56DE\u6536\u7EBF\u7A0B</p><h4 id="\u7528\u6237\u7EBF\u7A0B" tabindex="-1"><a class="header-anchor" href="#\u7528\u6237\u7EBF\u7A0B" aria-hidden="true">#</a> \u7528\u6237\u7EBF\u7A0B</h4><p>\u662F\u7CFB\u7EDF\u7684\u5DE5\u4F5C\u7EBF\u7A0B\uFF0C\u5B83\u4F1A\u5B8C\u6210\u8FD9\u4E2A\u7A0B\u5E8F\u9700\u8981\u5B8C\u6210\u7684\u4E1A\u52A1\u64CD\u4F5C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DaemonDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t \u5F00\u59CB\u8FD0\u884C\uFF0C&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDaemon</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;\u5B88\u62A4\u7EBF\u7A0B&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;\u7528\u6237\u7EBF\u7A0B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u7EBF\u7A0B\u7684daemon\u5C5E\u6027\u4E3Atrue\u8868\u793A\u662F\u5B88\u62A4\u7EBF\u7A0B\uFF0Cfalse\u8868\u793A\u662F\u7528\u6237\u7EBF\u7A0B</span>
        t1<span class="token punctuation">.</span><span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//3\u79D2\u949F\u540E\u4E3B\u7EBF\u7A0B\u518D\u8FD0\u884C</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----------main\u7EBF\u7A0B\u8FD0\u884C\u5B8C\u6BD5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="\u91CD\u70B9" tabindex="-1"><a class="header-anchor" href="#\u91CD\u70B9" aria-hidden="true">#</a> \u91CD\u70B9</h4><p>\u5F53\u7A0B\u5E8F\u4E2D\u6240\u6709\u7528\u6237\u7EBF\u7A0B\u6267\u884C\u5B8C\u6BD5\u4E4B\u540E\uFF0C\u4E0D\u7BA1\u5B88\u62A4\u7EBF\u7A0B\u662F\u5426\u7ED3\u675F\uFF0C\u7CFB\u7EDF\u90FD\u4F1A\u81EA\u52A8\u9000\u51FA</p><p>\u5982\u679C\u7528\u6237\u7EBF\u7A0B\u5168\u90E8\u7ED3\u675F\u4E86\uFF0C\u610F\u5473\u7740\u7A0B\u5E8F\u9700\u8981\u5B8C\u6210\u7684\u4E1A\u52A1\u64CD\u4F5C\u5DF2\u7ECF\u7ED3\u675F\u4E86\uFF0C\u7CFB\u7EDF\u53EF\u4EE5\u9000\u51FA\u4E86\u3002\u6240\u4EE5\u5F53\u7CFB\u7EDF\u53EA\u5269\u4E0B\u5B88\u62A4\u8FDB\u7A0B\u7684\u65F6\u5019\uFF0Cjava\u865A\u62DF\u673A\u4F1A\u81EA\u52A8\u9000\u51FA</p><p>\u8BBE\u7F6E\u5B88\u62A4\u7EBF\u7A0B\uFF0C\u9700\u8981\u5728<strong>start()<strong>\u65B9\u6CD5</strong>\u4E4B\u524D</strong>\u8FDB\u884C</p><h3 id="_5\u3001\u83B7\u5F97\u591A\u7EBF\u7A0B\u7684\u65B9\u6CD5\u51E0\u79CD" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u83B7\u5F97\u591A\u7EBF\u7A0B\u7684\u65B9\u6CD5\u51E0\u79CD" aria-hidden="true">#</a> 5\u3001\u83B7\u5F97\u591A\u7EBF\u7A0B\u7684\u65B9\u6CD5\u51E0\u79CD\uFF1F</h3><ul><li><p>\u4F20\u7EDF\u7684\u662F</p><ul><li>\u7EE7\u627Fthread\u7C7B</li><li>\u5B9E\u73B0runnable\u63A5\u53E3\uFF0C</li></ul></li><li><p>java5\u4EE5\u540E</p><ul><li>\u5B9E\u73B0callable\u63A5\u53E3</li><li>java\u7684\u7EBF\u7A0B\u6C60\u83B7\u5F97</li></ul></li></ul><h3 id="_6\u3001callable\u63A5\u53E3" tabindex="-1"><a class="header-anchor" href="#_6\u3001callable\u63A5\u53E3" aria-hidden="true">#</a> 6\u3001Callable\u63A5\u53E3</h3><h4 id="_1\u3001\u4E0Erunnable\u5BF9\u6BD4" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u4E0Erunnable\u5BF9\u6BD4" aria-hidden="true">#</a> 1\u3001\u4E0Erunnable\u5BF9\u6BD4</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u521B\u5EFA\u65B0\u7C7BMyThread\u5B9E\u73B0runnable\u63A5\u53E3</span>
<span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u65B0\u7C7BMyThread2\u5B9E\u73B0callable\u63A5\u53E3</span>
<span class="token keyword">class</span> <span class="token class-name">MyThread2</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">200</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token comment">// \u9762\u8BD5\u9898:callable\u63A5\u53E3\u4E0Erunnable\u63A5\u53E3\u7684\u533A\u522B\uFF1F</span>
 
<span class="token comment">// \u7B54\uFF1A\uFF081\uFF09\u662F\u5426\u6709\u8FD4\u56DE\u503C</span>
<span class="token comment">//     \uFF082\uFF09\u662F\u5426\u629B\u5F02\u5E38</span>
<span class="token comment">//    \uFF083\uFF09\u843D\u5730\u65B9\u6CD5\u4E0D\u4E00\u6837\uFF0C\u4E00\u4E2A\u662Frun\uFF0C\u4E00\u4E2A\u662Fcall</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2\u3001\u600E\u4E48\u7528" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u600E\u4E48\u7528" aria-hidden="true">#</a> 2\u3001\u600E\u4E48\u7528</h4><p>\u76F4\u63A5\u66FF\u6362runnable\u662F\u5426\u53EF\u884C\uFF1F</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161513991-ca4fa075-8d4d-4c45-b1c8-cf6f3d83c6e4.png" alt="image"></p><p>\u4E0D\u53EF\u884C\uFF0C\u56E0\u4E3A\uFF1Athread\u7C7B\u7684\u6784\u9020\u65B9\u6CD5\u6839\u672C\u6CA1\u6709Callable</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161519289-57011bee-6de0-4002-b81e-433cede8c7a0.png" alt="image"></p><p>\u8BA4\u8BC6\u4E0D\u540C\u7684\u4EBA\u627E\u4E2D\u95F4\u4EBA</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161525949-6b3bf259-23a9-421e-8877-ae7f7de4f3d8.png" alt="image"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
  <span class="token class-name">FutureTask</span> futureTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">,</span><span class="token string">&quot;AA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD0\u884C\u6210\u529F\u540E\u5982\u4F55\u83B7\u5F97\u8FD4\u56DE\u503C\uFF1F</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161535188-cd8c298a-b466-41da-bee3-8ee572236b1f.png" alt="image"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
  <span class="token class-name">FutureTask</span> futureTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThread2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">,</span><span class="token string">&quot;AA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u4E8C\u3001\u7EBF\u7A0B\u6C60" tabindex="-1"><a class="header-anchor" href="#\u4E8C\u3001\u7EBF\u7A0B\u6C60" aria-hidden="true">#</a> \u4E8C\u3001\u7EBF\u7A0B\u6C60</h2><h3 id="_1\u3001\u4EC0\u4E48\u662F\u7EBF\u7A0B\u6C60" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u4EC0\u4E48\u662F\u7EBF\u7A0B\u6C60" aria-hidden="true">#</a> 1\u3001\u4EC0\u4E48\u662F\u7EBF\u7A0B\u6C60</h3><p>\u5927\u5BB6\u7528jdbc\u64CD\u4F5C\u8FC7\u6570\u636E\u5E93\u5E94\u8BE5\u77E5\u9053\uFF0C\u64CD\u4F5C\u6570\u636E\u5E93\u9700\u8981\u548C\u6570\u636E\u5E93\u5EFA\u7ACB\u8FDE\u63A5\uFF0C\u62FF\u5230\u8FDE\u63A5\u4E4B\u540E\u624D\u80FD\u64CD\u4F5C\u6570\u636E\u5E93\uFF0C\u7528\u5B8C\u4E4B\u540E\u9500\u6BC1\u3002\u6570\u636E\u5E93\u8FDE\u63A5\u7684\u521B\u5EFA\u548C\u9500\u6BC1\u5176\u5B9E\u662F\u6BD4\u8F83\u8017\u65F6\u7684\uFF0C\u771F\u6B63\u548C\u4E1A\u52A1\u76F8\u5173\u7684\u64CD\u4F5C\u8017\u65F6\u662F\u6BD4\u8F83\u77ED\u7684\u3002\u6BCF\u4E2A\u6570\u636E\u5E93\u64CD\u4F5C\u4E4B\u524D\u90FD\u9700\u8981\u521B\u5EFA\u8FDE\u63A5\uFF0C\u4E3A\u4E86\u63D0\u5347\u7CFB\u7EDF\u6027\u80FD\uFF0C\u540E\u6765\u51FA\u73B0\u4E86\u6570\u636E\u5E93\u8FDE\u63A5\u6C60\uFF0C\u7CFB\u7EDF\u542F\u52A8\u7684\u65F6\u5019\uFF0C\u5148\u521B\u5EFA\u5F88\u591A\u8FDE\u63A5\u653E\u5728\u6C60\u5B50\u91CC\u9762\uFF0C\u4F7F\u7528\u7684\u65F6\u5019\uFF0C\u76F4\u63A5\u4ECE\u8FDE\u63A5\u6C60\u4E2D\u83B7\u53D6\u4E00\u4E2A\uFF0C\u4F7F\u7528\u5B8C\u6BD5\u4E4B\u540E\u8FD4\u56DE\u5230\u6C60\u5B50\u91CC\u9762\uFF0C\u7EE7\u7EED\u7ED9\u5176\u4ED6\u9700\u8981\u8005\u4F7F\u7528\uFF0C\u8FD9\u5176\u4E2D\u5C31\u7701\u53BB\u521B\u5EFA\u8FDE\u63A5\u7684\u65F6\u95F4\uFF0C\u4ECE\u800C\u63D0\u5347\u4E86\u7CFB\u7EDF\u6574\u4F53\u7684\u6027\u80FD\u3002</p><p>\u7EBF\u7A0B\u6C60\u548C\u6570\u636E\u5E93\u8FDE\u63A5\u6C60\u7684\u539F\u7406\u4E5F\u5DEE\u4E0D\u591A\uFF0C\u521B\u5EFA\u7EBF\u7A0B\u53BB\u5904\u7406\u4E1A\u52A1\uFF0C\u53EF\u80FD\u521B\u5EFA\u7EBF\u7A0B\u7684\u65F6\u95F4\u6BD4\u5904\u7406\u4E1A\u52A1\u7684\u65F6\u95F4\u8FD8\u957F\u4E00\u4E9B\uFF0C\u5982\u679C\u7CFB\u7EDF\u80FD\u591F\u63D0\u524D\u4E3A\u6211\u4EEC\u521B\u5EFA\u597D\u7EBF\u7A0B\uFF0C\u6211\u4EEC\u9700\u8981\u7684\u65F6\u5019\u76F4\u63A5\u62FF\u6765\u4F7F\u7528\uFF0C\u7528\u5B8C\u4E4B\u540E\u4E0D\u662F\u76F4\u63A5\u5C06\u5176\u5173\u95ED\uFF0C\u800C\u662F\u5C06\u5176\u8FD4\u56DE\u5230\u7EBF\u7A0B\u4E2D\u4E2D\uFF0C\u7ED9\u5176\u4ED6\u9700\u8981\u8FD9\u4F7F\u7528\uFF0C\u8FD9\u6837\u76F4\u63A5\u8282\u7701\u4E86\u521B\u5EFA\u548C\u9500\u6BC1\u7684\u65F6\u95F4\uFF0C\u63D0\u5347\u4E86\u7CFB\u7EDF\u7684\u6027\u80FD\u3002</p><p>\u7B80\u5355\u7684\u8BF4\uFF0C\u5728\u4F7F\u7528\u4E86\u7EBF\u7A0B\u6C60\u4E4B\u540E\uFF0C\u521B\u5EFA\u7EBF\u7A0B\u53D8\u6210\u4E86\u4ECE\u7EBF\u7A0B\u6C60\u4E2D\u83B7\u53D6\u4E00\u4E2A\u7A7A\u95F2\u7684\u7EBF\u7A0B\uFF0C\u7136\u540E\u4F7F\u7528\uFF0C\u5173\u95ED\u7EBF\u7A0B\u53D8\u6210\u4E86\u5C06\u7EBF\u7A0B\u5F52\u8FD8\u5230\u7EBF\u7A0B\u6C60\u3002</p><h3 id="_2\u3001\u4E3A\u4EC0\u4E48\u7528\u7EBF\u7A0B\u6C60" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u4E3A\u4EC0\u4E48\u7528\u7EBF\u7A0B\u6C60" aria-hidden="true">#</a> 2\u3001\u4E3A\u4EC0\u4E48\u7528\u7EBF\u7A0B\u6C60</h3><p>\u7EBF\u7A0B\u6C60\u7684\u4F18\u52BF\uFF1A</p><p>\u200B \u7EBF\u7A0B\u6C60\u505A\u7684\u5DE5\u4F5C\u4E3B\u8981\u662F\u63A7\u5236\u8FD0\u884C\u7684\u7EBF\u7A0B\u6570\u91CF\uFF0C\u5904\u7406\u8FC7\u7A0B\u4E2D\u5C06\u4EFB\u52A1\u653E\u5165\u961F\u5217\uFF0C\u7136\u540E\u5728\u7EBF\u7A0B\u521B\u5EFA\u540E\u542F\u52A8\u8FD9\u4E9B\u4EFB\u52A1\uFF0C\u5982\u679C\u7EBF\u7A0B\u6570\u91CF\u8D85\u8FC7\u4E86\u6700\u5927\u6570\u91CF\uFF0C\u8D85\u51FA\u6570\u91CF\u7684\u7EBF\u7A0B\u6392\u961F\u7B49\u5019\uFF0C\u7B49\u5176\u4ED6\u7EBF\u7A0B\u6267\u884C\u5B8C\u6BD5\uFF0C\u518D\u4ECE\u961F\u5217\u4E2D\u53D6\u51FA\u4EFB\u52A1\u6765\u6267\u884C\u3002</p><p>\u5B83\u7684\u4E3B\u8981\u7279\u70B9\u4E3A\uFF1A<strong>\u7EBF\u7A0B\u590D\u7528;\u63A7\u5236\u6700\u5927\u5E76\u53D1\u6570;\u7BA1\u7406\u7EBF\u7A0B\u3002</strong></p><p>\u7B2C\u4E00\uFF1A\u964D\u4F4E\u8D44\u6E90\u6D88\u8017\u3002\u901A\u8FC7\u91CD\u590D\u5229\u7528\u5DF2\u521B\u5EFA\u7684\u7EBF\u7A0B\u964D\u4F4E\u7EBF\u7A0B\u521B\u5EFA\u548C\u9500\u6BC1\u9020\u6210\u7684\u9500\u8017\u3002</p><p>\u7B2C\u4E8C\uFF1A\u63D0\u9AD8\u54CD\u5E94\u901F\u5EA6\u3002\u5F53\u4EFB\u52A1\u5230\u8FBE\u65F6\uFF0C\u4EFB\u52A1\u53EF\u4EE5\u4E0D\u9700\u8981\u7B49\u5F85\u7EBF\u7A0B\u521B\u5EFA\u5C31\u80FD\u7ACB\u5373\u6267\u884C\u3002</p><p>\u7B2C\u4E09\uFF1A\u63D0\u9AD8\u7EBF\u7A0B\u7684\u53EF\u7BA1\u7406\u6027\u3002\u7EBF\u7A0B\u662F\u7A00\u7F3A\u8D44\u6E90\uFF0C\u5982\u679C\u65E0\u9650\u5236\u7684\u521B\u5EFA\uFF0C\u4E0D\u4EC5\u4F1A\u9500\u8017\u7CFB\u7EDF\u8D44\u6E90\uFF0C\u8FD8\u4F1A\u964D\u4F4E\u7CFB\u7EDF\u7684\u7A33\u5B9A\u6027\uFF0C\u4F7F\u7528\u7EBF\u7A0B\u6C60\u53EF\u4EE5\u8FDB\u884C\u7EDF\u4E00\u7684\u5206\u914D\uFF0C\u8C03\u4F18\u548C\u76D1\u63A7</p><h3 id="_3\u3001\u7EBF\u7A0B\u6C60\u7684\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u7EBF\u7A0B\u6C60\u7684\u4F7F\u7528" aria-hidden="true">#</a> 3\u3001\u7EBF\u7A0B\u6C60\u7684\u4F7F\u7528</h3><h4 id="_1\u3001executors-newfixedthreadpool-int" tabindex="-1"><a class="header-anchor" href="#_1\u3001executors-newfixedthreadpool-int" aria-hidden="true">#</a> 1\u3001Executors.newFixedThreadPool(int)</h4><p>\u200B newFixedThreadPool\u521B\u5EFA\u7684\u7EBF\u7A0B\u6C60corePoolSize\u548CmaximumPoolSize\u503C\u662F\u76F8\u7B49\u7684\uFF0C\u5B83\u4F7F\u7528\u7684\u662FLinkedBlockingQueue\u6267\u884C\u957F\u671F\u4EFB\u52A1\u6027\u80FD\u597D\uFF0C\u521B\u5EFA\u4E00\u4E2A\u7EBF\u7A0B\u6C60\uFF0C\u4E00\u6C60\u6709N\u4E2A\u56FA\u5B9A\u7684\u7EBF\u7A0B\uFF0C\u6709\u56FA\u5B9A\u7EBF\u7A0B\u6570\u7684\u7EBF\u7A0B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token keyword">int</span> nThreads<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>nThreads<span class="token punctuation">,</span> nThreads<span class="token punctuation">,</span>
                                  <span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span>
                                  <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2\u3001executors-newsinglethreadexecutor" tabindex="-1"><a class="header-anchor" href="#_2\u3001executors-newsinglethreadexecutor" aria-hidden="true">#</a> 2\u3001Executors.newSingleThreadExecutor()</h4><p>\u200B newSingleThreadExecutor \u521B\u5EFA\u7684\u7EBF\u7A0B\u6C60corePoolSize\u548CmaximumPoolSize\u503C\u90FD\u662F1\uFF0C\u5B83\u4F7F\u7528\u7684\u662FLinkedBlockingQueue\u4E00\u4E2A\u4EFB\u52A1\u4E00\u4E2A\u4EFB\u52A1\u7684\u6267\u884C\uFF0C\u4E00\u6C60\u4E00\u7EBF\u7A0B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newSingleThreadExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FinalizableDelegatedExecutorService</span>
        <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                                <span class="token number">0L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">,</span>
                                <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3\u3001executors-newcachedthreadpool" tabindex="-1"><a class="header-anchor" href="#_3\u3001executors-newcachedthreadpool" aria-hidden="true">#</a> 3\u3001Executors.newCachedThreadPool()</h4><p>\u200B newCachedThreadPool\u521B\u5EFA\u7684\u7EBF\u7A0B\u6C60\u5C06corePoolSize\u8BBE\u7F6E\u4E3A0\uFF0C\u5C06maximumPoolSize\u8BBE\u7F6E\u4E3AInteger.MAX_VALUE\uFF0C\u5B83\u4F7F\u7528\u7684\u662FSynchronousQueue\uFF0C\u4E5F\u5C31\u662F\u8BF4\u6765\u4E86\u4EFB\u52A1\u5C31\u521B\u5EFA\u7EBF\u7A0B\u8FD0\u884C\uFF0C\u5F53\u7EBF\u7A0B\u7A7A\u95F2\u8D85\u8FC760\u79D2\uFF0C\u5C31\u9500\u6BC1\u7EBF\u7A0B\u3002</p><p>\u6267\u884C\u5F88\u591A\u77ED\u671F\u5F02\u6B65\u4EFB\u52A1\uFF0C\u7EBF\u7A0B\u6C60\u6839\u636E\u9700\u8981\u521B\u5EFA\u65B0\u7EBF\u7A0B\uFF0C\u4F46\u5728\u5148\u524D\u6784\u5EFA\u7684\u7EBF\u7A0B\u53EF\u7528\u65F6\u5C06\u91CD\u7528\u5B83\u4EEC\u3002\u53EF\u6269\u5BB9\uFF0C\u9047\u5F3A\u5219\u5F3A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">,</span>
                                  <span class="token number">60L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span>
                                  <span class="token keyword">new</span> <span class="token class-name">SynchronousQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u7EBF\u7A0B\u6C60
 * Arrays
 * Collections
 * Executors
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyThreadPoolDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//List list = new ArrayList();</span>
        <span class="token comment">//List list = Arrays.asList(&quot;a&quot;,&quot;b&quot;);</span>
        <span class="token comment">//\u56FA\u5B9A\u6570\u7684\u7EBF\u7A0B\u6C60\uFF0C\u4E00\u6C60\u4E94\u7EBF\u7A0B</span>

<span class="token comment">//       ExecutorService threadPool =  Executors.newFixedThreadPool(5); //\u4E00\u4E2A\u94F6\u884C\u7F51\u70B9\uFF0C5\u4E2A\u53D7\u7406\u4E1A\u52A1\u7684\u7A97\u53E3</span>
<span class="token comment">//       ExecutorService threadPool =  Executors.newSingleThreadExecutor(); //\u4E00\u4E2A\u94F6\u884C\u7F51\u70B9\uFF0C1\u4E2A\u53D7\u7406\u4E1A\u52A1\u7684\u7A97\u53E3</span>
       <span class="token class-name">ExecutorService</span> threadPool <span class="token operator">=</span>  <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//\u4E00\u4E2A\u94F6\u884C\u7F51\u70B9\uFF0C\u53EF\u6269\u5C55\u53D7\u7406\u4E1A\u52A1\u7684\u7A97\u53E3</span>

        <span class="token comment">//10\u4E2A\u987E\u5BA2\u8BF7\u6C42</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                threadPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t \u529E\u7406\u4E1A\u52A1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            threadPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4\u3001threadpoolexecutor\u5E95\u5C42\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_4\u3001threadpoolexecutor\u5E95\u5C42\u539F\u7406" aria-hidden="true">#</a> 4\u3001ThreadPoolExecutor\u5E95\u5C42\u539F\u7406</h3><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/fdae3766-9607-424f-8f77-ba9a14583e8e.png" alt="fdae3766-9607-424f-8f77-ba9a14583e8e"></p><p><strong>\u4E3E\u4E2A\u4F8B\u5B50\uFF0C\u52A0\u6DF1\u7406\u89E3\uFF1A</strong></p><p>\u54B1\u4EEC\u4F5C\u4E3A\u5F00\u53D1\u8005\uFF0C\u4E0A\u9762\u90FD\u6709\u5F00\u53D1\u4E3B\u7BA1\uFF0C\u4E3B\u7BA1\u4E0B\u9762\u5E26\u9886\u51E0\u4E2A\u5C0F\u5F1F\u5E72\u6D3B\uFF0CCTO\u7ED9\u4E3B\u7BA1\u6388\u6743\u8BF4\uFF0C\u4F60\u53EF\u4EE5\u62DB\u80585\u4E2A\u5C0F\u5F1F\u5E72\u6D3B\uFF0C\u65B0\u6765\u4EFB\u52A1\uFF0C\u5982\u679C\u5C0F\u5F1F\u8FD8\u4E0D\u5230\u5434\u54E5\uFF0C\u7ACB\u5373\u53BB\u62DB\u8058\u4E00\u4E2A\u6765\u5E72\u8FD9\u4E2A\u65B0\u6765\u7684\u4EFB\u52A1\uFF0C\u5F535\u4E2A\u5C0F\u5F1F\u90FD\u62DB\u6765\u4E86\uFF0C\u518D\u6765\u4EFB\u52A1\u4E4B\u540E\uFF0C\u5C06\u4EFB\u52A1\u8BB0\u5F55\u5230\u4E00\u4E2A\u8868\u683C\u4E2D\uFF0C\u8868\u683C\u4E2D\u6700\u591A\u8BB0\u5F55100\u4E2A\uFF0C\u5C0F\u5F1F\u4EEC\u4F1A\u4E3B\u52A8\u53BB\u8868\u683C\u4E2D\u83B7\u53D6\u4EFB\u52A1\u6267\u884C\uFF0C\u5982\u679C5\u4E2A\u5C0F\u5F1F\u90FD\u5728\u5E72\u6D3B\uFF0C\u5E76\u4E14\u8868\u683C\u4E2D\u4E5F\u8BB0\u5F55\u6EE1\u4E86\uFF0C\u90A3\u4F60\u53EF\u4EE5\u5C06\u5C0F\u5F1F\u6269\u5145\u523020\u4E2A\uFF0C\u5982\u679C20\u4E2A\u5C0F\u5F1F\u90FD\u5728\u5E72\u6D3B\uFF0C\u5E76\u4E14\u5B58\u653E\u4EFB\u52A1\u7684\u8868\u4E5F\u6EE1\u4E86\uFF0C\u4EA7\u54C1\u7ECF\u7406\u518D\u6765\u4EFB\u52A1\u540E\uFF0C\u662F\u76F4\u63A5\u62D2\u7EDD\uFF0C\u8FD8\u662F\u8BA9\u4EA7\u54C1\u81EA\u5DF1\u5E72\uFF0C\u8FD9\u4E2A\u7531\u4F60\u81EA\u5DF1\u51B3\u5B9A\uFF0C\u5C0F\u5F1F\u4EEC\u90FD\u5C3D\u5FC3\u5C3D\u529B\u5728\u5E72\u6D3B\uFF0C\u4EFB\u52A1\u90FD\u88AB\u5904\u7406\u5B8C\u4E86\uFF0C\u7A81\u7136\u516C\u53F8\u4E1A\u7EE9\u4E0B\u6ED1\uFF0C\u51E0\u4E2A\u5458\u5DE5\u6CA1\u4E8B\u5E72\uFF0C\u6253\u9171\u6CB9\uFF0C\u4E3A\u4E86\u8282\u7EA6\u6210\u672C\uFF0CCTO\u4E3B\u7BA1\u628A\u5C0F\u5F1F\u63A7\u5236\u52305\u4EBA\uFF0C\u5176\u4ED615\u4E2A\u4EBA\u76F4\u63A5\u88AB\u5E72\u6389\u4E86\u3002\u6240\u4EE5\u4F5C\u4E3A\u5C0F\u5F1F\u4EEC\uFF0C\u522B\u8BA9\u81EA\u5DF1\u95F2\u7740\uFF0C\u591A\u5E72\u6D3B\u3002</p><p>**\u539F\u7406\uFF1A**\u5148\u627E\u51E0\u4E2A\u4EBA\u5E72\u6D3B\uFF0C\u5927\u5BB6\u90FD\u5FD9\u4E8E\u5E72\u6D3B\uFF0C\u4EFB\u52A1\u592A\u591A\u53EF\u4EE5\u6392\u671F\uFF0C\u6392\u671F\u7684\u4EFB\u52A1\u592A\u591A\u4E86\uFF0C\u518D\u62DB\u4E00\u4E9B\u4EBA\u6765\u5E72\u6D3B\uFF0C\u6700\u540E\u5E72\u6D3B\u7684\u548C\u6392\u671F\u90FD\u8FBE\u5230\u4E0A\u5C42\u9886\u5BFC\u8981\u6C42\u7684\u4E0A\u9650\u4E86\uFF0C\u90A3\u9700\u8981\u91C7\u53D6\u4E00\u4E9B\u5176\u4ED6\u7B56\u7565\u8FDB\u884C\u5904\u7406\u4E86\u3002\u5BF9\u4E8E\u957F\u65F6\u95F4\u4E0D\u5E72\u6D3B\u7684\u4EBA\uFF0C\u8003\u8651\u5C06\u5176\u5F00\u6389\uFF0C\u8282\u7EA6\u8D44\u6E90\u548C\u6210\u672C\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161583621-6ff005f3-9806-4c18-a497-e655aec5a2d0.png" alt="image"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
                          <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
                          <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span>
                          <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> workQueue<span class="token punctuation">,</span>
                          <span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">,</span>
                          <span class="token class-name">RejectedExecutionHandler</span> handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>corePoolSize <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span>
        maximumPoolSize <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span>
        maximumPoolSize <span class="token operator">&lt;</span> corePoolSize <span class="token operator">||</span>
        keepAliveTime <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>workQueue <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> threadFactory <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> handler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>corePoolSize <span class="token operator">=</span> corePoolSize<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>maximumPoolSize <span class="token operator">=</span> maximumPoolSize<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>workQueue <span class="token operator">=</span> workQueue<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>keepAliveTime <span class="token operator">=</span> unit<span class="token punctuation">.</span><span class="token function">toNanos</span><span class="token punctuation">(</span>keepAliveTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>threadFactory <span class="token operator">=</span> threadFactory<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>handler <span class="token operator">=</span> handler<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p>corePoolSize\uFF1A\u6838\u5FC3\u7EBF\u7A0B\u5927\u5C0F\uFF0C\u5F53\u63D0\u4EA4\u4E00\u4E2A\u4EFB\u52A1\u5230\u7EBF\u7A0B\u6C60\u65F6\uFF0C\u7EBF\u7A0B\u6C60\u4F1A\u521B\u5EFA\u4E00\u4E2A\u7EBF\u7A0B\u6765\u6267\u884C\u4EFB\u52A1\uFF0C\u5373\u4F7F\u6709\u5176\u4ED6\u7A7A\u95F2\u7EBF\u7A0B\u53EF\u4EE5\u5904\u7406\u4EFB\u52A1\u4E5F\u4F1A\u521B\u65B0\u7EBF\u7A0B\uFF0C\u7B49\u5230\u5DE5\u4F5C\u7684\u7EBF\u7A0B\u6570\u5927\u4E8E\u6838\u5FC3\u7EBF\u7A0B\u6570\u65F6\u5C31\u4E0D\u4F1A\u5728\u521B\u5EFA\u4E86\u3002\u5982\u679C\u8C03\u7528\u4E86\u7EBF\u7A0B\u6C60\u7684<code>prestartAllCoreThreads</code>\u65B9\u6CD5\uFF0C\u7EBF\u7A0B\u6C60\u4F1A\u63D0\u524D\u628A\u6838\u5FC3\u7EBF\u7A0B\u90FD\u521B\u9020\u597D\uFF0C\u5E76\u542F\u52A8</p></li><li><p>maximumPoolSize\uFF1A\u7EBF\u7A0B\u6C60\u5141\u8BB8\u521B\u5EFA\u7684\u6700\u5927\u7EBF\u7A0B\u6570\uFF0C\u6B64\u503C\u5FC5\u987B\u5927\u4E8E\u7B49\u4E8E1\u3002\u5982\u679C\u961F\u5217\u6EE1\u4E86\uFF0C\u5E76\u4E14\u4EE5\u521B\u5EFA\u7684\u7EBF\u7A0B\u6570\u5C0F\u4E8E\u6700\u5927\u7EBF\u7A0B\u6570\uFF0C\u5219\u7EBF\u7A0B\u6C60\u4F1A\u518D\u521B\u5EFA\u65B0\u7684\u7EBF\u7A0B\u6267\u884C\u4EFB\u52A1\u3002\u5982\u679C\u6211\u4EEC\u4F7F\u7528\u4E86\u65E0\u754C\u961F\u5217\uFF0C\u90A3\u4E48\u6240\u6709\u7684\u4EFB\u52A1\u4F1A\u52A0\u5165\u961F\u5217\uFF0C\u8FD9\u4E2A\u53C2\u6570\u5C31\u6CA1\u6709\u4EC0\u4E48\u6548\u679C\u4E86</p></li><li><p>keepAliveTime\uFF1A\u591A\u4F59\u7684\u7A7A\u95F2\u7EBF\u7A0B\u7684\u5B58\u6D3B\u65F6\u95F4,\u5F53\u524D\u6C60\u4E2D\u7EBF\u7A0B\u6570\u91CF\u8D85\u8FC7corePoolSize\u65F6\uFF0C\u5F53\u7A7A\u95F2\u65F6\u95F4,\u8FBE\u5230keepAliveTime\u65F6\uFF0C\u591A\u4F59\u7EBF\u7A0B\u4F1A\u88AB\u9500\u6BC1\u76F4\u5230\u53EA\u5269\u4E0BcorePoolSize\u4E2A\u7EBF\u7A0B\u4E3A\u6B62\uFF0C\u5982\u679C\u4EFB\u52A1\u5F88\u591A\uFF0C\u5E76\u4E14\u6BCF\u4E2A\u4EFB\u52A1\u7684\u6267\u884C\u65F6\u95F4\u6BD4\u8F83\u77ED\uFF0C\u907F\u514D\u7EBF\u7A0B\u91CD\u590D\u521B\u5EFA\u548C\u56DE\u6536\uFF0C\u53EF\u4EE5\u8C03\u5927\u8FD9\u4E2A\u65F6\u95F4\uFF0C\u63D0\u9AD8\u7EBF\u7A0B\u7684\u5229\u7528\u7387</p></li><li><p>unit\uFF1AkeepAliveTIme\u7684\u65F6\u95F4\u5355\u4F4D\uFF0C\u53EF\u4EE5\u9009\u62E9\u7684\u5355\u4F4D\u6709\u5929\u3001\u5C0F\u65F6\u3001\u5206\u949F\u3001\u6BEB\u79D2\u3001\u5FAE\u5999\u3001\u5343\u5206\u4E4B\u4E00\u6BEB\u79D2\u548C\u7EB3\u79D2\u3002\u7C7B\u578B\u662F\u4E00\u4E2A\u679A\u4E3E<code>java.util.concurrent.TimeUnit</code>\uFF0C\u8FD9\u4E2A\u679A\u4E3E\u4E5F\u7ECF\u5E38\u4F7F\u7528</p></li><li><p>workQueue\uFF1A\u4EFB\u52A1\u961F\u5217\uFF0C\u88AB\u63D0\u4EA4\u4F46\u5C1A\u672A\u88AB\u6267\u884C\u7684\u4EFB\u52A1\uFF0C\u7528\u4E8E\u7F13\u5B58\u5F85\u5904\u7406\u4EFB\u52A1\u7684\u963B\u585E\u961F\u5217</p></li><li><p>threadFactory\uFF1A\u8868\u793A\u751F\u6210\u7EBF\u7A0B\u6C60\u4E2D\u5DE5\u4F5C\u7EBF\u7A0B\u7684\u7EBF\u7A0B\u5DE5\u5382\uFF0C\u7528\u4E8E\u521B\u5EFA\u7EBF\u7A0B\uFF0C\u4E00\u822C\u9ED8\u8BA4\u7684\u5373\u53EF\uFF0C\u53EF\u4EE5\u901A\u8FC7\u7EBF\u7A0B\u5DE5\u5382\u7ED9\u6BCF\u4E2A\u521B\u5EFA\u51FA\u6765\u7684\u7EBF\u7A0B\u8BBE\u7F6E\u66F4\u6709\u610F\u4E49\u7684\u540D\u5B57</p></li><li><p>handler\uFF1A\u62D2\u7EDD\u7B56\u7565\uFF0C\u8868\u793A\u5F53\u961F\u5217\u6EE1\u4E86\uFF0C\u5E76\u4E14\u5DE5\u4F5C\u7EBF\u7A0B\u5927\u4E8E\u7B49\u4E8E\u7EBF\u7A0B\u6C60\u7684\u6700\u5927\u7EBF\u7A0B\u6570\uFF08maximumPoolSize\uFF09\u65F6\u5982\u4F55\u6765\u62D2\u7EDD\u8BF7\u6C42\u6267\u884C\u7684runnable\u7684\u7B56\u7565</p></li></ol><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161593084-bebbf57e-a1cd-4178-b763-24959203717b.png" alt="image"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161599622-b82c39bb-1dbb-495e-9e4a-78f413f1c724.png" alt="image"></p><p><strong>\u8C03\u7528\u7EBF\u7A0B\u6C60\u7684execute\u65B9\u6CD5\u5904\u7406\u4EFB\u52A1\uFF0C\u6267\u884Cexecute\u65B9\u6CD5\u7684\u8FC7\u7A0B\uFF1A</strong></p><ol><li>\u5224\u65AD\u7EBF\u7A0B\u6C60\u4E2D\u8FD0\u884C\u7684\u7EBF\u7A0B\u6570\u662F\u5426\u5C0F\u4E8Ecorepoolsize\uFF0C\u662F\uFF1A\u5219\u521B\u5EFA\u65B0\u7684\u7EBF\u7A0B\u6765\u5904\u7406\u4EFB\u52A1\uFF0C\u5426\uFF1A\u6267\u884C\u4E0B\u4E00\u6B65</li><li>\u8BD5\u56FE\u5C06\u4EFB\u52A1\u6DFB\u52A0\u5230workQueue\u6307\u5B9A\u7684\u961F\u5217\u4E2D\uFF0C\u5982\u679C\u65E0\u6CD5\u6DFB\u52A0\u5230\u961F\u5217\uFF0C\u8FDB\u5165\u4E0B\u4E00\u6B65</li><li>\u5224\u65AD\u7EBF\u7A0B\u6C60\u4E2D\u8FD0\u884C\u7684\u7EBF\u7A0B\u6570\u662F\u5426\u5C0F\u4E8E<code>maximumPoolSize</code>\uFF0C\u662F\uFF1A\u5219\u65B0\u589E\u7EBF\u7A0B\u5904\u7406\u5F53\u524D\u4F20\u5165\u7684\u4EFB\u52A1\uFF0C\u5426\uFF1A\u5C06\u4EFB\u52A1\u4F20\u9012\u7ED9<code>handler</code>\u5BF9\u8C61<code>rejectedExecution</code>\u65B9\u6CD5\u5904\u7406</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1\u3001\u5728\u521B\u5EFA\u4E86\u7EBF\u7A0B\u6C60\u540E\uFF0C\u5F00\u59CB\u7B49\u5F85\u8BF7\u6C42\u3002
2\u3001\u5F53\u8C03\u7528execute()\u65B9\u6CD5\u6DFB\u52A0\u4E00\u4E2A\u8BF7\u6C42\u4EFB\u52A1\u65F6\uFF0C\u7EBF\u7A0B\u6C60\u4F1A\u505A\u51FA\u5982\u4E0B\u5224\u65AD\uFF1A
  2.1\u5982\u679C\u6B63\u5728\u8FD0\u884C\u7684\u7EBF\u7A0B\u6570\u91CF\u5C0F\u4E8EcorePoolSize\uFF0C\u90A3\u4E48\u9A6C\u4E0A\u521B\u5EFA\u7EBF\u7A0B\u8FD0\u884C\u8FD9\u4E2A\u4EFB\u52A1\uFF1B
  2.2\u5982\u679C\u6B63\u5728\u8FD0\u884C\u7684\u7EBF\u7A0B\u6570\u91CF\u5927\u4E8E\u6216\u7B49\u4E8EcorePoolSize\uFF0C\u90A3\u4E48\u5C06\u8FD9\u4E2A\u4EFB\u52A1\u653E\u5165\u961F\u5217\uFF1B
  2.3\u5982\u679C\u8FD9\u4E2A\u65F6\u5019\u961F\u5217\u6EE1\u4E86\u4E14\u6B63\u5728\u8FD0\u884C\u7684\u7EBF\u7A0B\u6570\u91CF\u8FD8\u5C0F\u4E8EmaximumPoolSize\uFF0C\u90A3\u4E48\u8FD8\u662F\u8981\u521B\u5EFA\u975E\u6838\u5FC3\u7EBF\u7A0B\u7ACB\u523B\u8FD0\u884C\u8FD9\u4E2A\u4EFB\u52A1\uFF1B
  2.4\u5982\u679C\u961F\u5217\u6EE1\u4E86\u4E14\u6B63\u5728\u8FD0\u884C\u7684\u7EBF\u7A0B\u6570\u91CF\u5927\u4E8E\u6216\u7B49\u4E8EmaximumPoolSize\uFF0C\u90A3\u4E48\u7EBF\u7A0B\u6C60\u4F1A\u542F\u52A8\u9971\u548C\u62D2\u7EDD\u7B56\u7565\u6765\u6267\u884C\u3002
3\u3001\u5F53\u4E00\u4E2A\u7EBF\u7A0B\u5B8C\u6210\u4EFB\u52A1\u65F6\uFF0C\u5B83\u4F1A\u4ECE\u961F\u5217\u4E2D\u53D6\u4E0B\u4E00\u4E2A\u4EFB\u52A1\u6765\u6267\u884C\u3002
4\u3001\u5F53\u4E00\u4E2A\u7EBF\u7A0B\u65E0\u4E8B\u53EF\u505A\u8D85\u8FC7\u4E00\u5B9A\u7684\u65F6\u95F4\uFF08keepAliveTime\uFF09\u65F6\uFF0C\u7EBF\u7A0B\u4F1A\u5224\u65AD\uFF1A
    \u5982\u679C\u5F53\u524D\u8FD0\u884C\u7684\u7EBF\u7A0B\u6570\u5927\u4E8EcorePoolSize\uFF0C\u90A3\u4E48\u8FD9\u4E2A\u7EBF\u7A0B\u5C31\u88AB\u505C\u6389\u3002
    \u6240\u4EE5\u7EBF\u7A0B\u6C60\u7684\u6240\u6709\u4EFB\u52A1\u5B8C\u6210\u540E\uFF0C\u5B83\u6700\u7EC8\u4F1A\u6536\u7F29\u5230corePoolSize\u7684\u5927\u5C0F\u3002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5\u3001\u62D2\u7EDD\u7B56\u7565-\u751F\u4EA7\u4E2D\u5982\u8BBE\u7F6E\u5408\u7406\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u62D2\u7EDD\u7B56\u7565-\u751F\u4EA7\u4E2D\u5982\u8BBE\u7F6E\u5408\u7406\u53C2\u6570" aria-hidden="true">#</a> 5\u3001\u62D2\u7EDD\u7B56\u7565\uFF1F\u751F\u4EA7\u4E2D\u5982\u8BBE\u7F6E\u5408\u7406\u53C2\u6570</h3><h4 id="_1\u3001\u7EBF\u7A0B\u6C60\u7684\u62D2\u7EDD\u7B56\u7565" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u7EBF\u7A0B\u6C60\u7684\u62D2\u7EDD\u7B56\u7565" aria-hidden="true">#</a> 1\u3001\u7EBF\u7A0B\u6C60\u7684\u62D2\u7EDD\u7B56\u7565</h4><p>\u200B \u7B49\u5F85\u961F\u5217\u5DF2\u7ECF\u6392\u6EE1\u4E86\uFF0C\u518D\u4E5F\u585E\u4E0D\u4E0B\u65B0\u4EFB\u52A1\u4E86\uFF0C\u540C\u65F6\uFF0C\u7EBF\u7A0B\u6C60\u4E2D\u7684max\u7EBF\u7A0B\u4E5F\u8FBE\u5230\u4E86\uFF0C\u65E0\u6CD5\u7EE7\u7EED\u4E3A\u65B0\u4EFB\u52A1\u670D\u52A1\u3002\u8FD9\u4E2A\u662F\u65F6\u5019\u6211\u4EEC\u5C31\u9700\u8981\u62D2\u7EDD\u7B56\u7565\u673A\u5236\u5408\u7406\u7684\u5904\u7406\u8FD9\u4E2A\u95EE\u9898\u3002</p><h4 id="_2\u3001jdk\u5185\u7F6E\u7684\u62D2\u7EDD\u7B56\u7565" tabindex="-1"><a class="header-anchor" href="#_2\u3001jdk\u5185\u7F6E\u7684\u62D2\u7EDD\u7B56\u7565" aria-hidden="true">#</a> 2\u3001JDK\u5185\u7F6E\u7684\u62D2\u7EDD\u7B56\u7565</h4><p>AbortPolicy(\u9ED8\u8BA4)\uFF1A\u76F4\u63A5\u629B\u51FARejectedExecutionException\u5F02\u5E38\u963B\u6B62\u7CFB\u7EDF\u6B63\u5E38\u8FD0\u884C</p><p>CallerRunsPolicy\uFF1A\u201C\u8C03\u7528\u8005\u8FD0\u884C\u201D\u4E00\u79CD\u8C03\u8282\u673A\u5236\uFF0C\u8BE5\u7B56\u7565\u65E2\u4E0D\u4F1A\u629B\u5F03\u4EFB\u52A1\uFF0C\u4E5F\u4E0D\u4F1A\u629B\u51FA\u5F02\u5E38\uFF0C\u800C\u662F\u5C06\u67D0\u4E9B\u4EFB\u52A1\u56DE\u9000\u5230\u8C03\u7528\u8005\uFF0C\u4ECE\u800C\u964D\u4F4E\u65B0\u4EFB\u52A1\u7684\u6D41\u91CF\u3002</p><p>DiscardOldestPolicy\uFF1A\u629B\u5F03\u961F\u5217\u4E2D\u7B49\u5F85\u6700\u4E45\u7684\u4EFB\u52A1\uFF0C\u7136\u540E\u628A\u5F53\u524D\u4EFB\u52A1\u52A0\u5165\u961F\u5217\u4E2D\u5C1D\u8BD5\u518D\u6B21\u63D0\u4EA4\u5F53\u524D\u4EFB\u52A1\u3002</p><p>DiscardPolicy\uFF1A\u8BE5\u7B56\u7565\u9ED8\u9ED8\u5730\u4E22\u5F03\u65E0\u6CD5\u5904\u7406\u7684\u4EFB\u52A1\uFF0C\u4E0D\u4E88\u4EFB\u4F55\u5904\u7406\u4E5F\u4E0D\u629B\u51FA\u5F02\u5E38\u3002\u5982\u679C\u5141\u8BB8\u4EFB\u52A1\u4E22\u5931\uFF0C\u8FD9\u662F\u6700\u597D\u7684\u4E00\u79CD\u7B56\u7565\u3002</p><p><strong>\u4EE5\u4E0A\u5185\u7F6E\u62D2\u7EDD\u7B56\u7565\u5747\u5B9E\u73B0\u4E86RejectedExecutionHandle\u63A5\u53E3</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ArrayBlockingQueue</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadPoolExecutor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token class-name">AtomicInteger</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo5</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Task</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> name<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u5904\u7406&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Task{&quot;</span> <span class="token operator">+</span>
                    <span class="token string">&quot;name=&#39;&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">&#39;\\&#39;&#39;</span> <span class="token operator">+</span>
                    <span class="token char">&#39;}&#39;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadPoolExecutor</span> executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token number">60L</span><span class="token punctuation">,</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span>r<span class="token punctuation">,</span> executors<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    <span class="token comment">//\u81EA\u5B9A\u4E49\u9971\u548C\u7B56\u7565</span>
                    <span class="token comment">//\u8BB0\u5F55\u4E00\u4E0B\u65E0\u6CD5\u5904\u7406\u7684\u4EFB\u52A1</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u65E0\u6CD5\u5904\u7406\u7684\u4EFB\u52A1\uFF1A&quot;</span> <span class="token operator">+</span> r<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token string">&quot;\u4EFB\u52A1-&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        executor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>\u65E0\u6CD5\u5904\u7406\u7684\u4EFB\u52A1\uFF1A<span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-2&#39;</span><span class="token punctuation">}</span>
\u65E0\u6CD5\u5904\u7406\u7684\u4EFB\u52A1\uFF1A<span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-3&#39;</span><span class="token punctuation">}</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span>\u5904\u7406\u4EFB\u52A1<span class="token operator">-</span><span class="token number">0</span>
\u65E0\u6CD5\u5904\u7406\u7684\u4EFB\u52A1\uFF1A<span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-4&#39;</span><span class="token punctuation">}</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span>\u5904\u7406\u4EFB\u52A1<span class="token operator">-</span><span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\u4E2D\u53EF\u4EE5\u770B\u5230\u67093\u4E2A\u4EFB\u52A1\u8FDB\u5165\u4E86\u9971\u548C\u7B56\u7565\u4E2D\uFF0C\u8BB0\u5F55\u4E86\u4EFB\u52A1\u7684\u65E5\u5FD7\uFF0C\u5BF9\u4E8E\u65E0\u6CD5\u5904\u7406\u591A\u4EFB\u52A1\uFF0C\u6211\u4EEC\u6700\u597D\u80FD\u591F\u8BB0\u5F55\u4E00\u4E0B\uFF0C\u8BA9\u5F00\u53D1\u4EBA\u5458\u80FD\u591F\u77E5\u9053\u3002\u4EFB\u52A1\u8FDB\u5165\u4E86\u9971\u548C\u7B56\u7565\uFF0C\u8BF4\u660E\u7EBF\u7A0B\u6C60\u7684\u914D\u7F6E\u53EF\u80FD\u4E0D\u662F\u592A\u5408\u7406\uFF0C\u6216\u8005\u673A\u5668\u7684\u6027\u80FD\u6709\u9650\uFF0C\u9700\u8981\u505A\u4E00\u4E9B\u4F18\u5316\u8C03\u6574\u3002</p><h4 id="_3\u3001\u751F\u4EA7\u4E2D\u5408\u7406\u7684\u8BBE\u7F6E\u53C2\u6570" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u751F\u4EA7\u4E2D\u5408\u7406\u7684\u8BBE\u7F6E\u53C2\u6570" aria-hidden="true">#</a> 3\u3001\u751F\u4EA7\u4E2D\u5408\u7406\u7684\u8BBE\u7F6E\u53C2\u6570</h4><p>\u8981\u60F3\u5408\u7406\u7684\u914D\u7F6E\u7EBF\u7A0B\u6C60\uFF0C\u9700\u8981\u5148\u5206\u6790\u4EFB\u52A1\u7684\u7279\u6027\uFF0C\u53EF\u4EE5\u4ECE\u4EE5\u4E0B\u51E0\u4E2A\u89D2\u5EA6\u5206\u6790\uFF1A</p><ul><li>\u4EFB\u52A1\u7684\u6027\u8D28\uFF1ACPU\u5BC6\u96C6\u578B\u4EFB\u52A1\u3001IO\u5BC6\u96C6\u578B\u4EFB\u52A1\u548C\u6DF7\u5408\u578B\u4EFB\u52A1</li><li>\u4EFB\u52A1\u7684\u4F18\u5148\u7EA7\uFF1A\u9AD8\u3001\u4E2D\u3001\u4F4E</li><li>\u4EFB\u52A1\u7684\u6267\u884C\u65F6\u95F4\uFF1A\u957F\u3001\u4E2D\u3001\u77ED</li><li>\u4EFB\u52A1\u7684\u4F9D\u8D56\u6027\uFF1A\u662F\u5426\u4F9D\u8D56\u5176\u4ED6\u7684\u7CFB\u7EDF\u8D44\u6E90\uFF0C\u5982\u6570\u636E\u5E93\u8FDE\u63A5\u3002</li></ul><p>\u6027\u8D28\u4E0D\u540C\u4EFB\u52A1\u53EF\u4EE5\u7528\u4E0D\u540C\u89C4\u6A21\u7684\u7EBF\u7A0B\u6C60\u5206\u5F00\u5904\u7406\u3002CPU\u5BC6\u96C6\u578B\u4EFB\u52A1\u5E94\u8BE5\u5C3D\u53EF\u80FD\u5C0F\u7684\u7EBF\u7A0B\uFF0C\u5982\u914D\u7F6Ecpu\u6570\u91CF+1\u4E2A\u7EBF\u7A0B\u7684\u7EBF\u7A0B\u6C60\u3002\u7531\u4E8EIO\u5BC6\u96C6\u578B\u4EFB\u52A1\u5E76\u4E0D\u662F\u4E00\u76F4\u5728\u6267\u884C\u4EFB\u52A1\uFF0C\u4E0D\u80FD\u8BA9cpu\u95F2\u7740\uFF0C\u5219\u5E94\u914D\u7F6E\u5C3D\u53EF\u80FD\u591A\u7684\u7EBF\u7A0B\uFF0C\u5982\uFF1Acup\u6570\u91CF*2\u3002\u6DF7\u5408\u578B\u7684\u4EFB\u52A1\uFF0C\u5982\u679C\u53EF\u4EE5\u62C6\u5206\uFF0C\u5C06\u5176\u62C6\u5206\u6210\u4E00\u4E2ACPU\u5BC6\u96C6\u578B\u4EFB\u52A1\u548C\u4E00\u4E2AIO\u5BC6\u96C6\u578B\u4EFB\u52A1\uFF0C\u53EA\u8981\u8FD92\u4E2A\u4EFB\u52A1\u6267\u884C\u7684\u65F6\u95F4\u76F8\u5DEE\u4E0D\u662F\u592A\u5927\uFF0C\u90A3\u4E48\u5206\u89E3\u540E\u6267\u884C\u7684\u541E\u5410\u91CF\u5C06\u9AD8\u4E8E\u4E32\u884C\u6267\u884C\u7684\u541E\u5410\u91CF\u3002\u53EF\u4EE5\u901A\u8FC7<code>Runtime.getRuntime().availableProcessors()</code>\u65B9\u6CD5\u83B7\u53D6cpu\u6570\u91CF\u3002\u4F18\u5148\u7EA7\u4E0D\u540C\u4EFB\u52A1\u53EF\u4EE5\u5BF9\u7EBF\u7A0B\u6C60\u91C7\u7528\u4F18\u5148\u7EA7\u961F\u5217\u6765\u5904\u7406\uFF0C\u8BA9\u4F18\u5148\u7EA7\u9AD8\u7684\u5148\u6267\u884C\u3002</p><p>\u4F7F\u7528\u961F\u5217\u7684\u65F6\u5019\u5EFA\u8BAE\u4F7F\u7528\u6709\u754C\u961F\u5217\uFF0C\u6709\u754C\u961F\u5217\u589E\u52A0\u4E86\u7CFB\u7EDF\u7684\u7A33\u5B9A\u6027\uFF0C\u5982\u679C\u91C7\u7528\u65E0\u89E3\u961F\u5217\uFF0C\u4EFB\u52A1\u592A\u591A\u7684\u65F6\u5019\u53EF\u80FD\u5BFC\u81F4\u7CFB\u7EDFOOM\uFF0C\u76F4\u63A5\u8BA9\u7CFB\u7EDF\u5B95\u673A\u3002</p><p>\u7EBF\u7A0B\u6C60\u6C47\u603B\u7EBF\u7A0B\u5927\u5C0F\u5BF9\u7CFB\u7EDF\u7684\u6027\u80FD\u6709\u4E00\u5B9A\u7684\u5F71\u54CD\uFF0C\u6211\u4EEC\u7684\u76EE\u6807\u662F\u5E0C\u671B\u7CFB\u7EDF\u80FD\u591F\u53D1\u6325\u6700\u597D\u7684\u6027\u80FD\uFF0C\u8FC7\u591A\u6216\u8005\u8FC7\u5C0F\u7684\u7EBF\u7A0B\u6570\u91CF\u65E0\u6CD5\u6709\u6D88\u606F\u7684\u4F7F\u7528\u673A\u5668\u7684\u6027\u80FD\u3002\u548BJava Concurrency inPractice\u4E66\u4E2D\u7ED9\u51FA\u4E86\u4F30\u7B97\u7EBF\u7A0B\u6C60\u5927\u5C0F\u7684\u516C\u5F0F\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Ncpu</span> <span class="token operator">=</span> CUP\u7684\u6570\u91CF
<span class="token class-name">Ucpu</span> <span class="token operator">=</span> \u76EE\u6807CPU\u7684\u4F7F\u7528\u7387\uFF0C<span class="token number">0</span><span class="token operator">&lt;=</span><span class="token class-name">Ucpu</span><span class="token operator">&lt;=</span><span class="token number">1</span>
<span class="token class-name">W</span><span class="token operator">/</span><span class="token class-name">C</span> <span class="token operator">=</span> \u7B49\u5F85\u65F6\u95F4\u4E0E\u8BA1\u7B97\u65F6\u95F4\u7684\u6BD4\u4F8B
\u4E3A\u4FDD\u5B58\u5904\u7406\u5668\u8FBE\u5230\u671F\u671B\u7684\u4F7F\u7528\u7387\uFF0C\u6700\u6709\u7684\u7EBF\u7A0B\u6C60\u7684\u5927\u5C0F\u7B49\u4E8E\uFF1A
<span class="token class-name">Nthreads</span> <span class="token operator">=</span> <span class="token class-name">Ncpu</span> \xD7 <span class="token class-name">Ucpu</span> \xD7 <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span><span class="token class-name">W</span><span class="token operator">/</span><span class="token class-name">C</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p>CPU\u5BC6\u96C6\u578B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u67E5\u770BCPU\u6838\u6570</span>
<span class="token class-name">System</span><span class="token punctuation">.</span> out <span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span> getRuntime <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">availableProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\uFFFC<img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20220329145519183.png" alt="image-20220329145519183"></p></li><li><p>IO\u5BC6\u96C6\u578B</p><ol><li>\u7531\u4E8EIO\u5BC6\u96C6\u578B\u4EFB\u52A1\u7EBF\u7A0B\u5E76\u4E0D\u662F\u4E00\u76F4\u5728\u6267\u884C\u4EFB\u52A1\uFF0C\u5219\u5E94\u914D\u7F6E\u5C3D\u53EF\u80FD\u591A\u7684\u7EBF\u7A0B\uFF0C\u5982<strong>CPU\u6838\u6570 * 2</strong> \u3002</li><li><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20220329145652545.png" alt="image-20220329145652545"></li></ol></li></ol><p>\u770B\u516C\u53F8\u4E1A\u52A1\u662FCPU\u5BC6\u96C6\u578B\u8FD8\u662FIO\u5BC6\u96C6\u578B\u7684\uFF0C\u8FD9\u4E24\u79CD\u4E0D\u4E00\u6837\uFF0C\u6765\u51B3\u5B9A\u7EBF\u7A0B\u6C60\u7EBF\u7A0B\u6570\u7684\u6700\u4F73\u5408\u7406\u914D\u7F6E\u6570\u3002</p><h3 id="_6\u3001\u8D85\u7EA7\u5927\u5751-\u5728\u5DE5\u4F5C\u4E2D\u5355\u4E00\u7684-\u56FA\u5B9A\u6570\u7684-\u53EF\u53D8\u7684\u4E09\u79CD\u521B\u5EFA\u7EBF\u7A0B\u6C60\u7684\u65B9\u6CD5\u54EA\u4E2A\u7528\u7684\u591A" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u8D85\u7EA7\u5927\u5751-\u5728\u5DE5\u4F5C\u4E2D\u5355\u4E00\u7684-\u56FA\u5B9A\u6570\u7684-\u53EF\u53D8\u7684\u4E09\u79CD\u521B\u5EFA\u7EBF\u7A0B\u6C60\u7684\u65B9\u6CD5\u54EA\u4E2A\u7528\u7684\u591A" aria-hidden="true">#</a> 6\u3001\u8D85\u7EA7\u5927\u5751 \u5728\u5DE5\u4F5C\u4E2D\u5355\u4E00\u7684/\u56FA\u5B9A\u6570\u7684/\u53EF\u53D8\u7684\u4E09\u79CD\u521B\u5EFA\u7EBF\u7A0B\u6C60\u7684\u65B9\u6CD5\u54EA\u4E2A\u7528\u7684\u591A\uFF1F</h3><p>\u7B54\u6848\u662F<strong>\u4E00\u4E2A\u90FD\u4E0D\u7528</strong>\uFF0C\u6211\u4EEC\u5DE5\u4F5C\u4E2D\u53EA\u80FD\u4F7F\u7528\u81EA\u5B9A\u4E49\u7684</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161641934-fd8ddb1d-5b05-4d88-81c6-04a40367c591.png" alt="image"></p><h3 id="_7\u3001\u81EA\u5B9A\u4E49\u7EBF\u7A0B\u6C60" tabindex="-1"><a class="header-anchor" href="#_7\u3001\u81EA\u5B9A\u4E49\u7EBF\u7A0B\u6C60" aria-hidden="true">#</a> 7\u3001\u81EA\u5B9A\u4E49\u7EBF\u7A0B\u6C60</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u7EBF\u7A0B\u6C60
 * Arrays
 * Collections
 * Executors
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyThreadPoolDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> threadPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>
                <span class="token number">2</span><span class="token punctuation">,</span>
                <span class="token number">5</span><span class="token punctuation">,</span>
                <span class="token number">2L</span><span class="token punctuation">,</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment">//new ThreadPoolExecutor.AbortPolicy()</span>
                <span class="token comment">//new ThreadPoolExecutor.CallerRunsPolicy()</span>
                <span class="token comment">//new ThreadPoolExecutor.DiscardOldestPolicy()</span>
                <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>DiscardPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//10\u4E2A\u987E\u5BA2\u8BF7\u6C42</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                threadPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t \u529E\u7406\u4E1A\u52A1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            threadPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">threadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//List list = new ArrayList();</span>
        <span class="token comment">//List list = Arrays.asList(&quot;a&quot;,&quot;b&quot;);</span>
        <span class="token comment">//\u56FA\u5B9A\u6570\u7684\u7EBF\u7A0B\u6C60\uFF0C\u4E00\u6C60\u4E94\u7EBF\u7A0B</span>

<span class="token comment">//       ExecutorService threadPool =  Executors.newFixedThreadPool(5); //\u4E00\u4E2A\u94F6\u884C\u7F51\u70B9\uFF0C5\u4E2A\u53D7\u7406\u4E1A\u52A1\u7684\u7A97\u53E3</span>
<span class="token comment">//       ExecutorService threadPool =  Executors.newSingleThreadExecutor(); //\u4E00\u4E2A\u94F6\u884C\u7F51\u70B9\uFF0C1\u4E2A\u53D7\u7406\u4E1A\u52A1\u7684\u7A97\u53E3</span>
        <span class="token class-name">ExecutorService</span> threadPool <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//\u4E00\u4E2A\u94F6\u884C\u7F51\u70B9\uFF0C\u53EF\u6269\u5C55\u53D7\u7406\u4E1A\u52A1\u7684\u7A97\u53E3</span>

        <span class="token comment">//10\u4E2A\u987E\u5BA2\u8BF7\u6C42</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                threadPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t \u529E\u7406\u4E1A\u52A1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            threadPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8\u3001\u7EBF\u7A0B\u6C60\u4E2D\u76842\u4E2A\u5173\u95ED\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_8\u3001\u7EBF\u7A0B\u6C60\u4E2D\u76842\u4E2A\u5173\u95ED\u65B9\u6CD5" aria-hidden="true">#</a> 8\u3001\u7EBF\u7A0B\u6C60\u4E2D\u76842\u4E2A\u5173\u95ED\u65B9\u6CD5</h3><p>\u7EBF\u7A0B\u6C60\u63D0\u4F9B\u4E862\u4E2A\u5173\u95ED\u65B9\u6CD5\uFF1A<code>shutdown</code>\u548C<code>shutdownNow</code>\uFF0C\u5F53\u8C03\u7528\u8005\u4E24\u4E2A\u65B9\u6CD5\u4E4B\u540E\uFF0C\u7EBF\u7A0B\u6C60\u4F1A\u904D\u5386\u5185\u90E8\u7684\u5DE5\u4F5C\u7EBF\u7A0B\uFF0C\u7136\u540E\u8C03\u7528\u6BCF\u4E2A\u5DE5\u4F5C\u7EBF\u7A0B\u7684interrrupt\u65B9\u6CD5\u7ED9\u7EBF\u7A0B\u53D1\u9001\u4E2D\u65AD\u4FE1\u53F7\uFF0C\u5185\u90E8\u5982\u679C\u65E0\u6CD5\u54CD\u5E94\u4E2D\u65AD\u4FE1\u53F7\u7684\u53EF\u80FD\u6C38\u8FDC\u65E0\u6CD5\u7EC8\u6B62\uFF0C\u6240\u4EE5\u5982\u679C\u5185\u90E8\u6709\u65E0\u7EBF\u5FAA\u73AF\u7684\uFF0C\u6700\u597D\u5728\u5FAA\u73AF\u5185\u90E8\u68C0\u6D4B\u4E00\u4E0B\u7EBF\u7A0B\u7684\u4E2D\u65AD\u4FE1\u53F7\uFF0C\u5408\u7406\u7684\u9000\u51FA\u3002\u8C03\u7528\u8005\u4E24\u4E2A\u65B9\u6CD5\u4E2D\u4EFB\u610F\u4E00\u4E2A\uFF0C\u7EBF\u7A0B\u6C60\u7684<code>isShutdown</code>\u65B9\u6CD5\u5C31\u4F1A\u8FD4\u56DEtrue\uFF0C\u5F53\u6240\u6709\u7684\u4EFB\u52A1\u7EBF\u7A0B\u90FD\u5173\u95ED\u4E4B\u540E\uFF0C\u624D\u8868\u793A\u7EBF\u7A0B\u6C60\u5173\u95ED\u6210\u529F\uFF0C\u8FD9\u65F6\u8C03\u7528<code>isTerminaed</code>\u65B9\u6CD5\u4F1A\u8FD4\u56DEtrue\u3002</p><p>\u8C03\u7528<code>shutdown</code>\u65B9\u6CD5\u4E4B\u540E\uFF0C\u7EBF\u7A0B\u6C60\u5C06\u4E0D\u518D\u63A5\u53E3\u65B0\u4EFB\u52A1\uFF0C\u5185\u90E8\u4F1A\u5C06\u6240\u6709\u5DF2\u63D0\u4EA4\u7684\u4EFB\u52A1\u5904\u7406\u5B8C\u6BD5\uFF0C\u5904\u7406\u5B8C\u6BD5\u4E4B\u540E\uFF0C\u5DE5\u4F5C\u7EBF\u7A0B\u81EA\u52A8\u9000\u51FA\u3002</p><p>\u800C\u8C03\u7528<code>shutdownNow</code>\u65B9\u6CD5\u540E\uFF0C\u7EBF\u7A0B\u6C60\u4F1A\u5C06\u8FD8\u672A\u5904\u7406\u7684\uFF08\u5728\u961F\u91CC\u7B49\u5F85\u5904\u7406\u7684\u4EFB\u52A1\uFF09\u4EFB\u52A1\u79FB\u9664\uFF0C\u5C06\u6B63\u5728\u5904\u7406\u4E2D\u7684\u5904\u7406\u5B8C\u6BD5\u4E4B\u540E\uFF0C\u5DE5\u4F5C\u7EBF\u7A0B\u81EA\u52A8\u9000\u51FA\u3002</p><p>\u81F3\u4E8E\u8C03\u7528\u54EA\u4E2A\u65B9\u6CD5\u6765\u5173\u95ED\u7EBF\u7A0B\uFF0C\u5E94\u8BE5\u7531\u63D0\u4EA4\u5230\u7EBF\u7A0B\u6C60\u7684\u4EFB\u52A1\u7279\u6027\u51B3\u5B9A\uFF0C\u591A\u6570\u60C5\u51B5\u4E0B\u8C03\u7528<code>shutdown</code>\u65B9\u6CD5\u6765\u5173\u95ED\u7EBF\u7A0B\u6C60\uFF0C\u5982\u679C\u4EFB\u52A1\u4E0D\u4E00\u5B9A\u8981\u6267\u884C\u5B8C\uFF0C\u5219\u53EF\u4EE5\u8C03\u7528<code>shutdownNow</code>\u65B9\u6CD5\u3002</p><h3 id="_9\u3001blockingqueue\u963B\u585E\u961F\u5217" tabindex="-1"><a class="header-anchor" href="#_9\u3001blockingqueue\u963B\u585E\u961F\u5217" aria-hidden="true">#</a> 9\u3001BlockingQueue\u963B\u585E\u961F\u5217</h3><h4 id="_1\u3001\u6808\u4E0E\u961F\u5217" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u6808\u4E0E\u961F\u5217" aria-hidden="true">#</a> 1\u3001\u6808\u4E0E\u961F\u5217</h4><p>\u6808\uFF1A\u5148\u8FDB\u540E\u51FA\uFF0C\u540E\u8FDB\u5148\u51FA</p><p>\u961F\u5217\uFF1A\u5148\u8FDB\u5148\u51FA</p><h4 id="_2\u3001\u963B\u585E\u961F\u5217" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u963B\u585E\u961F\u5217" aria-hidden="true">#</a> 2\u3001\u963B\u585E\u961F\u5217</h4><p>\u963B\u585E\uFF1A\u5FC5\u987B\u8981\u963B\u585E/\u4E0D\u5F97\u4E0D\u963B\u585E</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161550577-d838e7b4-62c9-4630-ad52-34ecf72f3aee.png" alt="image"></p><p>\u7EBF\u7A0B1\u5F80\u963B\u585E\u961F\u5217\u91CC\u6DFB\u52A0\u5143\u7D20\uFF0C\u7EBF\u7A0B2\u4ECE\u963B\u585E\u961F\u5217\u91CC\u79FB\u9664\u5143\u7D20</p><p>\u5F53\u961F\u5217\u662F\u7A7A\u7684\uFF0C\u4ECE\u961F\u5217\u4E2D\u83B7\u53D6\u5143\u7D20\u7684\u64CD\u4F5C\u5C06\u4F1A\u88AB\u963B\u585E</p><p>\u5F53\u961F\u5217\u662F\u6EE1\u7684\uFF0C\u4ECE\u961F\u5217\u4E2D\u6DFB\u52A0\u5143\u7D20\u7684\u64CD\u4F5C\u5C06\u4F1A\u88AB\u963B\u585E</p><p>\u8BD5\u56FE\u4ECE\u7A7A\u7684\u961F\u5217\u4E2D\u83B7\u53D6\u5143\u7D20\u7684\u7EBF\u7A0B\u5C06\u4F1A\u88AB\u963B\u585E\uFF0C\u76F4\u5230\u5176\u4ED6\u7EBF\u7A0B\u5F80\u7A7A\u7684\u961F\u5217\u63D2\u5165\u65B0\u7684\u5143\u7D20</p><p>\u8BD5\u56FE\u5411\u5DF2\u6EE1\u7684\u961F\u5217\u4E2D\u6DFB\u52A0\u65B0\u5143\u7D20\u7684\u7EBF\u7A0B\u5C06\u4F1A\u88AB\u963B\u585E\uFF0C\u76F4\u5230\u5176\u4ED6\u7EBF\u7A0B\u4ECE\u961F\u5217\u4E2D\u79FB\u9664\u4E00\u4E2A\u6216\u591A\u4E2A\u5143\u7D20\u6216\u8005\u5B8C\u5168\u6E05\u7A7A\uFF0C\u4F7F\u961F\u5217\u53D8\u5F97\u7A7A\u95F2\u8D77\u6765\u5E76\u540E\u7EED\u65B0\u589E</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161556740-782f1ca1-a941-4b76-b581-4b9ffef9a5ca.png" alt="image"></p><h4 id="_3\u3001\u79CD\u7C7B\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u79CD\u7C7B\u5206\u6790" aria-hidden="true">#</a> 3\u3001\u79CD\u7C7B\u5206\u6790</h4><p><strong>ArrayBlockingQueue</strong>\uFF1A\u662F\u4E00\u4E2A\u57FA\u4E8E\u6570\u7EC4\u7ED3\u6784\u7684\u6709\u754C\u963B\u585E\u961F\u5217\uFF0C\u6B64\u961F\u5217\u6309\u7167\u5148\u8FDB\u5148\u51FA\u539F\u5219\u5BF9\u5143\u7D20\u8FDB\u884C\u6392\u5E8F</p><p><strong>LinkedBlockingQueue</strong>\uFF1A\u7531\u94FE\u8868\u7ED3\u6784\u7EC4\u6210\u7684\u6709\u754C\uFF08\u4F46\u5927\u5C0F\u9ED8\u8BA4\u503C\u4E3Ainteger.MAX_VALUE\uFF09\u963B\u585E\u961F\u5217\uFF0C\u6B64\u961F\u5217\u6309\u7167\u5148\u8FDB\u5148\u51FA\u6392\u5E8F\u5143\u7D20\uFF0C\u541E\u5410\u91CF\u901A\u5E38\u8981\u9AD8\u4E8EArrayBlockingQueue\u3002\u9759\u6001\u5DE5\u5382\u65B9\u6CD5<code>Executors.newFixedThreadPool</code>\u4F7F\u7528\u4E86\u8FD9\u4E2A\u961F\u5217\u3002</p><p>PriorityBlockingQueue\uFF1A\u652F\u6301\u4F18\u5148\u7EA7\u6392\u5E8F\u7684\u65E0\u754C\u963B\u585E\u961F\u5217\u3002</p><p>DelayQueue\uFF1A\u4F7F\u7528\u4F18\u5148\u7EA7\u961F\u5217\u5B9E\u73B0\u7684\u5EF6\u8FDF\u65E0\u754C\u963B\u585E\u961F\u5217\u3002</p><p><strong>SynchronousQueue</strong>\uFF1A\u4E0D\u5B58\u50A8\u5143\u7D20\u7684\u963B\u585E\u961F\u5217\uFF0C\u4E5F\u5373\u5355\u4E2A\u5143\u7D20\u7684\u961F\u5217,\u6BCF\u4E2A\u63D2\u5165\u64CD\u4F5C\u5FC5\u987B\u7B49\u5230\u53E6\u5916\u4E00\u4E2A\u7EBF\u7A0B\u8C03\u7528\u79FB\u9664\u64CD\u4F5C\uFF0C\u5426\u5219\u63D2\u5165\u64CD\u4F5C\u4E00\u76F4\u5904\u7406\u963B\u585E\u72B6\u6001\uFF0C\u541E\u5410\u91CF\u901A\u5E38\u8981\u9AD8\u4E8ELinkedBlockingQueue\uFF0C\u9759\u6001\u5DE5\u5382\u65B9\u6CD5<code>Executors.newCachedThreadPool</code>\u4F7F\u7528\u8FD9\u4E2A\u961F\u5217</p><p>LinkedTransferQueue\uFF1A\u7531\u94FE\u8868\u7EC4\u6210\u7684\u65E0\u754C\u963B\u585E\u961F\u5217\u3002</p><p>LinkedBlockingDeque\uFF1A\u7531\u94FE\u8868\u7EC4\u6210\u7684\u53CC\u5411\u963B\u585E\u961F\u5217\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token class-name">String</span> taskName <span class="token operator">=</span> <span class="token string">&quot;\u4EFB\u52A1&quot;</span> <span class="token operator">+</span> j<span class="token punctuation">;</span>
            executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u5904\u7406&quot;</span> <span class="token operator">+</span> taskName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//\u6A21\u62DF\u4EFB\u52A1\u5185\u90E8\u5904\u7406\u8017\u65F6</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        executor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE3\u7801\u4E2D\u4F7F\u7528<code>Executors.newCachedThreadPool()</code>\u521B\u5EFA\u7EBF\u7A0B\u6C60\uFF0C\u770B\u4E00\u4E0B\u7684\u6E90\u7801\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">ExecutorService</span> <span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">,</span>
                                      <span class="token number">60L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span>
                                      <span class="token keyword">new</span> <span class="token class-name">SynchronousQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE\u8F93\u51FA\u4E2D\u53EF\u4EE5\u770B\u51FA\uFF0C\u7CFB\u7EDF\u521B\u5EFA\u4E8650\u4E2A\u7EBF\u7A0B\u5904\u7406\u4EFB\u52A1\uFF0C\u4EE3\u7801\u4E2D\u4F7F\u7528\u4E86<code>SynchronousQueue</code>\u540C\u6B65\u961F\u5217\uFF0C\u8FD9\u79CD\u961F\u5217\u6BD4\u8F83\u7279\u6B8A\uFF0C\u653E\u5165\u5143\u7D20\u5FC5\u987B\u8981\u6709\u53E6\u5916\u4E00\u4E2A\u7EBF\u7A0B\u53BB\u83B7\u53D6\u8FD9\u4E2A\u5143\u7D20\uFF0C\u5426\u5219\u653E\u5165\u5143\u7D20\u4F1A\u5931\u8D25\u6216\u8005\u4E00\u76F4\u963B\u585E\u5728\u90A3\u91CC\u76F4\u5230\u6709\u7EBF\u7A0B\u53D6\u8D70\uFF0C\u793A\u4F8B\u4E2D\u4EFB\u52A1\u5904\u7406\u4F11\u7720\u4E86\u6307\u5B9A\u7684\u65F6\u95F4\uFF0C\u5BFC\u81F4\u5DF2\u521B\u5EFA\u7684\u5DE5\u4F5C\u7EBF\u7A0B\u90FD\u5FD9\u4E8E\u5904\u7406\u4EFB\u52A1\uFF0C\u6240\u4EE5\u65B0\u6765\u4EFB\u52A1\u4E4B\u540E\uFF0C\u5C06\u4EFB\u52A1\u4E22\u5165\u540C\u6B65\u961F\u5217\u4F1A\u5931\u8D25\uFF0C\u4E22\u5165\u961F\u5217\u5931\u8D25\u4E4B\u540E\uFF0C\u4F1A\u5C1D\u8BD5\u65B0\u5EFA\u7EBF\u7A0B\u5904\u7406\u4EFB\u52A1\u3002\u4F7F\u7528\u4E0A\u9762\u7684\u65B9\u5F0F\u521B\u5EFA\u7EBF\u7A0B\u6C60\u9700\u8981\u6CE8\u610F\uFF0C\u5982\u679C\u9700\u8981\u5904\u7406\u7684\u4EFB\u52A1\u6BD4\u8F83\u8017\u65F6\uFF0C\u4F1A\u5BFC\u81F4\u65B0\u6765\u7684\u4EFB\u52A1\u90FD\u4F1A\u521B\u5EFA\u65B0\u7684\u7EBF\u7A0B\u8FDB\u884C\u5904\u7406\uFF0C\u53EF\u80FD\u4F1A\u5BFC\u81F4\u521B\u5EFA\u975E\u5E38\u591A\u7684\u7EBF\u7A0B\uFF0C\u6700\u7EC8\u8017\u5C3D\u7CFB\u7EDF\u8D44\u6E90\uFF0C\u89E6\u53D1OOM\u3002</p><p><strong>PriorityBlockingQueue\u4F18\u5148\u7EA7\u961F\u5217\u7684\u7EBF\u7A0B\u6C60</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo3</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Task</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">,</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Task</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> i<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>i <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u5904\u7406&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">Task</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>i<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ExecutorService</span> executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token number">60L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">PriorityBlockingQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> taskName <span class="token operator">=</span> <span class="token string">&quot;\u4EFB\u52A1&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>
            executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> taskName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">90</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> taskName <span class="token operator">=</span> <span class="token string">&quot;\u4EFB\u52A1&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">;</span>
            executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> taskName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        executor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u4E2D\uFF0C\u9664\u4E86\u7B2C\u4E00\u4E2A\u4EFB\u52A1\uFF0C\u5176\u4ED6\u4EFB\u52A1\u6309\u7167\u4F18\u5148\u7EA7\u9AD8\u4F4E\u6309\u987A\u5E8F\u5904\u7406\u3002\u539F\u56E0\u5728\u4E8E\uFF1A\u521B\u5EFA\u7EBF\u7A0B\u6C60\u7684\u65F6\u5019\u4F7F\u7528\u4E86\u4F18\u5148\u7EA7\u961F\u5217\uFF0C\u8FDB\u5165\u961F\u5217\u4E2D\u7684\u4EFB\u52A1\u4F1A\u8FDB\u884C\u6392\u5E8F\uFF0C\u4EFB\u52A1\u7684\u5148\u540E\u987A\u5E8F\u7531Task\u4E2D\u7684i\u53D8\u91CF\u51B3\u5B9A\u3002\u5411<code>PriorityBlockingQueue</code>\u52A0\u5165\u5143\u7D20\u7684\u65F6\u5019\uFF0C\u5185\u90E8\u4F1A\u8C03\u7528\u4EE3\u7801\u4E2DTask\u7684<code>compareTo</code>\u65B9\u6CD5\u51B3\u5B9A\u5143\u7D20\u7684\u5148\u540E\u987A\u5E8F\u3002</p><h4 id="_4\u3001blockingqueue\u6838\u5FC3\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_4\u3001blockingqueue\u6838\u5FC3\u65B9\u6CD5" aria-hidden="true">#</a> 4\u3001BlockingQueue\u6838\u5FC3\u65B9\u6CD5</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161565952-60513c15-8261-450d-9fd3-57f35be66a42.png" alt="image"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161571726-0fb6d810-ca4c-4f9f-b0c7-ee1282a95d7e.png" alt="image"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ArrayBlockingQueue</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BlockingQueue</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u963B\u585E\u961F\u5217
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlockingQueueDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

<span class="token comment">//        List list = new ArrayList();</span>

        <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> blockingQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u7B2C\u4E00\u7EC4</span>
<span class="token comment">//        System.out.println(blockingQueue.add(&quot;a&quot;));</span>
<span class="token comment">//        System.out.println(blockingQueue.add(&quot;b&quot;));</span>
<span class="token comment">//        System.out.println(blockingQueue.add(&quot;c&quot;));</span>
<span class="token comment">//        System.out.println(blockingQueue.element());</span>

        <span class="token comment">//System.out.println(blockingQueue.add(&quot;x&quot;));</span>
<span class="token comment">//        System.out.println(blockingQueue.remove());</span>
<span class="token comment">//        System.out.println(blockingQueue.remove());</span>
<span class="token comment">//        System.out.println(blockingQueue.remove());</span>
<span class="token comment">//        System.out.println(blockingQueue.remove());</span>
<span class="token comment">//    \u7B2C\u4E8C\u7EC4</span>
<span class="token comment">//        System.out.println(blockingQueue.offer(&quot;a&quot;));</span>
<span class="token comment">//        System.out.println(blockingQueue.offer(&quot;b&quot;));</span>
<span class="token comment">//        System.out.println(blockingQueue.offer(&quot;c&quot;));</span>
<span class="token comment">//        System.out.println(blockingQueue.offer(&quot;x&quot;));</span>
<span class="token comment">//        System.out.println(blockingQueue.poll());</span>
<span class="token comment">//        System.out.println(blockingQueue.poll());</span>
<span class="token comment">//        System.out.println(blockingQueue.poll());</span>
<span class="token comment">//        System.out.println(blockingQueue.poll());</span>
<span class="token comment">//    \u7B2C\u4E09\u7EC4        </span>
<span class="token comment">//         blockingQueue.put(&quot;a&quot;);</span>
<span class="token comment">//         blockingQueue.put(&quot;b&quot;);</span>
<span class="token comment">//         blockingQueue.put(&quot;c&quot;);</span>
<span class="token comment">//         //blockingQueue.put(&quot;x&quot;);</span>
<span class="token comment">//        System.out.println(blockingQueue.take());</span>
<span class="token comment">//        System.out.println(blockingQueue.take());</span>
<span class="token comment">//        System.out.println(blockingQueue.take());</span>
<span class="token comment">//        System.out.println(blockingQueue.take());</span>
        
<span class="token comment">//    \u7B2C\u56DB\u7EC4        </span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>blockingQueue<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token number">3L</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_10\u3001\u6269\u5C55\u7EBF\u7A0B\u6C60" tabindex="-1"><a class="header-anchor" href="#_10\u3001\u6269\u5C55\u7EBF\u7A0B\u6C60" aria-hidden="true">#</a> 10\u3001\u6269\u5C55\u7EBF\u7A0B\u6C60</h3><p>\u867D\u7136jdk\u63D0\u4F9B\u4E86<code>ThreadPoolExecutor</code>\u8FD9\u4E2A\u9AD8\u6027\u80FD\u7EBF\u7A0B\u6C60\uFF0C\u4F46\u662F\u5982\u679C\u6211\u4EEC\u81EA\u5DF1\u60F3\u5728\u8FD9\u4E2A\u7EBF\u7A0B\u6C60\u4E0A\u9762\u505A\u4E00\u4E9B\u6269\u5C55\uFF0C\u6BD4\u5982\uFF0C\u76D1\u63A7\u6BCF\u4E2A\u4EFB\u52A1\u6267\u884C\u7684\u5F00\u59CB\u65F6\u95F4\uFF0C\u7ED3\u675F\u65F6\u95F4\uFF0C\u6216\u8005\u4E00\u4E9B\u5176\u4ED6\u81EA\u5B9A\u4E49\u7684\u529F\u80FD\uFF0C\u6211\u4EEC\u5E94\u8BE5\u600E\u4E48\u529E\uFF1F</p><p>\u8FD9\u4E2Ajdk\u5DF2\u7ECF\u5E2E\u6211\u4EEC\u60F3\u5230\u4E86\uFF0C<code>ThreadPoolExecutor</code>\u5185\u90E8\u63D0\u4F9B\u4E86\u51E0\u4E2A\u65B9\u6CD5<code>beforeExecute</code>\u3001<code>afterExecute</code>\u3001<code>terminated</code>\uFF0C\u53EF\u4EE5\u7531\u5F00\u53D1\u4EBA\u5458\u81EA\u5DF1\u53BB\u8FD9\u4E9B\u65B9\u6CD5\u3002\u770B\u4E00\u4E0B\u7EBF\u7A0B\u6C60\u5185\u90E8\u7684\u6E90\u7801\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token function">beforeExecute</span><span class="token punctuation">(</span>wt<span class="token punctuation">,</span> task<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u4EFB\u52A1\u6267\u884C\u4E4B\u524D\u8C03\u7528\u7684\u65B9\u6CD5</span>
    <span class="token class-name">Throwable</span> thrown <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        task<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        thrown <span class="token operator">=</span> x<span class="token punctuation">;</span>
        <span class="token keyword">throw</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Error</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        thrown <span class="token operator">=</span> x<span class="token punctuation">;</span>
        <span class="token keyword">throw</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        thrown <span class="token operator">=</span> x<span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token function">afterExecute</span><span class="token punctuation">(</span>task<span class="token punctuation">,</span> thrown<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u4EFB\u52A1\u6267\u884C\u5B8C\u6BD5\u4E4B\u540E\u8C03\u7528\u7684\u65B9\u6CD5</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    task <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    w<span class="token punctuation">.</span>completedTasks<span class="token operator">++</span><span class="token punctuation">;</span>
    w<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>beforeExecute\uFF1A\u4EFB\u52A1\u6267\u884C\u4E4B\u524D\u8C03\u7528\u7684\u65B9\u6CD5\uFF0C\u67092\u4E2A\u53C2\u6570\uFF0C\u7B2C1\u4E2A\u53C2\u6570\u662F\u6267\u884C\u4EFB\u52A1\u7684\u7EBF\u7A0B\uFF0C\u7B2C2\u4E2A\u53C2\u6570\u662F\u4EFB\u52A1</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">beforeExecute</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> t<span class="token punctuation">,</span> <span class="token class-name">Runnable</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>afterExecute\uFF1A\u4EFB\u52A1\u6267\u884C\u5B8C\u6210\u4E4B\u540E\u8C03\u7528\u7684\u65B9\u6CD5\uFF0C2\u4E2A\u53C2\u6570\uFF0C\u7B2C1\u4E2A\u53C2\u6570\u8868\u793A\u4EFB\u52A1\uFF0C\u7B2C2\u4E2A\u53C2\u6570\u8868\u793A\u4EFB\u52A1\u6267\u884C\u65F6\u7684\u5F02\u5E38\u4FE1\u606F\uFF0C\u5982\u679C\u65E0\u5F02\u5E38\uFF0C\u7B2C\u4E8C\u4E2A\u53C2\u6570\u4E3Anull</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">afterExecute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>terminated\uFF1A\u7EBF\u7A0B\u6C60\u6700\u7EC8\u5173\u95ED\u4E4B\u540E\u8C03\u7528\u7684\u65B9\u6CD5\u3002\u6240\u6709\u7684\u5DE5\u4F5C\u7EBF\u7A0B\u90FD\u9000\u51FA\u4E86\uFF0C\u6700\u7EC8\u7EBF\u7A0B\u6C60\u4F1A\u9000\u51FA\uFF0C\u9000\u51FA\u65F6\u8C03\u7528\u8BE5\u65B9\u6CD5</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ArrayBlockingQueue</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadPoolExecutor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo6</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Task</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> name<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u5904\u7406&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;Task{&quot;</span> <span class="token operator">+</span>
                    <span class="token string">&quot;name=&#39;&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">&#39;\\&#39;&#39;</span> <span class="token operator">+</span>
                    <span class="token char">&#39;}&#39;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThreadPoolExecutor</span> executor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>
                <span class="token number">10</span><span class="token punctuation">,</span>
                <span class="token number">60L</span><span class="token punctuation">,</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span>r<span class="token punctuation">,</span> executors<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    <span class="token comment">//\u81EA\u5B9A\u4E49\u9971\u548C\u7B56\u7565</span>
                    <span class="token comment">//\u8BB0\u5F55\u4E00\u4E0B\u65E0\u6CD5\u5904\u7406\u7684\u4EFB\u52A1</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u65E0\u6CD5\u5904\u7406\u7684\u4EFB\u52A1\uFF1A&quot;</span> <span class="token operator">+</span> r<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">beforeExecute</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> t<span class="token punctuation">,</span> <span class="token class-name">Runnable</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> t<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u5F00\u59CB\u6267\u884C\u4EFB\u52A1:&quot;</span> <span class="token operator">+</span> r<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">afterExecute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> r<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u4EFB\u52A1:&quot;</span> <span class="token operator">+</span> r<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\uFF0C\u6267\u884C\u5B8C\u6BD5!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">terminated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\uFF0C\u5173\u95ED\u7EBF\u7A0B\u6C60!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            executor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Task</span><span class="token punctuation">(</span><span class="token string">&quot;\u4EFB\u52A1-&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        executor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1564324574847</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\u5F00\u59CB\u6267\u884C\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-0&#39;</span><span class="token punctuation">}</span>
<span class="token number">1564324574850</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span>\u5F00\u59CB\u6267\u884C\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-2&#39;</span><span class="token punctuation">}</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">3</span>\u5904\u7406\u4EFB\u52A1<span class="token operator">-</span><span class="token number">2</span>
<span class="token number">1564324574849</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span>\u5F00\u59CB\u6267\u884C\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-1&#39;</span><span class="token punctuation">}</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">2</span>\u5904\u7406\u4EFB\u52A1<span class="token operator">-</span><span class="token number">1</span>
<span class="token number">1564324574848</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span>\u5F00\u59CB\u6267\u884C\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-4&#39;</span><span class="token punctuation">}</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">5</span>\u5904\u7406\u4EFB\u52A1<span class="token operator">-</span><span class="token number">4</span>
<span class="token number">1564324574848</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span>\u5F00\u59CB\u6267\u884C\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-3&#39;</span><span class="token punctuation">}</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">4</span>\u5904\u7406\u4EFB\u52A1<span class="token operator">-</span><span class="token number">3</span>
<span class="token number">1564324574850</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span>\u5F00\u59CB\u6267\u884C\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-6&#39;</span><span class="token punctuation">}</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">7</span>\u5904\u7406\u4EFB\u52A1<span class="token operator">-</span><span class="token number">6</span>
<span class="token number">1564324574850</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span>\u5F00\u59CB\u6267\u884C\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-5&#39;</span><span class="token punctuation">}</span>
<span class="token number">1564324574851</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">,</span>\u5F00\u59CB\u6267\u884C\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-7&#39;</span><span class="token punctuation">}</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">8</span>\u5904\u7406\u4EFB\u52A1<span class="token operator">-</span><span class="token number">7</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span>\u5904\u7406\u4EFB\u52A1<span class="token operator">-</span><span class="token number">0</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">6</span>\u5904\u7406\u4EFB\u52A1<span class="token operator">-</span><span class="token number">5</span>
<span class="token number">1564324574851</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>\u5F00\u59CB\u6267\u884C\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-9&#39;</span><span class="token punctuation">}</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">10</span>\u5904\u7406\u4EFB\u52A1<span class="token operator">-</span><span class="token number">9</span>
<span class="token number">1564324574852</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">,</span>\u5F00\u59CB\u6267\u884C\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-8&#39;</span><span class="token punctuation">}</span>
pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">9</span>\u5904\u7406\u4EFB\u52A1<span class="token operator">-</span><span class="token number">8</span>
<span class="token number">1564324576851</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-1&#39;</span><span class="token punctuation">}</span>\uFF0C\u6267\u884C\u5B8C\u6BD5<span class="token operator">!</span>
<span class="token number">1564324576851</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-2&#39;</span><span class="token punctuation">}</span>\uFF0C\u6267\u884C\u5B8C\u6BD5<span class="token operator">!</span>
<span class="token number">1564324576852</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-0&#39;</span><span class="token punctuation">}</span>\uFF0C\u6267\u884C\u5B8C\u6BD5<span class="token operator">!</span>
<span class="token number">1564324576852</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-3&#39;</span><span class="token punctuation">}</span>\uFF0C\u6267\u884C\u5B8C\u6BD5<span class="token operator">!</span>
<span class="token number">1564324576852</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-7&#39;</span><span class="token punctuation">}</span>\uFF0C\u6267\u884C\u5B8C\u6BD5<span class="token operator">!</span>
<span class="token number">1564324576852</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-6&#39;</span><span class="token punctuation">}</span>\uFF0C\u6267\u884C\u5B8C\u6BD5<span class="token operator">!</span>
<span class="token number">1564324576852</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-4&#39;</span><span class="token punctuation">}</span>\uFF0C\u6267\u884C\u5B8C\u6BD5<span class="token operator">!</span>
<span class="token number">1564324576853</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-5&#39;</span><span class="token punctuation">}</span>\uFF0C\u6267\u884C\u5B8C\u6BD5<span class="token operator">!</span>
<span class="token number">1564324576853</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-9&#39;</span><span class="token punctuation">}</span>\uFF0C\u6267\u884C\u5B8C\u6BD5<span class="token operator">!</span>
<span class="token number">1564324576853</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token operator">:</span><span class="token class-name">Task</span><span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token char">&#39;\u4EFB\u52A1-8&#39;</span><span class="token punctuation">}</span>\uFF0C\u6267\u884C\u5B8C\u6BD5<span class="token operator">!</span>
<span class="token number">1564324576853</span><span class="token punctuation">,</span>pool<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>thread<span class="token operator">-</span><span class="token number">9</span>\uFF0C\u5173\u95ED\u7EBF\u7A0B\u6C60<span class="token operator">!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE\u8F93\u51FA\u7ED3\u679C\u4E2D\u53EF\u4EE5\u770B\u5230\uFF0C\u6BCF\u4E2A\u9700\u8981\u6267\u884C\u7684\u4EFB\u52A1\u6253\u5370\u4E863\u884C\u65E5\u5FD7\uFF0C\u6267\u884C\u524D\u7531\u7EBF\u7A0B\u6C60\u7684<code>beforeExecute</code>\u6253\u5370\uFF0C\u6267\u884C\u65F6\u4F1A\u8C03\u7528\u4EFB\u52A1\u7684<code>run</code>\u65B9\u6CD5\uFF0C\u4EFB\u52A1\u6267\u884C\u5B8C\u6BD5\u4E4B\u540E\uFF0C\u4F1A\u8C03\u7528\u7EBF\u7A0B\u6C60\u7684<code>afterExecute</code>\u65B9\u6CD5\uFF0C\u4ECE\u6BCF\u4E2A\u4EFB\u52A1\u7684\u9996\u5C3E2\u6761\u65E5\u5FD7\u4E2D\u53EF\u4EE5\u770B\u5230\u6BCF\u4E2A\u4EFB\u52A1\u8017\u65F62\u79D2\u5DE6\u53F3\u3002\u7EBF\u7A0B\u6C60\u6700\u7EC8\u5173\u95ED\u4E4B\u540E\u8C03\u7528\u4E86<code>terminated</code>\u65B9\u6CD5\u3002</p><h2 id="\u4E09\u3001completablefuture" tabindex="-1"><a class="header-anchor" href="#\u4E09\u3001completablefuture" aria-hidden="true">#</a> \u4E09\u3001CompletableFuture</h2><h3 id="_1\u3001future\u548Ccallable\u63A5\u53E3" tabindex="-1"><a class="header-anchor" href="#_1\u3001future\u548Ccallable\u63A5\u53E3" aria-hidden="true">#</a> 1\u3001Future\u548CCallable\u63A5\u53E3</h3><p>Future\u63A5\u53E3\u5B9A\u4E49\u4E86\u64CD\u4F5C\u5F02\u6B65\u4EFB\u52A1\u6267\u884C\u4E00\u4E9B\u65B9\u6CD5\uFF0C\u5982\u83B7\u53D6\u5F02\u6B65\u4EFB\u52A1\u7684\u6267\u884C\u7ED3\u679C\u3001\u53D6\u6D88\u4EFB\u52A1\u7684\u6267\u884C\u3001\u5224\u65AD\u4EFB\u52A1\u662F\u5426\u88AB\u53D6\u6D88\u3001\u5224\u65AD\u4EFB\u52A1\u6267\u884C\u662F\u5426\u5B8C\u6BD5\u7B49\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210904000352470.png" alt="image-20210904000352470"></p><p>Callable\u63A5\u53E3\u4E2D\u5B9A\u4E49\u4E86\u9700\u8981\u6709\u8FD4\u56DE\u7684\u4EFB\u52A1\u9700\u8981\u5B9E\u73B0\u7684\u65B9\u6CD5</p><p>\u6BD4\u5982\u4E3B\u7EBF\u7A0B\u8BA9\u4E00\u4E2A\u5B50\u7EBF\u7A0B\u53BB\u6267\u884C\u4EFB\u52A1\uFF0C\u5B50\u7EBF\u7A0B\u53EF\u80FD\u6BD4\u8F83\u8017\u65F6\uFF0C\u542F\u52A8\u5B50\u7EBF\u7A0B\u5F00\u59CB\u6267\u884C\u4EFB\u52A1\u540E\uFF0C\u4E3B\u7EBF\u7A0B\u5C31\u53BB\u505A\u5176\u4ED6\u4E8B\u60C5\u4E86\uFF0C\u8FC7\u4E86\u4E00\u4F1A\u624D\u53BB\u83B7\u53D6\u5B50\u4EFB\u52A1\u7684\u6267\u884C\u7ED3\u679C\u3002</p><h3 id="_2\u3001\u4ECE\u4E4B\u524D\u7684futuretask\u5F00\u59CB" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u4ECE\u4E4B\u524D\u7684futuretask\u5F00\u59CB" aria-hidden="true">#</a> 2\u3001\u4ECE\u4E4B\u524D\u7684FutureTask\u5F00\u59CB</h3><p>Future\u63A5\u53E3\u76F8\u5173\u67B6\u6784</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210904000518011.png" alt=""></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210904000529226.png" alt="image-20210904000529226"></p><h4 id="code1" tabindex="-1"><a class="header-anchor" href="#code1" aria-hidden="true">#</a> code1</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableFutureDemo</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span><span class="token punctuation">{</span>
        <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> futureTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----come in FutureTask&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//3\u79D2\u949F\u540E\u624D\u51FA\u6765\u7ED3\u679C\uFF0C\u8FD8\u6CA1\u6709\u8BA1\u7B97\u4F60\u63D0\u524D\u6765\u62FF(\u53EA\u8981\u4E00\u8C03\u7528get\u65B9\u6CD5\uFF0C\u5BF9\u4E8E\u7ED3\u679C\u5C31\u662F\u4E0D\u89C1\u4E0D\u6563\uFF0C\u4F1A\u5BFC\u81F4\u963B\u585E)</span>
        <span class="token comment">//System.out.println(Thread.currentThread().getName()+&quot;\\t&quot;+futureTask.get());</span>

        <span class="token comment">//3\u79D2\u949F\u540E\u624D\u51FA\u6765\u7ED3\u679C\uFF0C\u6211\u53EA\u60F3\u7B49\u5F851\u79D2\u949F\uFF0C\u8FC7\u65F6\u4E0D\u5019</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>futureTask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot; run... here&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>get()\u963B\u585E \u4E00\u65E6\u8C03\u7528get()\u65B9\u6CD5\uFF0C\u4E0D\u7BA1\u662F\u5426\u8BA1\u7B97\u5B8C\u6210\u90FD\u4F1A\u5BFC\u81F4\u963B\u585E</li></ul><h4 id="code2" tabindex="-1"><a class="header-anchor" href="#code2" aria-hidden="true">#</a> code2</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableFutureDemo2</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> futureTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----come in FutureTask&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token operator">+</span> <span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;\u7EBF\u7A0B\u5B8C\u6210\u4EFB\u52A1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * \u7528\u4E8E\u963B\u585E\u5F0F\u83B7\u53D6\u7ED3\u679C,\u5982\u679C\u60F3\u8981\u5F02\u6B65\u83B7\u53D6\u7ED3\u679C,\u901A\u5E38\u90FD\u4F1A\u4EE5\u8F6E\u8BE2\u7684\u65B9\u5F0F\u53BB\u83B7\u53D6\u7ED3\u679C
         */</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">.</span><span class="token function">isDone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>futureTask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>isDone()\u8F6E\u8BE2</p><p>\u8F6E\u8BE2\u7684\u65B9\u5F0F\u4F1A\u8017\u8D39\u65E0\u8C13\u7684CPU\u8D44\u6E90\uFF0C\u800C\u4E14\u4E5F\u4E0D\u89C1\u5F97\u80FD\u53CA\u65F6\u5730\u5F97\u5230\u8BA1\u7B97\u7ED3\u679C.</p><p>\u5982\u679C\u60F3\u8981\u5F02\u6B65\u83B7\u53D6\u7ED3\u679C,\u901A\u5E38\u90FD\u4F1A\u4EE5\u8F6E\u8BE2\u7684\u65B9\u5F0F\u53BB\u83B7\u53D6\u7ED3\u679C \u5C3D\u91CF\u4E0D\u8981\u963B\u585E</p><p>\u4E0D\u89C1\u4E0D\u6563 -- \u8FC7\u65F6\u4E0D\u5019 -- \u8F6E\u8BE2</p><h3 id="_3\u3001\u5BF9future\u7684\u6539\u8FDB" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5BF9future\u7684\u6539\u8FDB" aria-hidden="true">#</a> 3\u3001\u5BF9Future\u7684\u6539\u8FDB</h3><h4 id="_1\u3001\u7C7Bcompletablefuture" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u7C7Bcompletablefuture" aria-hidden="true">#</a> 1\u3001\u7C7BCompletableFuture</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210904001054865.png" alt="image-20210904001054865"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210904001102892.png" alt="image-20210904001102892"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210904001143180.png" alt="image-20210904001143180"></p><h4 id="_2\u3001\u63A5\u53E3completionstage" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u63A5\u53E3completionstage" aria-hidden="true">#</a> 2\u3001\u63A5\u53E3CompletionStage</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210904001214909.png" alt="image-20210904001214909"></p><p>\u4EE3\u8868\u5F02\u6B65\u8BA1\u7B97\u8FC7\u7A0B\u4E2D\u7684\u67D0\u4E00\u4E2A\u9636\u6BB5\uFF0C\u4E00\u4E2A\u9636\u6BB5\u5B8C\u6210\u4EE5\u540E\u53EF\u80FD\u4F1A\u89E6\u53D1\u53E6\u5916\u4E00\u4E2A\u9636\u6BB5\uFF0C\u6709\u4E9B\u7C7B\u4F3CLinux\u7CFB\u7EDF\u7684\u7BA1\u9053\u5206\u9694\u7B26\u4F20\u53C2\u6570\u3002</p><h3 id="_4\u3001\u6838\u5FC3\u7684\u56DB\u4E2A\u9759\u6001\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u6838\u5FC3\u7684\u56DB\u4E2A\u9759\u6001\u65B9\u6CD5" aria-hidden="true">#</a> 4\u3001\u6838\u5FC3\u7684\u56DB\u4E2A\u9759\u6001\u65B9\u6CD5</h3><h4 id="_1\u3001runasync-\u65E0-\u8FD4\u56DE\u503C" tabindex="-1"><a class="header-anchor" href="#_1\u3001runasync-\u65E0-\u8FD4\u56DE\u503C" aria-hidden="true">#</a> 1\u3001runAsync \u65E0 \u8FD4\u56DE\u503C</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> runnable<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> runnable<span class="token punctuation">,</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2\u3001supplyasync-\u6709-\u8FD4\u56DE\u503C" tabindex="-1"><a class="header-anchor" href="#_2\u3001supplyasync-\u6709-\u8FD4\u56DE\u503C" aria-hidden="true">#</a> 2\u3001supplyAsync \u6709 \u8FD4\u56DE\u503C</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> supplier<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> supplier<span class="token punctuation">,</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u8FF0Executor executor\u53C2\u6570\u8BF4\u660E</p><p>\u6CA1\u6709\u6307\u5B9AExecutor\u7684\u65B9\u6CD5\uFF0C\u76F4\u63A5\u4F7F\u7528\u9ED8\u8BA4\u7684ForkJoinPool.commonPool() \u4F5C\u4E3A\u5B83\u7684\u7EBF\u7A0B\u6C60\u6267\u884C\u5F02\u6B65\u4EE3\u7801\u3002</p><p>\u5982\u679C\u6307\u5B9A\u7EBF\u7A0B\u6C60\uFF0C\u5219\u4F7F\u7528\u6211\u4EEC\u81EA\u5B9A\u4E49\u7684\u6216\u8005\u7279\u522B\u6307\u5B9A\u7684\u7EBF\u7A0B\u6C60\u6267\u884C\u5F02\u6B65\u4EE3\u7801</p><h4 id="_3\u3001code-\u65E0-\u8FD4\u56DE\u503C" tabindex="-1"><a class="header-anchor" href="#_3\u3001code-\u65E0-\u8FD4\u56DE\u503C" aria-hidden="true">#</a> 3\u3001Code \u65E0 \u8FD4\u56DE\u503C</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableFutureDemo3</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">runAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;-----come in&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----task is over&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>future<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210904001511947.png" alt="image-20210904001511947"></p><h4 id="_4\u3001code-\u6709-\u8FD4\u56DE\u503C" tabindex="-1"><a class="header-anchor" href="#_4\u3001code-\u6709-\u8FD4\u56DE\u503C" aria-hidden="true">#</a> 4\u3001Code \u6709 \u8FD4\u56DE\u503C</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableFutureDemo3</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> completableFuture <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;-----come in&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>completableFuture<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5\u3001code-\u51CF\u5C11\u963B\u585E\u548C\u8F6E\u8BE2" tabindex="-1"><a class="header-anchor" href="#_5\u3001code-\u51CF\u5C11\u963B\u585E\u548C\u8F6E\u8BE2" aria-hidden="true">#</a> 5\u3001Code \u51CF\u5C11\u963B\u585E\u548C\u8F6E\u8BE2</h4><p>\u4ECEJava8\u5F00\u59CB\u5F15\u5165\u4E86CompletableFuture\uFF0C\u5B83\u662FFuture\u7684\u529F\u80FD\u589E\u5F3A\u7248\uFF0C\u53EF\u4EE5\u4F20\u5165\u56DE\u8C03\u5BF9\u8C61\uFF0C\u5F53\u5F02\u6B65\u4EFB\u52A1\u5B8C\u6210\u6216\u8005\u53D1\u751F\u5F02\u5E38\u65F6\uFF0C\u81EA\u52A8\u8C03\u7528\u56DE\u8C03\u5BF9\u8C61\u7684\u56DE\u8C03\u65B9\u6CD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableFutureDemo3</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> completableFuture <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;-----come in&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----\u8BA1\u7B97\u7ED3\u675F\u8017\u65F61\u79D2\u949F\uFF0Cresult\uFF1A &quot;</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token operator">&gt;</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">whenComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span>e<span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>e <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----result: &quot;</span><span class="token operator">+</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exceptionally</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----exception: &quot;</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">44</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u4E3B\u7EBF\u7A0B\u4E0D\u8981\u7ACB\u523B\u7ED3\u675F\uFF0C\u5426\u5219CompletableFuture\u9ED8\u8BA4\u4F7F\u7528\u7684\u7EBF\u7A0B\u6C60\u4F1A\u7ACB\u523B\u5173\u95ED:\u6682\u505C3\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6\u3001completablefuture\u7684\u4F18\u70B9" tabindex="-1"><a class="header-anchor" href="#_6\u3001completablefuture\u7684\u4F18\u70B9" aria-hidden="true">#</a> 6\u3001CompletableFuture\u7684\u4F18\u70B9</h4><p>\u5F02\u6B65\u4EFB\u52A1\u7ED3\u675F\u65F6\uFF0C\u4F1A\u81EA\u52A8\u56DE\u8C03\u67D0\u4E2A\u5BF9\u8C61\u7684\u65B9\u6CD5\uFF1B</p><p>\u5F02\u6B65\u4EFB\u52A1\u51FA\u9519\u65F6\uFF0C\u4F1A\u81EA\u52A8\u56DE\u8C03\u67D0\u4E2A\u5BF9\u8C61\u7684\u65B9\u6CD5\uFF1B</p><p>\u4E3B\u7EBF\u7A0B\u8BBE\u7F6E\u597D\u56DE\u8C03\u540E\uFF0C\u4E0D\u518D\u5173\u5FC3\u5F02\u6B65\u4EFB\u52A1\u7684\u6267\u884C\uFF0C\u5F02\u6B65\u4EFB\u52A1\u4E4B\u95F4\u53EF\u4EE5\u987A\u5E8F\u6267\u884C</p><h3 id="_5\u3001join\u548Cget\u5BF9\u6BD4" tabindex="-1"><a class="header-anchor" href="#_5\u3001join\u548Cget\u5BF9\u6BD4" aria-hidden="true">#</a> 5\u3001join\u548Cget\u5BF9\u6BD4</h3><p>get\u4F1A\u629B\u51FA\u5F02\u5E38\uFF0Cjoin\u4E0D\u9700\u8981</p><h3 id="_6\u3001\u6848\u4F8B\u7CBE\u8BB2-\u4ECE\u7535\u5546\u7F51\u7AD9\u7684\u6BD4\u4EF7\u9700\u6C42\u8BF4\u5F00\u53BB" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u6848\u4F8B\u7CBE\u8BB2-\u4ECE\u7535\u5546\u7F51\u7AD9\u7684\u6BD4\u4EF7\u9700\u6C42\u8BF4\u5F00\u53BB" aria-hidden="true">#</a> 6\u3001\u6848\u4F8B\u7CBE\u8BB2-\u4ECE\u7535\u5546\u7F51\u7AD9\u7684\u6BD4\u4EF7\u9700\u6C42\u8BF4\u5F00\u53BB</h3><p>\u5207\u8BB0\uFF0C\u529F\u80FD\u2192\u6027\u80FD</p><p>\u200B \u7ECF\u5E38\u51FA\u73B0\u5728\u7B49\u5F85\u67D0\u6761 SQL \u6267\u884C\u5B8C\u6210\u540E\uFF0C\u518D\u7EE7\u7EED\u6267\u884C\u4E0B\u4E00\u6761 SQL \uFF0C\u800C\u8FD9\u4E24\u6761 SQL \u672C\u8EAB\u662F\u5E76\u65E0\u5173\u7CFB\u7684\uFF0C\u53EF\u4EE5\u540C\u65F6\u8FDB\u884C\u6267\u884C\u7684\u3002\u6211\u4EEC\u5E0C\u671B\u80FD\u591F\u4E24\u6761 SQL \u540C\u65F6\u8FDB\u884C\u5904\u7406\uFF0C\u800C\u4E0D\u662F\u7B49\u5F85\u5176\u4E2D\u7684\u67D0\u4E00\u6761 SQL \u5B8C\u6210\u540E\uFF0C\u518D\u7EE7\u7EED\u4E0B\u4E00\u6761\u3002\u540C\u7406\uFF0C \u5BF9\u4E8E\u5206\u5E03\u5F0F\u5FAE\u670D\u52A1\u7684\u8C03\u7528\uFF0C\u6309\u7167\u5B9E\u9645\u4E1A\u52A1\uFF0C\u5982\u679C\u662F\u65E0\u5173\u8054step by step\u7684\u4E1A\u52A1\uFF0C\u53EF\u4EE5\u5C1D\u8BD5\u662F\u5426\u53EF\u4EE5\u591A\u7BAD\u9F50\u53D1\uFF0C\u540C\u65F6\u8C03\u7528\u3002\u6211\u4EEC\u53BB\u6BD4\u540C\u4E00\u4E2A\u5546\u54C1\u5728\u5404\u4E2A\u5E73\u53F0\u4E0A\u7684\u4EF7\u683C\uFF0C\u8981\u6C42\u83B7\u5F97\u4E00\u4E2A\u6E05\u5355\u5217\u8868\uFF0C 1 step by step\uFF0C\u67E5\u5B8C\u4EAC\u4E1C\u67E5\u6DD8\u5B9D\uFF0C\u67E5\u5B8C\u6DD8\u5B9D\u67E5\u5929\u732B......</p><p>2 all \u4E00\u53E3\u6C14\u540C\u65F6\u67E5\u8BE2\u3002\u3002\u3002\u3002\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Getter</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CompletableFuture</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadLocalRandom</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Collectors</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">T1</span><span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NetMall</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">NetMall</span><span class="token punctuation">(</span><span class="token string">&quot;jd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">NetMall</span><span class="token punctuation">(</span><span class="token string">&quot;tmall&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">NetMall</span><span class="token punctuation">(</span><span class="token string">&quot;pdd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">NetMall</span><span class="token punctuation">(</span><span class="token string">&quot;mi&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">findPriceSync</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NetMall</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">,</span><span class="token class-name">String</span> productName<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>mall <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>productName<span class="token operator">+</span><span class="token string">&quot; %s price is %.2f&quot;</span><span class="token punctuation">,</span>mall<span class="token punctuation">.</span><span class="token function">getNetMallName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>mall<span class="token punctuation">.</span><span class="token function">getPriceByName</span><span class="token punctuation">(</span>productName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">findPriceASync</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NetMall</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">,</span><span class="token class-name">String</span> productName<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>mall <span class="token operator">-&gt;</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>productName <span class="token operator">+</span> <span class="token string">&quot; %s price is %.2f&quot;</span><span class="token punctuation">,</span> mall<span class="token punctuation">.</span><span class="token function">getNetMallName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mall<span class="token punctuation">.</span><span class="token function">getPriceByName</span><span class="token punctuation">(</span>productName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token operator">::</span><span class="token function">join</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list1 <span class="token operator">=</span> <span class="token function">findPriceSync</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token string">&quot;thinking in java&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> element <span class="token operator">:</span> list1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----costTime: &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">&quot; \u6BEB\u79D2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">long</span> startTime2 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list2 <span class="token operator">=</span> <span class="token function">findPriceASync</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token string">&quot;thinking in java&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> element <span class="token operator">:</span> list2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">long</span> endTime2 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----costTime: &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>endTime2 <span class="token operator">-</span> startTime2<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">&quot; \u6BEB\u79D2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">NetMall</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Getter</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> netMallName<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">NetMall</span><span class="token punctuation">(</span><span class="token class-name">String</span> netMallName<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>netMallName <span class="token operator">=</span> netMallName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getPriceByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> productName<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">calcPrice</span><span class="token punctuation">(</span>productName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">double</span> <span class="token function">calcPrice</span><span class="token punctuation">(</span><span class="token class-name">String</span> productName<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> productName<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7\u3001completablefuture\u5E38\u7528\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_7\u3001completablefuture\u5E38\u7528\u65B9\u6CD5" aria-hidden="true">#</a> 7\u3001CompletableFuture\u5E38\u7528\u65B9\u6CD5</h3><h4 id="_1\u3001\u83B7\u5F97\u7ED3\u679C\u548C\u89E6\u53D1\u8BA1\u7B97" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u83B7\u5F97\u7ED3\u679C\u548C\u89E6\u53D1\u8BA1\u7B97" aria-hidden="true">#</a> 1\u3001\u83B7\u5F97\u7ED3\u679C\u548C\u89E6\u53D1\u8BA1\u7B97</h4><p>\u83B7\u53D6\u7ED3\u679C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u4E0D\u89C1\u4E0D\u6563</span>
<span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
<span class="token comment">// \u8FC7\u65F6\u4E0D\u5019</span>
<span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
    
<span class="token comment">// \u6CA1\u6709\u8BA1\u7B97\u5B8C\u6210\u7684\u60C5\u51B5\u4E0B\uFF0C\u7ED9\u6211\u4E00\u4E2A\u66FF\u4EE3\u7ED3\u679C </span>
<span class="token comment">// \u7ACB\u5373\u83B7\u53D6\u7ED3\u679C\u4E0D\u963B\u585E \u8BA1\u7B97\u5B8C\uFF0C\u8FD4\u56DE\u8BA1\u7B97\u5B8C\u6210\u540E\u7684\u7ED3\u679C  \u6CA1\u7B97\u5B8C\uFF0C\u8FD4\u56DE\u8BBE\u5B9A\u7684valueIfAbsent\u503C</span>
<span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">getNow</span><span class="token punctuation">(</span><span class="token class-name">T</span> valueIfAbsent<span class="token punctuation">)</span>
  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableFutureDemo2</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> completableFuture <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token number">533</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u53BB\u6389\u6CE8\u91CA\u4E0A\u9762\u8BA1\u7B97\u6CA1\u6709\u5B8C\u6210\uFF0C\u8FD4\u56DE444</span>
        <span class="token comment">//\u5F00\u542F\u6CE8\u91CA\u4E0A\u6EE1\u8BA1\u7B97\u5B8C\u6210\uFF0C\u8FD4\u56DE\u8BA1\u7B97\u7ED3\u679C</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>completableFuture<span class="token punctuation">.</span><span class="token function">getNow</span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableFutureDemo2</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> r <span class="token operator">+</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E3B\u52A8\u89E6\u53D1\u8BA1\u7B97</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u662F\u5426\u6253\u65ADget\u65B9\u6CD5\u7ACB\u5373\u8FD4\u56DE\u62EC\u53F7\u503C</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">complete</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span>
  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableFutureDemo4</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> completableFuture <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token number">533</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6CE8\u91CA\u6389\u6682\u505C\u7EBF\u7A0B\uFF0Cget\u8FD8\u6CA1\u6709\u7B97\u5B8C\u53EA\u80FD\u8FD4\u56DEcomplete\u65B9\u6CD5\u8BBE\u7F6E\u7684444\uFF1B\u6682\u505C2\u79D2\u949F\u7EBF\u7A0B\uFF0C\u5F02\u6B65\u7EBF\u7A0B\u80FD\u591F\u8BA1\u7B97\u5B8C\u6210\u8FD4\u56DEget</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">//\u5F53\u8C03\u7528CompletableFuture.get()\u88AB\u963B\u585E\u7684\u65F6\u5019,complete\u65B9\u6CD5\u5C31\u662F\u7ED3\u675F\u963B\u585E\u5E76get()\u83B7\u53D6\u8BBE\u7F6E\u7684complete\u91CC\u9762\u7684\u503C.</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>completableFuture<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token number">444</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>completableFuture<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2\u3001\u5BF9\u8BA1\u7B97\u7ED3\u679C\u8FDB\u884C\u5904\u7406" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5BF9\u8BA1\u7B97\u7ED3\u679C\u8FDB\u884C\u5904\u7406" aria-hidden="true">#</a> 2\u3001\u5BF9\u8BA1\u7B97\u7ED3\u679C\u8FDB\u884C\u5904\u7406</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>thenApply
<span class="token comment">// \u8BA1\u7B97\u7ED3\u679C\u5B58\u5728\u4F9D\u8D56\u5173\u7CFB\uFF0C\u8FD9\u4E24\u4E2A\u7EBF\u7A0B\u4E32\u884C\u5316</span>
<span class="token comment">// \u7531\u4E8E\u5B58\u5728\u4F9D\u8D56\u5173\u7CFB(\u5F53\u524D\u6B65\u9519\uFF0C\u4E0D\u8D70\u4E0B\u4E00\u6B65)\uFF0C\u5F53\u524D\u6B65\u9AA4\u6709\u5F02\u5E38\u7684\u8BDD\u5C31\u53EB\u505C\u3002</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableFutureDemo4</span><span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">{</span>
        <span class="token comment">//\u5F53\u4E00\u4E2A\u7EBF\u7A0B\u4F9D\u8D56\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u65F6\u7528 thenApply \u65B9\u6CD5\u6765\u628A\u8FD9\u4E24\u4E2A\u7EBF\u7A0B\u4E32\u884C\u5316,</span>
        <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">1024</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;222&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> f <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//int age = 10/0; // \u5F02\u5E38\u60C5\u51B5\uFF1A\u90A3\u6B65\u51FA\u9519\u5C31\u505C\u5728\u90A3\u6B65\u3002</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;333&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> f <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">whenCompleteAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span>e<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;*****v: &quot;</span><span class="token operator">+</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exceptionally</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----\u4E3B\u7EBF\u7A0B\u7ED3\u675F\uFF0CEND&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u4E3B\u7EBF\u7A0B\u4E0D\u8981\u7ACB\u523B\u7ED3\u675F\uFF0C\u5426\u5219CompletableFuture\u9ED8\u8BA4\u4F7F\u7528\u7684\u7EBF\u7A0B\u6C60\u4F1A\u7ACB\u523B\u5173\u95ED:</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>   
<span class="token punctuation">}</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>handle
<span class="token comment">// \u6709\u5F02\u5E38\u4E5F\u53EF\u4EE5\u5F80\u4E0B\u4E00\u6B65\u8D70\uFF0C\u6839\u636E\u5E26\u7684\u5F02\u5E38\u53C2\u6570\u53EF\u4EE5\u8FDB\u4E00\u6B65\u5904\u7406</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableFutureDemo4</span><span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">{</span>
        <span class="token comment">//\u5F53\u4E00\u4E2A\u7EBF\u7A0B\u4F9D\u8D56\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u65F6\u7528 handle \u65B9\u6CD5\u6765\u628A\u8FD9\u4E24\u4E2A\u7EBF\u7A0B\u4E32\u884C\u5316,</span>
        <span class="token comment">// \u5F02\u5E38\u60C5\u51B5\uFF1A\u6709\u5F02\u5E38\u4E5F\u53EF\u4EE5\u5F80\u4E0B\u4E00\u6B65\u8D70\uFF0C\u6839\u636E\u5E26\u7684\u5F02\u5E38\u53C2\u6570\u53EF\u4EE5\u8FDB\u4E00\u6B65\u5904\u7406</span>
        <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">1024</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>e<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> age <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;222&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> f <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span>e<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;333&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> f <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">whenCompleteAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span>e<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;*****v: &quot;</span><span class="token operator">+</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exceptionally</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----\u4E3B\u7EBF\u7A0B\u7ED3\u675F\uFF0CEND&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u4E3B\u7EBF\u7A0B\u4E0D\u8981\u7ACB\u523B\u7ED3\u675F\uFF0C\u5426\u5219CompletableFuture\u9ED8\u8BA4\u4F7F\u7528\u7684\u7EBF\u7A0B\u6C60\u4F1A\u7ACB\u523B\u5173\u95ED:</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210904003033912.png" alt="image-20210904003033912"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210904003036925.png" alt="image-20210904003036925"></p><h4 id="_3\u3001\u5BF9\u8BA1\u7B97\u7ED3\u679C\u8FDB\u884C\u6D88\u8D39" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5BF9\u8BA1\u7B97\u7ED3\u679C\u8FDB\u884C\u6D88\u8D39" aria-hidden="true">#</a> 3\u3001\u5BF9\u8BA1\u7B97\u7ED3\u679C\u8FDB\u884C\u6D88\u8D39</h4><p>\u63A5\u6536\u4EFB\u52A1\u7684\u5904\u7406\u7ED3\u679C\uFF0C\u5E76\u6D88\u8D39\u5904\u7406\uFF0C\u65E0\u8FD4\u56DE\u7ED3\u679C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//thenAccept</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">{</span>
    <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> f <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> f <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span>f <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> f <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAccept</span><span class="token punctuation">(</span>r <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Code\u4E4B\u4EFB\u52A1\u4E4B\u95F4\u7684\u987A\u5E8F\u6267\u884C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>thenRun
<span class="token function">thenRun</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> runnable<span class="token punctuation">)</span>
<span class="token comment">// \u4EFB\u52A1 A \u6267\u884C\u5B8C\u6267\u884C B\uFF0C\u5E76\u4E14 B \u4E0D\u9700\u8981 A \u7684\u7ED3\u679C</span>
    
thenAccept
<span class="token function">thenAccept</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span> action<span class="token punctuation">)</span>
<span class="token comment">// \u4EFB\u52A1 A \u6267\u884C\u5B8C\u6267\u884C B\uFF0CB \u9700\u8981 A \u7684\u7ED3\u679C\uFF0C\u4F46\u662F\u4EFB\u52A1 B \u65E0\u8FD4\u56DE\u503C</span>
  
thenApply
<span class="token function">thenApply</span><span class="token punctuation">(</span><span class="token class-name">Function</span> fn<span class="token punctuation">)</span>
<span class="token comment">// \u4EFB\u52A1 A \u6267\u884C\u5B8C\u6267\u884C B\uFF0CB \u9700\u8981 A \u7684\u7ED3\u679C\uFF0C\u540C\u65F6\u4EFB\u52A1 B \u6709\u8FD4\u56DE\u503C</span>
 
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;resultA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenRun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;resultA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenAccept</span><span class="token punctuation">(</span>resultA <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;resultA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenApply</span><span class="token punctuation">(</span>resultA <span class="token operator">-&gt;</span> resultA <span class="token operator">+</span> <span class="token string">&quot; resultB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4\u3001\u5BF9\u8BA1\u7B97\u901F\u5EA6\u8FDB\u884C\u9009\u7528" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u5BF9\u8BA1\u7B97\u901F\u5EA6\u8FDB\u884C\u9009\u7528" aria-hidden="true">#</a> 4\u3001\u5BF9\u8BA1\u7B97\u901F\u5EA6\u8FDB\u884C\u9009\u7528</h4><p>\u8C01\u5FEB\u7528\u8C01</p><p>applyToEither</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableFutureDemo5</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> completableFuture1 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;---come in &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> completableFuture2 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;---come in &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token number">20</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> thenCombineResult <span class="token operator">=</span> completableFuture1<span class="token punctuation">.</span><span class="token function">applyToEither</span><span class="token punctuation">(</span>completableFuture2<span class="token punctuation">,</span>f <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;---come in &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> f <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> thenCombineResult<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5\u3001\u5BF9\u8BA1\u7B97\u7ED3\u679C\u8FDB\u884C\u5408\u5E76" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u5BF9\u8BA1\u7B97\u7ED3\u679C\u8FDB\u884C\u5408\u5E76" aria-hidden="true">#</a> 5\u3001\u5BF9\u8BA1\u7B97\u7ED3\u679C\u8FDB\u884C\u5408\u5E76</h4><p>\u4E24\u4E2ACompletionStage\u4EFB\u52A1\u90FD\u5B8C\u6210\u540E\uFF0C\u6700\u7EC8\u80FD\u628A\u4E24\u4E2A\u4EFB\u52A1\u7684\u7ED3\u679C\u4E00\u8D77\u4EA4\u7ED9thenCombine \u6765\u5904\u7406</p><p>\u5148\u5B8C\u6210\u7684\u5148\u7B49\u7740\uFF0C\u7B49\u5F85\u5176\u5B83\u5206\u652F\u4EFB\u52A1</p><p>thenCombine</p><p>code\u6807\u51C6\u7248\uFF0C\u597D\u7406\u89E3\u5148\u62C6\u5206</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableFutureDemo2</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> completableFuture1 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;---come in &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> completableFuture2 <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;---come in &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">20</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> thenCombineResult <span class="token operator">=</span> completableFuture1<span class="token punctuation">.</span><span class="token function">thenCombine</span><span class="token punctuation">(</span>completableFuture2<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;---come in &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>thenCombineResult<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>code\u8868\u8FBE\u5F0F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CompletableFutureDemo6</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">{</span>
        <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> thenCombineResult <span class="token operator">=</span> <span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;---come in 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenCombine</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;---come in 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">20</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;---come in 3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">thenCombine</span><span class="token punctuation">(</span><span class="token class-name">CompletableFuture</span><span class="token punctuation">.</span><span class="token function">supplyAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;---come in 4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">30</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;---come in 5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----\u4E3B\u7EBF\u7A0B\u7ED3\u675F\uFF0CEND&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>thenCombineResult<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">// \u4E3B\u7EBF\u7A0B\u4E0D\u8981\u7ACB\u523B\u7ED3\u675F\uFF0C\u5426\u5219CompletableFuture\u9ED8\u8BA4\u4F7F\u7528\u7684\u7EBF\u7A0B\u6C60\u4F1A\u7ACB\u523B\u5173\u95ED:</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8\u3001\u5206\u652F\u5408\u5E76\u6846\u67B6" tabindex="-1"><a class="header-anchor" href="#_8\u3001\u5206\u652F\u5408\u5E76\u6846\u67B6" aria-hidden="true">#</a> 8\u3001\u5206\u652F\u5408\u5E76\u6846\u67B6</h3><p>Fork\uFF1A\u628A\u4E00\u4E2A\u590D\u6742\u4EFB\u52A1\u8FDB\u884C\u5206\u62C6\uFF0C\u5927\u4E8B\u5316\u5C0F</p><p>Join\uFF1A\u628A\u5206\u62C6\u4EFB\u52A1\u7684\u7ED3\u679C\u8FDB\u884C\u5408\u5E76</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161705639-4b976bd8-4f72-4667-872a-6f5071b4405e.png" alt="image"></p><h4 id="_1\u3001\u76F8\u5173\u7C7B" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u76F8\u5173\u7C7B" aria-hidden="true">#</a> 1\u3001\u76F8\u5173\u7C7B</h4><h5 id="_1\u3001forkjoinpool" tabindex="-1"><a class="header-anchor" href="#_1\u3001forkjoinpool" aria-hidden="true">#</a> 1\u3001ForkJoinPool</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161713661-c27a4d4c-134a-4f28-be61-65fd50270b3a.png" alt="image"></p><h5 id="_2\u3001forkjointask" tabindex="-1"><a class="header-anchor" href="#_2\u3001forkjointask" aria-hidden="true">#</a> 2\u3001ForkJoinTask</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161726172-14ae279d-84af-4616-9daf-04cb700a151e.png" alt="image"></p><h5 id="_3\u3001recursivetask" tabindex="-1"><a class="header-anchor" href="#_3\u3001recursivetask" aria-hidden="true">#</a> 3\u3001RecursiveTask</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161734753-741e762e-7430-4910-a3c0-5e40803f7850.png" alt="image"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u9012\u5F52\u4EFB\u52A1\uFF1A\u7EE7\u627F\u540E\u53EF\u4EE5\u5B9E\u73B0\u9012\u5F52(\u81EA\u5DF1\u8C03\u81EA\u5DF1)\u8C03\u7528\u7684\u4EFB\u52A1</span>
 <span class="token keyword">class</span> <span class="token class-name">Fibonacci</span> <span class="token keyword">extends</span> <span class="token class-name">RecursiveTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
   <span class="token keyword">final</span> <span class="token keyword">int</span> n<span class="token punctuation">;</span>
   <span class="token class-name">Fibonacci</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>n <span class="token operator">=</span> n<span class="token punctuation">;</span> <span class="token punctuation">}</span>
   <span class="token class-name">Integer</span> <span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span>
       <span class="token keyword">return</span> n<span class="token punctuation">;</span>
     <span class="token class-name">Fibonacci</span> f1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fibonacci</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     f1<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">Fibonacci</span> f2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fibonacci</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> f2<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> f1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2\u3001\u793A\u4F8B" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u793A\u4F8B" aria-hidden="true">#</a> 2\u3001\u793A\u4F8B</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutionException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ForkJoinPool</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ForkJoinTask</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">RecursiveTask</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyTask</span> <span class="token keyword">extends</span> <span class="token class-name">RecursiveTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> ADJUST_VALUE <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> begin<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> end<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> result<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyTask</span><span class="token punctuation">(</span><span class="token keyword">int</span> begin<span class="token punctuation">,</span> <span class="token keyword">int</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>begin <span class="token operator">=</span> begin<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> end<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Integer</span> <span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>end <span class="token operator">-</span> begin<span class="token punctuation">)</span><span class="token operator">&lt;=</span>ADJUST_VALUE<span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span>begin<span class="token punctuation">;</span>i <span class="token operator">&lt;=</span> end<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                result <span class="token operator">=</span> result <span class="token operator">+</span> i<span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">int</span> middle <span class="token operator">=</span> <span class="token punctuation">(</span>begin <span class="token operator">+</span> end<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token class-name">MyTask</span> task01 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyTask</span><span class="token punctuation">(</span>begin<span class="token punctuation">,</span>middle<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">MyTask</span> task02 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyTask</span><span class="token punctuation">(</span>middle<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span>
            task01<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            task02<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            result <span class="token operator">=</span>  task01<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> task02<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token doc-comment comment">/**
 * \u5206\u652F\u5408\u5E76\u4F8B\u5B50
 * ForkJoinPool
 * ForkJoinTask
 * RecursiveTask
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ForkJoinDemo</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ExecutionException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>

        <span class="token class-name">MyTask</span> myTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyTask</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ForkJoinPool</span> forkJoinPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ForkJoinTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> forkJoinTask <span class="token operator">=</span> forkJoinPool<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>myTask<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>forkJoinTask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        forkJoinPool<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u56DB\u3001java-\u9501-\u4E8B" tabindex="-1"><a class="header-anchor" href="#\u56DB\u3001java-\u9501-\u4E8B" aria-hidden="true">#</a> \u56DB\u3001Java\u201C\u9501\u201D\u4E8B</h2><h3 id="_1\u3001lock" tabindex="-1"><a class="header-anchor" href="#_1\u3001lock" aria-hidden="true">#</a> 1\u3001Lock</h3><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161410285-50f57395-d195-4f93-bed4-7b7dffaf078b.png" alt="image"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Lock implementations provide more extensive locking operations than can be obtained using synchronized methods and statements. They allow more flexible structuring, may have quite different properties, and may support multiple associated Condition objects.</span>

<span class="token comment">// \u9501\u5B9E\u73B0\u63D0\u4F9B\u4E86\u6BD4\u4F7F\u7528\u540C\u6B65\u65B9\u6CD5\u548C\u8BED\u53E5\u53EF\u4EE5\u83B7\u5F97\u7684\u66F4\u5E7F\u6CDB\u7684\u9501\u64CD\u4F5C\u3002\u5B83\u4EEC\u5141\u8BB8\u66F4\u7075\u6D3B\u7684\u7ED3\u6784\uFF0C\u53EF\u80FD\u5177\u6709\u975E\u5E38\u4E0D\u540C\u7684\u5C5E\u6027\uFF0C\u5E76\u4E14\u53EF\u80FD\u652F\u6301\u591A\u4E2A\u5173\u8054\u7684\u6761\u4EF6\u5BF9\u8C61</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2\u3001synchronized\u4E0Elock\u7684\u533A\u522B" tabindex="-1"><a class="header-anchor" href="#_2\u3001synchronized\u4E0Elock\u7684\u533A\u522B" aria-hidden="true">#</a> 2\u3001synchronized\u4E0ELock\u7684\u533A\u522B</h3><ol><li>\u9996\u5148synchronized\u662Fjava\u5185\u7F6E\u5173\u952E\u5B57\uFF0C\u5728jvm\u5C42\u9762\uFF0CLock\u662F\u4E2Ajava\u7C7B\uFF1B</li><li>synchronized\u65E0\u6CD5\u5224\u65AD\u662F\u5426\u83B7\u53D6\u9501\u7684\u72B6\u6001\uFF0CLock\u53EF\u4EE5\u5224\u65AD\u662F\u5426\u83B7\u53D6\u5230\u9501\uFF1B</li><li>synchronized\u4F1A\u81EA\u52A8\u91CA\u653E\u9501(a \u7EBF\u7A0B\u6267\u884C\u5B8C\u540C\u6B65\u4EE3\u7801\u4F1A\u91CA\u653E\u9501 \uFF1Bb \u7EBF\u7A0B\u6267\u884C\u8FC7\u7A0B\u4E2D\u53D1\u751F\u5F02\u5E38\u4F1A\u91CA\u653E\u9501)\uFF0CLock\u9700\u5728finally\u4E2D\u624B\u5DE5\u91CA\u653E\u9501\uFF08unlock()\u65B9\u6CD5\u91CA\u653E\u9501\uFF09\uFF0C\u5426\u5219\u5BB9\u6613\u9020\u6210\u7EBF\u7A0B\u6B7B\u9501\uFF1B</li><li>\u7528synchronized\u5173\u952E\u5B57\u7684\u4E24\u4E2A\u7EBF\u7A0B1\u548C\u7EBF\u7A0B2\uFF0C\u5982\u679C\u5F53\u524D\u7EBF\u7A0B1\u83B7\u5F97\u9501\uFF0C\u7EBF\u7A0B2\u7EBF\u7A0B\u7B49\u5F85\u3002\u5982\u679C\u7EBF\u7A0B1\u963B\u585E\uFF0C\u7EBF\u7A0B2\u5219\u4F1A\u4E00\u76F4\u7B49\u5F85\u4E0B\u53BB\uFF0C\u800CLock\u9501\u5C31\u4E0D\u4E00\u5B9A\u4F1A\u7B49\u5F85\u4E0B\u53BB\uFF0C\u5982\u679C\u5C1D\u8BD5\u83B7\u53D6\u4E0D\u5230\u9501\uFF0C\u7EBF\u7A0B\u53EF\u4EE5\u4E0D\u7528\u4E00\u76F4\u7B49\u5F85\u5C31\u7ED3\u675F\u4E86\uFF1B</li><li>synchronized\u7684\u9501\u53EF\u91CD\u5165\u3001\u4E0D\u53EF\u4E2D\u65AD\u3001\u975E\u516C\u5E73\uFF0C\u800CLock\u9501\u53EF\u91CD\u5165\u3001\u53EF\u5224\u65AD\u3001\u53EF\u516C\u5E73\uFF08\u4E24\u8005\u7686\u53EF\uFF09</li><li>Lock\u9501\u9002\u5408\u5927\u91CF\u540C\u6B65\u7684\u4EE3\u7801\u7684\u540C\u6B65\u95EE\u9898\uFF0Csynchronized\u9501\u9002\u5408\u4EE3\u7801\u5C11\u91CF\u7684\u540C\u6B65\u95EE\u9898\u3002</li></ol><h3 id="_3\u3001synchronized" tabindex="-1"><a class="header-anchor" href="#_3\u3001synchronized" aria-hidden="true">#</a> 3\u3001synchronized</h3><ol><li>\u4FEE\u9970\u5B9E\u4F8B\u65B9\u6CD5\uFF0C\u4F5C\u7528\u4E8E\u5F53\u524D\u5B9E\u4F8B\uFF0C\u8FDB\u5165\u540C\u6B65\u4EE3\u7801\u524D\u9700\u8981\u5148\u83B7\u53D6\u5B9E\u4F8B\u7684\u9501</li><li>\u4FEE\u9970\u9759\u6001\u65B9\u6CD5\uFF0C\u4F5C\u7528\u4E8E\u7C7B\u7684Class\u5BF9\u8C61\uFF0C\u8FDB\u5165\u4FEE\u9970\u7684\u9759\u6001\u65B9\u6CD5\u524D\u9700\u8981\u5148\u83B7\u53D6\u7C7B\u7684Class\u5BF9\u8C61\u7684\u9501</li><li>\u4FEE\u9970\u4EE3\u7801\u5757\uFF0C\u9700\u8981\u6307\u5B9A\u52A0\u9501\u5BF9\u8C61(\u8BB0\u505Alockobj)\uFF0C\u5728\u8FDB\u5165\u540C\u6B65\u4EE3\u7801\u5757\u524D\u9700\u8981\u5148\u83B7\u53D6lockobj\u7684\u9501</li></ol><h4 id="_1\u3001synchronized\u4F5C\u7528\u4E8E\u5B9E\u4F8B\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_1\u3001synchronized\u4F5C\u7528\u4E8E\u5B9E\u4F8B\u5BF9\u8C61" aria-hidden="true">#</a> 1\u3001synchronized\u4F5C\u7528\u4E8E\u5B9E\u4F8B\u5BF9\u8C61</h4><p>\u6240\u8C13\u5B9E\u4F8B\u5BF9\u8C61\u9501\u5C31\u662F\u7528synchronized\u4FEE\u9970\u5B9E\u4F8B\u5BF9\u8C61\u7684\u5B9E\u4F8B\u65B9\u6CD5\uFF0C\u6CE8\u610F\u662F<strong>\u5B9E\u4F8B\u65B9\u6CD5</strong>\uFF0C\u4E0D\u662F<strong>\u9759\u6001\u65B9\u6CD5</strong>\uFF0C\u5982\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo2</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        num<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">Demo2</span> demo2<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span> demo2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>demo2 <span class="token operator">=</span> demo2<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>demo2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Demo2</span> demo2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Demo2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span>demo2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span>demo2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>demo2<span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>main()\u65B9\u6CD5\u4E2D\u521B\u5EFA\u4E86\u4E00\u4E2A\u5BF9\u8C61demo2\u548C2\u4E2A\u7EBF\u7A0Bt1\u3001t2\uFF0Ct1\u3001t2\u4E2D\u8C03\u7528demo2\u7684add()\u65B9\u6CD510000\u6B21\uFF0Cadd()\u65B9\u6CD5\u4E2D\u6267\u884C\u4E86num++\uFF0Cnum++\u5B9E\u9645\u4E0A\u662F\u52063\u6B65\uFF0C\u83B7\u53D6num\uFF0C\u7136\u540E\u5C06num+1\uFF0C\u7136\u540E\u5C06\u7ED3\u679C\u8D4B\u503C\u7ED9num\uFF0C\u5982\u679Ct2\u5728t1\u8BFB\u53D6num\u548Cnum+1\u4E4B\u95F4\u83B7\u53D6\u4E86num\u7684\u503C\uFF0C\u90A3\u4E48t1\u548Ct2\u4F1A\u8BFB\u53D6\u5230\u540C\u6837\u7684\u503C\uFF0C\u7136\u540E\u6267\u884Cnum++\uFF0C\u4E24\u6B21\u64CD\u4F5C\u4E4B\u540Enum\u662F\u76F8\u540C\u7684\u503C\uFF0C\u6700\u7EC8\u548C\u671F\u671B\u7684\u7ED3\u679C\u4E0D\u4E00\u81F4\uFF0C\u9020\u6210\u4E86\u7EBF\u7A0B\u5B89\u5168\u5931\u8D25\uFF0C\u56E0\u6B64\u6211\u4EEC\u5BF9add\u65B9\u6CD5\u52A0\u4E86synchronized\u6765\u4FDD\u8BC1\u7EBF\u7A0B\u5B89\u5168\u3002</p><p>\u6CE8\u610F\uFF1Am1()\u65B9\u6CD5\u662F\u5B9E\u4F8B\u65B9\u6CD5\uFF0C\u4E24\u4E2A\u7EBF\u7A0B\u64CD\u4F5Cm1()\u65F6\uFF0C\u9700\u8981\u5148\u83B7\u53D6demo2\u7684\u9501\uFF0C\u6CA1\u6709\u83B7\u53D6\u5230\u9501\u7684\uFF0C\u5C06\u7B49\u5F85\uFF0C\u76F4\u5230\u5176\u4ED6\u7EBF\u7A0B\u91CA\u653E\u9501\u4E3A\u6B62\u3002</p><p>synchronize\u4F5C\u7528\u4E8E\u5B9E\u4F8B\u65B9\u6CD5\u9700\u8981\u6CE8\u610F\uFF1A</p><ol><li>\u5B9E\u4F8B\u65B9\u6CD5\u4E0A\u52A0synchronized\uFF0C\u7EBF\u7A0B\u5B89\u5168\u7684\u524D\u63D0\u662F\uFF0C\u591A\u4E2A\u7EBF\u7A0B\u64CD\u4F5C\u7684\u662F<strong>\u540C\u4E00\u4E2A\u5B9E\u4F8B</strong>\uFF0C\u5982\u679C\u591A\u4E2A\u7EBF\u7A0B\u4F5C\u7528\u4E8E\u4E0D\u540C\u7684\u5B9E\u4F8B\uFF0C\u90A3\u4E48\u7EBF\u7A0B\u5B89\u5168\u662F\u65E0\u6CD5\u4FDD\u8BC1\u7684</li><li>\u540C\u4E00\u4E2A\u5B9E\u4F8B\u7684\u591A\u4E2A\u5B9E\u4F8B\u65B9\u6CD5\u4E0A\u6709synchronized\uFF0C\u8FD9\u4E9B\u65B9\u6CD5\u90FD\u662F\u4E92\u65A5\u7684\uFF0C\u540C\u4E00\u65F6\u95F4\u53EA\u5141\u8BB8\u4E00\u4E2A\u7EBF\u7A0B\u64CD\u4F5C<strong>\u540C\u4E00\u4E2A\u5B9E\u4F8B\u7684\u5176\u4E2D\u7684\u4E00\u4E2Asynchronized\u65B9\u6CD5</strong></li></ol><h4 id="_2\u3001synchronized\u4F5C\u7528\u4E8E\u9759\u6001\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_2\u3001synchronized\u4F5C\u7528\u4E8E\u9759\u6001\u65B9\u6CD5" aria-hidden="true">#</a> 2\u3001synchronized\u4F5C\u7528\u4E8E\u9759\u6001\u65B9\u6CD5</h4><p>\u5F53synchronized\u4F5C\u7528\u4E8E\u9759\u6001\u65B9\u6CD5\u65F6\uFF0C\u9501\u7684\u5BF9\u8C61\u5C31\u662F\u5F53\u524D\u7C7B\u7684Class\u5BF9\u8C61\u3002\u5982\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo3</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            num<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T1</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Demo3</span><span class="token punctuation">.</span><span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T1</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T1</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T1</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u7B49\u5F853\u4E2A\u7EBF\u7A0B\u7ED3\u675F\u6253\u5370num</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * \u6253\u5370\u7ED3\u679C\uFF1A
         * 30000
         */</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u4EE3\u7801\u6253\u537030000\uFF0C\u548C\u671F\u671B\u7ED3\u679C\u4E00\u81F4\u3002m1()\u65B9\u6CD5\u662F\u9759\u6001\u65B9\u6CD5\uFF0C\u6709synchronized\u4FEE\u9970\uFF0C\u9501\u7528\u4E8E\u4E0EDemo3.class\u5BF9\u8C61\uFF0C\u548C\u4E0B\u9762\u7684\u5199\u6CD5\u7C7B\u4F3C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            num<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3\u3001synchronized\u540C\u6B65\u4EE3\u7801\u5757" tabindex="-1"><a class="header-anchor" href="#_3\u3001synchronized\u540C\u6B65\u4EE3\u7801\u5757" aria-hidden="true">#</a> 3\u3001synchronized\u540C\u6B65\u4EE3\u7801\u5757</h4><p>\u9664\u4E86\u4F7F\u7528\u5173\u952E\u5B57\u4FEE\u9970\u5B9E\u4F8B\u65B9\u6CD5\u548C\u9759\u6001\u65B9\u6CD5\u5916\uFF0C\u8FD8\u53EF\u4EE5\u4F7F\u7528\u540C\u6B65\u4EE3\u7801\u5757\uFF0C\u5728\u67D0\u4E9B\u60C5\u51B5\u4E0B\uFF0C\u6211\u4EEC\u7F16\u5199\u7684\u65B9\u6CD5\u4F53\u53EF\u80FD\u6BD4\u8F83\u5927\uFF0C\u540C\u65F6\u5B58\u5728\u4E00\u4E9B\u6BD4\u8F83\u8017\u65F6\u7684\u64CD\u4F5C\uFF0C\u800C\u9700\u8981\u540C\u6B65\u7684\u4EE3\u7801\u53C8\u53EA\u6709\u4E00\u5C0F\u90E8\u5206\uFF0C\u5982\u679C\u76F4\u63A5\u5BF9\u6574\u4E2A\u65B9\u6CD5\u8FDB\u884C\u540C\u6B65\u64CD\u4F5C\uFF0C\u53EF\u80FD\u4F1A\u5F97\u4E0D\u507F\u5931\uFF0C\u6B64\u65F6\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528\u540C\u6B65\u4EE3\u7801\u5757\u7684\u65B9\u5F0F\u5BF9\u9700\u8981\u540C\u6B65\u7684\u4EE3\u7801\u8FDB\u884C\u5305\u88F9\uFF0C\u8FD9\u6837\u5C31\u65E0\u9700\u5BF9\u6574\u4E2A\u65B9\u6CD5\u8FDB\u884C\u540C\u6B65\u64CD\u4F5C\u4E86\uFF0C\u540C\u6B65\u4EE3\u7801\u5757\u7684\u4F7F\u7528\u793A\u4F8B\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo5</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Demo5</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Demo5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u7701\u7565\u5176\u4ED6\u8017\u65F6\u64CD\u4F5C....</span>
        <span class="token comment">//\u4F7F\u7528\u540C\u6B65\u4EE3\u7801\u5757\u5BF9\u53D8\u91CFi\u8FDB\u884C\u540C\u6B65\u64CD\u4F5C,\u9501\u5BF9\u8C61\u4E3Ainstance</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                i<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE\u4EE3\u7801\u770B\u51FA\uFF0C\u5C06synchronized\u4F5C\u7528\u4E8E\u4E00\u4E2A\u7ED9\u5B9A\u7684\u5B9E\u4F8B\u5BF9\u8C61instance\uFF0C\u5373\u5F53\u524D\u5B9E\u4F8B\u5BF9\u8C61\u5C31\u662F\u9501\u5BF9\u8C61\uFF0C\u6BCF\u6B21\u5F53\u7EBF\u7A0B\u8FDB\u5165synchronized\u5305\u88F9\u7684\u4EE3\u7801\u5757\u65F6\u5C31\u4F1A\u8981\u6C42\u5F53\u524D\u7EBF\u7A0B\u6301\u6709instance\u5B9E\u4F8B\u5BF9\u8C61\u9501\uFF0C\u5982\u679C\u5F53\u524D\u6709\u5176\u4ED6\u7EBF\u7A0B\u6B63\u6301\u6709\u8BE5\u5BF9\u8C61\u9501\uFF0C\u90A3\u4E48\u65B0\u5230\u7684\u7EBF\u7A0B\u5C31\u5FC5\u987B\u7B49\u5F85\uFF0C\u8FD9\u6837\u4E5F\u5C31\u4FDD\u8BC1\u4E86\u6BCF\u6B21\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B\u6267\u884Ci++;\u64CD\u4F5C\u3002\u5F53\u7136\u9664\u4E86instance\u4F5C\u4E3A\u5BF9\u8C61\u5916\uFF0C\u6211\u4EEC\u8FD8\u53EF\u4EE5\u4F7F\u7528this\u5BF9\u8C61(\u4EE3\u8868\u5F53\u524D\u5B9E\u4F8B)\u6216\u8005\u5F53\u524D\u7C7B\u7684class\u5BF9\u8C61\u4F5C\u4E3A\u9501\uFF0C\u5982\u4E0B\u4EE3\u7801\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//this,\u5F53\u524D\u5B9E\u4F8B\u5BF9\u8C61\u9501</span>
<span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">1000000</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//class\u5BF9\u8C61\u9501</span>
<span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">1000000</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5206\u6790\u4EE3\u7801\u662F\u5426\u4E92\u65A5\u7684\u65B9\u6CD5\uFF0C\u5148\u627E\u51FAsynchronized\u4F5C\u7528\u7684\u5BF9\u8C61\u662F\u8C01\uFF0C\u5982\u679C\u591A\u4E2A\u7EBF\u7A0B\u64CD\u4F5C\u7684\u65B9\u6CD5\u4E2Dsynchronized\u4F5C\u7528\u7684\u9501\u5BF9\u8C61\u4E00\u6837\uFF0C\u90A3\u4E48\u8FD9\u4E9B\u7EBF\u7A0B\u540C\u65F6\u5F02\u6B65\u6267\u884C\u8FD9\u4E9B\u65B9\u6CD5\u5C31\u662F\u4E92\u65A5\u7684\u3002\u5982\u4E0B\u4EE3\u7801:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo6</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u4F5C\u7528\u4E8E\u5F53\u524D\u7C7B\u7684\u5B9E\u4F8B\u5BF9\u8C61</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u4F5C\u7528\u4E8E\u5F53\u524D\u7C7B\u7684\u5B9E\u4F8B\u5BF9\u8C61</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">m2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u4F5C\u7528\u4E8E\u5F53\u524D\u7C7B\u7684\u5B9E\u4F8B\u5BF9\u8C61</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">m3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u4F5C\u7528\u4E8E\u5F53\u524D\u7C7BClass\u5BF9\u8C61</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">m4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u4F5C\u7528\u4E8E\u5F53\u524D\u7C7BClass\u5BF9\u8C61</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">m5</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{</span>
        <span class="token class-name">Demo6</span> demo6<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span> demo6<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>demo6 <span class="token operator">=</span> demo6<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Demo6</span> d1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Demo6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            d1<span class="token punctuation">.</span><span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            d1<span class="token punctuation">.</span><span class="token function">m2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            d1<span class="token punctuation">.</span><span class="token function">m2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Demo6</span> d2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Demo6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            d2<span class="token punctuation">.</span><span class="token function">m2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t4<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">Demo6</span><span class="token punctuation">.</span><span class="token function">m4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t5<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t6 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">Demo6</span><span class="token punctuation">.</span><span class="token function">m5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t6<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5206\u6790\u4E0A\u9762\u4EE3\u7801\uFF1A</p><ol><li>\u7EBF\u7A0Bt1\u3001t2\u3001t3\u4E2D\u8C03\u7528\u7684\u65B9\u6CD5\u90FD\u9700\u8981\u83B7\u53D6d1\u7684\u9501\uFF0C\u6240\u4EE5\u4ED6\u4EEC\u662F\u4E92\u65A5\u7684</li><li>t1/t2/t3\u8FD93\u4E2A\u7EBF\u7A0B\u548Ct4\u4E0D\u4E92\u65A5\uFF0C\u4ED6\u4EEC\u53EF\u4EE5\u540C\u65F6\u8FD0\u884C\uFF0C\u56E0\u4E3A\u524D\u9762\u4E09\u4E2A\u7EBF\u7A0B\u4F9D\u8D56\u4E8Ed1\u7684\u9501\uFF0Ct4\u4F9D\u8D56\u4E8Ed2\u7684\u9501</li><li>t5\u3001t6\u90FD\u4F5C\u7528\u4E8E\u5F53\u524D\u7C7B\u7684Class\u5BF9\u8C61\u9501\uFF0C\u6240\u4EE5\u8FD9\u4E24\u4E2A\u7EBF\u7A0B\u662F\u4E92\u65A5\u7684\uFF0C\u548C\u5176\u4ED6\u51E0\u4E2A\u7EBF\u7A0B\u4E0D\u4E92\u65A5</li></ol><h3 id="_4\u3001reentrantlock" tabindex="-1"><a class="header-anchor" href="#_4\u3001reentrantlock" aria-hidden="true">#</a> 4\u3001ReentrantLock</h3><p>ReentrantLock\u662FLock\u7684\u9ED8\u8BA4\u5B9E\u73B0\uFF0C\u5728\u804AReentranLock\u4E4B\u524D\uFF0C\u6211\u4EEC\u9700\u8981\u5148\u5F04\u6E05\u695A\u4E00\u4E9B\u6982\u5FF5\uFF1A</p><ol><li>\u53EF\u91CD\u5165\u9501\uFF1A\u53EF\u91CD\u5165\u9501\u662F\u6307\u540C\u4E00\u4E2A\u7EBF\u7A0B\u53EF\u4EE5\u591A\u6B21\u83B7\u5F97\u540C\u4E00\u628A\u9501\uFF1BReentrantLock\u548C\u5173\u952E\u5B57Synchronized\u90FD\u662F\u53EF\u91CD\u5165\u9501</li><li>\u53EF\u4E2D\u65AD\u9501\uFF1A\u53EF\u4E2D\u65AD\u9501\u65F6\u5B50\u7EBF\u7A0B\u5728\u83B7\u53D6\u9501\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u662F\u5426\u53EF\u4EE5\u76F8\u5E94\u7EBF\u7A0B\u4E2D\u65AD\u64CD\u4F5C\u3002synchronized\u662F\u4E0D\u53EF\u4E2D\u65AD\u7684\uFF0CReentrantLock\u662F\u53EF\u4E2D\u65AD\u7684</li><li>\u516C\u5E73\u9501\u548C\u975E\u516C\u5E73\u9501\uFF1A\u516C\u5E73\u9501\u662F\u6307\u591A\u4E2A\u7EBF\u7A0B\u5C1D\u8BD5\u83B7\u53D6\u540C\u4E00\u628A\u9501\u7684\u65F6\u5019\uFF0C\u83B7\u53D6\u9501\u7684\u987A\u5E8F\u6309\u7167\u7EBF\u7A0B\u5230\u8FBE\u7684\u5148\u540E\u987A\u5E8F\u83B7\u53D6\uFF0C\u800C\u4E0D\u662F\u968F\u673A\u63D2\u961F\u7684\u65B9\u5F0F\u83B7\u53D6\u3002synchronized\u662F\u975E\u516C\u5E73\u9501\uFF0C\u800CReentrantLock\u662F\u4E24\u79CD\u90FD\u53EF\u4EE5\u5B9E\u73B0\uFF0C\u4E0D\u8FC7\u9ED8\u8BA4\u662F\u975E\u516C\u5E73\u9501</li></ol><h4 id="_1\u3001synchronized\u7684\u5C40\u9650\u6027" tabindex="-1"><a class="header-anchor" href="#_1\u3001synchronized\u7684\u5C40\u9650\u6027" aria-hidden="true">#</a> 1\u3001synchronized\u7684\u5C40\u9650\u6027</h4><p>synchronized\u662Fjava\u5185\u7F6E\u7684\u5173\u952E\u5B57\uFF0C\u5B83\u63D0\u4F9B\u4E86\u4E00\u79CD\u72EC\u5360\u7684\u52A0\u9501\u65B9\u5F0F\u3002synchronized\u7684\u83B7\u53D6\u548C\u91CA\u653E\u9501\u7531jvm\u5B9E\u73B0\uFF0C\u7528\u6237\u4E0D\u9700\u8981\u663E\u793A\u7684\u91CA\u653E\u9501\uFF0C\u975E\u5E38\u65B9\u4FBF\uFF0C\u7136\u800Csynchronized\u4E5F\u6709\u4E00\u5B9A\u7684\u5C40\u9650\u6027\uFF0C\u4F8B\u5982\uFF1A</p><ol><li>\u5F53\u7EBF\u7A0B\u5C1D\u8BD5\u83B7\u53D6\u9501\u7684\u65F6\u5019\uFF0C\u5982\u679C\u83B7\u53D6\u4E0D\u5230\u9501\u4F1A\u4E00\u76F4\u963B\u585E\uFF0C\u8FD9\u4E2A\u963B\u585E\u7684\u8FC7\u7A0B\uFF0C\u7528\u6237\u65E0\u6CD5\u63A7\u5236</li><li>\u5982\u679C\u83B7\u53D6\u9501\u7684\u7EBF\u7A0B\u8FDB\u5165\u4F11\u7720\u6216\u8005\u963B\u585E\uFF0C\u9664\u975E\u5F53\u524D\u7EBF\u7A0B\u5F02\u5E38\uFF0C\u5426\u5219\u5176\u4ED6\u7EBF\u7A0B\u5C1D\u8BD5\u83B7\u53D6\u9501\u5FC5\u987B\u4E00\u76F4\u7B49\u5F85</li></ol><p>JDK1.5\u4E4B\u540E\u53D1\u5E03\uFF0C\u52A0\u5165\u4E86Doug Lea\u5B9E\u73B0\u7684java.util.concurrent\u5305\u3002\u5305\u5185\u63D0\u4F9B\u4E86Lock\u7C7B\uFF0C\u7528\u6765\u63D0\u4F9B\u66F4\u591A\u6269\u5C55\u7684\u52A0\u9501\u529F\u80FD\u3002Lock\u5F25\u8865\u4E86synchronized\u7684\u5C40\u9650\uFF0C\u63D0\u4F9B\u4E86\u66F4\u52A0\u7EC6\u7C92\u5EA6\u7684\u52A0\u9501\u529F\u80FD\u3002</p><h4 id="_2\u3001reentrantlock\u57FA\u672C\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#_2\u3001reentrantlock\u57FA\u672C\u4F7F\u7528" aria-hidden="true">#</a> 2\u3001ReentrantLock\u57FA\u672C\u4F7F\u7528</h4><p>\u6211\u4EEC\u4F7F\u75283\u4E2A\u7EBF\u7A0B\u6765\u5BF9\u4E00\u4E2A\u5171\u4EAB\u53D8\u91CF++\u64CD\u4F5C\uFF0C\u5148\u4F7F\u7528<strong>synchronized</strong>\u5B9E\u73B0\uFF0C\u7136\u540E\u4F7F\u7528<strong>ReentrantLock</strong>\u5B9E\u73B0\u3002</p><p><strong>synchronized\u65B9\u5F0F</strong>\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo2</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        num<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Demo2</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ReentrantLock\u65B9\u5F0F</strong>\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo3</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            num<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Demo3</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ReentrantLock\u7684\u4F7F\u7528\u8FC7\u7A0B\uFF1A</strong></p><ol><li><strong>\u521B\u5EFA\u9501\uFF1AReentrantLock lock = new ReentrantLock();</strong></li><li><strong>\u83B7\u53D6\u9501\uFF1Alock.lock()</strong></li><li><strong>\u91CA\u653E\u9501\uFF1Alock.unlock();</strong></li></ol><p>\u5BF9\u6BD4\u4E0A\u9762\u7684\u4EE3\u7801\uFF0C\u4E0E\u5173\u952E\u5B57synchronized\u76F8\u6BD4\uFF0CReentrantLock\u9501\u6709\u660E\u663E\u7684\u64CD\u4F5C\u8FC7\u7A0B\uFF0C\u5F00\u53D1\u4EBA\u5458\u5FC5\u987B\u624B\u52A8\u7684\u6307\u5B9A\u4F55\u65F6\u52A0\u9501\uFF0C\u4F55\u65F6\u91CA\u653E\u9501\uFF0C\u6B63\u662F\u56E0\u4E3A\u8FD9\u6837\u624B\u52A8\u63A7\u5236\uFF0CReentrantLock\u5BF9\u903B\u8F91\u63A7\u5236\u7684\u7075\u6D3B\u5EA6\u8981\u8FDC\u8FDC\u80DC\u4E8E\u5173\u952E\u5B57synchronized\uFF0C\u4E0A\u9762\u4EE3\u7801\u9700\u8981\u6CE8\u610F**lock.unlock()**\u4E00\u5B9A\u8981\u653E\u5728finally\u4E2D\uFF0C\u5426\u5219\uFF0C\u82E5\u7A0B\u5E8F\u51FA\u73B0\u4E86\u5F02\u5E38\uFF0C\u9501\u6CA1\u6709\u91CA\u653E\uFF0C\u90A3\u4E48\u5176\u4ED6\u7EBF\u7A0B\u5C31\u518D\u4E5F\u6CA1\u6709\u673A\u4F1A\u83B7\u53D6\u8FD9\u4E2A\u9501\u4E86\u3002</p><h4 id="_3\u3001reentrantlock\u83B7\u53D6\u9501\u7684\u8FC7\u7A0B\u662F\u53EF\u4E2D\u65AD\u7684" tabindex="-1"><a class="header-anchor" href="#_3\u3001reentrantlock\u83B7\u53D6\u9501\u7684\u8FC7\u7A0B\u662F\u53EF\u4E2D\u65AD\u7684" aria-hidden="true">#</a> 3\u3001ReentrantLock\u83B7\u53D6\u9501\u7684\u8FC7\u7A0B\u662F\u53EF\u4E2D\u65AD\u7684</h4><p>\u5BF9\u4E8Esynchronized\u5173\u952E\u5B57\uFF0C\u5982\u679C\u4E00\u4E2A\u7EBF\u7A0B\u5728\u7B49\u5F85\u83B7\u53D6\u9501\uFF0C\u6700\u7EC8\u53EA\u67092\u79CD\u7ED3\u679C\uFF1A</p><ol><li>\u8981\u4E48\u83B7\u53D6\u5230\u9501\u7136\u540E\u7EE7\u7EED\u540E\u9762\u7684\u64CD\u4F5C</li><li>\u8981\u4E48\u4E00\u76F4\u7B49\u5F85\uFF0C\u76F4\u5230\u5176\u4ED6\u7EBF\u7A0B\u91CA\u653E\u9501\u4E3A\u6B62</li></ol><p>\u800CReentrantLock\u63D0\u4F9B\u4E86\u53E6\u5916\u4E00\u79CD\u53EF\u80FD\uFF0C\u5C31\u662F\u5728\u7B49\u5F85\u83B7\u53D6\u9501\u7684\u8FC7\u7A0B\u4E2D\uFF08<strong>\u53D1\u8D77\u83B7\u53D6\u9501\u8BF7\u6C42\u5230\u8FD8\u672A\u83B7\u53D6\u5230\u9501\u8FD9\u6BB5\u65F6\u95F4\u5185</strong>\uFF09\u662F\u53EF\u4EE5\u88AB\u4E2D\u65AD\u7684\uFF0C\u4E5F\u5C31\u662F\u8BF4\u5728\u7B49\u5F85\u9501\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u7A0B\u5E8F\u53EF\u4EE5\u6839\u636E\u9700\u8981\u53D6\u6D88\u83B7\u53D6\u9501\u7684\u8BF7\u6C42\u3002\u6709\u4E9B\u4F7F\u7528\u8FD9\u4E2A\u64CD\u4F5C\u662F\u975E\u5E38\u6709\u5FC5\u8981\u7684\u3002\u6BD4\u5982\uFF1A\u4F60\u548C\u597D\u670B\u53CB\u8D8A\u597D\u4E00\u8D77\u53BB\u6253\u7403\uFF0C\u5982\u679C\u4F60\u7B49\u4E86\u534A\u5C0F\u65F6\u670B\u53CB\u8FD8\u6CA1\u5230\uFF0C\u7A81\u7136\u4F60\u63A5\u5230\u4E00\u4E2A\u7535\u8BDD\uFF0C\u670B\u53CB\u7531\u4E8E\u7A81\u53D1\u72B6\u51B5\uFF0C\u4E0D\u80FD\u6765\u4E86\uFF0C\u90A3\u4E48\u4F60\u4E00\u5B9A\u8FBE\u5230\u56DE\u5E9C\u3002\u4E2D\u65AD\u64CD\u4F5C\u6B63\u662F\u63D0\u4F9B\u4E86\u4E00\u5957\u7C7B\u4F3C\u7684\u673A\u5236\uFF0C\u5982\u679C\u4E00\u4E2A\u7EBF\u7A0B\u6B63\u5728\u7B49\u5F85\u83B7\u53D6\u9501\uFF0C\u90A3\u4E48\u5B83\u4F9D\u7136\u53EF\u4EE5\u6536\u5230\u4E00\u4E2A\u901A\u77E5\uFF0C\u88AB\u544A\u77E5\u65E0\u9700\u7B49\u5F85\uFF0C\u53EF\u4EE5\u505C\u6B62\u5DE5\u4F5C\u4E86\u3002</p><p>\u793A\u4F8B\u4EE3\u7801\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo6</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> lock1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> lock2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> lock<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>lock <span class="token operator">=</span> lock<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lock <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    lock1<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    lock2<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    lock2<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    lock1<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u4E2D\u65AD\u6807\u5FD7:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>lock1<span class="token punctuation">.</span><span class="token function">isHeldByCurrentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    lock1<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>lock2<span class="token punctuation">.</span><span class="token function">isHeldByCurrentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    lock2<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5148\u8FD0\u884C\u4E00\u4E0B\u4E0A\u9762\u4EE3\u7801\uFF0C\u53D1\u73B0\u7A0B\u5E8F\u65E0\u6CD5\u7ED3\u675F\uFF0C\u4F7F\u7528jstack\u67E5\u770B\u7EBF\u7A0B\u5806\u6808\u4FE1\u606F\uFF0C\u53D1\u73B02\u4E2A\u7EBF\u7A0B\u6B7B\u9501\u4E86\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Found</span> one <span class="token class-name">Java</span><span class="token operator">-</span>level deadlock<span class="token operator">:</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token string">&quot;t2&quot;</span><span class="token operator">:</span>
  waiting <span class="token keyword">for</span> ownable synchronizer <span class="token number">0x0000000717380c20</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span>ReentrantLock</span>$<span class="token class-name">NonfairSync</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  which is held by <span class="token string">&quot;t1&quot;</span>
<span class="token string">&quot;t1&quot;</span><span class="token operator">:</span>
  waiting <span class="token keyword">for</span> ownable synchronizer <span class="token number">0x0000000717380c50</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span>ReentrantLock</span>$<span class="token class-name">NonfairSync</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  which is held by &quot;t2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>lock1\u88AB\u7EBF\u7A0Bt1\u5360\u7528\uFF0Clock2\u88AB\u7EBF\u7A0Bt2\u5360\u7528\uFF0C\u7EBF\u7A0Bt1\u5728\u7B49\u5F85\u83B7\u53D6lock2\uFF0C\u7EBF\u7A0Bt2\u5728\u7B49\u5F85\u83B7\u53D6lock1\uFF0C\u90FD\u5728\u76F8\u4E92\u7B49\u5F85\u83B7\u53D6\u5BF9\u65B9\u6301\u6709\u7684\u9501\uFF0C\u6700\u7EC8\u4EA7\u751F\u4E86\u6B7B\u9501\uFF0C\u5982\u679C\u662F\u5728synchronized\u5173\u952E\u5B57\u60C5\u51B5\u4E0B\u53D1\u751F\u4E86\u6B7B\u9501\u73B0\u8C61\uFF0C\u7A0B\u5E8F\u662F\u65E0\u6CD5\u7ED3\u675F\u7684\u3002</p><p>\u6211\u4EEC\u5BF9\u4E0A\u9762\u4EE3\u7801\u6539\u9020\u4E00\u4E0B\uFF0C\u7EBF\u7A0Bt2\u4E00\u76F4\u65E0\u6CD5\u83B7\u53D6\u5230lock1\uFF0C\u90A3\u4E48\u7B49\u5F855\u79D2\u4E4B\u540E\uFF0C\u6211\u4EEC\u4E2D\u65AD\u83B7\u53D6\u9501\u7684\u64CD\u4F5C\u3002\u4E3B\u8981\u4FEE\u6539\u4E00\u4E0Bmain\u65B9\u6CD5\uFF0C\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t2<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u65B0\u589E\u4E862\u884C\u4EE3\u7801<code>TimeUnit.SECONDS.sleep(5);t2.interrupt();</code>\uFF0C\u7A0B\u5E8F\u53EF\u4EE5\u7ED3\u675F\u4E86\uFF0C\u8FD0\u884C\u7ED3\u679C\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>InterruptedException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span>AbstractQueuedSynchronizer</span><span class="token punctuation">.</span><span class="token function">doAcquireInterruptibly</span><span class="token punctuation">(</span><span class="token class-name">AbstractQueuedSynchronizer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">898</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span>AbstractQueuedSynchronizer</span><span class="token punctuation">.</span><span class="token function">acquireInterruptibly</span><span class="token punctuation">(</span><span class="token class-name">AbstractQueuedSynchronizer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1222</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span>ReentrantLock</span><span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token class-name">ReentrantLock</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">335</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat06<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
\u4E2D\u65AD\u6807\u5FD7<span class="token operator">:</span><span class="token boolean">false</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE\u4E0A\u9762\u4FE1\u606F\u4E2D\u53EF\u4EE5\u770B\u51FA\uFF0C\u4EE3\u7801\u768431\u884C\u89E6\u53D1\u4E86\u5F02\u5E38\uFF0C<strong>\u4E2D\u65AD\u6807\u5FD7\u8F93\u51FA\uFF1Afalse</strong></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/ec24264d-651f-4eb6-aa60-bb98a3098f78.png" alt="ec24264d-651f-4eb6-aa60-bb98a3098f78"></p><p>t2\u572831\u884C\u4E00\u76F4\u83B7\u53D6\u4E0D\u5230lock1\u7684\u9501\uFF0C\u4E3B\u7EBF\u7A0B\u4E2D\u7B49\u5F85\u4E865\u79D2\u4E4B\u540E\uFF0Ct2\u7EBF\u7A0B\u8C03\u7528\u4E86<code>interrupt()</code>\u65B9\u6CD5\uFF0C\u5C06\u7EBF\u7A0B\u7684\u4E2D\u65AD\u6807\u5FD7\u7F6E\u4E3Atrue\uFF0C\u6B64\u65F631\u884C\u4F1A\u89E6\u53D1<code>InterruptedException</code>\u5F02\u5E38\uFF0C\u7136\u540E\u7EBF\u7A0Bt2\u53EF\u4EE5\u7EE7\u7EED\u5411\u4E0B\u6267\u884C\uFF0C\u91CA\u653E\u4E86lock2\u7684\u9501\uFF0C\u7136\u540E\u7EBF\u7A0Bt1\u53EF\u4EE5\u6B63\u5E38\u83B7\u53D6\u9501\uFF0C\u7A0B\u5E8F\u5F97\u4EE5\u7EE7\u7EED\u8FDB\u884C\u3002\u7EBF\u7A0B\u53D1\u9001\u4E2D\u65AD\u4FE1\u53F7\u89E6\u53D1InterruptedException\u5F02\u5E38\u4E4B\u540E\uFF0C\u4E2D\u65AD\u6807\u5FD7\u5C06\u88AB\u6E05\u7A7A\u3002</p><p>\u5173\u4E8E\u83B7\u53D6\u9501\u7684\u8FC7\u7A0B\u4E2D\u88AB\u4E2D\u65AD\uFF0C\u6CE8\u610F\u51E0\u70B9:</p><ol><li><strong>ReentrankLock\u4E2D\u5FC5\u987B\u4F7F\u7528\u5B9E\u4F8B\u65B9\u6CD5<code>lockInterruptibly()</code>\u83B7\u53D6\u9501\u65F6\uFF0C\u5728\u7EBF\u7A0B\u8C03\u7528interrupt()\u65B9\u6CD5\u4E4B\u540E\uFF0C\u624D\u4F1A\u5F15\u53D1<code>InterruptedException</code>\u5F02\u5E38</strong></li><li><strong>\u7EBF\u7A0B\u8C03\u7528interrupt()\u4E4B\u540E\uFF0C\u7EBF\u7A0B\u7684\u4E2D\u65AD\u6807\u5FD7\u4F1A\u88AB\u7F6E\u4E3Atrue</strong></li><li><strong>\u89E6\u53D1InterruptedException\u5F02\u5E38\u4E4B\u540E\uFF0C\u7EBF\u7A0B\u7684\u4E2D\u65AD\u6807\u5FD7\u4F1A\u88AB\u6E05\u7A7A\uFF0C\u5373\u7F6E\u4E3Afalse</strong></li><li><strong>\u6240\u4EE5\u5F53\u7EBF\u7A0B\u8C03\u7528interrupt()\u5F15\u53D1InterruptedException\u5F02\u5E38\uFF0C\u4E2D\u65AD\u6807\u5FD7\u7684\u53D8\u5316\u662F:false-&gt;true-&gt;false</strong></li></ol><h4 id="_4\u3001reentrantlock\u9501\u7533\u8BF7\u7B49\u5F85\u9650\u65F6" tabindex="-1"><a class="header-anchor" href="#_4\u3001reentrantlock\u9501\u7533\u8BF7\u7B49\u5F85\u9650\u65F6" aria-hidden="true">#</a> 4\u3001ReentrantLock\u9501\u7533\u8BF7\u7B49\u5F85\u9650\u65F6</h4><p>\u7533\u8BF7\u9501\u7B49\u5F85\u9650\u65F6\u662F\u4EC0\u4E48\u610F\u601D\uFF1F\u4E00\u822C\u60C5\u51B5\u4E0B\uFF0C\u83B7\u53D6\u9501\u7684\u65F6\u95F4\u6211\u4EEC\u662F\u4E0D\u77E5\u9053\u7684\uFF0Csynchronized\u5173\u952E\u5B57\u83B7\u53D6\u9501\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u53EA\u80FD\u7B49\u5F85\u5176\u4ED6\u7EBF\u7A0B\u628A\u9501\u91CA\u653E\u4E4B\u540E\u624D\u80FD\u591F\u6709\u673A\u4F1A\u83B7\u53D6\u5230\u9501\u3002\u6240\u4EE5\u83B7\u53D6\u9501\u7684\u65F6\u95F4\u6709\u957F\u6709\u77ED\u3002\u5982\u679C\u83B7\u53D6\u9501\u7684\u65F6\u95F4\u80FD\u591F\u8BBE\u7F6E\u8D85\u65F6\u65F6\u95F4\uFF0C\u90A3\u5C31\u975E\u5E38\u597D\u4E86\u3002</p><p>ReentrantLock\u521A\u597D\u63D0\u4F9B\u4E86\u8FD9\u6837\u529F\u80FD\uFF0C\u7ED9\u6211\u4EEC\u63D0\u4F9B\u4E86\u83B7\u53D6\u9501\u9650\u65F6\u7B49\u5F85\u7684\u65B9\u6CD5<code>tryLock()</code>\uFF0C\u53EF\u4EE5\u9009\u62E9\u4F20\u5165\u65F6\u95F4\u53C2\u6570\uFF0C\u8868\u793A\u7B49\u5F85\u6307\u5B9A\u7684\u65F6\u95F4\uFF0C\u65E0\u53C2\u5219\u8868\u793A\u7ACB\u5373\u8FD4\u56DE\u9501\u7533\u8BF7\u7684\u7ED3\u679C\uFF1Atrue\u8868\u793A\u83B7\u53D6\u9501\u6210\u529F\uFF0Cfalse\u8868\u793A\u83B7\u53D6\u9501\u5931\u8D25\u3002</p><p><strong>tryLock\u65E0\u53C2\u65B9\u6CD5</strong></p><p>\u770B\u4E00\u4E0B\u6E90\u7801\u4E2DtryLock\u65B9\u6CD5\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8FD4\u56DEboolean\u7C7B\u578B\u7684\u503C\uFF0C\u6B64\u65B9\u6CD5\u4F1A\u7ACB\u5373\u8FD4\u56DE\uFF0C\u7ED3\u679C\u8868\u793A\u83B7\u53D6\u9501\u662F\u5426\u6210\u529F\uFF0C\u793A\u4F8B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo8</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> lock1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u5F00\u59CB\u83B7\u53D6\u9501!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//\u83B7\u53D6\u9501\u8D85\u65F6\u65F6\u95F4\u8BBE\u7F6E\u4E3A3\u79D2\uFF0C3\u79D2\u5185\u662F\u5426\u80FD\u5426\u83B7\u53D6\u9501\u90FD\u4F1A\u8FD4\u56DE</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>lock1<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u83B7\u53D6\u5230\u4E86\u9501!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//\u83B7\u53D6\u5230\u9501\u4E4B\u540E\uFF0C\u4F11\u77205\u79D2</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u672A\u80FD\u83B7\u53D6\u5230\u9501!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>lock1<span class="token punctuation">.</span><span class="token function">isHeldByCurrentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    lock1<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE3\u7801\u4E2D\u83B7\u53D6\u9501\u6210\u529F\u4E4B\u540E\uFF0C\u4F11\u77205\u79D2\uFF0C\u4F1A\u5BFC\u81F4\u53E6\u5916\u4E00\u4E2A\u7EBF\u7A0B\u83B7\u53D6\u9501\u5931\u8D25\uFF0C\u8FD0\u884C\u4EE3\u7801\uFF0C\u8F93\u51FA\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1563356291081</span><span class="token operator">:</span>t2\u5F00\u59CB\u83B7\u53D6\u9501<span class="token operator">!</span>
<span class="token number">1563356291081</span><span class="token operator">:</span>t2\u83B7\u53D6\u5230\u4E86\u9501<span class="token operator">!</span>
<span class="token number">1563356291081</span><span class="token operator">:</span>t1\u5F00\u59CB\u83B7\u53D6\u9501<span class="token operator">!</span>
<span class="token number">1563356291081</span><span class="token operator">:</span>t1\u672A\u80FD\u83B7\u53D6\u5230\u9501<span class="token operator">!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>tryLock\u6709\u53C2\u65B9\u6CD5</strong></p><p>\u53EF\u4EE5\u660E\u786E\u8BBE\u7F6E\u83B7\u53D6\u9501\u7684\u8D85\u65F6\u65F6\u95F4\uFF0C\u8BE5\u65B9\u6CD5\u7B7E\u540D\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8BE5\u65B9\u6CD5\u5728\u6307\u5B9A\u7684\u65F6\u95F4\u5185\u4E0D\u7BA1\u662F\u5426\u53EF\u4EE5\u83B7\u53D6\u9501\uFF0C\u90FD\u4F1A\u8FD4\u56DE\u7ED3\u679C\uFF0C\u8FD4\u56DEtrue\uFF0C\u8868\u793A\u83B7\u53D6\u9501\u6210\u529F\uFF0C\u8FD4\u56DEfalse\u8868\u793A\u83B7\u53D6\u5931\u8D25\u3002\u6B64\u65B9\u6CD5\u67092\u4E2A\u53C2\u6570\uFF0C\u7B2C\u4E00\u4E2A\u53C2\u6570\u662F\u65F6\u95F4\u7C7B\u578B\uFF0C\u662F\u4E00\u4E2A\u679A\u4E3E\uFF0C\u53EF\u4EE5\u8868\u793A\u65F6\u3001\u5206\u3001\u79D2\u3001\u6BEB\u79D2\u7B49\u5F85\uFF0C\u4F7F\u7528\u6BD4\u8F83\u65B9\u4FBF\uFF0C\u7B2C1\u4E2A\u53C2\u6570\u8868\u793A\u5728\u65F6\u95F4\u7C7B\u578B\u4E0A\u7684\u65F6\u95F4\u957F\u77ED\u3002\u6B64\u65B9\u6CD5\u5728\u6267\u884C\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u5982\u679C\u8C03\u7528\u4E86\u7EBF\u7A0B\u7684\u4E2D\u65ADinterrupt()\u65B9\u6CD5\uFF0C\u4F1A\u89E6\u53D1InterruptedException\u5F02\u5E38\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo7</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> lock1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u5F00\u59CB\u83B7\u53D6\u9501!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//\u83B7\u53D6\u9501\u8D85\u65F6\u65F6\u95F4\u8BBE\u7F6E\u4E3A3\u79D2\uFF0C3\u79D2\u5185\u662F\u5426\u80FD\u5426\u83B7\u53D6\u9501\u90FD\u4F1A\u8FD4\u56DE</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>lock1<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u83B7\u53D6\u5230\u4E86\u9501!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//\u83B7\u53D6\u5230\u9501\u4E4B\u540E\uFF0C\u4F11\u77205\u79D2</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u672A\u80FD\u83B7\u53D6\u5230\u9501!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>lock1<span class="token punctuation">.</span><span class="token function">isHeldByCurrentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    lock1<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7A0B\u5E8F\u4E2D\u8C03\u7528\u4E86ReentrantLock\u7684\u5B9E\u4F8B\u65B9\u6CD5<code>tryLock(3, TimeUnit.SECONDS)</code>\uFF0C\u8868\u793A\u83B7\u53D6\u9501\u7684\u8D85\u65F6\u65F6\u95F4\u662F3\u79D2\uFF0C3\u79D2\u540E\u4E0D\u7BA1\u662F\u5426\u80FD\u5426\u83B7\u53D6\u9501\uFF0C\u8BE5\u65B9\u6CD5\u90FD\u4F1A\u6709\u8FD4\u56DE\u503C\uFF0C\u83B7\u53D6\u5230\u9501\u4E4B\u540E\uFF0C\u5185\u90E8\u4F11\u7720\u4E865\u79D2\uFF0C\u4F1A\u5BFC\u81F4\u53E6\u5916\u4E00\u4E2A\u7EBF\u7A0B\u83B7\u53D6\u9501\u5931\u8D25\u3002</p><p>\u8FD0\u884C\u7A0B\u5E8F\uFF0C\u8F93\u51FA\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1563355512901</span><span class="token operator">:</span>t2\u5F00\u59CB\u83B7\u53D6\u9501<span class="token operator">!</span>
<span class="token number">1563355512901</span><span class="token operator">:</span>t1\u5F00\u59CB\u83B7\u53D6\u9501<span class="token operator">!</span>
<span class="token number">1563355512902</span><span class="token operator">:</span>t2\u83B7\u53D6\u5230\u4E86\u9501<span class="token operator">!</span>
<span class="token number">1563355515904</span><span class="token operator">:</span>t1\u672A\u80FD\u83B7\u53D6\u5230\u9501<span class="token operator">!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7ED3\u679C\u4E2D\u5206\u6790\uFF0Ct2\u83B7\u53D6\u5230\u9501\u4E86\uFF0C\u7136\u540E\u4F11\u7720\u4E865\u79D2\uFF0Ct1\u83B7\u53D6\u9501\u5931\u8D25\uFF0Ct1\u6253\u5370\u4E862\u6761\u4FE1\u606F\uFF0C\u65F6\u95F4\u76F8\u5DEE3\u79D2\u5DE6\u53F3\u3002</p><p><strong>\u5173\u4E8EtryLock()\u65B9\u6CD5\u548CtryLock(long timeout, TimeUnit unit)\u65B9\u6CD5\uFF0C\u8BF4\u660E\u4E00\u4E0B\uFF1A</strong></p><ol><li>\u90FD\u4F1A\u8FD4\u56DEboolean\u503C\uFF0C\u7ED3\u679C\u8868\u793A\u83B7\u53D6\u9501\u662F\u5426\u6210\u529F</li><li>tryLock()\u65B9\u6CD5\uFF0C\u4E0D\u7BA1\u662F\u5426\u83B7\u53D6\u6210\u529F\uFF0C\u90FD\u4F1A\u7ACB\u5373\u8FD4\u56DE\uFF1B\u800C\u6709\u53C2\u7684tryLock\u65B9\u6CD5\u4F1A\u5C1D\u8BD5\u5728\u6307\u5B9A\u7684\u65F6\u95F4\u5185\u53BB\u83B7\u53D6\u9501\uFF0C\u4E2D\u95F4\u4F1A\u963B\u585E\u7684\u73B0\u8C61\uFF0C\u5728\u6307\u5B9A\u7684\u65F6\u95F4\u4E4B\u540E\u4F1A\u4E0D\u7BA1\u662F\u5426\u80FD\u591F\u83B7\u53D6\u9501\u90FD\u4F1A\u8FD4\u56DE\u7ED3\u679C</li><li>tryLock()\u65B9\u6CD5\u4E0D\u4F1A\u54CD\u5E94\u7EBF\u7A0B\u7684\u4E2D\u65AD\u65B9\u6CD5\uFF1B\u800C\u6709\u53C2\u7684tryLock\u65B9\u6CD5\u4F1A\u54CD\u5E94\u7EBF\u7A0B\u7684\u4E2D\u65AD\u65B9\u6CD5\uFF0C\u800C\u89E6\u53D1<code>InterruptedException</code>\u5F02\u5E38\uFF0C\u8FD9\u4E2A\u4ECE2\u4E2A\u65B9\u6CD5\u7684\u58F0\u660E\u4E0A\u53EF\u4EE5\u53EF\u4EE5\u770B\u51FA\u6765</li></ol><h4 id="_5\u3001reentrantlock\u5176\u4ED6\u5E38\u7528\u7684\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_5\u3001reentrantlock\u5176\u4ED6\u5E38\u7528\u7684\u65B9\u6CD5" aria-hidden="true">#</a> 5\u3001ReentrantLock\u5176\u4ED6\u5E38\u7528\u7684\u65B9\u6CD5</h4><ol><li>isHeldByCurrentThread\uFF1A\u5B9E\u4F8B\u65B9\u6CD5\uFF0C\u5224\u65AD\u5F53\u524D\u7EBF\u7A0B\u662F\u5426\u6301\u6709ReentrantLock\u7684\u9501\uFF0C\u4E0A\u9762\u4EE3\u7801\u4E2D\u6709\u4F7F\u7528\u8FC7\u3002</li></ol><p><strong>\u83B7\u53D6\u9501\u76844\u79CD\u65B9\u6CD5\u5BF9\u6BD4</strong></p><table><thead><tr><th>\u83B7\u53D6\u9501\u7684\u65B9\u6CD5</th><th>\u662F\u5426\u7ACB\u5373\u54CD\u5E94(\u4E0D\u4F1A\u963B\u585E)</th><th>\u662F\u5426\u54CD\u5E94\u4E2D\u65AD</th></tr></thead><tbody><tr><td>lock()</td><td>\xD7</td><td>\xD7</td></tr><tr><td>lockInterruptibly()</td><td>\xD7</td><td>\u221A</td></tr><tr><td>tryLock()</td><td>\u221A</td><td>\xD7</td></tr><tr><td>tryLock(long timeout, TimeUnit unit)</td><td>\xD7</td><td>\u221A</td></tr></tbody></table><h4 id="_6\u3001\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u603B\u7ED3" aria-hidden="true">#</a> 6\u3001\u603B\u7ED3</h4><ol><li>ReentrantLock\u53EF\u4EE5\u5B9E\u73B0\u516C\u5E73\u9501\u548C\u975E\u516C\u5E73\u9501</li><li>ReentrantLock\u9ED8\u8BA4\u5B9E\u73B0\u7684\u662F\u975E\u516C\u5E73\u9501</li><li>ReentrantLock\u7684\u83B7\u53D6\u9501\u548C\u91CA\u653E\u9501\u5FC5\u987B\u6210\u5BF9\u51FA\u73B0\uFF0C\u9501\u4E86\u51E0\u6B21\uFF0C\u4E5F\u8981\u91CA\u653E\u51E0\u6B21</li><li>\u91CA\u653E\u9501\u7684\u64CD\u4F5C\u5FC5\u987B\u653E\u5728finally\u4E2D\u6267\u884C</li><li>lockInterruptibly()\u5B9E\u4F8B\u65B9\u6CD5\u53EF\u4EE5\u76F8\u5E94\u7EBF\u7A0B\u7684\u4E2D\u65AD\u65B9\u6CD5\uFF0C\u8C03\u7528\u7EBF\u7A0B\u7684interrupt()\u65B9\u6CD5\u65F6\uFF0ClockInterruptibly()\u65B9\u6CD5\u4F1A\u89E6\u53D1<code>InterruptedException</code>\u5F02\u5E38</li><li>\u5173\u4E8E<code>InterruptedException</code>\u5F02\u5E38\u8BF4\u4E00\u4E0B\uFF0C\u770B\u5230\u65B9\u6CD5\u58F0\u660E\u4E0A\u5E26\u6709 <code>throws InterruptedException</code>\uFF0C\u8868\u793A\u8BE5\u65B9\u6CD5\u53EF\u4EE5\u76F8\u5E94\u7EBF\u7A0B\u4E2D\u65AD\uFF0C\u8C03\u7528\u7EBF\u7A0B\u7684interrupt()\u65B9\u6CD5\u65F6\uFF0C\u8FD9\u4E9B\u65B9\u6CD5\u4F1A\u89E6\u53D1<code>InterruptedException</code>\u5F02\u5E38\uFF0C\u89E6\u53D1InterruptedException\u65F6\uFF0C\u7EBF\u7A0B\u7684\u4E2D\u65AD\u4E2D\u65AD\u72B6\u6001\u4F1A\u88AB\u6E05\u9664\u3002\u6240\u4EE5\u5982\u679C\u7A0B\u5E8F\u7531\u4E8E\u8C03\u7528<code>interrupt()</code>\u65B9\u6CD5\u800C\u89E6\u53D1<code>InterruptedException</code>\u5F02\u5E38\uFF0C\u7EBF\u7A0B\u7684\u6807\u5FD7\u7531\u9ED8\u8BA4\u7684false\u53D8\u4E3Ature\uFF0C\u7136\u540E\u53C8\u53D8\u4E3Afalse</li><li>\u5B9E\u4F8B\u65B9\u6CD5tryLock()\u4F1A\u5C1D\u8BD5\u83B7\u53D6\u9501\uFF0C\u4F1A\u7ACB\u5373\u8FD4\u56DE\uFF0C\u8FD4\u56DE\u503C\u8868\u793A\u662F\u5426\u83B7\u53D6\u6210\u529F</li><li>\u5B9E\u4F8B\u65B9\u6CD5tryLock(long timeout, TimeUnit unit)\u4F1A\u5728\u6307\u5B9A\u7684\u65F6\u95F4\u5185\u5C1D\u8BD5\u83B7\u53D6\u9501\uFF0C\u6307\u5B9A\u7684\u65F6\u95F4\u5185\u662F\u5426\u80FD\u591F\u83B7\u53D6\u9501\uFF0C\u90FD\u4F1A\u8FD4\u56DE\uFF0C\u8FD4\u56DE\u503C\u8868\u793A\u662F\u5426\u83B7\u53D6\u9501\u6210\u529F\uFF0C\u8BE5\u65B9\u6CD5\u4F1A\u54CD\u5E94\u7EBF\u7A0B\u7684\u4E2D\u65AD</li></ol><h3 id="_5\u3001\u60B2\u89C2\u9501" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u60B2\u89C2\u9501" aria-hidden="true">#</a> 5\u3001\u60B2\u89C2\u9501</h3><p>\u8BA4\u4E3A\u81EA\u5DF1\u5728\u4F7F\u7528\u6570\u636E\u7684\u65F6\u5019\u4E00\u5B9A\u6709\u522B\u7684\u7EBF\u7A0B\u6765\u4FEE\u6539\u6570\u636E\uFF0C\u56E0\u6B64\u5728\u83B7\u53D6\u6570\u636E\u7684\u65F6\u5019\u4F1A\u5148\u52A0\u9501\uFF0C\u786E\u4FDD\u6570\u636E\u4E0D\u4F1A\u88AB\u522B\u7684\u7EBF\u7A0B\u4FEE\u6539\u3002</p><p>synchronized\u5173\u952E\u5B57\u548CLock\u7684\u5B9E\u73B0\u7C7B\u90FD\u662F\u60B2\u89C2\u9501</p><p>\u9002\u5408\u5199\u64CD\u4F5C\u591A\u7684\u573A\u666F\uFF0C\u5148\u52A0\u9501\u53EF\u4EE5\u4FDD\u8BC1\u5199\u64CD\u4F5C\u65F6\u6570\u636E\u6B63\u786E\u3002</p><p>\u663E\u5F0F\u7684\u9501\u5B9A\u4E4B\u540E\u518D\u64CD\u4F5C\u540C\u6B65\u8D44\u6E90</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//=============\u60B2\u89C2\u9501\u7684\u8C03\u7528\u65B9\u5F0F</span>
<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//\u52A0\u9501\u540E\u7684\u4E1A\u52A1\u903B\u8F91......</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u4FDD\u8BC1\u591A\u4E2A\u7EBF\u7A0B\u4F7F\u7528\u7684\u662F\u540C\u4E00\u4E2Alock\u5BF9\u8C61\u7684\u524D\u63D0\u4E0B</span>
<span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">m2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u64CD\u4F5C\u540C\u6B65\u8D44\u6E90</span>
    <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6\u3001\u4E50\u89C2\u9501" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u4E50\u89C2\u9501" aria-hidden="true">#</a> 6\u3001\u4E50\u89C2\u9501</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//=============\u4E50\u89C2\u9501\u7684\u8C03\u7528\u65B9\u5F0F</span>
<span class="token comment">// \u4FDD\u8BC1\u591A\u4E2A\u7EBF\u7A0B\u4F7F\u7528\u7684\u662F\u540C\u4E00\u4E2AAtomicInteger</span>
<span class="token keyword">private</span> <span class="token class-name">AtomicInteger</span> atomicInteger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
atomicInteger<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u200B \u4E50\u89C2\u9501\u8BA4\u4E3A\u81EA\u5DF1\u5728\u4F7F\u7528\u6570\u636E\u65F6\u4E0D\u4F1A\u6709\u522B\u7684\u7EBF\u7A0B\u4FEE\u6539\u6570\u636E\uFF0C\u6240\u4EE5\u4E0D\u4F1A\u6DFB\u52A0\u9501\uFF0C\u53EA\u662F\u5728\u66F4\u65B0\u6570\u636E\u7684\u65F6\u5019\u53BB\u5224\u65AD\u4E4B\u524D\u6709\u6CA1\u6709\u522B\u7684\u7EBF\u7A0B\u66F4\u65B0\u4E86\u8FD9\u4E2A\u6570\u636E\u3002</p><p>\u5982\u679C\u8FD9\u4E2A\u6570\u636E\u6CA1\u6709\u88AB\u66F4\u65B0\uFF0C\u5F53\u524D\u7EBF\u7A0B\u5C06\u81EA\u5DF1\u4FEE\u6539\u7684\u6570\u636E\u6210\u529F\u5199\u5165\u3002\u5982\u679C\u6570\u636E\u5DF2\u7ECF\u88AB\u5176\u4ED6\u7EBF\u7A0B\u66F4\u65B0\uFF0C\u5219\u6839\u636E\u4E0D\u540C\u7684\u5B9E\u73B0\u65B9\u5F0F\u6267\u884C\u4E0D\u540C\u7684\u64CD\u4F5C</p><p>\u4E50\u89C2\u9501\u5728Java\u4E2D\u662F\u901A\u8FC7\u4F7F\u7528\u65E0\u9501\u7F16\u7A0B\u6765\u5B9E\u73B0\uFF0C\u6700\u5E38\u91C7\u7528\u7684\u662FCAS\u7B97\u6CD5\uFF0CJava\u539F\u5B50\u7C7B\u4E2D\u7684\u9012\u589E\u64CD\u4F5C\u5C31\u901A\u8FC7CAS\u81EA\u65CB\u5B9E\u73B0\u7684\u3002</p><p>\u9002\u5408\u8BFB\u64CD\u4F5C\u591A\u7684\u573A\u666F\uFF0C\u4E0D\u52A0\u9501\u7684\u7279\u70B9\u80FD\u591F\u4F7F\u5176\u8BFB\u64CD\u4F5C\u7684\u6027\u80FD\u5927\u5E45\u63D0\u5347\u3002</p><p>\u4E50\u89C2\u9501\u5219\u76F4\u63A5\u53BB\u64CD\u4F5C\u540C\u6B65\u8D44\u6E90\uFF0C\u662F\u4E00\u79CD\u65E0\u9501\u7B97\u6CD5\uFF0C\u5F97\u4E4B\u6211\u5E78\u4E0D\u5F97\u6211\u547D\uFF0C\u518D\u62A2</p><p>\u4E50\u89C2\u9501\u4E00\u822C\u6709\u4E24\u79CD\u5B9E\u73B0\u65B9\u5F0F\uFF1A</p><ol><li>\u91C7\u7528\u7248\u672C\u53F7\u673A\u5236</li><li>CAS\uFF08Compare-and-Swap\uFF0C\u5373\u6BD4\u8F83\u5E76\u66FF\u6362\uFF09\u7B97\u6CD5\u5B9E\u73B0</li></ol><h3 id="_7\u3001\u516B\u9501\u6848\u4F8B" tabindex="-1"><a class="header-anchor" href="#_7\u3001\u516B\u9501\u6848\u4F8B" aria-hidden="true">#</a> 7\u3001\u516B\u9501\u6848\u4F8B</h3><h4 id="_1\u3001jdk\u6E90\u7801-notify\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_1\u3001jdk\u6E90\u7801-notify\u65B9\u6CD5" aria-hidden="true">#</a> 1\u3001JDK\u6E90\u7801(notify\u65B9\u6CD5)</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210907200227293-16310161483121.png" alt="image-20210907200227293"></p><h4 id="_2\u30018\u79CD\u9501\u7684\u6848\u4F8B\u5B9E\u9645\u4F53\u73B0\u57283\u4E2A\u5730\u65B9" tabindex="-1"><a class="header-anchor" href="#_2\u30018\u79CD\u9501\u7684\u6848\u4F8B\u5B9E\u9645\u4F53\u73B0\u57283\u4E2A\u5730\u65B9" aria-hidden="true">#</a> 2\u30018\u79CD\u9501\u7684\u6848\u4F8B\u5B9E\u9645\u4F53\u73B0\u57283\u4E2A\u5730\u65B9</h4><ol><li>\u4F5C\u7528\u4E8E\u5B9E\u4F8B\u65B9\u6CD5\uFF0C\u5F53\u524D\u5B9E\u4F8B\u52A0\u9501\uFF0C\u8FDB\u5165\u540C\u6B65\u4EE3\u7801\u524D\u8981\u83B7\u5F97\u5F53\u524D\u5B9E\u4F8B\u7684\u9501\uFF1B</li><li>\u4F5C\u7528\u4E8E\u4EE3\u7801\u5757\uFF0C\u5BF9\u62EC\u53F7\u91CC\u914D\u7F6E\u7684\u5BF9\u8C61\u52A0\u9501\u3002</li><li>\u4F5C\u7528\u4E8E\u9759\u6001\u65B9\u6CD5\uFF0C\u5F53\u524D\u7C7B\u52A0\u9501\uFF0C\u8FDB\u53BB\u540C\u6B65\u4EE3\u7801\u524D\u8981\u83B7\u5F97\u5F53\u524D\u7C7B\u5BF9\u8C61\u7684\u9501\uFF1B</li></ol><h5 id="_1\u3001\u6807\u51C6\u8BBF\u95EE\u6709ab\u4E24\u4E2A\u7EBF\u7A0B-\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u6807\u51C6\u8BBF\u95EE\u6709ab\u4E24\u4E2A\u7EBF\u7A0B-\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1" aria-hidden="true">#</a> 1\u3001\u6807\u51C6\u8BBF\u95EE\u6709ab\u4E24\u4E2A\u7EBF\u7A0B\uFF0C\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1</h5><div class="language-JAVA ext-JAVA line-numbers-mode"><pre class="language-JAVA"><code>class Phone //\u8D44\u6E90\u7C7B
{
    public synchronized void sendEmail()
    {
        System.out.println(&quot;-------sendEmail&quot;);
    }

    public synchronized void sendSMS()
    {
        System.out.println(&quot;-------sendSMS&quot;);
    }
}

public class Lock8Demo
{
    public static void main(String[] args)//\u4E00\u5207\u7A0B\u5E8F\u7684\u5165\u53E3\uFF0C\u4E3B\u7EBF\u7A0B
    {
        Phone phone = new Phone();//\u8D44\u6E90\u7C7B1

        new Thread(() -&gt; {
            phone.sendEmail();
        },&quot;a&quot;).start();

        //\u6682\u505C\u6BEB\u79D2
        try { TimeUnit.MILLISECONDS.sleep(300); } catch (InterruptedException e) { e.printStackTrace(); }

        new Thread(() -&gt; {
            phone.sendSMS();
        },&quot;b&quot;).start();

    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>sendEmail
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>sendSMS
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2\u3001sendemail\u65B9\u6CD5\u6682\u505C3\u79D2\u949F-\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1" tabindex="-1"><a class="header-anchor" href="#_2\u3001sendemail\u65B9\u6CD5\u6682\u505C3\u79D2\u949F-\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1" aria-hidden="true">#</a> 2\u3001sendEmail\u65B9\u6CD5\u6682\u505C3\u79D2\u949F\uFF0C\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token comment">//\u8D44\u6E90\u7C7B</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------sendEmail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sendSMS</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------sendSMS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Lock8Demo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token comment">//\u4E00\u5207\u7A0B\u5E8F\u7684\u5165\u53E3\uFF0C\u4E3B\u7EBF\u7A0B</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Phone</span> phone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u8D44\u6E90\u7C7B1</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            phone<span class="token punctuation">.</span><span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C\u6BEB\u79D2</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            phone<span class="token punctuation">.</span><span class="token function">sendSMS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>sendEmail
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>sendSMS
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_1-2\u7ED3\u8BBA" tabindex="-1"><a class="header-anchor" href="#_1-2\u7ED3\u8BBA" aria-hidden="true">#</a> 1-2\u7ED3\u8BBA</h5><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u4E00\u4E2A\u5BF9\u8C61\u91CC\u9762\u5982\u679C\u6709\u591A\u4E2Asynchronized\u65B9\u6CD5\uFF0C\u67D0\u4E00\u4E2A\u65F6\u523B\u5185\uFF0C\u53EA\u8981\u4E00\u4E2A\u7EBF\u7A0B\u53BB\u8C03\u7528\u5176\u4E2D\u7684\u4E00\u4E2Asynchronized\u65B9\u6CD5\u4E86\uFF0C
\u5176\u5B83\u7684\u7EBF\u7A0B\u90FD\u53EA\u80FD\u7B49\u5F85\uFF0C\u6362\u53E5\u8BDD\u8BF4\uFF0C\u67D0\u4E00\u4E2A\u65F6\u523B\u5185\uFF0C\u53EA\u80FD\u6709\u552F\u4E00\u7684\u4E00\u4E2A\u7EBF\u7A0B\u53BB\u8BBF\u95EE\u8FD9\u4E9Bsynchronized\u65B9\u6CD5
\u9501\u7684\u662F\u5F53\u524D\u5BF9\u8C61this\uFF0C\u88AB\u9501\u5B9A\u540E\uFF0C\u5176\u5B83\u7684\u7EBF\u7A0B\u90FD\u4E0D\u80FD\u8FDB\u5165\u5230\u5F53\u524D\u5BF9\u8C61\u7684\u5176\u5B83\u7684synchronized\u65B9\u6CD5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3\u3001\u65B0\u589E\u4E00\u4E2A\u666E\u901A\u7684hello\u65B9\u6CD5-\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662Fhello" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u65B0\u589E\u4E00\u4E2A\u666E\u901A\u7684hello\u65B9\u6CD5-\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662Fhello" aria-hidden="true">#</a> 3\u3001\u65B0\u589E\u4E00\u4E2A\u666E\u901A\u7684hello\u65B9\u6CD5\uFF0C\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662Fhello</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token comment">//\u8D44\u6E90\u7C7B</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------sendEmail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sendSMS</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------sendSMS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Lock8Demo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token comment">//\u4E00\u5207\u7A0B\u5E8F\u7684\u5165\u53E3\uFF0C\u4E3B\u7EBF\u7A0B</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Phone</span> phone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u8D44\u6E90\u7C7B1</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            phone<span class="token punctuation">.</span><span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C\u6BEB\u79D2</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            phone<span class="token punctuation">.</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>hello
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>sendEmail
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4\u3001\u6709\u4E24\u90E8\u624B\u673A-\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u6709\u4E24\u90E8\u624B\u673A-\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1" aria-hidden="true">#</a> 4\u3001\u6709\u4E24\u90E8\u624B\u673A\uFF0C\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token comment">//\u8D44\u6E90\u7C7B</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------sendEmail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sendSMS</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------sendSMS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Lock8Demo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token comment">//\u4E00\u5207\u7A0B\u5E8F\u7684\u5165\u53E3\uFF0C\u4E3B\u7EBF\u7A0B</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Phone</span> phone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u8D44\u6E90\u7C7B1</span>
        <span class="token class-name">Phone</span> phone2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u8D44\u6E90\u7C7B2</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            phone<span class="token punctuation">.</span><span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C\u6BEB\u79D2</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            phone2<span class="token punctuation">.</span><span class="token function">sendSMS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>sendSMS
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>sendEmail
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-4\u7ED3\u8BBA" tabindex="-1"><a class="header-anchor" href="#_3-4\u7ED3\u8BBA" aria-hidden="true">#</a> 3-4\u7ED3\u8BBA</h5><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u52A0\u4E2A\u666E\u901A\u65B9\u6CD5\u540E\u53D1\u73B0\u548C\u540C\u6B65\u9501\u65E0\u5173,hello
\u6362\u6210\u4E24\u4E2A\u5BF9\u8C61\u540E\uFF0C\u4E0D\u662F\u540C\u4E00\u628A\u9501\u4E86\uFF0C\u60C5\u51B5\u7ACB\u523B\u53D8\u5316\u3002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5\u3001\u4E24\u4E2A\u9759\u6001\u540C\u6B65\u65B9\u6CD5-\u540C1\u90E8\u624B\u673A-\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u4E24\u4E2A\u9759\u6001\u540C\u6B65\u65B9\u6CD5-\u540C1\u90E8\u624B\u673A-\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1" aria-hidden="true">#</a> 5\u3001\u4E24\u4E2A\u9759\u6001\u540C\u6B65\u65B9\u6CD5\uFF0C\u540C1\u90E8\u624B\u673A\uFF0C\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token comment">//\u8D44\u6E90\u7C7B</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------sendEmail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sendSMS</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------sendSMS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Lock8Demo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token comment">//\u4E00\u5207\u7A0B\u5E8F\u7684\u5165\u53E3\uFF0C\u4E3B\u7EBF\u7A0B</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Phone</span> phone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u8D44\u6E90\u7C7B1</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            phone<span class="token punctuation">.</span><span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C\u6BEB\u79D2</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            phone<span class="token punctuation">.</span><span class="token function">sendSMS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>sendEmail
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>sendSMS
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_6\u3001\u4E24\u4E2A\u9759\u6001\u540C\u6B65\u65B9\u6CD5-2\u90E8\u624B\u673A-\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u4E24\u4E2A\u9759\u6001\u540C\u6B65\u65B9\u6CD5-2\u90E8\u624B\u673A-\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1" aria-hidden="true">#</a> 6\u3001\u4E24\u4E2A\u9759\u6001\u540C\u6B65\u65B9\u6CD5\uFF0C 2\u90E8\u624B\u673A\uFF0C\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token comment">//\u8D44\u6E90\u7C7B</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------sendEmail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sendSMS</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------sendSMS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Lock8Demo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token comment">//\u4E00\u5207\u7A0B\u5E8F\u7684\u5165\u53E3\uFF0C\u4E3B\u7EBF\u7A0B</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Phone</span> phone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u8D44\u6E90\u7C7B1</span>
        <span class="token class-name">Phone</span> phone2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u8D44\u6E90\u7C7B2</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            phone<span class="token punctuation">.</span><span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C\u6BEB\u79D2</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            phone2<span class="token punctuation">.</span><span class="token function">sendSMS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>sendEmail
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>sendSMS
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5-6\u7ED3\u8BBA" tabindex="-1"><a class="header-anchor" href="#_5-6\u7ED3\u8BBA" aria-hidden="true">#</a> 5-6\u7ED3\u8BBA</h5><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u90FD\u6362\u6210\u9759\u6001\u540C\u6B65\u65B9\u6CD5\u540E\uFF0C\u60C5\u51B5\u53C8\u53D8\u5316
\u4E09\u79CD synchronized \u9501\u7684\u5185\u5BB9\u6709\u4E00\u4E9B\u5DEE\u522B:
\u5BF9\u4E8E\u666E\u901A\u540C\u6B65\u65B9\u6CD5\uFF0C\u9501\u7684\u662F\u5F53\u524D\u5B9E\u4F8B\u5BF9\u8C61\uFF0C\u901A\u5E38\u6307this,\u5177\u4F53\u7684\u4E00\u90E8\u90E8\u624B\u673A,\u6240\u6709\u7684\u666E\u901A\u540C\u6B65\u65B9\u6CD5\u7528\u7684\u90FD\u662F\u540C\u4E00\u628A\u9501\u2014\u2014\u5B9E\u4F8B\u5BF9\u8C61\u672C\u8EAB\uFF0C
\u5BF9\u4E8E\u9759\u6001\u540C\u6B65\u65B9\u6CD5\uFF0C\u9501\u7684\u662F\u5F53\u524D\u7C7B\u7684Class\u5BF9\u8C61\uFF0C\u5982Phone.class\u552F\u4E00\u7684\u4E00\u4E2A\u6A21\u677F
\u5BF9\u4E8E\u540C\u6B65\u65B9\u6CD5\u5757\uFF0C\u9501\u7684\u662F synchronized \u62EC\u53F7\u5185\u7684\u5BF9\u8C61
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_7\u30011\u4E2A\u9759\u6001\u540C\u6B65\u65B9\u6CD5-1\u4E2A\u666E\u901A\u540C\u6B65\u65B9\u6CD5-\u540C1\u90E8\u624B\u673A-\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1" tabindex="-1"><a class="header-anchor" href="#_7\u30011\u4E2A\u9759\u6001\u540C\u6B65\u65B9\u6CD5-1\u4E2A\u666E\u901A\u540C\u6B65\u65B9\u6CD5-\u540C1\u90E8\u624B\u673A-\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1" aria-hidden="true">#</a> 7\u30011\u4E2A\u9759\u6001\u540C\u6B65\u65B9\u6CD5\uFF0C1\u4E2A\u666E\u901A\u540C\u6B65\u65B9\u6CD5,\u540C1\u90E8\u624B\u673A\uFF0C\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token comment">//\u8D44\u6E90\u7C7B</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------sendEmail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sendSMS</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------sendSMS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Lock8Demo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token comment">//\u4E00\u5207\u7A0B\u5E8F\u7684\u5165\u53E3\uFF0C\u4E3B\u7EBF\u7A0B</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Phone</span> phone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u8D44\u6E90\u7C7B1</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            phone<span class="token punctuation">.</span><span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C\u6BEB\u79D2</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            phone<span class="token punctuation">.</span><span class="token function">sendSMS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>sendSMS
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>sendEmail
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8\u30011\u4E2A\u9759\u6001\u540C\u6B65\u65B9\u6CD5-1\u4E2A\u666E\u901A\u540C\u6B65\u65B9\u6CD5-2\u90E8\u624B\u673A-\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1" tabindex="-1"><a class="header-anchor" href="#_8\u30011\u4E2A\u9759\u6001\u540C\u6B65\u65B9\u6CD5-1\u4E2A\u666E\u901A\u540C\u6B65\u65B9\u6CD5-2\u90E8\u624B\u673A-\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1" aria-hidden="true">#</a> 8\u30011\u4E2A\u9759\u6001\u540C\u6B65\u65B9\u6CD5\uFF0C1\u4E2A\u666E\u901A\u540C\u6B65\u65B9\u6CD5,2\u90E8\u624B\u673A\uFF0C\u8BF7\u95EE\u5148\u6253\u5370\u90AE\u4EF6\u8FD8\u662F\u77ED\u4FE1</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token comment">//\u8D44\u6E90\u7C7B</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------sendEmail&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">sendSMS</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------sendSMS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Lock8Demo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token comment">//\u4E00\u5207\u7A0B\u5E8F\u7684\u5165\u53E3\uFF0C\u4E3B\u7EBF\u7A0B</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Phone</span> phone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u8D44\u6E90\u7C7B1</span>
        <span class="token class-name">Phone</span> phone2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u8D44\u6E90\u7C7B2</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            phone<span class="token punctuation">.</span><span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C\u6BEB\u79D2</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            phone2<span class="token punctuation">.</span><span class="token function">sendSMS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>sendSMS
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>sendEmail
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_7-8\u7ED3\u8BBA" tabindex="-1"><a class="header-anchor" href="#_7-8\u7ED3\u8BBA" aria-hidden="true">#</a> 7-8\u7ED3\u8BBA</h5><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u5F53\u4E00\u4E2A\u7EBF\u7A0B\u8BD5\u56FE\u8BBF\u95EE\u540C\u6B65\u4EE3\u7801\u65F6\u5B83\u9996\u5148\u5FC5\u987B\u5F97\u5230\u9501\uFF0C\u9000\u51FA\u6216\u629B\u51FA\u5F02\u5E38\u65F6\u5FC5\u987B\u91CA\u653E\u9501\u3002

\u6240\u6709\u7684\u666E\u901A\u540C\u6B65\u65B9\u6CD5\u7528\u7684\u90FD\u662F\u540C\u4E00\u628A\u9501\u2014\u2014\u5B9E\u4F8B\u5BF9\u8C61\u672C\u8EAB\uFF0C\u5C31\u662Fnew\u51FA\u6765\u7684\u5177\u4F53\u5B9E\u4F8B\u5BF9\u8C61\u672C\u8EAB,\u672C\u7C7Bthis
\u4E5F\u5C31\u662F\u8BF4\u5982\u679C\u4E00\u4E2A\u5B9E\u4F8B\u5BF9\u8C61\u7684\u666E\u901A\u540C\u6B65\u65B9\u6CD5\u83B7\u53D6\u9501\u540E\uFF0C\u8BE5\u5B9E\u4F8B\u5BF9\u8C61\u7684\u5176\u4ED6\u666E\u901A\u540C\u6B65\u65B9\u6CD5\u5FC5\u987B\u7B49\u5F85\u83B7\u53D6\u9501\u7684\u65B9\u6CD5\u91CA\u653E\u9501\u540E\u624D\u80FD\u83B7\u53D6\u9501\u3002

\u6240\u6709\u7684\u9759\u6001\u540C\u6B65\u65B9\u6CD5\u7528\u7684\u4E5F\u662F\u540C\u4E00\u628A\u9501\u2014\u2014\u7C7B\u5BF9\u8C61\u672C\u8EAB\uFF0C\u5C31\u662F\u6211\u4EEC\u8BF4\u8FC7\u7684\u552F\u4E00\u6A21\u677FClass
\u5177\u4F53\u5B9E\u4F8B\u5BF9\u8C61this\u548C\u552F\u4E00\u6A21\u677FClass\uFF0C\u8FD9\u4E24\u628A\u9501\u662F\u4E24\u4E2A\u4E0D\u540C\u7684\u5BF9\u8C61\uFF0C\u6240\u4EE5\u9759\u6001\u540C\u6B65\u65B9\u6CD5\u4E0E\u666E\u901A\u540C\u6B65\u65B9\u6CD5\u4E4B\u95F4\u662F\u4E0D\u4F1A\u6709\u7ADE\u6001\u6761\u4EF6\u7684
\u4F46\u662F\u4E00\u65E6\u4E00\u4E2A\u9759\u6001\u540C\u6B65\u65B9\u6CD5\u83B7\u53D6\u9501\u540E\uFF0C\u5176\u4ED6\u7684\u9759\u6001\u540C\u6B65\u65B9\u6CD5\u90FD\u5FC5\u987B\u7B49\u5F85\u8BE5\u65B9\u6CD5\u91CA\u653E\u9501\u540E\u624D\u80FD\u83B7\u53D6\u9501\u3002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8\u3001\u516C\u5E73\u9501\u548C\u975E\u516C\u5E73\u9501" tabindex="-1"><a class="header-anchor" href="#_8\u3001\u516C\u5E73\u9501\u548C\u975E\u516C\u5E73\u9501" aria-hidden="true">#</a> 8\u3001\u516C\u5E73\u9501\u548C\u975E\u516C\u5E73\u9501</h3><p>\u5728\u5927\u591A\u6570\u60C5\u51B5\u4E0B\uFF0C\u9501\u7684\u7533\u8BF7\u90FD\u662F\u975E\u516C\u5E73\u7684\uFF0C\u4E5F\u5C31\u662F\u8BF4\uFF0C\u7EBF\u7A0B1\u9996\u5148\u8BF7\u6C42\u9501A\uFF0C\u63A5\u7740\u7EBF\u7A0B2\u4E5F\u8BF7\u6C42\u4E86\u9501A\u3002\u90A3\u4E48\u5F53\u9501A\u53EF\u7528\u65F6\uFF0C\u662F\u7EBF\u7A0B1\u53EF\u83B7\u5F97\u9501\u8FD8\u662F\u7EBF\u7A0B2\u53EF\u83B7\u5F97\u9501\u5462\uFF1F\u8FD9\u662F\u4E0D\u4E00\u5B9A\u7684\uFF0C\u7CFB\u7EDF\u53EA\u662F\u4F1A\u4ECE\u8FD9\u4E2A\u9501\u7684\u7B49\u5F85\u961F\u5217\u4E2D\u968F\u673A\u6311\u9009\u4E00\u4E2A\uFF0C\u56E0\u6B64\u4E0D\u80FD\u4FDD\u8BC1\u5176\u516C\u5E73\u6027\u3002\u8FD9\u5C31\u597D\u6BD4\u4E70\u7968\u4E0D\u6392\u961F\uFF0C\u5927\u5BB6\u90FD\u56F4\u5728\u552E\u7968\u7A97\u53E3\u524D\uFF0C\u552E\u7968\u5458\u5FD9\u7684\u7126\u5934\u70C2\u989D\uFF0C\u4E5F\u987E\u53CA\u4E0D\u4E0A\u8C01\u5148\u8C01\u540E\uFF0C\u968F\u4FBF\u627E\u4E2A\u4EBA\u51FA\u7968\u5C31\u5B8C\u4E8B\u4E86\uFF0C\u6700\u7EC8\u5BFC\u81F4\u7684\u7ED3\u679C\u662F\uFF0C\u6709\u4E9B\u4EBA\u53EF\u80FD\u4E00\u76F4\u4E70\u4E0D\u5230\u7968\u3002\u800C\u516C\u5E73\u9501\uFF0C\u5219\u4E0D\u662F\u8FD9\u6837\uFF0C\u5B83\u4F1A\u6309\u7167\u5230\u8FBE\u7684\u5148\u540E\u987A\u5E8F\u83B7\u5F97\u8D44\u6E90\u3002\u516C\u5E73\u9501\u7684\u4E00\u5927\u7279\u70B9\u662F\uFF1A\u5B83\u4E0D\u4F1A\u4EA7\u751F\u9965\u997F\u73B0\u8C61\uFF0C\u53EA\u8981\u4F60\u6392\u961F\uFF0C\u6700\u7EC8\u8FD8\u662F\u53EF\u4EE5\u7B49\u5230\u8D44\u6E90\u7684\uFF1Bsynchronized\u5173\u952E\u5B57\u9ED8\u8BA4\u662F\u6709jvm\u5185\u90E8\u5B9E\u73B0\u63A7\u5236\u7684\uFF0C\u662F\u975E\u516C\u5E73\u9501\u3002\u800CReentrantLock\u8FD0\u884C\u5F00\u53D1\u8005\u81EA\u5DF1\u8BBE\u7F6E\u9501\u7684\u516C\u5E73\u6027\u3002</p><p>\u770B\u4E00\u4E0Bjdk\u4E2DReentrantLock\u7684\u6E90\u7801\uFF0C2\u4E2A\u6784\u9020\u65B9\u6CD5\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sync <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NonfairSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> fair<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sync <span class="token operator">=</span> fair <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">FairSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">NonfairSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u9ED8\u8BA4\u6784\u9020\u65B9\u6CD5\u521B\u5EFA\u7684\u662F\u975E\u516C\u5E73\u9501\u3002</p><p>\u7B2C2\u4E2A\u6784\u9020\u65B9\u6CD5\uFF0C\u6709\u4E2Afair\u53C2\u6570\uFF0C\u5F53fair\u4E3Atrue\u7684\u65F6\u5019\u521B\u5EFA\u7684\u662F\u516C\u5E73\u9501\uFF0C\u516C\u5E73\u9501\u770B\u8D77\u6765\u5F88\u4E0D\u9519\uFF0C\u4E0D\u8FC7\u8981\u5B9E\u73B0\u516C\u5E73\u9501\uFF0C\u7CFB\u7EDF\u5185\u90E8\u80AF\u5B9A\u9700\u8981\u7EF4\u62A4\u4E00\u4E2A\u6709\u5E8F\u961F\u5217\uFF0C\u56E0\u6B64\u516C\u5E73\u9501\u7684\u5B9E\u73B0\u6210\u672C\u6BD4\u8F83\u9AD8\uFF0C\u6027\u80FD\u76F8\u5BF9\u4E8E\u975E\u516C\u5E73\u9501\u6765\u8BF4\u76F8\u5BF9\u4F4E\u4E00\u4E9B\u3002\u56E0\u6B64\uFF0C\u5728\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u9501\u662F\u975E\u516C\u5E73\u7684\uFF0C\u5982\u679C\u6CA1\u6709\u7279\u522B\u8981\u6C42\uFF0C\u5219\u4E0D\u5EFA\u8BAE\u4F7F\u7528\u516C\u5E73\u9501\u3002</p><p>\u516C\u5E73\u9501\u548C\u975E\u516C\u5E73\u9501\u5728\u7A0B\u5E8F\u8C03\u5EA6\u4E0A\u662F\u5F88\u4E0D\u4E00\u6837\uFF0C\u6765\u4E00\u4E2A\u516C\u5E73\u9501\u793A\u4F8B\u770B\u4E00\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo5</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> fairLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                fairLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u83B7\u5F97\u9501!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    fairLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u770B\u4E00\u4E0B\u8F93\u51FA\u7684\u7ED3\u679C\uFF0C\u9501\u662F\u6309\u7167\u5148\u540E\u987A\u5E8F\u83B7\u5F97\u7684\u3002</p><p>\u4FEE\u6539\u4E00\u4E0B\u4E0A\u9762\u4EE3\u7801\uFF0C\u6539\u4E3A\u975E\u516C\u5E73\u9501\u8BD5\u8BD5\uFF0C\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ReentrantLock</span> fairLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4ECEReentrantLock\u5356\u7968\u7F16\u7801\u6F14\u793A\u516C\u5E73\u548C\u975E\u516C\u5E73\u73B0\u8C61</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Ticket</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sale</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>number <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\u5356\u51FA\u7B2C\uFF1A\\t&quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>number<span class="token operator">--</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t \u8FD8\u5269\u4E0B:&quot;</span><span class="token operator">+</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SaleTicketDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Ticket</span> ticket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ticket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">35</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>  ticket<span class="token punctuation">.</span><span class="token function">sale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">35</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>  ticket<span class="token punctuation">.</span><span class="token function">sale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">35</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>  ticket<span class="token punctuation">.</span><span class="token function">sale</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u751F\u6D3B\u4E2D\uFF0C\u6392\u961F\u8BB2\u6C42\u5148\u6765\u540E\u5230\u89C6\u4E3A\u516C\u5E73\u3002\u7A0B\u5E8F\u4E2D\u7684\u516C\u5E73\u6027\u4E5F\u662F\u7B26\u5408\u8BF7\u6C42\u9501\u7684\u7EDD\u5BF9\u65F6\u95F4\u7684\uFF0C\u5176\u5B9E\u5C31\u662F FIFO\uFF0C\u5426\u5219\u89C6\u4E3A\u4E0D\u516C\u5E73</p><h4 id="_1\u3001\u6E90\u7801\u89E3\u8BFB" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u6E90\u7801\u89E3\u8BFB" aria-hidden="true">#</a> 1\u3001\u6E90\u7801\u89E3\u8BFB</h4><p>\u200B \u6309\u5E8F\u6392\u961F\u516C\u5E73\u9501\uFF0C\u5C31\u662F\u5224\u65AD\u540C\u6B65\u961F\u5217\u662F\u5426\u8FD8\u6709\u5148\u9A71\u8282\u70B9\u7684\u5B58\u5728(\u6211\u524D\u9762\u8FD8\u6709\u4EBA\u5417?)\uFF0C\u5982\u679C\u6CA1\u6709\u5148\u9A71\u8282\u70B9\u624D\u80FD\u83B7\u53D6\u9501\uFF1B\u5148\u5360\u5148\u5F97\u975E\u516C\u5E73\u9501\uFF0C\u662F\u4E0D\u7BA1\u8FD9\u4E2A\u4E8B\u7684\uFF0C\u53EA\u8981\u80FD\u62A2\u83B7\u5230\u540C\u6B65\u72B6\u6001\u5C31\u53EF\u4EE5</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916224629198.png" alt="image-20210916224629198"></p><h4 id="_2\u3001\u4E3A\u4EC0\u4E48\u4F1A\u6709\u516C\u5E73\u9501-\u975E\u516C\u5E73\u9501\u7684\u8BBE\u8BA1\u4E3A\u4EC0\u4E48\u9ED8\u8BA4\u975E\u516C\u5E73" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u4E3A\u4EC0\u4E48\u4F1A\u6709\u516C\u5E73\u9501-\u975E\u516C\u5E73\u9501\u7684\u8BBE\u8BA1\u4E3A\u4EC0\u4E48\u9ED8\u8BA4\u975E\u516C\u5E73" aria-hidden="true">#</a> 2\u3001\u4E3A\u4EC0\u4E48\u4F1A\u6709\u516C\u5E73\u9501/\u975E\u516C\u5E73\u9501\u7684\u8BBE\u8BA1\u4E3A\u4EC0\u4E48\u9ED8\u8BA4\u975E\u516C\u5E73\uFF1F</h4><ol><li>\u6062\u590D\u6302\u8D77\u7684\u7EBF\u7A0B\u5230\u771F\u6B63\u9501\u7684\u83B7\u53D6\u8FD8\u662F\u6709\u65F6\u95F4\u5DEE\u7684\uFF0C\u4ECE\u5F00\u53D1\u4EBA\u5458\u6765\u770B\u8FD9\u4E2A\u65F6\u95F4\u5FAE\u4E4E\u5176\u5FAE\uFF0C\u4F46\u662F\u4ECECPU\u7684\u89D2\u5EA6\u6765\u770B\uFF0C\u8FD9\u4E2A\u65F6\u95F4\u5DEE\u5B58\u5728\u7684\u8FD8\u662F\u5F88\u660E\u663E\u7684\u3002\u6240\u4EE5\u975E\u516C\u5E73\u9501\u80FD\u66F4\u5145\u5206\u7684\u5229\u7528CPU \u7684\u65F6\u95F4\u7247\uFF0C\u5C3D\u91CF\u51CF\u5C11 CPU \u7A7A\u95F2\u72B6\u6001\u65F6\u95F4\u3002</li><li>\u4F7F\u7528\u591A\u7EBF\u7A0B\u5F88\u91CD\u8981\u7684\u8003\u91CF\u70B9\u662F\u7EBF\u7A0B\u5207\u6362\u7684\u5F00\u9500\uFF0C\u5F53\u91C7\u7528\u975E\u516C\u5E73\u9501\u65F6\uFF0C\u5F531\u4E2A\u7EBF\u7A0B\u8BF7\u6C42\u9501\u83B7\u53D6\u540C\u6B65\u72B6\u6001\uFF0C\u7136\u540E\u91CA\u653E\u540C\u6B65\u72B6\u6001\uFF0C\u56E0\u4E3A\u4E0D\u9700\u8981\u8003\u8651\u662F\u5426\u8FD8\u6709\u524D\u9A71\u8282\u70B9\uFF0C\u6240\u4EE5\u521A\u91CA\u653E\u9501\u7684\u7EBF\u7A0B\u5728\u6B64\u523B\u518D\u6B21\u83B7\u53D6\u540C\u6B65\u72B6\u6001\u7684\u6982\u7387\u5C31\u53D8\u5F97\u975E\u5E38\u5927\uFF0C\u6240\u4EE5\u5C31\u51CF\u5C11\u4E86\u7EBF\u7A0B\u7684\u5F00\u9500\u3002</li></ol><h4 id="_3\u3001\u4F7F\u7528\u516C\u5E73\u9501\u4F1A\u6709\u4EC0\u4E48\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u4F7F\u7528\u516C\u5E73\u9501\u4F1A\u6709\u4EC0\u4E48\u95EE\u9898" aria-hidden="true">#</a> 3\u3001\u4F7F\u2F64\u516C\u5E73\u9501\u4F1A\u6709\u4EC0\u4E48\u95EE\u9898</h4><p>\u516C\u5E73\u9501\u4FDD\u8BC1\u4E86\u6392\u961F\u7684\u516C\u5E73\u6027\uFF0C\u975E\u516C\u5E73\u9501\u9738\u6C14\u7684\u5FFD\u89C6\u8FD9\u4E2A\u89C4\u5219\uFF0C\u6240\u4EE5\u5C31\u6709\u53EF\u80FD\u5BFC\u81F4\u6392\u961F\u7684\u957F\u65F6\u95F4\u5728\u6392\u961F\uFF0C\u4E5F\u6CA1\u6709\u673A\u4F1A\u83B7\u53D6\u5230\u9501\uFF0C\u8FD9\u5C31\u662F\u4F20\u8BF4\u4E2D\u7684 \u201C\u9501\u9965\u997F\u201D</p><h4 id="_4\u3001\u4EC0\u4E48\u65F6\u5019\u7528\u516C\u5E73-\u4EC0\u4E48\u65F6\u5019\u7528\u975E\u516C\u5E73" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u4EC0\u4E48\u65F6\u5019\u7528\u516C\u5E73-\u4EC0\u4E48\u65F6\u5019\u7528\u975E\u516C\u5E73" aria-hidden="true">#</a> 4\u3001\u4EC0\u4E48\u65F6\u5019\u7528\u516C\u5E73\uFF1F\u4EC0\u4E48\u65F6\u5019\u7528\u975E\u516C\u5E73\uFF1F</h4><p>\u5982\u679C\u4E3A\u4E86\u66F4\u9AD8\u7684\u541E\u5410\u91CF\uFF0C\u5F88\u663E\u7136\u975E\u516C\u5E73\u9501\u662F\u6BD4\u8F83\u5408\u9002\u7684\uFF0C\u56E0\u4E3A\u8282\u7701\u5F88\u591A\u7EBF\u7A0B\u5207\u6362\u65F6\u95F4\uFF0C\u541E\u5410\u91CF\u81EA\u7136\u5C31\u4E0A\u53BB\u4E86\uFF1B\u5426\u5219\u90A3\u5C31\u7528\u516C\u5E73\u9501\uFF0C\u5927\u5BB6\u516C\u5E73\u4F7F\u7528\u3002</p><h3 id="_9\u3001\u53EF\u91CD\u5165\u9501-\u53C8\u540D\u9012\u5F52\u9501" tabindex="-1"><a class="header-anchor" href="#_9\u3001\u53EF\u91CD\u5165\u9501-\u53C8\u540D\u9012\u5F52\u9501" aria-hidden="true">#</a> 9\u3001\u53EF\u91CD\u5165\u9501(\u53C8\u540D\u9012\u5F52\u9501)</h3><p>\u662F\u6307\u5728\u540C\u4E00\u4E2A\u7EBF\u7A0B\u5728\u5916\u5C42\u65B9\u6CD5\u83B7\u53D6\u9501\u7684\u65F6\u5019\uFF0C\u518D\u8FDB\u5165\u8BE5\u7EBF\u7A0B\u7684\u5185\u5C42\u65B9\u6CD5\u4F1A\u81EA\u52A8\u83B7\u53D6\u9501(\u524D\u63D0\uFF0C\u9501\u5BF9\u8C61\u5F97\u662F\u540C\u4E00\u4E2A\u5BF9\u8C61)\uFF0C\u4E0D\u4F1A\u56E0\u4E3A\u4E4B\u524D\u5DF2\u7ECF\u83B7\u53D6\u8FC7\u8FD8\u6CA1\u91CA\u653E\u800C\u963B\u585E\u3002</p><p>\u5982\u679C\u662F1\u4E2A\u6709 synchronized \u4FEE\u9970\u7684\u9012\u5F52\u8C03\u7528\u65B9\u6CD5\uFF0C\u7A0B\u5E8F\u7B2C2\u6B21\u8FDB\u5165\u88AB\u81EA\u5DF1\u963B\u585E\u4E86\u5C82\u4E0D\u662F\u5929\u5927\u7684\u7B11\u8BDD\uFF0C\u51FA\u73B0\u4E86\u4F5C\u8327\u81EA\u7F1A\u3002\u6240\u4EE5Java\u4E2DReentrantLock\u548Csynchronized\u90FD\u662F\u53EF\u91CD\u5165\u9501\uFF0C\u53EF\u91CD\u5165\u9501\u7684\u4E00\u4E2A\u4F18\u70B9\u662F\u53EF\u4E00\u5B9A\u7A0B\u5EA6\u907F\u514D\u6B7B\u9501\u3002</p><h4 id="_1\u3001-\u53EF\u91CD\u5165\u9501-\u8FD9\u56DB\u4E2A\u5B57\u5206\u5F00\u6765\u89E3\u91CA" tabindex="-1"><a class="header-anchor" href="#_1\u3001-\u53EF\u91CD\u5165\u9501-\u8FD9\u56DB\u4E2A\u5B57\u5206\u5F00\u6765\u89E3\u91CA" aria-hidden="true">#</a> 1\u3001\u201C\u53EF\u91CD\u5165\u9501\u201D\u8FD9\u56DB\u4E2A\u5B57\u5206\u5F00\u6765\u89E3\u91CA\uFF1A</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u53EF\uFF1A\u53EF\u4EE5\u3002
\u91CD\uFF1A\u518D\u6B21\u3002
\u5165\uFF1A\u8FDB\u5165\u3002
\u9501\uFF1A\u540C\u6B65\u9501\u3002

\u8FDB\u5165\u4EC0\u4E48:\u8FDB\u5165\u540C\u6B65\u57DF\uFF08\u5373\u540C\u6B65\u4EE3\u7801\u5757/\u65B9\u6CD5\u6216\u663E\u5F0F\u9501\u9501\u5B9A\u7684\u4EE3\u7801\uFF09
\u4E00\u53E5\u8BDD:\u4E00\u4E2A\u7EBF\u7A0B\u4E2D\u7684\u591A\u4E2A\u6D41\u7A0B\u53EF\u4EE5\u83B7\u53D6\u540C\u4E00\u628A\u9501\uFF0C\u6301\u6709\u8FD9\u628A\u540C\u6B65\u9501\u53EF\u4EE5\u518D\u6B21\u8FDB\u5165\u3002
\u81EA\u5DF1\u53EF\u4EE5\u83B7\u53D6\u81EA\u5DF1\u7684\u5185\u90E8\u9501
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2\u3001\u53EF\u91CD\u5165\u9501\u79CD\u7C7B" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u53EF\u91CD\u5165\u9501\u79CD\u7C7B" aria-hidden="true">#</a> 2\u3001\u53EF\u91CD\u5165\u9501\u79CD\u7C7B</h4><h5 id="_1\u3001\u9690\u5F0F\u9501-\u5373synchronized\u5173\u952E\u5B57\u4F7F\u7528\u7684\u9501-\u9ED8\u8BA4\u662F\u53EF\u91CD\u5165\u9501" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u9690\u5F0F\u9501-\u5373synchronized\u5173\u952E\u5B57\u4F7F\u7528\u7684\u9501-\u9ED8\u8BA4\u662F\u53EF\u91CD\u5165\u9501" aria-hidden="true">#</a> 1\u3001\u9690\u5F0F\u9501\uFF08\u5373synchronized\u5173\u952E\u5B57\u4F7F\u7528\u7684\u9501\uFF09\u9ED8\u8BA4\u662F\u53EF\u91CD\u5165\u9501</h5><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u6307\u7684\u662F\u53EF\u91CD\u590D\u53EF\u9012\u5F52\u8C03\u7528\u7684\u9501\uFF0C\u5728\u5916\u5C42\u4F7F\u7528\u9501\u4E4B\u540E\uFF0C\u5728\u5185\u5C42\u4ECD\u7136\u53EF\u4EE5\u4F7F\u7528\uFF0C\u5E76\u4E14\u4E0D\u53D1\u751F\u6B7B\u9501\uFF0C\u8FD9\u6837\u7684\u9501\u5C31\u53EB\u505A\u53EF\u91CD\u5165\u9501\u3002
\u7B80\u5355\u7684\u6765\u8BF4\u5C31\u662F\uFF1A\u5728\u4E00\u4E2Asynchronized\u4FEE\u9970\u7684\u65B9\u6CD5\u6216\u4EE3\u7801\u5757\u7684\u5185\u90E8\u8C03\u7528\u672C\u7C7B\u7684\u5176\u4ED6synchronized\u4FEE\u9970\u7684\u65B9\u6CD5\u6216\u4EE3\u7801\u5757\u65F6\uFF0C\u662F\u6C38\u8FDC\u53EF\u4EE5\u5F97\u5230\u9501\u7684

\u4E0E\u53EF\u91CD\u5165\u9501\u76F8\u53CD\uFF0C\u4E0D\u53EF\u91CD\u5165\u9501\u4E0D\u53EF\u9012\u5F52\u8C03\u7528\uFF0C\u9012\u5F52\u8C03\u7528\u5C31\u53D1\u751F\u6B7B\u9501\u3002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u540C\u6B65\u5757</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReEntryLockDemo</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">Object</span> objectLockA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLockA<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----\u5916\u5C42\u8C03\u7528&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLockA<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----\u4E2D\u5C42\u8C03\u7528&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLockA<span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----\u5185\u5C42\u8C03\u7528&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u540C\u6B65\u65B9\u6CD5</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReEntryLockDemo</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----m1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">m2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">m2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----m2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">m3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">m3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----m3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ReEntryLockDemo</span> reEntryLockDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReEntryLockDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        reEntryLockDemo<span class="token punctuation">.</span><span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2\u3001\u663E\u5F0F\u9501-\u5373lock-\u4E5F\u6709reentrantlock\u8FD9\u6837\u7684\u53EF\u91CD\u5165\u9501\u3002" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u663E\u5F0F\u9501-\u5373lock-\u4E5F\u6709reentrantlock\u8FD9\u6837\u7684\u53EF\u91CD\u5165\u9501\u3002" aria-hidden="true">#</a> 2\u3001\u663E\u5F0F\u9501\uFF08\u5373Lock\uFF09\u4E5F\u6709ReentrantLock\u8FD9\u6837\u7684\u53EF\u91CD\u5165\u9501\u3002</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo4</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            num<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Demo4</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u4EE3\u7801\u4E2Dadd()\u65B9\u6CD5\u4E2D\uFF0C\u5F53\u4E00\u4E2A\u7EBF\u7A0B\u8FDB\u5165\u7684\u65F6\u5019\uFF0C\u4F1A\u6267\u884C2\u6B21\u83B7\u53D6\u9501\u7684\u64CD\u4F5C\uFF0C\u8FD0\u884C\u7A0B\u5E8F\u53EF\u4EE5\u6B63\u5E38\u7ED3\u675F\uFF0C\u5E76\u8F93\u51FA\u548C\u671F\u671B\u503C\u4E00\u6837\u768430000\uFF0C\u5047\u5982ReentrantLock\u662F\u4E0D\u53EF\u91CD\u5165\u7684\u9501\uFF0C\u90A3\u4E48\u540C\u4E00\u4E2A\u7EBF\u7A0B\u7B2C2\u6B21\u83B7\u53D6\u9501\u7684\u65F6\u5019\u7531\u4E8E\u524D\u9762\u7684\u9501\u8FD8\u672A\u91CA\u653E\u800C\u5BFC\u81F4\u6B7B\u9501\uFF0C\u7A0B\u5E8F\u662F\u65E0\u6CD5\u6B63\u5E38\u7ED3\u675F\u7684\u3002ReentrantLock\u547D\u540D\u4E5F\u633A\u597D\u7684Re entrant Lock\uFF0C\u548C\u5176\u540D\u5B57\u4E00\u6837\uFF0C\u53EF\u91CD\u5165\u9501\u3002</p><p>\u4EE3\u7801\u4E2D\u8FD8\u6709\u51E0\u70B9\u9700\u8981\u6CE8\u610F\uFF1A</p><ol><li><strong>lock()\u65B9\u6CD5\u548Cunlock()\u65B9\u6CD5\u9700\u8981\u6210\u5BF9\u51FA\u73B0\uFF0C\u9501\u4E86\u51E0\u6B21\uFF0C\u4E5F\u8981\u91CA\u653E\u51E0\u6B21\uFF0C\u5426\u5219\u540E\u9762\u7684\u7EBF\u7A0B\u65E0\u6CD5\u83B7\u53D6\u9501\u4E86\uFF1B\u53EF\u4EE5\u5C06add\u4E2D\u7684unlock\u5220\u9664\u4E00\u4E2A\u4E8B\u5B9E\uFF0C\u4E0A\u9762\u4EE3\u7801\u8FD0\u884C\u5C06\u65E0\u6CD5\u7ED3\u675F</strong></li><li><strong>unlock()\u65B9\u6CD5\u653E\u5728finally\u4E2D\u6267\u884C\uFF0C\u4FDD\u8BC1\u4E0D\u7BA1\u7A0B\u5E8F\u662F\u5426\u6709\u5F02\u5E38\uFF0C\u9501\u5FC5\u5B9A\u4F1A\u91CA\u653E</strong></li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@create</span> 2020-05-14 11:59
 * \u5728\u4E00\u4E2ASynchronized\u4FEE\u9970\u7684\u65B9\u6CD5\u6216\u4EE3\u7801\u5757\u7684\u5185\u90E8\u8C03\u7528\u672C\u7C7B\u7684\u5176\u4ED6Synchronized\u4FEE\u9970\u7684\u65B9\u6CD5\u6216\u4EE3\u7801\u5757\u65F6\uFF0C\u662F\u6C38\u8FDC\u53EF\u4EE5\u5F97\u5230\u9501\u7684
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReEntryLockDemo</span><span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----\u5916\u5C42\u8C03\u7528lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span>
                <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----\u5185\u5C42\u8C03\u7528lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    <span class="token comment">// \u8FD9\u91CC\u6545\u610F\u6CE8\u91CA\uFF0C\u5B9E\u73B0\u52A0\u9501\u6B21\u6570\u548C\u91CA\u653E\u6B21\u6570\u4E0D\u4E00\u6837</span>
                    <span class="token comment">// \u7531\u4E8E\u52A0\u9501\u6B21\u6570\u548C\u91CA\u653E\u6B21\u6570\u4E0D\u4E00\u6837\uFF0C\u7B2C\u4E8C\u4E2A\u7EBF\u7A0B\u59CB\u7EC8\u65E0\u6CD5\u83B7\u53D6\u5230\u9501\uFF0C\u5BFC\u81F4\u4E00\u76F4\u5728\u7B49\u5F85\u3002</span>
                    lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// \u6B63\u5E38\u60C5\u51B5\uFF0C\u52A0\u9501\u51E0\u6B21\u5C31\u8981\u89E3\u9501\u51E0\u6B21</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;b thread----\u5916\u5C42\u8C03\u7528lock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3\u3001synchronized\u7684\u91CD\u5165\u7684\u5B9E\u73B0\u673A\u7406" tabindex="-1"><a class="header-anchor" href="#_3\u3001synchronized\u7684\u91CD\u5165\u7684\u5B9E\u73B0\u673A\u7406" aria-hidden="true">#</a> 3\u3001Synchronized\u7684\u91CD\u5165\u7684\u5B9E\u73B0\u673A\u7406</h4><p>\u200B \u6BCF\u4E2A\u9501\u5BF9\u8C61\u62E5\u6709\u4E00\u4E2A\u9501\u8BA1\u6570\u5668\u548C\u4E00\u4E2A\u6307\u5411\u6301\u6709\u8BE5\u9501\u7684\u7EBF\u7A0B\u7684\u6307\u9488\u3002</p><p>\u200B \u5F53\u6267\u884Cmonitorenter\u65F6\uFF0C\u5982\u679C\u76EE\u6807\u9501\u5BF9\u8C61\u7684\u8BA1\u6570\u5668\u4E3A\u96F6\uFF0C\u90A3\u4E48\u8BF4\u660E\u5B83\u6CA1\u6709\u88AB\u5176\u4ED6\u7EBF\u7A0B\u6240\u6301\u6709\uFF0CJava\u865A\u62DF\u673A\u4F1A\u5C06\u8BE5\u9501\u5BF9\u8C61\u7684\u6301\u6709\u7EBF\u7A0B\u8BBE\u7F6E\u4E3A\u5F53\u524D\u7EBF\u7A0B\uFF0C\u5E76\u4E14\u5C06\u5176\u8BA1\u6570\u5668\u52A01\u3002</p><p>\u200B \u5728\u76EE\u6807\u9501\u5BF9\u8C61\u7684\u8BA1\u6570\u5668\u4E0D\u4E3A\u96F6\u7684\u60C5\u51B5\u4E0B\uFF0C\u5982\u679C\u9501\u5BF9\u8C61\u7684\u6301\u6709\u7EBF\u7A0B\u662F\u5F53\u524D\u7EBF\u7A0B\uFF0C\u90A3\u4E48 Java \u865A\u62DF\u673A\u53EF\u4EE5\u5C06\u5176\u8BA1\u6570\u5668\u52A01\uFF0C\u5426\u5219\u9700\u8981\u7B49\u5F85\uFF0C\u76F4\u81F3\u6301\u6709\u7EBF\u7A0B\u91CA\u653E\u8BE5\u9501\u3002</p><p>\u200B \u5F53\u6267\u884Cmonitorexit\u65F6\uFF0CJava\u865A\u62DF\u673A\u5219\u9700\u5C06\u9501\u5BF9\u8C61\u7684\u8BA1\u6570\u5668\u51CF1\u3002\u8BA1\u6570\u5668\u4E3A\u96F6\u4EE3\u8868\u9501\u5DF2\u88AB\u91CA\u653E\u3002</p><h3 id="_10\u3001\u6B7B\u9501" tabindex="-1"><a class="header-anchor" href="#_10\u3001\u6B7B\u9501" aria-hidden="true">#</a> 10\u3001\u6B7B\u9501</h3><p>\u200B \u6B7B\u9501\u662F\u6307\u4E24\u4E2A\u6216\u4E24\u4E2A\u4EE5\u4E0A\u7684\u7EBF\u7A0B\u5728\u6267\u884C\u8FC7\u7A0B\u4E2D,\u56E0\u4E89\u593A\u8D44\u6E90\u800C\u9020\u6210\u7684\u4E00\u79CD\u4E92\u76F8\u7B49\u5F85\u7684\u73B0\u8C61,\u82E5\u65E0\u5916\u529B\u5E72\u6D89\u90A3\u5B83\u4EEC\u90FD\u5C06\u65E0\u6CD5\u63A8\u8FDB\u4E0B\u53BB\uFF0C\u5982\u679C\u7CFB\u7EDF\u8D44\u6E90\u5145\u8DB3\uFF0C\u8FDB\u7A0B\u7684\u8D44\u6E90\u8BF7\u6C42\u90FD\u80FD\u591F\u5F97\u5230\u6EE1\u8DB3\uFF0C\u6B7B\u9501\u51FA\u73B0\u7684\u53EF\u80FD\u6027\u5C31\u5F88\u4F4E\uFF0C\u5426\u5219\u5C31\u4F1A\u56E0\u4E89\u593A\u6709\u9650\u7684\u8D44\u6E90\u800C\u9677\u5165\u6B7B\u9501\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/\u56FE\u50CF.png" alt="\u56FE\u50CF"></p><h4 id="_1\u3001\u4EA7\u751F\u6B7B\u9501\u4E3B\u8981\u539F\u56E0" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u4EA7\u751F\u6B7B\u9501\u4E3B\u8981\u539F\u56E0" aria-hidden="true">#</a> 1\u3001\u4EA7\u751F\u6B7B\u9501\u4E3B\u8981\u539F\u56E0</h4><ol><li>\u7CFB\u7EDF\u8D44\u6E90\u4E0D\u8DB3</li><li>\u8FDB\u7A0B\u8FD0\u884C\u63A8\u8FDB\u7684\u987A\u5E8F\u4E0D\u5408\u9002</li><li>\u8D44\u6E90\u5206\u914D\u4E0D\u5F53</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeadLockDemo</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">Object</span> objectLockA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">Object</span> objectLockB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLockA<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;\u81EA\u5DF1\u6301\u6709A\uFF0C\u5E0C\u671B\u83B7\u5F97B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLockB<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;A-------\u5DF2\u7ECF\u83B7\u5F97B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLockB<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;\u81EA\u5DF1\u6301\u6709B\uFF0C\u5E0C\u671B\u83B7\u5F97A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLockA<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;B-------\u5DF2\u7ECF\u83B7\u5F97A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2\u3001\u5982\u4F55\u6392\u67E5\u6B7B\u9501" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5982\u4F55\u6392\u67E5\u6B7B\u9501" aria-hidden="true">#</a> 2\u3001\u5982\u4F55\u6392\u67E5\u6B7B\u9501</h4><ol><li>\u7EAF\u547D\u4EE4</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>jps -l
jstack \u8FDB\u7A0B\u7F16\u53F7
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>\u56FE\u5F62\u5316</li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>jconsole
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="\u4E94\u3001\u7EBF\u7A0B\u95F4\u901A\u4FE1" tabindex="-1"><a class="header-anchor" href="#\u4E94\u3001\u7EBF\u7A0B\u95F4\u901A\u4FE1" aria-hidden="true">#</a> \u4E94\u3001\u7EBF\u7A0B\u95F4\u901A\u4FE1</h2><h3 id="_1\u3001\u9762\u8BD5\u9898-\u4E24\u4E2A\u7EBF\u7A0B\u6253\u5370" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u9762\u8BD5\u9898-\u4E24\u4E2A\u7EBF\u7A0B\u6253\u5370" aria-hidden="true">#</a> 1\u3001\u9762\u8BD5\u9898\uFF1A\u4E24\u4E2A\u7EBF\u7A0B\u6253\u5370</h3><p>\u4E24\u4E2A\u7EBF\u7A0B\uFF0C\u4E00\u4E2A\u7EBF\u7A0B\u6253\u53701-52\uFF0C\u53E6\u4E00\u4E2A\u6253\u5370\u5B57\u6BCDA-Z\u6253\u5370\u987A\u5E8F\u4E3A12A34B...5152Z</p><h4 id="_1\u3001synchronized\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_1\u3001synchronized\u5B9E\u73B0" aria-hidden="true">#</a> 1\u3001synchronized\u5B9E\u73B0</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xue<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">Condition</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">Lock</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span></span><span class="token punctuation">;</span>
 
 
 
<span class="token keyword">class</span> <span class="token class-name">ShareDataOne</span><span class="token comment">//\u8D44\u6E90\u7C7B{</span>
  <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//\u521D\u59CB\u503C\u4E3A\u96F6\u7684\u4E00\u4E2A\u53D8\u91CF</span>
 
  <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
     <span class="token comment">//1\u5224\u65AD</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span>number <span class="token operator">!=</span><span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">//2\u5E72\u6D3B</span>
     <span class="token operator">++</span>number<span class="token punctuation">;</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">//3\u901A\u77E5</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
     <span class="token comment">// 1\u5224\u65AD</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>number <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">// 2\u5E72\u6D3B</span>
     <span class="token operator">--</span>number<span class="token punctuation">;</span>
     <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// 3\u901A\u77E5</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token doc-comment comment">/**
 * 
 * @Description:
 *\u73B0\u5728\u4E24\u4E2A\u7EBF\u7A0B\uFF0C
 * \u53EF\u4EE5\u64CD\u4F5C\u521D\u59CB\u503C\u4E3A\u96F6\u7684\u4E00\u4E2A\u53D8\u91CF\uFF0C
 * \u5B9E\u73B0\u4E00\u4E2A\u7EBF\u7A0B\u5BF9\u8BE5\u53D8\u91CF\u52A01\uFF0C\u4E00\u4E2A\u7EBF\u7A0B\u5BF9\u8BE5\u53D8\u91CF\u51CF1\uFF0C
 * \u4EA4\u66FF\uFF0C\u676510\u8F6E\u3002 
 * <span class="token keyword">@author</span> xialei
 *
 *  * \u7B14\u8BB0\uFF1AJava\u91CC\u9762\u5982\u4F55\u8FDB\u884C\u5DE5\u7A0B\u7EA7\u522B\u7684\u591A\u7EBF\u7A0B\u7F16\u5199
 * 1 \u591A\u7EBF\u7A0B\u53D8\u6210\u6A21\u677F\uFF08\u5957\u8DEF\uFF09-----\u4E0A
 *     1.1  \u7EBF\u7A0B    \u64CD\u4F5C    \u8D44\u6E90\u7C7B  
 *     1.2  \u9AD8\u5185\u805A  \u4F4E\u8026\u5408
 * 2 \u591A\u7EBF\u7A0B\u53D8\u6210\u6A21\u677F\uFF08\u5957\u8DEF\uFF09-----\u4E0B
 *     2.1  \u5224\u65AD
 *     2.2  \u5E72\u6D3B
 *     2.3  \u901A\u77E5
 
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NotifyWaitDemoOne</span><span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token class-name">ShareDataOne</span> sd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShareDataOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            sd<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// TODO Auto-generated catch block</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            sd<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// TODO Auto-generated catch block</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
 * * 
 * 2 \u591A\u7EBF\u7A0B\u53D8\u6210\u6A21\u677F\uFF08\u5957\u8DEF\uFF09-----\u4E0B
 *     2.1  \u5224\u65AD
 *     2.2  \u5E72\u6D3B
 *     2.3  \u901A\u77E5
 * 3 \u9632\u6B62\u865A\u5047\u5524\u9192\u7528while
 * 
 * 
 * */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2\u3001\u6362\u62104\u4E2A\u7EBF\u7A0B" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u6362\u62104\u4E2A\u7EBF\u7A0B" aria-hidden="true">#</a> 2\u3001\u6362\u62104\u4E2A\u7EBF\u7A0B</h4><p>\u200B \u6362\u62104\u4E2A\u7EBF\u7A0B\u4F1A\u5BFC\u81F4\u9519\u8BEF\uFF0C\u865A\u5047\u5524\u9192</p><p>\u200B \u539F\u56E0\uFF1A\u5728java\u591A\u7EBF\u7A0B\u5224\u65AD\u65F6\uFF0C\u4E0D\u80FD\u7528if\uFF0C\u7A0B\u5E8F\u51FA\u4E8B\u51FA\u5728\u4E86\u5224\u65AD\u4E0A\u9762\uFF0C</p><p>\u7A81\u7136\u6709\u4E00\u6DFB\u52A0\u7684\u7EBF\u7A0B\u8FDB\u5230if\u4E86\uFF0C\u7A81\u7136\u4E2D\u65AD\u4E86\u4EA4\u51FA\u63A7\u5236\u6743\uFF0C</p><p>\u6CA1\u6709\u8FDB\u884C\u9A8C\u8BC1\uFF0C\u800C\u662F\u76F4\u63A5\u8D70\u4E0B\u53BB\u4E86\uFF0C\u52A0\u4E86\u4E24\u6B21\uFF0C\u751A\u81F3\u591A\u6B21</p><h4 id="_3\u30014\u4E2A\u7EBF\u7A0B\u89E3\u51B3\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#_3\u30014\u4E2A\u7EBF\u7A0B\u89E3\u51B3\u65B9\u6848" aria-hidden="true">#</a> 3\u30014\u4E2A\u7EBF\u7A0B\u89E3\u51B3\u65B9\u6848</h4><p>\u89E3\u51B3\u865A\u5047\u5524\u9192\uFF1A\u67E5\u770BAPI\uFF0Cjava.lang.Object</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161426163-57912cc0-5b3e-4851-93f4-6d7c4c97118b.png" alt="image"></p><p>\u4E2D\u65AD\u548C\u865A\u5047\u5524\u9192\u662F\u53EF\u80FD\u4EA7\u751F\u7684\uFF0C\u6240\u4EE5\u8981\u7528loop\u5FAA\u73AF\uFF0Cif\u53EA\u5224\u65AD\u4E00\u6B21\uFF0Cwhile\u662F\u53EA\u8981\u5524\u9192\u5C31\u8981\u62C9\u56DE\u6765\u518D\u5224\u65AD\u4E00\u6B21\u3002if\u6362\u6210while</p><h4 id="_4\u3001java8\u65B0\u7248\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_4\u3001java8\u65B0\u7248\u5B9E\u73B0" aria-hidden="true">#</a> 4\u3001java8\u65B0\u7248\u5B9E\u73B0</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161433565-2c36af0b-fd95-455c-a4a3-7e3bcff3c86b.png" alt="image"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">BoundedBuffer</span> <span class="token punctuation">{</span>
   <span class="token keyword">final</span> <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">final</span> <span class="token class-name">Condition</span> notFull  <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   <span class="token keyword">final</span> <span class="token class-name">Condition</span> notEmpty <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
 
   <span class="token keyword">final</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span> putptr<span class="token punctuation">,</span> takeptr<span class="token punctuation">,</span> count<span class="token punctuation">;</span>
 
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Object</span> x<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
     lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">try</span> <span class="token punctuation">{</span>
       <span class="token keyword">while</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> items<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
         notFull<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       items<span class="token punctuation">[</span>putptr<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>putptr <span class="token operator">==</span> items<span class="token punctuation">.</span>length<span class="token punctuation">)</span> putptr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
       <span class="token operator">++</span>count<span class="token punctuation">;</span>
       notEmpty<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
       lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xue<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">Condition</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">Lock</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span></span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>omg<span class="token punctuation">.</span></span><span class="token class-name">IOP</span><span class="token punctuation">.</span><span class="token class-name">Codec</span></span><span class="token punctuation">;</span>
 
 
<span class="token keyword">class</span> <span class="token class-name">ShareData</span><span class="token comment">//\u8D44\u6E90\u7C7B</span>
<span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//\u521D\u59CB\u503C\u4E3A\u96F6\u7684\u4E00\u4E2A\u53D8\u91CF</span>
 
  <span class="token keyword">private</span> <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Condition</span> condition  <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
   
  <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> 
  <span class="token punctuation">{</span>
     
      lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token comment">//\u5224\u65AD</span>
          <span class="token keyword">while</span><span class="token punctuation">(</span>number<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            condition<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token comment">//\u5E72\u6D3B</span>
          <span class="token operator">++</span>number<span class="token punctuation">;</span>
          <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; \\t &quot;</span><span class="token operator">+</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">//\u901A\u77E5</span>
          condition<span class="token punctuation">.</span><span class="token function">signalAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
       lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     
  <span class="token punctuation">}</span>
  
  
  <span class="token keyword">public</span>  <span class="token keyword">void</span> <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> 
  <span class="token punctuation">{</span>
      
      lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token comment">//\u5224\u65AD</span>
          <span class="token keyword">while</span><span class="token punctuation">(</span>number<span class="token operator">!=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            condition<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token comment">//\u5E72\u6D3B</span>
          <span class="token operator">--</span>number<span class="token punctuation">;</span>
          <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; \\t &quot;</span><span class="token operator">+</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">//\u901A\u77E5</span>
          condition<span class="token punctuation">.</span><span class="token function">signalAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
       lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     
  <span class="token punctuation">}</span>
  
  <span class="token comment">/*public synchronized void increment() throws InterruptedException 
  {
     //\u5224\u65AD
     while(number!=0) {
       this.wait();
     }
     //\u5E72\u6D3B
     ++number;
     System.out.println(Thread.currentThread().getName()+&quot; \\t &quot;+number);
     //\u901A\u77E5
     this.notifyAll();;
  }
  
  public synchronized void decrement() throws InterruptedException 
  {
     //\u5224\u65AD
     while(number!=1) {
       this.wait();
     }
     //\u5E72\u6D3B
     --number;
     System.out.println(Thread.currentThread().getName()+&quot; \\t &quot;+number);
     //\u901A\u77E5
     this.notifyAll();
  }*/</span>
<span class="token punctuation">}</span>
 
<span class="token doc-comment comment">/**
 * 
 * @Description:
 *\u73B0\u5728\u4E24\u4E2A\u7EBF\u7A0B\uFF0C
 * \u53EF\u4EE5\u64CD\u4F5C\u521D\u59CB\u503C\u4E3A\u96F6\u7684\u4E00\u4E2A\u53D8\u91CF\uFF0C
 * \u5B9E\u73B0\u4E00\u4E2A\u7EBF\u7A0B\u5BF9\u8BE5\u53D8\u91CF\u52A01\uFF0C\u4E00\u4E2A\u7EBF\u7A0B\u5BF9\u8BE5\u53D8\u91CF\u51CF1\uFF0C
 * \u4EA4\u66FF\uFF0C\u676510\u8F6E\u3002 
 *
 *  * \u7B14\u8BB0\uFF1AJava\u91CC\u9762\u5982\u4F55\u8FDB\u884C\u5DE5\u7A0B\u7EA7\u522B\u7684\u591A\u7EBF\u7A0B\u7F16\u5199
 * 1 \u591A\u7EBF\u7A0B\u53D8\u6210\u6A21\u677F\uFF08\u5957\u8DEF\uFF09-----\u4E0A
 *     1.1  \u7EBF\u7A0B    \u64CD\u4F5C    \u8D44\u6E90\u7C7B  
 *     1.2  \u9AD8\u5185\u805A  \u4F4E\u8026\u5408
 * 2 \u591A\u7EBF\u7A0B\u53D8\u6210\u6A21\u677F\uFF08\u5957\u8DEF\uFF09-----\u4E0B
 *     2.1  \u5224\u65AD
 *     2.2  \u5E72\u6D3B
 *     2.3  \u901A\u77E5
 
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NotifyWaitDemo</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
     <span class="token class-name">ShareData</span> sd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShareData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
 
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            sd<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     
     <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
 
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            sd<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
 
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            sd<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
 
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            sd<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
 * * 
 * 2 \u591A\u7EBF\u7A0B\u53D8\u6210\u6A21\u677F\uFF08\u5957\u8DEF\uFF09-----\u4E0B
 *     2.1  \u5224\u65AD
 *     2.2  \u5E72\u6D3B
 *     2.3  \u901A\u77E5
 * 3 \u9632\u6B62\u865A\u5047\u5524\u9192\u7528while
 * 
 * 
 * */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2\u3001\u7EBF\u7A0B\u95F4\u5B9A\u5236\u5316\u8C03\u7528\u901A\u4FE1" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u7EBF\u7A0B\u95F4\u5B9A\u5236\u5316\u8C03\u7528\u901A\u4FE1" aria-hidden="true">#</a> 2\u3001\u7EBF\u7A0B\u95F4\u5B9A\u5236\u5316\u8C03\u7528\u901A\u4FE1</h3><p>1\u3001\u6709\u987A\u5E8F\u901A\u77E5\uFF0C\u9700\u8981\u6709\u6807\u8BC6\u4F4D</p><p>2\u3001\u6709\u4E00\u4E2A\u9501Lock\uFF0C3\u628A\u94A5\u5319Condition</p><p>3\u3001\u5224\u65AD\u6807\u5FD7\u4F4D</p><p>4\u3001\u8F93\u51FA\u7EBF\u7A0B\u540D+\u7B2C\u51E0\u6B21+\u7B2C\u51E0\u8F6E</p><p>5\u3001\u4FEE\u6539\u6807\u5FD7\u4F4D\uFF0C\u901A\u77E5\u4E0B\u4E00\u4E2A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xue<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">Condition</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">Lock</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span><span class="token class-name">ReentrantLock</span></span><span class="token punctuation">;</span>
 
 
<span class="token keyword">class</span> <span class="token class-name">ShareResource</span>
<span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//1:A 2:B 3:C </span>
  <span class="token keyword">private</span> <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Condition</span> c1 <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Condition</span> c2 <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> <span class="token class-name">Condition</span> c3 <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print5</span><span class="token punctuation">(</span><span class="token keyword">int</span> totalLoopNumber<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
     lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">try</span> 
     <span class="token punctuation">{</span>
       <span class="token comment">//1 \u5224\u65AD</span>
       <span class="token keyword">while</span><span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
          <span class="token comment">//A \u5C31\u8981\u505C\u6B62</span>
          c1<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token comment">//2 \u5E72\u6D3B</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
       <span class="token punctuation">{</span>
          <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>i<span class="token operator">+</span><span class="token string">&quot;\\t totalLoopNumber: &quot;</span><span class="token operator">+</span>totalLoopNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token comment">//3 \u901A\u77E5</span>
       number <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
       c2<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
       lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print10</span><span class="token punctuation">(</span><span class="token keyword">int</span> totalLoopNumber<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
     lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">try</span> 
     <span class="token punctuation">{</span>
       <span class="token comment">//1 \u5224\u65AD</span>
       <span class="token keyword">while</span><span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
          <span class="token comment">//A \u5C31\u8981\u505C\u6B62</span>
          c2<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token comment">//2 \u5E72\u6D3B</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
       <span class="token punctuation">{</span>
          <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>i<span class="token operator">+</span><span class="token string">&quot;\\t totalLoopNumber: &quot;</span><span class="token operator">+</span>totalLoopNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token comment">//3 \u901A\u77E5</span>
       number <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
       c3<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
       lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>  
  
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print15</span><span class="token punctuation">(</span><span class="token keyword">int</span> totalLoopNumber<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
     lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">try</span> 
     <span class="token punctuation">{</span>
       <span class="token comment">//1 \u5224\u65AD</span>
       <span class="token keyword">while</span><span class="token punctuation">(</span>number <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">)</span>
       <span class="token punctuation">{</span>
          <span class="token comment">//A \u5C31\u8981\u505C\u6B62</span>
          c3<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token comment">//2 \u5E72\u6D3B</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">15</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
       <span class="token punctuation">{</span>
          <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>i<span class="token operator">+</span><span class="token string">&quot;\\t totalLoopNumber: &quot;</span><span class="token operator">+</span>totalLoopNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token comment">//3 \u901A\u77E5</span>
       number <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
       c1<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
       lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
 
 
<span class="token doc-comment comment">/**
 * 
 * @Description: 
 * \u591A\u7EBF\u7A0B\u4E4B\u95F4\u6309\u987A\u5E8F\u8C03\u7528\uFF0C\u5B9E\u73B0A-&gt;B-&gt;C
 * \u4E09\u4E2A\u7EBF\u7A0B\u542F\u52A8\uFF0C\u8981\u6C42\u5982\u4E0B\uFF1A
 * 
 * AA\u6253\u53705\u6B21\uFF0CBB\u6253\u537010\u6B21\uFF0CCC\u6253\u537015\u6B21
 * \u63A5\u7740
 * AA\u6253\u53705\u6B21\uFF0CBB\u6253\u537010\u6B21\uFF0CCC\u6253\u537015\u6B21
 * ......\u676510\u8F6E  
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadOrderAccess</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
     <span class="token class-name">ShareResource</span> sr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShareResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     
     <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
       <span class="token punctuation">{</span>
          sr<span class="token punctuation">.</span><span class="token function">print5</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;AA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
       <span class="token punctuation">{</span>
          sr<span class="token punctuation">.</span><span class="token function">print10</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;BB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
       <span class="token punctuation">{</span>
          sr<span class="token punctuation">.</span><span class="token function">print15</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;CC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u516D\u3001locksupport\u4E0E\u7EBF\u7A0B\u4E2D\u65AD" tabindex="-1"><a class="header-anchor" href="#\u516D\u3001locksupport\u4E0E\u7EBF\u7A0B\u4E2D\u65AD" aria-hidden="true">#</a> \u516D\u3001LockSupport\u4E0E\u7EBF\u7A0B\u4E2D\u65AD</h2><h3 id="_1\u3001\u7EBF\u7A0B\u4E2D\u65AD\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u7EBF\u7A0B\u4E2D\u65AD\u673A\u5236" aria-hidden="true">#</a> 1\u3001\u7EBF\u7A0B\u4E2D\u65AD\u673A\u5236</h3><h5 id="_1\u3001\u5982\u4F55\u505C\u6B62\u3001\u4E2D\u65AD\u4E00\u4E2A\u8FD0\u884C\u4E2D\u7684\u7EBF\u7A0B" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5982\u4F55\u505C\u6B62\u3001\u4E2D\u65AD\u4E00\u4E2A\u8FD0\u884C\u4E2D\u7684\u7EBF\u7A0B" aria-hidden="true">#</a> 1\u3001\u5982\u4F55\u505C\u6B62\u3001\u4E2D\u65AD\u4E00\u4E2A\u8FD0\u884C\u4E2D\u7684\u7EBF\u7A0B\uFF1F\uFF1F</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/fdsfsdf.png" alt="fdsfsdf"></p><h5 id="_2\u3001\u4EC0\u4E48\u662F\u4E2D\u65AD" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u4EC0\u4E48\u662F\u4E2D\u65AD" aria-hidden="true">#</a> 2\u3001\u4EC0\u4E48\u662F\u4E2D\u65AD\uFF1F</h5><p>\u9996\u5148 \u4E00\u4E2A\u7EBF\u7A0B\u4E0D\u5E94\u8BE5\u7531\u5176\u4ED6\u7EBF\u7A0B\u6765\u5F3A\u5236\u4E2D\u65AD\u6216\u505C\u6B62\uFF0C\u800C\u662F\u5E94\u8BE5\u7531\u7EBF\u7A0B\u81EA\u5DF1\u81EA\u884C\u505C\u6B62\u3002\u6240\u4EE5\uFF0CThread.stop, Thread.suspend, Thread.resume \u90FD\u5DF2\u7ECF\u88AB\u5E9F\u5F03\u4E86\u3002</p><p>\u5176\u6B21 \u5728Java\u4E2D\u6CA1\u6709\u529E\u6CD5\u7ACB\u5373\u505C\u6B62\u4E00\u6761\u7EBF\u7A0B\uFF0C\u7136\u800C\u505C\u6B62\u7EBF\u7A0B\u5374\u663E\u5F97\u5C24\u4E3A\u91CD\u8981\uFF0C\u5982\u53D6\u6D88\u4E00\u4E2A\u8017\u65F6\u64CD\u4F5C\u3002\u56E0\u6B64\uFF0CJava\u63D0\u4F9B\u4E86\u4E00\u79CD\u7528\u4E8E\u505C\u6B62\u7EBF\u7A0B\u7684\u673A\u5236\u2014\u2014\u4E2D\u65AD\u3002</p><p>\u200B \u4E2D\u65AD\u53EA\u662F\u4E00\u79CD\u534F\u4F5C\u673A\u5236\uFF0CJava\u6CA1\u6709\u7ED9\u4E2D\u65AD\u589E\u52A0\u4EFB\u4F55\u8BED\u6CD5\uFF0C\u4E2D\u65AD\u7684\u8FC7\u7A0B\u5B8C\u5168\u9700\u8981\u7A0B\u5E8F\u5458\u81EA\u5DF1\u5B9E\u73B0\u3002\u82E5\u8981\u4E2D\u65AD\u4E00\u4E2A\u7EBF\u7A0B\uFF0C\u4F60\u9700\u8981\u624B\u52A8\u8C03\u7528\u8BE5\u7EBF\u7A0B\u7684interrupt\u65B9\u6CD5\uFF0C\u8BE5\u65B9\u6CD5\u4E5F\u4EC5\u4EC5\u662F\u5C06\u7EBF\u7A0B\u5BF9\u8C61\u7684\u4E2D\u65AD\u6807\u8BC6\u8BBE\u6210true\uFF1B\u63A5\u7740\u4F60\u9700\u8981\u81EA\u5DF1\u5199\u4EE3\u7801\u4E0D\u65AD\u5730\u68C0\u6D4B\u5F53\u524D\u7EBF\u7A0B\u7684\u6807\u8BC6\u4F4D\uFF0C\u5982\u679C\u4E3Atrue\uFF0C\u8868\u793A\u522B\u7684\u7EBF\u7A0B\u8981\u6C42\u8FD9\u6761\u7EBF\u7A0B\u4E2D\u65AD\uFF0C \u6B64\u65F6\u7A76\u7ADF\u8BE5\u505A\u4EC0\u4E48\u9700\u8981\u4F60\u81EA\u5DF1\u5199\u4EE3\u7801\u5B9E\u73B0\u3002</p><p>\u200B \u6BCF\u4E2A\u7EBF\u7A0B\u5BF9\u8C61\u4E2D\u90FD\u6709\u4E00\u4E2A\u6807\u8BC6\uFF0C\u7528\u4E8E\u8868\u793A\u7EBF\u7A0B\u662F\u5426\u88AB\u4E2D\u65AD\uFF1B\u8BE5\u6807\u8BC6\u4F4D\u4E3Atrue\u8868\u793A\u4E2D\u65AD\uFF0C\u4E3Afalse\u8868\u793A\u672A\u4E2D\u65AD\uFF1B\u901A\u8FC7\u8C03\u7528\u7EBF\u7A0B\u5BF9\u8C61\u7684interrupt\u65B9\u6CD5\u5C06\u8BE5\u7EBF\u7A0B\u7684\u6807\u8BC6\u4F4D\u8BBE\u4E3Atrue\uFF1B\u53EF\u4EE5\u5728\u522B\u7684\u7EBF\u7A0B\u4E2D\u8C03\u7528\uFF0C\u4E5F\u53EF\u4EE5\u5728\u81EA\u5DF1\u7684\u7EBF\u7A0B\u4E2D\u8C03\u7528</p><h5 id="_3\u3001\u4E2D\u65AD\u7684\u76F8\u5173api\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u4E2D\u65AD\u7684\u76F8\u5173api\u65B9\u6CD5" aria-hidden="true">#</a> 3\u3001\u4E2D\u65AD\u7684\u76F8\u5173API\u65B9\u6CD5</h5><table><thead><tr><th>public void interrupt()</th><th>\u5B9E\u4F8B\u65B9\u6CD5\uFF0C<br>\u5B9E\u4F8B\u65B9\u6CD5interrupt()\u4EC5\u4EC5\u662F\u8BBE\u7F6E\u7EBF\u7A0B\u7684\u4E2D\u65AD\u72B6\u6001\u4E3Atrue\uFF0C\u4E0D\u4F1A\u505C\u6B62\u7EBF\u7A0B</th></tr></thead><tbody><tr><td>public static boolean interrupted()</td><td>\u9759\u6001\u65B9\u6CD5\uFF0CThread.interrupted(); <br>\u5224\u65AD\u7EBF\u7A0B\u662F\u5426\u88AB\u4E2D\u65AD\uFF0C\u5E76\u6E05\u9664\u5F53\u524D\u4E2D\u65AD\u72B6\u6001<br>\u8FD9\u4E2A\u65B9\u6CD5\u505A\u4E86\u4E24\u4EF6\u4E8B\uFF1A<br>1 \u8FD4\u56DE\u5F53\u524D\u7EBF\u7A0B\u7684\u4E2D\u65AD\u72B6\u6001<br>2 \u5C06\u5F53\u524D\u7EBF\u7A0B\u7684\u4E2D\u65AD\u72B6\u6001\u8BBE\u4E3Afalse<br> <br>\u8FD9\u4E2A\u65B9\u6CD5\u6709\u70B9\u4E0D\u597D\u7406\u89E3\uFF0C\u56E0\u4E3A\u8FDE\u7EED\u8C03\u7528\u4E24\u6B21\u7684\u7ED3\u679C\u53EF\u80FD\u4E0D\u4E00\u6837\u3002</td></tr><tr><td>public boolean isInterrupted()</td><td>\u5B9E\u4F8B\u65B9\u6CD5\uFF0C<br>\u5224\u65AD\u5F53\u524D\u7EBF\u7A0B\u662F\u5426\u88AB\u4E2D\u65AD\uFF08\u901A\u8FC7\u68C0\u67E5\u4E2D\u65AD\u6807\u5FD7\u4F4D\uFF09</td></tr></tbody></table><h3 id="_2\u3001\u5982\u4F55\u4F7F\u7528\u4E2D\u65AD\u6807\u8BC6\u505C\u6B62\u7EBF\u7A0B" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5982\u4F55\u4F7F\u7528\u4E2D\u65AD\u6807\u8BC6\u505C\u6B62\u7EBF\u7A0B" aria-hidden="true">#</a> 2\u3001\u5982\u4F55\u4F7F\u7528\u4E2D\u65AD\u6807\u8BC6\u505C\u6B62\u7EBF\u7A0B\uFF1F</h3><p>\u5728\u9700\u8981\u4E2D\u65AD\u7684\u7EBF\u7A0B\u4E2D\u4E0D\u65AD\u76D1\u542C\u4E2D\u65AD\u72B6\u6001\uFF0C\u4E00\u65E6\u53D1\u751F\u4E2D\u65AD\uFF0C\u5C31\u6267\u884C\u76F8\u5E94\u7684\u4E2D\u65AD\u5904\u7406\u4E1A\u52A1\u903B\u8F91\u3002</p><h4 id="_1\u3001\u901A\u8FC7\u4E00\u4E2Avolatile\u53D8\u91CF\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u901A\u8FC7\u4E00\u4E2Avolatile\u53D8\u91CF\u5B9E\u73B0" aria-hidden="true">#</a> 1\u3001\u901A\u8FC7\u4E00\u4E2Avolatile\u53D8\u91CF\u5B9E\u73B0</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InterruptDemo</span><span class="token punctuation">{</span>
    
	<span class="token keyword">public</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> exit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u5FAA\u73AF\u5904\u7406\u4E1A\u52A1</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>exit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        exit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE3\u7801\u4E2D\u542F\u52A8\u4E86\u4E00\u4E2A\u7EBF\u7A0B\uFF0C\u7EBF\u7A0B\u7684run\u65B9\u6CD5\u4E2D\u6709\u4E2A\u6B7B\u5FAA\u73AF\uFF0C\u5185\u90E8\u901A\u8FC7exit\u53D8\u91CF\u7684\u503C\u6765\u63A7\u5236\u662F\u5426\u9000\u51FA\u3002<code>TimeUnit.SECONDS.sleep(3);</code>\u8BA9\u4E3B\u7EBF\u7A0B\u4F11\u77203\u79D2\uFF0C\u6B64\u5904\u4E3A\u4EC0\u4E48\u4F7F\u7528TimeUnit\uFF1FTimeUnit\u4F7F\u7528\u66F4\u65B9\u4FBF\u4E00\u4E9B\uFF0C\u80FD\u591F\u5F88\u6E05\u6670\u7684\u63A7\u5236\u4F11\u7720\u65F6\u95F4\uFF0C\u5E95\u5C42\u8FD8\u662F\u8F6C\u6362\u4E3AThread.sleep\u5B9E\u73B0\u7684\u3002\u7A0B\u5E8F\u6709\u4E2A\u91CD\u70B9\uFF1A<strong>volatile</strong>\u5173\u952E\u5B57\uFF0Cexit\u53D8\u91CF\u5FC5\u987B\u901A\u8FC7\u8FD9\u4E2A\u4FEE\u9970\uFF0C\u5982\u679C\u628A\u8FD9\u4E2A\u53BB\u6389\uFF0C\u7A0B\u5E8F\u65E0\u6CD5\u6B63\u5E38\u9000\u51FA\u3002volatile\u63A7\u5236\u4E86\u53D8\u91CF\u5728\u591A\u7EBF\u7A0B\u4E2D\u7684\u53EF\u89C1\u6027\u3002</p><h4 id="_2\u3001\u901A\u8FC7atomicboolean" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u901A\u8FC7atomicboolean" aria-hidden="true">#</a> 2\u3001\u901A\u8FC7AtomicBoolean</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StopThreadDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">AtomicBoolean</span> atomicBoolean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicBoolean</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>atomicBoolean<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        atomicBoolean<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3\u3001\u901A\u8FC7thread\u7C7B\u81EA\u5E26\u7684\u4E2D\u65ADapi\u65B9\u6CD5\u5B9E\u73B0" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u901A\u8FC7thread\u7C7B\u81EA\u5E26\u7684\u4E2D\u65ADapi\u65B9\u6CD5\u5B9E\u73B0" aria-hidden="true">#</a> 3\u3001\u901A\u8FC7Thread\u7C7B\u81EA\u5E26\u7684\u4E2D\u65ADapi\u65B9\u6CD5\u5B9E\u73B0</h4><ol><li>\u5B9E\u4F8B\u65B9\u6CD5interrupt()\uFF0C\u6CA1\u6709\u8FD4\u56DE\u503C</li></ol><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916231409508.png" alt="image-20210916231409508"></p><table><thead><tr><th>public void interrupt()</th><th>\u5B9E\u4F8B\u65B9\u6CD5\uFF0C<br>\u8C03\u7528interrupt()\u65B9\u6CD5\u4EC5\u4EC5\u662F\u5728\u5F53\u524D\u7EBF\u7A0B\u4E2D\u6253\u4E86\u4E00\u4E2A\u505C\u6B62\u7684\u6807\u8BB0\uFF0C\u5E76\u4E0D\u662F\u771F\u6B63\u7ACB\u523B\u505C\u6B62\u7EBF\u7A0B\u3002</th></tr></thead></table><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/vcxvdfgsdgdg.png" alt="vcxvdfgsdgdg"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916231506817.png" alt="image-20210916231506817"></p><ol start="2"><li>\u5B9E\u4F8B\u65B9\u6CD5isInterrupted\uFF0C\u8FD4\u56DE\u5E03\u5C14\u503C</li></ol><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916231603313.png" alt="image-20210916231603313"></p><table><thead><tr><th>public boolean isInterrupted()</th><th>\u5B9E\u4F8B\u65B9\u6CD5\uFF0C<br>\u83B7\u53D6\u4E2D\u65AD\u6807\u5FD7\u4F4D\u7684\u5F53\u524D\u503C\u662F\u4EC0\u4E48\uFF0C<br>\u5224\u65AD\u5F53\u524D\u7EBF\u7A0B\u662F\u5426\u88AB\u4E2D\u65AD\uFF08\u901A\u8FC7\u68C0\u67E5\u4E2D\u65AD\u6807\u5FD7\u4F4D\uFF09\uFF0C\u9ED8\u8BA4\u662Ffalse</th></tr></thead></table><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916231626044.png" alt="image-20210916231626044"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InterruptDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----t1 \u7EBF\u7A0B\u88AB\u4E2D\u65AD\u4E86\uFF0Cbreak\uFF0C\u7A0B\u5E8F\u7ED3\u675F&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;**************&quot;</span><span class="token operator">+</span>t1<span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u6682\u505C5\u6BEB\u79D2</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        t1<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;**************&quot;</span><span class="token operator">+</span>t1<span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD0\u884C\u4E0A\u9762\u7684\u7A0B\u5E8F\uFF0C\u7A0B\u5E8F\u53EF\u4EE5\u6B63\u5E38\u7ED3\u675F\u3002\u7EBF\u7A0B\u5185\u90E8\u6709\u4E2A\u4E2D\u65AD\u6807\u5FD7\uFF0C\u5F53\u8C03\u7528\u7EBF\u7A0B\u7684interrupt()\u5B9E\u4F8B\u65B9\u6CD5\u4E4B\u540E\uFF0C\u7EBF\u7A0B\u7684\u4E2D\u65AD\u6807\u5FD7\u4F1A\u88AB\u7F6E\u4E3Atrue\uFF0C\u53EF\u4EE5\u901A\u8FC7\u7EBF\u7A0B\u7684\u5B9E\u4F8B\u65B9\u6CD5isInterrupted()\u83B7\u53D6\u7EBF\u7A0B\u7684\u4E2D\u65AD\u6807\u5FD7\u3002</p><h4 id="_4\u3001\u5F53\u524D\u7EBF\u7A0B\u7684\u4E2D\u65AD\u6807\u8BC6\u4E3Atrue-\u662F\u4E0D\u662F\u5C31\u7ACB\u523B\u505C\u6B62" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u5F53\u524D\u7EBF\u7A0B\u7684\u4E2D\u65AD\u6807\u8BC6\u4E3Atrue-\u662F\u4E0D\u662F\u5C31\u7ACB\u523B\u505C\u6B62" aria-hidden="true">#</a> 4\u3001\u5F53\u524D\u7EBF\u7A0B\u7684\u4E2D\u65AD\u6807\u8BC6\u4E3Atrue\uFF0C\u662F\u4E0D\u662F\u5C31\u7ACB\u523B\u505C\u6B62\uFF1F</h4><p>\u5177\u4F53\u6765\u8BF4\uFF0C\u5F53\u5BF9\u4E00\u4E2A\u7EBF\u7A0B\uFF0C\u8C03\u7528 interrupt() \u65F6\uFF1A</p><p>\u2460 \u5982\u679C\u7EBF\u7A0B\u5904\u4E8E\u6B63\u5E38\u6D3B\u52A8\u72B6\u6001\uFF0C\u90A3\u4E48\u4F1A\u5C06\u8BE5\u7EBF\u7A0B\u7684\u4E2D\u65AD\u6807\u5FD7\u8BBE\u7F6E\u4E3A true\uFF0C\u4EC5\u6B64\u800C\u5DF2\u3002 \u88AB\u8BBE\u7F6E\u4E2D\u65AD\u6807\u5FD7\u7684\u7EBF\u7A0B\u5C06\u7EE7\u7EED\u6B63\u5E38\u8FD0\u884C\uFF0C\u4E0D\u53D7\u5F71\u54CD\u3002\u6240\u4EE5\uFF0C interrupt() \u5E76\u4E0D\u80FD\u771F\u6B63\u7684\u4E2D\u65AD\u7EBF\u7A0B\uFF0C\u9700\u8981\u88AB\u8C03\u7528\u7684\u7EBF\u7A0B\u81EA\u5DF1\u8FDB\u884C\u914D\u5408\u624D\u884C\u3002</p><p>\u2461 \u5982\u679C\u7EBF\u7A0B\u5904\u4E8E\u88AB\u963B\u585E\u72B6\u6001\uFF08\u4F8B\u5982\u5904\u4E8Esleep, wait, join \u7B49\u72B6\u6001\uFF09\uFF0C\u5728\u522B\u7684\u7EBF\u7A0B\u4E2D\u8C03\u7528\u5F53\u524D\u7EBF\u7A0B\u5BF9\u8C61\u7684interrupt\u65B9\u6CD5\uFF0C \u90A3\u4E48\u7EBF\u7A0B\u5C06\u7ACB\u5373\u9000\u51FA\u88AB\u963B\u585E\u72B6\u6001\uFF0C\u5E76\u629B\u51FA\u4E00\u4E2AInterruptedException\u5F02\u5E38\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InterruptDemo2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">300</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;after t1.interrupt()--\u7B2C2\u6B21---: &quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;before t1.interrupt()----: &quot;</span> <span class="token operator">+</span> t1<span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u5B9E\u4F8B\u65B9\u6CD5interrupt()\u4EC5\u4EC5\u662F\u8BBE\u7F6E\u7EBF\u7A0B\u7684\u4E2D\u65AD\u72B6\u6001\u4F4D\u8BBE\u7F6E\u4E3Atrue\uFF0C\u4E0D\u4F1A\u505C\u6B62\u7EBF\u7A0B</span>
        t1<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u6D3B\u52A8\u72B6\u6001,t1\u7EBF\u7A0B\u8FD8\u5728\u6267\u884C\u4E2D</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;after t1.interrupt()--\u7B2C1\u6B21---: &quot;</span> <span class="token operator">+</span> t1<span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u975E\u6D3B\u52A8\u72B6\u6001,t1\u7EBF\u7A0B\u4E0D\u5728\u6267\u884C\u4E2D\uFF0C\u5DF2\u7ECF\u7ED3\u675F\u6267\u884C\u4E86\u3002</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;after t1.interrupt()--\u7B2C3\u6B21---: &quot;</span> <span class="token operator">+</span> t1<span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916231745805.png" alt="image-20210916231745805"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916231758523.png" alt="image-20210916231758523"></p><p><strong>\u4E2D\u65AD\u53EA\u662F\u4E00\u79CD\u534F\u540C\u673A\u5236\uFF0C\u4FEE\u6539\u4E2D\u65AD\u6807\u8BC6\u4F4D\u4EC5\u6B64\u800C\u5DF2\uFF0C\u4E0D\u662F\u7ACB\u523Bstop\u6253\u65AD</strong></p><h4 id="_5\u3001\u9759\u6001\u65B9\u6CD5thread-interrupted" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u9759\u6001\u65B9\u6CD5thread-interrupted" aria-hidden="true">#</a> 5\u3001\u9759\u6001\u65B9\u6CD5Thread.interrupted()</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u4F5C\u7528\u662F\u6D4B\u8BD5\u5F53\u524D\u7EBF\u7A0B\u662F\u5426\u88AB\u4E2D\u65AD\uFF08\u68C0\u67E5\u4E2D\u65AD\u6807\u5FD7\uFF09\uFF0C\u8FD4\u56DE\u4E00\u4E2Aboolean\u5E76\u6E05\u9664\u4E2D\u65AD\u72B6\u6001\uFF0C
 * \u7B2C\u4E8C\u6B21\u518D\u8C03\u7528\u65F6\u4E2D\u65AD\u72B6\u6001\u5DF2\u7ECF\u88AB\u6E05\u9664\uFF0C\u5C06\u8FD4\u56DE\u4E00\u4E2Afalse\u3002
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InterruptDemo</span>
<span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;---&quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;---&quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;111111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;222222&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;---&quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;---&quot;</span><span class="token operator">+</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">interrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>public static boolean interrupted()</th><th>\u9759\u6001\u65B9\u6CD5\uFF0CThread.interrupted(); <br>\u5224\u65AD\u7EBF\u7A0B\u662F\u5426\u88AB\u4E2D\u65AD\uFF0C\u5E76\u6E05\u9664\u5F53\u524D\u4E2D\u65AD\u72B6\u6001\uFF0C\u7C7B\u4F3Ci++<br>\u8FD9\u4E2A\u65B9\u6CD5\u505A\u4E86\u4E24\u4EF6\u4E8B\uFF1A<br>1 \u8FD4\u56DE\u5F53\u524D\u7EBF\u7A0B\u7684\u4E2D\u65AD\u72B6\u6001<br>2 \u5C06\u5F53\u524D\u7EBF\u7A0B\u7684\u4E2D\u65AD\u72B6\u6001\u8BBE\u4E3Afalse<br> <br>\u8FD9\u4E2A\u65B9\u6CD5\u6709\u70B9\u4E0D\u597D\u7406\u89E3\uFF0C\u56E0\u4E3A\u8FDE\u7EED\u8C03\u7528\u4E24\u6B21\u7684\u7ED3\u679C\u53EF\u80FD\u4E0D\u4E00\u6837\u3002</th></tr></thead></table><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916231923048.png" alt="image-20210916231923048"></p><p>\u90FD\u4F1A\u8FD4\u56DE\u4E2D\u65AD\u72B6\u6001\uFF0C\u4E24\u8005\u5BF9\u6BD4</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916231944854.png" alt="image-20210916231944854"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916232053782.png" alt=""></p><h4 id="_6\u3001\u603B\u7ED3-1" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u603B\u7ED3-1" aria-hidden="true">#</a> 6\u3001\u603B\u7ED3</h4><p>\u7EBF\u7A0B\u4E2D\u65AD\u76F8\u5173\u7684\u65B9\u6CD5\uFF1A</p><p>interrupt()\u65B9\u6CD5\u662F\u4E00\u4E2A\u5B9E\u4F8B\u65B9\u6CD5 \u5B83\u901A\u77E5\u76EE\u6807\u7EBF\u7A0B\u4E2D\u65AD\uFF0C\u4E5F\u5C31\u662F\u8BBE\u7F6E\u76EE\u6807\u7EBF\u7A0B\u7684\u4E2D\u65AD\u6807\u5FD7\u4F4D\u4E3Atrue\uFF0C\u4E2D\u65AD\u6807\u5FD7\u4F4D\u8868\u793A\u5F53\u524D\u7EBF\u7A0B\u5DF2\u7ECF\u88AB\u4E2D\u65AD\u4E86\u3002</p><p>isInterrupted()\u65B9\u6CD5\u4E5F\u662F\u4E00\u4E2A\u5B9E\u4F8B\u65B9\u6CD5 \u5B83\u5224\u65AD\u5F53\u524D\u7EBF\u7A0B\u662F\u5426\u88AB\u4E2D\u65AD\uFF08\u901A\u8FC7\u68C0\u67E5\u4E2D\u65AD\u6807\u5FD7\u4F4D\uFF09\u5E76\u83B7\u53D6\u4E2D\u65AD\u6807\u5FD7</p><p>Thread\u7C7B\u7684\u9759\u6001\u65B9\u6CD5interrupted() \u8FD4\u56DE\u5F53\u524D\u7EBF\u7A0B\u7684\u4E2D\u65AD\u72B6\u6001(boolean\u7C7B\u578B)\u4E14\u5C06\u5F53\u524D\u7EBF\u7A0B\u7684\u4E2D\u65AD\u72B6\u6001\u8BBE\u4E3Afalse\uFF0C\u6B64\u65B9\u6CD5\u8C03\u7528\u4E4B\u540E\u4F1A\u6E05\u9664\u5F53\u524D\u7EBF\u7A0B\u7684\u4E2D\u65AD\u6807\u5FD7\u4F4D\u7684\u72B6\u6001\uFF08\u5C06\u4E2D\u65AD\u6807\u5FD7\u7F6E\u4E3Afalse\u4E86\uFF09\uFF0C\u8FD4\u56DE\u5F53\u524D\u503C\u5E76\u6E05\u96F6\u7F6Efalse</p><h3 id="_3\u3001locksupport\u662F\u4EC0\u4E48" tabindex="-1"><a class="header-anchor" href="#_3\u3001locksupport\u662F\u4EC0\u4E48" aria-hidden="true">#</a> 3\u3001LockSupport\u662F\u4EC0\u4E48</h3><p><strong>LockSupport</strong>\u4F4D\u4E8E<strong>java.util.concurrent</strong>\uFF08<strong>\u7B80\u79F0juc</strong>\uFF09\u5305\u4E2D\uFF0C\u7B97\u662Fjuc\u4E2D\u4E00\u4E2A\u57FA\u7840\u7C7B\uFF0Cjuc\u4E2D\u5F88\u591A\u5730\u65B9\u90FD\u4F1A\u4F7F\u7528LockSupport\uFF0C\u975E\u5E38\u91CD\u8981\uFF0C\u5E0C\u671B\u5927\u5BB6\u4E00\u5B9A\u8981\u638C\u63E1\u3002</p><p>\u5173\u4E8E\u7EBF\u7A0B\u7B49\u5F85/\u5524\u9192\u7684\u65B9\u6CD5\uFF0C\u524D\u9762\u7684\u6587\u7AE0\u4E2D\u6211\u4EEC\u5DF2\u7ECF\u8BB2\u8FC72\u79CD\u4E86\uFF1A</p><ol><li>\u65B9\u5F0F1\uFF1A\u4F7F\u7528Object\u4E2D\u7684wait()\u65B9\u6CD5\u8BA9\u7EBF\u7A0B\u7B49\u5F85\uFF0C\u4F7F\u7528Object\u4E2D\u7684notify()\u65B9\u6CD5\u5524\u9192\u7EBF\u7A0B</li><li>\u65B9\u5F0F2\uFF1A\u4F7F\u7528juc\u5305\u4E2DCondition\u7684await()\u65B9\u6CD5\u8BA9\u7EBF\u7A0B\u7B49\u5F85\uFF0C\u4F7F\u7528signal()\u65B9\u6CD5\u5524\u9192\u7EBF\u7A0B</li></ol><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916232319808.png" alt="image-20210916232319808"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916232333615.png" alt="image-20210916232333615"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916232340860.png" alt="image-20210916232340860"></p><p>LockSupport\u662F\u7528\u6765\u521B\u5EFA\u9501\u548C\u5176\u4ED6\u540C\u6B65\u7C7B\u7684\u57FA\u672C\u7EBF\u7A0B\u963B\u585E\u539F\u8BED\u3002</p><p>\u4E0B\u9762\u8FD9\u53E5\u8BDD\uFF0C\u540E\u9762\u8BE6\u7EC6\u8BF4 LockSupport\u4E2D\u7684park() \u548C unpark() \u7684\u4F5C\u7528\u5206\u522B\u662F\u963B\u585E\u7EBF\u7A0B\u548C\u89E3\u9664\u963B\u585E\u7EBF\u7A0B</p><h3 id="_4\u3001\u7EBF\u7A0B\u7B49\u5F85\u5524\u9192\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u7EBF\u7A0B\u7B49\u5F85\u5524\u9192\u673A\u5236" aria-hidden="true">#</a> 4\u3001\u7EBF\u7A0B\u7B49\u5F85\u5524\u9192\u673A\u5236</h3><h4 id="_1\u30013\u79CD\u8BA9\u7EBF\u7A0B\u7B49\u5F85\u548C\u5524\u9192\u7684\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_1\u30013\u79CD\u8BA9\u7EBF\u7A0B\u7B49\u5F85\u548C\u5524\u9192\u7684\u65B9\u6CD5" aria-hidden="true">#</a> 1\u30013\u79CD\u8BA9\u7EBF\u7A0B\u7B49\u5F85\u548C\u5524\u9192\u7684\u65B9\u6CD5</h4><ol><li>\u4F7F\u7528Object\u4E2D\u7684wait()\u65B9\u6CD5\u8BA9\u7EBF\u7A0B\u7B49\u5F85\uFF0C\u4F7F\u7528Object\u4E2D\u7684notify()\u65B9\u6CD5\u5524\u9192\u7EBF\u7A0B</li><li>\u4F7F\u7528JUC\u5305\u4E2DCondition\u7684await()\u65B9\u6CD5\u8BA9\u7EBF\u7A0B\u7B49\u5F85\uFF0C\u4F7F\u7528signal()\u65B9\u6CD5\u5524\u9192\u7EBF\u7A0B</li><li>LockSupport\u7C7B\u53EF\u4EE5\u963B\u585E\u5F53\u524D\u7EBF\u7A0B\u4EE5\u53CA\u5524\u9192\u6307\u5B9A\u88AB\u963B\u585E\u7684\u7EBF\u7A0B</li></ol><h4 id="_2\u3001object\u7C7B\u4E2D\u7684wait\u548Cnotify\u65B9\u6CD5\u5B9E\u73B0\u7EBF\u7A0B\u7B49\u5F85\u548C\u5524\u9192" tabindex="-1"><a class="header-anchor" href="#_2\u3001object\u7C7B\u4E2D\u7684wait\u548Cnotify\u65B9\u6CD5\u5B9E\u73B0\u7EBF\u7A0B\u7B49\u5F85\u548C\u5524\u9192" aria-hidden="true">#</a> 2\u3001Object\u7C7B\u4E2D\u7684wait\u548Cnotify\u65B9\u6CD5\u5B9E\u73B0\u7EBF\u7A0B\u7B49\u5F85\u548C\u5524\u9192</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 *
 * \u8981\u6C42\uFF1At1\u7EBF\u7A0B\u7B49\u5F853\u79D2\u949F\uFF0C3\u79D2\u949F\u540Et2\u7EBF\u7A0B\u5524\u9192t1\u7EBF\u7A0B\u7EE7\u7EED\u5DE5\u4F5C
 *
 * 1 \u6B63\u5E38\u7A0B\u5E8F\u6F14\u793A
 *
 * \u4EE5\u4E0B\u5F02\u5E38\u60C5\u51B5\uFF1A
 * 2 wait\u65B9\u6CD5\u548Cnotify\u65B9\u6CD5\uFF0C\u4E24\u4E2A\u90FD\u53BB\u6389\u540C\u6B65\u4EE3\u7801\u5757\u540E\u770B\u8FD0\u884C\u6548\u679C
 *   2.1 \u5F02\u5E38\u60C5\u51B5
 *   Exception in thread &quot;t1&quot; java.lang.IllegalMonitorStateException at java.lang.Object.wait(Native Method)
 *   Exception in thread &quot;t2&quot; java.lang.IllegalMonitorStateException at java.lang.Object.notify(Native Method)
 *   2.2 \u7ED3\u8BBA
 *   Object\u7C7B\u4E2D\u7684wait\u3001notify\u3001notifyAll\u7528\u4E8E\u7EBF\u7A0B\u7B49\u5F85\u548C\u5524\u9192\u7684\u65B9\u6CD5\uFF0C\u90FD\u5FC5\u987B\u5728synchronized\u5185\u90E8\u6267\u884C\uFF08\u5FC5\u987B\u7528\u5230\u5173\u952E\u5B57synchronized\uFF09\u3002
 *
 * 3 \u5C06notify\u653E\u5728wait\u65B9\u6CD5\u524D\u9762
 *   3.1 \u7A0B\u5E8F\u4E00\u76F4\u65E0\u6CD5\u7ED3\u675F
 *   3.2 \u7ED3\u8BBA
 *   \u5148wait\u540Enotify\u3001notifyall\u65B9\u6CD5\uFF0C\u7B49\u5F85\u4E2D\u7684\u7EBF\u7A0B\u624D\u4F1A\u88AB\u5524\u9192\uFF0C\u5426\u5219\u65E0\u6CD5\u5524\u9192
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockSupportDemo</span>
<span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token comment">//main\u65B9\u6CD5\uFF0C\u4E3B\u7EBF\u7A0B\u4E00\u5207\u7A0B\u5E8F\u5165\u53E3</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> objectLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//\u540C\u4E00\u628A\u9501\uFF0C\u7C7B\u4F3C\u8D44\u6E90\u7C7B</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    objectLock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;\u88AB\u5524\u9192\u4E86&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                objectLock<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//objectLock.notify();</span>

            <span class="token comment">/*synchronized (objectLock) {
                try {
                    objectLock.wait();
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }*/</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_1\u3001\u6B63\u5E38" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u6B63\u5E38" aria-hidden="true">#</a> 1\u3001\u6B63\u5E38</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockSupportDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token comment">//main\u65B9\u6CD5\uFF0C\u4E3B\u7EBF\u7A0B\u4E00\u5207\u7A0B\u5E8F\u5165\u53E3</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> objectLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//\u540C\u4E00\u628A\u9501\uFF0C\u7C7B\u4F3C\u8D44\u6E90\u7C7B</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    objectLock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;\u88AB\u5524\u9192\u4E86&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                objectLock<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2\u3001\u5F02\u5E381" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5F02\u5E381" aria-hidden="true">#</a> 2\u3001\u5F02\u5E381</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u8981\u6C42\uFF1At1\u7EBF\u7A0B\u7B49\u5F853\u79D2\u949F\uFF0C3\u79D2\u949F\u540Et2\u7EBF\u7A0B\u5524\u9192t1\u7EBF\u7A0B\u7EE7\u7EED\u5DE5\u4F5C
 * \u4EE5\u4E0B\u5F02\u5E38\u60C5\u51B5\uFF1A
 * 2 wait\u65B9\u6CD5\u548Cnotify\u65B9\u6CD5\uFF0C\u4E24\u4E2A\u90FD\u53BB\u6389\u540C\u6B65\u4EE3\u7801\u5757\u540E\u770B\u8FD0\u884C\u6548\u679C
 *   2.1 \u5F02\u5E38\u60C5\u51B5
 *   Exception in thread &quot;t1&quot; java.lang.IllegalMonitorStateException at java.lang.Object.wait(Native Method)
 *   Exception in thread &quot;t2&quot; java.lang.IllegalMonitorStateException at java.lang.Object.notify(Native Method)
 *   2.2 \u7ED3\u8BBA
 *   Object\u7C7B\u4E2D\u7684wait\u3001notify\u3001notifyAll\u7528\u4E8E\u7EBF\u7A0B\u7B49\u5F85\u548C\u5524\u9192\u7684\u65B9\u6CD5\uFF0C\u90FD\u5FC5\u987B\u5728synchronized\u5185\u90E8\u6267\u884C\uFF08\u5FC5\u987B\u7528\u5230\u5173\u952E\u5B57synchronized\uFF09\u3002
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockSupportDemo</span>
<span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token comment">//main\u65B9\u6CD5\uFF0C\u4E3B\u7EBF\u7A0B\u4E00\u5207\u7A0B\u5E8F\u5165\u53E3</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> objectLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//\u540C\u4E00\u628A\u9501\uFF0C\u7C7B\u4F3C\u8D44\u6E90\u7C7B</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    objectLock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;\u88AB\u5524\u9192\u4E86&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            objectLock<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>wait\u65B9\u6CD5\u548Cnotify\u65B9\u6CD5\uFF0C\u4E24\u4E2A\u90FD\u53BB\u6389\u540C\u6B65\u4EE3\u7801\u5757</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916232855724.png" alt="image-20210916232855724"></p><h5 id="_3\u3001\u5F02\u5E382" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5F02\u5E382" aria-hidden="true">#</a> 3\u3001\u5F02\u5E382</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 *
 * \u8981\u6C42\uFF1At1\u7EBF\u7A0B\u7B49\u5F853\u79D2\u949F\uFF0C3\u79D2\u949F\u540Et2\u7EBF\u7A0B\u5524\u9192t1\u7EBF\u7A0B\u7EE7\u7EED\u5DE5\u4F5C
 *
 * 3 \u5C06notify\u653E\u5728wait\u65B9\u6CD5\u524D\u5148\u6267\u884C\uFF0Ct1\u5148notify\u4E86\uFF0C3\u79D2\u949F\u540Et2\u7EBF\u7A0B\u518D\u6267\u884Cwait\u65B9\u6CD5
 *   3.1 \u7A0B\u5E8F\u4E00\u76F4\u65E0\u6CD5\u7ED3\u675F
 *   3.2 \u7ED3\u8BBA
 *   \u5148wait\u540Enotify\u3001notifyall\u65B9\u6CD5\uFF0C\u7B49\u5F85\u4E2D\u7684\u7EBF\u7A0B\u624D\u4F1A\u88AB\u5524\u9192\uFF0C\u5426\u5219\u65E0\u6CD5\u5524\u9192
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockSupportDemo</span>
<span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token comment">//main\u65B9\u6CD5\uFF0C\u4E3B\u7EBF\u7A0B\u4E00\u5207\u7A0B\u5E8F\u5165\u53E3</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> objectLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//\u540C\u4E00\u628A\u9501\uFF0C\u7C7B\u4F3C\u8D44\u6E90\u7C7B</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                objectLock<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;\u901A\u77E5\u4E86&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//t1\u5148notify\u4E86\uFF0C3\u79D2\u949F\u540Et2\u7EBF\u7A0B\u518D\u6267\u884Cwait\u65B9\u6CD5</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    objectLock<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;\u88AB\u5524\u9192\u4E86&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5C06notify\u653E\u5728wait\u65B9\u6CD5\u524D\u9762</p><p>\u7A0B\u5E8F\u65E0\u6CD5\u6267\u884C\uFF0C\u65E0\u6CD5\u5524\u9192</p><h5 id="_4\u3001\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u603B\u7ED3" aria-hidden="true">#</a> 4\u3001\u603B\u7ED3</h5><p>wait\u548Cnotify\u65B9\u6CD5\u5FC5\u987B\u8981\u5728\u540C\u6B65\u5757\u6216\u8005\u65B9\u6CD5\u91CC\u9762\uFF0C\u4E14\u6210\u5BF9\u51FA\u73B0\u4F7F\u7528</p><p>\u5148wait\u540Enotify\u624DOK</p><h4 id="_3\u3001condition\u63A5\u53E3\u4E2D\u7684await\u540Esignal\u65B9\u6CD5\u5B9E\u73B0\u7EBF\u7A0B\u7684\u7B49\u5F85\u548C\u5524\u9192" tabindex="-1"><a class="header-anchor" href="#_3\u3001condition\u63A5\u53E3\u4E2D\u7684await\u540Esignal\u65B9\u6CD5\u5B9E\u73B0\u7EBF\u7A0B\u7684\u7B49\u5F85\u548C\u5524\u9192" aria-hidden="true">#</a> 3\u3001Condition\u63A5\u53E3\u4E2D\u7684await\u540Esignal\u65B9\u6CD5\u5B9E\u73B0\u7EBF\u7A0B\u7684\u7B49\u5F85\u548C\u5524\u9192</h4><h5 id="_1\u3001\u6B63\u5E38-1" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u6B63\u5E38-1" aria-hidden="true">#</a> 1\u3001\u6B63\u5E38</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockSupportDemo2</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Condition</span> condition <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                condition<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;\u88AB\u5524\u9192&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{</span>
                condition<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;\u901A\u77E5\u4E86&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2\u3001\u5F02\u5E381-1" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5F02\u5E381-1" aria-hidden="true">#</a> 2\u3001\u5F02\u5E381</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u5F02\u5E38\uFF1A
 * condition.await();\u548Ccondition.signal();\u90FD\u89E6\u53D1\u4E86IllegalMonitorStateException\u5F02\u5E38
 *
 * \u539F\u56E0\uFF1A\u8C03\u7528condition\u4E2D\u7EBF\u7A0B\u7B49\u5F85\u548C\u5524\u9192\u7684\u65B9\u6CD5\u7684\u524D\u63D0\u662F\uFF0C\u8981\u5728lock\u548Cunlock\u65B9\u6CD5\u4E2D,\u8981\u6709\u9501\u624D\u80FD\u8C03\u7528
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockSupportDemo2</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Condition</span> condition <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;start&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                condition<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;\u88AB\u5524\u9192&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{</span>
                condition<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;\u901A\u77E5\u4E86&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53BB\u6389lock/unlock</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916233230684.png" alt="image-20210916233230684"></p><p>condition.await();\u548C condition.signal();\u90FD\u89E6\u53D1\u4E86 IllegalMonitorStateException\u5F02\u5E38\u3002</p><p>\u7ED3\u8BBA\uFF1A lock\u3001unlock\u5BF9\u91CC\u9762\u624D\u80FD\u6B63\u786E\u8C03\u7528\u8C03\u7528condition\u4E2D\u7EBF\u7A0B\u7B49\u5F85\u548C\u5524\u9192\u7684\u65B9\u6CD5</p><h5 id="_3\u3001\u5F02\u5E382-1" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5F02\u5E382-1" aria-hidden="true">#</a> 3\u3001\u5F02\u5E382</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u5F02\u5E38\uFF1A
 * \u7A0B\u5E8F\u65E0\u6CD5\u8FD0\u884C
 *
 * \u539F\u56E0\uFF1A\u5148await()\u540Esignal\u624DOK\uFF0C\u5426\u5219\u7EBF\u7A0B\u65E0\u6CD5\u88AB\u5524\u9192
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockSupportDemo2</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Condition</span> condition <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{</span>
                condition<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;signal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;\u7B49\u5F85\u88AB\u5524\u9192&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                condition<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;\u88AB\u5524\u9192&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5148signal\u540Eawait</p><h5 id="_4\u3001\u603B\u7ED3-1" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u603B\u7ED3-1" aria-hidden="true">#</a> 4\u3001\u603B\u7ED3</h5><p>Condtion\u4E2D\u7684\u7EBF\u7A0B\u7B49\u5F85\u548C\u5524\u9192\u65B9\u6CD5\u4E4B\u524D\uFF0C\u9700\u8981\u5148\u83B7\u53D6\u9501</p><p>\u4E00\u5B9A\u8981\u5148await\u540Esignal\uFF0C\u4E0D\u8981\u53CD\u4E86</p><h4 id="_4\u3001object\u548Ccondition\u4F7F\u7528\u7684\u9650\u5236\u6761\u4EF6" tabindex="-1"><a class="header-anchor" href="#_4\u3001object\u548Ccondition\u4F7F\u7528\u7684\u9650\u5236\u6761\u4EF6" aria-hidden="true">#</a> 4\u3001Object\u548CCondition\u4F7F\u7528\u7684\u9650\u5236\u6761\u4EF6</h4><p>\u7EBF\u7A0B\u5148\u8981\u83B7\u5F97\u5E76\u6301\u6709\u9501\uFF0C\u5FC5\u987B\u5728\u9501\u5757(synchronized\u6216lock)\u4E2D</p><p>\u5FC5\u987B\u8981\u5148\u7B49\u5F85\u540E\u5524\u9192\uFF0C\u7EBF\u7A0B\u624D\u80FD\u591F\u88AB\u5524\u9192</p><h4 id="_5\u3001locksupport\u7C7B\u4E2D\u7684park\u7B49\u5F85\u548Cunpark\u5524\u9192" tabindex="-1"><a class="header-anchor" href="#_5\u3001locksupport\u7C7B\u4E2D\u7684park\u7B49\u5F85\u548Cunpark\u5524\u9192" aria-hidden="true">#</a> 5\u3001LockSupport\u7C7B\u4E2D\u7684park\u7B49\u5F85\u548Cunpark\u5524\u9192</h4><p>\u901A\u8FC7park()\u548Cunpark(thread)\u65B9\u6CD5\u6765\u5B9E\u73B0\u963B\u585E\u548C\u5524\u9192\u7EBF\u7A0B\u7684\u64CD\u4F5C</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916233452889.png" alt="image-20210916233452889"></p><p>LockSupport\u662F\u7528\u6765\u521B\u5EFA\u9501\u548C\u5176\u4ED6\u540C\u6B65\u7C7B\u7684\u57FA\u672C\u7EBF\u7A0B\u963B\u585E\u539F\u8BED\u3002</p><p>\u200B LockSupport\u7C7B\u4F7F\u7528\u4E86\u4E00\u79CD\u540D\u4E3APermit\uFF08\u8BB8\u53EF\uFF09\u7684\u6982\u5FF5\u6765\u505A\u5230\u963B\u585E\u548C\u5524\u9192\u7EBF\u7A0B\u7684\u529F\u80FD\uFF0C \u6BCF\u4E2A\u7EBF\u7A0B\u90FD\u6709\u4E00\u4E2A\u8BB8\u53EF(permit)\uFF0C permit\u53EA\u6709\u4E24\u4E2A\u503C1\u548C\u96F6\uFF0C\u9ED8\u8BA4\u662F\u96F6\u3002 \u53EF\u4EE5\u628A\u8BB8\u53EF\u770B\u6210\u662F\u4E00\u79CD(0,1)\u4FE1\u53F7\u91CF\uFF08Semaphore\uFF09\uFF0C\u4F46\u4E0E Semaphore \u4E0D\u540C\u7684\u662F\uFF0C\u8BB8\u53EF\u7684\u7D2F\u52A0\u4E0A\u9650\u662F1\u3002</p><h5 id="_1\u3001\u4E3B\u8981\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u4E3B\u8981\u65B9\u6CD5" aria-hidden="true">#</a> 1\u3001\u4E3B\u8981\u65B9\u6CD5</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916233517944.png" alt="image-20210916233517944"></p><p><strong>\u963B\u585E</strong></p><p>park() /park(Object blocker)</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916233615025.png" alt="image-20210916233615025"></p><p>\u963B\u585E\u5F53\u524D\u7EBF\u7A0B/\u963B\u585E\u4F20\u5165\u7684\u5177\u4F53\u7EBF\u7A0B</p><p><strong>\u5524\u9192</strong></p><p>unpark(Thread thread)</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916233726972.png" alt="image-20210916233726972"></p><p>\u5524\u9192\u5904\u4E8E\u963B\u585E\u72B6\u6001\u7684\u6307\u5B9A\u7EBF\u7A0B</p><h5 id="_2\u3001\u4EE3\u7801" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u4EE3\u7801" aria-hidden="true">#</a> 2\u3001\u4EE3\u7801</h5><p>\u6B63\u5E38+\u65E0\u9501\u5757\u8981\u6C42</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockSupportDemo3</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//\u6B63\u5E38\u4F7F\u7528+\u4E0D\u9700\u8981\u9501\u5757</span>
<span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; &quot;</span><span class="token operator">+</span><span class="token string">&quot;1111111111111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot; &quot;</span><span class="token operator">+</span><span class="token string">&quot;2222222222222------end\u88AB\u5524\u9192&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;   -----LockSupport.unparrk() invoked over&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E4B\u524D\u9519\u8BEF\u7684\u5148\u5524\u9192\u540E\u7B49\u5F85\uFF0CLockSupport\u7167\u6837\u652F\u6301</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">T1</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">park</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;---\u88AB\u53EB\u9192&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token class-name">LockSupport</span><span class="token punctuation">.</span><span class="token function">unpark</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;---unpark over&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210916233832563.png" alt="image-20210916233832563"></p><h2 id="\u4E03\u3001\u96C6\u5408\u4E0D\u5B89\u5168" tabindex="-1"><a class="header-anchor" href="#\u4E03\u3001\u96C6\u5408\u4E0D\u5B89\u5168" aria-hidden="true">#</a> \u4E03\u3001\u96C6\u5408\u4E0D\u5B89\u5168</h2><h3 id="_1\u3001\u7EBF\u7A0B\u4E0D\u5B89\u5168\u9519\u8BEF" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u7EBF\u7A0B\u4E0D\u5B89\u5168\u9519\u8BEF" aria-hidden="true">#</a> 1\u3001\u7EBF\u7A0B\u4E0D\u5B89\u5168\u9519\u8BEF</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>ConcurrentModificationException</span>
<span class="token class-name">ArrayList</span>\u5728\u8FED\u4EE3\u7684\u65F6\u5019\u5982\u679C\u540C\u65F6\u5BF9\u5176\u8FDB\u884C\u4FEE\u6539\u5C31\u4F1A
\u629B\u51FA<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>ConcurrentModificationException</span>\u5F02\u5E38 \u5E76\u53D1\u4FEE\u6539\u5F02\u5E38
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2\u3001list\u4E0D\u5B89\u5168" tabindex="-1"><a class="header-anchor" href="#_2\u3001list\u4E0D\u5B89\u5168" aria-hidden="true">#</a> 2\u3001List\u4E0D\u5B89\u5168</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">30</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 
<span class="token comment">// \u770BArrayList\u7684\u6E90\u7801</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span>size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Increments modCount!!</span>
    elementData<span class="token punctuation">[</span>size<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u6CA1\u6709synchronized\u7EBF\u7A0B\u4E0D\u5B89\u5168</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1\u3001-\u89E3\u51B3\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#_1\u3001-\u89E3\u51B3\u65B9\u6848" aria-hidden="true">#</a> 1\u3001 \u89E3\u51B3\u65B9\u6848</h4><h5 id="_1\u3001vector" tabindex="-1"><a class="header-anchor" href="#_1\u3001vector" aria-hidden="true">#</a> 1\u3001Vector</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161454663-ad91cc9b-df6d-46b9-b9ea-cb30859660e3.png" alt="image"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// \u770BVector\u7684\u6E90\u7801</span>
<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    modCount<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">ensureCapacityHelper</span><span class="token punctuation">(</span>elementCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    elementData<span class="token punctuation">[</span>elementCount<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// \u6709synchronized\u7EBF\u7A0B\u5B89\u5168</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2\u3001collections" tabindex="-1"><a class="header-anchor" href="#_2\u3001collections" aria-hidden="true">#</a> 2\u3001Collections</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span> list <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">synchronizedList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Collections\u63D0\u4F9B\u4E86\u65B9\u6CD5synchronizedList\u4FDD\u8BC1list\u662F\u540C\u6B65\u7EBF\u7A0B\u5B89\u5168\u7684</span>
<span class="token comment">// \u90A3HashMap\uFF0CHashSet\u662F\u7EBF\u7A0B\u5B89\u5168\u7684\u5417\uFF1F\u4E5F\u4E0D\u662F,\u6240\u4EE5\u6709\u540C\u6837\u7684\u7EBF\u7A0B\u5B89\u5168\u65B9\u6CD5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161465300-4f72afb7-5318-41d8-ac75-afa03514b63f.png" alt="image"></p><h5 id="_3\u3001\u5199\u65F6\u590D\u5236-juc" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5199\u65F6\u590D\u5236-juc" aria-hidden="true">#</a> 3\u3001\u5199\u65F6\u590D\u5236(JUC)</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/1614161496374-08a7194a-7fe7-4a1b-8491-73632bbfb33d.png" alt="image"></p><h5 id="_4\u3001copyonwrite\u7406\u8BBA" tabindex="-1"><a class="header-anchor" href="#_4\u3001copyonwrite\u7406\u8BBA" aria-hidden="true">#</a> 4\u3001CopyOnWrite\u7406\u8BBA</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Appends the specified element to the end of this list.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">e</span> element to be appended to this list
 * <span class="token keyword">@return</span> <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token boolean">true</span></span></span><span class="token punctuation">}</span> (as specified by <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Collection</span><span class="token punctuation">#</span><span class="token field">add</span></span><span class="token punctuation">}</span>)
 */</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elements <span class="token operator">=</span> <span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> elements<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newElements <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        newElements<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
        <span class="token function">setArray</span><span class="token punctuation">(</span>newElements<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u200B CopyOnWrite\u5BB9\u5668\u5373\u5199\u65F6\u590D\u5236\u7684\u5BB9\u5668\u3002\u5F80\u4E00\u4E2A\u5BB9\u5668\u6DFB\u52A0\u5143\u7D20\u7684\u65F6\u5019\uFF0C\u4E0D\u76F4\u63A5\u5F80\u5F53\u524D\u5BB9\u5668Object[]\u6DFB\u52A0\uFF0C\u800C\u662F\u5148\u5C06\u5F53\u524D\u5BB9\u5668Object[]\u8FDB\u884CCopy\uFF0C\u590D\u5236\u51FA\u4E00\u4E2A\u65B0\u7684\u5BB9\u5668Object[] newElements\uFF0C\u7136\u540E\u5411\u65B0\u7684\u5BB9\u5668Object[] newElements\u91CC\u6DFB\u52A0\u5143\u7D20\u3002\u6DFB\u52A0\u5143\u7D20\u540E\uFF0C\u518D\u5C06\u539F\u5BB9\u5668\u7684\u5F15\u7528\u6307\u5411\u65B0\u7684\u5BB9\u5668setArray(newElements)\u3002\u8FD9\u6837\u505A\u7684\u597D\u5904\u662F\u53EF\u4EE5\u5BF9CopyOnWrite\u5BB9\u5668\u8FDB\u884C\u5E76\u53D1\u7684\u8BFB\uFF0C\u800C\u4E0D\u9700\u8981\u52A0\u9501\uFF0C\u56E0\u4E3A\u5F53\u524D\u5BB9\u5668\u4E0D\u4F1A\u6DFB\u52A0\u4EFB\u4F55\u5143\u7D20\u3002\u6240\u4EE5CopyOnWrite\u5BB9\u5668\u4E5F\u662F\u4E00\u79CD\u8BFB\u5199\u5206\u79BB\u7684\u601D\u60F3\uFF0C\u8BFB\u548C\u5199\u4E0D\u540C\u7684\u5BB9\u5668\u3002</p><h3 id="_3\u3001set\u4E0D\u5B89\u5168" tabindex="-1"><a class="header-anchor" href="#_3\u3001set\u4E0D\u5B89\u5168" aria-hidden="true">#</a> 3\u3001Set\u4E0D\u5B89\u5168</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u7EBF\u7A0B\u4E0D\u5B89\u5168</span>
 
<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CopyOnWriteArraySet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u7EBF\u7A0B\u5B89\u5168</span>
<span class="token class-name">HashSet</span>\u5E95\u5C42\u6570\u636E\u7ED3\u6784\u662F\u4EC0\u4E48\uFF1F
<span class="token class-name">HashMap</span>  <span class="token operator">?</span>
 
\u4F46<span class="token class-name">HashSet</span>\u7684add\u662F\u653E\u4E00\u4E2A\u503C\uFF0C\u800C<span class="token class-name">HashMap</span>\u662F\u653E<span class="token class-name">K</span>\u3001<span class="token class-name">V</span>\u952E\u503C\u5BF9
 
<span class="token keyword">public</span> <span class="token class-name">HashSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> PRESENT <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> PRESENT<span class="token punctuation">)</span><span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4\u3001map\u4E0D\u5B89\u5168" tabindex="-1"><a class="header-anchor" href="#_4\u3001map\u4E0D\u5B89\u5168" aria-hidden="true">#</a> 4\u3001Map\u4E0D\u5B89\u5168</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u7EBF\u7A0B\u4E0D\u5B89\u5168</span>

<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u7EBF\u7A0B\u5B89\u5168</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ConcurrentHashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CopyOnWriteArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CopyOnWriteArraySet</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * \u8BF7\u4E3E\u4F8B\u8BF4\u660E\u96C6\u5408\u7C7B\u662F\u4E0D\u5B89\u5168\u7684
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NotSafeDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">30</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>


    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setNoSafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CopyOnWriteArraySet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">30</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">listNoSafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//        List&lt;String&gt; list = Arrays.asList(&quot;a&quot;,&quot;b&quot;,&quot;c&quot;);</span>
        <span class="token comment">//        list.forEach(System.out::println);</span>
        <span class="token comment">//\u5199\u65F6\u590D\u5236</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// new CopyOnWriteArrayList&lt;&gt;();</span>
        <span class="token comment">//Collections.synchronizedList(new ArrayList&lt;&gt;());</span>
        <span class="token comment">//new Vector&lt;&gt;();//new ArrayList&lt;&gt;();</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">30</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u5199\u65F6\u590D\u5236
     CopyOnWrite\u5BB9\u5668\u5373\u5199\u65F6\u590D\u5236\u7684\u5BB9\u5668\u3002\u5F80\u4E00\u4E2A\u5BB9\u5668\u6DFB\u52A0\u5143\u7D20\u7684\u65F6\u5019\uFF0C\u4E0D\u76F4\u63A5\u5F80\u5F53\u524D\u5BB9\u5668Object[]\u6DFB\u52A0\uFF0C
     \u800C\u662F\u5148\u5C06\u5F53\u524D\u5BB9\u5668Object[]\u8FDB\u884CCopy\uFF0C\u590D\u5236\u51FA\u4E00\u4E2A\u65B0\u7684\u5BB9\u5668Object[] newElements\uFF0C\u7136\u540E\u5411\u65B0\u7684\u5BB9\u5668Object[] newElements\u91CC\u6DFB\u52A0\u5143\u7D20\u3002
     \u6DFB\u52A0\u5143\u7D20\u540E\uFF0C\u518D\u5C06\u539F\u5BB9\u5668\u7684\u5F15\u7528\u6307\u5411\u65B0\u7684\u5BB9\u5668setArray(newElements)\u3002
     \u8FD9\u6837\u505A\u7684\u597D\u5904\u662F\u53EF\u4EE5\u5BF9CopyOnWrite\u5BB9\u5668\u8FDB\u884C\u5E76\u53D1\u7684\u8BFB\uFF0C\u800C\u4E0D\u9700\u8981\u52A0\u9501\uFF0C\u56E0\u4E3A\u5F53\u524D\u5BB9\u5668\u4E0D\u4F1A\u6DFB\u52A0\u4EFB\u4F55\u5143\u7D20\u3002
     \u6240\u4EE5CopyOnWrite\u5BB9\u5668\u4E5F\u662F\u4E00\u79CD\u8BFB\u5199\u5206\u79BB\u7684\u601D\u60F3\uFF0C\u8BFB\u548C\u5199\u4E0D\u540C\u7684\u5BB9\u5668\u3002

     *
     *
     *
     *

    public boolean add(E e) <span class="token punctuation">{</span>
        final ReentrantLock lock = this.lock;
        lock.lock();
        try <span class="token punctuation">{</span>
            Object[] elements = getArray();
            int len = elements.length;
            Object[] newElements = Arrays.copyOf(elements, len + 1);
            newElements[len] = e;
            setArray(newElements);
            return true;
        <span class="token punctuation">}</span> finally <span class="token punctuation">{</span>
            lock.unlock();
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
     */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u516B\u3001juc\u5F3A\u5927\u7684\u8F85\u52A9\u7C7B" tabindex="-1"><a class="header-anchor" href="#\u516B\u3001juc\u5F3A\u5927\u7684\u8F85\u52A9\u7C7B" aria-hidden="true">#</a> \u516B\u3001JUC\u5F3A\u5927\u7684\u8F85\u52A9\u7C7B</h2><h3 id="_1\u3001countdownlatch\u51CF\u5C11\u8BA1\u6570" tabindex="-1"><a class="header-anchor" href="#_1\u3001countdownlatch\u51CF\u5C11\u8BA1\u6570" aria-hidden="true">#</a> 1\u3001CountDownLatch\u51CF\u5C11\u8BA1\u6570</h3><p>CountDownLatch\u79F0\u4E4B\u4E3A\u95ED\u9501\uFF0C\u5B83\u53EF\u4EE5\u4F7F\u4E00\u4E2A\u6216\u4E00\u6279\u7EBF\u7A0B\u5728\u95ED\u9501\u4E0A\u7B49\u5F85\uFF0C\u7B49\u5230\u5176\u4ED6\u7EBF\u7A0B\u6267\u884C\u5B8C\u76F8\u5E94\u64CD\u4F5C\u540E\uFF0C\u95ED\u9501\u6253\u5F00\uFF0C\u8FD9\u4E9B\u7B49\u5F85\u7684\u7EBF\u7A0B\u624D\u53EF\u4EE5\u7EE7\u7EED\u6267\u884C\u3002\u786E\u5207\u7684\u8BF4\uFF0C\u95ED\u9501\u5728\u5185\u90E8\u7EF4\u62A4\u4E86\u4E00\u4E2A\u5012\u8BA1\u6570\u5668\u3002\u901A\u8FC7\u8BE5\u8BA1\u6570\u5668\u7684\u503C\u6765\u51B3\u5B9A\u95ED\u9501\u7684\u72B6\u6001\uFF0C\u4ECE\u800C\u51B3\u5B9A\u662F\u5426\u5141\u8BB8\u7B49\u5F85\u7684\u7EBF\u7A0B\u7EE7\u7EED\u6267\u884C\u3002</p><p><strong>\u5E38\u7528\u65B9\u6CD5\uFF1A</strong></p><p><strong>public CountDownLatch(int count)</strong>\uFF1A\u6784\u9020\u65B9\u6CD5\uFF0Ccount\u8868\u793A\u8BA1\u6570\u5668\u7684\u503C\uFF0C\u4E0D\u80FD\u5C0F\u4E8E0\uFF0C\u5426\u8005\u4F1A\u62A5\u5F02\u5E38\u3002</p><p><strong>public void await() throws InterruptedException</strong>\uFF1A\u8C03\u7528await()\u4F1A\u8BA9\u5F53\u524D\u7EBF\u7A0B\u7B49\u5F85\uFF0C\u76F4\u5230\u8BA1\u6570\u5668\u4E3A0\u7684\u65F6\u5019\uFF0C\u65B9\u6CD5\u624D\u4F1A\u8FD4\u56DE\uFF0C\u6B64\u65B9\u6CD5\u4F1A\u54CD\u5E94\u7EBF\u7A0B\u4E2D\u65AD\u64CD\u4F5C\u3002</p><p><strong>public boolean await(long timeout, TimeUnit unit) throws InterruptedException</strong>\uFF1A\u9650\u65F6\u7B49\u5F85\uFF0C\u5728\u8D85\u65F6\u4E4B\u524D\uFF0C\u8BA1\u6570\u5668\u53D8\u4E3A\u4E860\uFF0C\u65B9\u6CD5\u8FD4\u56DEtrue\uFF0C\u5426\u8005\u76F4\u5230\u8D85\u65F6\uFF0C\u8FD4\u56DEfalse\uFF0C\u6B64\u65B9\u6CD5\u4F1A\u54CD\u5E94\u7EBF\u7A0B\u4E2D\u65AD\u64CD\u4F5C\u3002</p><p><strong>public void countDown()</strong>\uFF1A\u8BA9\u8BA1\u6570\u5668\u51CF1</p><p>CountDownLatch\u4F7F\u7528\u6B65\u9AA4\uFF1A</p><ol><li>\u521B\u5EFACountDownLatch\u5BF9\u8C61</li><li>\u8C03\u7528\u5176\u5B9E\u4F8B\u65B9\u6CD5<code>await()</code>\uFF0C\u8BA9\u5F53\u524D\u7EBF\u7A0B\u7B49\u5F85</li><li>\u8C03\u7528<code>countDown()</code>\u65B9\u6CD5\uFF0C\u8BA9\u8BA1\u6570\u5668\u51CF1</li><li>\u5F53\u8BA1\u6570\u5668\u53D8\u4E3A0\u7684\u65F6\u5019\uFF0C<code>await()</code>\u65B9\u6CD5\u4F1A\u8FD4\u56DE</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xue<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span>
 
 
<span class="token doc-comment comment">/**
 * 
 * @Description:
 *  *\u8BA9\u4E00\u4E9B\u7EBF\u7A0B\u963B\u585E\u76F4\u5230\u53E6\u4E00\u4E9B\u7EBF\u7A0B\u5B8C\u6210\u4E00\u7CFB\u5217\u64CD\u4F5C\u540E\u624D\u88AB\u5524\u9192\u3002
 * 
 * CountDownLatch\u4E3B\u8981\u6709\u4E24\u4E2A\u65B9\u6CD5\uFF0C\u5F53\u4E00\u4E2A\u6216\u591A\u4E2A\u7EBF\u7A0B\u8C03\u7528await\u65B9\u6CD5\u65F6\uFF0C\u8FD9\u4E9B\u7EBF\u7A0B\u4F1A\u963B\u585E\u3002
 * \u5176\u5B83\u7EBF\u7A0B\u8C03\u7528countDown\u65B9\u6CD5\u4F1A\u5C06\u8BA1\u6570\u5668\u51CF1(\u8C03\u7528countDown\u65B9\u6CD5\u7684\u7EBF\u7A0B\u4E0D\u4F1A\u963B\u585E)\uFF0C
 * \u5F53\u8BA1\u6570\u5668\u7684\u503C\u53D8\u4E3A0\u65F6\uFF0C\u56E0await\u65B9\u6CD5\u963B\u585E\u7684\u7EBF\u7A0B\u4F1A\u88AB\u5524\u9192\uFF0C\u7EE7\u7EED\u6267\u884C\u3002
 * 
 * \u89E3\u91CA\uFF1A6\u4E2A\u540C\u5B66\u9646\u7EED\u79BB\u5F00\u6559\u5BA4\u540E\u503C\u73ED\u540C\u5B66\u624D\u53EF\u4EE5\u5173\u95E8\u3002
 * 
 * main\u4E3B\u7EBF\u7A0B\u5FC5\u987B\u8981\u7B49\u524D\u97626\u4E2A\u7EBF\u7A0B\u5B8C\u6210\u5168\u90E8\u5DE5\u4F5C\u540E\uFF0C\u81EA\u5DF1\u624D\u80FD\u5F00\u5E72 
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CountDownLatchDemo</span>
<span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span>
   <span class="token punctuation">{</span>
         <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//6\u4E2A\u4E0A\u81EA\u4E60\u7684\u540C\u5B66\uFF0C\u5404\u81EA\u79BB\u5F00\u6559\u5BA4\u7684\u65F6\u95F4\u4E0D\u4E00\u81F4</span>
       <span class="token punctuation">{</span>
          <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
              <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t \u53F7\u540C\u5B66\u79BB\u5F00\u6559\u5BA4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t****** \u73ED\u957F\u5173\u95E8\u8D70\u4EBA\uFF0Cmain\u7EBF\u7A0B\u662F\u73ED\u957F&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>CountDownLatch\u4E3B\u8981\u6709\u4E24\u4E2A\u65B9\u6CD5\uFF0C\u5F53\u4E00\u4E2A\u6216\u591A\u4E2A\u7EBF\u7A0B\u8C03\u7528await\u65B9\u6CD5\u65F6\uFF0C\u8FD9\u4E9B\u7EBF\u7A0B\u4F1A\u963B\u585E\u3002</li><li>\u5176\u5B83\u7EBF\u7A0B\u8C03\u7528countDown\u65B9\u6CD5\u4F1A\u5C06\u8BA1\u6570\u5668\u51CF1(\u8C03\u7528countDown\u65B9\u6CD5\u7684\u7EBF\u7A0B\u4E0D\u4F1A\u963B\u585E)\uFF0C</li><li>\u5F53\u8BA1\u6570\u5668\u7684\u503C\u53D8\u4E3A0\u65F6\uFF0C\u56E0await\u65B9\u6CD5\u963B\u585E\u7684\u7EBF\u7A0B\u4F1A\u88AB\u5524\u9192\uFF0C\u7EE7\u7EED\u6267\u884C\u3002</li></ul><h4 id="\u793A\u4F8B1" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B1" aria-hidden="true">#</a> \u793A\u4F8B1</h4><p>\u5047\u5982\u6709\u8FD9\u6837\u4E00\u4E2A\u9700\u6C42\uFF0C\u5F53\u6211\u4EEC\u9700\u8981\u89E3\u6790\u4E00\u4E2AExcel\u91CC\u591A\u4E2Asheet\u7684\u6570\u636E\u65F6\uFF0C\u53EF\u4EE5\u8003\u8651\u4F7F\u7528\u591A\u7EBF\u7A0B\uFF0C\u6BCF\u4E2A\u7EBF\u7A0B\u89E3\u6790\u4E00\u4E2Asheet\u91CC\u7684\u6570\u636E\uFF0C\u7B49\u5230\u6240\u6709\u7684sheet\u90FD\u89E3\u6790\u5B8C\u4E4B\u540E\uFF0C\u7A0B\u5E8F\u9700\u8981\u7EDF\u8BA1\u89E3\u6790\u603B\u8017\u65F6\u3002\u5206\u6790\u4E00\u4E0B\uFF1A\u89E3\u6790\u6BCF\u4E2Asheet\u8017\u65F6\u53EF\u80FD\u4E0D\u4E00\u6837\uFF0C\u603B\u8017\u65F6\u5C31\u662F\u6700\u957F\u8017\u65F6\u7684\u90A3\u4E2A\u64CD\u4F5C\u3002</p><p>\u6211\u4EEC\u80FD\u591F\u60F3\u5230\u7684\u6700\u7B80\u5355\u7684\u505A\u6CD5\u662F\u4F7F\u7528join\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo1</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u4F11\u7720\u65F6\u95F4\uFF08\u79D2\uFF09</span>
        <span class="token keyword">int</span> sleepSeconds<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> sleepSeconds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sleepSeconds <span class="token operator">=</span> sleepSeconds<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> ct <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>startTime <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> ct<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u5F00\u59CB\u5904\u7406!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u6A21\u62DF\u8017\u65F6\u64CD\u4F5C\uFF0C\u4F11\u7720sleepSeconds\u79D2</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sleepSeconds<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>endTime <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> ct<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u5904\u7406\u5B8C\u6BD5,\u8017\u65F6:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;\u89E3\u6790sheet1\u7EBF\u7A0B&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;\u89E3\u6790sheet2\u7EBF\u7A0B&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u603B\u8017\u65F6:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1563767560271</span><span class="token punctuation">,</span>\u89E3\u6790sheet1\u7EBF\u7A0B<span class="token punctuation">,</span>\u5F00\u59CB\u5904\u7406<span class="token operator">!</span>
<span class="token number">1563767560272</span><span class="token punctuation">,</span>\u89E3\u6790sheet2\u7EBF\u7A0B<span class="token punctuation">,</span>\u5F00\u59CB\u5904\u7406<span class="token operator">!</span>
<span class="token number">1563767562273</span><span class="token punctuation">,</span>\u89E3\u6790sheet1\u7EBF\u7A0B<span class="token punctuation">,</span>\u5904\u7406\u5B8C\u6BD5<span class="token punctuation">,</span>\u8017\u65F6<span class="token operator">:</span><span class="token number">2002</span>
<span class="token number">1563767565274</span><span class="token punctuation">,</span>\u89E3\u6790sheet2\u7EBF\u7A0B<span class="token punctuation">,</span>\u5904\u7406\u5B8C\u6BD5<span class="token punctuation">,</span>\u8017\u65F6<span class="token operator">:</span><span class="token number">5002</span>
\u603B\u8017\u65F6<span class="token operator">:</span><span class="token number">5005</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE3\u7801\u4E2D\u542F\u52A8\u4E862\u4E2A\u89E3\u6790sheet\u7684\u7EBF\u7A0B\uFF0C\u7B2C\u4E00\u4E2A\u8017\u65F62\u79D2\uFF0C\u7B2C\u4E8C\u4E2A\u8017\u65F65\u79D2\uFF0C\u6700\u7EC8\u7ED3\u679C\u4E2D\u603B\u8017\u65F6\uFF1A5\u79D2\u3002\u4E0A\u9762\u7684\u5173\u952E\u6280\u672F\u70B9\u662F\u7EBF\u7A0B\u7684<code>join()</code>\u65B9\u6CD5\uFF0C\u6B64\u65B9\u6CD5\u4F1A\u8BA9\u5F53\u524D\u7EBF\u7A0B\u7B49\u5F85\u88AB\u8C03\u7528\u7684\u7EBF\u7A0B\u5B8C\u6210\u4E4B\u540E\u624D\u80FD\u7EE7\u7EED\u3002\u53EF\u4EE5\u770B\u4E00\u4E0Bjoin\u7684\u6E90\u7801\uFF0C\u5185\u90E8\u5176\u5B9E\u662F\u5728synchronized\u65B9\u6CD5\u4E2D\u8C03\u7528\u4E86\u7EBF\u7A0B\u7684wait\u65B9\u6CD5\uFF0C\u6700\u540E\u88AB\u8C03\u7528\u7684\u7EBF\u7A0B\u6267\u884C\u5B8C\u6BD5\u4E4B\u540E\uFF0C\u7531jvm\u81EA\u52A8\u8C03\u7528\u5176notifyAll()\u65B9\u6CD5\uFF0C\u5524\u9192\u6240\u6709\u7B49\u5F85\u4E2D\u7684\u7EBF\u7A0B\u3002\u8FD9\u4E2AnotifyAll()\u65B9\u6CD5\u662F\u7531jvm\u5185\u90E8\u81EA\u52A8\u8C03\u7528\u7684\uFF0Cjdk\u6E90\u7801\u4E2D\u662F\u770B\u4E0D\u5230\u7684\uFF0C\u9700\u8981\u770Bjvm\u6E90\u7801\uFF0C\u6709\u5174\u8DA3\u7684\u540C\u5B66\u53EF\u4EE5\u53BB\u67E5\u4E00\u4E0B\u3002\u6240\u4EE5JDK\u4E0D\u63A8\u8350\u5728\u7EBF\u7A0B\u4E0A\u8C03\u7528wait\u3001notify\u3001notifyAll\u65B9\u6CD5\u3002</p><p>\u800C\u5728JDK1.5\u4E4B\u540E\u7684\u5E76\u53D1\u5305\u4E2D\u63D0\u4F9B\u7684CountDownLatch\u4E5F\u53EF\u4EE5\u5B9E\u73B0join\u7684\u8FD9\u4E2A\u529F\u80FD\u3002</p><p>\u6211\u4EEC\u4F7F\u7528CountDownLatch\u6765\u5B8C\u6210\u4E0A\u9762\u793A\u4F8B\u4E2D\u4F7F\u7528join\u5B9E\u73B0\u7684\u529F\u80FD\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u4F11\u7720\u65F6\u95F4\uFF08\u79D2\uFF09</span>
        <span class="token keyword">int</span> sleepSeconds<span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> sleepSeconds<span class="token punctuation">,</span> <span class="token class-name">CountDownLatch</span> countDownLatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sleepSeconds <span class="token operator">=</span> sleepSeconds<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>countDownLatch <span class="token operator">=</span> countDownLatch<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> ct <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>startTime <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> ct<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u5F00\u59CB\u5904\u7406!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u6A21\u62DF\u8017\u65F6\u64CD\u4F5C\uFF0C\u4F11\u7720sleepSeconds\u79D2</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sleepSeconds<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>endTime <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> ct<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u5904\u7406\u5B8C\u6BD5,\u8017\u65F6:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u7EBF\u7A0B start!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;\u89E3\u6790sheet1\u7EBF\u7A0B&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> countDownLatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;\u89E3\u6790sheet2\u7EBF\u7A0B&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> countDownLatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u7EBF\u7A0B end!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u603B\u8017\u65F6:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1563767580511</span><span class="token punctuation">,</span>main\u7EBF\u7A0B start<span class="token operator">!</span>
<span class="token number">1563767580513</span><span class="token punctuation">,</span>\u89E3\u6790sheet1\u7EBF\u7A0B<span class="token punctuation">,</span>\u5F00\u59CB\u5904\u7406<span class="token operator">!</span>
<span class="token number">1563767580513</span><span class="token punctuation">,</span>\u89E3\u6790sheet2\u7EBF\u7A0B<span class="token punctuation">,</span>\u5F00\u59CB\u5904\u7406<span class="token operator">!</span>
<span class="token number">1563767582515</span><span class="token punctuation">,</span>\u89E3\u6790sheet1\u7EBF\u7A0B<span class="token punctuation">,</span>\u5904\u7406\u5B8C\u6BD5<span class="token punctuation">,</span>\u8017\u65F6<span class="token operator">:</span><span class="token number">2002</span>
<span class="token number">1563767585515</span><span class="token punctuation">,</span>\u89E3\u6790sheet2\u7EBF\u7A0B<span class="token punctuation">,</span>\u5904\u7406\u5B8C\u6BD5<span class="token punctuation">,</span>\u8017\u65F6<span class="token operator">:</span><span class="token number">5002</span>
<span class="token number">1563767585515</span><span class="token punctuation">,</span>main\u7EBF\u7A0B end<span class="token operator">!</span>
\u603B\u8017\u65F6<span class="token operator">:</span><span class="token number">5003</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE\u7ED3\u679C\u4E2D\u770B\u51FA\uFF0C\u6548\u679C\u548Cjoin\u5B9E\u73B0\u7684\u6548\u679C\u4E00\u6837\uFF0C\u4EE3\u7801\u4E2D\u521B\u5EFA\u4E86\u8BA1\u6570\u5668\u4E3A2\u7684<code>CountDownLatch</code>\uFF0C\u4E3B\u7EBF\u7A0B\u4E2D\u8C03\u7528<code>countDownLatch.await();</code>\u4F1A\u8BA9\u4E3B\u7EBF\u7A0B\u7B49\u5F85\uFF0Ct1\u3001t2\u7EBF\u7A0B\u4E2D\u6A21\u62DF\u6267\u884C\u8017\u65F6\u64CD\u4F5C\uFF0C\u6700\u7EC8\u5728finally\u4E2D\u8C03\u7528\u4E86<code>countDownLatch.countDown();</code>,\u6B64\u65B9\u6CD5\u6BCF\u8C03\u7528\u4E00\u6B21\uFF0CCountDownLatch\u5185\u90E8\u8BA1\u6570\u5668\u4F1A\u51CF1\uFF0C\u5F53\u8BA1\u6570\u5668\u53D8\u4E3A0\u7684\u65F6\u5019\uFF0C\u4E3B\u7EBF\u7A0B\u4E2D\u7684await()\u4F1A\u8FD4\u56DE\uFF0C\u7136\u540E\u7EE7\u7EED\u6267\u884C\u3002\u6CE8\u610F\uFF1A\u4E0A\u9762\u7684<code>countDown()</code>\u8FD9\u4E2A\u662F\u5FC5\u987B\u8981\u6267\u884C\u7684\u65B9\u6CD5\uFF0C\u6240\u4EE5\u653E\u5728finally\u4E2D\u6267\u884C\u3002</p><h4 id="\u793A\u4F8B2" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B2" aria-hidden="true">#</a> \u793A\u4F8B2</h4><p>\u7B49\u5F85\u6307\u5B9A\u7684\u65F6\u95F4</p><p>\u8FD8\u662F\u4E0A\u9762\u7684\u793A\u4F8B\uFF0C2\u4E2A\u7EBF\u7A0B\u89E3\u67902\u4E2Asheet\uFF0C\u4E3B\u7EBF\u7A0B\u7B49\u5F852\u4E2Asheet\u89E3\u6790\u5B8C\u6210\u3002\u4E3B\u7EBF\u7A0B\u8BF4\uFF0C\u6211\u7B49\u5F852\u79D2\uFF0C\u4F60\u4EEC\u8FD8\u662F\u65E0\u6CD5\u5904\u7406\u5B8C\u6210\uFF0C\u5C31\u4E0D\u7B49\u5F85\u4E86\uFF0C\u76F4\u63A5\u8FD4\u56DE\u3002\u5982\u4E0B\u4EE3\u7801\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo3</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u4F11\u7720\u65F6\u95F4\uFF08\u79D2\uFF09</span>
        <span class="token keyword">int</span> sleepSeconds<span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> sleepSeconds<span class="token punctuation">,</span> <span class="token class-name">CountDownLatch</span> countDownLatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sleepSeconds <span class="token operator">=</span> sleepSeconds<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>countDownLatch <span class="token operator">=</span> countDownLatch<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> ct <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>startTime <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> ct<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u5F00\u59CB\u5904\u7406!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u6A21\u62DF\u8017\u65F6\u64CD\u4F5C\uFF0C\u4F11\u7720sleepSeconds\u79D2</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sleepSeconds<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>endTime <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> ct<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u5904\u7406\u5B8C\u6BD5,\u8017\u65F6:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u7EBF\u7A0B start!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;\u89E3\u6790sheet1\u7EBF\u7A0B&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> countDownLatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;\u89E3\u6790sheet2\u7EBF\u7A0B&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> countDownLatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> result <span class="token operator">=</span> countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u7EBF\u7A0B end!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u4E3B\u7EBF\u7A0B\u8017\u65F6:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,result:&quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1563767637316</span><span class="token punctuation">,</span>main\u7EBF\u7A0B start<span class="token operator">!</span>
<span class="token number">1563767637320</span><span class="token punctuation">,</span>\u89E3\u6790sheet1\u7EBF\u7A0B<span class="token punctuation">,</span>\u5F00\u59CB\u5904\u7406<span class="token operator">!</span>
<span class="token number">1563767637320</span><span class="token punctuation">,</span>\u89E3\u6790sheet2\u7EBF\u7A0B<span class="token punctuation">,</span>\u5F00\u59CB\u5904\u7406<span class="token operator">!</span>
<span class="token number">1563767639321</span><span class="token punctuation">,</span>\u89E3\u6790sheet1\u7EBF\u7A0B<span class="token punctuation">,</span>\u5904\u7406\u5B8C\u6BD5<span class="token punctuation">,</span>\u8017\u65F6<span class="token operator">:</span><span class="token number">2001</span>
<span class="token number">1563767639322</span><span class="token punctuation">,</span>main\u7EBF\u7A0B end<span class="token operator">!</span>
\u4E3B\u7EBF\u7A0B\u8017\u65F6<span class="token operator">:</span><span class="token number">2004</span><span class="token punctuation">,</span>result<span class="token operator">:</span><span class="token boolean">false</span>
<span class="token number">1563767642322</span><span class="token punctuation">,</span>\u89E3\u6790sheet2\u7EBF\u7A0B<span class="token punctuation">,</span>\u5904\u7406\u5B8C\u6BD5<span class="token punctuation">,</span>\u8017\u65F6<span class="token operator">:</span><span class="token number">5002</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE\u8F93\u51FA\u7ED3\u679C\u4E2D\u53EF\u4EE5\u770B\u51FA\uFF0C\u7EBF\u7A0B2\u8017\u65F6\u4E865\u79D2\uFF0C\u4E3B\u7EBF\u7A0B\u8017\u65F6\u4E862\u79D2\uFF0C\u4E3B\u7EBF\u7A0B\u4E2D\u8C03\u7528<code>countDownLatch.await(2, TimeUnit.SECONDS);</code>\uFF0C\u8868\u793A\u6700\u591A\u7B492\u79D2\uFF0C\u4E0D\u7BA1\u8BA1\u6570\u5668\u662F\u5426\u4E3A0\uFF0Cawait\u65B9\u6CD5\u90FD\u4F1A\u8FD4\u56DE\uFF0C\u82E5\u7B49\u5F85\u65F6\u95F4\u5185\uFF0C\u8BA1\u6570\u5668\u53D8\u4E3A0\u4E86\uFF0C\u7ACB\u5373\u8FD4\u56DEtrue\uFF0C\u5426\u5219\u8D85\u65F6\u540E\u8FD4\u56DEfalse\u3002</p><h4 id="\u793A\u4F8B3" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B3" aria-hidden="true">#</a> \u793A\u4F8B3</h4><p>2\u4E2ACountDown\u7ED3\u5408\u4F7F\u7528\u7684\u793A\u4F8B</p><p>\u67093\u4E2A\u4EBA\u53C2\u89C1\u8DD1\u6B65\u6BD4\u8D5B\uFF0C\u9700\u8981\u5148\u7B49\u6307\u4EE4\u5458\u53D1\u6307\u4EE4\u67AA\u540E\u624D\u80FD\u5F00\u8DD1\uFF0C\u6240\u6709\u4EBA\u90FD\u8DD1\u5B8C\u4E4B\u540E\uFF0C\u6307\u4EE4\u5458\u558A\u4E00\u58F0\uFF0C\u5927\u5BB6\u8DD1\u5B8C\u4E86\u3002</p><p>\u793A\u4F8B\u4EE3\u7801\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo4</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u8DD1\u6B65\u8017\u65F6\uFF08\u79D2\uFF09</span>
        <span class="token keyword">int</span> runCostSeconds<span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> commanderCd<span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> countDown<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> runCostSeconds<span class="token punctuation">,</span> <span class="token class-name">CountDownLatch</span> commanderCd<span class="token punctuation">,</span> <span class="token class-name">CountDownLatch</span> countDown<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>runCostSeconds <span class="token operator">=</span> runCostSeconds<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>commanderCd <span class="token operator">=</span> commanderCd<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>countDown <span class="token operator">=</span> countDown<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//\u7B49\u5F85\u6307\u4EE4\u5458\u67AA\u54CD</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                commanderCd<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">Thread</span> ct <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>startTime <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> ct<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u5F00\u59CB\u8DD1!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u6A21\u62DF\u8017\u65F6\u64CD\u4F5C\uFF0C\u4F11\u7720runCostSeconds\u79D2</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>runCostSeconds<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                countDown<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>endTime <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> ct<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u8DD1\u6B65\u7ED3\u675F,\u8017\u65F6:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u7EBF\u7A0B start!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> commanderCd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;\u5C0F\u5F20&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> commanderCd<span class="token punctuation">,</span> countDownLatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;\u5C0F\u674E&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> commanderCd<span class="token punctuation">,</span> countDownLatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;\u8DEF\u4EBA\u7532&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> commanderCd<span class="token punctuation">,</span> countDownLatch<span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u4E3B\u7EBF\u7A0B\u4F11\u77205\u79D2,\u6A21\u62DF\u6307\u4EE4\u5458\u51C6\u5907\u53D1\u67AA\u8017\u65F6\u64CD\u4F5C</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u67AA\u54CD\u4E86\uFF0C\u5927\u5BB6\u5F00\u59CB\u8DD1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        commanderCd<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u6240\u6709\u4EBA\u8DD1\u5B8C\u4E86\uFF0C\u4E3B\u7EBF\u7A0B\u8017\u65F6:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1563767691087</span><span class="token punctuation">,</span>main\u7EBF\u7A0B start<span class="token operator">!</span>
<span class="token number">1563767696092</span><span class="token punctuation">,</span>\u67AA\u54CD\u4E86\uFF0C\u5927\u5BB6\u5F00\u59CB\u8DD1
<span class="token number">1563767696092</span><span class="token punctuation">,</span>\u5C0F\u5F20<span class="token punctuation">,</span>\u5F00\u59CB\u8DD1<span class="token operator">!</span>
<span class="token number">1563767696092</span><span class="token punctuation">,</span>\u5C0F\u674E<span class="token punctuation">,</span>\u5F00\u59CB\u8DD1<span class="token operator">!</span>
<span class="token number">1563767696092</span><span class="token punctuation">,</span>\u8DEF\u4EBA\u7532<span class="token punctuation">,</span>\u5F00\u59CB\u8DD1<span class="token operator">!</span>
<span class="token number">1563767698093</span><span class="token punctuation">,</span>\u5C0F\u5F20<span class="token punctuation">,</span>\u8DD1\u6B65\u7ED3\u675F<span class="token punctuation">,</span>\u8017\u65F6<span class="token operator">:</span><span class="token number">2001</span>
<span class="token number">1563767701093</span><span class="token punctuation">,</span>\u5C0F\u674E<span class="token punctuation">,</span>\u8DD1\u6B65\u7ED3\u675F<span class="token punctuation">,</span>\u8017\u65F6<span class="token operator">:</span><span class="token number">5001</span>
<span class="token number">1563767706093</span><span class="token punctuation">,</span>\u8DEF\u4EBA\u7532<span class="token punctuation">,</span>\u8DD1\u6B65\u7ED3\u675F<span class="token punctuation">,</span>\u8017\u65F6<span class="token operator">:</span><span class="token number">10001</span>
<span class="token number">1563767706093</span><span class="token punctuation">,</span>main\u6240\u6709\u4EBA\u8DD1\u5B8C\u4E86\uFF0C\u4E3B\u7EBF\u7A0B\u8017\u65F6<span class="token operator">:</span><span class="token number">15004</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE3\u7801\u4E2D\uFF0Ct1\u3001t2\u3001t3\u542F\u52A8\u4E4B\u540E\uFF0C\u90FD\u963B\u585E\u5728<code>commanderCd.await();</code>\uFF0C\u4E3B\u7EBF\u7A0B\u6A21\u62DF\u53D1\u67AA\u51C6\u5907\u64CD\u4F5C\u8017\u65F65\u79D2\uFF0C\u7136\u540E\u8C03\u7528<code>commanderCd.countDown();</code>\u6A21\u62DF\u53D1\u67AA\u64CD\u4F5C\uFF0C\u6B64\u65B9\u6CD5\u88AB\u8C03\u7528\u4EE5\u540E\uFF0C\u963B\u585E\u5728<code>commanderCd.await();</code>\u76843\u4E2A\u7EBF\u7A0B\u4F1A\u5411\u4E0B\u6267\u884C\u3002\u4E3B\u7EBF\u7A0B\u8C03\u7528<code>countDownLatch.await();</code>\u4E4B\u540E\u8FDB\u884C\u7B49\u5F85\uFF0C\u6BCF\u4E2A\u4EBA\u8DD1\u5B8C\u4E4B\u540E\uFF0C\u8C03\u7528<code>countDown.countDown();</code>\u901A\u77E5\u4E00\u4E0B<code>countDownLatch</code>\u8BA9\u8BA1\u6570\u5668\u51CF1\uFF0C\u6700\u540E3\u4E2A\u4EBA\u90FD\u8DD1\u5B8C\u4E86\uFF0C\u4E3B\u7EBF\u7A0B\u4ECE<code>countDownLatch.await();</code>\u8FD4\u56DE\u7EE7\u7EED\u5411\u4E0B\u6267\u884C\u3002</p><h4 id="\u624B\u5199\u4E00\u4E2A\u5E76\u884C\u5904\u7406\u4EFB\u52A1\u7684\u5DE5\u5177\u7C7B" tabindex="-1"><a class="header-anchor" href="#\u624B\u5199\u4E00\u4E2A\u5E76\u884C\u5904\u7406\u4EFB\u52A1\u7684\u5DE5\u5177\u7C7B" aria-hidden="true">#</a> \u624B\u5199\u4E00\u4E2A\u5E76\u884C\u5904\u7406\u4EFB\u52A1\u7684\u5DE5\u5177\u7C7B</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CollectionUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ExecutorService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executors</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">Consumer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Collectors</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span></span><span class="token class-name">Stream</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskDisposeUtils</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u5E76\u884C\u7EBF\u7A0B\u6570</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> POOL_SIZE<span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
        POOL_SIZE <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">availableProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token doc-comment comment">/**
     * \u5E76\u884C\u5904\u7406\uFF0C\u5E76\u7B49\u5F85\u7ED3\u675F
     *
     * <span class="token keyword">@param</span> <span class="token parameter">taskList</span> \u4EFB\u52A1\u5217\u8868
     * <span class="token keyword">@param</span> <span class="token parameter">consumer</span> \u6D88\u8D39\u8005
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">InterruptedException</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> taskList<span class="token punctuation">,</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> consumer<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> POOL_SIZE<span class="token punctuation">,</span> taskList<span class="token punctuation">,</span> consumer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token doc-comment comment">/**
     * \u5E76\u884C\u5904\u7406\uFF0C\u5E76\u7B49\u5F85\u7ED3\u675F
     *
     * <span class="token keyword">@param</span> <span class="token parameter">moreThread</span> \u662F\u5426\u591A\u7EBF\u7A0B\u6267\u884C
     * <span class="token keyword">@param</span> <span class="token parameter">poolSize</span>   \u7EBF\u7A0B\u6C60\u5927\u5C0F
     * <span class="token keyword">@param</span> <span class="token parameter">taskList</span>   \u4EFB\u52A1\u5217\u8868
     * <span class="token keyword">@param</span> <span class="token parameter">consumer</span>   \u6D88\u8D39\u8005
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">InterruptedException</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> moreThread<span class="token punctuation">,</span> <span class="token keyword">int</span> poolSize<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> taskList<span class="token punctuation">,</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> consumer<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>taskList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>moreThread <span class="token operator">&amp;&amp;</span> poolSize <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            poolSize <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>poolSize<span class="token punctuation">,</span> taskList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span>poolSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span>taskList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">T</span> item <span class="token operator">:</span> taskList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">try</span> <span class="token punctuation">{</span>
                            consumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                            countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>executorService <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">T</span> item <span class="token operator">:</span> taskList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                consumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u751F\u62101-10\u768410\u4E2A\u6570\u5B57\uFF0C\u653E\u5728list\u4E2D\uFF0C\u76F8\u5F53\u4E8E10\u4E2A\u4EFB\u52A1</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">iterate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> a <span class="token operator">-&gt;</span> a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u542F\u52A8\u591A\u7EBF\u7A0B\u5904\u7406list\u4E2D\u7684\u6570\u636E\uFF0C\u6BCF\u4E2A\u4EFB\u52A1\u4F11\u7720\u65F6\u95F4\u4E3Alist\u4E2D\u7684\u6570\u503C</span>
        <span class="token class-name">TaskDisposeUtils</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> item <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u4EFB\u52A1&quot;</span> <span class="token operator">+</span> item <span class="token operator">+</span> <span class="token string">&quot;\u6267\u884C\u5B8C\u6BD5\uFF0C\u8017\u65F6:&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u4E0A\u9762\u6240\u6709\u4EFB\u52A1\u5904\u7406\u5B8C\u6BD5\u5B8C\u6BD5\u4E4B\u540E\uFF0C\u7A0B\u5E8F\u624D\u80FD\u7EE7\u7EED</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list <span class="token operator">+</span> <span class="token string">&quot;\u4E2D\u7684\u4EFB\u52A1\u90FD\u5904\u7406\u5B8C\u6BD5!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8FD0\u884C\u4EE3\u7801\u8F93\u51FA\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1563769828130</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token number">1</span>\u6267\u884C\u5B8C\u6BD5\uFF0C\u8017\u65F6<span class="token operator">:</span><span class="token number">1000</span>
<span class="token number">1563769829130</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token number">2</span>\u6267\u884C\u5B8C\u6BD5\uFF0C\u8017\u65F6<span class="token operator">:</span><span class="token number">2000</span>
<span class="token number">1563769830131</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token number">3</span>\u6267\u884C\u5B8C\u6BD5\uFF0C\u8017\u65F6<span class="token operator">:</span><span class="token number">3001</span>
<span class="token number">1563769831131</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token number">4</span>\u6267\u884C\u5B8C\u6BD5\uFF0C\u8017\u65F6<span class="token operator">:</span><span class="token number">4001</span>
<span class="token number">1563769832131</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token number">5</span>\u6267\u884C\u5B8C\u6BD5\uFF0C\u8017\u65F6<span class="token operator">:</span><span class="token number">5001</span>
<span class="token number">1563769833130</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token number">6</span>\u6267\u884C\u5B8C\u6BD5\uFF0C\u8017\u65F6<span class="token operator">:</span><span class="token number">6000</span>
<span class="token number">1563769834131</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token number">7</span>\u6267\u884C\u5B8C\u6BD5\uFF0C\u8017\u65F6<span class="token operator">:</span><span class="token number">7001</span>
<span class="token number">1563769835131</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token number">8</span>\u6267\u884C\u5B8C\u6BD5\uFF0C\u8017\u65F6<span class="token operator">:</span><span class="token number">8001</span>
<span class="token number">1563769837131</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token number">9</span>\u6267\u884C\u5B8C\u6BD5\uFF0C\u8017\u65F6<span class="token operator">:</span><span class="token number">9001</span>
<span class="token number">1563769839131</span><span class="token punctuation">,</span>\u4EFB\u52A1<span class="token number">10</span>\u6267\u884C\u5B8C\u6BD5\uFF0C\u8017\u65F6<span class="token operator">:</span><span class="token number">10001</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span>\u4E2D\u7684\u4EFB\u52A1\u90FD\u5904\u7406\u5B8C\u6BD5<span class="token operator">!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>TaskDisposeUtils\u662F\u4E00\u4E2A\u5E76\u884C\u5904\u7406\u7684\u5DE5\u5177\u7C7B\uFF0C\u53EF\u4EE5\u4F20\u5165n\u4E2A\u4EFB\u52A1\u5185\u90E8\u4F7F\u7528\u7EBF\u7A0B\u6C60\u8FDB\u884C\u5904\u7406\uFF0C\u7B49\u5F85\u6240\u6709\u4EFB\u52A1\u90FD\u5904\u7406\u5B8C\u6210\u4E4B\u540E\uFF0C\u65B9\u6CD5\u624D\u4F1A\u8FD4\u56DE\u3002\u6BD4\u5982\u6211\u4EEC\u53D1\u9001\u77ED\u4FE1\uFF0C\u7CFB\u7EDF\u4E2D\u67091\u4E07\u6761\u77ED\u4FE1\uFF0C\u6211\u4EEC\u4F7F\u7528\u4E0A\u9762\u7684\u5DE5\u5177\uFF0C\u6BCF\u6B21\u53D6100\u6761\u5E76\u884C\u53D1\u9001\uFF0C\u5F85100\u4E2A\u90FD\u5904\u7406\u5B8C\u6BD5\u4E4B\u540E\uFF0C\u518D\u53D6\u4E00\u6279\u6309\u7167\u540C\u6837\u7684\u903B\u8F91\u53D1\u9001\u3002</strong></p><h3 id="_2\u3001cyclicbarrier\u5FAA\u73AF\u6805\u680F" tabindex="-1"><a class="header-anchor" href="#_2\u3001cyclicbarrier\u5FAA\u73AF\u6805\u680F" aria-hidden="true">#</a> 2\u3001CyclicBarrier\u5FAA\u73AF\u6805\u680F</h3><p>CyclicBarrier\u901A\u5E38\u79F0\u4E3A\u5FAA\u73AF\u5C4F\u969C\u3002\u5B83\u548CCountDownLatch\u5F88\u76F8\u4F3C\uFF0C\u90FD\u53EF\u4EE5\u4F7F\u7EBF\u7A0B\u5148\u7B49\u5F85\u7136\u540E\u518D\u6267\u884C\u3002\u4E0D\u8FC7CountDownLatch\u662F\u4F7F\u4E00\u6279\u7EBF\u7A0B\u7B49\u5F85\u53E6\u4E00\u6279\u7EBF\u7A0B\u6267\u884C\u5B8C\u540E\u518D\u6267\u884C\uFF1B\u800CCyclicBarrier\u53EA\u662F\u4F7F\u7B49\u5F85\u7684\u7EBF\u7A0B\u8FBE\u5230\u4E00\u5B9A\u6570\u76EE\u540E\u518D\u8BA9\u5B83\u4EEC\u7EE7\u7EED\u6267\u884C\u3002\u6545\u800CCyclicBarrier\u5185\u90E8\u4E5F\u6709\u4E00\u4E2A\u8BA1\u6570\u5668,\u8BA1\u6570\u5668\u7684\u521D\u59CB\u503C\u5728\u521B\u5EFA\u5BF9\u8C61\u65F6\u901A\u8FC7\u6784\u9020\u53C2\u6570\u6307\u5B9A,\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token keyword">int</span> parties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span>parties<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6BCF\u8C03\u7528\u4E00\u6B21await()\u65B9\u6CD5\u90FD\u5C06\u4F7F\u963B\u585E\u7684\u7EBF\u7A0B\u6570+1\uFF0C\u53EA\u6709\u963B\u585E\u7684\u7EBF\u7A0B\u6570\u8FBE\u5230\u8BBE\u5B9A\u503C\u65F6\u5C4F\u969C\u624D\u4F1A\u6253\u5F00\uFF0C\u5141\u8BB8\u963B\u585E\u7684\u6240\u6709\u7EBF\u7A0B\u7EE7\u7EED\u6267\u884C\u3002\u9664\u6B64\u4E4B\u5916\uFF0CCyclicBarrier\u8FD8\u6709\u51E0\u70B9\u9700\u8981\u6CE8\u610F\u7684\u5730\u65B9:</p><ul><li>CyclicBarrier\u7684\u8BA1\u6570\u5668\u53EF\u4EE5\u91CD\u7F6E\u800CCountDownLatch\u4E0D\u884C\uFF0C\u8FD9\u610F\u5473\u7740CyclicBarrier\u5B9E\u4F8B\u53EF\u4EE5\u88AB\u91CD\u590D\u4F7F\u7528\u800CCountDownLatch\u53EA\u80FD\u88AB\u4F7F\u7528\u4E00\u6B21\u3002\u800C\u8FD9\u4E5F\u662F\u5FAA\u73AF\u5C4F\u969C\u5FAA\u73AF\u4E8C\u5B57\u7684\u8BED\u4E49\u6240\u5728\u3002</li><li>CyclicBarrier\u5141\u8BB8\u7528\u6237\u81EA\u5B9A\u4E49barrierAction\u64CD\u4F5C\uFF0C\u8FD9\u662F\u4E2A\u53EF\u9009\u64CD\u4F5C\uFF0C\u53EF\u4EE5\u5728\u521B\u5EFACyclicBarrier\u5BF9\u8C61\u65F6\u6307\u5B9A</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token keyword">int</span> parties<span class="token punctuation">,</span> <span class="token class-name">Runnable</span> barrierAction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parties <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>parties <span class="token operator">=</span> parties<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> parties<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>barrierCommand <span class="token operator">=</span> barrierAction<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E00\u65E6\u7528\u6237\u5728\u521B\u5EFACyclicBarrier\u5BF9\u8C61\u65F6\u8BBE\u7F6E\u4E86barrierAction\u53C2\u6570\uFF0C\u5219\u5728\u963B\u585E\u7EBF\u7A0B\u6570\u8FBE\u5230\u8BBE\u5B9A\u503C\u5C4F\u969C\u6253\u5F00\u524D\uFF0C\u4F1A\u8C03\u7528barrierAction\u7684run()\u65B9\u6CD5\u5B8C\u6210\u7528\u6237\u81EA\u5B9A\u4E49\u7684\u64CD\u4F5C\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xue<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BrokenBarrierException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CyclicBarrier</span></span><span class="token punctuation">;</span>
 
<span class="token doc-comment comment">/**
 * 
 *
 * CyclicBarrier
 * \u7684\u5B57\u9762\u610F\u601D\u662F\u53EF\u5FAA\u73AF\uFF08Cyclic\uFF09\u4F7F\u7528\u7684\u5C4F\u969C\uFF08Barrier\uFF09\u3002\u5B83\u8981\u505A\u7684\u4E8B\u60C5\u662F\uFF0C
 * \u8BA9\u4E00\u7EC4\u7EBF\u7A0B\u5230\u8FBE\u4E00\u4E2A\u5C4F\u969C\uFF08\u4E5F\u53EF\u4EE5\u53EB\u540C\u6B65\u70B9\uFF09\u65F6\u88AB\u963B\u585E\uFF0C
 * \u76F4\u5230\u6700\u540E\u4E00\u4E2A\u7EBF\u7A0B\u5230\u8FBE\u5C4F\u969C\u65F6\uFF0C\u5C4F\u969C\u624D\u4F1A\u5F00\u95E8\uFF0C\u6240\u6709
 * \u88AB\u5C4F\u969C\u62E6\u622A\u7684\u7EBF\u7A0B\u624D\u4F1A\u7EE7\u7EED\u5E72\u6D3B\u3002
 * \u7EBF\u7A0B\u8FDB\u5165\u5C4F\u969C\u901A\u8FC7CyclicBarrier\u7684await()\u65B9\u6CD5\u3002
 * 
 * \u96C6\u9F507\u9897\u9F99\u73E0\u5C31\u53EF\u4EE5\u53EC\u5524\u795E\u9F99
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CyclicBarrierDemo</span>
<span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> NUMBER <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
  
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
     <span class="token comment">//CyclicBarrier(int parties, Runnable barrierAction) </span>
     
     <span class="token class-name">CyclicBarrier</span> cyclicBarrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span>NUMBER<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;*****\u96C6\u9F507\u9897\u9F99\u73E0\u5C31\u53EF\u4EE5\u53EC\u5524\u795E\u9F99&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
     
     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">7</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t \u661F\u9F99\u73E0\u88AB\u6536\u96C6 &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> <span class="token operator">|</span> <span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// TODO Auto-generated catch block</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
       
       <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     
 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>CyclicBarrier\u7684\u5B57\u9762\u610F\u601D\u662F\u53EF\u5FAA\u73AF\uFF08Cyclic\uFF09\u4F7F\u7528\u7684\u5C4F\u969C\uFF08Barrier\uFF09\u3002\u5B83\u8981\u505A\u7684\u4E8B\u60C5\u662F\uFF0C</li><li>\u8BA9\u4E00\u7EC4\u7EBF\u7A0B\u5230\u8FBE\u4E00\u4E2A\u5C4F\u969C\uFF08\u4E5F\u53EF\u4EE5\u53EB\u540C\u6B65\u70B9\uFF09\u65F6\u88AB\u963B\u585E\uFF0C</li><li>\u76F4\u5230\u6700\u540E\u4E00\u4E2A\u7EBF\u7A0B\u5230\u8FBE\u5C4F\u969C\u65F6\uFF0C\u5C4F\u969C\u624D\u4F1A\u5F00\u95E8\uFF0C\u6240\u6709</li><li>\u88AB\u5C4F\u969C\u62E6\u622A\u7684\u7EBF\u7A0B\u624D\u4F1A\u7EE7\u7EED\u5E72\u6D3B\u3002</li><li>\u7EBF\u7A0B\u8FDB\u5165\u5C4F\u969C\u901A\u8FC7CyclicBarrier\u7684await()\u65B9\u6CD5\u3002</li></ul><h4 id="\u793A\u4F8B1-\u7B80\u5355\u4F7F\u7528cyclicbarrier" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B1-\u7B80\u5355\u4F7F\u7528cyclicbarrier" aria-hidden="true">#</a> \u793A\u4F8B1 \u7B80\u5355\u4F7F\u7528CyclicBarrier</h4><p>\u516C\u53F8\u7EC4\u7EC7\u65C5\u6E38\uFF0C\u5927\u5BB6\u90FD\u6709\u7ECF\u5386\u8FC7\uFF0C10\u4E2A\u4EBA\uFF0C\u4E2D\u5348\u5230\u996D\u70B9\u4E86\uFF0C\u9700\u8981\u7B49\u523010\u4E2A\u4EBA\u90FD\u5230\u4E86\u624D\u80FD\u5F00\u996D\uFF0C\u5148\u5230\u7684\u4EBA\u5750\u90A3\u7B49\u7740\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BrokenBarrierException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CyclicBarrier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo1</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CyclicBarrier</span> cyclicBarrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> sleep<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> sleep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">=</span> sleep<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u6A21\u62DF\u4F11\u7720</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>sleep<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//\u8C03\u7528await()\u7684\u65F6\u5019\uFF0C\u5F53\u524D\u7EBF\u7A0B\u5C06\u4F1A\u88AB\u963B\u585E\uFF0C\u9700\u8981\u7B49\u5F85\u5176\u4ED6\u5458\u5DE5\u90FD\u5230\u8FBEawait\u4E86\u624D\u80FD\u7EE7\u7EED</span>
                cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,sleep:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">+</span> <span class="token string">&quot; \u7B49\u5F85\u4E86&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;(ms),\u5F00\u59CB\u5403\u996D\u4E86\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;\u5458\u5DE5&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>\u5458\u5DE5<span class="token number">1</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">1</span> \u7B49\u5F85\u4E86<span class="token function">9000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">9</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">9</span> \u7B49\u5F85\u4E86<span class="token function">1000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">8</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">8</span> \u7B49\u5F85\u4E86<span class="token function">2001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">7</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">7</span> \u7B49\u5F85\u4E86<span class="token function">3001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">6</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">6</span> \u7B49\u5F85\u4E86<span class="token function">4001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">4</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">4</span> \u7B49\u5F85\u4E86<span class="token function">6000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">5</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">5</span> \u7B49\u5F85\u4E86<span class="token function">5000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">10</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">10</span> \u7B49\u5F85\u4E86<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">2</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">2</span> \u7B49\u5F85\u4E86<span class="token function">7999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">3</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">3</span> \u7B49\u5F85\u4E86<span class="token function">7000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE3\u7801\u4E2D\u6A21\u62DF\u4E8610\u4E2A\u5458\u5DE5\u4E0A\u684C\u5403\u996D\u7684\u573A\u666F\uFF0C\u7B49\u5F85\u6240\u6709\u5458\u5DE5\u90FD\u5230\u9F50\u4E86\u624D\u80FD\u5F00\u53D1\uFF0C\u53EF\u4EE5\u770B\u5230\u7B2C10\u4E2A\u5458\u5DE5\u6700\u6162\uFF0C\u524D\u9762\u7684\u90FD\u5728\u7B49\u5F85\u7B2C10\u4E2A\u5458\u5DE5\uFF0C\u5458\u5DE51\u7B49\u5F85\u4E869\u79D2\uFF0C\u4E0A\u9762\u4EE3\u7801\u4E2D\u8C03\u7528<code>cyclicBarrier.await();</code>\u4F1A\u8BA9\u5F53\u524D\u7EBF\u7A0B\u7B49\u5F85\u3002\u5F5310\u4E2A\u5458\u5DE5\u90FD\u8C03\u7528\u4E86<code>cyclicBarrier.await();</code>\u4E4B\u540E\uFF0C\u6240\u6709\u5904\u4E8E\u7B49\u5F85\u4E2D\u7684\u5458\u5DE5\u90FD\u4F1A\u88AB\u5524\u9192\uFF0C\u7136\u540E\u7EE7\u7EED\u8FD0\u884C\u3002</p><h4 id="\u793A\u4F8B2-\u5FAA\u73AF\u4F7F\u7528cyclicbarrier" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B2-\u5FAA\u73AF\u4F7F\u7528cyclicbarrier" aria-hidden="true">#</a> \u793A\u4F8B2 \u5FAA\u73AF\u4F7F\u7528CyclicBarrier</h4><p>\u5BF9\u793A\u4F8B1\u8FDB\u884C\u6539\u9020\u4E00\u4E0B\uFF0C\u5403\u996D\u5B8C\u6BD5\u4E4B\u540E\uFF0C\u6240\u6709\u4EBA\u90FD\u53BB\u8F66\u4E0A\uFF0C\u5F85\u6240\u6709\u4EBA\u90FD\u5230\u8F66\u4E0A\u4E4B\u540E\uFF0C\u9A71\u8F66\u53BB\u4E0B\u4E00\u666F\u70B9\u73A9\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BrokenBarrierException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CyclicBarrier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo2</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CyclicBarrier</span> cyclicBarrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> sleep<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> sleep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">=</span> sleep<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//\u7B49\u5F85\u5403\u996D</span>
        <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u6A21\u62DF\u4F11\u7720</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>sleep<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//\u8C03\u7528await()\u7684\u65F6\u5019\uFF0C\u5F53\u524D\u7EBF\u7A0B\u5C06\u4F1A\u88AB\u963B\u585E\uFF0C\u9700\u8981\u7B49\u5F85\u5176\u4ED6\u5458\u5DE5\u90FD\u5230\u8FBEawait\u4E86\u624D\u80FD\u7EE7\u7EED</span>
                cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,sleep:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">+</span> <span class="token string">&quot; \u7B49\u5F85\u4E86&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;(ms),\u5F00\u59CB\u5403\u996D\u4E86\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//\u4F11\u7720sleep\u65F6\u95F4\uFF0C\u6A21\u62DF\u5F53\u524D\u5458\u5DE5\u5403\u996D\u8017\u65F6</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>sleep<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//\u7B49\u5F85\u6240\u6709\u4EBA\u5230\u9F50\u4E4B\u540E\uFF0C\u5F00\u8F66\u53BB\u4E0B\u4E00\u7AD9</span>
        <span class="token keyword">void</span> <span class="token function">drive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//\u8C03\u7528await()\u7684\u65F6\u5019\uFF0C\u5F53\u524D\u7EBF\u7A0B\u5C06\u4F1A\u88AB\u963B\u585E\uFF0C\u9700\u8981\u7B49\u5F85\u5176\u4ED6\u5458\u5DE5\u90FD\u5230\u8FBEawait\u4E86\u624D\u80FD\u7EE7\u7EED</span>
                cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,sleep:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">+</span> <span class="token string">&quot; \u7B49\u5F85\u4E86&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;(ms),\u53BB\u4E0B\u4E00\u666F\u70B9\u7684\u8DEF\u4E0A\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//\u7B49\u5F85\u6240\u6709\u4EBA\u5230\u9F50\u4E4B\u540E\u5403\u996D\uFF0C\u5148\u5230\u7684\u4EBA\u5750\u90A3\u7B49\u7740\uFF0C\u4EC0\u4E48\u4E8B\u60C5\u4E0D\u8981\u5E72</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//\u7B49\u5F85\u6240\u6709\u4EBA\u5230\u9F50\u4E4B\u540E\u5F00\u8F66\u53BB\u4E0B\u4E00\u666F\u70B9\uFF0C\u5148\u5230\u7684\u4EBA\u5750\u90A3\u7B49\u7740\uFF0C\u4EC0\u4E48\u4E8B\u60C5\u4E0D\u8981\u5E72</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">drive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;\u5458\u5DE5&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>\u5458\u5DE5<span class="token number">10</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">10</span> \u7B49\u5F85\u4E86<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">5</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">5</span> \u7B49\u5F85\u4E86<span class="token function">5000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">6</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">6</span> \u7B49\u5F85\u4E86<span class="token function">4000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">9</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">9</span> \u7B49\u5F85\u4E86<span class="token function">1001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">4</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">4</span> \u7B49\u5F85\u4E86<span class="token function">6000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">3</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">3</span> \u7B49\u5F85\u4E86<span class="token function">7000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">1</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">1</span> \u7B49\u5F85\u4E86<span class="token function">9001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">2</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">2</span> \u7B49\u5F85\u4E86<span class="token function">8000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">8</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">8</span> \u7B49\u5F85\u4E86<span class="token function">2001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">7</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">7</span> \u7B49\u5F85\u4E86<span class="token function">3000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">10</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">10</span> \u7B49\u5F85\u4E86<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u53BB\u4E0B\u4E00\u666F\u70B9\u7684\u8DEF\u4E0A\uFF01
\u5458\u5DE5<span class="token number">1</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">1</span> \u7B49\u5F85\u4E86<span class="token function">8998</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u53BB\u4E0B\u4E00\u666F\u70B9\u7684\u8DEF\u4E0A\uFF01
\u5458\u5DE5<span class="token number">5</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">5</span> \u7B49\u5F85\u4E86<span class="token function">4999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u53BB\u4E0B\u4E00\u666F\u70B9\u7684\u8DEF\u4E0A\uFF01
\u5458\u5DE5<span class="token number">4</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">4</span> \u7B49\u5F85\u4E86<span class="token function">5999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u53BB\u4E0B\u4E00\u666F\u70B9\u7684\u8DEF\u4E0A\uFF01
\u5458\u5DE5<span class="token number">3</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">3</span> \u7B49\u5F85\u4E86<span class="token function">6998</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u53BB\u4E0B\u4E00\u666F\u70B9\u7684\u8DEF\u4E0A\uFF01
\u5458\u5DE5<span class="token number">2</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">2</span> \u7B49\u5F85\u4E86<span class="token function">7998</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u53BB\u4E0B\u4E00\u666F\u70B9\u7684\u8DEF\u4E0A\uFF01
\u5458\u5DE5<span class="token number">9</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">9</span> \u7B49\u5F85\u4E86<span class="token function">999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u53BB\u4E0B\u4E00\u666F\u70B9\u7684\u8DEF\u4E0A\uFF01
\u5458\u5DE5<span class="token number">8</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">8</span> \u7B49\u5F85\u4E86<span class="token function">1999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u53BB\u4E0B\u4E00\u666F\u70B9\u7684\u8DEF\u4E0A\uFF01
\u5458\u5DE5<span class="token number">7</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">7</span> \u7B49\u5F85\u4E86<span class="token function">2999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u53BB\u4E0B\u4E00\u666F\u70B9\u7684\u8DEF\u4E0A\uFF01
\u5458\u5DE5<span class="token number">6</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">6</span> \u7B49\u5F85\u4E86<span class="token function">3999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u53BB\u4E0B\u4E00\u666F\u70B9\u7684\u8DEF\u4E0A\uFF01
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5751\uFF0C\u53C8\u662F\u5458\u5DE510\u6700\u6162\uFF0C\u8981\u63D0\u5347\u6548\u7387\u4E86\uFF0C\u4E0D\u80FD\u5403\u7684\u592A\u591A\uFF0C\u5F97\u51CF\u80A5\u3002</p><p>\u4EE3\u7801\u4E2DCyclicBarrier\u76F8\u5F53\u4E8E\u4F7F\u7528\u4E862\u6B21\uFF0C\u7B2C\u4E00\u6B21\u7528\u4E8E\u7B49\u5F85\u6240\u6709\u4EBA\u5230\u8FBE\u540E\u5F00\u996D\uFF0C\u7B2C\u4E8C\u6B21\u7528\u4E8E\u7B49\u5F85\u6240\u6709\u4EBA\u4E0A\u8F66\u540E\u9A71\u8F66\u53BB\u4E0B\u4E00\u666F\u70B9\u3002\u6CE8\u610F\u4E00\u4E9B\u5148\u5230\u7684\u5458\u5DE5\u4F1A\u5728\u5176\u4ED6\u4EBA\u5230\u8FBE\u4E4B\u524D\uFF0C\u90FD\u5904\u4E8E\u7B49\u5F85\u72B6\u6001\uFF08<code>cyclicBarrier.await();</code>\u4F1A\u8BA9\u5F53\u524D\u7EBF\u7A0B\u963B\u585E\uFF09\uFF0C\u65E0\u6CD5\u5E72\u5176\u4ED6\u4E8B\u60C5\uFF0C\u7B49\u5230\u6700\u540E\u4E00\u4E2A\u4EBA\u5230\u4E86\u4F1A\u5524\u9192\u6240\u6709\u4EBA\uFF0C\u7136\u540E\u7EE7\u7EED\u3002</p><blockquote><p>CyclicBarrier\u5185\u90E8\u76F8\u5F53\u4E8E\u6709\u4E2A\u8BA1\u6570\u5668\uFF08\u6784\u9020\u65B9\u6CD5\u4F20\u5165\u7684\uFF09\uFF0C\u6BCF\u6B21\u8C03\u7528<code>await();</code>\u540E\uFF0C\u8BA1\u6570\u5668\u4F1A\u51CF1\uFF0C\u5E76\u4E14await()\u65B9\u6CD5\u4F1A\u8BA9\u5F53\u524D\u7EBF\u7A0B\u963B\u585E\uFF0C\u7B49\u5F85\u8BA1\u6570\u5668\u51CF\u4E3A0\u7684\u65F6\u5019\uFF0C\u6240\u6709\u5728await()\u4E0A\u7B49\u5F85\u7684\u7EBF\u7A0B\u88AB\u5524\u9192\uFF0C\u7136\u540E\u7EE7\u7EED\u5411\u4E0B\u6267\u884C\uFF0C\u6B64\u65F6\u8BA1\u6570\u5668\u53C8\u4F1A\u88AB\u8FD8\u539F\u4E3A\u521B\u5EFA\u65F6\u7684\u503C\uFF0C\u7136\u540E\u53EF\u4EE5\u7EE7\u7EED\u518D\u6B21\u4F7F\u7528\u3002</p></blockquote><h4 id="\u793A\u4F8B3-\u6700\u540E\u5230\u7684\u4EBA\u7ED9\u5927\u5BB6\u4E0A\u9152-\u7136\u540E\u5F00\u996D" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B3-\u6700\u540E\u5230\u7684\u4EBA\u7ED9\u5927\u5BB6\u4E0A\u9152-\u7136\u540E\u5F00\u996D" aria-hidden="true">#</a> \u793A\u4F8B3 \u6700\u540E\u5230\u7684\u4EBA\u7ED9\u5927\u5BB6\u4E0A\u9152\uFF0C\u7136\u540E\u5F00\u996D</h4><p>\u8FD8\u662F\u793A\u4F8B1\u4E2D\u7684\u4F8B\u5B50\uFF0C\u5458\u5DE510\u662F\u6700\u540E\u5230\u8FBE\u7684\uFF0C\u8BA9\u6240\u6709\u4EBA\u90FD\u4E45\u7B49\u4E86\uFF0C\u90A3\u600E\u4E48\u529E\uFF0C\u5F97\u7ED9\u6240\u6709\u4EBA\u5012\u9152\uFF0C\u7136\u540E\u5F00\u996D\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BrokenBarrierException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CyclicBarrier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo3</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CyclicBarrier</span> cyclicBarrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u6A21\u62DF\u5012\u9152\uFF0C\u82B1\u4E862\u79D2\uFF0C\u53C8\u5F97\u8BA9\u5176\u4ED69\u4E2A\u4EBA\u7B492\u79D2</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u8BF4\uFF0C\u4E0D\u597D\u610F\u601D\uFF0C\u8BA9\u5927\u5BB6\u4E45\u7B49\u4E86\uFF0C\u7ED9\u5927\u5BB6\u5012\u9152\u8D54\u7F6A!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> sleep<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> sleep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">=</span> sleep<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u6A21\u62DF\u4F11\u7720</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>sleep<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//\u8C03\u7528await()\u7684\u65F6\u5019\uFF0C\u5F53\u524D\u7EBF\u7A0B\u5C06\u4F1A\u88AB\u963B\u585E\uFF0C\u9700\u8981\u7B49\u5F85\u5176\u4ED6\u5458\u5DE5\u90FD\u5230\u8FBEawait\u4E86\u624D\u80FD\u7EE7\u7EED</span>
                cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">long</span> endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,sleep:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">+</span> <span class="token string">&quot; \u7B49\u5F85\u4E86&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;(ms),\u5F00\u59CB\u5403\u996D\u4E86\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;\u5458\u5DE5&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>\u5458\u5DE5<span class="token number">10</span>\u8BF4\uFF0C\u4E0D\u597D\u610F\u601D\uFF0C\u8BA9\u5927\u5BB6\u4E45\u7B49\u4E86\uFF0C\u7ED9\u5927\u5BB6\u5012\u9152\u8D54\u7F6A<span class="token operator">!</span>
\u5458\u5DE5<span class="token number">10</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">10</span> \u7B49\u5F85\u4E86<span class="token function">2000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">1</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">1</span> \u7B49\u5F85\u4E86<span class="token function">11000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">2</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">2</span> \u7B49\u5F85\u4E86<span class="token function">10000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">5</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">5</span> \u7B49\u5F85\u4E86<span class="token function">7000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">7</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">7</span> \u7B49\u5F85\u4E86<span class="token function">5000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">9</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">9</span> \u7B49\u5F85\u4E86<span class="token function">3000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">4</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">4</span> \u7B49\u5F85\u4E86<span class="token function">8000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">3</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">3</span> \u7B49\u5F85\u4E86<span class="token function">9001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">8</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">8</span> \u7B49\u5F85\u4E86<span class="token function">4001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">6</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">6</span> \u7B49\u5F85\u4E86<span class="token function">6001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE3\u7801\u4E2D\u521B\u5EFA<code>CyclicBarrier</code>\u5BF9\u8C61\u65F6\uFF0C\u591A\u4F20\u5165\u4E86\u4E00\u4E2A\u53C2\u6570\uFF08\u5185\u90E8\u662F\u5012\u9152\u64CD\u4F5C\uFF09\uFF0C\u5148\u5230\u7684\u4EBA\u5148\u7B49\u5F85\uFF0C\u5F85\u6240\u6709\u4EBA\u90FD\u5230\u9F50\u4E4B\u540E\uFF0C\u9700\u8981\u5148\u7ED9\u5927\u5BB6\u5012\u9152\uFF0C\u7136\u540E\u5524\u9192\u6240\u6709\u7B49\u5F85\u4E2D\u7684\u4EBA\u8BA9\u5927\u5BB6\u5F00\u996D\u3002\u4ECE\u8F93\u51FA\u7ED3\u679C\u4E2D\u6211\u4EEC\u53D1\u73B0\uFF0C\u5012\u9152\u64CD\u4F5C\u662F\u7531\u6700\u540E\u4E00\u4E2A\u4EBA\u64CD\u4F5C\u7684\uFF0C\u6700\u540E\u4E00\u4E2A\u4EBA\u5012\u9152\u5B8C\u6BD5\u4E4B\u540E\uFF0C\u624D\u5524\u9192\u6240\u6709\u7B49\u5F85\u4E2D\u7684\u5176\u4ED6\u5458\u5DE5\uFF0C\u8BA9\u5927\u5BB6\u5F00\u996D\u3002</p><h4 id="\u793A\u4F8B4-\u5176\u4E2D\u4E00\u4E2A\u4EBA\u7B49\u5F85\u4E2D\u88AB\u6253\u65AD\u4E86" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B4-\u5176\u4E2D\u4E00\u4E2A\u4EBA\u7B49\u5F85\u4E2D\u88AB\u6253\u65AD\u4E86" aria-hidden="true">#</a> \u793A\u4F8B4 \u5176\u4E2D\u4E00\u4E2A\u4EBA\u7B49\u5F85\u4E2D\u88AB\u6253\u65AD\u4E86</h4><p>\u5458\u5DE55\u7B49\u5F85\u4E2D\uFF0C\u7A81\u7136\u63A5\u4E86\u4E2A\u7535\u8BDD\uFF0C\u6709\u70B9\u6025\u4E8B\uFF0C\u7136\u540E\u5C31\u62FF\u8D77\u7B77\u5B50\u5F00\u5403\u4E86\uFF0C\u5176\u4ED6\u4EBA\u4F1A\u600E\u4E48\u6837\u5462\uFF1F\u770B\u7740\u4ED6\u5403\u4E48\uFF1F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token class-name">Time</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BrokenBarrierException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CyclicBarrier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo4</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CyclicBarrier</span> cyclicBarrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> sleep<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> sleep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">=</span> sleep<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> endTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u6A21\u62DF\u4F11\u7720</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>sleep<span class="token punctuation">)</span><span class="token punctuation">;</span>
                starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//\u8C03\u7528await()\u7684\u65F6\u5019\uFF0C\u5F53\u524D\u7EBF\u7A0B\u5C06\u4F1A\u88AB\u963B\u585E\uFF0C\u9700\u8981\u7B49\u5F85\u5176\u4ED6\u5458\u5DE5\u90FD\u5230\u8FBEawait\u4E86\u624D\u80FD\u7EE7\u7EED</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u5230\u4E86\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,sleep:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">+</span> <span class="token string">&quot; \u7B49\u5F85\u4E86&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;(ms),\u5F00\u59CB\u5403\u996D\u4E86\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> sleep <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                sleep <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">T</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;\u5458\u5DE5&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> sleep<span class="token punctuation">)</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u6A21\u62DF\u5458\u5DE55\u63A5\u4E86\u4E2A\u7535\u8BDD\uFF0C\u5C06\u81EA\u5DF1\u7B49\u5F85\u5403\u996D\u7ED9\u6253\u65AD\u4E86</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u6709\u70B9\u6025\u4E8B\uFF0C\u6211\u5148\u5F00\u5E72\u4E86\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                t<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>\u5458\u5DE5<span class="token number">4</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">3</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">5</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">1</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">2</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">5</span><span class="token punctuation">,</span>\u6709\u70B9\u6025\u4E8B\uFF0C\u6211\u5148\u5F00\u5E72\u4E86\uFF01
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
\u5458\u5DE5<span class="token number">1</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">0</span> \u7B49\u5F85\u4E86<span class="token function">1001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
\u5458\u5DE5<span class="token number">3</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">0</span> \u7B49\u5F85\u4E86<span class="token function">1001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
\u5458\u5DE5<span class="token number">4</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">0</span> \u7B49\u5F85\u4E86<span class="token function">1001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
\u5458\u5DE5<span class="token number">2</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">0</span> \u7B49\u5F85\u4E86<span class="token function">1001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">5</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">0</span> \u7B49\u5F85\u4E86<span class="token function">1002</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>InterruptedException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span>AbstractQueuedSynchronizer</span>$<span class="token class-name">ConditionObject</span><span class="token punctuation">.</span><span class="token function">reportInterruptAfterWait</span><span class="token punctuation">(</span><span class="token class-name">AbstractQueuedSynchronizer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2014</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>locks<span class="token punctuation">.</span></span>AbstractQueuedSynchronizer</span>$<span class="token class-name">ConditionObject</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">AbstractQueuedSynchronizer</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2048</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">234</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
\u5458\u5DE5<span class="token number">6</span>\u5230\u4E86\uFF01
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
\u5458\u5DE5<span class="token number">9</span>\u5230\u4E86\uFF01
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
\u5458\u5DE5<span class="token number">8</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">7</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">6</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">0</span> \u7B49\u5F85\u4E86<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">7</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">0</span> \u7B49\u5F85\u4E86<span class="token function">1</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
\u5458\u5DE5<span class="token number">8</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">0</span> \u7B49\u5F85\u4E86<span class="token function">1</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">9</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">0</span> \u7B49\u5F85\u4E86<span class="token function">1</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
<span class="token class-name">Disconnected</span> from the target VM<span class="token punctuation">,</span> address<span class="token operator">:</span> &#39;<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">64413</span>&#39;<span class="token punctuation">,</span> transport<span class="token operator">:</span> <span class="token char">&#39;socket&#39;</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo4</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo4</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
\u5458\u5DE5<span class="token number">10</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">10</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">10</span> \u7B49\u5F85\u4E86<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u8F93\u51FA\u7684\u4FE1\u606F\u770B\u7740\u6709\u70B9\u4E71\uFF0C\u7ED9\u5927\u5BB6\u7406\u4E00\u7406\uFF0C\u5458\u5DE55\u9047\u5230\u6025\u4E8B\uFF0C\u62FF\u8D77\u7B77\u5B50\u5C31\u662F\u5403\uFF0C\u8FD9\u6837\u597D\u4E48\uFF0C\u5F53\u7136\u4E0D\u597D\uFF0C\u4ED6\u8FD9\u4E48\u505A\u4E86\uFF0C\u540E\u9762\u770B\u4ED6\u8FD9\u4E48\u505A\u4E86\u90FD\u8DDF\u7740\u8FD9\u4E48\u505A\uFF08\u8FD9\u79CD\u573A\u666F\u662F\u4E0D\u662F\u5F88\u719F\u6089\uFF0C\u6709\u4E00\u4E2A\u4EBA\u62FF\u8D77\u7B77\u5B50\u5148\u5403\u8D77\u6765\uFF0C\u5176\u4ED6\u4EBA\u90FD\u8DDF\u7740\u4E0A\u4E86\uFF09\uFF0C\u76F4\u63A5\u4E0D\u7B49\u5176\u4ED6\u4EBA\u4E86\uFF0C\u62FF\u8D77\u7B77\u5B50\u5C31\u5F00\u5403\u4E86\u3002CyclicBarrier\u9047\u5230\u8FD9\u79CD\u60C5\u51B5\u5C31\u662F\u8FD9\u4E48\u5904\u7406\u7684\u3002\u524D\u97624\u4E2A\u5458\u5DE5\u90FD\u5728<code>await()</code>\u5904\u7B49\u5F85\u7740\uFF0C\u5458\u5DE55\u4E5F\u5728<code>await()</code>\u4E0A\u7B49\u5F85\u7740\uFF0C\u7B49\u4E861\u79D2\uFF08<code>TimeUnit.SECONDS.sleep(1);</code>\uFF09\uFF0C\u63A5\u4E86\u4E2A\u7535\u8BDD\uFF0C\u7136\u540E\u7ED9\u5458\u5DE55\u53D1\u9001\u4E2D\u65AD\u4FE1\u53F7\u540E\uFF08<code>t.interrupt();</code>\uFF09\uFF0C\u5458\u5DE55\u7684await()\u65B9\u6CD5\u4F1A\u89E6\u53D1<code>InterruptedException</code>\u5F02\u5E38\uFF0C\u6B64\u65F6\u5176\u4ED6\u7B49\u5F85\u4E2D\u7684\u524D4\u4E2A\u5458\u5DE5\uFF0C\u770B\u77405\u5F00\u5403\u4E86\uFF0C\u81EA\u5DF1\u7ACB\u5373\u4E5F\u4E0D\u7B49\u4E86\uFF0C\u5185\u90E8\u4ECE<code>await()</code>\u65B9\u6CD5\u4E2D\u89E6\u53D1<code>BrokenBarrierException</code>\u5F02\u5E38\uFF0C\u7136\u540E\u4E5F\u5F00\u5403\u4E86\uFF0C\u540E\u9762\u76846/7/8/9/10\u5458\u5DE5\u6765\u4E86\u4EE5\u540E\u53D1\u73B0\u5927\u5BB6\u90FD\u5F00\u5403\u4E86\uFF0C\u81EA\u5DF1\u4E5F\u4E0D\u7B49\u4E86\uFF0C6-10\u5458\u5DE5\u8C03\u7528<code>await()</code>\u76F4\u63A5\u629B\u51FA\u4E86<code>BrokenBarrierException</code>\u5F02\u5E38\uFF0C\u7136\u540E\u7EE7\u7EED\u5411\u4E0B\u3002</p><p><strong>\u7ED3\u8BBA\uFF1A</strong></p><ol><li><strong>\u5185\u90E8\u6709\u4E00\u4E2A\u4EBA\u628A\u89C4\u5219\u7834\u574F\u4E86\uFF08\u63A5\u6536\u5230\u4E2D\u65AD\u4FE1\u53F7\uFF09\uFF0C\u5176\u4ED6\u4EBA\u90FD\u4E0D\u6309\u89C4\u5219\u6765\u4E86\uFF0C\u4E0D\u4F1A\u7B49\u5F85\u4E86</strong></li><li><strong>\u63A5\u6536\u5230\u4E2D\u65AD\u4FE1\u53F7\u7684\u7EBF\u7A0B\uFF0Cawait\u65B9\u6CD5\u4F1A\u89E6\u53D1InterruptedException\u5F02\u5E38\uFF0C\u7136\u540E\u88AB\u5524\u9192\u5411\u4E0B\u8FD0\u884C</strong></li><li><strong>\u5176\u4ED6\u7B49\u5F85\u4E2D \u6216\u8005\u540E\u9762\u5230\u8FBE\u7684\u7EBF\u7A0B\uFF0C\u4F1A\u5728await()\u65B9\u6CD5\u4E0A\u89E6\u53D1<code>BrokenBarrierException</code>\u5F02\u5E38\uFF0C\u7136\u540E\u7EE7\u7EED\u6267\u884C</strong></li></ol><h4 id="\u793A\u4F8B5-\u5176\u4E2D\u4E00\u4E2A\u4EBA\u53EA\u613F\u610F\u7B49\u76845\u79D2" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B5-\u5176\u4E2D\u4E00\u4E2A\u4EBA\u53EA\u613F\u610F\u7B49\u76845\u79D2" aria-hidden="true">#</a> \u793A\u4F8B5 \u5176\u4E2D\u4E00\u4E2A\u4EBA\u53EA\u613F\u610F\u7B49\u76845\u79D2</h4><p>\u57FA\u4E8E\u793A\u4F8B1\uFF0C\u5458\u5DE51\u53EA\u613F\u610F\u7B49\u76845\u79D2\uFF0C5s\u540E\u5982\u679C\u5927\u5BB6\u8FD8\u6CA1\u5230\u671F\uFF0C\u81EA\u5DF1\u8981\u5F00\u5403\u4E86\uFF0C\u5458\u5DE51\u5F00\u5403\u4E86\uFF0C\u5176\u4ED6\u4EBA\u4F1A\u600E\u4E48\u6837\u5462\uFF1F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BrokenBarrierException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CyclicBarrier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeoutException</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo5</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CyclicBarrier</span> cyclicBarrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> sleep<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> sleep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">=</span> sleep<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> endTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u6A21\u62DF\u4F11\u7720</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>sleep<span class="token punctuation">)</span><span class="token punctuation">;</span>
                starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//\u8C03\u7528await()\u7684\u65F6\u5019\uFF0C\u5F53\u524D\u7EBF\u7A0B\u5C06\u4F1A\u88AB\u963B\u585E\uFF0C\u9700\u8981\u7B49\u5F85\u5176\u4ED6\u5458\u5DE5\u90FD\u5230\u8FBEawait\u4E86\u624D\u80FD\u7EE7\u7EED</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u5230\u4E86\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;\u5458\u5DE51&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TimeoutException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,sleep:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">+</span> <span class="token string">&quot; \u7B49\u5F85\u4E86&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;(ms),\u5F00\u59CB\u5403\u996D\u4E86\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">T</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;\u5458\u5DE5&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>\u5458\u5DE5<span class="token number">1</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">2</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">3</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">4</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">5</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">6</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">1</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">1</span> \u7B49\u5F85\u4E86<span class="token function">5001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">5</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">5</span> \u7B49\u5F85\u4E86<span class="token function">1001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>TimeoutException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">257</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">435</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">32</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
\u5458\u5DE5<span class="token number">6</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">6</span> \u7B49\u5F85\u4E86<span class="token function">2</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
\u5458\u5DE5<span class="token number">2</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">2</span> \u7B49\u5F85\u4E86<span class="token function">4002</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
\u5458\u5DE5<span class="token number">3</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">3</span> \u7B49\u5F85\u4E86<span class="token function">3001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
\u5458\u5DE5<span class="token number">4</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">4</span> \u7B49\u5F85\u4E86<span class="token function">2001</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
\u5458\u5DE5<span class="token number">7</span>\u5230\u4E86\uFF01
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
\u5458\u5DE5<span class="token number">7</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">7</span> \u7B49\u5F85\u4E86<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
\u5458\u5DE5<span class="token number">8</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">8</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">8</span> \u7B49\u5F85\u4E86<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
\u5458\u5DE5<span class="token number">9</span>\u5230\u4E86\uFF01
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
\u5458\u5DE5<span class="token number">9</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">9</span> \u7B49\u5F85\u4E86<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
\u5458\u5DE5<span class="token number">10</span>\u5230\u4E86\uFF01
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
\u5458\u5DE5<span class="token number">10</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">10</span> \u7B49\u5F85\u4E86<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo5</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo5</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECE\u8F93\u51FA\u7ED3\u679C\u4E2D\u6211\u4EEC\u53EF\u4EE5\u770B\u5230\uFF1A1\u7B49\u5F855\u79D2\u4E4B\u540E\uFF0C\u5F00\u5403\u4E86\uFF0C\u5176\u4ED6\u7B49\u5F85\u4EBA\u90FD\u5F00\u5403\u4E86\uFF0C\u540E\u9762\u6765\u7684\u4EBA\u4E0D\u7B49\u5F85\uFF0C\u76F4\u63A5\u5F00\u5403\u4E86\u3002</p><p>\u5458\u5DE51\u8C03\u7528\u6709\u53C2<code>await</code>\u65B9\u6CD5\u7B49\u5F855\u79D2\u4E4B\u540E\uFF0C\u89E6\u53D1\u4E86<code>TimeoutException</code>\u5F02\u5E38\uFF0C\u7136\u540E\u7EE7\u7EED\u5411\u4E0B\u8FD0\u884C\uFF0C\u5176\u4ED6\u7684\u57285\u5F00\u5403\u4E4B\u524D\u5DF2\u7ECF\u7B49\u4E86\u4E00\u4F1A\u7684\u7684\u51E0\u4E2A\u5458\u5DE5\uFF0C\u4ED6\u4EEC\u770B\u52305\u5F00\u5403\u4E86\uFF0C\u81EA\u5DF1\u7ACB\u5373\u4E0D\u7B49\u5F85\u4E86\uFF0C\u4E5F\u4E5F\u5F00\u5403\u4E86\uFF08\u4ED6\u4EEC\u7684<code>await</code>\u629B\u51FA\u4E86<code>BrokenBarrierException</code>\u5F02\u5E38\uFF09\uFF1B\u8FD8\u6709\u51E0\u4E2A\u5458\u5DE5\u57285\u5F00\u5403\u4E4B\u540E\u5230\u8FBE\u7684\uFF0C\u4ED6\u4EEC\u76F4\u63A5\u4E0D\u7B49\u5F85\u4E86\uFF0C\u76F4\u63A5\u629B\u51FA<code>BrokenBarrierException</code>\u5F02\u5E38\uFF0C\u7136\u540E\u4E5F\u5F00\u5403\u4E86\u3002</p><p><strong>\u7ED3\u8BBA\uFF1A</strong></p><ol><li><p><strong>\u7B49\u5F85\u8D85\u65F6\u7684\u65B9\u6CD5</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">await</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">,</span><span class="token class-name">BrokenBarrierException</span><span class="token punctuation">,</span><span class="token class-name">TimeoutException</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p><strong>\u5185\u90E8\u6709\u4E00\u4E2A\u4EBA\u628A\u89C4\u5219\u7834\u574F\u4E86\uFF08\u7B49\u5F85\u8D85\u65F6\uFF09\uFF0C\u5176\u4ED6\u4EBA\u90FD\u4E0D\u6309\u89C4\u5219\u6765\u4E86\uFF0C\u4E0D\u4F1A\u7B49\u5F85\u4E86</strong></p></li><li><p><strong>\u7B49\u5F85\u8D85\u65F6\u7684\u7EBF\u7A0B\uFF0Cawait\u65B9\u6CD5\u4F1A\u89E6\u53D1TimeoutException\u5F02\u5E38\uFF0C\u7136\u540E\u88AB\u5524\u9192\u5411\u4E0B\u8FD0\u884C</strong></p></li><li><p><strong>\u5176\u4ED6\u7B49\u5F85\u4E2D \u6216\u8005\u540E\u9762\u5230\u8FBE\u7684\u7EBF\u7A0B\uFF0C\u4F1A\u5728await()\u65B9\u6CD5\u4E0A\u89E6\u53D1<code>BrokenBarrierException</code>\u5F02\u5E38\uFF0C\u7136\u540E\u7EE7\u7EED\u6267\u884C</strong></p></li></ol><h4 id="\u793A\u4F8B6-\u91CD\u5EFA\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#\u793A\u4F8B6-\u91CD\u5EFA\u89C4\u5219" aria-hidden="true">#</a> \u793A\u4F8B6 \u91CD\u5EFA\u89C4\u5219</h4><p>\u793A\u4F8B5\u4E2D\u6539\u9020\u4E00\u4E0B\uFF0C\u5458\u5DE51\u7B49\u5F855\u79D2\u8D85\u65F6\u4E4B\u540E\uFF0C\u5F00\u5403\u4E86\uFF0C\u6253\u7834\u4E86\u89C4\u5219\uFF0C\u5148\u524D\u7B49\u5F85\u4E2D\u7684\u4EE5\u53CA\u540E\u9762\u5230\u8FBE\u7684\u90FD\u4E0D\u6309\u89C4\u5219\u6765\u4E86\uFF0C\u90FD\u62FF\u8D77\u7B77\u5B50\u5F00\u5403\u3002\u8FC7\u4E86\u4E00\u4F1A\uFF0C\u5BFC\u6E38\u91CD\u65B0\u544A\u77E5\u5927\u5BB6\uFF0C\u8981\u6309\u89C4\u5219\u6765\uFF0C\u7136\u540E\u91CD\u5EFA\u4E86\u89C4\u5219\uFF0C\u5927\u5BB6\u90FD\u6309\u89C4\u5219\u6765\u4E86\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">BrokenBarrierException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CyclicBarrier</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeoutException</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo6</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CyclicBarrier</span> cyclicBarrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u89C4\u5219\u662F\u5426\u5DF2\u91CD\u5EFA</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> guizhe <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> sleep<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> sleep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">=</span> sleep<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> starTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> endTime <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u6A21\u62DF\u4F11\u7720</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span>sleep<span class="token punctuation">)</span><span class="token punctuation">;</span>
                starTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//\u8C03\u7528await()\u7684\u65F6\u5019\uFF0C\u5F53\u524D\u7EBF\u7A0B\u5C06\u4F1A\u88AB\u963B\u585E\uFF0C\u9700\u8981\u7B49\u5F85\u5176\u4ED6\u5458\u5DE5\u90FD\u5230\u8FBEawait\u4E86\u624D\u80FD\u7EE7\u7EED</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\u5230\u4E86\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>guizhe<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;\u5458\u5DE51&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BrokenBarrierException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TimeoutException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,sleep:&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sleep <span class="token operator">+</span> <span class="token string">&quot; \u7B49\u5F85\u4E86&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endTime <span class="token operator">-</span> starTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;(ms),\u5F00\u59CB\u5403\u996D\u4E86\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">T</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;\u5458\u5DE5&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//\u7B49\u5F8510\u79D2\u4E4B\u540E\uFF0C\u91CD\u7F6E\uFF0C\u91CD\u5EFA\u89C4\u5219</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cyclicBarrier<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        guizhe <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;---------------\u5927\u5BB6\u592A\u76AE\u4E86\uFF0C\u8BF7\u5927\u5BB6\u6309\u89C4\u5219\u6765------------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u518D\u6765\u4E00\u6B21</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">T</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;\u5458\u5DE5&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>\u5458\u5DE5<span class="token number">1</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">2</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">3</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">4</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">5</span>\u5230\u4E86\uFF01
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>TimeoutException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">257</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">435</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">36</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">250</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>
\u5458\u5DE5<span class="token number">6</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">1</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">1</span> \u7B49\u5F85\u4E86<span class="token function">5002</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">6</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">6</span> \u7B49\u5F85\u4E86<span class="token function">4</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">4</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">4</span> \u7B49\u5F85\u4E86<span class="token function">2004</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">5</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">5</span> \u7B49\u5F85\u4E86<span class="token function">1004</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">3</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">3</span> \u7B49\u5F85\u4E86<span class="token function">3002</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">2</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">2</span> \u7B49\u5F85\u4E86<span class="token function">4004</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">7</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">7</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">7</span> \u7B49\u5F85\u4E86<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>
\u5458\u5DE5<span class="token number">8</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">8</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">8</span> \u7B49\u5F85\u4E86<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
\u5458\u5DE5<span class="token number">9</span>\u5230\u4E86\uFF01
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
\u5458\u5DE5<span class="token number">9</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">9</span> \u7B49\u5F85\u4E86<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>BrokenBarrierException</span>
\u5458\u5DE5<span class="token number">10</span>\u5230\u4E86\uFF01
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">dowait</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">207</span><span class="token punctuation">)</span>
\u5458\u5DE5<span class="token number">10</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">10</span> \u7B49\u5F85\u4E86<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
    at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span>CyclicBarrier</span><span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token class-name">CyclicBarrier</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">362</span><span class="token punctuation">)</span>
    at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat15<span class="token punctuation">.</span></span>Demo6</span>$<span class="token class-name">T</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Demo6</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>\u5927\u5BB6\u592A\u76AE\u4E86\uFF0C\u8BF7\u5927\u5BB6\u6309\u89C4\u5219\u6765<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
\u5458\u5DE5<span class="token number">1</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">2</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">3</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">4</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">5</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">6</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">7</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">8</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">9</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">10</span>\u5230\u4E86\uFF01
\u5458\u5DE5<span class="token number">10</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">10</span> \u7B49\u5F85\u4E86<span class="token function">0</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">1</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">1</span> \u7B49\u5F85\u4E86<span class="token function">9000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">2</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">2</span> \u7B49\u5F85\u4E86<span class="token function">8000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">3</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">3</span> \u7B49\u5F85\u4E86<span class="token function">6999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">7</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">7</span> \u7B49\u5F85\u4E86<span class="token function">3000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">6</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">6</span> \u7B49\u5F85\u4E86<span class="token function">4000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">5</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">5</span> \u7B49\u5F85\u4E86<span class="token function">5000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">4</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">4</span> \u7B49\u5F85\u4E86<span class="token function">6000</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">9</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">9</span> \u7B49\u5F85\u4E86<span class="token function">999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
\u5458\u5DE5<span class="token number">8</span><span class="token punctuation">,</span>sleep<span class="token operator">:</span><span class="token number">8</span> \u7B49\u5F85\u4E86<span class="token function">1999</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">,</span>\u5F00\u59CB\u5403\u996D\u4E86\uFF01
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7B2C\u4E00\u6B21\u89C4\u5219\u88AB\u6253\u4E71\u4E86\uFF0C\u8FC7\u4E86\u4E00\u4F1A\u5BFC\u6E38\u91CD\u5EFA\u4E86\u89C4\u5219\uFF08<code>cyclicBarrier.reset();</code>\uFF09\uFF0C\u63A5\u7740\u53C8\u91CD\u6765\u6765\u4E86\u4E00\u6B21\u6A21\u62DF\u7B49\u5F85\u5403\u996D\u7684\u64CD\u4F5C\uFF0C\u6B63\u5E38\u4E86\u3002</p><h4 id="countdownlatch\u548Ccyclicbarrier\u7684\u533A\u522B" tabindex="-1"><a class="header-anchor" href="#countdownlatch\u548Ccyclicbarrier\u7684\u533A\u522B" aria-hidden="true">#</a> CountDownLatch\u548CCyclicBarrier\u7684\u533A\u522B</h4><p>\u8FD8\u662F\u4E3E\u4F8B\u5B50\u8BF4\u660E\u4E00\u4E0B\uFF1A</p><p><strong>CountDownLatch\u793A\u4F8B</strong></p><p>\u4E3B\u7BA1\u76F8\u5F53\u4E8E <strong>CountDownLatch</strong>\uFF0C\u5E72\u6D3B\u7684\u5C0F\u5F1F\u76F8\u5F53\u4E8E\u505A\u4E8B\u60C5\u7684\u7EBF\u7A0B\u3002</p><p>\u8001\u677F\u4EA4\u7ED9\u4E3B\u7BA1\u4E86\u4E00\u4E2A\u4EFB\u52A1\uFF0C\u8BA9\u4E3B\u7BA1\u641E\u5B8C\u4E4B\u540E\u7ACB\u5373\u4E0A\u62A5\u7ED9\u8001\u677F\u3002\u4E3B\u7BA1\u4E0B\u9762\u670910\u4E2A\u5C0F\u5F1F\uFF0C\u63A5\u5230\u4EFB\u52A1\u4E4B\u540E\u5C06\u4EFB\u52A1\u5212\u5206\u4E3A10\u4E2A\u5C0F\u4EFB\u52A1\u5206\u7ED9\u6BCF\u4E2A\u5C0F\u5F1F\u53BB\u5E72\uFF0C\u4E3B\u7BA1\u4E00\u76F4\u5904\u4E8E\u7B49\u5F85\u72B6\u6001\uFF08\u4E3B\u7BA1\u4F1A\u8C03\u7528<code>await()</code>\u65B9\u6CD5\uFF0C\u6B64\u65B9\u6CD5\u4F1A\u963B\u585E\u5F53\u524D\u7EBF\u7A0B\uFF09\uFF0C\u8BA9\u6BCF\u4E2A\u5C0F\u5F1F\u5E72\u5B8C\u4E4B\u540E\u901A\u77E5\u4E00\u4E0B\u4E3B\u7BA1\uFF08\u8C03\u7528<code>countDown()</code>\u65B9\u6CD5\u901A\u77E5\u4E3B\u7BA1\uFF0C\u6B64\u65B9\u6CD5\u4F1A\u7ACB\u5373\u8FD4\u56DE\uFF09\uFF0C\u4E3B\u7BA1\u7B49\u5230\u6240\u6709\u7684\u5C0F\u5F1F\u90FD\u505A\u5B8C\u4E86\uFF0C\u4F1A\u88AB\u5524\u9192\uFF0C\u4ECEawait()\u65B9\u6CD5\u4E0A\u82CF\u9192\uFF0C\u7136\u540E\u5C06\u7ED3\u679C\u53CD\u9988\u7ED9\u8001\u677F\u3002\u671F\u95F4\u4E3B\u7BA1\u4F1A\u7B49\u5F85\uFF0C\u4F1A\u7B49\u5F85\u6240\u6709\u5C0F\u5F1F\u5C06\u7ED3\u679C\u6C47\u62A5\u7ED9\u81EA\u5DF1\u3002</p><p><strong>\u800CCyclicBarrier\u662F\u4E00\u6279\u7EBF\u7A0B\u8BA9\u81EA\u5DF1\u7B49\u5F85\uFF0C\u7B49\u5F85\u6240\u6709\u7684\u7EBF\u7A0B\u90FD\u51C6\u5907\u597D\u4E86\uFF0C\u81EA\u5DF1\u624D\u80FD\u7EE7\u7EED\u3002</strong></p><h3 id="_3\u3001semaphore\u4FE1\u53F7\u706F" tabindex="-1"><a class="header-anchor" href="#_3\u3001semaphore\u4FE1\u53F7\u706F" aria-hidden="true">#</a> 3\u3001Semaphore\u4FE1\u53F7\u706F</h3><p>Semaphore\uFF08\u4FE1\u53F7\u91CF\uFF09\u4E3A\u591A\u7EBF\u7A0B\u534F\u4F5C\u63D0\u4F9B\u4E86\u66F4\u4E3A\u5F3A\u5927\u7684\u63A7\u5236\u65B9\u6CD5\uFF0C\u524D\u9762\u7684\u6587\u7AE0\u4E2D\u6211\u4EEC\u5B66\u4E86synchronized\u548C\u91CD\u5165\u9501ReentrantLock\uFF0C\u8FD92\u79CD\u9501\u4E00\u6B21\u90FD\u53EA\u80FD\u5141\u8BB8\u4E00\u4E2A\u7EBF\u7A0B\u8BBF\u95EE\u4E00\u4E2A\u8D44\u6E90\uFF0C\u800C\u4FE1\u53F7\u91CF\u53EF\u4EE5\u63A7\u5236\u6709\u591A\u5C11\u4E2A\u7EBF\u7A0B\u53EF\u4EE5<strong>\u540C\u65F6\u8BBF\u95EE</strong>\u7279\u5B9A\u7684\u8D44\u6E90\u3002</p><p><strong>Semaphore\u5E38\u7528\u573A\u666F\uFF1A\u9650\u6D41</strong></p><p>\u4E3E\u4E2A\u4F8B\u5B50\uFF1A</p><p>\u6BD4\u5982\u6709\u4E2A\u505C\u8F66\u573A\uFF0C\u67095\u4E2A\u7A7A\u4F4D\uFF0C\u95E8\u53E3\u6709\u4E2A\u95E8\u536B\uFF0C\u624B\u4E2D5\u628A\u94A5\u5319\u5206\u522B\u5BF9\u5E945\u4E2A\u8F66\u4F4D\u4E0A\u9762\u7684\u9501\uFF0C\u6765\u4E00\u8F86\u8F66\uFF0C\u95E8\u536B\u4F1A\u7ED9\u53F8\u673A\u4E00\u628A\u94A5\u5319\uFF0C\u7136\u540E\u8FDB\u53BB\u627E\u5230\u5BF9\u5E94\u7684\u8F66\u4F4D\u505C\u4E0B\u6765\uFF0C\u51FA\u53BB\u7684\u65F6\u5019\u53F8\u673A\u5C06\u94A5\u5319\u5F52\u8FD8\u7ED9\u95E8\u536B\u3002\u505C\u8F66\u573A\u751F\u610F\u6BD4\u8F83\u597D\uFF0C\u540C\u65F6\u6765\u4E86100\u4E24\u8F66\uFF0C\u95E8\u536B\u624B\u4E2D\u53EA\u67095\u628A\u94A5\u5319\uFF0C\u540C\u65F6\u53EA\u80FD\u653E5\u8F86\u8F66\u8FDB\u5165\uFF0C\u5176\u4ED6\u8F66\u53EA\u80FD\u7B49\u5F85\uFF0C\u7B49\u6709\u4EBA\u5C06\u94A5\u5319\u5F52\u8FD8\u7ED9\u95E8\u536B\u4E4B\u540E\uFF0C\u624D\u80FD\u8BA9\u5176\u4ED6\u8F66\u8F86\u8FDB\u5165\u3002</p><p>\u4E0A\u9762\u7684\u4F8B\u5B50\u4E2D\u95E8\u536B\u5C31\u76F8\u5F53\u4E8ESemaphore\uFF0C\u8F66\u94A5\u5319\u5C31\u76F8\u5F53\u4E8E\u8BB8\u53EF\u8BC1\uFF0C\u8F66\u5C31\u76F8\u5F53\u4E8E\u7EBF\u7A0B\u3002</p><h4 id="_1\u3001semaphore\u4E3B\u8981\u65B9\u6CD5" tabindex="-1"><a class="header-anchor" href="#_1\u3001semaphore\u4E3B\u8981\u65B9\u6CD5" aria-hidden="true">#</a> 1\u3001Semaphore\u4E3B\u8981\u65B9\u6CD5</h4><ul><li><strong>Semaphore(int permits)</strong>\uFF1A\u6784\u9020\u65B9\u6CD5\uFF0C\u53C2\u6570\u8868\u793A\u8BB8\u53EF\u8BC1\u6570\u91CF\uFF0C\u7528\u6765\u521B\u5EFA\u4FE1\u53F7\u91CF</li><li><strong>Semaphore(int permits,boolean fair)</strong>\uFF1A\u6784\u9020\u65B9\u6CD5\uFF0C\u5F53fair\u7B49\u4E8Etrue\u65F6\uFF0C\u521B\u5EFA\u5177\u6709\u7ED9\u5B9A\u8BB8\u53EF\u6570\u7684\u8BA1\u6570\u4FE1\u53F7\u91CF\u5E76\u8BBE\u7F6E\u4E3A\u516C\u5E73\u4FE1\u53F7\u91CF</li><li><strong>void acquire() throws InterruptedException</strong>\uFF1A\u4ECE\u6B64\u4FE1\u53F7\u91CF\u83B7\u53D61\u4E2A\u8BB8\u53EF\u524D\u7EBF\u7A0B\u5C06\u4E00\u76F4\u963B\u585E\uFF0C\u76F8\u5F53\u4E8E\u4E00\u8F86\u8F66\u5360\u4E86\u4E00\u4E2A\u8F66\u4F4D\uFF0C\u6B64\u65B9\u6CD5\u4F1A\u54CD\u5E94\u7EBF\u7A0B\u4E2D\u65AD\uFF0C\u8868\u793A\u8C03\u7528\u7EBF\u7A0B\u7684interrupt\u65B9\u6CD5\uFF0C\u4F1A\u4F7F\u8BE5\u65B9\u6CD5\u629B\u51FAInterruptedException\u5F02\u5E38</li><li><strong>void acquire(int permits) throws InterruptedException</strong> \uFF1A\u548Cacquire()\u65B9\u6CD5\u7C7B\u4F3C\uFF0C\u53C2\u6570\u8868\u793A\u9700\u8981\u83B7\u53D6\u8BB8\u53EF\u7684\u6570\u91CF\uFF1B\u6BD4\u5982\u4E00\u4E2A\u5927\u5361\u8F66\u8981\u5165\u505C\u8F66\u573A\uFF0C\u7531\u4E8E\u8F66\u6BD4\u8F83\u5927\uFF0C\u9700\u8981\u7533\u8BF73\u4E2A\u8F66\u4F4D\u624D\u53EF\u4EE5\u505C\u653E</li><li><strong>void acquireUninterruptibly(int permits)</strong> \uFF1A\u548Cacquire(int permits) \u65B9\u6CD5\u7C7B\u4F3C\uFF0C\u53EA\u662F\u4E0D\u4F1A\u54CD\u5E94\u7EBF\u7A0B\u4E2D\u65AD</li><li><strong>boolean tryAcquire()</strong>\uFF1A\u5C1D\u8BD5\u83B7\u53D61\u4E2A\u8BB8\u53EF\uFF0C\u4E0D\u7BA1\u662F\u5426\u80FD\u591F\u83B7\u53D6\u6210\u529F\uFF0C\u90FD\u7ACB\u5373\u8FD4\u56DE\uFF0Ctrue\u8868\u793A\u83B7\u53D6\u6210\u529F\uFF0Cfalse\u8868\u793A\u83B7\u53D6\u5931\u8D25</li><li><strong>boolean tryAcquire(int permits)</strong>\uFF1A\u548CtryAcquire()\uFF0C\u8868\u793A\u5C1D\u8BD5\u83B7\u53D6permits\u4E2A\u8BB8\u53EF</li><li><strong>boolean tryAcquire(long timeout, TimeUnit unit) throws InterruptedException</strong>\uFF1A\u5C1D\u8BD5\u5728\u6307\u5B9A\u7684\u65F6\u95F4\u5185\u83B7\u53D61\u4E2A\u8BB8\u53EF\uFF0C\u83B7\u53D6\u6210\u529F\u8FD4\u56DEtrue\uFF0C\u6307\u5B9A\u7684\u65F6\u95F4\u8FC7\u540E\u8FD8\u662F\u65E0\u6CD5\u83B7\u53D6\u8BB8\u53EF\uFF0C\u8FD4\u56DEfalse</li><li><strong>boolean tryAcquire(int permits, long timeout, TimeUnit unit) throws InterruptedException</strong>\uFF1A\u548CtryAcquire(long timeout, TimeUnit unit)\u7C7B\u4F3C\uFF0C\u591A\u4E86\u4E00\u4E2Apermits\u53C2\u6570\uFF0C\u8868\u793A\u5C1D\u8BD5\u83B7\u53D6permits\u4E2A\u8BB8\u53EF</li><li><strong>void release()</strong>\uFF1A\u91CA\u653E\u4E00\u4E2A\u8BB8\u53EF\uFF0C\u5C06\u5176\u8FD4\u56DE\u7ED9\u4FE1\u53F7\u91CF\uFF0C\u76F8\u5F53\u4E8E\u8F66\u4ECE\u505C\u8F66\u573A\u51FA\u53BB\u65F6\u5C06\u94A5\u5319\u5F52\u8FD8\u7ED9\u95E8\u536B</li><li><strong>void release(int n)</strong>\uFF1A\u91CA\u653En\u4E2A\u8BB8\u53EF</li><li><strong>int availablePermits()</strong>\uFF1A\u5F53\u524D\u53EF\u7528\u7684\u8BB8\u53EF\u6570</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xue<span class="token punctuation">.</span>thread</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Semaphore</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>
 
<span class="token doc-comment comment">/**
 * 
 * @Description: TODO(\u8FD9\u91CC\u7528\u4E00\u53E5\u8BDD\u63CF\u8FF0\u8FD9\u4E2A\u7C7B\u7684\u4F5C\u7528)  
 * 
 * \u5728\u4FE1\u53F7\u91CF\u4E0A\u6211\u4EEC\u5B9A\u4E49\u4E24\u79CD\u64CD\u4F5C\uFF1A
 * acquire\uFF08\u83B7\u53D6\uFF09 \u5F53\u4E00\u4E2A\u7EBF\u7A0B\u8C03\u7528acquire\u64CD\u4F5C\u65F6\uFF0C\u5B83\u8981\u4E48\u901A\u8FC7\u6210\u529F\u83B7\u53D6\u4FE1\u53F7\u91CF\uFF08\u4FE1\u53F7\u91CF\u51CF1\uFF09\uFF0C
 *             \u8981\u4E48\u4E00\u76F4\u7B49\u4E0B\u53BB\uFF0C\u76F4\u5230\u6709\u7EBF\u7A0B\u91CA\u653E\u4FE1\u53F7\u91CF\uFF0C\u6216\u8D85\u65F6\u3002
 * release\uFF08\u91CA\u653E\uFF09\u5B9E\u9645\u4E0A\u4F1A\u5C06\u4FE1\u53F7\u91CF\u7684\u503C\u52A01\uFF0C\u7136\u540E\u5524\u9192\u7B49\u5F85\u7684\u7EBF\u7A0B\u3002
 * 
 * \u4FE1\u53F7\u91CF\u4E3B\u8981\u7528\u4E8E\u4E24\u4E2A\u76EE\u7684\uFF0C\u4E00\u4E2A\u662F\u7528\u4E8E\u591A\u4E2A\u5171\u4EAB\u8D44\u6E90\u7684\u4E92\u65A5\u4F7F\u7528\uFF0C\u53E6\u4E00\u4E2A\u7528\u4E8E\u5E76\u53D1\u7EBF\u7A0B\u6570\u7684\u63A7\u5236\u3002
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SemaphoreDemo</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
     <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u6A21\u62DF3\u4E2A\u505C\u8F66\u4F4D</span>
     
     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">6</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//\u6A21\u62DF6\u90E8\u6C7D\u8F66</span>
     <span class="token punctuation">{</span>
       <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> 
          <span class="token punctuation">{</span>
            semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t \u62A2\u5230\u4E86\u8F66\u4F4D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t------- \u79BB\u5F00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u4FE1\u53F7\u91CF\u4E0A\u6211\u4EEC\u5B9A\u4E49\u4E24\u79CD\u64CD\u4F5C\uFF1A</p><ul><li>acquire\uFF08\u83B7\u53D6\uFF09 \u5F53\u4E00\u4E2A\u7EBF\u7A0B\u8C03\u7528acquire\u64CD\u4F5C\u65F6\uFF0C\u5B83\u8981\u4E48\u901A\u8FC7\u6210\u529F\u83B7\u53D6\u4FE1\u53F7\u91CF\uFF08\u4FE1\u53F7\u91CF\u51CF1\uFF09\uFF0C\u8981\u4E48\u4E00\u76F4\u7B49\u4E0B\u53BB\uFF0C\u76F4\u5230\u6709\u7EBF\u7A0B\u91CA\u653E\u4FE1\u53F7\u91CF\uFF0C\u6216\u8D85\u65F6\u3002</li><li>release\uFF08\u91CA\u653E\uFF09\u5B9E\u9645\u4E0A\u4F1A\u5C06\u4FE1\u53F7\u91CF\u7684\u503C\u52A01\uFF0C\u7136\u540E\u5524\u9192\u7B49\u5F85\u7684\u7EBF\u7A0B\u3002</li><li>\u4FE1\u53F7\u91CF\u4E3B\u8981\u7528\u4E8E\u4E24\u4E2A\u76EE\u7684\uFF0C\u4E00\u4E2A\u662F\u7528\u4E8E\u591A\u4E2A\u5171\u4EAB\u8D44\u6E90\u7684\u4E92\u65A5\u4F7F\u7528\uFF0C\u53E6\u4E00\u4E2A\u7528\u4E8E\u5E76\u53D1\u7EBF\u7A0B\u6570\u7684\u63A7\u5236\u3002</li></ul><h4 id="_2\u3001semaphore\u7B80\u5355\u7684\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#_2\u3001semaphore\u7B80\u5355\u7684\u4F7F\u7528" aria-hidden="true">#</a> 2\u3001Semaphore\u7B80\u5355\u7684\u4F7F\u7528</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Semaphore</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo1</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u83B7\u53D6\u8BB8\u53EF!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u91CA\u653E\u8BB8\u53EF!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t-&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE3\u7801\u4E2D<code>new Semaphore(2)</code>\u521B\u5EFA\u4E86\u8BB8\u53EF\u6570\u91CF\u4E3A2\u7684\u4FE1\u53F7\u91CF\uFF0C\u6BCF\u4E2A\u7EBF\u7A0B\u83B7\u53D61\u4E2A\u8BB8\u53EF\uFF0C\u540C\u65F6\u5141\u8BB8\u4E24\u4E2A\u7EBF\u7A0B\u83B7\u53D6\u8BB8\u53EF\uFF0C\u4ECE\u8F93\u51FA\u4E2D\u4E5F\u53EF\u4EE5\u770B\u51FA\uFF0C\u540C\u65F6\u6709\u4E24\u4E2A\u7EBF\u7A0B\u53EF\u4EE5\u83B7\u53D6\u8BB8\u53EF\uFF0C\u5176\u4ED6\u7EBF\u7A0B\u9700\u8981\u7B49\u5F85\u5DF2\u83B7\u53D6\u8BB8\u53EF\u7684\u7EBF\u7A0B\u91CA\u653E\u8BB8\u53EF\u4E4B\u540E\u624D\u80FD\u8FD0\u884C\u3002\u4E3A\u83B7\u53D6\u5230\u8BB8\u53EF\u7684\u7EBF\u7A0B\u4F1A\u963B\u585E\u5728<code>acquire()</code>\u65B9\u6CD5\u4E0A\uFF0C\u76F4\u5230\u83B7\u53D6\u5230\u8BB8\u53EF\u624D\u80FD\u7EE7\u7EED\u3002</p><h4 id="_3\u3001\u83B7\u53D6\u8BB8\u53EF\u4E4B\u540E\u4E0D\u91CA\u653E" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u83B7\u53D6\u8BB8\u53EF\u4E4B\u540E\u4E0D\u91CA\u653E" aria-hidden="true">#</a> 3\u3001\u83B7\u53D6\u8BB8\u53EF\u4E4B\u540E\u4E0D\u91CA\u653E</h4><p>\u95E8\u536B\uFF08Semaphore\uFF09\u6709\u70B9\u5446\uFF0C\u53F8\u673A\u8FDB\u53BB\u7684\u65F6\u5019\u7ED9\u4E86\u94A5\u5319\uFF0C\u51FA\u6765\u7684\u65F6\u5019\u4E0D\u5F52\u8FD8\uFF0C\u95E8\u536B\u4E5F\u4E0D\u4F1A\u8BF4\u4EC0\u4E48\u3002\u6700\u7EC8\u7ED3\u679C\u5C31\u662F\u5176\u4ED6\u8F66\u8F86\u90FD\u65E0\u6CD5\u8FDB\u5165\u4E86\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Semaphore</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo2</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u83B7\u53D6\u8BB8\u53EF!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u8FD0\u884C\u7ED3\u675F!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u5F53\u524D\u53EF\u7528\u8BB8\u53EF\u6570\u91CF:&quot;</span> <span class="token operator">+</span> semaphore<span class="token punctuation">.</span><span class="token function">availablePermits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t-&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u7A0B\u5E8F\u8FD0\u884C\u540E\u4E00\u76F4\u65E0\u6CD5\u7ED3\u675F\uFF0C\u89C2\u5BDF\u4E00\u4E0B\u4EE3\u7801\uFF0C\u4EE3\u7801\u4E2D\u83B7\u53D6\u8BB8\u53EF\u540E\uFF0C\u6CA1\u6709\u91CA\u653E\u8BB8\u53EF\u7684\u4EE3\u7801\uFF0C\u6700\u7EC8\u5BFC\u81F4\uFF0C\u53EF\u7528\u8BB8\u53EF\u6570\u91CF\u4E3A0\uFF0C\u5176\u4ED6\u7EBF\u7A0B\u65E0\u6CD5\u83B7\u53D6\u8BB8\u53EF\uFF0C\u4F1A\u5728<code>semaphore.acquire();</code>\u5904\u7B49\u5F85\uFF0C\u5BFC\u81F4\u7A0B\u5E8F\u65E0\u6CD5\u7ED3\u675F\u3002</p><h4 id="_4\u3001\u91CA\u653E\u8BB8\u53EF\u6B63\u786E\u7684\u59FF\u52BF" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u91CA\u653E\u8BB8\u53EF\u6B63\u786E\u7684\u59FF\u52BF" aria-hidden="true">#</a> 4\u3001\u91CA\u653E\u8BB8\u53EF\u6B63\u786E\u7684\u59FF\u52BF</h4><p>\u793A\u4F8B1\u4E2D\uFF0C\u5728finally\u91CC\u9762\u91CA\u653E\u9501\uFF0C\u4F1A\u6709\u95EE\u9898\u4E48\uFF1F</p><p>\u5982\u679C\u83B7\u53D6\u9501\u7684\u8FC7\u7A0B\u4E2D\u53D1\u751F\u5F02\u5E38\uFF0C\u5BFC\u81F4\u83B7\u53D6\u9501\u5931\u8D25\uFF0C\u6700\u540Efinally\u91CC\u9762\u4E5F\u91CA\u653E\u4E86\u8BB8\u53EF\uFF0C\u6700\u7EC8\u4F1A\u600E\u4E48\u6837\uFF0C\u5BFC\u81F4\u8BB8\u53EF\u6570\u91CF\u51ED\u7A7A\u589E\u957F\u4E86\u3002</p><p>\u793A\u4F8B\u4EE3\u7801\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Semaphore</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo3</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u83B7\u53D6\u8BB8\u53EF,\u5F53\u524D\u53EF\u7528\u8BB8\u53EF\u6570\u91CF:&quot;</span> <span class="token operator">+</span> semaphore<span class="token punctuation">.</span><span class="token function">availablePermits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//\u4F11\u7720100\u79D2</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u8FD0\u884C\u7ED3\u675F!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u5F53\u524D\u53EF\u7528\u8BB8\u53EF\u6570\u91CF:&quot;</span> <span class="token operator">+</span> semaphore<span class="token punctuation">.</span><span class="token function">availablePermits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u4F11\u77201\u79D2</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u4F11\u77201\u79D2</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u7ED9t2\u548Ct3\u53D1\u9001\u4E2D\u65AD\u4FE1\u53F7</span>
        t2<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7A0B\u5E8F\u4E2D\u4FE1\u53F7\u91CF\u8BB8\u53EF\u6570\u91CF\u4E3A1\uFF0C\u521B\u5EFA\u4E863\u4E2A\u7EBF\u7A0B\u83B7\u53D6\u8BB8\u53EF\uFF0C\u7EBF\u7A0Bt1\u83B7\u53D6\u6210\u529F\u4E86\uFF0C\u7136\u540E\u4F11\u7720100\u79D2\u3002\u5176\u4ED6\u4E24\u4E2A\u7EBF\u7A0B\u963B\u585E\u5728<code>semaphore.acquire();</code>\u65B9\u6CD5\u5904\uFF0C\u4EE3\u7801\u4E2D\u5BF9\u7EBF\u7A0Bt2\u3001t3\u53D1\u9001\u4E2D\u65AD\u4FE1\u53F7\uFF0C\u6211\u4EEC\u770B\u4E00\u4E0BSemaphore\u4E2Dacquire\u7684\u6E90\u7801\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8FD9\u4E2A\u65B9\u6CD5\u4F1A\u54CD\u5E94\u7EBF\u7A0B\u4E2D\u65AD\uFF0C\u4E3B\u7EBF\u7A0B\u4E2D\u5BF9t2\u3001t3\u53D1\u9001\u4E2D\u65AD\u4FE1\u53F7\u4E4B\u540E\uFF0C<code>acquire()</code>\u65B9\u6CD5\u4F1A\u89E6\u53D1<code>InterruptedException</code>\u5F02\u5E38\uFF0Ct2\u3001t3\u6700\u7EC8\u6CA1\u6709\u83B7\u53D6\u5230\u8BB8\u53EF\uFF0C\u4F46\u662F\u4ED6\u4EEC\u90FD\u6267\u884C\u4E86finally\u4E2D\u7684\u91CA\u653E\u8BB8\u53EF\u7684\u64CD\u4F5C\uFF0C\u6700\u540E\u5BFC\u81F4\u8BB8\u53EF\u6570\u91CF\u53D8\u4E3A\u4E862\uFF0C\u5BFC\u81F4\u8BB8\u53EF\u6570\u91CF\u589E\u52A0\u4E86\u3002\u6240\u4EE5\u7A0B\u5E8F\u4E2D\u91CA\u653E\u8BB8\u53EF\u7684\u65B9\u5F0F\u6709\u95EE\u9898\u3002\u9700\u8981\u6539\u8FDB\u4E00\u4E0B\uFF0C\u83B7\u53D6\u8BB8\u53EF\u6210\u529F\u624D\u53BB\u91CA\u653E\u9501\u3002</p><p><strong>\u6B63\u786E\u7684\u91CA\u653E\u9501\u7684\u65B9\u5F0F\uFF0C\u5982\u4E0B\uFF1A</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Semaphore</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo4</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//\u83B7\u53D6\u8BB8\u53EF\u662F\u5426\u6210\u529F</span>
            <span class="token keyword">boolean</span> acquireSuccess <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                acquireSuccess <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u83B7\u53D6\u8BB8\u53EF,\u5F53\u524D\u53EF\u7528\u8BB8\u53EF\u6570\u91CF:&quot;</span> <span class="token operator">+</span> semaphore<span class="token punctuation">.</span><span class="token function">availablePermits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//\u4F11\u7720100\u79D2</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u8FD0\u884C\u7ED3\u675F!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>acquireSuccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u5F53\u524D\u53EF\u7528\u8BB8\u53EF\u6570\u91CF:&quot;</span> <span class="token operator">+</span> semaphore<span class="token punctuation">.</span><span class="token function">availablePermits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u4F11\u77201\u79D2</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u4F11\u77201\u79D2</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u7ED9t2\u548Ct3\u53D1\u9001\u4E2D\u65AD\u4FE1\u53F7</span>
        t2<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u7A0B\u5E8F\u4E2D\u589E\u52A0\u4E86\u4E00\u4E2A\u53D8\u91CF<code>acquireSuccess</code>\u7528\u6765\u6807\u8BB0\u83B7\u53D6\u8BB8\u53EF\u662F\u5426\u6210\u529F\uFF0C\u5728finally\u4E2D\u6839\u636E\u8FD9\u4E2A\u53D8\u91CF\u662F\u5426\u4E3Atrue\uFF0C\u6765\u786E\u5B9A\u662F\u5426\u91CA\u653E\u8BB8\u53EF\u3002</p><h4 id="_5\u3001\u5728\u89C4\u5B9A\u7684\u65F6\u95F4\u5185\u5E0C\u671B\u83B7\u53D6\u8BB8\u53EF" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u5728\u89C4\u5B9A\u7684\u65F6\u95F4\u5185\u5E0C\u671B\u83B7\u53D6\u8BB8\u53EF" aria-hidden="true">#</a> 5\u3001\u5728\u89C4\u5B9A\u7684\u65F6\u95F4\u5185\u5E0C\u671B\u83B7\u53D6\u8BB8\u53EF</h4><p>\u53F8\u673A\u6765\u5230\u505C\u8F66\u573A\uFF0C\u53D1\u73B0\u505C\u8F66\u573A\u5DF2\u7ECF\u6EE1\u4E86\uFF0C\u53EA\u80FD\u5728\u5916\u7B49\u5F85\u5185\u90E8\u7684\u8F66\u51FA\u6765\u4E4B\u540E\u624D\u80FD\u8FDB\u53BB\uFF0C\u4F46\u662F\u8981\u7B49\u591A\u4E45\uFF0C\u4ED6\u81EA\u5DF1\u4E5F\u4E0D\u77E5\u9053\uFF0C\u4ED6\u5E0C\u671B\u7B4910\u5206\u949F\uFF0C\u5982\u679C\u8FD8\u662F\u65E0\u6CD5\u8FDB\u53BB\uFF0C\u5C31\u4E0D\u5230\u8FD9\u91CC\u505C\u8F66\u4E86\u3002</p><p>Semaphore\u5185\u90E82\u4E2A\u65B9\u6CD5\u53EF\u4EE5\u63D0\u4F9B\u8D85\u65F6\u83B7\u53D6\u8BB8\u53EF\u7684\u529F\u80FD\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token keyword">permits</span><span class="token punctuation">,</span> <span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">)</span>
        <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u6307\u5B9A\u7684\u65F6\u95F4\u5185\u53BB\u5C1D\u8BD5\u83B7\u53D6\u8BB8\u53EF\uFF0C\u5982\u679C\u80FD\u591F\u83B7\u53D6\u5230\uFF0C\u8FD4\u56DEtrue\uFF0C\u83B7\u53D6\u4E0D\u5230\u8FD4\u56DEfalse\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Semaphore</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo5</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">T</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//\u83B7\u53D6\u8BB8\u53EF\u662F\u5426\u6210\u529F</span>
            <span class="token keyword">boolean</span> acquireSuccess <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u5C1D\u8BD5\u57281\u79D2\u5185\u83B7\u53D6\u8BB8\u53EF\uFF0C\u83B7\u53D6\u6210\u529F\u8FD4\u56DEtrue\uFF0C\u5426\u5219\u8FD4\u56DEfalse</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u5C1D\u8BD5\u83B7\u53D6\u8BB8\u53EF,\u5F53\u524D\u53EF\u7528\u8BB8\u53EF\u6570\u91CF:&quot;</span> <span class="token operator">+</span> semaphore<span class="token punctuation">.</span><span class="token function">availablePermits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                acquireSuccess <span class="token operator">=</span> semaphore<span class="token punctuation">.</span><span class="token function">tryAcquire</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//\u83B7\u53D6\u6210\u529F\u6267\u884C\u4E1A\u52A1\u4EE3\u7801</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>acquireSuccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u83B7\u53D6\u8BB8\u53EF\u6210\u529F,\u5F53\u524D\u53EF\u7528\u8BB8\u53EF\u6570\u91CF:&quot;</span> <span class="token operator">+</span> semaphore<span class="token punctuation">.</span><span class="token function">availablePermits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//\u4F11\u77205\u79D2</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> thread<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,\u83B7\u53D6\u8BB8\u53EF\u5931\u8D25,\u5F53\u524D\u53EF\u7528\u8BB8\u53EF\u6570\u91CF:&quot;</span> <span class="token operator">+</span> semaphore<span class="token punctuation">.</span><span class="token function">availablePermits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>acquireSuccess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">T</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u4F11\u77201\u79D2</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u4F11\u77201\u79D2</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">T</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token string">&quot;t3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE3\u7801\u4E2D\u8BB8\u53EF\u6570\u91CF\u4E3A1\uFF0C<code>semaphore.tryAcquire(1, TimeUnit.SECONDS);</code>\uFF1A\u8868\u793A\u5C1D\u8BD5\u57281\u79D2\u5185\u83B7\u53D6\u8BB8\u53EF\uFF0C\u83B7\u53D6\u6210\u529F\u7ACB\u5373\u8FD4\u56DEtrue\uFF0C\u8D85\u8FC71\u79D2\u8FD8\u662F\u83B7\u53D6\u4E0D\u5230\uFF0C\u8FD4\u56DEfalse\u3002\u7EBF\u7A0Bt1\u83B7\u53D6\u8BB8\u53EF\u6210\u529F\uFF0C\u4E4B\u540E\u4F11\u7720\u4E865\u79D2\uFF0C\u4ECE\u8F93\u51FA\u4E2D\u53EF\u4EE5\u770B\u51FAt2\u548Ct3\u90FD\u5C1D\u8BD5\u4E861\u79D2\uFF0C\u83B7\u53D6\u5931\u8D25\u3002</p><h4 id="_6\u3001\u5176\u4ED6\u4E00\u4E9B\u4F7F\u7528\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u5176\u4ED6\u4E00\u4E9B\u4F7F\u7528\u8BF4\u660E" aria-hidden="true">#</a> 6\u3001\u5176\u4ED6\u4E00\u4E9B\u4F7F\u7528\u8BF4\u660E</h4><ol><li>Semaphore\u9ED8\u8BA4\u521B\u5EFA\u7684\u662F\u975E\u516C\u5E73\u7684\u4FE1\u53F7\u91CF\uFF0C\u4EC0\u4E48\u610F\u601D\u5462\uFF1F\u8FD9\u4E2A\u6D89\u53CA\u5230\u516C\u5E73\u4E0E\u975E\u516C\u5E73\u3002\u4E3E\u4E2A\u4F8B\u5B50\uFF1A5\u4E2A\u8F66\u4F4D\uFF0C\u5141\u8BB85\u4E2A\u8F66\u8F86\u8FDB\u53BB\uFF0C\u6765\u4E86100\u8F86\u8F66\uFF0C\u53EA\u80FD\u8FDB\u53BB5\u8F86\uFF0C\u5176\u4ED695\u5728\u5916\u9762\u6392\u961F\u7B49\u7740\u3002\u91CC\u9762\u521A\u597D\u51FA\u6765\u4E861\u8F86\uFF0C\u6B64\u65F6\u521A\u597D\u53C8\u6765\u4E8610\u8F86\u8F66\uFF0C\u8FD910\u8F86\u8F66\u662F\u76F4\u63A5\u63D2\u961F\u5230\u5176\u4ED695\u8F86\u524D\u9762\u53BB\uFF0C\u8FD8\u662F\u523095\u8F86\u540E\u9762\u53BB\u6392\u961F\u5462\uFF1F\u6392\u961F\u5C31\u8868\u793A\u516C\u5E73\uFF0C\u76F4\u63A5\u53BB\u63D2\u961F\u4E89\u62A2\u7B2C\u4E00\u4E2A\uFF0C\u5C31\u8868\u793A\u4E0D\u516C\u5E73\u3002\u5BF9\u4E8E\u505C\u8F66\u573A\uFF0C\u6392\u961F\u80AF\u5B9A\u66F4\u597D\u4E00\u4E9B\u54AF\u3002\u4E0D\u8FC7\u5BF9\u4E8E\u4FE1\u53F7\u91CF\u6765\u8BF4\u4E0D\u516C\u5E73\u7684\u6548\u7387\u66F4\u9AD8\u4E00\u4E9B\uFF0C\u6240\u4EE5\u9ED8\u8BA4\u662F\u4E0D\u516C\u5E73\u7684\u3002</li><li>\u5EFA\u8BAE\u9605\u8BFB\u4EE5\u4E0BSemaphore\u7684\u6E90\u7801\uFF0C\u5BF9\u5E38\u7528\u7684\u65B9\u6CD5\u6709\u4E2A\u4E86\u89E3\uFF0C\u4E0D\u9700\u8981\u90FD\u8BB0\u4F4F\uFF0C\u7528\u7684\u65F6\u5019\u4E5F\u65B9\u4FBF\u67E5\u8BE2\u5C31\u597D\u3002</li><li>\u65B9\u6CD5\u4E2D\u5E26\u6709<code>throws InterruptedException</code>\u58F0\u660E\u7684\uFF0C\u8868\u793A\u8FD9\u4E2A\u65B9\u6CD5\u4F1A\u54CD\u5E94\u7EBF\u7A0B\u4E2D\u65AD\u4FE1\u53F7\uFF0C\u4EC0\u4E48\u610F\u601D\uFF1F\u8868\u793A\u8C03\u7528\u7EBF\u7A0B\u7684<code>interrupt()</code>\u65B9\u6CD5\uFF0C\u4F1A\u8BA9\u8FD9\u4E9B\u65B9\u6CD5\u89E6\u53D1<code>InterruptedException</code>\u5F02\u5E38\uFF0C\u5373\u4F7F\u8FD9\u4E9B\u65B9\u6CD5\u5904\u4E8E\u963B\u585E\u72B6\u6001\uFF0C\u4E5F\u4F1A\u7ACB\u5373\u8FD4\u56DE\uFF0C\u5E76\u629B\u51FA<code>InterruptedException</code>\u5F02\u5E38\uFF0C\u7EBF\u7A0B\u4E2D\u65AD\u4FE1\u53F7\u4E5F\u4F1A\u88AB\u6E05\u9664\u3002</li></ol><h2 id="\u4E5D\u3001java\u5185\u5B58\u6A21\u578B\u4E4Bjmm" tabindex="-1"><a class="header-anchor" href="#\u4E5D\u3001java\u5185\u5B58\u6A21\u578B\u4E4Bjmm" aria-hidden="true">#</a> \u4E5D\u3001Java\u5185\u5B58\u6A21\u578B\u4E4BJMM</h2><p>JMM(java\u5185\u5B58\u6A21\u578B)\uFF0C\u7531\u4E8E\u5E76\u53D1\u7A0B\u5E8F\u8981\u6BD4\u4E32\u884C\u7A0B\u5E8F\u590D\u6742\u5F88\u591A\uFF0C\u5176\u4E2D\u4E00\u4E2A\u91CD\u8981\u539F\u56E0\u662F\u5E76\u53D1\u7A0B\u5E8F\u4E2D\u6570\u636E\u8BBF\u95EE<strong>\u4E00\u81F4\u6027</strong>\u548C<strong>\u5B89\u5168\u6027</strong>\u5C06\u4F1A\u53D7\u5230\u4E25\u91CD\u6311\u6218\u3002**\u5982\u4F55\u4FDD\u8BC1\u4E00\u4E2A\u7EBF\u7A0B\u53EF\u4EE5\u770B\u5230\u6B63\u786E\u7684\u6570\u636E\u5462\uFF1F**\u8FD9\u4E2A\u95EE\u9898\u770B\u8D77\u6765\u5F88\u767D\u75F4\u3002\u5BF9\u4E8E\u4E32\u884C\u7A0B\u5E8F\u6765\u8BF4\uFF0C\u6839\u672C\u5C31\u662F\u5C0F\u83DC\u4E00\u789F\uFF0C\u5982\u679C\u4F60\u8BFB\u53D6\u4E00\u4E2A\u53D8\u91CF\uFF0C\u8FD9\u4E2A\u53D8\u91CF\u7684\u503C\u662F1\uFF0C\u90A3\u4E48\u4F60\u8BFB\u53D6\u5230\u7684\u4E00\u5B9A\u662F1\uFF0C\u5C31\u662F\u8FD9\u4E48\u7B80\u5355\u7684\u95EE\u9898\u5728\u5E76\u884C\u7A0B\u5E8F\u4E2D\u5C45\u7136\u53D8\u5F97\u590D\u6742\u8D77\u6765\u3002\u4E8B\u5B9E\u4E0A\uFF0C\u5982\u679C\u4E0D\u52A0\u63A7\u5236\u5730\u4EFB\u7531\u7EBF\u7A0B\u80E1\u4E71\u5E76\u884C\uFF0C\u5373\u4F7F\u539F\u672C\u662F1\u7684\u6570\u503C\uFF0C\u4F60\u4E5F\u53EF\u80FD\u8BFB\u52302\u3002\u56E0\u6B64\u6211\u4EEC\u9700\u8981\u5728\u6DF1\u5165\u4E86\u89E3\u5E76\u884C\u673A\u5236\u7684\u524D\u63D0\u4E0B\uFF0C\u518D\u5B9A\u4E49\u4E00\u79CD\u89C4\u5219\uFF0C\u4FDD\u8BC1\u591A\u4E2A\u7EBF\u7A0B\u95F4\u53EF\u4EE5\u6709\u5C0F\u5F1F\uFF0C\u6B63\u786E\u5730\u534F\u540C\u5DE5\u4F5C\u3002\u800CJMM\u4E5F\u5C31\u662F\u4E3A\u6B64\u800C\u751F\u7684\u3002</p><h3 id="_1\u3001\u8BA1\u7B97\u673A\u786C\u4EF6\u5B58\u50A8\u4F53\u7CFB" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u8BA1\u7B97\u673A\u786C\u4EF6\u5B58\u50A8\u4F53\u7CFB" aria-hidden="true">#</a> 1\u3001\u8BA1\u7B97\u673A\u786C\u4EF6\u5B58\u50A8\u4F53\u7CFB</h3><p>\u8BA1\u7B97\u673A\u5B58\u50A8\u7ED3\u6784\uFF0C\u4ECE\u672C\u5730\u78C1\u76D8\u5230\u4E3B\u5B58\u5230CPU\u7F13\u5B58\uFF0C\u4E5F\u5C31\u662F\u4ECE\u786C\u76D8\u5230\u5185\u5B58\uFF0C\u5230CPU\u3002\u4E00\u822C\u5BF9\u5E94\u7684\u7A0B\u5E8F\u7684\u64CD\u4F5C\u5C31\u662F\u4ECE\u6570\u636E\u5E93\u67E5\u6570\u636E\u5230\u5185\u5B58\u7136\u540E\u5230CPU\u8FDB\u884C\u8BA1\u7B97</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210917214130116.png" alt="image-20210917214130116"></p><p>\u200B \u56E0\u4E3A\u6709\u8FD9\u4E48\u591A\u7EA7\u7684\u7F13\u5B58(cpu\u548C\u7269\u7406\u4E3B\u5185\u5B58\u7684\u901F\u5EA6\u4E0D\u4E00\u81F4\u7684)\uFF0CCPU\u7684\u8FD0\u884C\u5E76\u4E0D\u662F\u76F4\u63A5\u64CD\u4F5C\u5185\u5B58\u800C\u662F\u5148\u628A\u5185\u5B58\u91CC\u8FB9\u7684\u6570\u636E\u8BFB\u5230\u7F13\u5B58\uFF0C\u800C\u5185\u5B58\u7684\u8BFB\u548C\u5199\u64CD\u4F5C\u7684\u65F6\u5019\u5C31\u4F1A\u9020\u6210\u4E0D\u4E00\u81F4\u7684\u95EE\u9898</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210917214254898.png" alt="image-20210917214254898"></p><p>\u200B Java\u865A\u62DF\u673A\u89C4\u8303\u4E2D\u8BD5\u56FE\u5B9A\u4E49\u4E00\u79CDJava\u5185\u5B58\u6A21\u578B\uFF08java Memory Model\uFF0C\u7B80\u79F0JMM) \u6765\u5C4F\u853D\u6389\u5404\u79CD\u786C\u4EF6\u548C\u64CD\u4F5C\u7CFB\u7EDF\u7684\u5185\u5B58\u8BBF\u95EE\u5DEE\u5F02\uFF0C\u4EE5\u5B9E\u73B0\u8BA9Java\u7A0B\u5E8F\u5728\u5404\u79CD\u5E73\u53F0\u4E0B\u90FD\u80FD\u8FBE\u5230\u4E00\u81F4\u7684\u5185\u5B58\u8BBF\u95EE\u6548\u679C\u3002\u63A8\u5BFC\u51FA\u6211\u4EEC\u9700\u8981\u77E5\u9053JMM</p><h3 id="_2\u3001java\u5185\u5B58\u6A21\u578Bjava-memory-model" tabindex="-1"><a class="header-anchor" href="#_2\u3001java\u5185\u5B58\u6A21\u578Bjava-memory-model" aria-hidden="true">#</a> 2\u3001Java\u5185\u5B58\u6A21\u578BJava Memory Model</h3><p>\u200B JMM(Java\u5185\u5B58\u6A21\u578BJava Memory Model\uFF0C\u7B80\u79F0JMM)\u672C\u8EAB\u662F\u4E00\u79CD\u62BD\u8C61\u7684\u6982\u5FF5\u5E76\u4E0D\u771F\u5B9E\u5B58\u5728\u5B83\u4EC5\u4EC5\u63CF\u8FF0\u7684\u662F\u4E00\u7EC4\u7EA6\u5B9A\u6216\u89C4\u8303\uFF0C\u901A\u8FC7\u8FD9\u7EC4\u89C4\u8303\u5B9A\u4E49\u4E86\u7A0B\u5E8F\u4E2D(\u5C24\u5176\u662F\u591A\u7EBF\u7A0B)\u5404\u4E2A\u53D8\u91CF\u7684\u8BFB\u5199\u8BBF\u95EE\u65B9\u5F0F\u5E76\u51B3\u5B9A\u4E00\u4E2A\u7EBF\u7A0B\u5BF9\u5171\u4EAB\u53D8\u91CF\u7684\u5199\u5165\u4F55\u65F6\u4EE5\u53CA\u5982\u4F55\u53D8\u6210\u5BF9\u53E6\u4E00\u4E2A\u7EBF\u7A0B\u53EF\u89C1\uFF0C\u5173\u952E\u6280\u672F\u70B9\u90FD\u662F\u56F4\u7ED5\u591A\u7EBF\u7A0B\u7684\u539F\u5B50\u6027\u3001\u53EF\u89C1\u6027\u548C\u6709\u5E8F\u6027\u5C55\u5F00\u7684\u3002</p><p>\u539F\u5219\uFF1A JMM\u7684\u5173\u952E\u6280\u672F\u70B9\u90FD\u662F\u56F4\u7ED5\u591A\u7EBF\u7A0B\u7684\u539F\u5B50\u6027\u3001\u53EF\u89C1\u6027\u548C\u6709\u5E8F\u6027\u5C55\u5F00\u7684</p><p>\u80FD\u5E72\u561B\uFF1F 1 \u901A\u8FC7JMM\u6765\u5B9E\u73B0\u7EBF\u7A0B\u548C\u4E3B\u5185\u5B58\u4E4B\u95F4\u7684\u62BD\u8C61\u5173\u7CFB\u3002 2 \u5C4F\u853D\u5404\u4E2A\u786C\u4EF6\u5E73\u53F0\u548C\u64CD\u4F5C\u7CFB\u7EDF\u7684\u5185\u5B58\u8BBF\u95EE\u5DEE\u5F02\u4EE5\u5B9E\u73B0\u8BA9Java\u7A0B\u5E8F\u5728\u5404\u79CD\u5E73\u53F0\u4E0B\u90FD\u80FD\u8FBE\u5230\u4E00\u81F4\u7684\u5185\u5B58\u8BBF\u95EE\u6548\u679C\u3002</p><h3 id="_3\u3001jmm\u89C4\u8303\u4E0B-\u4E09\u5927\u7279\u6027" tabindex="-1"><a class="header-anchor" href="#_3\u3001jmm\u89C4\u8303\u4E0B-\u4E09\u5927\u7279\u6027" aria-hidden="true">#</a> 3\u3001JMM\u89C4\u8303\u4E0B\uFF0C\u4E09\u5927\u7279\u6027</h3><h4 id="_1\u3001\u53EF\u89C1\u6027" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u53EF\u89C1\u6027" aria-hidden="true">#</a> 1\u3001\u53EF\u89C1\u6027</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210917214426713.png" alt="image-20210917214426713"></p><p>\u200B Java\u4E2D\u666E\u901A\u7684\u5171\u4EAB\u53D8\u91CF\u4E0D\u4FDD\u8BC1\u53EF\u89C1\u6027\uFF0C\u56E0\u4E3A\u6570\u636E\u4FEE\u6539\u88AB\u5199\u5165\u5185\u5B58\u7684\u65F6\u673A\u662F\u4E0D\u786E\u5B9A\u7684\uFF0C\u591A\u7EBF\u7A0B\u5E76\u53D1\u4E0B\u5F88\u53EF\u80FD\u51FA\u73B0&quot;\u810F\u8BFB&quot;\uFF0C\u6240\u4EE5\u6BCF\u4E2A\u7EBF\u7A0B\u90FD\u6709\u81EA\u5DF1\u7684\u5DE5\u4F5C\u5185\u5B58\uFF0C\u7EBF\u7A0B\u81EA\u5DF1\u7684\u5DE5\u4F5C\u5185\u5B58\u4E2D\u4FDD\u5B58\u4E86\u8BE5\u7EBF\u7A0B\u4F7F\u7528\u5230\u7684\u53D8\u91CF\u7684\u4E3B\u5185\u5B58\u526F\u672C\u62F7\u8D1D\uFF0C\u7EBF\u7A0B\u5BF9\u53D8\u91CF\u7684\u6240\u6709\u64CD\u4F5C\uFF08\u8BFB\u53D6\uFF0C\u8D4B\u503C\u7B49 \uFF09\u90FD\u5FC5\u9700\u5728\u7EBF\u7A0B\u81EA\u5DF1\u7684\u5DE5\u4F5C\u5185\u5B58\u4E2D\u8FDB\u884C\uFF0C\u800C\u4E0D\u80FD\u591F\u76F4\u63A5\u8BFB\u5199\u4E3B\u5185\u5B58\u4E2D\u7684\u53D8\u91CF\u3002\u4E0D\u540C\u7EBF\u7A0B\u4E4B\u95F4\u4E5F\u65E0\u6CD5\u76F4\u63A5\u8BBF\u95EE\u5BF9\u65B9\u5DE5\u4F5C\u5185\u5B58\u4E2D\u7684\u53D8\u91CF\uFF0C\u7EBF\u7A0B\u95F4\u53D8\u91CF\u503C\u7684\u4F20\u9012\u5747\u9700\u8981\u901A\u8FC7\u4E3B\u5185\u5B58\u6765\u5B8C\u6210</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210917214441440.png" alt="image-20210917214441440"></p><p>\u7EBF\u7A0B\u810F\u8BFB\uFF1A\u5982\u679C\u6CA1\u6709\u53EF\u89C1\u6027\u4FDD\u8BC1</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210917214501491.png" alt="image-20210917214501491"></p><h4 id="_2\u3001\u539F\u5B50\u6027" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u539F\u5B50\u6027" aria-hidden="true">#</a> 2\u3001\u539F\u5B50\u6027</h4><p>\u6307\u4E00\u4E2A\u64CD\u4F5C\u662F\u4E0D\u53EF\u4E2D\u65AD\u7684\uFF0C\u5373\u591A\u7EBF\u7A0B\u73AF\u5883\u4E0B\uFF0C\u64CD\u4F5C\u4E0D\u80FD\u88AB\u5176\u4ED6\u7EBF\u7A0B\u5E72\u6270</p><p>\u539F\u5B50\u6027\u662F\u6307<strong>\u64CD\u4F5C\u662F\u4E0D\u53EF\u5206\u7684</strong>\uFF0C\u8981\u4E48\u5168\u90E8\u4E00\u8D77\u6267\u884C\uFF0C\u8981\u4E48\u4E0D\u6267\u884C\u3002\u5728java\u4E2D\uFF0C\u5176\u8868\u73B0\u5728\u5BF9\u4E8E\u5171\u4EAB\u53D8\u91CF\u7684\u67D0\u4E9B\u64CD\u4F5C\uFF0C\u662F\u4E0D\u53EF\u5206\u7684\uFF0C\u5FC5\u987B\u8FDE\u7EED\u7684\u5B8C\u6210\u3002\u6BD4\u5982a++\uFF0C\u5BF9\u4E8E\u5171\u4EAB\u53D8\u91CFa\u7684\u64CD\u4F5C\uFF0C\u5B9E\u9645\u4E0A\u4F1A\u6267\u884C3\u4E2A\u6B65\u9AA4\uFF1A</p><p>1.\u8BFB\u53D6\u53D8\u91CFa\u7684\u503C\uFF0C\u5047\u5982a=1 2.a\u7684\u503C+1\uFF0C\u4E3A2 3.\u5C062\u503C\u8D4B\u503C\u7ED9\u53D8\u91CFa\uFF0C\u6B64\u65F6a\u7684\u503C\u5E94\u8BE5\u4E3A2</p><p>\u8FD9\u4E09\u4E2A\u64CD\u4F5C\u4E2D\u4EFB\u610F\u4E00\u4E2A\u64CD\u4F5C\uFF0Ca\u7684\u503C\u5982\u679C\u88AB\u5176\u4ED6\u7EBF\u7A0B\u7BE1\u6539\u4E86\uFF0C\u90A3\u4E48\u90FD\u4F1A\u51FA\u73B0\u6211\u4EEC\u4E0D\u5E0C\u671B\u51FA\u73B0\u7684\u7ED3\u679C\u3002\u6240\u4EE5\u5FC5\u987B\u4FDD\u8BC1\u8FD93\u4E2A\u64CD\u4F5C\u662F\u539F\u5B50\u6027\u7684\uFF0C\u5728\u64CD\u4F5Ca++\u7684\u8FC7\u7A0B\u4E2D\uFF0C\u5176\u4ED6\u7EBF\u7A0B\u4E0D\u4F1A\u6539\u53D8a\u7684\u503C\uFF0C\u5982\u679C\u5728\u4E0A\u9762\u7684\u8FC7\u7A0B\u4E2D\u51FA\u73B0\u5176\u4ED6\u7EBF\u7A0B\u4FEE\u6539\u4E86a\u7684\u503C\uFF0C\u5728\u6EE1\u8DB3\u539F\u5B50\u6027\u7684\u539F\u5219\u4E0B\uFF0C\u4E0A\u9762\u7684\u64CD\u4F5C\u5E94\u8BE5\u5931\u8D25\u3002</p><h4 id="_3\u3001\u6709\u5E8F\u6027" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u6709\u5E8F\u6027" aria-hidden="true">#</a> 3\u3001\u6709\u5E8F\u6027</h4><p>\u5BF9\u4E8E\u4E00\u4E2A\u7EBF\u7A0B\u7684\u6267\u884C\u4EE3\u7801\u800C\u8A00\uFF0C\u6211\u4EEC\u603B\u662F\u4E60\u60EF\u6027\u8BA4\u4E3A\u4EE3\u7801\u7684\u6267\u884C\u603B\u662F\u4ECE\u4E0A\u5230\u4E0B\uFF0C\u6709\u5E8F\u6267\u884C\u3002 \u4F46\u4E3A\u4E86\u63D0\u4F9B\u6027\u80FD\uFF0C\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u901A\u5E38\u4F1A\u5BF9\u6307\u4EE4\u5E8F\u5217\u8FDB\u884C\u91CD\u65B0\u6392\u5E8F\u3002 \u6307\u4EE4\u91CD\u6392\u53EF\u4EE5\u4FDD\u8BC1\u4E32\u884C\u8BED\u4E49\u4E00\u81F4\uFF0C\u4F46\u6CA1\u6709\u4E49\u52A1\u4FDD\u8BC1\u591A\u7EBF\u7A0B\u95F4\u7684\u8BED\u4E49\u4E5F\u4E00\u81F4\uFF0C\u5373\u53EF\u80FD\u4EA7\u751F&quot;\u810F\u8BFB&quot;\uFF0C\u7B80\u5355\u8BF4\uFF0C \u4E24\u884C\u4EE5\u4E0A\u4E0D\u76F8\u5E72\u7684\u4EE3\u7801\u5728\u6267\u884C\u7684\u65F6\u5019\u6709\u53EF\u80FD\u5148\u6267\u884C\u7684\u4E0D\u662F\u7B2C\u4E00\u6761\uFF0C\u4E0D\u89C1\u5F97\u662F\u4ECE\u4E0A\u5230\u4E0B\u987A\u5E8F\u6267\u884C\uFF0C\u6267\u884C\u987A\u5E8F\u4F1A\u88AB\u4F18\u5316\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210917214606690.png" alt="image-20210917214606690"></p><p>\u5355\u7EBF\u7A0B\u73AF\u5883\u91CC\u9762\u786E\u4FDD\u7A0B\u5E8F\u6700\u7EC8\u6267\u884C\u7ED3\u679C\u548C\u4EE3\u7801\u987A\u5E8F\u6267\u884C\u7684\u7ED3\u679C\u4E00\u81F4\u3002 \u5904\u7406\u5668\u5728\u8FDB\u884C\u91CD\u6392\u5E8F\u65F6\u5FC5\u987B\u8981\u8003\u8651\u6307\u4EE4\u4E4B\u95F4\u7684\u6570\u636E\u4F9D\u8D56\u6027 \u591A\u7EBF\u7A0B\u73AF\u5883\u4E2D\u7EBF\u7A0B\u4EA4\u66FF\u6267\u884C,\u7531\u4E8E\u7F16\u8BD1\u5668\u4F18\u5316\u91CD\u6392\u7684\u5B58\u5728\uFF0C\u4E24\u4E2A\u7EBF\u7A0B\u4E2D\u4F7F\u7528\u7684\u53D8\u91CF\u80FD\u5426\u4FDD\u8BC1\u4E00\u81F4\u6027\u662F\u65E0\u6CD5\u786E\u5B9A\u7684,\u7ED3\u679C\u65E0\u6CD5\u9884\u6D4B</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210917214623939.png" alt="image-20210917214623939"></p><h3 id="_4\u3001jmm\u89C4\u8303\u4E0B-\u591A\u7EBF\u7A0B\u5BF9\u53D8\u91CF\u7684\u8BFB\u5199\u8FC7\u7A0B" tabindex="-1"><a class="header-anchor" href="#_4\u3001jmm\u89C4\u8303\u4E0B-\u591A\u7EBF\u7A0B\u5BF9\u53D8\u91CF\u7684\u8BFB\u5199\u8FC7\u7A0B" aria-hidden="true">#</a> 4\u3001JMM\u89C4\u8303\u4E0B\uFF0C\u591A\u7EBF\u7A0B\u5BF9\u53D8\u91CF\u7684\u8BFB\u5199\u8FC7\u7A0B</h3><h4 id="_1\u3001\u8BFB\u53D6\u8FC7\u7A0B" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u8BFB\u53D6\u8FC7\u7A0B" aria-hidden="true">#</a> 1\u3001\u8BFB\u53D6\u8FC7\u7A0B</h4><p>\u200B \u7531\u4E8EJVM\u8FD0\u884C\u7A0B\u5E8F\u7684\u5B9E\u4F53\u662F\u7EBF\u7A0B\uFF0C\u800C\u6BCF\u4E2A\u7EBF\u7A0B\u521B\u5EFA\u65F6JVM\u90FD\u4F1A\u4E3A\u5176\u521B\u5EFA\u4E00\u4E2A\u5DE5\u4F5C\u5185\u5B58(\u6709\u4E9B\u5730\u65B9\u79F0\u4E3A\u6808\u7A7A\u95F4)\uFF0C\u5DE5\u4F5C\u5185\u5B58\u662F\u6BCF\u4E2A\u7EBF\u7A0B\u7684\u79C1\u6709\u6570\u636E\u533A\u57DF\uFF0C\u800CJava\u5185\u5B58\u6A21\u578B\u4E2D\u89C4\u5B9A\u6240\u6709\u53D8\u91CF\u90FD\u5B58\u50A8\u5728\u4E3B\u5185\u5B58\uFF0C\u4E3B\u5185\u5B58\u662F\u5171\u4EAB\u5185\u5B58\u533A\u57DF\uFF0C\u6240\u6709\u7EBF\u7A0B\u90FD\u53EF\u4EE5\u8BBF\u95EE\uFF0C\u4F46\u7EBF\u7A0B\u5BF9\u53D8\u91CF\u7684\u64CD\u4F5C(\u8BFB\u53D6\u8D4B\u503C\u7B49)\u5FC5\u987B\u5728\u5DE5\u4F5C\u5185\u5B58\u4E2D\u8FDB\u884C\uFF0C\u9996\u5148\u8981\u5C06\u53D8\u91CF\u4ECE\u4E3B\u5185\u5B58\u62F7\u8D1D\u5230\u7684\u7EBF\u7A0B\u81EA\u5DF1\u7684\u5DE5\u4F5C\u5185\u5B58\u7A7A\u95F4\uFF0C\u7136\u540E\u5BF9\u53D8\u91CF\u8FDB\u884C\u64CD\u4F5C\uFF0C\u64CD\u4F5C\u5B8C\u6210\u540E\u518D\u5C06\u53D8\u91CF\u5199\u56DE\u4E3B\u5185\u5B58\uFF0C\u4E0D\u80FD\u76F4\u63A5\u64CD\u4F5C\u4E3B\u5185\u5B58\u4E2D\u7684\u53D8\u91CF\uFF0C\u5404\u4E2A\u7EBF\u7A0B\u4E2D\u7684\u5DE5\u4F5C\u5185\u5B58\u4E2D\u5B58\u50A8\u7740\u4E3B\u5185\u5B58\u4E2D\u7684\u53D8\u91CF\u526F\u672C\u62F7\u8D1D\uFF0C\u56E0\u6B64\u4E0D\u540C\u7684\u7EBF\u7A0B\u95F4\u65E0\u6CD5\u8BBF\u95EE\u5BF9\u65B9\u7684\u5DE5\u4F5C\u5185\u5B58\uFF0C\u7EBF\u7A0B\u95F4\u7684\u901A\u4FE1(\u4F20\u503C)\u5FC5\u987B\u901A\u8FC7\u4E3B\u5185\u5B58\u6765\u5B8C\u6210\uFF0C\u5176\u7B80\u8981\u8BBF\u95EE\u8FC7\u7A0B\u5982\u4E0B\u56FE:</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210917214744040.png" alt="image-20210917214744040"></p><p>JMM\u5B9A\u4E49\u4E86\u7EBF\u7A0B\u548C\u4E3B\u5185\u5B58\u4E4B\u95F4\u7684\u62BD\u8C61\u5173\u7CFB 1 \u7EBF\u7A0B\u4E4B\u95F4\u7684\u5171\u4EAB\u53D8\u91CF\u5B58\u50A8\u5728\u4E3B\u5185\u5B58\u4E2D(\u4ECE\u786C\u4EF6\u89D2\u5EA6\u6765\u8BF4\u5C31\u662F\u5185\u5B58\u6761) 2 \u6BCF\u4E2A\u7EBF\u7A0B\u90FD\u6709\u4E00\u4E2A\u79C1\u6709\u7684\u672C\u5730\u5DE5\u4F5C\u5185\u5B58\uFF0C\u672C\u5730\u5DE5\u4F5C\u5185\u5B58\u4E2D\u5B58\u50A8\u4E86\u8BE5\u7EBF\u7A0B\u7528\u6765\u8BFB/\u5199\u5171\u4EAB\u53D8\u91CF\u7684\u526F\u672C(\u4ECE\u786C\u4EF6\u89D2\u5EA6\u6765\u8BF4\u5C31\u662FCPU\u7684\u7F13\u5B58\uFF0C\u6BD4\u5982\u5BC4\u5B58\u5668\u3001L1\u3001L2\u3001L3\u7F13\u5B58\u7B49)</p><h4 id="_2\u3001\u5C0F\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5C0F\u603B\u7ED3" aria-hidden="true">#</a> 2\u3001\u5C0F\u603B\u7ED3</h4><ul><li>\u6211\u4EEC\u5B9A\u4E49\u7684\u6240\u6709\u5171\u4EAB\u53D8\u91CF\u90FD\u50A8\u5B58\u5728\u7269\u7406\u4E3B\u5185\u5B58\u4E2D</li><li>\u6BCF\u4E2A\u7EBF\u7A0B\u90FD\u6709\u81EA\u5DF1\u72EC\u7ACB\u7684\u5DE5\u4F5C\u5185\u5B58\uFF0C\u91CC\u9762\u4FDD\u5B58\u8BE5\u7EBF\u7A0B\u4F7F\u7528\u5230\u7684\u53D8\u91CF\u7684\u526F\u672C(\u4E3B\u5185\u5B58\u4E2D\u8BE5\u53D8\u91CF\u7684\u4E00\u4EFD\u62F7\u8D1D)</li><li>\u7EBF\u7A0B\u5BF9\u5171\u4EAB\u53D8\u91CF\u6240\u6709\u7684\u64CD\u4F5C\u90FD\u5FC5\u987B\u5148\u5728\u7EBF\u7A0B\u81EA\u5DF1\u7684\u5DE5\u4F5C\u5185\u5B58\u4E2D\u8FDB\u884C\u540E\u5199\u56DE\u4E3B\u5185\u5B58\uFF0C\u4E0D\u80FD\u76F4\u63A5\u4ECE\u4E3B\u5185\u5B58\u4E2D\u8BFB\u5199(\u4E0D\u80FD\u8D8A\u7EA7)</li><li>\u4E0D\u540C\u7EBF\u7A0B\u4E4B\u95F4\u4E5F\u65E0\u6CD5\u76F4\u63A5\u8BBF\u95EE\u5176\u4ED6\u7EBF\u7A0B\u7684\u5DE5\u4F5C\u5185\u5B58\u4E2D\u7684\u53D8\u91CF\uFF0C\u7EBF\u7A0B\u95F4\u53D8\u91CF\u503C\u7684\u4F20\u9012\u9700\u8981\u901A\u8FC7\u4E3B\u5185\u5B58\u6765\u8FDB\u884C(\u540C\u7EA7\u4E0D\u80FD\u76F8\u4E92\u8BBF\u95EE)</li></ul><h3 id="_5\u3001jmm\u89C4\u8303\u4E0B-\u591A\u7EBF\u7A0B\u5148\u884C\u53D1\u751F\u539F\u5219\u4E4Bhappens-before" tabindex="-1"><a class="header-anchor" href="#_5\u3001jmm\u89C4\u8303\u4E0B-\u591A\u7EBF\u7A0B\u5148\u884C\u53D1\u751F\u539F\u5219\u4E4Bhappens-before" aria-hidden="true">#</a> 5\u3001JMM\u89C4\u8303\u4E0B\uFF0C\u591A\u7EBF\u7A0B\u5148\u884C\u53D1\u751F\u539F\u5219\u4E4Bhappens-before</h3><p>\u5728JMM\u4E2D\uFF0C\u5982\u679C\u4E00\u4E2A\u64CD\u4F5C\u6267\u884C\u7684\u7ED3\u679C\u9700\u8981\u5BF9\u53E6\u4E00\u4E2A\u64CD\u4F5C\u53EF\u89C1\u6027\u6216\u8005 \u4EE3\u7801\u91CD\u6392\u5E8F\uFF0C\u90A3\u4E48\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u4E4B\u95F4\u5FC5\u987B\u5B58\u5728happens-before\u5173\u7CFB\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210917214911737.png" alt="image-20210917214911737"></p><h4 id="_1\u3001\u5148\u884C\u53D1\u751F\u539F\u5219\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5148\u884C\u53D1\u751F\u539F\u5219\u8BF4\u660E" aria-hidden="true">#</a> 1\u3001\u5148\u884C\u53D1\u751F\u539F\u5219\u8BF4\u660E</h4><p>\u200B \u5982\u679CJava\u5185\u5B58\u6A21\u578B\u4E2D\u6240\u6709\u7684\u6709\u5E8F\u6027\u90FD\u4EC5\u9760volatile\u548Csynchronized\u6765\u5B8C\u6210\uFF0C\u90A3\u4E48\u6709\u5F88\u591A\u64CD\u4F5C\u90FD\u5C06\u4F1A\u53D8\u5F97\u975E\u5E38\u5570\u55E6\uFF0C \u4F46\u662F\u6211\u4EEC\u5728\u7F16\u5199Java\u5E76\u53D1\u4EE3\u7801\u7684\u65F6\u5019\u5E76\u6CA1\u6709\u5BDF\u89C9\u5230\u8FD9\u4E00\u70B9\u3002</p><p>\u200B \u6211\u4EEC\u6CA1\u6709\u65F6\u65F6\u3001\u5904\u5904\u3001\u6B21\u6B21\uFF0C\u6DFB\u52A0volatile\u548Csynchronized\u6765\u5B8C\u6210\u7A0B\u5E8F\uFF0C\u8FD9\u662F\u56E0\u4E3AJava\u8BED\u8A00\u4E2DJMM\u539F\u5219\u4E0B\u6709\u4E00\u4E2A\u201C\u5148\u884C\u53D1\u751F\u201D(Happens-Before)\u7684\u539F\u5219\u9650\u5236\u548C\u89C4\u77E9</p><p>\u8FD9\u4E2A\u539F\u5219\u975E\u5E38\u91CD\u8981\uFF1A \u5B83\u662F\u5224\u65AD\u6570\u636E\u662F\u5426\u5B58\u5728\u7ADE\u4E89\uFF0C\u7EBF\u7A0B\u662F\u5426\u5B89\u5168\u7684\u975E\u5E38\u6709\u7528\u7684\u624B\u6BB5\u3002\u4F9D\u8D56\u8FD9\u4E2A\u539F\u5219\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7\u51E0\u6761\u7B80\u5355\u89C4\u5219\u4E00\u63FD\u5B50\u89E3\u51B3\u5E76\u53D1\u73AF\u5883\u4E0B\u4E24\u4E2A\u64CD \u4F5C\u4E4B\u95F4\u662F\u5426\u53EF\u80FD\u5B58\u5728\u51B2\u7A81\u7684\u6240\u6709\u95EE\u9898\uFF0C\u800C\u4E0D\u9700\u8981\u9677\u5165Java\u5185\u5B58\u6A21\u578B\u82E6\u6DA9\u96BE\u61C2\u7684\u5E95\u5C42\u7F16\u8BD1\u539F\u7406\u4E4B\u4E2D\u3002</p><h4 id="_2\u3001happens-before\u603B\u539F\u5219" tabindex="-1"><a class="header-anchor" href="#_2\u3001happens-before\u603B\u539F\u5219" aria-hidden="true">#</a> 2\u3001happens-before\u603B\u539F\u5219</h4><ul><li>\u5982\u679C\u4E00\u4E2A\u64CD\u4F5Chappens-before\u53E6\u4E00\u4E2A\u64CD\u4F5C\uFF0C\u90A3\u4E48\u7B2C\u4E00\u4E2A\u64CD\u4F5C\u7684\u6267\u884C\u7ED3\u679C\u5C06\u5BF9\u7B2C\u4E8C\u4E2A\u64CD\u4F5C\u53EF\u89C1\uFF0C\u800C\u4E14\u7B2C\u4E00\u4E2A\u64CD\u4F5C\u7684\u6267\u884C\u987A\u5E8F\u6392\u5728\u7B2C\u4E8C\u4E2A\u64CD\u4F5C\u4E4B\u524D\u3002</li><li>\u4E24\u4E2A\u64CD\u4F5C\u4E4B\u95F4\u5B58\u5728happens-before\u5173\u7CFB\uFF0C\u5E76\u4E0D\u610F\u5473\u7740\u4E00\u5B9A\u8981\u6309\u7167happens-before\u539F\u5219\u5236\u5B9A\u7684\u987A\u5E8F\u6765\u6267\u884C\u3002\u5982\u679C\u91CD\u6392\u5E8F\u4E4B\u540E\u7684\u6267\u884C\u7ED3\u679C\u4E0E\u6309\u7167happens-before\u5173\u7CFB\u6765\u6267\u884C\u7684\u7ED3\u679C\u4E00\u81F4\uFF0C\u90A3\u4E48\u8FD9\u79CD\u91CD\u6392\u5E8F\u5E76\u4E0D\u975E\u6CD5\u3002 <ul><li>1+2+3 = 3+2+1</li><li>\u5468\u4E00\u5F20\u4E09\u5468\u4E8C\u674E\u56DB\uFF0C\u5047\u5982\u6709\u4E8B\u60C5\u8C03\u6362\u73ED\u53EF\u4EE5\u7684</li></ul></li></ul><h3 id="_6\u3001happens-before\u4E4B8\u6761" tabindex="-1"><a class="header-anchor" href="#_6\u3001happens-before\u4E4B8\u6761" aria-hidden="true">#</a> 6\u3001happens-before\u4E4B8\u6761</h3><h4 id="_1\u3001\u6B21\u5E8F\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u6B21\u5E8F\u89C4\u5219" aria-hidden="true">#</a> 1\u3001\u6B21\u5E8F\u89C4\u5219</h4><p>\u4E00\u4E2A\u7EBF\u7A0B\u5185\uFF0C\u6309\u7167\u4EE3\u7801\u987A\u5E8F\uFF0C\u5199\u5728\u524D\u9762\u7684\u64CD\u4F5C\u5148\u884C\u53D1\u751F\u4E8E\u5199\u5728\u540E\u9762\u7684\u64CD\u4F5C\uFF1B</p><p>\u524D\u4E00\u4E2A\u64CD\u4F5C\u7684\u7ED3\u679C\u53EF\u4EE5\u88AB\u540E\u7EED\u7684\u64CD\u4F5C\u83B7\u53D6\u3002\u8BB2\u767D\u70B9\u5C31\u662F\u524D\u9762\u4E00\u4E2A\u64CD\u4F5C\u628A\u53D8\u91CFX\u8D4B\u503C\u4E3A1\uFF0C\u90A3\u540E\u9762\u4E00\u4E2A\u64CD\u4F5C\u80AF\u5B9A\u80FD\u77E5\u9053X\u5DF2\u7ECF\u53D8\u6210\u4E861\u3002</p><h4 id="_2\u3001\u9501\u5B9A\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u9501\u5B9A\u89C4\u5219" aria-hidden="true">#</a> 2\u3001\u9501\u5B9A\u89C4\u5219</h4><p>\u4E00\u4E2AunLock\u64CD\u4F5C\u5148\u884C\u53D1\u751F\u4E8E\u540E\u9762((\u8FD9\u91CC\u7684\u201C\u540E\u9762\u201D\u662F\u6307\u65F6\u95F4\u4E0A\u7684\u5148\u540E))\u5BF9\u540C\u4E00\u4E2A\u9501\u7684lock\u64CD\u4F5C\uFF1B</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HappenBeforeDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Object</span> objectLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//\u5BF9\u4E8E\u540C\u4E00\u628A\u9501objectLock\uFF0CthreadA\u4E00\u5B9A\u5148unlock\u540C\u4E00\u628A\u9501\u540EB\u624D\u80FD\u83B7\u5F97\u8BE5\u9501\uFF0C   A \u5148\u884C\u53D1\u751F\u4E8EB</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLock<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3\u3001volatile\u53D8\u91CF\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#_3\u3001volatile\u53D8\u91CF\u89C4\u5219" aria-hidden="true">#</a> 3\u3001volatile\u53D8\u91CF\u89C4\u5219</h4><p>\u5BF9\u4E00\u4E2Avolatile\u53D8\u91CF\u7684\u5199\u64CD\u4F5C\u5148\u884C\u53D1\u751F\u4E8E\u540E\u9762\u5BF9\u8FD9\u4E2A\u53D8\u91CF\u7684\u8BFB\u64CD\u4F5C\uFF0C\u524D\u9762\u7684\u5199\u5BF9\u540E\u9762\u7684\u8BFB\u662F\u53EF\u89C1\u7684\uFF0C\u8FD9\u91CC\u7684\u201C\u540E\u9762\u201D\u540C\u6837\u662F\u6307\u65F6\u95F4\u4E0A\u7684\u5148\u540E\u3002</p><h4 id="_4\u3001\u4F20\u9012\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u4F20\u9012\u89C4\u5219" aria-hidden="true">#</a> 4\u3001\u4F20\u9012\u89C4\u5219</h4><p>\u5982\u679C\u64CD\u4F5CA\u5148\u884C\u53D1\u751F\u4E8E\u64CD\u4F5CB\uFF0C\u800C\u64CD\u4F5CB\u53C8\u5148\u884C\u53D1\u751F\u4E8E\u64CD\u4F5CC\uFF0C\u5219\u53EF\u4EE5\u5F97\u51FA\u64CD\u4F5CA\u5148\u884C\u53D1\u751F\u4E8E\u64CD\u4F5CC\uFF1B</p><h4 id="_5\u3001\u7EBF\u7A0B\u542F\u52A8\u89C4\u5219-thread-start-rule" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u7EBF\u7A0B\u542F\u52A8\u89C4\u5219-thread-start-rule" aria-hidden="true">#</a> 5\u3001\u7EBF\u7A0B\u542F\u52A8\u89C4\u5219(Thread Start Rule)</h4><p>Thread\u5BF9\u8C61\u7684start()\u65B9\u6CD5\u5148\u884C\u53D1\u751F\u4E8E\u6B64\u7EBF\u7A0B\u7684\u6BCF\u4E00\u4E2A\u52A8\u4F5C</p><h4 id="_6\u3001\u7EBF\u7A0B\u4E2D\u65AD\u89C4\u5219-thread-interruption-rule" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u7EBF\u7A0B\u4E2D\u65AD\u89C4\u5219-thread-interruption-rule" aria-hidden="true">#</a> 6\u3001\u7EBF\u7A0B\u4E2D\u65AD\u89C4\u5219(Thread Interruption Rule)</h4><p>\u5BF9\u7EBF\u7A0Binterrupt()\u65B9\u6CD5\u7684\u8C03\u7528\u5148\u884C\u53D1\u751F\u4E8E\u88AB\u4E2D\u65AD\u7EBF\u7A0B\u7684\u4EE3\u7801\u68C0\u6D4B\u5230\u4E2D\u65AD\u4E8B\u4EF6\u7684\u53D1\u751F\uFF1B</p><p>\u53EF\u4EE5\u901A\u8FC7Thread.interrupted()\u68C0\u6D4B\u5230\u662F\u5426\u53D1\u751F\u4E2D\u65AD</p><h4 id="_7\u3001\u7EBF\u7A0B\u7EC8\u6B62\u89C4\u5219-thread-termination-rule" tabindex="-1"><a class="header-anchor" href="#_7\u3001\u7EBF\u7A0B\u7EC8\u6B62\u89C4\u5219-thread-termination-rule" aria-hidden="true">#</a> 7\u3001\u7EBF\u7A0B\u7EC8\u6B62\u89C4\u5219(Thread Termination Rule)</h4><p>\u7EBF\u7A0B\u4E2D\u7684\u6240\u6709\u64CD\u4F5C\u90FD\u5148\u884C\u53D1\u751F\u4E8E\u5BF9\u6B64\u7EBF\u7A0B\u7684\u7EC8\u6B62\u68C0\u6D4B\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7Thread::join()\u65B9\u6CD5\u662F\u5426\u7ED3\u675F\u3001 Thread::isAlive()\u7684\u8FD4\u56DE\u503C\u7B49\u624B\u6BB5\u68C0\u6D4B\u7EBF\u7A0B\u662F\u5426\u5DF2\u7ECF\u7EC8\u6B62\u6267\u884C\u3002</p><h4 id="_8\u3001\u5BF9\u8C61\u7EC8\u7ED3\u89C4\u5219-finalizer-rule" tabindex="-1"><a class="header-anchor" href="#_8\u3001\u5BF9\u8C61\u7EC8\u7ED3\u89C4\u5219-finalizer-rule" aria-hidden="true">#</a> 8\u3001\u5BF9\u8C61\u7EC8\u7ED3\u89C4\u5219(Finalizer Rule)</h4><p>\u4E00\u4E2A\u5BF9\u8C61\u7684\u521D\u59CB\u5316\u5B8C\u6210\uFF08\u6784\u9020\u51FD\u6570\u6267\u884C\u7ED3\u675F\uFF09\u5148\u884C\u53D1\u751F\u4E8E\u5B83\u7684finalize()\u65B9\u6CD5\u7684\u5F00\u59CB</p><p>\u5BF9\u8C61\u6CA1\u6709\u5B8C\u6210\u521D\u59CB\u5316\u4E4B\u524D\uFF0C\u662F\u4E0D\u80FD\u8C03\u7528finalized()\u65B9\u6CD5\u7684</p><h3 id="_7\u3001\u6848\u4F8B\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_7\u3001\u6848\u4F8B\u8BF4\u660E" aria-hidden="true">#</a> 7\u3001\u6848\u4F8B\u8BF4\u660E</h3><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210917215555073.png" alt="image-20210917215555073"></p><p>\u200B \u5047\u8BBE\u5B58\u5728\u7EBF\u7A0BA\u548CB\uFF0C\u7EBF\u7A0BA\u5148\uFF08\u65F6\u95F4\u4E0A\u7684\u5148\u540E\uFF09\u8C03\u7528\u4E86setValue(1)\uFF0C\u7136\u540E\u7EBF\u7A0BB\u8C03\u7528\u4E86\u540C\u4E00\u4E2A\u5BF9\u8C61\u7684getValue()\uFF0C\u90A3\u4E48\u7EBF\u7A0BB\u6536\u5230\u7684\u8FD4\u56DE\u503C\u662F\u4EC0\u4E48\uFF1F</p><p>\u6211\u4EEC\u5C31\u8FD9\u6BB5\u7B80\u5355\u7684\u4EE3\u7801\u4E00\u6B21\u5206\u6790happens-before\u7684\u89C4\u5219\uFF08\u89C4\u52195\u30016\u30017\u30018 \u53EF\u4EE5\u5FFD\u7565\uFF0C\u56E0\u4E3A\u4ED6\u4EEC\u548C\u8FD9\u6BB5\u4EE3\u7801\u6BEB\u65E0\u5173\u7CFB\uFF09\uFF1A 1 \u7531\u4E8E\u4E24\u4E2A\u65B9\u6CD5\u662F\u7531\u4E0D\u540C\u7684\u7EBF\u7A0B\u8C03\u7528\uFF0C\u4E0D\u5728\u540C\u4E00\u4E2A\u7EBF\u7A0B\u4E2D\uFF0C\u6240\u4EE5\u80AF\u5B9A\u4E0D\u6EE1\u8DB3\u7A0B\u5E8F\u6B21\u5E8F\u89C4\u5219\uFF1B 2 \u4E24\u4E2A\u65B9\u6CD5\u90FD\u6CA1\u6709\u4F7F\u7528\u9501\uFF0C\u6240\u4EE5\u4E0D\u6EE1\u8DB3\u9501\u5B9A\u89C4\u5219\uFF1B 3 \u53D8\u91CF\u4E0D\u662F\u7528volatile\u4FEE\u9970\u7684\uFF0C\u6240\u4EE5volatile\u53D8\u91CF\u89C4\u5219\u4E0D\u6EE1\u8DB3\uFF1B 4 \u4F20\u9012\u89C4\u5219\u80AF\u5B9A\u4E0D\u6EE1\u8DB3\uFF1B</p><p>\u200B \u6240\u4EE5\u6211\u4EEC\u65E0\u6CD5\u901A\u8FC7happens-before\u539F\u5219\u63A8\u5BFC\u51FA\u7EBF\u7A0BA happens-before\u7EBF\u7A0BB\uFF0C\u867D\u7136\u53EF\u4EE5\u786E\u8BA4\u5728\u65F6\u95F4\u4E0A\u7EBF\u7A0BA\u4F18\u5148\u4E8E\u7EBF\u7A0BB\u6307\u5B9A\uFF0C\u4F46\u5C31\u662F\u65E0\u6CD5\u786E\u8BA4\u7EBF\u7A0BB\u83B7\u5F97\u7684\u7ED3\u679C\u662F\u4EC0\u4E48\uFF0C\u6240\u4EE5\u8FD9\u6BB5\u4EE3\u7801\u4E0D\u662F\u7EBF\u7A0B\u5B89\u5168\u7684\u3002\u90A3\u4E48\u600E\u4E48\u4FEE\u590D\u8FD9\u6BB5\u4EE3\u7801\u5462\uFF1F</p><ul><li>\u628Agetter/setter\u65B9\u6CD5\u90FD\u5B9A\u4E49\u4E3Asynchronized\u65B9\u6CD5</li><li>\u628Avalue\u5B9A\u4E49\u4E3Avolatile\u53D8\u91CF\uFF0C\u7531\u4E8Esetter\u65B9\u6CD5\u5BF9value\u7684\u4FEE\u6539\u4E0D\u4F9D\u8D56value\u7684\u539F\u503C\uFF0C\u6EE1\u8DB3volatile\u5173\u952E\u5B57\u4F7F\u7528\u573A\u666F</li></ul><h2 id="\u5341\u3001volatile\u4E0Ejava\u5185\u5B58\u6A21\u578B" tabindex="-1"><a class="header-anchor" href="#\u5341\u3001volatile\u4E0Ejava\u5185\u5B58\u6A21\u578B" aria-hidden="true">#</a> \u5341\u3001volatile\u4E0EJava\u5185\u5B58\u6A21\u578B</h2><h3 id="_1\u3001\u88ABvolatile\u4FEE\u6539\u7684\u53D8\u91CF\u67092\u5927\u7279\u70B9" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u88ABvolatile\u4FEE\u6539\u7684\u53D8\u91CF\u67092\u5927\u7279\u70B9" aria-hidden="true">#</a> 1\u3001\u88ABvolatile\u4FEE\u6539\u7684\u53D8\u91CF\u67092\u5927\u7279\u70B9</h3><ul><li>\u53EF\u89C1\u6027</li><li>\u6709\u5E8F\u6027</li></ul><h3 id="_2\u3001volatile\u7684\u5185\u5B58\u8BED\u4E49" tabindex="-1"><a class="header-anchor" href="#_2\u3001volatile\u7684\u5185\u5B58\u8BED\u4E49" aria-hidden="true">#</a> 2\u3001volatile\u7684\u5185\u5B58\u8BED\u4E49</h3><ul><li>\u5F53\u5199\u4E00\u4E2Avolatile\u53D8\u91CF\u65F6\uFF0CJMM\u4F1A\u628A\u8BE5\u7EBF\u7A0B\u5BF9\u5E94\u7684\u672C\u5730\u5185\u5B58\u4E2D\u7684\u5171\u4EAB\u53D8\u91CF\u503C\u7ACB\u5373\u5237\u65B0\u56DE\u4E3B\u5185\u5B58\u4E2D\u3002</li><li>\u5F53\u8BFB\u4E00\u4E2Avolatile\u53D8\u91CF\u65F6\uFF0CJMM\u4F1A\u628A\u8BE5\u7EBF\u7A0B\u5BF9\u5E94\u7684\u672C\u5730\u5185\u5B58\u8BBE\u7F6E\u4E3A\u65E0\u6548\uFF0C\u76F4\u63A5\u4ECE\u4E3B\u5185\u5B58\u4E2D\u8BFB\u53D6\u5171\u4EAB\u53D8\u91CF</li><li>\u6240\u4EE5volatile\u7684\u5199\u5185\u5B58\u8BED\u4E49\u662F\u76F4\u63A5\u5237\u65B0\u5230\u4E3B\u5185\u5B58\u4E2D\uFF0C\u8BFB\u7684\u5185\u5B58\u8BED\u4E49\u662F\u76F4\u63A5\u4ECE\u4E3B\u5185\u5B58\u4E2D\u8BFB\u53D6\u3002</li></ul><h3 id="_3\u3001\u5185\u5B58\u5C4F\u969C-\u91CD\u70B9" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5185\u5B58\u5C4F\u969C-\u91CD\u70B9" aria-hidden="true">#</a> 3\u3001\u5185\u5B58\u5C4F\u969C\uFF08\u91CD\u70B9\uFF09</h3><h4 id="_1\u3001\u751F\u6D3Bcase" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u751F\u6D3Bcase" aria-hidden="true">#</a> 1\u3001\u751F\u6D3Bcase</h4><ul><li><p>\u6CA1\u6709\u7BA1\u63A7\uFF0C\u987A\u5E8F\u96BE\u4FDD</p></li><li><p>\u8BBE\u5B9A\u89C4\u5219\uFF0C\u7981\u6B62\u4E71\u5E8F</p></li></ul><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922203923024.png" alt="image-20210922203923024"></p><p>\u4E0A\u6D77\u5357\u4EAC\u8DEF\u6B65\u884C\u8857\u6B66\u8B66\u201C\u4EBA\u5899\u201D\u5F53\u7EA2\u706F</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922204024363.png" alt="image-20210922204024363"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922204027690.png" alt="image-20210922204027690"></p><h4 id="_2\u3001\u5185\u5B58\u5C4F\u969C\u662F\u4EC0\u4E48" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5185\u5B58\u5C4F\u969C\u662F\u4EC0\u4E48" aria-hidden="true">#</a> 2\u3001\u5185\u5B58\u5C4F\u969C\u662F\u4EC0\u4E48</h4><p>\u200B \u5185\u5B58\u5C4F\u969C\uFF08\u4E5F\u79F0\u5185\u5B58\u6805\u680F\uFF0C\u5185\u5B58\u6805\u969C\uFF0C\u5C4F\u969C\u6307\u4EE4\u7B49\uFF0C\u662F\u4E00\u7C7B\u540C\u6B65\u5C4F\u969C\u6307\u4EE4\uFF0C\u662FCPU\u6216\u7F16\u8BD1\u5668\u5728\u5BF9\u5185\u5B58\u968F\u673A\u8BBF\u95EE\u7684\u64CD\u4F5C\u4E2D\u7684\u4E00\u4E2A\u540C\u6B65\u70B9\uFF0C\u4F7F\u5F97\u6B64\u70B9\u4E4B\u524D\u7684\u6240\u6709\u8BFB\u5199\u64CD\u4F5C\u90FD\u6267\u884C\u540E\u624D\u53EF\u4EE5\u5F00\u59CB\u6267\u884C\u6B64\u70B9\u4E4B\u540E\u7684\u64CD\u4F5C\uFF09\uFF0C\u907F\u514D\u4EE3\u7801\u91CD\u6392\u5E8F\u3002\u5185\u5B58\u5C4F\u969C\u5176\u5B9E\u5C31\u662F\u4E00\u79CDJVM\u6307\u4EE4\uFF0CJava\u5185\u5B58\u6A21\u578B\u7684\u91CD\u6392\u89C4\u5219\u4F1A\u8981\u6C42Java\u7F16\u8BD1\u5668\u5728\u751F\u6210JVM\u6307\u4EE4\u65F6\u63D2\u5165\u7279\u5B9A\u7684\u5185\u5B58\u5C4F\u969C\u6307\u4EE4\uFF0C\u901A\u8FC7\u8FD9\u4E9B\u5185\u5B58\u5C4F\u969C\u6307\u4EE4\uFF0Cvolatile\u5B9E\u73B0\u4E86Java\u5185\u5B58\u6A21\u578B\u4E2D\u7684\u53EF\u89C1\u6027\u548C\u6709\u5E8F\u6027\uFF0C\u4F46volatile\u65E0\u6CD5\u4FDD\u8BC1\u539F\u5B50\u6027\u3002</p><p>\u200B \u5185\u5B58\u5C4F\u969C\u4E4B\u524D\u7684\u6240\u6709\u5199\u64CD\u4F5C\u90FD\u8981\u56DE\u5199\u5230\u4E3B\u5185\u5B58\uFF0C\u5185\u5B58\u5C4F\u969C\u4E4B\u540E\u7684\u6240\u6709\u8BFB\u64CD\u4F5C\u90FD\u80FD\u83B7\u5F97\u5185\u5B58\u5C4F\u969C\u4E4B\u524D\u7684\u6240\u6709\u5199\u64CD\u4F5C\u7684\u6700\u65B0\u7ED3\u679C(\u5B9E\u73B0\u4E86\u53EF\u89C1\u6027)\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922204126528.png" alt="image-20210922204126528"></p><p>\u56E0\u6B64\u91CD\u6392\u5E8F\u65F6\uFF0C\u4E0D\u5141\u8BB8\u628A\u5185\u5B58\u5C4F\u969C\u4E4B\u540E\u7684\u6307\u4EE4\u91CD\u6392\u5E8F\u5230\u5185\u5B58\u5C4F\u969C\u4E4B\u524D\u3002 \u4E00\u53E5\u8BDD\uFF1A\u5BF9\u4E00\u4E2A volatile \u57DF\u7684\u5199, happens-before \u4E8E\u4EFB\u610F\u540E\u7EED\u5BF9\u8FD9\u4E2A volatile \u57DF\u7684\u8BFB\uFF0C\u4E5F\u53EB\u5199\u540E\u8BFB\u3002</p><h4 id="_3\u3001volatile\u51ED\u4EC0\u4E48\u53EF\u4EE5\u4FDD\u8BC1\u53EF\u89C1\u6027\u548C\u6709\u5E8F\u6027" tabindex="-1"><a class="header-anchor" href="#_3\u3001volatile\u51ED\u4EC0\u4E48\u53EF\u4EE5\u4FDD\u8BC1\u53EF\u89C1\u6027\u548C\u6709\u5E8F\u6027" aria-hidden="true">#</a> 3\u3001volatile\u51ED\u4EC0\u4E48\u53EF\u4EE5\u4FDD\u8BC1\u53EF\u89C1\u6027\u548C\u6709\u5E8F\u6027\uFF1F\uFF1F\uFF1F</h4><p>\u5185\u5B58\u5C4F\u969C (Memory Barriers / Fences)</p><h4 id="_4\u3001jvm\u4E2D\u63D0\u4F9B\u4E86\u56DB\u7C7B\u5185\u5B58\u5C4F\u969C\u6307\u4EE4" tabindex="-1"><a class="header-anchor" href="#_4\u3001jvm\u4E2D\u63D0\u4F9B\u4E86\u56DB\u7C7B\u5185\u5B58\u5C4F\u969C\u6307\u4EE4" aria-hidden="true">#</a> 4\u3001JVM\u4E2D\u63D0\u4F9B\u4E86\u56DB\u7C7B\u5185\u5B58\u5C4F\u969C\u6307\u4EE4</h4><p>Unsafe.class</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922204301539.png" alt="image-20210922204301539"></p><p>Unsafe.java</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922204320477.png" alt="image-20210922204320477"></p><p>Unsafe.cpp</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922204329642.png" alt="image-20210922204329642"></p><p>OrderAccess.hpp</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922204339917.png" alt="image-20210922204339917"></p><p>orderAccess_linux_x86.inline.hpp</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922204349150.png" alt="image-20210922204349150"></p><h4 id="_5\u3001\u56DB\u5927\u5C4F\u969C\u5206\u522B\u662F\u4EC0\u4E48\u610F\u601D" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u56DB\u5927\u5C4F\u969C\u5206\u522B\u662F\u4EC0\u4E48\u610F\u601D" aria-hidden="true">#</a> 5\u3001\u56DB\u5927\u5C4F\u969C\u5206\u522B\u662F\u4EC0\u4E48\u610F\u601D</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922204417963.png" alt="image-20210922204417963"></p><p>orderAccess_linux_x86.inline.hpp</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922204432078.png" alt="image-20210922204432078"></p><h4 id="_6\u3001happens-before-\u4E4B-volatile-\u53D8\u91CF\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#_6\u3001happens-before-\u4E4B-volatile-\u53D8\u91CF\u89C4\u5219" aria-hidden="true">#</a> 6\u3001happens-before \u4E4B volatile \u53D8\u91CF\u89C4\u5219</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922204533258.png" alt="image-20210922204533258"></p><table><thead><tr><th>\u5F53\u7B2C\u4E00\u4E2A\u64CD\u4F5C\u4E3Avolatile\u8BFB\u65F6\uFF0C\u4E0D\u8BBA\u7B2C\u4E8C\u4E2A\u64CD\u4F5C\u662F\u4EC0\u4E48\uFF0C\u90FD\u4E0D\u80FD\u91CD\u6392\u5E8F\u3002\u8FD9\u4E2A\u64CD\u4F5C\u4FDD\u8BC1\u4E86volatile\u8BFB\u4E4B\u540E\u7684\u64CD\u4F5C\u4E0D\u4F1A\u88AB\u91CD\u6392\u5230volatile\u8BFB\u4E4B\u524D\u3002</th></tr></thead><tbody><tr><td>\u5F53\u7B2C\u4E8C\u4E2A\u64CD\u4F5C\u4E3Avolatile\u5199\u65F6\uFF0C\u4E0D\u8BBA\u7B2C\u4E00\u4E2A\u64CD\u4F5C\u662F\u4EC0\u4E48\uFF0C\u90FD\u4E0D\u80FD\u91CD\u6392\u5E8F\u3002\u8FD9\u4E2A\u64CD\u4F5C\u4FDD\u8BC1\u4E86volatile\u5199\u4E4B\u524D\u7684\u64CD\u4F5C\u4E0D\u4F1A\u88AB\u91CD\u6392\u5230volatile\u5199\u4E4B\u540E\u3002</td></tr><tr><td>\u5F53\u7B2C\u4E00\u4E2A\u64CD\u4F5C\u4E3Avolatile\u5199\u65F6\uFF0C\u7B2C\u4E8C\u4E2A\u64CD\u4F5C\u4E3Avolatile\u8BFB\u65F6\uFF0C\u4E0D\u80FD\u91CD\u6392\u3002</td></tr></tbody></table><h4 id="_7\u3001jmm-\u5C31\u5C06\u5185\u5B58\u5C4F\u969C\u63D2\u5165\u7B56\u7565\u5206\u4E3A-4-\u79CD" tabindex="-1"><a class="header-anchor" href="#_7\u3001jmm-\u5C31\u5C06\u5185\u5B58\u5C4F\u969C\u63D2\u5165\u7B56\u7565\u5206\u4E3A-4-\u79CD" aria-hidden="true">#</a> 7\u3001JMM \u5C31\u5C06\u5185\u5B58\u5C4F\u969C\u63D2\u2F0A\u7B56\u7565\u5206\u4E3A 4 \u79CD</h4><ul><li><p>\u5199</p><ul><li>\u5728\u6BCF\u4E2A volatile \u5199\u64CD\u4F5C\u7684\u524D\u2FAF\u63D2\u2F0A\u2F00\u4E2A StoreStore \u5C4F\u969C</li><li>\u5728\u6BCF\u4E2A volatile \u5199\u64CD\u4F5C\u7684\u540E\u2FAF\u63D2\u2F0A\u2F00\u4E2A StoreLoad \u5C4F\u969C</li></ul></li><li><p>\u8BFB</p><ul><li>\u5728\u6BCF\u4E2A volatile \u8BFB\u64CD\u4F5C\u7684\u540E\u2FAF\u63D2\u2F0A\u2F00\u4E2A LoadLoad \u5C4F\u969C</li><li>\u5728\u6BCF\u4E2A volatile \u8BFB\u64CD\u4F5C\u7684\u540E\u2FAF\u63D2\u2F0A\u2F00\u4E2A LoadStore \u5C4F\u969C</li></ul></li></ul><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922204820482.png" alt="image-20210922204820482"></p><h3 id="_4\u3001volatile\u7279\u6027" tabindex="-1"><a class="header-anchor" href="#_4\u3001volatile\u7279\u6027" aria-hidden="true">#</a> 4\u3001volatile\u7279\u6027</h3><h4 id="_1\u3001\u4FDD\u8BC1\u53EF\u89C1\u6027" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u4FDD\u8BC1\u53EF\u89C1\u6027" aria-hidden="true">#</a> 1\u3001\u4FDD\u8BC1\u53EF\u89C1\u6027</h4><p>\u4FDD\u8BC1\u4E0D\u540C\u7EBF\u7A0B\u5BF9\u8FD9\u4E2A\u53D8\u91CF\u8FDB\u884C\u64CD\u4F5C\u65F6\u7684\u53EF\u89C1\u6027\uFF0C\u5373\u53D8\u91CF\u4E00\u65E6\u6539\u53D8\u6240\u6709\u7EBF\u7A0B\u7ACB\u5373\u53EF\u89C1</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VolatileSeeDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">static</span>          <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>       <span class="token comment">//\u4E0D\u52A0volatile\uFF0C\u6CA1\u6709\u53EF\u89C1\u6027</span>
    <span class="token comment">//static volatile boolean flag = true;       //\u52A0\u4E86volatile\uFF0C\u4FDD\u8BC1\u53EF\u89C1\u6027</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t come in&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>

            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t flag\u88AB\u4FEE\u6539\u4E3Afalse,\u9000\u51FA.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C2\u79D2\u949F\u540E\u8BA9main\u7EBF\u7A0B\u4FEE\u6539flag\u503C</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;main\u7EBF\u7A0B\u4FEE\u6539\u5B8C\u6210&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>\u4E0D\u52A0volatile\uFF0C\u6CA1\u6709\u53EF\u89C1\u6027\uFF0C\u7A0B\u5E8F\u65E0\u6CD5\u505C\u6B62</li><li>\u52A0\u4E86volatile\uFF0C\u4FDD\u8BC1\u53EF\u89C1\u6027\uFF0C\u7A0B\u5E8F\u53EF\u4EE5\u505C\u6B62</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u7EBF\u7A0Bt1\u4E2D\u4E3A\u4F55\u770B\u4E0D\u5230\u88AB\u4E3B\u7EBF\u7A0Bmain\u4FEE\u6539\u4E3Afalse\u7684flag\u7684\u503C\uFF1F
 
\u95EE\u9898\u53EF\u80FD:
1. \u4E3B\u7EBF\u7A0B\u4FEE\u6539\u4E86flag\u4E4B\u540E\u6CA1\u6709\u5C06\u5176\u5237\u65B0\u5230\u4E3B\u5185\u5B58\uFF0C\u6240\u4EE5t1\u7EBF\u7A0B\u770B\u4E0D\u5230\u3002
2. \u4E3B\u7EBF\u7A0B\u5C06flag\u5237\u65B0\u5230\u4E86\u4E3B\u5185\u5B58\uFF0C\u4F46\u662Ft1\u4E00\u76F4\u8BFB\u53D6\u7684\u662F\u81EA\u5DF1\u5DE5\u4F5C\u5185\u5B58\u4E2Dflag\u7684\u503C\uFF0C\u6CA1\u6709\u53BB\u4E3B\u5185\u5B58\u4E2D\u66F4\u65B0\u83B7\u53D6flag\u6700\u65B0\u7684\u503C\u3002
 
\u6211\u4EEC\u7684\u8BC9\u6C42\uFF1A
1.\u7EBF\u7A0B\u4E2D\u4FEE\u6539\u4E86\u5DE5\u4F5C\u5185\u5B58\u4E2D\u7684\u526F\u672C\u4E4B\u540E\uFF0C\u7ACB\u5373\u5C06\u5176\u5237\u65B0\u5230\u4E3B\u5185\u5B58\uFF1B
2.\u5DE5\u4F5C\u5185\u5B58\u4E2D\u6BCF\u6B21\u8BFB\u53D6\u5171\u4EAB\u53D8\u91CF\u65F6\uFF0C\u90FD\u53BB\u4E3B\u5185\u5B58\u4E2D\u91CD\u65B0\u8BFB\u53D6\uFF0C\u7136\u540E\u62F7\u8D1D\u5230\u5DE5\u4F5C\u5185\u5B58\u3002
 
\u89E3\u51B3\uFF1A
\u4F7F\u7528volatile\u4FEE\u9970\u5171\u4EAB\u53D8\u91CF\uFF0C\u5C31\u53EF\u4EE5\u8FBE\u5230\u4E0A\u9762\u7684\u6548\u679C\uFF0C\u88ABvolatile\u4FEE\u6539\u7684\u53D8\u91CF\u6709\u4EE5\u4E0B\u7279\u70B9\uFF1A
1. \u7EBF\u7A0B\u4E2D\u8BFB\u53D6\u7684\u65F6\u5019\uFF0C\u6BCF\u6B21\u8BFB\u53D6\u90FD\u4F1A\u53BB\u4E3B\u5185\u5B58\u4E2D\u8BFB\u53D6\u5171\u4EAB\u53D8\u91CF\u6700\u65B0\u7684\u503C\uFF0C\u7136\u540E\u5C06\u5176\u590D\u5236\u5230\u5DE5\u4F5C\u5185\u5B58
2. \u7EBF\u7A0B\u4E2D\u4FEE\u6539\u4E86\u5DE5\u4F5C\u5185\u5B58\u4E2D\u53D8\u91CF\u7684\u526F\u672C\uFF0C\u4FEE\u6539\u4E4B\u540E\u4F1A\u7ACB\u5373\u5237\u65B0\u5230\u4E3B\u5185\u5B58
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_1\u3001volatile\u53D8\u91CF\u7684\u8BFB\u5199\u8FC7\u7A0B" tabindex="-1"><a class="header-anchor" href="#_1\u3001volatile\u53D8\u91CF\u7684\u8BFB\u5199\u8FC7\u7A0B" aria-hidden="true">#</a> 1\u3001volatile\u53D8\u91CF\u7684\u8BFB\u5199\u8FC7\u7A0B</h5><p>Java\u5185\u5B58\u6A21\u578B\u4E2D\u5B9A\u4E49\u76848\u79CD\u5DE5\u4F5C\u5185\u5B58\u4E0E\u4E3B\u5185\u5B58\u4E4B\u95F4\u7684\u539F\u5B50\u64CD\u4F5C read(\u8BFB\u53D6)\u2192load(\u52A0\u8F7D)\u2192use(\u4F7F\u7528)\u2192assign(\u8D4B\u503C)\u2192store(\u5B58\u50A8)\u2192write(\u5199\u5165)\u2192lock(\u9501\u5B9A)\u2192unlock(\u89E3\u9501)</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922205210267.png" alt="image-20210922205210267"></p><p>read: \u4F5C\u7528\u4E8E\u4E3B\u5185\u5B58\uFF0C\u5C06\u53D8\u91CF\u7684\u503C\u4ECE\u4E3B\u5185\u5B58\u4F20\u8F93\u5230\u5DE5\u4F5C\u5185\u5B58\uFF0C\u4E3B\u5185\u5B58\u5230\u5DE5\u4F5C\u5185\u5B58 load: \u4F5C\u7528\u4E8E\u5DE5\u4F5C\u5185\u5B58\uFF0C\u5C06read\u4ECE\u4E3B\u5185\u5B58\u4F20\u8F93\u7684\u53D8\u91CF\u503C\u653E\u5165\u5DE5\u4F5C\u5185\u5B58\u53D8\u91CF\u526F\u672C\u4E2D\uFF0C\u5373\u6570\u636E\u52A0\u8F7D use: \u4F5C\u7528\u4E8E\u5DE5\u4F5C\u5185\u5B58\uFF0C\u5C06\u5DE5\u4F5C\u5185\u5B58\u53D8\u91CF\u526F\u672C\u7684\u503C\u4F20\u9012\u7ED9\u6267\u884C\u5F15\u64CE\uFF0C\u6BCF\u5F53JVM\u9047\u5230\u9700\u8981\u8BE5\u53D8\u91CF\u7684\u5B57\u8282\u7801\u6307\u4EE4\u65F6\u4F1A\u6267\u884C\u8BE5\u64CD\u4F5C assign: \u4F5C\u7528\u4E8E\u5DE5\u4F5C\u5185\u5B58\uFF0C\u5C06\u4ECE\u6267\u884C\u5F15\u64CE\u63A5\u6536\u5230\u7684\u503C\u8D4B\u503C\u7ED9\u5DE5\u4F5C\u5185\u5B58\u53D8\u91CF\uFF0C\u6BCF\u5F53JVM\u9047\u5230\u4E00\u4E2A\u7ED9\u53D8\u91CF\u8D4B\u503C\u5B57\u8282\u7801\u6307\u4EE4\u65F6\u4F1A\u6267\u884C\u8BE5\u64CD\u4F5C store: \u4F5C\u7528\u4E8E\u5DE5\u4F5C\u5185\u5B58\uFF0C\u5C06\u8D4B\u503C\u5B8C\u6BD5\u7684\u5DE5\u4F5C\u53D8\u91CF\u7684\u503C\u5199\u56DE\u7ED9\u4E3B\u5185\u5B58 write: \u4F5C\u7528\u4E8E\u4E3B\u5185\u5B58\uFF0C\u5C06store\u4F20\u8F93\u8FC7\u6765\u7684\u53D8\u91CF\u503C\u8D4B\u503C\u7ED9\u4E3B\u5185\u5B58\u4E2D\u7684\u53D8\u91CF \u7531\u4E8E\u4E0A\u8FF0\u53EA\u80FD\u4FDD\u8BC1\u5355\u6761\u6307\u4EE4\u7684\u539F\u5B50\u6027\uFF0C\u9488\u5BF9\u591A\u6761\u6307\u4EE4\u7684\u7EC4\u5408\u6027\u539F\u5B50\u4FDD\u8BC1\uFF0C\u6CA1\u6709\u5927\u9762\u79EF\u52A0\u9501\uFF0C\u6240\u4EE5\uFF0CJVM\u63D0\u4F9B\u4E86\u53E6\u5916\u4E24\u4E2A\u539F\u5B50\u6307\u4EE4\uFF1A lock: \u4F5C\u7528\u4E8E\u4E3B\u5185\u5B58\uFF0C\u5C06\u4E00\u4E2A\u53D8\u91CF\u6807\u8BB0\u4E3A\u4E00\u4E2A\u7EBF\u7A0B\u72EC\u5360\u7684\u72B6\u6001\uFF0C\u53EA\u662F\u5199\u65F6\u5019\u52A0\u9501\uFF0C\u5C31\u53EA\u662F\u9501\u4E86\u5199\u53D8\u91CF\u7684\u8FC7\u7A0B\u3002 unlock: \u4F5C\u7528\u4E8E\u4E3B\u5185\u5B58\uFF0C\u628A\u4E00\u4E2A\u5904\u4E8E\u9501\u5B9A\u72B6\u6001\u7684\u53D8\u91CF\u91CA\u653E\uFF0C\u7136\u540E\u624D\u80FD\u88AB\u5176\u4ED6\u7EBF\u7A0B\u5360\u7528</p><h4 id="_2\u3001\u6CA1\u6709\u539F\u5B50\u6027" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u6CA1\u6709\u539F\u5B50\u6027" aria-hidden="true">#</a> 2\u3001\u6CA1\u6709\u539F\u5B50\u6027</h4><h5 id="_1\u3001volatile\u53D8\u91CF\u7684\u590D\u5408\u64CD\u4F5C-\u5982i-\u4E0D\u5177\u6709\u539F\u5B50\u6027" tabindex="-1"><a class="header-anchor" href="#_1\u3001volatile\u53D8\u91CF\u7684\u590D\u5408\u64CD\u4F5C-\u5982i-\u4E0D\u5177\u6709\u539F\u5B50\u6027" aria-hidden="true">#</a> 1\u3001volatile\u53D8\u91CF\u7684\u590D\u5408\u64CD\u4F5C(\u5982i++)\u4E0D\u5177\u6709\u539F\u5B50\u6027</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">MyNumber</span>
<span class="token punctuation">{</span>
    <span class="token keyword">volatile</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addPlusPlus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        number<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VolatileNoAtomicDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">MyNumber</span> myNumber <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">1000</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    myNumber<span class="token punctuation">.</span><span class="token function">addPlusPlus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\t&quot;</span> <span class="token operator">+</span> myNumber<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4ECEi++\u7684\u5B57\u8282\u7801\u89D2\u5EA6\u8BF4\u660E</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922205402552.png" alt="image-20210922205402552"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>\u539F\u5B50\u6027\u6307\u7684\u662F\u4E00\u4E2A\u64CD\u4F5C\u662F\u4E0D\u53EF\u4E2D\u65AD\u7684\uFF0C\u5373\u4F7F\u662F\u5728\u591A\u7EBF\u7A0B\u73AF\u5883\u4E0B\uFF0C\u4E00\u4E2A\u64CD\u4F5C\u4E00\u65E6\u5F00\u59CB\u5C31\u4E0D\u4F1A\u88AB\u5176\u4ED6\u7EBF\u7A0B\u5F71\u54CD\u3002
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
        i<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//\u4E0D\u5177\u5907\u539F\u5B50\u6027\uFF0C\u8BE5\u64CD\u4F5C\u662F\u5148\u8BFB\u53D6\u503C\uFF0C\u7136\u540E\u5199\u56DE\u4E00\u4E2A\u65B0\u503C\uFF0C\u76F8\u5F53\u4E8E\u539F\u6765\u7684\u503C\u52A0\u4E0A1\uFF0C\u52063\u6B65\u5B8C\u6210</span>
 <span class="token punctuation">}</span>
\u5982\u679C\u7B2C\u4E8C\u4E2A\u7EBF\u7A0B\u5728\u7B2C\u4E00\u4E2A\u7EBF\u7A0B\u8BFB\u53D6\u65E7\u503C\u548C\u5199\u56DE\u65B0\u503C\u671F\u95F4\u8BFB\u53D6i\u7684\u57DF\u503C\uFF0C\u90A3\u4E48\u7B2C\u4E8C\u4E2A\u7EBF\u7A0B\u5C31\u4F1A\u4E0E\u7B2C\u4E00\u4E2A\u7EBF\u7A0B\u4E00\u8D77\u770B\u5230\u540C\u4E00\u4E2A\u503C\uFF0C
\u5E76\u6267\u884C\u76F8\u540C\u503C\u7684\u52A0<span class="token number">1</span>\u64CD\u4F5C\uFF0C\u8FD9\u4E5F\u5C31\u9020\u6210\u4E86\u7EBF\u7A0B\u5B89\u5168\u5931\u8D25\uFF0C\u56E0\u6B64\u5BF9\u4E8Eadd\u65B9\u6CD5\u5FC5\u987B\u4F7F\u7528<span class="token keyword">synchronized</span>\u4FEE\u9970\uFF0C\u4EE5\u4FBF\u4FDD\u8BC1\u7EBF\u7A0B\u5B89\u5168<span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922205426175.png" alt="image-20210922205426175"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>\u591A\u7EBF\u7A0B\u73AF\u5883\u4E0B\uFF0C<span class="token string">&quot;\u6570\u636E\u8BA1\u7B97&quot;</span>\u548C<span class="token string">&quot;\u6570\u636E\u8D4B\u503C&quot;</span>\u64CD\u4F5C\u53EF\u80FD\u591A\u6B21\u51FA\u73B0\uFF0C\u5373\u64CD\u4F5C\u975E\u539F\u5B50\u3002\u82E5\u6570\u636E\u5728\u52A0\u8F7D\u4E4B\u540E\uFF0C\u82E5\u4E3B\u5185\u5B58count\u53D8\u91CF\u53D1\u751F\u4FEE\u6539\u4E4B\u540E\uFF0C\u7531\u4E8E\u7EBF\u7A0B\u5DE5\u4F5C\u5185\u5B58\u4E2D\u7684\u503C\u5728\u6B64\u524D\u5DF2\u7ECF\u52A0\u8F7D\uFF0C\u4ECE\u800C\u4E0D\u4F1A\u5BF9\u53D8\u66F4\u64CD\u4F5C\u505A\u51FA\u76F8\u5E94\u53D8\u5316\uFF0C\u5373\u79C1\u6709\u5185\u5B58\u548C\u516C\u5171\u5185\u5B58\u4E2D\u53D8\u91CF\u4E0D\u540C\u6B65\uFF0C\u8FDB\u800C\u5BFC\u81F4\u6570\u636E\u4E0D\u4E00\u81F4
\u5BF9\u4E8E<span class="token keyword">volatile</span>\u53D8\u91CF\uFF0CJVM\u53EA\u662F\u4FDD\u8BC1\u4ECE\u4E3B\u5185\u5B58\u52A0\u8F7D\u5230\u7EBF\u7A0B\u5DE5\u4F5C\u5185\u5B58\u7684\u503C\u662F\u6700\u65B0\u7684\uFF0C\u4E5F\u5C31\u662F\u6570\u636E\u52A0\u8F7D\u65F6\u662F\u6700\u65B0\u7684\u3002
\u7531\u6B64\u53EF\u89C1<span class="token keyword">volatile</span>\u89E3\u51B3\u7684\u662F\u53D8\u91CF\u8BFB\u65F6\u7684\u53EF\u89C1\u6027\u95EE\u9898\uFF0C\u4F46\u65E0\u6CD5\u4FDD\u8BC1\u539F\u5B50\u6027\uFF0C\u5BF9\u4E8E\u591A\u7EBF\u7A0B\u4FEE\u6539\u5171\u4EAB\u53D8\u91CF\u7684\u573A\u666F\u5FC5\u987B\u4F7F\u7528\u52A0\u9501\u540C\u6B65
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2\u3001\u8BFB\u53D6\u8D4B\u503C\u4E00\u4E2A\u666E\u901A\u53D8\u91CF\u7684\u60C5\u51B5" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u8BFB\u53D6\u8D4B\u503C\u4E00\u4E2A\u666E\u901A\u53D8\u91CF\u7684\u60C5\u51B5" aria-hidden="true">#</a> 2\u3001\u8BFB\u53D6\u8D4B\u503C\u4E00\u4E2A\u666E\u901A\u53D8\u91CF\u7684\u60C5\u51B5</h5><p>\u5F53\u7EBF\u7A0B1\u5BF9\u4E3B\u5185\u5B58\u5BF9\u8C61\u53D1\u8D77read\u64CD\u4F5C\u5230write\u64CD\u4F5C\u7B2C\u4E00\u5957\u6D41\u7A0B\u7684\u65F6\u95F4\u91CC\uFF0C\u7EBF\u7A0B2\u968F\u65F6\u90FD\u6709\u53EF\u80FD\u5BF9\u8FD9\u4E2A\u4E3B\u5185\u5B58\u5BF9\u8C61\u53D1\u8D77\u7B2C\u4E8C\u5957\u64CD\u4F5C</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922205521467.png" alt="image-20210922205521467"></p><h5 id="_3\u3001\u65E2\u7136\u4E00\u4FEE\u6539\u5C31\u662F\u53EF\u89C1-\u4E3A\u4EC0\u4E48\u8FD8\u4E0D\u80FD\u4FDD\u8BC1\u539F\u5B50\u6027" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u65E2\u7136\u4E00\u4FEE\u6539\u5C31\u662F\u53EF\u89C1-\u4E3A\u4EC0\u4E48\u8FD8\u4E0D\u80FD\u4FDD\u8BC1\u539F\u5B50\u6027" aria-hidden="true">#</a> 3\u3001\u65E2\u7136\u4E00\u4FEE\u6539\u5C31\u662F\u53EF\u89C1\uFF0C\u4E3A\u4EC0\u4E48\u8FD8\u4E0D\u80FD\u4FDD\u8BC1\u539F\u5B50\u6027\uFF1F</h5><p>volatile\u4E3B\u8981\u662F\u5BF9\u5176\u4E2D\u90E8\u5206\u6307\u4EE4\u505A\u4E86\u5904\u7406</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>\u8981<span class="token function">use</span><span class="token punctuation">(</span>\u4F7F\u7528<span class="token punctuation">)</span>\u4E00\u4E2A\u53D8\u91CF\u7684\u65F6\u5019\u5FC5\u9700<span class="token function">load</span><span class="token punctuation">(</span>\u8F7D\u5165\uFF09\uFF0C\u8981\u8F7D\u5165\u7684\u65F6\u5019\u5FC5\u9700\u4ECE\u4E3B\u5185\u5B58<span class="token function">read</span><span class="token punctuation">(</span>\u8BFB\u53D6\uFF09\u8FD9\u6837\u5C31\u89E3\u51B3\u4E86\u8BFB\u7684\u53EF\u89C1\u6027\u3002 
\u5199\u64CD\u4F5C\u662F\u628Aassign\u548Cstore\u505A\u4E86\u5173\u8054<span class="token punctuation">(</span>\u5728<span class="token function">assign</span><span class="token punctuation">(</span>\u8D4B\u503C<span class="token punctuation">)</span>\u540E\u5FC5\u9700<span class="token function">store</span><span class="token punctuation">(</span>\u5B58\u50A8<span class="token punctuation">)</span><span class="token punctuation">)</span>\u3002<span class="token function">store</span><span class="token punctuation">(</span>\u5B58\u50A8<span class="token punctuation">)</span>\u540E<span class="token function">write</span><span class="token punctuation">(</span>\u5199\u5165<span class="token punctuation">)</span>\u3002
\u4E5F\u5C31\u662F\u505A\u5230\u4E86\u7ED9\u4E00\u4E2A\u53D8\u91CF\u8D4B\u503C\u7684\u65F6\u5019\u4E00\u4E32\u5173\u8054\u6307\u4EE4\u76F4\u63A5\u628A\u53D8\u91CF\u503C\u5199\u5230\u4E3B\u5185\u5B58\u3002
\u5C31\u8FD9\u6837\u901A\u8FC7\u7528\u7684\u65F6\u5019\u76F4\u63A5\u4ECE\u4E3B\u5185\u5B58\u53D6\uFF0C\u5728\u8D4B\u503C\u5230\u76F4\u63A5\u5199\u56DE\u4E3B\u5185\u5B58\u505A\u5230\u4E86\u5185\u5B58\u53EF\u89C1\u6027\u3002\u6CE8\u610F\u84DD\u8272\u6846\u6846\u7684\u95F4\u9699\u3002\u3002\u3002\u3002\u3002\u3002<span class="token function">o</span><span class="token punctuation">(</span>\u2565\uFE4F\u2565<span class="token punctuation">)</span>o
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922205631332.png" alt="image-20210922205631332"></p><h5 id="_4\u3001\u8BFB\u53D6\u8D4B\u503C\u4E00\u4E2Avolatile\u53D8\u91CF\u7684\u60C5\u51B5" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u8BFB\u53D6\u8D4B\u503C\u4E00\u4E2Avolatile\u53D8\u91CF\u7684\u60C5\u51B5" aria-hidden="true">#</a> 4\u3001\u8BFB\u53D6\u8D4B\u503C\u4E00\u4E2Avolatile\u53D8\u91CF\u7684\u60C5\u51B5</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922205704525.png" alt="image-20210922205704525"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code> read<span class="token operator">-</span>load<span class="token operator">-</span>use \u548C assign<span class="token operator">-</span>store<span class="token operator">-</span>write \u6210\u4E3A\u4E86\u4E24\u4E2A\u4E0D\u53EF\u5206\u5272\u7684\u539F\u5B50\u64CD\u4F5C\uFF0C\u4F46\u662F\u5728use\u548Cassign\u4E4B\u95F4\u4F9D\u7136\u6709\u6781\u5C0F\u7684\u4E00\u6BB5\u771F\u7A7A\u671F\uFF0C\u6709\u53EF\u80FD\u53D8\u91CF\u4F1A\u88AB\u5176\u4ED6\u7EBF\u7A0B\u8BFB\u53D6\uFF0C\u5BFC\u81F4\u5199\u4E22\u5931\u4E00\u6B21<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>\u2565\uFE4F\u2565<span class="token punctuation">)</span>o
\u4F46\u662F\u65E0\u8BBA\u5728\u54EA\u4E00\u4E2A\u65F6\u95F4\u70B9\u4E3B\u5185\u5B58\u7684\u53D8\u91CF\u548C\u4EFB\u4E00\u5DE5\u4F5C\u5185\u5B58\u7684\u53D8\u91CF\u7684\u503C\u90FD\u662F\u76F8\u7B49\u7684\u3002\u8FD9\u4E2A\u7279\u6027\u5C31\u5BFC\u81F4\u4E86<span class="token keyword">volatile</span>\u53D8\u91CF\u4E0D\u9002\u5408\u53C2\u4E0E\u5230\u4F9D\u8D56\u5F53\u524D\u503C\u7684\u8FD0\u7B97\uFF0C\u5982i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">;</span>\u4E4B\u7C7B\u7684\u90A3\u4E48\u4F9D\u9760\u53EF\u89C1\u6027\u7684\u7279\u70B9<span class="token keyword">volatile</span>\u53EF\u4EE5\u7528\u5728\u54EA\u4E9B\u5730\u65B9\u5462\uFF1F \u901A\u5E38<span class="token keyword">volatile</span>\u7528\u505A\u4FDD\u5B58\u67D0\u4E2A\u72B6\u6001\u7684<span class="token keyword">boolean</span>\u503Cor <span class="token keyword">int</span>\u503C\u3002
\u300A\u6DF1\u5165\u7406\u89E3<span class="token class-name">Java</span>\u865A\u62DF\u673A\u300B\u63D0\u5230\uFF1A
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922205718122.png" alt="image-20210922205718122"></p><h5 id="_5\u3001\u9762\u8BD5\u56DE\u7B54" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u9762\u8BD5\u56DE\u7B54" aria-hidden="true">#</a> 5\u3001\u9762\u8BD5\u56DE\u7B54</h5><p>JVM\u7684\u5B57\u8282\u7801\uFF0Ci++\u5206\u6210\u4E09\u6B65\uFF0C\u95F4\u9699\u671F\u4E0D\u540C\u6B65\u975E\u539F\u5B50\u64CD\u4F5C(i++)</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922205752322.png" alt="image-20210922205752322"></p><h4 id="_3\u3001\u6307\u4EE4\u7981\u91CD\u6392" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u6307\u4EE4\u7981\u91CD\u6392" aria-hidden="true">#</a> 3\u3001\u6307\u4EE4\u7981\u91CD\u6392</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>\u91CD\u6392\u5E8F
\u91CD\u6392\u5E8F\u662F\u6307\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u4E3A\u4E86\u4F18\u5316\u7A0B\u5E8F\u6027\u80FD\u800C\u5BF9\u6307\u4EE4\u5E8F\u5217\u8FDB\u884C\u91CD\u65B0\u6392\u5E8F\u7684\u4E00\u79CD\u624B\u6BB5\uFF0C\u6709\u65F6\u5019\u4F1A\u6539\u53D8\u7A0B\u5E8F\u8BED\u53E5\u7684\u5148\u540E\u987A\u5E8F
\u4E0D\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u5173\u7CFB\uFF0C\u53EF\u4EE5\u91CD\u6392\u5E8F\uFF1B
\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u5173\u7CFB\uFF0C\u7981\u6B62\u91CD\u6392\u5E8F
\u4F46\u91CD\u6392\u540E\u7684\u6307\u4EE4\u7EDD\u5BF9\u4E0D\u80FD\u6539\u53D8\u539F\u6709\u7684\u4E32\u884C\u8BED\u4E49\uFF01\u8FD9\u70B9\u5728\u5E76\u53D1\u8BBE\u8BA1\u4E2D\u5FC5\u987B\u8981\u91CD\u70B9\u8003\u8651\uFF01
    
\u91CD\u6392\u5E8F\u7684\u5206\u7C7B\u548C\u6267\u884C\u6D41\u7A0B
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922205902093.png" alt="image-20210922205902093"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>\u7F16\u8BD1\u5668\u4F18\u5316\u7684\u91CD\u6392\u5E8F\uFF1A \u7F16\u8BD1\u5668\u5728\u4E0D\u6539\u53D8\u5355\u7EBF\u7A0B\u4E32\u884C\u8BED\u4E49\u7684\u524D\u63D0\u4E0B\uFF0C\u53EF\u4EE5\u91CD\u65B0\u8C03\u6574\u6307\u4EE4\u7684\u6267\u884C\u987A\u5E8F
\u6307\u4EE4\u7EA7\u5E76\u884C\u7684\u91CD\u6392\u5E8F\uFF1A \u5904\u7406\u5668\u4F7F\u7528\u6307\u4EE4\u7EA7\u5E76\u884C\u6280\u672F\u6765\u8BB2\u591A\u6761\u6307\u4EE4\u91CD\u53E0\u6267\u884C\uFF0C\u82E5\u4E0D\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u6027\uFF0C\u5904\u7406\u5668\u53EF\u4EE5\u6539\u53D8\u8BED\u53E5\u5BF9\u5E94\u673A\u5668\u6307\u4EE4\u7684\u6267\u884C\u987A\u5E8F
\u5185\u5B58\u7CFB\u7EDF\u7684\u91CD\u6392\u5E8F\uFF1A \u7531\u4E8E\u5904\u7406\u5668\u4F7F\u7528\u7F13\u5B58\u548C\u8BFB<span class="token operator">/</span>\u5199\u7F13\u51B2\u533A\uFF0C\u8FD9\u4F7F\u5F97\u52A0\u8F7D\u548C\u5B58\u50A8\u64CD\u4F5C\u770B\u4E0A\u53BB\u53EF\u80FD\u662F\u4E71\u5E8F\u6267\u884C
 
\u6570\u636E\u4F9D\u8D56\u6027\uFF1A\u82E5\u4E24\u4E2A\u64CD\u4F5C\u8BBF\u95EE\u540C\u4E00\u53D8\u91CF\uFF0C\u4E14\u8FD9\u4E24\u4E2A\u64CD\u4F5C\u4E2D\u6709\u4E00\u4E2A\u4E3A\u5199\u64CD\u4F5C\uFF0C\u6B64\u65F6\u4E24\u64CD\u4F5C\u95F4\u5C31\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u6027\u3002
 
\u6848\u4F8B \uFF1A
\u4E0D\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u5173\u7CFB\uFF0C\u53EF\u4EE5\u91CD\u6392\u5E8F<span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> \u91CD\u6392\u5E8FOK \u3002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>\u91CD\u6392\u524D</th><th>\u91CD\u6392\u540E</th></tr></thead><tbody><tr><td>int a = 1; //1<br>int b = 20; //2<br>int c = a + b; //3</td><td>int b = 20; //1<br>int a = 1; //2<br>int c = a + b; //3</td></tr><tr><td>\u7ED3\u8BBA\uFF1A\u7F16\u8BD1\u5668\u8C03\u6574\u4E86\u8BED\u53E5\u7684\u987A\u5E8F\uFF0C\u4F46\u662F\u4E0D\u5F71\u54CD\u7A0B\u5E8F\u7684\u6700\u7EC8\u7ED3\u679C\u3002</td><td>\u91CD\u6392\u5E8FOK</td></tr></tbody></table><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>\u5B58\u5728\u6570\u636E\u4F9D\u8D56\u5173\u7CFB\uFF0C\u7981\u6B62\u91CD\u6392\u5E8F<span class="token operator">==</span><span class="token operator">=</span><span class="token operator">&gt;</span> \u91CD\u6392\u5E8F\u53D1\u751F\uFF0C\u4F1A\u5BFC\u81F4\u7A0B\u5E8F\u8FD0\u884C\u7ED3\u679C\u4E0D\u540C\u3002
\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u5728\u91CD\u6392\u5E8F\u65F6\uFF0C\u4F1A\u9075\u5B88\u6570\u636E\u4F9D\u8D56\u6027\uFF0C\u4E0D\u4F1A\u6539\u53D8\u5B58\u5728\u4F9D\u8D56\u5173\u7CFB\u7684\u4E24\u4E2A\u64CD\u4F5C\u7684\u6267\u884C<span class="token punctuation">,</span>\u4F46\u4E0D\u540C\u5904\u7406\u5668\u548C\u4E0D\u540C\u7EBF\u7A0B\u4E4B\u95F4\u7684\u6570\u636E\u6027\u4E0D\u4F1A\u88AB\u7F16\u8BD1\u5668\u548C\u5904\u7406\u5668\u8003\u8651\uFF0C\u5176\u53EA\u4F1A\u4F5C\u7528\u4E8E\u5355\u5904\u7406\u5668\u548C\u5355\u7EBF\u7A0B\u73AF\u5883\uFF0C\u4E0B\u9762\u4E09\u79CD\u60C5\u51B5\uFF0C\u53EA\u8981\u91CD\u6392\u5E8F\u4E24\u4E2A\u64CD\u4F5C\u7684\u6267\u884C\u987A\u5E8F\uFF0C\u7A0B\u5E8F\u7684\u6267\u884C\u7ED3\u679C\u5C31\u4F1A\u88AB\u6539\u53D8\u3002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922210024000.png" alt="image-20210922210024000"></p><h5 id="_1\u3001volatile\u7684\u5E95\u5C42\u5B9E\u73B0\u662F\u901A\u8FC7\u5185\u5B58\u5C4F\u969C" tabindex="-1"><a class="header-anchor" href="#_1\u3001volatile\u7684\u5E95\u5C42\u5B9E\u73B0\u662F\u901A\u8FC7\u5185\u5B58\u5C4F\u969C" aria-hidden="true">#</a> 1\u3001volatile\u7684\u5E95\u5C42\u5B9E\u73B0\u662F\u901A\u8FC7\u5185\u5B58\u5C4F\u969C</h5><p>volatile\u6709\u5173\u7684\u7981\u6B62\u6307\u4EE4\u91CD\u6392\u7684\u884C\u4E3A</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922210055834.png" alt="image-20210922210055834"></p><table><thead><tr><th>\u5F53\u7B2C\u4E00\u4E2A\u64CD\u4F5C\u4E3Avolatile\u8BFB\u65F6\uFF0C\u4E0D\u8BBA\u7B2C\u4E8C\u4E2A\u64CD\u4F5C\u662F\u4EC0\u4E48\uFF0C\u90FD\u4E0D\u80FD\u91CD\u6392\u5E8F\u3002\u8FD9\u4E2A\u64CD\u4F5C\u4FDD\u8BC1\u4E86volatile\u8BFB\u4E4B\u540E\u7684\u64CD\u4F5C\u4E0D\u4F1A\u88AB\u91CD\u6392\u5230volatile\u8BFB\u4E4B\u524D\u3002</th></tr></thead><tbody><tr><td>\u5F53\u7B2C\u4E8C\u4E2A\u64CD\u4F5C\u4E3Avolatile\u5199\u65F6\uFF0C\u4E0D\u8BBA\u7B2C\u4E00\u4E2A\u64CD\u4F5C\u662F\u4EC0\u4E48\uFF0C\u90FD\u4E0D\u80FD\u91CD\u6392\u5E8F\u3002\u8FD9\u4E2A\u64CD\u4F5C\u4FDD\u8BC1\u4E86volatile\u5199\u4E4B\u524D\u7684\u64CD\u4F5C\u4E0D\u4F1A\u88AB\u91CD\u6392\u5230volatile\u5199\u4E4B\u540E\u3002</td></tr><tr><td>\u5F53\u7B2C\u4E00\u4E2A\u64CD\u4F5C\u4E3Avolatile\u5199\u65F6\uFF0C\u7B2C\u4E8C\u4E2A\u64CD\u4F5C\u4E3Avolatile\u8BFB\u65F6\uFF0C\u4E0D\u80FD\u91CD\u6392\u3002</td></tr></tbody></table><p>\u56DB\u5927\u5C4F\u969C\u7684\u63D2\u5165\u60C5\u51B5</p><ul><li>\u5728\u6BCF\u4E00\u4E2Avolatile\u5199\u64CD\u4F5C\u524D\u9762\u63D2\u5165\u4E00\u4E2AStoreStore\u5C4F\u969C <ul><li>StoreStore\u5C4F\u969C\u53EF\u4EE5\u4FDD\u8BC1\u5728volatile\u5199\u4E4B\u524D\uFF0C\u5176\u524D\u9762\u7684\u6240\u6709\u666E\u901A\u5199\u64CD\u4F5C\u90FD\u5DF2\u7ECF\u5237\u65B0\u5230\u4E3B\u5185\u5B58\u4E2D\u3002</li></ul></li><li>\u5728\u6BCF\u4E00\u4E2Avolatile\u5199\u64CD\u4F5C\u540E\u9762\u63D2\u5165\u4E00\u4E2AStoreLoad\u5C4F\u969C <ul><li>StoreLoad\u5C4F\u969C\u7684\u4F5C\u7528\u662F\u907F\u514Dvolatile\u5199\u4E0E\u540E\u9762\u53EF\u80FD\u6709\u7684volatile\u8BFB/\u5199\u64CD\u4F5C\u91CD\u6392\u5E8F</li></ul></li><li>\u5728\u6BCF\u4E00\u4E2Avolatile\u8BFB\u64CD\u4F5C\u540E\u9762\u63D2\u5165\u4E00\u4E2ALoadLoad\u5C4F\u969C <ul><li>LoadLoad\u5C4F\u969C\u7528\u6765\u7981\u6B62\u5904\u7406\u5668\u628A\u4E0A\u9762\u7684volatile\u8BFB\u4E0E\u4E0B\u9762\u7684\u666E\u901A\u8BFB\u91CD\u6392\u5E8F\u3002</li></ul></li><li>\u5728\u6BCF\u4E00\u4E2Avolatile\u8BFB\u64CD\u4F5C\u540E\u9762\u63D2\u5165\u4E00\u4E2ALoadStore\u5C4F\u969C <ul><li>LoadStore\u5C4F\u969C\u7528\u6765\u7981\u6B62\u5904\u7406\u5668\u628A\u4E0A\u9762\u7684volatile\u8BFB\u4E0E\u4E0B\u9762\u7684\u666E\u901A\u5199\u91CD\u6392\u5E8F\u3002</li></ul></li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//\u6A21\u62DF\u4E00\u4E2A\u5355\u7EBF\u7A0B\uFF0C\u4EC0\u4E48\u987A\u5E8F\u8BFB\uFF1F\u4EC0\u4E48\u987A\u5E8F\u5199\uFF1F</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VolatileTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;---i = &quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922210258725.png" alt="image-20210922210258725"></p><h4 id="_4\u3001\u5982\u4F55\u6B63\u786E\u4F7F\u7528volatile" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u5982\u4F55\u6B63\u786E\u4F7F\u7528volatile" aria-hidden="true">#</a> 4\u3001\u5982\u4F55\u6B63\u786E\u4F7F\u7528volatile</h4><h5 id="_1\u3001\u5355\u4E00\u8D4B\u503C\u53EF\u4EE5-but\u542B\u590D\u5408\u8FD0\u7B97\u8D4B\u503C\u4E0D\u53EF\u4EE5-i-\u4E4B\u7C7B" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5355\u4E00\u8D4B\u503C\u53EF\u4EE5-but\u542B\u590D\u5408\u8FD0\u7B97\u8D4B\u503C\u4E0D\u53EF\u4EE5-i-\u4E4B\u7C7B" aria-hidden="true">#</a> 1\u3001\u5355\u4E00\u8D4B\u503C\u53EF\u4EE5\uFF0Cbut\u542B\u590D\u5408\u8FD0\u7B97\u8D4B\u503C\u4E0D\u53EF\u4EE5(i++\u4E4B\u7C7B)</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">volatile</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">volatile</span> <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">false</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2\u3001\u72B6\u6001\u6807\u5FD7-\u5224\u65AD\u4E1A\u52A1\u662F\u5426\u7ED3\u675F" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u72B6\u6001\u6807\u5FD7-\u5224\u65AD\u4E1A\u52A1\u662F\u5426\u7ED3\u675F" aria-hidden="true">#</a> 2\u3001\u72B6\u6001\u6807\u5FD7\uFF0C\u5224\u65AD\u4E1A\u52A1\u662F\u5426\u7ED3\u675F</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 *
 * \u4F7F\u7528\uFF1A\u4F5C\u4E3A\u4E00\u4E2A\u5E03\u5C14\u72B6\u6001\u6807\u5FD7\uFF0C\u7528\u4E8E\u6307\u793A\u53D1\u751F\u4E86\u4E00\u4E2A\u91CD\u8981\u7684\u4E00\u6B21\u6027\u4E8B\u4EF6\uFF0C\u4F8B\u5982\u5B8C\u6210\u521D\u59CB\u5316\u6216\u4EFB\u52A1\u7ED3\u675F
 * \u7406\u7531\uFF1A\u72B6\u6001\u6807\u5FD7\u5E76\u4E0D\u4F9D\u8D56\u4E8E\u7A0B\u5E8F\u5185\u4EFB\u4F55\u5176\u4ED6\u72B6\u6001\uFF0C\u4E14\u901A\u5E38\u53EA\u6709\u4E00\u79CD\u72B6\u6001\u8F6C\u6362
 * \u4F8B\u5B50\uFF1A\u5224\u65AD\u4E1A\u52A1\u662F\u5426\u7ED3\u675F
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UseVolatileDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//do something......</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2L</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3\u3001\u5F00\u9500\u8F83\u4F4E\u7684\u8BFB-\u5199\u9501\u7B56\u7565" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5F00\u9500\u8F83\u4F4E\u7684\u8BFB-\u5199\u9501\u7B56\u7565" aria-hidden="true">#</a> 3\u3001\u5F00\u9500\u8F83\u4F4E\u7684\u8BFB\uFF0C\u5199\u9501\u7B56\u7565</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UseVolatileDemo</span>
<span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * \u4F7F\u7528\uFF1A\u5F53\u8BFB\u8FDC\u591A\u4E8E\u5199\uFF0C\u7ED3\u5408\u4F7F\u7528\u5185\u90E8\u9501\u548C volatile \u53D8\u91CF\u6765\u51CF\u5C11\u540C\u6B65\u7684\u5F00\u9500
     * \u7406\u7531\uFF1A\u5229\u7528volatile\u4FDD\u8BC1\u8BFB\u53D6\u64CD\u4F5C\u7684\u53EF\u89C1\u6027\uFF1B\u5229\u7528synchronized\u4FDD\u8BC1\u590D\u5408\u64CD\u4F5C\u7684\u539F\u5B50\u6027
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Counter</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> value<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> value<span class="token punctuation">;</span>   <span class="token comment">//\u5229\u7528volatile\u4FDD\u8BC1\u8BFB\u53D6\u64CD\u4F5C\u7684\u53EF\u89C1\u6027</span>
              <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> value<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//\u5229\u7528synchronized\u4FDD\u8BC1\u590D\u5408\u64CD\u4F5C\u7684\u539F\u5B50\u6027</span>
               <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4\u3001dcl\u53CC\u7AEF\u9501\u7684\u53D1\u5E03" tabindex="-1"><a class="header-anchor" href="#_4\u3001dcl\u53CC\u7AEF\u9501\u7684\u53D1\u5E03" aria-hidden="true">#</a> 4\u3001DCL\u53CC\u7AEF\u9501\u7684\u53D1\u5E03</h5><p>\u95EE\u9898\u4EE3\u7801</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SafeDoubleCheckSingleton</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">SafeDoubleCheckSingleton</span> singleton<span class="token punctuation">;</span>
    <span class="token comment">//\u79C1\u6709\u5316\u6784\u9020\u65B9\u6CD5</span>
    <span class="token keyword">private</span> <span class="token class-name">SafeDoubleCheckSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u53CC\u91CD\u9501\u8BBE\u8BA1</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SafeDoubleCheckSingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//1.\u591A\u7EBF\u7A0B\u5E76\u53D1\u521B\u5EFA\u5BF9\u8C61\u65F6\uFF0C\u4F1A\u901A\u8FC7\u52A0\u9501\u4FDD\u8BC1\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B\u80FD\u521B\u5EFA\u5BF9\u8C61</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">SafeDoubleCheckSingleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment">//\u9690\u60A3\uFF1A\u591A\u7EBF\u7A0B\u73AF\u5883\u4E0B\uFF0C\u7531\u4E8E\u91CD\u6392\u5E8F\uFF0C\u8BE5\u5BF9\u8C61\u53EF\u80FD\u8FD8\u672A\u5B8C\u6210\u521D\u59CB\u5316\u5C31\u88AB\u5176\u4ED6\u7EBF\u7A0B\u8BFB\u53D6</span>
                    singleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SafeDoubleCheckSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//2.\u5BF9\u8C61\u521B\u5EFA\u5B8C\u6BD5\uFF0C\u6267\u884CgetInstance()\u5C06\u4E0D\u9700\u8981\u83B7\u53D6\u9501\uFF0C\u76F4\u63A5\u8FD4\u56DE\u521B\u5EFA\u5BF9\u8C61</span>
        <span class="token keyword">return</span> singleton<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u5355\u7EBF\u7A0B\u770B\u95EE\u9898\u4EE3\u7801</strong></p><p>\u5355\u7EBF\u7A0B\u73AF\u5883\u4E0B(\u6216\u8005\u8BF4\u6B63\u5E38\u60C5\u51B5\u4E0B)\uFF0C\u5728&quot;\u95EE\u9898\u4EE3\u7801\u5904&quot;\uFF0C\u4F1A\u6267\u884C\u5982\u4E0B\u64CD\u4F5C\uFF0C\u4FDD\u8BC1\u80FD\u83B7\u53D6\u5230\u5DF2\u5B8C\u6210\u521D\u59CB\u5316\u7684\u5B9E\u4F8B</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922210741247.png" alt="image-20210922210741247"></p><p>\u7531\u4E8E\u5B58\u5728\u6307\u4EE4\u91CD\u6392\u5E8F......</p><p><strong>\u591A\u7EBF\u7A0B\u770B\u95EE\u9898\u4EE3\u7801</strong></p><p>\u9690\u60A3\uFF1A\u591A\u7EBF\u7A0B\u73AF\u5883\u4E0B\uFF0C\u5728&quot;\u95EE\u9898\u4EE3\u7801\u5904&quot;\uFF0C\u4F1A\u6267\u884C\u5982\u4E0B\u64CD\u4F5C\uFF0C\u7531\u4E8E\u91CD\u6392\u5E8F\u5BFC\u81F42,3\u4E71\u5E8F\uFF0C\u540E\u679C\u5C31\u662F\u5176\u4ED6\u7EBF\u7A0B\u5F97\u5230\u7684\u662Fnull\u800C\u4E0D\u662F\u5B8C\u6210\u521D\u59CB\u5316\u7684\u5BF9\u8C61</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922210815931.png" alt="image-20210922210815931"></p><p><strong>\u89E3\u51B301</strong></p><p>\u52A0volatile\u4FEE\u9970</p><p>\u9762\u8BD5\u9898\uFF0C\u53CD\u5468\u5FD7\u660E\u8001\u5E08\u7684\u6848\u4F8B\uFF0C\u4F60\u8FD8\u6709\u4E0D\u52A0volatile\u7684\u65B9\u6CD5\u5417</p><p><strong>\u89E3\u51B302</strong> -- \u91C7\u7528\u9759\u6001\u5185\u90E8\u7C7B\u7684\u65B9\u5F0F\u5B9E\u73B0</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//\u73B0\u5728\u6BD4\u8F83\u597D\u7684\u505A\u6CD5\u5C31\u662F\u91C7\u7528\u9759\u6001\u5185\u90E8\u5185\u7684\u65B9\u5F0F\u5B9E\u73B0</span>
 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SingletonDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">SingletonDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SingletonDemoHandler</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">SingletonDemo</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SingletonDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SingletonDemo</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">SingletonDemoHandler</span><span class="token punctuation">.</span>instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5\u3001\u6700\u540E\u7684\u5C0F\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u6700\u540E\u7684\u5C0F\u603B\u7ED3" aria-hidden="true">#</a> 5\u3001\u6700\u540E\u7684\u5C0F\u603B\u7ED3</h4><h5 id="_1\u3001\u5185\u5B58\u5C4F\u969C\u662F\u4EC0\u4E48" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5185\u5B58\u5C4F\u969C\u662F\u4EC0\u4E48" aria-hidden="true">#</a> 1\u3001\u5185\u5B58\u5C4F\u969C\u662F\u4EC0\u4E48</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922211112799.png" alt="image-20210922211112799"></p><h5 id="_2\u3001\u5185\u5B58\u5C4F\u969C\u80FD\u5E72\u561B" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5185\u5B58\u5C4F\u969C\u80FD\u5E72\u561B" aria-hidden="true">#</a> 2\u3001\u5185\u5B58\u5C4F\u969C\u80FD\u5E72\u561B</h5><ul><li>\u963B\u6B62\u5C4F\u969C\u4E24\u8FB9\u7684\u6307\u4EE4\u91CD\u6392\u5E8F</li><li>\u5199\u6570\u636E\u65F6\u52A0\u5165\u5C4F\u969C\uFF0C\u5F3A\u5236\u5C06\u7EBF\u7A0B\u79C1\u6709\u5DE5\u4F5C\u5185\u5B58\u7684\u6570\u636E\u5237\u56DE\u4E3B\u7269\u7406\u5185\u5B58</li><li>\u8BFB\u6570\u636E\u65F6\u52A0\u5165\u5C4F\u969C\uFF0C\u7EBF\u7A0B\u79C1\u6709\u5DE5\u4F5C\u5185\u5B58\u7684\u6570\u636E\u5931\u6548\uFF0C\u91CD\u65B0\u5230\u4E3B\u7269\u7406\u5185\u5B58\u4E2D\u83B7\u53D6\u6700\u65B0\u6570\u636E</li></ul><h5 id="_3\u3001\u5185\u5B58\u5C4F\u969C\u56DB\u5927\u6307\u4EE4" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5185\u5B58\u5C4F\u969C\u56DB\u5927\u6307\u4EE4" aria-hidden="true">#</a> 3\u3001\u5185\u5B58\u5C4F\u969C\u56DB\u5927\u6307\u4EE4</h5><ul><li>\u5728\u6BCF\u4E00\u4E2Avolatile\u5199\u64CD\u4F5C\u524D\u9762\u63D2\u5165\u4E00\u4E2AStoreStore\u5C4F\u969C <ul><li><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922211216698.png" alt="image-20210922211216698"></li></ul></li><li>\u5728\u6BCF\u4E00\u4E2Avolatile\u5199\u64CD\u4F5C\u540E\u9762\u63D2\u5165\u4E00\u4E2AStoreLoad\u5C4F\u969C <ul><li><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922211234267.png" alt="image-20210922211234267"></li></ul></li><li>\u5728\u6BCF\u4E00\u4E2Avolatile\u8BFB\u64CD\u4F5C\u540E\u9762\u63D2\u5165\u4E00\u4E2ALoadLoad\u5C4F\u969C <ul><li><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922211247865.png" alt="image-20210922211247865"></li></ul></li><li>\u5728\u6BCF\u4E00\u4E2Avolatile\u8BFB\u64CD\u4F5C\u540E\u9762\u63D2\u5165\u4E00\u4E2ALoadStore\u5C4F\u969C <ul><li><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922211259274.png" alt="image-20210922211259274"></li></ul></li></ul><h5 id="_4\u3001\u51ED\u4EC0\u4E48\u6211\u4EECjava\u5199\u4E86\u4E00\u4E2Avolatile\u5173\u952E\u5B57\u7CFB\u7EDF\u5E95\u5C42\u52A0\u5165\u5185\u5B58\u5C4F\u969C-\u4E24\u8005\u5173\u7CFB\u600E\u4E48\u52FE\u642D\u4E0A\u7684" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u51ED\u4EC0\u4E48\u6211\u4EECjava\u5199\u4E86\u4E00\u4E2Avolatile\u5173\u952E\u5B57\u7CFB\u7EDF\u5E95\u5C42\u52A0\u5165\u5185\u5B58\u5C4F\u969C-\u4E24\u8005\u5173\u7CFB\u600E\u4E48\u52FE\u642D\u4E0A\u7684" aria-hidden="true">#</a> 4\u3001\u51ED\u4EC0\u4E48\u6211\u4EECjava\u5199\u4E86\u4E00\u4E2Avolatile\u5173\u952E\u5B57\u7CFB\u7EDF\u5E95\u5C42\u52A0\u5165\u5185\u5B58\u5C4F\u969C\uFF1F\u4E24\u8005\u5173\u7CFB\u600E\u4E48\u52FE\u642D\u4E0A\u7684?</h5><p>\u5B57\u8282\u7801\u5C42\u9762</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922211344635.png" alt="image-20210922211344635"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922211354764.png" alt="image-20210922211354764"></p><h5 id="_5\u3001volatile\u53EF\u89C1\u6027" tabindex="-1"><a class="header-anchor" href="#_5\u3001volatile\u53EF\u89C1\u6027" aria-hidden="true">#</a> 5\u3001volatile\u53EF\u89C1\u6027</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922211419405.png" alt="image-20210922211419405"></p><h5 id="_6\u3001volatile\u7981\u91CD\u6392" tabindex="-1"><a class="header-anchor" href="#_6\u3001volatile\u7981\u91CD\u6392" aria-hidden="true">#</a> 6\u3001volatile\u7981\u91CD\u6392</h5><p>\u5199\u6307\u4EE4</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922211436123.png" alt="image-20210922211436123"></p><p>\u8BFB\u6307\u4EE4</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922211447326.png" alt="image-20210922211447326"></p><h5 id="_7\u3001\u5BF9\u6BD4java-util-concurrent-locks-lock\u6765\u7406\u89E3" tabindex="-1"><a class="header-anchor" href="#_7\u3001\u5BF9\u6BD4java-util-concurrent-locks-lock\u6765\u7406\u89E3" aria-hidden="true">#</a> 7\u3001\u5BF9\u6BD4java.util.concurrent.locks.Lock\u6765\u7406\u89E3</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922211501481.png" alt="image-20210922211501481"></p><h5 id="_8\u3001\u4E00\u53E5\u8BDD\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#_8\u3001\u4E00\u53E5\u8BDD\u603B\u7ED3" aria-hidden="true">#</a> 8\u3001\u4E00\u53E5\u8BDD\u603B\u7ED3</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922211532860.png" alt="image-20210922211532860"></p><h2 id="\u5341\u4E00\u3001cas" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E00\u3001cas" aria-hidden="true">#</a> \u5341\u4E00\u3001CAS</h2><h3 id="_1\u3001\u6CA1\u6709cas\u4E4B\u524D" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u6CA1\u6709cas\u4E4B\u524D" aria-hidden="true">#</a> 1\u3001\u6CA1\u6709CAS\u4E4B\u524D</h3><h4 id="_1\u3001\u591A\u7EBF\u7A0B\u73AF\u5883\u4E0D\u4F7F\u7528\u539F\u5B50\u7C7B\u4FDD\u8BC1\u7EBF\u7A0B\u5B89\u5168-\u57FA\u672C\u6570\u636E\u7C7B\u578B" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u591A\u7EBF\u7A0B\u73AF\u5883\u4E0D\u4F7F\u7528\u539F\u5B50\u7C7B\u4FDD\u8BC1\u7EBF\u7A0B\u5B89\u5168-\u57FA\u672C\u6570\u636E\u7C7B\u578B" aria-hidden="true">#</a> 1\u3001\u591A\u7EBF\u7A0B\u73AF\u5883\u4E0D\u4F7F\u7528\u539F\u5B50\u7C7B\u4FDD\u8BC1\u7EBF\u7A0B\u5B89\u5168\uFF08\u57FA\u672C\u6570\u636E\u7C7B\u578B\uFF09</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">T3</span>
<span class="token punctuation">{</span>
    <span class="token keyword">volatile</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">//\u8BFB\u53D6</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> number<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u5199\u5165\u52A0\u9501\u4FDD\u8BC1\u539F\u5B50\u6027</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        number<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2\u3001\u591A\u7EBF\u7A0B\u73AF\u5883-\u4F7F\u7528\u539F\u5B50\u7C7B\u4FDD\u8BC1\u7EBF\u7A0B\u5B89\u5168-\u57FA\u672C\u6570\u636E\u7C7B\u578B" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u591A\u7EBF\u7A0B\u73AF\u5883-\u4F7F\u7528\u539F\u5B50\u7C7B\u4FDD\u8BC1\u7EBF\u7A0B\u5B89\u5168-\u57FA\u672C\u6570\u636E\u7C7B\u578B" aria-hidden="true">#</a> 2\u3001\u591A\u7EBF\u7A0B\u73AF\u5883 \u4F7F\u7528\u539F\u5B50\u7C7B\u4FDD\u8BC1\u7EBF\u7A0B\u5B89\u5168\uFF08\u57FA\u672C\u6570\u636E\u7C7B\u578B\uFF09</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">T3</span>
<span class="token punctuation">{</span>
    <span class="token keyword">volatile</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">//\u8BFB\u53D6</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> number<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u5199\u5165\u52A0\u9501\u4FDD\u8BC1\u539F\u5B50\u6027</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        number<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//=================================</span>
    <span class="token class-name">AtomicInteger</span> atomicInteger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> atomicInteger<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        atomicInteger<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2\u3001cas\u662F\u4EC0\u4E48" tabindex="-1"><a class="header-anchor" href="#_2\u3001cas\u662F\u4EC0\u4E48" aria-hidden="true">#</a> 2\u3001CAS\u662F\u4EC0\u4E48</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>compare and swap\u7684\u7F29\u5199\uFF0C\u4E2D\u6587\u7FFB\u8BD1\u6210\u6BD4\u8F83\u5E76\u4EA4\u6362,\u5B9E\u73B0\u5E76\u53D1\u7B97\u6CD5\u65F6\u5E38\u7528\u5230\u7684\u4E00\u79CD\u6280\u672F\u3002\u5B83\u5305\u542B\u4E09\u4E2A\u64CD\u4F5C\u6570\u2014\u2014\u5185\u5B58\u4F4D\u7F6E\u3001\u9884\u671F\u539F\u503C\u53CA\u66F4\u65B0\u503C\u3002
\u6267\u884CCAS\u64CD\u4F5C\u7684\u65F6\u5019\uFF0C\u5C06\u5185\u5B58\u4F4D\u7F6E\u7684\u503C\u4E0E\u9884\u671F\u539F\u503C\u6BD4\u8F83\uFF1A
\u5982\u679C\u76F8\u5339\u914D\uFF0C\u90A3\u4E48\u5904\u7406\u5668\u4F1A\u81EA\u52A8\u5C06\u8BE5\u4F4D\u7F6E\u503C\u66F4\u65B0\u4E3A\u65B0\u503C\uFF0C
\u5982\u679C\u4E0D\u5339\u914D\uFF0C\u5904\u7406\u5668\u4E0D\u505A\u4EFB\u4F55\u64CD\u4F5C\uFF0C\u591A\u4E2A\u7EBF\u7A0B\u540C\u65F6\u6267\u884CCAS\u64CD\u4F5C\u53EA\u6709\u4E00\u4E2A\u4F1A\u6210\u529F\u3002 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>CAS\u67093\u4E2A\u64CD\u4F5C\u6570\uFF0C\u4F4D\u7F6E\u5185\u5B58\u503CV\uFF0C\u65E7\u7684\u9884\u671F\u503CA\uFF0C\u8981\u4FEE\u6539\u7684\u66F4\u65B0\u503CB\u3002 \u5F53\u4E14\u4EC5\u5F53\u65E7\u7684\u9884\u671F\u503CA\u548C\u5185\u5B58\u503CV\u76F8\u540C\u65F6\uFF0C\u5C06\u5185\u5B58\u503CV\u4FEE\u6539\u4E3AB\uFF0C\u5426\u5219\u4EC0\u4E48\u90FD\u4E0D\u505A\u6216\u91CD\u6765</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922211800641.png" alt="image-20210922211800641"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>CAS\u662FJDK\u63D0\u4F9B\u7684\u975E\u963B\u585E\u539F\u5B50\u6027\u64CD\u4F5C\uFF0C\u5B83\u901A\u8FC7\u786C\u4EF6\u4FDD\u8BC1\u4E86\u6BD4\u8F83<span class="token operator">-</span>\u66F4\u65B0\u7684\u539F\u5B50\u6027\u3002
\u5B83\u662F\u975E\u963B\u585E\u7684\u4E14\u81EA\u8EAB\u539F\u5B50\u6027\uFF0C\u4E5F\u5C31\u662F\u8BF4\u8FD9\u73A9\u610F\u6548\u7387\u66F4\u9AD8\u4E14\u901A\u8FC7\u786C\u4EF6\u4FDD\u8BC1\uFF0C\u8BF4\u660E\u8FD9\u73A9\u610F\u66F4\u53EF\u9760\u3002
 
CAS\u662F\u4E00\u6761CPU\u7684\u539F\u5B50\u6307\u4EE4\uFF08cmpxchg\u6307\u4EE4\uFF09\uFF0C\u4E0D\u4F1A\u9020\u6210\u6240\u8C13\u7684\u6570\u636E\u4E0D\u4E00\u81F4\u95EE\u9898\uFF0C<span class="token class-name">Unsafe</span>\u63D0\u4F9B\u7684CAS\u65B9\u6CD5\uFF08\u5982compareAndSwapXXX\uFF09\u5E95\u5C42\u5B9E\u73B0\u5373\u4E3ACPU\u6307\u4EE4cmpxchg\u3002
\u6267\u884Ccmpxchg\u6307\u4EE4\u7684\u65F6\u5019\uFF0C\u4F1A\u5224\u65AD\u5F53\u524D\u7CFB\u7EDF\u662F\u5426\u4E3A\u591A\u6838\u7CFB\u7EDF\uFF0C\u5982\u679C\u662F\u5C31\u7ED9\u603B\u7EBF\u52A0\u9501\uFF0C\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B\u4F1A\u5BF9\u603B\u7EBF\u52A0\u9501\u6210\u529F\uFF0C\u52A0\u9501\u6210\u529F\u4E4B\u540E\u4F1A\u6267\u884Ccas\u64CD\u4F5C\uFF0C\u4E5F\u5C31\u662F\u8BF4CAS\u7684\u539F\u5B50\u6027\u5B9E\u9645\u4E0A\u662FCPU\u5B9E\u73B0\u7684\uFF0C \u5176\u5B9E\u5728\u8FD9\u4E00\u70B9\u4E0A\u8FD8\u662F\u6709\u6392\u4ED6\u9501\u7684\uFF0C\u53EA\u662F\u6BD4\u8D77\u7528<span class="token keyword">synchronized</span>\uFF0C \u8FD9\u91CC\u7684\u6392\u4ED6\u65F6\u95F4\u8981\u77ED\u7684\u591A\uFF0C \u6240\u4EE5\u5728\u591A\u7EBF\u7A0B\u60C5\u51B5\u4E0B\u6027\u80FD\u4F1A\u6BD4\u8F83\u597D
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CASDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">AtomicInteger</span> atomicInteger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>atomicInteger<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2020</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>atomicInteger<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>atomicInteger<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>atomicInteger<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1\u3001\u6E90\u7801\u5206\u6790compareandset-int-expect-int-update" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u6E90\u7801\u5206\u6790compareandset-int-expect-int-update" aria-hidden="true">#</a> 1\u3001\u6E90\u7801\u5206\u6790compareAndSet(int expect,int update)</h4><p>compareAndSet()\u65B9\u6CD5\u7684\u6E90\u4EE3\u7801\uFF1A</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922211916954.png" alt="image-20210922211916954"></p><p>\u4E0A\u9762\u4E09\u4E2A\u65B9\u6CD5\u90FD\u662F\u7C7B\u4F3C\u7684\uFF0C\u4E3B\u8981\u5BF94\u4E2A\u53C2\u6570\u505A\u4E00\u4E0B\u8BF4\u660E\u3002 var1\uFF1A\u8868\u793A\u8981\u64CD\u4F5C\u7684\u5BF9\u8C61 var2\uFF1A\u8868\u793A\u8981\u64CD\u4F5C\u5BF9\u8C61\u4E2D\u5C5E\u6027\u5730\u5740\u7684\u504F\u79FB\u91CF var4\uFF1A\u8868\u793A\u9700\u8981\u4FEE\u6539\u6570\u636E\u7684\u671F\u671B\u7684\u503C var5/var6\uFF1A\u8868\u793A\u9700\u8981\u4FEE\u6539\u4E3A\u7684\u65B0\u503C</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922211925337.png" alt="image-20210922211925337"></p><h3 id="_3\u3001cas\u5E95\u5C42\u539F\u7406-\u5982\u679C\u77E5\u9053-\u8C08\u8C08\u4F60\u5BF9unsafe\u7684\u7406\u89E3" tabindex="-1"><a class="header-anchor" href="#_3\u3001cas\u5E95\u5C42\u539F\u7406-\u5982\u679C\u77E5\u9053-\u8C08\u8C08\u4F60\u5BF9unsafe\u7684\u7406\u89E3" aria-hidden="true">#</a> 3\u3001CAS\u5E95\u5C42\u539F\u7406\uFF1F\u5982\u679C\u77E5\u9053\uFF0C\u8C08\u8C08\u4F60\u5BF9UnSafe\u7684\u7406\u89E3</h3><h4 id="_1\u3001unsafe" tabindex="-1"><a class="header-anchor" href="#_1\u3001unsafe" aria-hidden="true">#</a> 1\u3001UnSafe</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922212018603.png" alt="image-20210922212018603"></p><ol><li><p>Unsafe \u662FCAS\u7684\u6838\u5FC3\u7C7B\uFF0C\u7531\u4E8EJava\u65B9\u6CD5\u65E0\u6CD5\u76F4\u63A5\u8BBF\u95EE\u5E95\u5C42\u7CFB\u7EDF\uFF0C\u9700\u8981\u901A\u8FC7\u672C\u5730\uFF08native\uFF09\u65B9\u6CD5\u6765\u8BBF\u95EE\uFF0CUnsafe\u76F8\u5F53\u4E8E\u4E00\u4E2A\u540E\u95E8\uFF0C\u57FA\u4E8E\u8BE5\u7C7B\u53EF\u4EE5\u76F4\u63A5\u64CD\u4F5C\u7279\u5B9A\u5185\u5B58\u7684\u6570\u636E\u3002Unsafe\u7C7B\u5B58\u5728\u4E8Esun.misc\u5305\u4E2D\uFF0C\u5176\u5185\u90E8\u65B9\u6CD5\u64CD\u4F5C\u53EF\u4EE5\u50CFC\u7684\u6307\u9488\u4E00\u6837\u76F4\u63A5\u64CD\u4F5C\u5185\u5B58\uFF0C\u56E0\u4E3AJava\u4E2DCAS\u64CD\u4F5C\u7684\u6267\u884C\u4F9D\u8D56\u4E8EUnsafe\u7C7B\u7684\u65B9\u6CD5\u3002 \u6CE8\u610FUnsafe\u7C7B\u4E2D\u7684\u6240\u6709\u65B9\u6CD5\u90FD\u662Fnative\u4FEE\u9970\u7684\uFF0C\u4E5F\u5C31\u662F\u8BF4Unsafe\u7C7B\u4E2D\u7684\u65B9\u6CD5\u90FD\u76F4\u63A5\u8C03\u7528\u64CD\u4F5C\u7CFB\u7EDF\u5E95\u5C42\u8D44\u6E90\u6267\u884C\u76F8\u5E94\u4EFB\u52A1</p></li><li><p>\u53D8\u91CFvalueOffset\uFF0C\u8868\u793A\u8BE5\u53D8\u91CF\u503C\u5728\u5185\u5B58\u4E2D\u7684\u504F\u79FB\u5730\u5740\uFF0C\u56E0\u4E3AUnsafe\u5C31\u662F\u6839\u636E\u5185\u5B58\u504F\u79FB\u5730\u5740\u83B7\u53D6\u6570\u636E\u7684\u3002</p></li></ol><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922212041394.png" alt="image-20210922212041394"></p><ol start="3"><li>\u53D8\u91CFvalue\u7528volatile\u4FEE\u9970\uFF0C\u4FDD\u8BC1\u4E86\u591A\u7EBF\u7A0B\u4E4B\u95F4\u7684\u5185\u5B58\u53EF\u89C1\u6027\u3002</li></ol><h4 id="_2\u3001\u6211\u4EEC\u77E5\u9053i-\u7EBF\u7A0B\u4E0D\u5B89\u5168\u7684-\u90A3atomicinteger-getandincrement" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u6211\u4EEC\u77E5\u9053i-\u7EBF\u7A0B\u4E0D\u5B89\u5168\u7684-\u90A3atomicinteger-getandincrement" aria-hidden="true">#</a> 2\u3001\u6211\u4EEC\u77E5\u9053i++\u7EBF\u7A0B\u4E0D\u5B89\u5168\u7684\uFF0C\u90A3atomicInteger.getAndIncrement()</h4><p>CAS\u7684\u5168\u79F0\u4E3ACompare-And-Swap\uFF0C\u5B83\u662F\u4E00\u6761CPU\u5E76\u53D1\u539F\u8BED\u3002 \u5B83\u7684\u529F\u80FD\u662F\u5224\u65AD\u5185\u5B58\u67D0\u4E2A\u4F4D\u7F6E\u7684\u503C\u662F\u5426\u4E3A\u9884\u671F\u503C\uFF0C\u5982\u679C\u662F\u5219\u66F4\u6539\u4E3A\u65B0\u7684\u503C\uFF0C\u8FD9\u4E2A\u8FC7\u7A0B\u662F\u539F\u5B50\u7684\u3002 AtomicInteger \u7C7B\u4E3B\u8981\u5229\u7528 CAS (compare and swap) + volatile \u548C native \u65B9\u6CD5\u6765\u4FDD\u8BC1\u539F\u5B50\u64CD\u4F5C\uFF0C\u4ECE\u800C\u907F\u514D synchronized \u7684\u9AD8\u5F00\u9500\uFF0C\u6267\u884C\u6548\u7387\u5927\u4E3A\u63D0\u5347\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922212208816.png" alt="image-20210922212208816"></p><p>new AtomicInteger().getAndIncrement();</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922212236304.png" alt="image-20210922212236304"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922212248701.png" alt="image-20210922212248701"></p><p>\u5047\u8BBE\u7EBF\u7A0BA\u548C\u7EBF\u7A0BB\u4E24\u4E2A\u7EBF\u7A0B\u540C\u65F6\u6267\u884CgetAndAddInt\u64CD\u4F5C\uFF08\u5206\u522B\u8DD1\u5728\u4E0D\u540CCPU\u4E0A\uFF09\uFF1A</p><ol><li><p>AtomicInteger\u91CC\u9762\u7684value\u539F\u59CB\u503C\u4E3A3\uFF0C\u5373\u4E3B\u5185\u5B58\u4E2DAtomicInteger\u7684value\u4E3A3\uFF0C\u6839\u636EJMM\u6A21\u578B\uFF0C\u7EBF\u7A0BA\u548C\u7EBF\u7A0BB\u5404\u81EA\u6301\u6709\u4E00\u4EFD\u503C\u4E3A3\u7684value\u7684\u526F\u672C\u5206\u522B\u5230\u5404\u81EA\u7684\u5DE5\u4F5C\u5185\u5B58\u3002</p></li><li><p>\u7EBF\u7A0BA\u901A\u8FC7getIntVolatile(var1, var2)\u62FF\u5230value\u503C3\uFF0C\u8FD9\u65F6\u7EBF\u7A0BA\u88AB\u6302\u8D77\u3002</p></li><li><p>\u7EBF\u7A0BB\u4E5F\u901A\u8FC7getIntVolatile(var1, var2)\u65B9\u6CD5\u83B7\u53D6\u5230value\u503C3\uFF0C\u6B64\u65F6\u521A\u597D\u7EBF\u7A0BB\u6CA1\u6709\u88AB\u6302\u8D77\u5E76\u6267\u884CcompareAndSwapInt\u65B9\u6CD5\u6BD4\u8F83\u5185\u5B58\u503C\u4E5F\u4E3A3\uFF0C\u6210\u529F\u4FEE\u6539\u5185\u5B58\u503C\u4E3A4\uFF0C\u7EBF\u7A0BB\u6253\u5B8C\u6536\u5DE5\uFF0C\u4E00\u5207OK\u3002</p></li><li><p>\u8FD9\u65F6\u7EBF\u7A0BA\u6062\u590D\uFF0C\u6267\u884CcompareAndSwapInt\u65B9\u6CD5\u6BD4\u8F83\uFF0C\u53D1\u73B0\u81EA\u5DF1\u624B\u91CC\u7684\u503C\u6570\u5B573\u548C\u4E3B\u5185\u5B58\u7684\u503C\u6570\u5B574\u4E0D\u4E00\u81F4\uFF0C\u8BF4\u660E\u8BE5\u503C\u5DF2\u7ECF\u88AB\u5176\u5B83\u7EBF\u7A0B\u62A2\u5148\u4E00\u6B65\u4FEE\u6539\u8FC7\u4E86\uFF0C\u90A3A\u7EBF\u7A0B\u672C\u6B21\u4FEE\u6539\u5931\u8D25\uFF0C\u53EA\u80FD\u91CD\u65B0\u8BFB\u53D6\u91CD\u65B0\u6765\u4E00\u904D\u4E86\u3002</p></li><li><p>\u7EBF\u7A0BA\u91CD\u65B0\u83B7\u53D6value\u503C\uFF0C\u56E0\u4E3A\u53D8\u91CFvalue\u88ABvolatile\u4FEE\u9970\uFF0C\u6240\u4EE5\u5176\u5B83\u7EBF\u7A0B\u5BF9\u5B83\u7684\u4FEE\u6539\uFF0C\u7EBF\u7A0BA\u603B\u662F\u80FD\u591F\u770B\u5230\uFF0C\u7EBF\u7A0BA\u7EE7\u7EED\u6267\u884CcompareAndSwapInt\u8FDB\u884C\u6BD4\u8F83\u66FF\u6362\uFF0C\u76F4\u5230\u6210\u529F\u3002</p></li></ol><h4 id="_3\u3001\u5E95\u5C42\u6C47\u7F16" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5E95\u5C42\u6C47\u7F16" aria-hidden="true">#</a> 3\u3001\u5E95\u5C42\u6C47\u7F16</h4><p>native\u4FEE\u9970\u7684\u65B9\u6CD5\u4EE3\u8868\u662F\u5E95\u5C42\u65B9\u6CD5</p><p>Unsafe\u7C7B\u4E2D\u7684compareAndSwapInt\uFF0C\u662F\u4E00\u4E2A\u672C\u5730\u65B9\u6CD5\uFF0C\u8BE5\u65B9\u6CD5\u7684\u5B9E\u73B0\u4F4D\u4E8Eunsafe.cpp\u4E2D</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token function">UNSAFE_ENTRY</span><span class="token punctuation">(</span>jboolean<span class="token punctuation">,</span> <span class="token function">Unsafe_CompareAndSwapInt</span><span class="token punctuation">(</span>JNIEnv <span class="token operator">*</span>env<span class="token punctuation">,</span> jobject unsafe<span class="token punctuation">,</span> jobject obj<span class="token punctuation">,</span> jlong offset<span class="token punctuation">,</span> jint e<span class="token punctuation">,</span> jint x<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">UnsafeWrapper</span><span class="token punctuation">(</span><span class="token string">&quot;Unsafe_CompareAndSwapInt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  oop p <span class="token operator">=</span> JNIHandles<span class="token operator">::</span><span class="token function">resolve</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u5148\u60F3\u529E\u6CD5\u62FF\u5230\u53D8\u91CFvalue\u5728\u5185\u5B58\u4E2D\u7684\u5730\u5740\uFF0C\u6839\u636E\u504F\u79FB\u91CFvalueOffset\uFF0C\u8BA1\u7B97 value \u7684\u5730\u5740</span>
  jint<span class="token operator">*</span> addr <span class="token operator">=</span> <span class="token punctuation">(</span>jint <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">index_oop_from_field_offset_long</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// \u8C03\u7528 Atomic \u4E2D\u7684\u51FD\u6570 cmpxchg\u6765\u8FDB\u884C\u6BD4\u8F83\u4EA4\u6362\uFF0C\u5176\u4E2D\u53C2\u6570x\u662F\u5373\u5C06\u66F4\u65B0\u7684\u503C\uFF0C\u53C2\u6570e\u662F\u539F\u5185\u5B58\u7684\u503C</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>jint<span class="token punctuation">)</span><span class="token punctuation">(</span>Atomic<span class="token operator">::</span><span class="token function">cmpxchg</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> e<span class="token punctuation">;</span>
UNSAFE_END
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(Atomic::cmpxchg(x, addr, e)) == e;</p><p>cmpxchg</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token comment">// \u8C03\u7528 Atomic \u4E2D\u7684\u51FD\u6570 cmpxchg\u6765\u8FDB\u884C\u6BD4\u8F83\u4EA4\u6362\uFF0C\u5176\u4E2D\u53C2\u6570x\u662F\u5373\u5C06\u66F4\u65B0\u7684\u503C\uFF0C\u53C2\u6570e\u662F\u539F\u5185\u5B58\u7684\u503C</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>jint<span class="token punctuation">)</span><span class="token punctuation">(</span>Atomic<span class="token operator">::</span><span class="token function">cmpxchg</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> e<span class="token punctuation">;</span>

<span class="token keyword">unsigned</span> Atomic<span class="token operator">::</span><span class="token function">cmpxchg</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> exchange_value<span class="token punctuation">,</span><span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">*</span> dest<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> compare_value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">assert</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>jint<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;more work to do&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/*
   * \u6839\u636E\u64CD\u4F5C\u7CFB\u7EDF\u7C7B\u578B\u8C03\u7528\u4E0D\u540C\u5E73\u53F0\u4E0B\u7684\u91CD\u8F7D\u51FD\u6570\uFF0C\u8FD9\u4E2A\u5728\u9884\u7F16\u8BD1\u671F\u95F4\u7F16\u8BD1\u5668\u4F1A\u51B3\u5B9A\u8C03\u7528\u54EA\u4E2A\u5E73\u53F0\u4E0B\u7684\u91CD\u8F7D\u51FD\u6570*/</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>Atomic<span class="token operator">::</span><span class="token function">cmpxchg</span><span class="token punctuation">(</span><span class="token punctuation">(</span>jint<span class="token punctuation">)</span>exchange_value<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">volatile</span> jint<span class="token operator">*</span><span class="token punctuation">)</span>dest<span class="token punctuation">,</span> <span class="token punctuation">(</span>jint<span class="token punctuation">)</span>compare_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728\u4E0D\u540C\u7684\u64CD\u4F5C\u7CFB\u7EDF\u4E0B\u4F1A\u8C03\u7528\u4E0D\u540C\u7684cmpxchg\u91CD\u8F7D\u51FD\u6570\uFF0C\u672C\u6B21\u7528\u7684\u662Fwin10\u7CFB\u7EDF</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">inline</span> jint Atomic<span class="token operator">::</span><span class="token function">cmpxchg</span> <span class="token punctuation">(</span>jint exchange_value<span class="token punctuation">,</span> <span class="token keyword">volatile</span> jint<span class="token operator">*</span> dest<span class="token punctuation">,</span> jint compare_value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//\u5224\u65AD\u662F\u5426\u662F\u591A\u6838CPU</span>
  <span class="token keyword">int</span> mp <span class="token operator">=</span> os<span class="token operator">::</span><span class="token function">is_MP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  __asm <span class="token punctuation">{</span>
    <span class="token comment">//\u4E09\u4E2Amove\u6307\u4EE4\u8868\u793A\u7684\u662F\u5C06\u540E\u9762\u7684\u503C\u79FB\u52A8\u5230\u524D\u9762\u7684\u5BC4\u5B58\u5668\u4E0A</span>
    mov edx<span class="token punctuation">,</span> dest
    mov ecx<span class="token punctuation">,</span> exchange_value
    mov eax<span class="token punctuation">,</span> compare_value
    <span class="token comment">//CPU\u539F\u8BED\u7EA7\u522B\uFF0CCPU\u89E6\u53D1</span>
    <span class="token function">LOCK_IF_MP</span><span class="token punctuation">(</span>mp<span class="token punctuation">)</span>
    <span class="token comment">//\u6BD4\u8F83\u5E76\u4EA4\u6362\u6307\u4EE4</span>
    <span class="token comment">//cmpxchg: \u5373\u201C\u6BD4\u8F83\u5E76\u4EA4\u6362\u201D\u6307\u4EE4</span>
    <span class="token comment">//dword: \u5168\u79F0\u662F double word \u8868\u793A\u4E24\u4E2A\u5B57\uFF0C\u4E00\u5171\u56DB\u4E2A\u5B57\u8282</span>
    <span class="token comment">//ptr: \u5168\u79F0\u662F pointer\uFF0C\u4E0E\u524D\u9762\u7684 dword \u8FDE\u8D77\u6765\u4F7F\u7528\uFF0C\u8868\u660E\u8BBF\u95EE\u7684\u5185\u5B58\u5355\u5143\u662F\u4E00\u4E2A\u53CC\u5B57\u5355\u5143 </span>
    <span class="token comment">//\u5C06 eax \u5BC4\u5B58\u5668\u4E2D\u7684\u503C\uFF08compare_value\uFF09\u4E0E [edx] \u53CC\u5B57\u5185\u5B58\u5355\u5143\u4E2D\u7684\u503C\u8FDB\u884C\u5BF9\u6BD4\uFF0C</span>
    <span class="token comment">//\u5982\u679C\u76F8\u540C\uFF0C\u5219\u5C06 ecx \u5BC4\u5B58\u5668\u4E2D\u7684\u503C\uFF08exchange_value\uFF09\u5B58\u5165 [edx] \u5185\u5B58\u5355\u5143\u4E2D</span>
    cmpxchg dword ptr <span class="token punctuation">[</span>edx<span class="token punctuation">]</span><span class="token punctuation">,</span> ecx
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5230\u8FD9\u91CC\u5E94\u8BE5\u7406\u89E3\u4E86CAS\u771F\u6B63\u5B9E\u73B0\u7684\u673A\u5236\u4E86\uFF0C\u5B83\u6700\u7EC8\u662F\u7531\u64CD\u4F5C\u7CFB\u7EDF\u7684\u6C47\u7F16\u6307\u4EE4\u5B8C\u6210\u7684\u3002</p><h4 id="_4\u3001\u603B\u7ED3-2" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u603B\u7ED3-2" aria-hidden="true">#</a> 4\u3001\u603B\u7ED3</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>\u4F60\u53EA\u9700\u8981\u8BB0\u4F4F\uFF1ACAS\u662F\u9760\u786C\u4EF6\u5B9E\u73B0\u7684\u4ECE\u800C\u5728\u786C\u4EF6\u5C42\u9762\u63D0\u5347\u6548\u7387\uFF0C\u6700\u5E95\u5C42\u8FD8\u662F\u4EA4\u7ED9\u786C\u4EF6\u6765\u4FDD\u8BC1\u539F\u5B50\u6027\u548C\u53EF\u89C1\u6027
\u5B9E\u73B0\u65B9\u5F0F\u662F\u57FA\u4E8E\u786C\u4EF6\u5E73\u53F0\u7684\u6C47\u7F16\u6307\u4EE4\uFF0C\u5728intel\u7684CPU\u4E2D<span class="token punctuation">(</span>X86\u673A\u5668\u4E0A<span class="token punctuation">)</span>\uFF0C\u4F7F\u7528\u7684\u662F\u6C47\u7F16\u6307\u4EE4cmpxchg\u6307\u4EE4\u3002 
 
\u6838\u5FC3\u601D\u60F3\u5C31\u662F\uFF1A\u6BD4\u8F83\u8981\u66F4\u65B0\u53D8\u91CF\u7684\u503C<span class="token class-name">V</span>\u548C\u9884\u671F\u503C<span class="token class-name">E</span>\uFF08compare\uFF09\uFF0C\u76F8\u7B49\u624D\u4F1A\u5C06<span class="token class-name">V</span>\u7684\u503C\u8BBE\u4E3A\u65B0\u503C<span class="token class-name">N</span>\uFF08swap\uFF09\u5982\u679C\u4E0D\u76F8\u7B49\u81EA\u65CB\u518D\u6765\u3002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4\u3001\u539F\u5B50\u5F15\u7528" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u539F\u5B50\u5F15\u7528" aria-hidden="true">#</a> 4\u3001\u539F\u5B50\u5F15\u7528</h3><p>AtomicInteger\u539F\u5B50\u6574\u578B\uFF0C\u53EF\u5426\u6709\u5176\u5B83\u539F\u5B50\u7C7B\u578B\uFF1F</p><ul><li>AtomicBook</li><li>AtomicOrder</li><li>\u3002\u3002\u3002</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">class</span> <span class="token class-name">User</span>
<span class="token punctuation">{</span>
    <span class="token class-name">String</span> userName<span class="token punctuation">;</span>
    <span class="token keyword">int</span>    age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@auther</span> zzyy
 * <span class="token keyword">@create</span> 2018-12-31 17:22
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicReferenceDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">User</span> z3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;z3&quot;</span><span class="token punctuation">,</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> li4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;li4&quot;</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> atomicReferenceUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        atomicReferenceUser<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>z3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>atomicReferenceUser<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>z3<span class="token punctuation">,</span>li4<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>atomicReferenceUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>atomicReferenceUser<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>z3<span class="token punctuation">,</span>li4<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>atomicReferenceUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5\u3001\u81EA\u65CB\u9501-\u501F\u9274cas\u601D\u60F3" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u81EA\u65CB\u9501-\u501F\u9274cas\u601D\u60F3" aria-hidden="true">#</a> 5\u3001\u81EA\u65CB\u9501\uFF0C\u501F\u9274CAS\u601D\u60F3</h3><p>\u81EA\u65CB\u9501\uFF08spinlock\uFF09</p><p>\u662F\u6307\u5C1D\u8BD5\u83B7\u53D6\u9501\u7684\u7EBF\u7A0B\u4E0D\u4F1A\u7ACB\u5373\u963B\u585E\uFF0C\u800C\u662F\u91C7\u7528\u5FAA\u73AF\u7684\u65B9\u5F0F\u53BB\u5C1D\u8BD5\u83B7\u53D6\u9501\uFF0C \u5F53\u7EBF\u7A0B\u53D1\u73B0\u9501\u88AB\u5360\u7528\u65F6\uFF0C\u4F1A\u4E0D\u65AD\u5FAA\u73AF\u5224\u65AD\u9501\u7684\u72B6\u6001\uFF0C\u76F4\u5230\u83B7\u53D6\u3002\u8FD9\u6837\u7684\u597D\u5904\u662F\u51CF\u5C11\u7EBF\u7A0B\u4E0A\u4E0B\u6587\u5207\u6362\u7684\u6D88\u8017\uFF0C\u7F3A\u70B9\u662F\u5FAA\u73AF\u4F1A\u6D88\u8017CPU</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922212914003.png" alt="image-20210922212914003"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u9898\u76EE\uFF1A\u5B9E\u73B0\u4E00\u4E2A\u81EA\u65CB\u9501
 * \u81EA\u65CB\u9501\u597D\u5904\uFF1A\u5FAA\u73AF\u6BD4\u8F83\u83B7\u53D6\u6CA1\u6709\u7C7B\u4F3Cwait\u7684\u963B\u585E\u3002
 *
 * \u901A\u8FC7CAS\u64CD\u4F5C\u5B8C\u6210\u81EA\u65CB\u9501\uFF0CA\u7EBF\u7A0B\u5148\u8FDB\u6765\u8C03\u7528myLock\u65B9\u6CD5\u81EA\u5DF1\u6301\u6709\u95015\u79D2\u949F\uFF0CB\u968F\u540E\u8FDB\u6765\u540E\u53D1\u73B0
 * \u5F53\u524D\u6709\u7EBF\u7A0B\u6301\u6709\u9501\uFF0C\u4E0D\u662Fnull\uFF0C\u6240\u4EE5\u53EA\u80FD\u901A\u8FC7\u81EA\u65CB\u7B49\u5F85\uFF0C\u76F4\u5230A\u91CA\u653E\u9501\u540EB\u968F\u540E\u62A2\u5230\u3002
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpinLockDemo</span>
<span class="token punctuation">{</span>
    <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">&gt;</span></span> atomicReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t come in&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>atomicReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>thread<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myUnLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        atomicReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>thread<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t myUnLock over&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">SpinLockDemo</span> spinLockDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpinLockDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            spinLockDemo<span class="token punctuation">.</span><span class="token function">myLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span> <span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            spinLockDemo<span class="token punctuation">.</span><span class="token function">myUnLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C\u4E00\u4F1A\u513F\u7EBF\u7A0B\uFF0C\u4FDD\u8BC1A\u7EBF\u7A0B\u5148\u4E8EB\u7EBF\u7A0B\u542F\u52A8\u5E76\u5B8C\u6210</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            spinLockDemo<span class="token punctuation">.</span><span class="token function">myLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            spinLockDemo<span class="token punctuation">.</span><span class="token function">myUnLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6\u3001cas\u7F3A\u70B9" tabindex="-1"><a class="header-anchor" href="#_6\u3001cas\u7F3A\u70B9" aria-hidden="true">#</a> 6\u3001CAS\u7F3A\u70B9</h3><h4 id="_1\u3001\u5FAA\u73AF\u65F6\u95F4\u957F\u5F00\u9500\u5F88\u5927" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5FAA\u73AF\u65F6\u95F4\u957F\u5F00\u9500\u5F88\u5927" aria-hidden="true">#</a> 1\u3001\u5FAA\u73AF\u65F6\u95F4\u957F\u5F00\u9500\u5F88\u5927</h4><p>\u6211\u4EEC\u53EF\u4EE5\u770B\u5230getAndAddInt\u65B9\u6CD5\u6267\u884C\u65F6\uFF0C\u6709\u4E2Ado while</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922213308155.png" alt="image-20210922213308155"></p><p>\u5982\u679CCAS\u5931\u8D25\uFF0C\u4F1A\u4E00\u76F4\u8FDB\u884C\u5C1D\u8BD5\u3002\u5982\u679CCAS\u957F\u65F6\u95F4\u4E00\u76F4\u4E0D\u6210\u529F\uFF0C\u53EF\u80FD\u4F1A\u7ED9CPU\u5E26\u6765\u5F88\u5927\u7684\u5F00\u9500\u3002</p><h4 id="_2\u3001\u5F15\u51FA\u6765aba\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5F15\u51FA\u6765aba\u95EE\u9898" aria-hidden="true">#</a> 2\u3001\u5F15\u51FA\u6765ABA\u95EE\u9898\uFF1F\uFF1F\uFF1F</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>CAS\u4F1A\u5BFC\u81F4\u201CABA\u95EE\u9898\u201D\u3002
 
CAS\u7B97\u6CD5\u5B9E\u73B0\u4E00\u4E2A\u91CD\u8981\u524D\u63D0\u9700\u8981\u53D6\u51FA\u5185\u5B58\u4E2D\u67D0\u65F6\u523B\u7684\u6570\u636E\u5E76\u5728\u5F53\u4E0B\u65F6\u523B\u6BD4\u8F83\u5E76\u66FF\u6362\uFF0C\u90A3\u4E48\u5728\u8FD9\u4E2A\u65F6\u95F4\u5DEE\u7C7B\u4F1A\u5BFC\u81F4\u6570\u636E\u7684\u53D8\u5316\u3002
 
\u6BD4\u5982\u8BF4\u4E00\u4E2A\u7EBF\u7A0Bone\u4ECE\u5185\u5B58\u4F4D\u7F6E<span class="token class-name">V</span>\u4E2D\u53D6\u51FA<span class="token class-name">A</span>\uFF0C\u8FD9\u65F6\u5019\u53E6\u4E00\u4E2A\u7EBF\u7A0Btwo\u4E5F\u4ECE\u5185\u5B58\u4E2D\u53D6\u51FA<span class="token class-name">A</span>\uFF0C\u5E76\u4E14\u7EBF\u7A0Btwo\u8FDB\u884C\u4E86\u4E00\u4E9B\u64CD\u4F5C\u5C06\u503C\u53D8\u6210\u4E86<span class="token class-name">B</span>\uFF0C
\u7136\u540E\u7EBF\u7A0Btwo\u53C8\u5C06<span class="token class-name">V</span>\u4F4D\u7F6E\u7684\u6570\u636E\u53D8\u6210<span class="token class-name">A</span>\uFF0C\u8FD9\u65F6\u5019\u7EBF\u7A0Bone\u8FDB\u884CCAS\u64CD\u4F5C\u53D1\u73B0\u5185\u5B58\u4E2D\u4ECD\u7136\u662F<span class="token class-name">A</span>\uFF0C\u7136\u540E\u7EBF\u7A0Bone\u64CD\u4F5C\u6210\u529F\u3002
 
\u5C3D\u7BA1\u7EBF\u7A0Bone\u7684CAS\u64CD\u4F5C\u6210\u529F\uFF0C\u4F46\u662F\u4E0D\u4EE3\u8868\u8FD9\u4E2A\u8FC7\u7A0B\u5C31\u662F\u6CA1\u6709\u95EE\u9898\u7684\u3002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ABADemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">AtomicInteger</span> atomicInteger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">AtomicStampedReference</span> atomicStampedReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicStampedReference</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            atomicInteger<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            atomicInteger<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//\u6682\u505C\u4E00\u4F1A\u513F\u7EBF\u7A0B</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span> <span class="token number">500</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>atomicInteger<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">2019</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>atomicInteger<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C\u4E00\u4F1A\u513F\u7EBF\u7A0B,main\u5F7B\u5E95\u7B49\u5F85\u4E0A\u9762\u7684ABA\u51FA\u73B0\u6F14\u793A\u5B8C\u6210\u3002</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span> <span class="token number">2000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;============\u4EE5\u4E0B\u662FABA\u95EE\u9898\u7684\u89E3\u51B3=============================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> stamp <span class="token operator">=</span> atomicStampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t \u9996\u6B21\u7248\u672C\u53F7:&quot;</span><span class="token operator">+</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1</span>
            <span class="token comment">//\u6682\u505C\u4E00\u4F1A\u513F\u7EBF\u7A0B,</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span> <span class="token number">1000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            atomicStampedReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span>atomicStampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>atomicStampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t 2\u6B21\u7248\u672C\u53F7:&quot;</span><span class="token operator">+</span>atomicStampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            atomicStampedReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span>atomicStampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>atomicStampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t 3\u6B21\u7248\u672C\u53F7:&quot;</span><span class="token operator">+</span>atomicStampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> stamp <span class="token operator">=</span> atomicStampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t \u9996\u6B21\u7248\u672C\u53F7:&quot;</span><span class="token operator">+</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1</span>
            <span class="token comment">//\u6682\u505C\u4E00\u4F1A\u513F\u7EBF\u7A0B\uFF0C\u83B7\u5F97\u521D\u59CB\u503C100\u548C\u521D\u59CB\u7248\u672C\u53F71\uFF0C\u6545\u610F\u6682\u505C3\u79D2\u949F\u8BA9t3\u7EBF\u7A0B\u5B8C\u6210\u4E00\u6B21ABA\u64CD\u4F5C\u4EA7\u751F\u95EE\u9898</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span> <span class="token number">3000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">boolean</span> result <span class="token operator">=</span> atomicStampedReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">2019</span><span class="token punctuation">,</span>stamp<span class="token punctuation">,</span>stamp<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>result<span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>atomicStampedReference<span class="token punctuation">.</span><span class="token function">getReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5341\u4E8C\u3001\u539F\u5B50\u64CD\u4F5C\u7C7B\u4E4B18\u7F57\u6C49\u589E\u5F3A" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E8C\u3001\u539F\u5B50\u64CD\u4F5C\u7C7B\u4E4B18\u7F57\u6C49\u589E\u5F3A" aria-hidden="true">#</a> \u5341\u4E8C\u3001\u539F\u5B50\u64CD\u4F5C\u7C7B\u4E4B18\u7F57\u6C49\u589E\u5F3A</h2><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210922213530641.png" alt="image-20210922213530641"></p><ol><li>AtomicBoolean</li><li>AtomicInteger</li><li>AtomicIntegerArray</li><li>AtomicIntegerFieldUpdater</li><li>AtomicLong</li><li>AtomicLongArray</li><li>AtomicLongFieldUpdater</li><li>AtomicMarkableReference</li><li>AtomicReference</li><li>AtomicReferenceArray</li><li>AtomicReferenceFieldUpdater</li><li>AtomicStampedReference</li><li>DoubleAccumulator</li><li>DoubleAdder</li><li>LongAccumulator</li><li>LongAdder</li></ol><h3 id="_1\u3001\u57FA\u672C\u7C7B\u578B\u539F\u5B50\u7C7B" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u57FA\u672C\u7C7B\u578B\u539F\u5B50\u7C7B" aria-hidden="true">#</a> 1\u3001\u57FA\u672C\u7C7B\u578B\u539F\u5B50\u7C7B</h3><ul><li>AtomicInteger</li><li>AtomicBoolean</li><li>AtomicLong</li></ul><h4 id="_1\u3001\u5E38\u7528api\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5E38\u7528api\u7B80\u4ECB" aria-hidden="true">#</a> 1\u3001\u5E38\u7528API\u7B80\u4ECB</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//\u83B7\u53D6\u5F53\u524D\u7684\u503C</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndSet</span><span class="token punctuation">(</span><span class="token keyword">int</span> newValue<span class="token punctuation">)</span><span class="token comment">//\u83B7\u53D6\u5F53\u524D\u7684\u503C\uFF0C\u5E76\u8BBE\u7F6E\u65B0\u7684\u503C</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//\u83B7\u53D6\u5F53\u524D\u7684\u503C\uFF0C\u5E76\u81EA\u589E</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndDecrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//\u83B7\u53D6\u5F53\u524D\u7684\u503C\uFF0C\u5E76\u81EA\u51CF</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">getAndAdd</span><span class="token punctuation">(</span><span class="token keyword">int</span> delta<span class="token punctuation">)</span> <span class="token comment">//\u83B7\u53D6\u5F53\u524D\u7684\u503C\uFF0C\u5E76\u52A0\u4E0A\u9884\u671F\u7684\u503C</span>
<span class="token keyword">boolean</span> <span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token keyword">int</span> expect<span class="token punctuation">,</span> <span class="token keyword">int</span> update<span class="token punctuation">)</span> <span class="token comment">//\u5982\u679C\u8F93\u5165\u7684\u6570\u503C\u7B49\u4E8E\u9884\u671F\u503C\uFF0C\u5219\u4EE5\u539F\u5B50\u65B9\u5F0F\u5C06\u8BE5\u503C\u8BBE\u7F6E\u4E3A\u8F93\u5165\u503C\uFF08update\uFF09</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2\u3001tsleep\u2192countdownlatch" tabindex="-1"><a class="header-anchor" href="#_2\u3001tsleep\u2192countdownlatch" aria-hidden="true">#</a> 2\u3001tsleep\u2192countDownLatch</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">MyNumber</span>
<span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Getter</span>
    <span class="token keyword">private</span> <span class="token class-name">AtomicInteger</span> atomicInteger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addPlusPlus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        atomicInteger<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@create</span> 2020-07-03 17:16
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicIntegerDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">MyNumber</span> myNumber <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span><span class="token number">5000</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        myNumber<span class="token punctuation">.</span><span class="token function">addPlusPlus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>myNumber<span class="token punctuation">.</span><span class="token function">getAtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2\u3001\u6570\u7EC4\u7C7B\u578B\u539F\u5B50\u7C7B" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u6570\u7EC4\u7C7B\u578B\u539F\u5B50\u7C7B" aria-hidden="true">#</a> 2\u3001\u6570\u7EC4\u7C7B\u578B\u539F\u5B50\u7C7B</h3><ul><li>AtomicIntegerArray</li><li>AtomicLongArray</li><li>AtomicReferenceArray</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicIntegerArrayDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">AtomicIntegerArray</span> atomicIntegerArray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicIntegerArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//AtomicIntegerArray atomicIntegerArray = new AtomicIntegerArray(5);</span>
        <span class="token comment">//AtomicIntegerArray atomicIntegerArray = new AtomicIntegerArray(new int[]{1,2,3,4,5});</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span>atomicIntegerArray<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>atomicIntegerArray<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> tmpInt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        tmpInt <span class="token operator">=</span> atomicIntegerArray<span class="token punctuation">.</span><span class="token function">getAndSet</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1122</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>tmpInt<span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>atomicIntegerArray<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        atomicIntegerArray<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        atomicIntegerArray<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tmpInt <span class="token operator">=</span> atomicIntegerArray<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>tmpInt<span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>atomicIntegerArray<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3\u3001\u5F15\u7528\u7C7B\u578B\u539F\u5B50\u7C7B" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5F15\u7528\u7C7B\u578B\u539F\u5B50\u7C7B" aria-hidden="true">#</a> 3\u3001\u5F15\u7528\u7C7B\u578B\u539F\u5B50\u7C7B</h3><ul><li>AtomicReference</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@ToString</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">class</span> <span class="token class-name">User</span>
<span class="token punctuation">{</span>
    <span class="token class-name">String</span> userName<span class="token punctuation">;</span>
    <span class="token keyword">int</span>    age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicReferenceDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">User</span> z3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;z3&quot;</span><span class="token punctuation">,</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> li4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;li4&quot;</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> atomicReferenceUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        atomicReferenceUser<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>z3<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>atomicReferenceUser<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>z3<span class="token punctuation">,</span>li4<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>atomicReferenceUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>atomicReferenceUser<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>z3<span class="token punctuation">,</span>li4<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>atomicReferenceUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u81EA\u65CB\u9501SpinLockDemo</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u9898\u76EE\uFF1A\u5B9E\u73B0\u4E00\u4E2A\u81EA\u65CB\u9501
 * \u81EA\u65CB\u9501\u597D\u5904\uFF1A\u5FAA\u73AF\u6BD4\u8F83\u83B7\u53D6\u6CA1\u6709\u7C7B\u4F3Cwait\u7684\u963B\u585E\u3002
 *
 * \u901A\u8FC7CAS\u64CD\u4F5C\u5B8C\u6210\u81EA\u65CB\u9501\uFF0CA\u7EBF\u7A0B\u5148\u8FDB\u6765\u8C03\u7528myLock\u65B9\u6CD5\u81EA\u5DF1\u6301\u6709\u95015\u79D2\u949F\uFF0CB\u968F\u540E\u8FDB\u6765\u540E\u53D1\u73B0
 * \u5F53\u524D\u6709\u7EBF\u7A0B\u6301\u6709\u9501\uFF0C\u4E0D\u662Fnull\uFF0C\u6240\u4EE5\u53EA\u80FD\u901A\u8FC7\u81EA\u65CB\u7B49\u5F85\uFF0C\u76F4\u5230A\u91CA\u653E\u9501\u540EB\u968F\u540E\u62A2\u5230\u3002
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpinLockDemo</span>
<span class="token punctuation">{</span>
    <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Thread</span><span class="token punctuation">&gt;</span></span> atomicReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t come in&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>atomicReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>thread<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myUnLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        atomicReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>thread<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t myUnLock over&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">SpinLockDemo</span> spinLockDemo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpinLockDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            spinLockDemo<span class="token punctuation">.</span><span class="token function">myLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//\u6682\u505C\u4E00\u4F1A\u513F\u7EBF\u7A0B</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span> <span class="token number">5</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            spinLockDemo<span class="token punctuation">.</span><span class="token function">myUnLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u6682\u505C\u4E00\u4F1A\u513F\u7EBF\u7A0B\uFF0C\u4FDD\u8BC1A\u7EBF\u7A0B\u5148\u4E8EB\u7EBF\u7A0B\u542F\u52A8\u5E76\u5B8C\u6210</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            spinLockDemo<span class="token punctuation">.</span><span class="token function">myLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            spinLockDemo<span class="token punctuation">.</span><span class="token function">myUnLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>AtomicStampedReference <ul><li>\u643A\u5E26\u7248\u672C\u53F7\u7684\u5F15\u7528\u7C7B\u578B\u539F\u5B50\u7C7B\uFF0C\u53EF\u4EE5\u89E3\u51B3ABA\u95EE\u9898</li><li>\u89E3\u51B3\u4FEE\u6539\u8FC7\u51E0\u6B21</li><li>\u72B6\u6001\u6233\u539F\u5B50\u5F15\u7528</li></ul></li></ul><p>ABADemo</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ABADemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">AtomicInteger</span> atomicInteger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">AtomicStampedReference</span> atomicStampedReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicStampedReference</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">abaProblem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">abaResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">abaResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> stamp <span class="token operator">=</span> atomicStampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;t3 ----\u7B2C1\u6B21stamp  &quot;</span><span class="token operator">+</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            atomicStampedReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span>stamp<span class="token punctuation">,</span>stamp<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;t3 ----\u7B2C2\u6B21stamp  &quot;</span><span class="token operator">+</span>atomicStampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            atomicStampedReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span>atomicStampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>atomicStampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;t3 ----\u7B2C3\u6B21stamp  &quot;</span><span class="token operator">+</span>atomicStampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> stamp <span class="token operator">=</span> atomicStampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;t4 ----\u7B2C1\u6B21stamp  &quot;</span><span class="token operator">+</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">boolean</span> result <span class="token operator">=</span> atomicStampedReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">20210308</span><span class="token punctuation">,</span> stamp<span class="token punctuation">,</span> stamp <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>result<span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>atomicStampedReference<span class="token punctuation">.</span><span class="token function">getReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">abaProblem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            atomicInteger<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            atomicInteger<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            atomicInteger<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">20210308</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>atomicInteger<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>AtomicMarkableReference <ul><li>\u539F\u5B50\u66F4\u65B0\u5E26\u6709\u6807\u8BB0\u4F4D\u7684\u5F15\u7528\u7C7B\u578B\u5BF9\u8C61</li><li>\u89E3\u51B3\u662F\u5426\u4FEE\u6539\u8FC7 \u5B83\u7684\u5B9A\u4E49\u5C31\u662F\u5C06\u72B6\u6001\u6233\u7B80\u5316\u4E3Atrue|false -- \u7C7B\u4F3C\u4E00\u6B21\u6027\u7B77\u5B50</li></ul></li></ul><p>\u72B6\u6001\u6233(true/false)\u539F\u5B50\u5F15\u7528</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ABADemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">AtomicInteger</span> atomicInteger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">AtomicStampedReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> stampedReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicStampedReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">AtomicMarkableReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> markableReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicMarkableReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            atomicInteger<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            atomicInteger<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;update ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            atomicInteger<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>atomicInteger<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;============\u4EE5\u4E0B\u662FABA\u95EE\u9898\u7684\u89E3\u51B3,\u8BA9\u6211\u4EEC\u77E5\u9053\u5F15\u7528\u53D8\u91CF\u4E2D\u9014\u88AB\u66F4\u6539\u4E86\u51E0\u6B21=========================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t 1\u6B21\u7248\u672C\u53F7&quot;</span><span class="token operator">+</span>stampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//\u6545\u610F\u6682\u505C200\u6BEB\u79D2\uFF0C\u8BA9\u540E\u9762\u7684t4\u7EBF\u7A0B\u62FF\u5230\u548Ct3\u4E00\u6837\u7684\u7248\u672C\u53F7</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

            stampedReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span>stampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>stampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t 2\u6B21\u7248\u672C\u53F7&quot;</span><span class="token operator">+</span>stampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            stampedReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span>stampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>stampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t 3\u6B21\u7248\u672C\u53F7&quot;</span><span class="token operator">+</span>stampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> stamp <span class="token operator">=</span> stampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t =======1\u6B21\u7248\u672C\u53F7&quot;</span><span class="token operator">+</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//\u6682\u505C2\u79D2\u949F,\u8BA9t3\u5148\u5B8C\u6210ABA\u64CD\u4F5C\u4E86\uFF0C\u770B\u770B\u81EA\u5DF1\u8FD8\u80FD\u5426\u4FEE\u6539</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">boolean</span> b <span class="token operator">=</span> stampedReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">2020</span><span class="token punctuation">,</span> stamp<span class="token punctuation">,</span> stamp <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t=======2\u6B21\u7248\u672C\u53F7&quot;</span><span class="token operator">+</span>stampedReference<span class="token punctuation">.</span><span class="token function">getStamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>stampedReference<span class="token punctuation">.</span><span class="token function">getReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;============AtomicMarkableReference\u4E0D\u5173\u5FC3\u5F15\u7528\u53D8\u91CF\u66F4\u6539\u8FC7\u51E0\u6B21\uFF0C\u53EA\u5173\u5FC3\u662F\u5426\u66F4\u6539\u8FC7======================&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">boolean</span> marked <span class="token operator">=</span> markableReference<span class="token punctuation">.</span><span class="token function">isMarked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t 1\u6B21\u7248\u672C\u53F7&quot;</span><span class="token operator">+</span>marked<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            markableReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span>marked<span class="token punctuation">,</span><span class="token operator">!</span>marked<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t 2\u6B21\u7248\u672C\u53F7&quot;</span><span class="token operator">+</span>markableReference<span class="token punctuation">.</span><span class="token function">isMarked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            markableReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span>markableReference<span class="token punctuation">.</span><span class="token function">isMarked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">!</span>markableReference<span class="token punctuation">.</span><span class="token function">isMarked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t 3\u6B21\u7248\u672C\u53F7&quot;</span><span class="token operator">+</span>markableReference<span class="token punctuation">.</span><span class="token function">isMarked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">boolean</span> marked <span class="token operator">=</span> markableReference<span class="token punctuation">.</span><span class="token function">isMarked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t 1\u6B21\u7248\u672C\u53F7&quot;</span><span class="token operator">+</span>marked<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            markableReference<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">2020</span><span class="token punctuation">,</span>marked<span class="token punctuation">,</span><span class="token operator">!</span>marked<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>markableReference<span class="token punctuation">.</span><span class="token function">getReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>markableReference<span class="token punctuation">.</span><span class="token function">isMarked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4\u3001\u5BF9\u8C61\u7684\u5C5E\u6027\u4FEE\u6539\u539F\u5B50\u7C7B" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u5BF9\u8C61\u7684\u5C5E\u6027\u4FEE\u6539\u539F\u5B50\u7C7B" aria-hidden="true">#</a> 4\u3001\u5BF9\u8C61\u7684\u5C5E\u6027\u4FEE\u6539\u539F\u5B50\u7C7B</h3><ul><li>AtomicIntegerFieldUpdater <ul><li>\u539F\u5B50\u66F4\u65B0\u5BF9\u8C61\u4E2Dint\u7C7B\u578B\u5B57\u6BB5\u7684\u503C</li></ul></li><li>AtomicLongFieldUpdater <ul><li>\u539F\u5B50\u66F4\u65B0\u5BF9\u8C61\u4E2DLong\u7C7B\u578B\u5B57\u6BB5\u7684\u503C</li></ul></li><li>AtomicReferenceFieldUpdater <ul><li>\u539F\u5B50\u66F4\u65B0\u5F15\u7528\u7C7B\u578B\u5B57\u6BB5\u7684\u503C</li></ul></li></ul><h4 id="_1\u3001\u4F7F\u7528\u76EE\u7684" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u4F7F\u7528\u76EE\u7684" aria-hidden="true">#</a> 1\u3001\u4F7F\u7528\u76EE\u7684</h4><p>\u4EE5\u4E00\u79CD\u7EBF\u7A0B\u5B89\u5168\u7684\u65B9\u5F0F\u64CD\u4F5C\u975E\u7EBF\u7A0B\u5B89\u5168\u5BF9\u8C61\u5185\u7684\u67D0\u4E9B\u5B57\u6BB5</p><h4 id="_2\u3001\u4F7F\u7528\u8981\u6C42" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u4F7F\u7528\u8981\u6C42" aria-hidden="true">#</a> 2\u3001\u4F7F\u7528\u8981\u6C42</h4><p>\u66F4\u65B0\u7684\u5BF9\u8C61\u5C5E\u6027\u5FC5\u987B\u4F7F\u7528 public volatile \u4FEE\u9970\u7B26\u3002</p><p>\u56E0\u4E3A\u5BF9\u8C61\u7684\u5C5E\u6027\u4FEE\u6539\u7C7B\u578B\u539F\u5B50\u7C7B\u90FD\u662F\u62BD\u8C61\u7C7B\uFF0C\u6240\u4EE5\u6BCF\u6B21\u4F7F\u7528\u90FD\u5FC5\u987B\u4F7F\u7528\u9759\u6001\u65B9\u6CD5newUpdater()\u521B\u5EFA\u4E00\u4E2A\u66F4\u65B0\u5668\uFF0C\u5E76\u4E14\u9700\u8981\u8BBE\u7F6E\u60F3\u8981\u66F4\u65B0\u7684\u7C7B\u548C\u5C5E\u6027\u3002</p><h4 id="_3\u3001atomicintegerfieldupdaterdemo" tabindex="-1"><a class="header-anchor" href="#_3\u3001atomicintegerfieldupdaterdemo" aria-hidden="true">#</a> 3\u3001AtomicIntegerFieldUpdaterDemo</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">BankAccount</span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> bankName <span class="token operator">=</span> <span class="token string">&quot;CCB&quot;</span><span class="token punctuation">;</span><span class="token comment">//\u94F6\u884C</span>
    <span class="token keyword">public</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> money <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//\u94B1\u6570</span>
    <span class="token class-name">AtomicIntegerFieldUpdater</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BankAccount</span><span class="token punctuation">&gt;</span></span> accountAtomicIntegerFieldUpdater <span class="token operator">=</span> <span class="token class-name">AtomicIntegerFieldUpdater</span><span class="token punctuation">.</span><span class="token function">newUpdater</span><span class="token punctuation">(</span><span class="token class-name">BankAccount</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token string">&quot;money&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//\u4E0D\u52A0\u9501+\u6027\u80FD\u9AD8\uFF0C\u5C40\u90E8\u5FAE\u521B</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">transferMoney</span><span class="token punctuation">(</span><span class="token class-name">BankAccount</span> bankAccount<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        accountAtomicIntegerFieldUpdater<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span>bankAccount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@auther</span> zzyy
 * <span class="token keyword">@create</span> 2020-07-14 18:06
 * \u4EE5\u4E00\u79CD\u7EBF\u7A0B\u5B89\u5168\u7684\u65B9\u5F0F\u64CD\u4F5C\u975E\u7EBF\u7A0B\u5B89\u5168\u5BF9\u8C61\u7684\u67D0\u4E9B\u5B57\u6BB5\u3002
 * \u9700\u6C42\uFF1A
 * 1000\u4E2A\u4EBA\u540C\u65F6\u5411\u4E00\u4E2A\u8D26\u53F7\u8F6C\u8D26\u4E00\u5143\u94B1\uFF0C\u90A3\u4E48\u7D2F\u8BA1\u5E94\u8BE5\u589E\u52A01000\u5143\uFF0C
 * \u9664\u4E86synchronized\u548CCAS,\u8FD8\u53EF\u4EE5\u4F7F\u7528AtomicIntegerFieldUpdater\u6765\u5B9E\u73B0\u3002
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicIntegerFieldUpdaterDemo</span>
<span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">BankAccount</span> bankAccount <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BankAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> finalI <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                bankAccount<span class="token punctuation">.</span><span class="token function">transferMoney</span><span class="token punctuation">(</span>bankAccount<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//\u6682\u505C\u6BEB\u79D2</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bankAccount<span class="token punctuation">.</span>money<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4\u3001atomicreferencefieldupdater" tabindex="-1"><a class="header-anchor" href="#_4\u3001atomicreferencefieldupdater" aria-hidden="true">#</a> 4\u3001AtomicReferenceFieldUpdater</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">MyVar</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">volatile</span> <span class="token class-name">Boolean</span> isInit <span class="token operator">=</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span>FALSE<span class="token punctuation">;</span>
    <span class="token class-name">AtomicReferenceFieldUpdater</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyVar</span><span class="token punctuation">,</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> atomicReferenceFieldUpdater <span class="token operator">=</span> <span class="token class-name">AtomicReferenceFieldUpdater</span><span class="token punctuation">.</span><span class="token function">newUpdater</span><span class="token punctuation">(</span><span class="token class-name">MyVar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token string">&quot;isInit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">MyVar</span> myVar<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>atomicReferenceFieldUpdater<span class="token punctuation">.</span><span class="token function">compareAndSet</span><span class="token punctuation">(</span>myVar<span class="token punctuation">,</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span>FALSE<span class="token punctuation">,</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;---init.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;---init.....over&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;------\u5176\u5B83\u7EBF\u7A0B\u6B63\u5728\u521D\u59CB\u5316&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


<span class="token punctuation">}</span>


<span class="token doc-comment comment">/**
 * \u591A\u7EBF\u7A0B\u5E76\u53D1\u8C03\u7528\u4E00\u4E2A\u7C7B\u7684\u521D\u59CB\u5316\u65B9\u6CD5\uFF0C\u5982\u679C\u672A\u88AB\u521D\u59CB\u5316\u8FC7\uFF0C\u5C06\u6267\u884C\u521D\u59CB\u5316\u5DE5\u4F5C\uFF0C\u8981\u6C42\u53EA\u80FD\u521D\u59CB\u5316\u4E00\u6B21
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicIntegerFieldUpdaterDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">MyVar</span> myVar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyVar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                myVar<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>myVar<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5\u3001\u4F60\u5728\u54EA\u91CC\u7528\u4E86volatile" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u4F60\u5728\u54EA\u91CC\u7528\u4E86volatile" aria-hidden="true">#</a> 5\u3001\u4F60\u5728\u54EA\u91CC\u7528\u4E86volatile</h3><p>AtomicReferenceFieldUpdater</p><h3 id="_6\u3001\u539F\u5B50\u64CD\u4F5C\u589E\u5F3A\u7C7B\u539F\u7406\u6DF1\u5EA6\u89E3\u6790" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u539F\u5B50\u64CD\u4F5C\u589E\u5F3A\u7C7B\u539F\u7406\u6DF1\u5EA6\u89E3\u6790" aria-hidden="true">#</a> 6\u3001\u539F\u5B50\u64CD\u4F5C\u589E\u5F3A\u7C7B\u539F\u7406\u6DF1\u5EA6\u89E3\u6790</h3><ul><li>DoubleAccumulator</li><li>DoubleAdder</li><li>LongAccumulator</li><li>LongAdder</li></ul><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925210537531.png" alt="image-20210925210537531"></p><h4 id="_1\u3001\u70B9\u8D5E\u8BA1\u6570\u5668-\u770B\u770B\u6027\u80FD" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u70B9\u8D5E\u8BA1\u6570\u5668-\u770B\u770B\u6027\u80FD" aria-hidden="true">#</a> 1\u3001\u70B9\u8D5E\u8BA1\u6570\u5668\uFF0C\u770B\u770B\u6027\u80FD</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925210601595.png" alt="image-20210925210601595"></p><p>LongAdder\u53EA\u80FD\u7528\u6765\u8BA1\u7B97\u52A0\u6CD5\uFF0C\u4E14\u4ECE\u96F6\u5F00\u59CB\u8BA1\u7B97</p><p>LongAccumulator\u63D0\u4F9B\u4E86\u81EA\u5B9A\u4E49\u7684\u51FD\u6570\u64CD\u4F5C</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//long\u7C7B\u578B\u7684\u805A\u5408\u5668\uFF0C\u9700\u8981\u4F20\u5165\u4E00\u4E2Along\u7C7B\u578B\u7684\u4E8C\u5143\u64CD\u4F5C\uFF0C\u53EF\u4EE5\u7528\u6765\u8BA1\u7B97\u5404\u79CD\u805A\u5408\u64CD\u4F5C\uFF0C\u5305\u62EC\u52A0\u4E58\u7B49</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token class-name">LongAccumulator</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token class-name">LongAdder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">LongBinaryOperator</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LongAccumulatorDemo</span>
<span class="token punctuation">{</span>

    <span class="token class-name">LongAdder</span> longAdder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LongAdder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add_LongAdder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        longAdder<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//LongAccumulator longAccumulator = new LongAccumulator((x, y) -&gt; x + y,0);</span>
    <span class="token class-name">LongAccumulator</span> longAccumulator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LongAccumulator</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LongBinaryOperator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">applyAsLong</span><span class="token punctuation">(</span><span class="token keyword">long</span> left<span class="token punctuation">,</span> <span class="token keyword">long</span> right<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> left <span class="token operator">-</span> right<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add_LongAccumulator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        longAccumulator<span class="token punctuation">.</span><span class="token function">accumulate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">LongAccumulatorDemo</span> demo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LongAccumulatorDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        demo<span class="token punctuation">.</span><span class="token function">add_LongAccumulator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        demo<span class="token punctuation">.</span><span class="token function">add_LongAccumulator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>demo<span class="token punctuation">.</span>longAccumulator<span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2\u3001longadderapidemo" tabindex="-1"><a class="header-anchor" href="#_2\u3001longadderapidemo" aria-hidden="true">#</a> 2\u3001LongAdderAPIDemo</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LongAdderAPIDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">LongAdder</span> longAdder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LongAdder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        longAdder<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        longAdder<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        longAdder<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>longAdder<span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">LongAccumulator</span> longAccumulator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LongAccumulator</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> x <span class="token operator">*</span> y<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        longAccumulator<span class="token punctuation">.</span><span class="token function">accumulate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        longAccumulator<span class="token punctuation">.</span><span class="token function">accumulate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        longAccumulator<span class="token punctuation">.</span><span class="token function">accumulate</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>longAccumulator<span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3\u3001longadder\u9AD8\u6027\u80FD\u5BF9\u6BD4code\u6F14\u793A" tabindex="-1"><a class="header-anchor" href="#_3\u3001longadder\u9AD8\u6027\u80FD\u5BF9\u6BD4code\u6F14\u793A" aria-hidden="true">#</a> 3\u3001LongAdder\u9AD8\u6027\u80FD\u5BF9\u6BD4Code\u6F14\u793A</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">ClickNumberNet</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">clickBySync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        number<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">AtomicLong</span> atomicLong <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicLong</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clickByAtomicLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        atomicLong<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">LongAdder</span> longAdder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LongAdder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clickByLongAdder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        longAdder<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">LongAccumulator</span> longAccumulator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LongAccumulator</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">clickByLongAccumulator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        longAccumulator<span class="token punctuation">.</span><span class="token function">accumulate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@auther</span> zzyy
 * <span class="token keyword">@create</span> 2020-05-21 22:23
 * 50\u4E2A\u7EBF\u7A0B\uFF0C\u6BCF\u4E2A\u7EBF\u7A0B100W\u6B21\uFF0C\u603B\u70B9\u8D5E\u6570\u51FA\u6765
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LongAdderDemo2</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">ClickNumberNet</span> clickNumberNet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClickNumberNet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">long</span> startTime<span class="token punctuation">;</span>
        <span class="token keyword">long</span> endTime<span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span><span class="token number">100</span> <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        clickNumberNet<span class="token punctuation">.</span><span class="token function">clickBySync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----costTime: &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">&quot; \u6BEB\u79D2&quot;</span><span class="token operator">+</span><span class="token string">&quot;\\t clickBySync result: &quot;</span><span class="token operator">+</span>clickNumberNet<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>

        startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span><span class="token number">100</span> <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        clickNumberNet<span class="token punctuation">.</span><span class="token function">clickByAtomicLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    countDownLatch2<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        countDownLatch2<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----costTime: &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">&quot; \u6BEB\u79D2&quot;</span><span class="token operator">+</span><span class="token string">&quot;\\t clickByAtomicLong result: &quot;</span><span class="token operator">+</span>clickNumberNet<span class="token punctuation">.</span>atomicLong<span class="token punctuation">)</span><span class="token punctuation">;</span>

        startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span><span class="token number">100</span> <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        clickNumberNet<span class="token punctuation">.</span><span class="token function">clickByLongAdder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    countDownLatch3<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        countDownLatch3<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----costTime: &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">&quot; \u6BEB\u79D2&quot;</span><span class="token operator">+</span><span class="token string">&quot;\\t clickByLongAdder result: &quot;</span><span class="token operator">+</span>clickNumberNet<span class="token punctuation">.</span>longAdder<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span><span class="token number">100</span> <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        clickNumberNet<span class="token punctuation">.</span><span class="token function">clickByLongAccumulator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    countDownLatch4<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        countDownLatch4<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        endTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;----costTime: &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>endTime <span class="token operator">-</span> startTime<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">&quot; \u6BEB\u79D2&quot;</span><span class="token operator">+</span><span class="token string">&quot;\\t clickByLongAccumulator result: &quot;</span><span class="token operator">+</span>clickNumberNet<span class="token punctuation">.</span>longAccumulator<span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925210808233.png" alt="image-20210925210808233"></p><h4 id="_4\u3001\u6E90\u7801\u3001\u539F\u7406\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u6E90\u7801\u3001\u539F\u7406\u5206\u6790" aria-hidden="true">#</a> 4\u3001\u6E90\u7801\u3001\u539F\u7406\u5206\u6790</h4><h5 id="_1\u3001\u67B6\u6784" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u67B6\u6784" aria-hidden="true">#</a> 1\u3001\u67B6\u6784</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925211148889.png" alt="image-20210925211148889"></p><p>LongAdder\u662FStriped64\u7684\u5B50\u7C7B</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925211209788.png" alt="image-20210925211209788"></p><h5 id="_2\u3001\u5269\u4E0B\u4E24\u7F57\u6C49" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5269\u4E0B\u4E24\u7F57\u6C49" aria-hidden="true">#</a> 2\u3001\u5269\u4E0B\u4E24\u7F57\u6C49</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Striped64</span>
<span class="token class-name">Number</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3\u3001\u539F\u7406-longadder\u4E3A\u4EC0\u4E48\u8FD9\u4E48\u5FEB" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u539F\u7406-longadder\u4E3A\u4EC0\u4E48\u8FD9\u4E48\u5FEB" aria-hidden="true">#</a> 3\u3001\u539F\u7406(LongAdder\u4E3A\u4EC0\u4E48\u8FD9\u4E48\u5FEB)</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925211404913.png" alt="image-20210925211404913"></p><h6 id="_1\u3001striped64\u6709\u51E0\u4E2A\u6BD4\u8F83\u91CD\u8981\u7684\u6210\u5458\u51FD\u6570" tabindex="-1"><a class="header-anchor" href="#_1\u3001striped64\u6709\u51E0\u4E2A\u6BD4\u8F83\u91CD\u8981\u7684\u6210\u5458\u51FD\u6570" aria-hidden="true">#</a> 1\u3001Striped64\u6709\u51E0\u4E2A\u6BD4\u8F83\u91CD\u8981\u7684\u6210\u5458\u51FD\u6570</h6><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/** Number of CPUS, to place bound on table size        CPU\u6570\u91CF\uFF0C\u5373cells\u6570\u7EC4\u7684\u6700\u5927\u957F\u5EA6 */</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> NCPU <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">availableProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * Table of cells. When non-null, size is a power of 2.
cells\u6570\u7EC4\uFF0C\u4E3A2\u7684\u5E42\uFF0C2,4,8,16.....\uFF0C\u65B9\u4FBF\u4EE5\u540E\u4F4D\u8FD0\u7B97
 */</span>
<span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token class-name">Cell</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cells<span class="token punctuation">;</span>

<span class="token doc-comment comment">/**\u57FA\u7840value\u503C\uFF0C\u5F53\u5E76\u53D1\u8F83\u4F4E\u65F6\uFF0C\u53EA\u7D2F\u52A0\u8BE5\u503C\u4E3B\u8981\u7528\u4E8E\u6CA1\u6709\u7ADE\u4E89\u7684\u60C5\u51B5\uFF0C\u901A\u8FC7CAS\u66F4\u65B0\u3002
 * Base value, used mainly when there is no contention, but also as
 * a fallback during table initialization races. Updated via CAS.
 */</span>
<span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token keyword">long</span> base<span class="token punctuation">;</span>

<span class="token doc-comment comment">/**\u521B\u5EFA\u6216\u8005\u6269\u5BB9Cells\u6570\u7EC4\u65F6\u4F7F\u7528\u7684\u81EA\u65CB\u9501\u53D8\u91CF\u8C03\u6574\u5355\u5143\u683C\u5927\u5C0F\uFF08\u6269\u5BB9\uFF09\uFF0C\u521B\u5EFA\u5355\u5143\u683C\u65F6\u4F7F\u7528\u7684\u9501\u3002
 * Spinlock (locked via CAS) used when resizing and/or creating Cells. 
 */</span>
<span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> cellsBusy<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6700\u91CD\u8981\u76842\u4E2A</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925211458685.png" alt="image-20210925211458685"></p><h6 id="_2\u3001striped64\u4E2D\u4E00\u4E9B\u53D8\u91CF\u6216\u8005\u65B9\u6CD5\u7684\u5B9A\u4E49" tabindex="-1"><a class="header-anchor" href="#_2\u3001striped64\u4E2D\u4E00\u4E9B\u53D8\u91CF\u6216\u8005\u65B9\u6CD5\u7684\u5B9A\u4E49" aria-hidden="true">#</a> 2\u3001Striped64\u4E2D\u4E00\u4E9B\u53D8\u91CF\u6216\u8005\u65B9\u6CD5\u7684\u5B9A\u4E49</h6><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925211609167.png" alt="image-20210925211609167"></p><h6 id="_3\u3001cell" tabindex="-1"><a class="header-anchor" href="#_3\u3001cell" aria-hidden="true">#</a> 3\u3001Cell</h6><p>\u662F java.util.concurrent.atomic \u4E0B Striped64 \u7684\u4E00\u4E2A\u5185\u90E8\u7C7B</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925211634587.png" alt="image-20210925211634587"></p><h6 id="_4\u3001longadder\u4E3A\u4EC0\u4E48\u8FD9\u4E48\u5FEB" tabindex="-1"><a class="header-anchor" href="#_4\u3001longadder\u4E3A\u4EC0\u4E48\u8FD9\u4E48\u5FEB" aria-hidden="true">#</a> 4\u3001LongAdder\u4E3A\u4EC0\u4E48\u8FD9\u4E48\u5FEB</h6><p>\u200B LongAdder\u7684\u57FA\u672C\u601D\u8DEF\u5C31\u662F\u5206\u6563\u70ED\u70B9\uFF0C\u5C06value\u503C\u5206\u6563\u5230\u4E00\u4E2ACell\u6570\u7EC4\u4E2D\uFF0C\u4E0D\u540C\u7EBF\u7A0B\u4F1A\u547D\u4E2D\u5230\u6570\u7EC4\u7684\u4E0D\u540C\u69FD\u4E2D\uFF0C\u5404\u4E2A\u7EBF\u7A0B\u53EA\u5BF9\u81EA\u5DF1\u69FD\u4E2D\u7684\u90A3\u4E2A\u503C\u8FDB\u884CCAS\u64CD\u4F5C\uFF0C\u8FD9\u6837\u70ED\u70B9\u5C31\u88AB\u5206\u6563\u4E86\uFF0C\u51B2\u7A81\u7684\u6982\u7387\u5C31\u5C0F\u5F88\u591A\u3002\u5982\u679C\u8981\u83B7\u53D6\u771F\u6B63\u7684long\u503C\uFF0C\u53EA\u8981\u5C06\u5404\u4E2A\u69FD\u4E2D\u7684\u53D8\u91CF\u503C\u7D2F\u52A0\u8FD4\u56DE\u3002</p><p>\u200B sum()\u4F1A\u5C06\u6240\u6709Cell\u6570\u7EC4\u4E2D\u7684value\u548Cbase\u7D2F\u52A0\u4F5C\u4E3A\u8FD4\u56DE\u503C\uFF0C\u6838\u5FC3\u7684\u601D\u60F3\u5C31\u662F\u5C06\u4E4B\u524DAtomicLong\u4E00\u4E2Avalue\u7684\u66F4\u65B0\u538B\u529B\u5206\u6563\u5230\u591A\u4E2Avalue\u4E2D\u53BB\uFF0C \u4ECE\u800C\u964D\u7EA7\u66F4\u65B0\u70ED\u70B9\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925211716139.png" alt="image-20210925211716139"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925211738409.png" alt="image-20210925211738409"></p><p>\u5185\u90E8\u6709\u4E00\u4E2Abase\u53D8\u91CF\uFF0C\u4E00\u4E2ACell[]\u6570\u7EC4\u3002</p><p>base\u53D8\u91CF\uFF1A\u975E\u7ADE\u6001\u6761\u4EF6\u4E0B\uFF0C\u76F4\u63A5\u7D2F\u52A0\u5230\u8BE5\u53D8\u91CF\u4E0A</p><p>Cell[]\u6570\u7EC4\uFF1A\u7ADE\u6001\u6761\u4EF6\u4E0B\uFF0C\u7D2F\u52A0\u4E2A\u5404\u4E2A\u7EBF\u7A0B\u81EA\u5DF1\u7684\u69FDCell[i]\u4E2D</p><h5 id="_4\u3001\u6E90\u7801\u89E3\u8BFB\u6DF1\u5EA6\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u6E90\u7801\u89E3\u8BFB\u6DF1\u5EA6\u5206\u6790" aria-hidden="true">#</a> 4\u3001\u6E90\u7801\u89E3\u8BFB\u6DF1\u5EA6\u5206\u6790</h5><p>\u200B LongAdder\u5728\u65E0\u7ADE\u4E89\u7684\u60C5\u51B5\uFF0C\u8DDFAtomicLong\u4E00\u6837\uFF0C\u5BF9\u540C\u4E00\u4E2Abase\u8FDB\u884C\u64CD\u4F5C\uFF0C\u5F53\u51FA\u73B0\u7ADE\u4E89\u5173\u7CFB\u65F6\u5219\u662F\u91C7\u7528\u5316\u6574\u4E3A\u96F6\u7684\u505A\u6CD5\uFF0C\u4ECE\u7A7A\u95F4\u6362\u65F6\u95F4\uFF0C\u7528\u4E00\u4E2A\u6570\u7EC4cells\uFF0C\u5C06\u4E00\u4E2Avalue\u62C6\u5206\u8FDB\u8FD9\u4E2A\u6570\u7EC4cells\u3002\u591A\u4E2A\u7EBF\u7A0B\u9700\u8981\u540C\u65F6\u5BF9value\u8FDB\u884C\u64CD\u4F5C\u65F6\u5019\uFF0C\u53EF\u4EE5\u5BF9\u7EBF\u7A0Bid\u8FDB\u884Chash\u5F97\u5230hash\u503C\uFF0C\u518D\u6839\u636Ehash\u503C\u6620\u5C04\u5230\u8FD9\u4E2A\u6570\u7EC4cells\u7684\u67D0\u4E2A\u4E0B\u6807\uFF0C\u518D\u5BF9\u8BE5\u4E0B\u6807\u6240\u5BF9\u5E94\u7684\u503C\u8FDB\u884C\u81EA\u589E\u64CD\u4F5C\u3002\u5F53\u6240\u6709\u7EBF\u7A0B\u64CD\u4F5C\u5B8C\u6BD5\uFF0C\u5C06\u6570\u7EC4cells\u7684\u6240\u6709\u503C\u548C\u65E0\u7ADE\u4E89\u503Cbase\u90FD\u52A0\u8D77\u6765\u4F5C\u4E3A\u6700\u7EC8\u7ED3\u679C\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925211849436.png" alt="image-20210925211849436"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>longAdder<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h6 id="_1\u3001add-1l" tabindex="-1"><a class="header-anchor" href="#_1\u3001add-1l" aria-hidden="true">#</a> 1\u3001add(1L)</h6><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925211939336.png" alt="image-20210925211939336"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925211956219.png" alt="image-20210925211956219"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212001450.png" alt="image-20210925212001450"></p><ol><li>\u6700\u521D\u65E0\u7ADE\u4E89\u65F6\u53EA\u66F4\u65B0base\uFF1B</li><li>\u5982\u679C\u66F4\u65B0base\u5931\u8D25\u540E\uFF0C\u9996\u6B21\u65B0\u5EFA\u4E00\u4E2ACell[]\u6570\u7EC4</li><li>\u5F53\u591A\u4E2A\u7EBF\u7A0B\u7ADE\u4E89\u540C\u4E00\u4E2ACell\u6BD4\u8F83\u6FC0\u70C8\u65F6\uFF0C\u53EF\u80FD\u5C31\u8981\u5BF9Cell[]\u6269\u5BB9</li></ol><h6 id="_2\u3001longaccumulate" tabindex="-1"><a class="header-anchor" href="#_2\u3001longaccumulate" aria-hidden="true">#</a> 2\u3001longAccumulate</h6><p><strong>longAccumulate\u5165\u53C2\u8BF4\u660E</strong></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212131070.png" alt="image-20210925212131070"></p><p><strong>Striped64\u4E2D\u4E00\u4E9B\u53D8\u91CF\u6216\u8005\u65B9\u6CD5\u7684\u5B9A\u4E49</strong></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212144634.png" alt="image-20210925212144634"></p><p><strong>\u7EBF\u7A0Bhash\u503C\uFF1Aprobe</strong></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212206841.png" alt="image-20210925212206841"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212211672.png" alt="image-20210925212211672"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212214106.png" alt="image-20210925212214106"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212219015.png" alt="image-20210925212219015"></p><p><strong>\u603B\u7EB2</strong></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212236202.png" alt="image-20210925212236202"></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u4E0A\u8FF0\u4EE3\u7801\u9996\u5148\u7ED9\u5F53\u524D\u7EBF\u7A0B\u5206\u914D\u4E00\u4E2Ahash\u503C\uFF0C\u7136\u540E\u8FDB\u5165\u4E00\u4E2Afor(;;)\u81EA\u65CB\uFF0C\u8FD9\u4E2A\u81EA\u65CB\u5206\u4E3A\u4E09\u4E2A\u5206\u652F\uFF1A
CASE1\uFF1ACell[]\u6570\u7EC4\u5DF2\u7ECF\u521D\u59CB\u5316
CASE2\uFF1ACell[]\u6570\u7EC4\u672A\u521D\u59CB\u5316(\u9996\u6B21\u65B0\u5EFA)
CASE3\uFF1ACell[]\u6570\u7EC4\u6B63\u5728\u521D\u59CB\u5316\u4E2D
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u521A\u521A\u8981\u521D\u59CB\u5316Cell[]\u6570\u7EC4(\u9996\u6B21\u65B0\u5EFA)</p><p>\u672A\u521D\u59CB\u5316\u8FC7Cell[]\u6570\u7EC4\uFF0C\u5C1D\u8BD5\u5360\u6709\u9501\u5E76\u9996\u6B21\u521D\u59CB\u5316cells\u6570\u7EC4</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212315327.png" alt="image-20210925212315327"></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u5982\u679C\u4E0A\u9762\u6761\u4EF6\u90FD\u6267\u884C\u6210\u529F\u5C31\u4F1A\u6267\u884C\u6570\u7EC4\u7684\u521D\u59CB\u5316\u53CA\u8D4B\u503C\u64CD\u4F5C\uFF0C Cell[] rs = new Cell[2]\u8868\u793A\u6570\u7EC4\u7684\u957F\u5EA6\u4E3A2\uFF0C
rs[h &amp; 1] = new Cell(x) \u8868\u793A\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684Cell\u5143\u7D20\uFF0Cvalue\u662Fx\u503C\uFF0C\u9ED8\u8BA4\u4E3A1\u3002
h &amp; 1\u7C7B\u4F3C\u4E8E\u6211\u4EEC\u4E4B\u524DHashMap\u5E38\u7528\u5230\u7684\u8BA1\u7B97\u6563\u5217\u6876index\u7684\u7B97\u6CD5\uFF0C\u901A\u5E38\u90FD\u662Fhash &amp; (table.len - 1)\u3002\u540Chashmap\u4E00\u4E2A\u610F\u601D\u3002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u515C\u5E95</strong></p><p>\u591A\u4E2A\u7EBF\u7A0B\u5C1D\u8BD5CAS\u4FEE\u6539\u5931\u8D25\u7684\u7EBF\u7A0B\u4F1A\u8D70\u5230\u8FD9\u4E2A\u5206\u652F</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212343899.png" alt="image-20210925212343899"></p><p>\u8BE5\u5206\u652F\u5B9E\u73B0\u76F4\u63A5\u64CD\u4F5Cbase\u57FA\u6570\uFF0C\u5C06\u503C\u7D2F\u52A0\u5230base\u4E0A\uFF0C\u4E5F\u5373\u5176\u5B83\u7EBF\u7A0B\u6B63\u5728\u521D\u59CB\u5316\uFF0C\u591A\u4E2A\u7EBF\u7A0B\u6B63\u5728\u66F4\u65B0base\u7684\u503C\u3002</p><p><strong>Cell\u6570\u7EC4\u4E0D\u518D\u4E3A\u7A7A\u4E14\u53EF\u80FD\u5B58\u5728Cell\u6570\u7EC4\u6269\u5BB9</strong></p><p>\u591A\u4E2A\u7EBF\u7A0B\u540C\u65F6\u547D\u4E2D\u4E00\u4E2Acell\u7684\u7ADE\u4E89</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212437808.png" alt="image-20210925212437808"></p><ol><li></li></ol><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212506154.png" alt="image-20210925212506154"></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u4E0A\u9762\u4EE3\u7801\u5224\u65AD\u5F53\u524D\u7EBF\u7A0Bhash\u540E\u6307\u5411\u7684\u6570\u636E\u4F4D\u7F6E\u5143\u7D20\u662F\u5426\u4E3A\u7A7A\uFF0C
\u5982\u679C\u4E3A\u7A7A\u5219\u5C06Cell\u6570\u636E\u653E\u5165\u6570\u7EC4\u4E2D\uFF0C\u8DF3\u51FA\u5FAA\u73AF\u3002
\u5982\u679C\u4E0D\u7A7A\u5219\u7EE7\u7EED\u5FAA\u73AF\u3002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li></li></ol><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212521292.png" alt="image-20210925212521292"></p><ol start="3"><li><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212535517.png" alt="image-20210925212535517"></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u8BF4\u660E\u5F53\u524D\u7EBF\u7A0B\u5BF9\u5E94\u7684\u6570\u7EC4\u4E2D\u6709\u4E86\u6570\u636E\uFF0C\u4E5F\u91CD\u7F6E\u8FC7hash\u503C\uFF0C
\u8FD9\u65F6\u901A\u8FC7CAS\u64CD\u4F5C\u5C1D\u8BD5\u5BF9\u5F53\u524D\u6570\u4E2D\u7684value\u503C\u8FDB\u884C\u7D2F\u52A0x\u64CD\u4F5C\uFF0Cx\u9ED8\u8BA4\u4E3A1\uFF0C\u5982\u679CCAS\u6210\u529F\u5219\u76F4\u63A5\u8DF3\u51FA\u5FAA\u73AF\u3002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212601882.png" alt="image-20210925212601882"></p></li><li><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212607291.png" alt="image-20210925212607291"></p></li><li><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212613752.png" alt="image-20210925212613752"></p></li></ol><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212621738.png" alt="image-20210925212621738"></p><h6 id="_3\u3001sum" tabindex="-1"><a class="header-anchor" href="#_3\u3001sum" aria-hidden="true">#</a> 3\u3001sum</h6><p>sum()\u4F1A\u5C06\u6240\u6709Cell\u6570\u7EC4\u4E2D\u7684value\u548Cbase\u7D2F\u52A0\u4F5C\u4E3A\u8FD4\u56DE\u503C\u3002 \u6838\u5FC3\u7684\u601D\u60F3\u5C31\u662F\u5C06\u4E4B\u524DAtomicLong\u4E00\u4E2Avalue\u7684\u66F4\u65B0\u538B\u529B\u5206\u6563\u5230\u591A\u4E2Avalue\u4E2D\u53BB\uFF0C\u4ECE\u800C\u964D\u7EA7\u66F4\u65B0\u70ED\u70B9\u3002</p><p><strong>\u4E3A\u5565\u5728\u5E76\u53D1\u60C5\u51B5\u4E0Bsum\u7684\u503C\u4E0D\u7CBE\u786E</strong></p><p>sum\u6267\u884C\u65F6\uFF0C\u5E76\u6CA1\u6709\u9650\u5236\u5BF9base\u548Ccells\u7684\u66F4\u65B0(\u4E00\u53E5\u8981\u547D\u7684\u8BDD)\u3002\u6240\u4EE5LongAdder\u4E0D\u662F\u5F3A\u4E00\u81F4\u6027\u7684\uFF0C\u5B83\u662F\u6700\u7EC8\u4E00\u81F4\u6027\u7684\u3002</p><p>\u200B \u9996\u5148\uFF0C\u6700\u7EC8\u8FD4\u56DE\u7684sum\u5C40\u90E8\u53D8\u91CF\uFF0C\u521D\u59CB\u88AB\u590D\u5236\u4E3Abase\uFF0C\u800C\u6700\u7EC8\u8FD4\u56DE\u65F6\uFF0C\u5F88\u53EF\u80FDbase\u5DF2\u7ECF\u88AB\u66F4\u65B0\u4E86\uFF0C\u800C\u6B64\u65F6\u5C40\u90E8\u53D8\u91CFsum\u4E0D\u4F1A\u66F4\u65B0\uFF0C\u9020\u6210\u4E0D\u4E00\u81F4\u3002 \u5176\u6B21\uFF0C\u8FD9\u91CC\u5BF9cell\u7684\u8BFB\u53D6\u4E5F\u65E0\u6CD5\u4FDD\u8BC1\u662F\u6700\u540E\u4E00\u6B21\u5199\u5165\u7684\u503C\u3002\u6240\u4EE5\uFF0Csum\u65B9\u6CD5\u5728\u6CA1\u6709\u5E76\u53D1\u7684\u60C5\u51B5\u4E0B\uFF0C\u53EF\u4EE5\u83B7\u5F97\u6B63\u786E\u7684\u7ED3\u679C\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210925212713186.png" alt="image-20210925212713186"></p><h4 id="_5\u3001\u4F7F\u7528\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u4F7F\u7528\u603B\u7ED3" aria-hidden="true">#</a> 5\u3001\u4F7F\u7528\u603B\u7ED3</h4><ul><li>AtomicLong <ul><li>\u7EBF\u7A0B\u5B89\u5168\uFF0C\u53EF\u5141\u8BB8\u4E00\u4E9B\u6027\u80FD\u635F\u8017\uFF0C\u8981\u6C42\u9AD8\u7CBE\u5EA6\u65F6\u53EF\u4F7F\u7528</li><li>\u4FDD\u8BC1\u7CBE\u5EA6\uFF0C\u6027\u80FD\u4EE3\u4EF7</li><li>AtomicLong\u662F\u591A\u4E2A\u7EBF\u7A0B\u9488\u5BF9\u5355\u4E2A\u70ED\u70B9\u503Cvalue\u8FDB\u884C\u539F\u5B50\u64CD\u4F5C</li></ul></li><li>LongAdder <ul><li>\u5F53\u9700\u8981\u5728\u9AD8\u5E76\u53D1\u4E0B\u6709\u8F83\u597D\u7684\u6027\u80FD\u8868\u73B0\uFF0C\u4E14\u5BF9\u503C\u7684\u7CBE\u786E\u5EA6\u8981\u6C42\u4E0D\u9AD8\u65F6\uFF0C\u53EF\u4EE5\u4F7F\u7528</li><li>\u4FDD\u8BC1\u6027\u80FD\uFF0C\u7CBE\u5EA6\u4EE3\u4EF7</li><li>LongAdder\u662F\u6BCF\u4E2A\u7EBF\u7A0B\u62E5\u6709\u81EA\u5DF1\u7684\u69FD\uFF0C\u5404\u4E2A\u7EBF\u7A0B\u4E00\u822C\u53EA\u5BF9\u81EA\u5DF1\u69FD\u4E2D\u7684\u90A3\u4E2A\u503C\u8FDB\u884CCAS\u64CD\u4F5C</li></ul></li></ul><h3 id="_7\u3001\u603B\u7ED3-1" tabindex="-1"><a class="header-anchor" href="#_7\u3001\u603B\u7ED3-1" aria-hidden="true">#</a> 7\u3001\u603B\u7ED3</h3><h4 id="_1\u3001atomiclong" tabindex="-1"><a class="header-anchor" href="#_1\u3001atomiclong" aria-hidden="true">#</a> 1\u3001AtomicLong</h4><ul><li>\u539F\u7406 <ul><li>CAS+\u81EA\u65CB</li><li>incrementAndGet</li></ul></li><li>\u573A\u666F <ul><li>\u4F4E\u5E76\u53D1\u4E0B\u7684\u5168\u5C40\u8BA1\u7B97</li><li>AtomicLong\u80FD\u4FDD\u8BC1\u5E76\u53D1\u60C5\u51B5\u4E0B\u8BA1\u6570\u7684\u51C6\u786E\u6027\uFF0C\u5176\u5185\u90E8\u901A\u8FC7CAS\u6765\u89E3\u51B3\u5E76\u53D1\u5B89\u5168\u6027\u7684\u95EE\u9898\u3002</li></ul></li><li>\u7F3A\u9677 <ul><li>\u9AD8\u5E76\u53D1\u540E\u6027\u80FD\u6025\u5267\u4E0B\u964D</li><li>AtomicLong\u7684\u81EA\u65CB\u4F1A\u6210\u4E3A\u74F6\u9888</li><li>N\u4E2A\u7EBF\u7A0BCAS\u64CD\u4F5C\u4FEE\u6539\u7EBF\u7A0B\u7684\u503C\uFF0C\u6BCF\u6B21\u53EA\u6709\u4E00\u4E2A\u6210\u529F\u8FC7\uFF0C\u5176\u5B83N - 1\u5931\u8D25\uFF0C\u5931\u8D25\u7684\u4E0D\u505C\u7684\u81EA\u65CB\u76F4\u5230\u6210\u529F\uFF0C\u8FD9\u6837\u5927\u91CF\u5931\u8D25\u81EA\u65CB\u7684\u60C5\u51B5\uFF0C\u4E00\u4E0B\u5B50cpu\u5C31\u6253\u9AD8\u4E86\u3002</li></ul></li></ul><h4 id="_2\u3001longadder" tabindex="-1"><a class="header-anchor" href="#_2\u3001longadder" aria-hidden="true">#</a> 2\u3001LongAdder</h4><ul><li>\u539F\u7406 <ul><li>CAS+Base+Cell\u6570\u7EC4\u5206\u6563</li><li>\u7A7A\u95F4\u6362\u65F6\u95F4\u5E76\u5206\u6563\u4E86\u70ED\u70B9\u6570\u636E</li></ul></li><li>\u573A\u666F <ul><li>\u9AD8\u5E76\u53D1\u4E0B\u7684\u5168\u5C40\u8BA1\u7B97</li></ul></li><li>\u7F3A\u9677 <ul><li>sum\u6C42\u548C\u540E\u8FD8\u6709\u8BA1\u7B97\u7EBF\u7A0B\u4FEE\u6539\u7ED3\u679C\u7684\u8BDD\uFF0C\u6700\u540E\u7ED3\u679C\u4E0D\u591F\u51C6\u786E</li></ul></li></ul><h2 id="\u5341\u4E09\u3001threadlocal\u3001inheritablethreadlocal" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E09\u3001threadlocal\u3001inheritablethreadlocal" aria-hidden="true">#</a> \u5341\u4E09\u3001ThreadLocal\u3001InheritableThreadLocal</h2><h3 id="_1\u3001threadlocal\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#_1\u3001threadlocal\u7B80\u4ECB" aria-hidden="true">#</a> 1\u3001ThreadLocal\u7B80\u4ECB</h3><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927222129464.png" alt="image-20210927222129464"></p><p>\u200B \u7A0D\u5FAE\u7FFB\u8BD1\u4E00\u4E0B\uFF1A \u200B ThreadLocal\u63D0\u4F9B\u7EBF\u7A0B\u5C40\u90E8\u53D8\u91CF\u3002\u8FD9\u4E9B\u53D8\u91CF\u4E0E\u6B63\u5E38\u7684\u53D8\u91CF\u4E0D\u540C\uFF0C\u56E0\u4E3A\u6BCF\u4E00\u4E2A\u7EBF\u7A0B\u5728\u8BBF\u95EEThreadLocal\u5B9E\u4F8B\u7684\u65F6\u5019\uFF08\u901A\u8FC7\u5176get\u6216set\u65B9\u6CD5\uFF09\u90FD\u6709\u81EA\u5DF1\u7684\u3001\u72EC\u7ACB\u521D\u59CB\u5316\u7684\u53D8\u91CF\u526F\u672C\u3002ThreadLocal\u5B9E\u4F8B\u901A\u5E38\u662F\u7C7B\u4E2D\u7684\u79C1\u6709\u9759\u6001\u5B57\u6BB5\uFF0C\u4F7F\u7528\u5B83\u7684\u76EE\u7684\u662F\u5E0C\u671B\u5C06\u72B6\u6001\uFF08\u4F8B\u5982\uFF0C\u7528\u6237ID\u6216\u4E8B\u52A1ID\uFF09\u4E0E\u7EBF\u7A0B\u5173\u8054\u8D77\u6765\u3002</p><p>\u200B \u5B9E\u73B0\u6BCF\u4E00\u4E2A\u7EBF\u7A0B\u90FD\u6709\u81EA\u5DF1\u4E13\u5C5E\u7684\u672C\u5730\u53D8\u91CF\u526F\u672C(\u81EA\u5DF1\u7528\u81EA\u5DF1\u7684\u53D8\u91CF\u4E0D\u9EBB\u70E6\u522B\u4EBA\uFF0C\u4E0D\u548C\u5176\u4ED6\u4EBA\u5171\u4EAB\uFF0C\u4EBA\u4EBA\u6709\u4EFD\uFF0C\u4EBA\u5404\u4E00\u4EFD)\uFF0C\u4E3B\u8981\u89E3\u51B3\u4E86\u8BA9\u6BCF\u4E2A\u7EBF\u7A0B\u7ED1\u5B9A\u81EA\u5DF1\u7684\u503C\uFF0C\u901A\u8FC7\u4F7F\u7528get()\u548Cset()\u65B9\u6CD5\uFF0C\u83B7\u53D6\u9ED8\u8BA4\u503C\u6216\u5C06\u5176\u503C\u66F4\u6539\u4E3A\u5F53\u524D\u7EBF\u7A0B\u6240\u5B58\u7684\u526F\u672C\u7684\u503C\u4ECE\u800C\u907F\u514D\u4E86\u7EBF\u7A0B\u5B89\u5168\u95EE\u9898\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927222231797.png" alt=""></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927222241804.png" alt="image-20210927222241804"></p><h3 id="_2\u3001\u6C38\u8FDC\u7684helloworld" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u6C38\u8FDC\u7684helloworld" aria-hidden="true">#</a> 2\u3001\u6C38\u8FDC\u7684helloworld</h3><p>\u6309\u7167\u603B\u9500\u552E\u989D\u7EDF\u8BA1\uFF0C\u65B9\u4FBF\u96C6\u56E2\u516C\u53F8\u505A\u8BA1\u5212\u7EDF\u8BA1</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">MovieTicket</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">saleTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>number <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;\u53F7\u552E\u7968\u5458\u5356\u51FA\u7B2C\uFF1A &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>number<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;--------\u5356\u5B8C\u4E86&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * \u4E09\u4E2A\u552E\u7968\u5458\u5356\u5B8C50\u5F20\u7968\u52A1\uFF0C\u603B\u91CF\u5B8C\u6210\u5373\u53EF\uFF0C\u5403\u5927\u9505\u996D\uFF0C\u552E\u7968\u5458\u6BCF\u4E2A\u6708\u56FA\u5B9A\u6708\u85AA
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadLocalDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">MovieTicket</span> movieTicket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MovieTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    movieTicket<span class="token punctuation">.</span><span class="token function">saleTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0D\u53C2\u52A0\u603B\u548C\u8BA1\u7B97\uFF0C\u5E0C\u671B\u5404\u81EA\u5206\u7076\u5403\u996D\uFF0C\u5404\u51ED\u9500\u552E\u672C\u4E8B\u63D0\u6210\uFF0C\u6309\u7167\u51FA\u5355\u6570\u5404\u81EA\u7EDF\u8BA1</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">MovieTicket</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">saleTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>number <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;\u53F7\u552E\u7968\u5458\u5356\u51FA\u7B2C\uFF1A &quot;</span><span class="token operator">+</span><span class="token punctuation">(</span>number<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;--------\u5356\u5B8C\u4E86&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">House</span>
<span class="token punctuation">{</span>
    <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> threadLocal <span class="token operator">=</span> <span class="token class-name">ThreadLocal</span><span class="token punctuation">.</span><span class="token function">withInitial</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saleHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Integer</span> value <span class="token operator">=</span> threadLocal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        value<span class="token operator">++</span><span class="token punctuation">;</span>
        threadLocal<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * 1  \u4E09\u4E2A\u552E\u7968\u5458\u5356\u5B8C50\u5F20\u7968\u52A1\uFF0C\u603B\u91CF\u5B8C\u6210\u5373\u53EF\uFF0C\u5403\u5927\u9505\u996D\uFF0C\u552E\u7968\u5458\u6BCF\u4E2A\u6708\u56FA\u5B9A\u6708\u85AA
 *
 * 2  \u5206\u7076\u5403\u996D\uFF0C\u5404\u4E2A\u9500\u552E\u81EA\u5DF1\u52A8\u624B\uFF0C\u4E30\u8863\u8DB3\u98DF
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadLocalDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/*MovieTicket movieTicket = new MovieTicket();

        for (int i = 1; i &lt;=3; i++) {
            new Thread(() -&gt; {
                for (int j = 0; j &lt;20; j++) {
                    movieTicket.saleTicket();
                    try { TimeUnit.MILLISECONDS.sleep(10); } catch (InterruptedException e) { e.printStackTrace(); }
                }
            },String.valueOf(i)).start();
        }*/</span>

        <span class="token comment">//===========================================</span>
        <span class="token class-name">House</span> house <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">House</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    house<span class="token punctuation">.</span><span class="token function">saleHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;---&quot;</span><span class="token operator">+</span>house<span class="token punctuation">.</span>threadLocal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                house<span class="token punctuation">.</span>threadLocal<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u5982\u679C\u4E0D\u6E05\u7406\u81EA\u5B9A\u4E49\u7684 ThreadLocal \u53D8\u91CF\uFF0C\u53EF\u80FD\u4F1A\u5F71\u54CD\u540E\u7EED\u4E1A\u52A1\u903B\u8F91\u548C\u9020\u6210\u5185\u5B58\u6CC4\u9732\u7B49\u95EE\u9898</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    house<span class="token punctuation">.</span><span class="token function">saleHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;---&quot;</span><span class="token operator">+</span>house<span class="token punctuation">.</span>threadLocal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                house<span class="token punctuation">.</span>threadLocal<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    house<span class="token punctuation">.</span><span class="token function">saleHouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;---&quot;</span><span class="token operator">+</span>house<span class="token punctuation">.</span>threadLocal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                house<span class="token punctuation">.</span>threadLocal<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;---&quot;</span><span class="token operator">+</span>house<span class="token punctuation">.</span>threadLocal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1\u3001\u5C0F\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5C0F\u603B\u7ED3" aria-hidden="true">#</a> 1\u3001\u5C0F\u603B\u7ED3</h4><p>\u56E0\u4E3A\u6BCF\u4E2A Thread \u5185\u6709\u81EA\u5DF1\u7684\u5B9E\u4F8B\u526F\u672C\u4E14\u8BE5\u526F\u672C\u53EA\u7531\u5F53\u524D\u7EBF\u7A0B\u81EA\u5DF1\u4F7F\u7528</p><p>\u65E2\u7136\u5176\u5B83 Thread \u4E0D\u53EF\u8BBF\u95EE\uFF0C\u90A3\u5C31\u4E0D\u5B58\u5728\u591A\u7EBF\u7A0B\u95F4\u5171\u4EAB\u7684\u95EE\u9898\u3002</p><p>\u7EDF\u4E00\u8BBE\u7F6E\u521D\u59CB\u503C\uFF0C\u4F46\u662F\u6BCF\u4E2A\u7EBF\u7A0B\u5BF9\u8FD9\u4E2A\u503C\u7684\u4FEE\u6539\u90FD\u662F\u5404\u81EA\u7EBF\u7A0B\u4E92\u76F8\u72EC\u7ACB\u7684</p><ol><li><p>\u52A0\u5165synchronized\u6216\u8005Lock\u63A7\u5236\u8D44\u6E90\u7684\u8BBF\u95EE\u987A\u5E8F</p></li><li><p>\u4EBA\u624B\u4E00\u4EFD\uFF0C\u5927\u5BB6\u5404\u81EA\u5B89\u597D\uFF0C\u6CA1\u5FC5\u8981\u62A2\u593A</p></li></ol><h3 id="_3\u3001\u4ECE\u963F\u91CCthreadlocal\u89C4\u8303\u5F00\u59CB" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u4ECE\u963F\u91CCthreadlocal\u89C4\u8303\u5F00\u59CB" aria-hidden="true">#</a> 3\u3001\u4ECE\u963F\u91CCThreadLocal\u89C4\u8303\u5F00\u59CB</h3><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927222614201.png" alt="image-20210927222614201"></p><h4 id="_1\u3001\u975E\u7EBF\u7A0B\u5B89\u5168\u7684simpledateformat" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u975E\u7EBF\u7A0B\u5B89\u5168\u7684simpledateformat" aria-hidden="true">#</a> 1\u3001\u975E\u7EBF\u7A0B\u5B89\u5168\u7684SimpleDateFormat</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927222646376.png" alt="image-20210927222646376"></p><p>\u200B \u4E0A\u8FF0\u7FFB\u8BD1\uFF1ASimpleDateFormat\u4E2D\u7684\u65E5\u671F\u683C\u5F0F\u4E0D\u662F\u540C\u6B65\u7684\u3002\u63A8\u8350\uFF08\u5EFA\u8BAE\uFF09\u4E3A\u6BCF\u4E2A\u7EBF\u7A0B\u521B\u5EFA\u72EC\u7ACB\u7684\u683C\u5F0F\u5B9E\u4F8B\u3002\u5982\u679C\u591A\u4E2A\u7EBF\u7A0B\u540C\u65F6\u8BBF\u95EE\u4E00\u4E2A\u683C\u5F0F\uFF0C\u5219\u5B83\u5FC5\u987B\u4FDD\u6301\u5916\u90E8\u540C\u6B65\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DateUtils</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u6A21\u62DF\u5E76\u53D1\u73AF\u5883\u4E0B\u4F7F\u7528SimpleDateFormat\u7684parse\u65B9\u6CD5\u5C06\u5B57\u7B26\u4E32\u8F6C\u6362\u6210Date\u5BF9\u8C61
     * <span class="token keyword">@param</span> <span class="token parameter">stringDate</span>
     * <span class="token keyword">@return</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Date</span> <span class="token function">parseDate</span><span class="token punctuation">(</span><span class="token class-name">String</span> stringDate<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> sdf<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>stringDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">30</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">DateUtils</span><span class="token punctuation">.</span><span class="token function">parseDate</span><span class="token punctuation">(</span><span class="token string">&quot;2020-11-11 11:11:11&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NumberFormatException</span><span class="token operator">:</span> <span class="token class-name">For</span> input string<span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NumberFormatException</span><span class="token punctuation">.</span><span class="token function">forInputString</span><span class="token punctuation">(</span><span class="token class-name">NumberFormatException</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">65</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">601</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Long</span><span class="token punctuation">.</span><span class="token function">parseLong</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">631</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span>DigitList</span><span class="token punctuation">.</span><span class="token function">getLong</span><span class="token punctuation">(</span><span class="token class-name">DigitList</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">195</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span>DecimalFormat</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token class-name">DecimalFormat</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2082</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span>SimpleDateFormat</span><span class="token punctuation">.</span><span class="token function">subParse</span><span class="token punctuation">(</span><span class="token class-name">SimpleDateFormat</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1869</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span>SimpleDateFormat</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token class-name">SimpleDateFormat</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1514</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span>DateFormat</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token class-name">DateFormat</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">364</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>zdww<span class="token punctuation">.</span>tcm<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span>DateTimeUtil</span><span class="token punctuation">.</span><span class="token function">parseDate</span><span class="token punctuation">(</span><span class="token class-name">DateTimeUtil</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1129</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>zdww<span class="token punctuation">.</span>tcm<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span>DateTimeUtil</span><span class="token punctuation">.</span>lambda$main$<span class="token function">0</span><span class="token punctuation">(</span><span class="token class-name">DateTimeUtil</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1137</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Thread</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">748</span><span class="token punctuation">)</span>
<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NumberFormatException</span><span class="token operator">:</span> <span class="token class-name">For</span> input string<span class="token operator">:</span> <span class="token string">&quot;.20202E.20202E44&quot;</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>FloatingDecimal</span><span class="token punctuation">.</span><span class="token function">readJavaFormatString</span><span class="token punctuation">(</span><span class="token class-name">FloatingDecimal</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2043</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>FloatingDecimal</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span><span class="token class-name">FloatingDecimal</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">110</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Double</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span><span class="token class-name">Double</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">538</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span>DigitList</span><span class="token punctuation">.</span><span class="token function">getDouble</span><span class="token punctuation">(</span><span class="token class-name">DigitList</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">169</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span>DecimalFormat</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token class-name">DecimalFormat</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">2087</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span>SimpleDateFormat</span><span class="token punctuation">.</span><span class="token function">subParse</span><span class="token punctuation">(</span><span class="token class-name">SimpleDateFormat</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1869</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span>SimpleDateFormat</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token class-name">SimpleDateFormat</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1514</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span>DateFormat</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token class-name">DateFormat</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">364</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>zdww<span class="token punctuation">.</span>tcm<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span>DateTimeUtil</span><span class="token punctuation">.</span><span class="token function">parseDate</span><span class="token punctuation">(</span><span class="token class-name">DateTimeUtil</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1129</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>zdww<span class="token punctuation">.</span>tcm<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span>DateTimeUtil</span><span class="token punctuation">.</span>lambda$main$<span class="token function">0</span><span class="token punctuation">(</span><span class="token class-name">DateTimeUtil</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">1137</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u200B SimpleDateFormat\u7C7B\u5185\u90E8\u6709\u4E00\u4E2ACalendar\u5BF9\u8C61\u5F15\u7528,\u5B83\u7528\u6765\u50A8\u5B58\u548C\u8FD9\u4E2ASimpleDateFormat\u76F8\u5173\u7684\u65E5\u671F\u4FE1\u606F,\u4F8B\u5982sdf.parse(dateStr),sdf.format(date) \u8BF8\u5982\u6B64\u7C7B\u7684\u65B9\u6CD5\u53C2\u6570\u4F20\u5165\u7684\u65E5\u671F\u76F8\u5173String,Date\u7B49\u7B49, \u90FD\u662F\u4EA4\u7531Calendar\u5F15\u7528\u6765\u50A8\u5B58\u7684.\u8FD9\u6837\u5C31\u4F1A\u5BFC\u81F4\u4E00\u4E2A\u95EE\u9898\u5982\u679C\u4F60\u7684SimpleDateFormat\u662F\u4E2Astatic\u7684, \u90A3\u4E48\u591A\u4E2Athread \u4E4B\u95F4\u5C31\u4F1A\u5171\u4EAB\u8FD9\u4E2ASimpleDateFormat, \u540C\u65F6\u4E5F\u662F\u5171\u4EAB\u8FD9\u4E2ACalendar\u5F15\u7528\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927222827543.png" alt="image-20210927222827543"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927222831591.png" alt="image-20210927222831591"></p><h4 id="_2\u3001\u89E3\u51B31" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u89E3\u51B31" aria-hidden="true">#</a> 2\u3001\u89E3\u51B31</h4><p>\u5C06SimpleDateFormat\u5B9A\u4E49\u6210\u5C40\u90E8\u53D8\u91CF\u3002</p><p>\u7F3A\u70B9\uFF1A\u6BCF\u8C03\u7528\u4E00\u6B21\u65B9\u6CD5\u5C31\u4F1A\u521B\u5EFA\u4E00\u4E2ASimpleDateFormat\u5BF9\u8C61\uFF0C\u65B9\u6CD5\u7ED3\u675F\u53C8\u8981\u4F5C\u4E3A\u5783\u573E\u56DE\u6536\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DateUtils</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * \u6A21\u62DF\u5E76\u53D1\u73AF\u5883\u4E0B\u4F7F\u7528SimpleDateFormat\u7684parse\u65B9\u6CD5\u5C06\u5B57\u7B26\u4E32\u8F6C\u6362\u6210Date\u5BF9\u8C61
     * <span class="token keyword">@param</span> <span class="token parameter">stringDate</span>
     * <span class="token keyword">@return</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Date</span> <span class="token function">parseDate</span><span class="token punctuation">(</span><span class="token class-name">String</span> stringDate<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> sdf<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>stringDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">30</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sdf<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&quot;2020-11-11 11:11:11&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    sdf <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3\u3001\u89E3\u51B32" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u89E3\u51B32" aria-hidden="true">#</a> 3\u3001\u89E3\u51B32</h4><p>ThreadLocal\uFF0C\u4E5F\u53EB\u505A\u7EBF\u7A0B\u672C\u5730\u53D8\u91CF\u6216\u8005\u7EBF\u7A0B\u672C\u5730\u5B58\u50A8</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DateUtils</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SimpleDateFormat</span><span class="token punctuation">&gt;</span></span>  sdf_threadLocal <span class="token operator">=</span>
            <span class="token class-name">ThreadLocal</span><span class="token punctuation">.</span><span class="token function">withInitial</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * ThreadLocal\u53EF\u4EE5\u786E\u4FDD\u6BCF\u4E2A\u7EBF\u7A0B\u90FD\u53EF\u4EE5\u5F97\u5230\u5404\u81EA\u5355\u72EC\u7684\u4E00\u4E2ASimpleDateFormat\u7684\u5BF9\u8C61\uFF0C\u90A3\u4E48\u81EA\u7136\u4E5F\u5C31\u4E0D\u5B58\u5728\u7ADE\u4E89\u95EE\u9898\u4E86\u3002
     * <span class="token keyword">@param</span> <span class="token parameter">stringDate</span>
     * <span class="token keyword">@return</span>
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">Exception</span></span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Date</span> <span class="token function">parseDateTL</span><span class="token punctuation">(</span><span class="token class-name">String</span> stringDate<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> sdf_threadLocal<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>stringDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">30</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">DateUtils</span><span class="token punctuation">.</span><span class="token function">parseDateTL</span><span class="token punctuation">(</span><span class="token string">&quot;2020-11-11 11:11:11&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DateUtils</span><span class="token punctuation">{</span>
    <span class="token comment">/*
    1   SimpleDateFormat\u5982\u679C\u591A\u7EBF\u7A0B\u5171\u7528\u662F\u7EBF\u7A0B\u4E0D\u5B89\u5168\u7684\u7C7B
    public static final SimpleDateFormat SIMPLE_DATE_FORMAT = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);

    public static String format(Date date)
    {
        return SIMPLE_DATE_FORMAT.format(date);
    }

    public static Date parse(String datetime) throws ParseException
    {
        return SIMPLE_DATE_FORMAT.parse(datetime);
    }*/</span>

    <span class="token comment">//2   ThreadLocal\u53EF\u4EE5\u786E\u4FDD\u6BCF\u4E2A\u7EBF\u7A0B\u90FD\u53EF\u4EE5\u5F97\u5230\u5404\u81EA\u5355\u72EC\u7684\u4E00\u4E2ASimpleDateFormat\u7684\u5BF9\u8C61\uFF0C\u90A3\u4E48\u81EA\u7136\u4E5F\u5C31\u4E0D\u5B58\u5728\u7ADE\u4E89\u95EE\u9898\u4E86\u3002</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SimpleDateFormat</span><span class="token punctuation">&gt;</span></span> SIMPLE_DATE_FORMAT_THREAD_LOCAL <span class="token operator">=</span> <span class="token class-name">ThreadLocal</span><span class="token punctuation">.</span><span class="token function">withInitial</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">Date</span> date<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> SIMPLE_DATE_FORMAT_THREAD_LOCAL<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Date</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token class-name">String</span> datetime<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ParseException</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> SIMPLE_DATE_FORMAT_THREAD_LOCAL<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>datetime<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//3 DateTimeFormatter \u4EE3\u66FF SimpleDateFormat</span>
    <span class="token comment">/*public static final DateTimeFormatter DATE_TIME_FORMAT = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;);

    public static String format(LocalDateTime localDateTime)
    {
        return DATE_TIME_FORMAT.format(localDateTime);
    }

    public static LocalDateTime parse(String dateString)
    {

        return LocalDateTime.parse(dateString,DATE_TIME_FORMAT);
    }*/</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4\u3001threadlocal\u6E90\u7801\u5206\u6790" tabindex="-1"><a class="header-anchor" href="#_4\u3001threadlocal\u6E90\u7801\u5206\u6790" aria-hidden="true">#</a> 4\u3001ThreadLocal\u6E90\u7801\u5206\u6790</h3><h4 id="_1\u3001thread-threadlocal-threadlocalmap-\u5173\u7CFB" tabindex="-1"><a class="header-anchor" href="#_1\u3001thread-threadlocal-threadlocalmap-\u5173\u7CFB" aria-hidden="true">#</a> 1\u3001Thread\uFF0CThreadLocal\uFF0CThreadLocalMap \u5173\u7CFB</h4><p>Thread\u548CThreadLocal</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927223107547.png" alt="image-20210927223107547"></p><p>\u518D\u6B21\u4F53\u4F1A\uFF0C\u5404\u81EA\u7EBF\u7A0B\uFF0C\u4EBA\u624B\u4E00\u4EFD</p><p>ThreadLocal\u548CThreadLocalMap</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927223131768.png" alt="image-20210927223131768"></p><p>All\u4E09\u8005\u603B\u6982\u62EC</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927223141071.png" alt="image-20210927223141071"></p><p>\u200B threadLocalMap\u5B9E\u9645\u4E0A\u5C31\u662F\u4E00\u4E2A\u4EE5threadLocal\u5B9E\u4F8B\u4E3Akey\uFF0C\u4EFB\u610F\u5BF9\u8C61\u4E3Avalue\u7684Entry\u5BF9\u8C61\u3002 \u5F53\u6211\u4EEC\u4E3AthreadLocal\u53D8\u91CF\u8D4B\u503C\uFF0C\u5B9E\u9645\u4E0A\u5C31\u662F\u4EE5\u5F53\u524DthreadLocal\u5B9E\u4F8B\u4E3Akey\uFF0C\u503C\u4E3Avalue\u7684Entry\u5F80\u8FD9\u4E2AthreadLocalMap\u4E2D\u5B58\u653E</p><p>\u8FD1\u4F3C\u7684\u53EF\u4EE5\u7406\u89E3\u4E3A: ThreadLocalMap\u4ECE\u5B57\u9762\u4E0A\u5C31\u53EF\u4EE5\u770B\u51FA\u8FD9\u662F\u4E00\u4E2A\u4FDD\u5B58ThreadLocal\u5BF9\u8C61\u7684map(\u5176\u5B9E\u662F\u4EE5ThreadLocal\u4E3AKey)\uFF0C\u4E0D\u8FC7\u662F\u7ECF\u8FC7\u4E86\u4E24\u5C42\u5305\u88C5\u7684ThreadLocal\u5BF9\u8C61\uFF1A</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927223215319.png" alt="image-20210927223215319"></p><p>\u200B JVM\u5185\u90E8\u7EF4\u62A4\u4E86\u4E00\u4E2A\u7EBF\u7A0B\u7248\u7684Map&lt;Thread,T&gt;(\u901A\u8FC7ThreadLocal\u5BF9\u8C61\u7684set\u65B9\u6CD5\uFF0C\u7ED3\u679C\u628AThreadLocal\u5BF9\u8C61\u81EA\u5DF1\u5F53\u505Akey\uFF0C\u653E\u8FDB\u4E86ThreadLoalMap\u4E2D),\u6BCF\u4E2A\u7EBF\u7A0B\u8981\u7528\u5230\u8FD9\u4E2AT\u7684\u65F6\u5019\uFF0C\u7528\u5F53\u524D\u7684\u7EBF\u7A0B\u53BBMap\u91CC\u9762\u83B7\u53D6\uFF0C\u901A\u8FC7\u8FD9\u6837\u8BA9\u6BCF\u4E2A\u7EBF\u7A0B\u90FD\u62E5\u6709\u4E86\u81EA\u5DF1\u72EC\u7ACB\u7684\u53D8\u91CF\uFF0C\u4EBA\u624B\u4E00\u4EFD\uFF0C\u7ADE\u4E89\u6761\u4EF6\u88AB\u5F7B\u5E95\u6D88\u9664\uFF0C\u5728\u5E76\u53D1\u6A21\u5F0F\u4E0B\u662F\u7EDD\u5BF9\u5B89\u5168\u7684\u53D8\u91CF\u3002</p><h3 id="_5\u3001threadlocal\u5185\u5B58\u6CC4\u9732\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_5\u3001threadlocal\u5185\u5B58\u6CC4\u9732\u95EE\u9898" aria-hidden="true">#</a> 5\u3001ThreadLocal\u5185\u5B58\u6CC4\u9732\u95EE\u9898</h3><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927223726167.png" alt="image-20210927223726167"></p><h4 id="_1\u3001\u4EC0\u4E48\u662F\u5185\u5B58\u6CC4\u6F0F" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u4EC0\u4E48\u662F\u5185\u5B58\u6CC4\u6F0F" aria-hidden="true">#</a> 1\u3001\u4EC0\u4E48\u662F\u5185\u5B58\u6CC4\u6F0F</h4><p>\u4E0D\u518D\u4F1A\u88AB\u4F7F\u7528\u7684\u5BF9\u8C61\u6216\u8005\u53D8\u91CF\u5360\u7528\u7684\u5185\u5B58\u4E0D\u80FD\u88AB\u56DE\u6536\uFF0C\u5C31\u662F\u5185\u5B58\u6CC4\u9732\u3002</p><h4 id="_2\u3001\u8C01\u60F9\u7684\u7978" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u8C01\u60F9\u7684\u7978" aria-hidden="true">#</a> 2\u3001\u8C01\u60F9\u7684\u7978\uFF1F</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927223802332.png" alt="image-20210927223802332"></p><h4 id="_3\u3001\u5F3A\u5F15\u7528\u3001\u8F6F\u5F15\u7528\u3001\u5F31\u5F15\u7528\u3001\u865A\u5F15\u7528\u5206\u522B\u662F\u4EC0\u4E48" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5F3A\u5F15\u7528\u3001\u8F6F\u5F15\u7528\u3001\u5F31\u5F15\u7528\u3001\u865A\u5F15\u7528\u5206\u522B\u662F\u4EC0\u4E48" aria-hidden="true">#</a> 3\u3001\u5F3A\u5F15\u7528\u3001\u8F6F\u5F15\u7528\u3001\u5F31\u5F15\u7528\u3001\u865A\u5F15\u7528\u5206\u522B\u662F\u4EC0\u4E48\uFF1F</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927223927641.png" alt="image-20210927223927641"></p><p>ThreadLocalMap\u4ECE\u5B57\u9762\u4E0A\u5C31\u53EF\u4EE5\u770B\u51FA\u8FD9\u662F\u4E00\u4E2A\u4FDD\u5B58ThreadLocal\u5BF9\u8C61\u7684map(\u5176\u5B9E\u662F\u4EE5\u5B83\u4E3AKey)\uFF0C\u4E0D\u8FC7\u662F\u7ECF\u8FC7\u4E86\u4E24\u5C42\u5305\u88C5\u7684ThreadLocal\u5BF9\u8C61\uFF1A \uFF081\uFF09\u7B2C\u4E00\u5C42\u5305\u88C5\u662F\u4F7F\u7528 <code>WeakReference&lt;ThreadLocal&lt;?&gt;&gt;</code> \u5C06ThreadLocal\u5BF9\u8C61\u53D8\u6210\u4E00\u4E2A\u5F31\u5F15\u7528\u7684\u5BF9\u8C61\uFF1B \uFF082\uFF09\u7B2C\u4E8C\u5C42\u5305\u88C5\u662F\u5B9A\u4E49\u4E86\u4E00\u4E2A\u4E13\u95E8\u7684\u7C7B Entry \u6765\u6269\u5C55 <code>WeakReference&lt;ThreadLocal&lt;?&gt;&gt;</code></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927223943383.png" alt="image-20210927223943383"></p><p>java \u6280\u672F\u5141\u8BB8\u4F7F\u7528 finalize() \u65B9\u6CD5\u5728\u5783\u573E\u6536\u96C6\u5668\u5C06\u5BF9\u8C61\u4ECE\u5185\u5B58\u4E2D\u6E05\u9664\u51FA\u53BB\u4E4B\u524D\u505A\u5FC5\u8981\u7684\u6E05\u7406\u5DE5\u4F5C\u3002</p><h5 id="_1\u3001\u5F3A\u5F15\u7528-\u9ED8\u8BA4\u652F\u6301\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5F3A\u5F15\u7528-\u9ED8\u8BA4\u652F\u6301\u6A21\u5F0F" aria-hidden="true">#</a> 1\u3001\u5F3A\u5F15\u7528(\u9ED8\u8BA4\u652F\u6301\u6A21\u5F0F)</h5><p>\u5F53\u5185\u5B58\u4E0D\u8DB3\uFF0CJVM\u5F00\u59CB\u5783\u573E\u56DE\u6536\uFF0C\u5BF9\u4E8E\u5F3A\u5F15\u7528\u7684\u5BF9\u8C61\uFF0C\u5C31\u7B97\u662F\u51FA\u73B0\u4E86OOM\u4E5F\u4E0D\u4F1A\u5BF9\u8BE5\u5BF9\u8C61\u8FDB\u884C\u56DE\u6536\uFF0C\u6B7B\u90FD\u4E0D\u6536\u3002</p><p>\u200B \u5F3A\u5F15\u7528\u662F\u6211\u4EEC\u6700\u5E38\u89C1\u7684\u666E\u901A\u5BF9\u8C61\u5F15\u7528\uFF0C\u53EA\u8981\u8FD8\u6709\u5F3A\u5F15\u7528\u6307\u5411\u4E00\u4E2A\u5BF9\u8C61\uFF0C\u5C31\u80FD\u8868\u660E\u5BF9\u8C61\u8FD8\u201C\u6D3B\u7740\u201D\uFF0C\u5783\u573E\u6536\u96C6\u5668\u4E0D\u4F1A\u78B0\u8FD9\u79CD\u5BF9\u8C61\u3002\u5728 Java \u4E2D\u6700\u5E38\u89C1\u7684\u5C31\u662F\u5F3A\u5F15\u7528\uFF0C\u628A\u4E00\u4E2A\u5BF9\u8C61\u8D4B\u7ED9\u4E00\u4E2A\u5F15\u7528\u53D8\u91CF\uFF0C\u8FD9\u4E2A\u5F15\u7528\u53D8\u91CF\u5C31\u662F\u4E00\u4E2A\u5F3A\u5F15\u7528\u3002\u5F53\u4E00\u4E2A\u5BF9\u8C61\u88AB\u5F3A\u5F15\u7528\u53D8\u91CF\u5F15\u7528\u65F6\uFF0C\u5B83\u5904\u4E8E\u53EF\u8FBE\u72B6\u6001\uFF0C\u5B83\u662F\u4E0D\u53EF\u80FD\u88AB\u5783\u573E\u56DE\u6536\u673A\u5236\u56DE\u6536\u7684\uFF0C\u5373\u4F7F\u8BE5\u5BF9\u8C61\u4EE5\u540E\u6C38\u8FDC\u90FD\u4E0D\u4F1A\u88AB\u7528\u5230JVM\u4E5F\u4E0D\u4F1A\u56DE\u6536\u3002\u56E0\u6B64\u5F3A\u5F15\u7528\u662F\u9020\u6210Java\u5185\u5B58\u6CC4\u6F0F\u7684\u4E3B\u8981\u539F\u56E0\u4E4B\u4E00\u3002</p><p>\u200B \u5BF9\u4E8E\u4E00\u4E2A\u666E\u901A\u7684\u5BF9\u8C61\uFF0C\u5982\u679C\u6CA1\u6709\u5176\u4ED6\u7684\u5F15\u7528\u5173\u7CFB\uFF0C\u53EA\u8981\u8D85\u8FC7\u4E86\u5F15\u7528\u7684\u4F5C\u7528\u57DF\u6216\u8005\u663E\u5F0F\u5730\u5C06\u76F8\u5E94\uFF08\u5F3A\uFF09\u5F15\u7528\u8D4B\u503C\u4E3A null\uFF0C\u4E00\u822C\u8BA4\u4E3A\u5C31\u662F\u53EF\u4EE5\u88AB\u5783\u573E\u6536\u96C6\u7684\u4E86(\u5F53\u7136\u5177\u4F53\u56DE\u6536\u65F6\u673A\u8FD8\u662F\u8981\u770B\u5783\u573E\u6536\u96C6\u7B56\u7565)\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">strongReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">MyObject</span> myObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----gc before: &quot;</span><span class="token operator">+</span>myObject<span class="token punctuation">)</span><span class="token punctuation">;</span>

    myObject <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----gc after: &quot;</span><span class="token operator">+</span>myObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2\u3001\u8F6F\u5F15\u7528" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u8F6F\u5F15\u7528" aria-hidden="true">#</a> 2\u3001\u8F6F\u5F15\u7528</h5><p>\u8F6F\u5F15\u7528\u662F\u4E00\u79CD\u76F8\u5BF9\u5F3A\u5F15\u7528\u5F31\u5316\u4E86\u4E00\u4E9B\u7684\u5F15\u7528\uFF0C\u9700\u8981\u7528java.lang.ref.SoftReference\u7C7B\u6765\u5B9E\u73B0\uFF0C\u53EF\u4EE5\u8BA9\u5BF9\u8C61\u8C41\u514D\u4E00\u4E9B\u5783\u573E\u6536\u96C6\u3002</p><p>\u5BF9\u4E8E\u53EA\u6709\u8F6F\u5F15\u7528\u7684\u5BF9\u8C61\u6765\u8BF4\uFF0C</p><p>\u5F53\u7CFB\u7EDF\u5185\u5B58\u5145\u8DB3\u65F6\u5B83 \u4E0D\u4F1A \u88AB\u56DE\u6536\uFF0C</p><p>\u5F53\u7CFB\u7EDF\u5185\u5B58\u4E0D\u8DB3\u65F6\u5B83 \u4F1A \u88AB\u56DE\u6536\u3002</p><p>\u8F6F\u5F15\u7528\u901A\u5E38\u7528\u5728\u5BF9\u5185\u5B58\u654F\u611F\u7684\u7A0B\u5E8F\u4E2D\uFF0C\u6BD4\u5982\u9AD8\u901F\u7F13\u5B58\u5C31\u6709\u7528\u5230\u8F6F\u5F15\u7528\uFF0C\u5185\u5B58\u591F\u7528\u7684\u65F6\u5019\u5C31\u4FDD\u7559\uFF0C\u4E0D\u591F\u7528\u5C31\u56DE\u6536\uFF01</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">MyObject</span>
<span class="token punctuation">{</span>
    <span class="token comment">//\u4E00\u822C\u5F00\u53D1\u4E2D\u4E0D\u7528\u8C03\u7528\u8FD9\u4E2A\u65B9\u6CD5\uFF0C\u672C\u6B21\u53EA\u662F\u4E3A\u4E86\u6F14\u793A</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;---finalize method invoked....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReferenceDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//\u5F53\u6211\u4EEC\u5185\u5B58\u4E0D\u591F\u7528\u7684\u65F6\u5019\uFF0Csoft\u4F1A\u88AB\u56DE\u6536\u7684\u60C5\u51B5\uFF0C\u8BBE\u7F6E\u6211\u4EEC\u7684\u5185\u5B58\u5927\u5C0F\uFF1A-Xms10m -Xmx10m</span>
        <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyObject</span><span class="token punctuation">&gt;</span></span> softReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----gc after\u5185\u5B58\u591F\u7528: &quot;</span><span class="token operator">+</span>softReference<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">9</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----gc after\u5185\u5B58\u4E0D\u591F: &quot;</span><span class="token operator">+</span>softReference<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">strongReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">MyObject</span> myObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----gc before: &quot;</span><span class="token operator">+</span>myObject<span class="token punctuation">)</span><span class="token punctuation">;</span>

        myObject <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----gc after: &quot;</span><span class="token operator">+</span>myObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3\u3001\u5F31\u5F15\u7528" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5F31\u5F15\u7528" aria-hidden="true">#</a> 3\u3001\u5F31\u5F15\u7528</h5><p>\u200B \u5F31\u5F15\u7528\u9700\u8981\u7528java.lang.ref.WeakReference\u7C7B\u6765\u5B9E\u73B0\uFF0C\u5B83\u6BD4\u8F6F\u5F15\u7528\u7684\u751F\u5B58\u671F\u66F4\u77ED\uFF0C\u5BF9\u4E8E\u53EA\u6709\u5F31\u5F15\u7528\u7684\u5BF9\u8C61\u6765\u8BF4\uFF0C\u53EA\u8981\u5783\u573E\u56DE\u6536\u673A\u5236\u4E00\u8FD0\u884C\uFF0C\u4E0D\u7BA1JVM\u7684\u5185\u5B58\u7A7A\u95F4\u662F\u5426\u8DB3\u591F\uFF0C\u90FD\u4F1A\u56DE\u6536\u8BE5\u5BF9\u8C61\u5360\u7528\u7684\u5185\u5B58\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">MyObject</span>
<span class="token punctuation">{</span>
    <span class="token comment">//\u4E00\u822C\u5F00\u53D1\u4E2D\u4E0D\u7528\u8C03\u7528\u8FD9\u4E2A\u65B9\u6CD5\uFF0C\u672C\u6B21\u53EA\u662F\u4E3A\u4E86\u6F14\u793A</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;---finalize method invoked....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReferenceDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyObject</span><span class="token punctuation">&gt;</span></span> weakReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----gc before\u5185\u5B58\u591F\u7528: &quot;</span><span class="token operator">+</span>weakReference<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----gc after\u5185\u5B58\u591F\u7528: &quot;</span><span class="token operator">+</span>weakReference<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">softReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//\u5F53\u6211\u4EEC\u5185\u5B58\u4E0D\u591F\u7528\u7684\u65F6\u5019\uFF0Csoft\u4F1A\u88AB\u56DE\u6536\u7684\u60C5\u51B5\uFF0C\u8BBE\u7F6E\u6211\u4EEC\u7684\u5185\u5B58\u5927\u5C0F\uFF1A-Xms10m -Xmx10m</span>
        <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyObject</span><span class="token punctuation">&gt;</span></span> softReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----gc after\u5185\u5B58\u591F\u7528: &quot;</span><span class="token operator">+</span>softReference<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">9</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----gc after\u5185\u5B58\u4E0D\u591F: &quot;</span><span class="token operator">+</span>softReference<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">strongReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">MyObject</span> myObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----gc before: &quot;</span><span class="token operator">+</span>myObject<span class="token punctuation">)</span><span class="token punctuation">;</span>

        myObject <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----gc after: &quot;</span><span class="token operator">+</span>myObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u8F6F\u5F15\u7528\u548C\u5F31\u5F15\u7528\u7684\u9002\u7528\u573A\u666F</strong></p><p>\u5047\u5982\u6709\u4E00\u4E2A\u5E94\u7528\u9700\u8981\u8BFB\u53D6\u5927\u91CF\u7684\u672C\u5730\u56FE\u7247:</p><p>\u5982\u679C\u6BCF\u6B21\u8BFB\u53D6\u56FE\u7247\u90FD\u4ECE\u786C\u76D8\u8BFB\u53D6\u5219\u4F1A\u4E25\u91CD\u5F71\u54CD\u6027\u80FD,</p><p>\u5982\u679C\u4E00\u6B21\u6027\u5168\u90E8\u52A0\u8F7D\u5230\u5185\u5B58\u4E2D\u53C8\u53EF\u80FD\u9020\u6210\u5185\u5B58\u6EA2\u51FA\u3002</p><p>\u6B64\u65F6\u4F7F\u7528\u8F6F\u5F15\u7528\u53EF\u4EE5\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\u3002</p><p>\u8BBE\u8BA1\u601D\u8DEF\u662F\uFF1A\u7528\u4E00\u4E2AHashMap\u6765\u4FDD\u5B58\u56FE\u7247\u7684\u8DEF\u5F84\u548C\u76F8\u5E94\u56FE\u7247\u5BF9\u8C61\u5173\u8054\u7684\u8F6F\u5F15\u7528\u4E4B\u95F4\u7684\u6620\u5C04\u5173\u7CFB\uFF0C\u5728\u5185\u5B58\u4E0D\u8DB3\u65F6\uFF0CJVM\u4F1A\u81EA\u52A8\u56DE\u6536\u8FD9\u4E9B\u7F13\u5B58\u56FE\u7247\u5BF9\u8C61\u6240\u5360\u7528\u7684\u7A7A\u95F4\uFF0C\u4ECE\u800C\u6709\u6548\u5730\u907F\u514D\u4E86OOM\u7684\u95EE\u9898\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">SoftReference</span><span class="token punctuation">&lt;</span><span class="token class-name">Bitmap</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> imageCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">SoftReference</span><span class="token punctuation">&lt;</span><span class="token class-name">Bitmap</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="_4\u3001\u865A\u5F15\u7528" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u865A\u5F15\u7528" aria-hidden="true">#</a> 4\u3001\u865A\u5F15\u7528</h5><p>\u865A\u5F15\u7528\u9700\u8981<code>java.lang.ref.PhantomReference</code>\u7C7B\u6765\u5B9E\u73B0\u3002</p><p>\u200B \u987E\u540D\u601D\u4E49\uFF0C\u5C31\u662F\u5F62\u540C\u865A\u8BBE\uFF0C\u4E0E\u5176\u4ED6\u51E0\u79CD\u5F15\u7528\u90FD\u4E0D\u540C\uFF0C\u865A\u5F15\u7528\u5E76\u4E0D\u4F1A\u51B3\u5B9A\u5BF9\u8C61\u7684\u751F\u547D\u5468\u671F\u3002\u5982\u679C\u4E00\u4E2A\u5BF9\u8C61\u4EC5\u6301\u6709\u865A\u5F15\u7528\uFF0C\u90A3\u4E48\u5B83\u5C31\u548C\u6CA1\u6709\u4EFB\u4F55\u5F15\u7528\u4E00\u6837\uFF0C\u5728\u4EFB\u4F55\u65F6\u5019\u90FD\u53EF\u80FD\u88AB\u5783\u573E\u56DE\u6536\u5668\u56DE\u6536\uFF0C\u5B83\u4E0D\u80FD\u5355\u72EC\u4F7F\u7528\u4E5F\u4E0D\u80FD\u901A\u8FC7\u5B83\u8BBF\u95EE\u5BF9\u8C61\uFF0C\u865A\u5F15\u7528\u5FC5\u987B\u548C\u5F15\u7528\u961F\u5217 (ReferenceQueue)\u8054\u5408\u4F7F\u7528\u3002</p><p>\u200B \u865A\u5F15\u7528\u7684\u4E3B\u8981\u4F5C\u7528\u662F\u8DDF\u8E2A\u5BF9\u8C61\u88AB\u5783\u573E\u56DE\u6536\u7684\u72B6\u6001\u3002 \u4EC5\u4EC5\u662F\u63D0\u4F9B\u4E86\u4E00\u79CD\u786E\u4FDD\u5BF9\u8C61\u88AB finalize\u4EE5\u540E\uFF0C\u505A\u67D0\u4E9B\u4E8B\u60C5\u7684\u673A\u5236\u3002 PhantomReference\u7684get\u65B9\u6CD5\u603B\u662F\u8FD4\u56DEnull\uFF0C\u56E0\u6B64\u65E0\u6CD5\u8BBF\u95EE\u5BF9\u5E94\u7684\u5F15\u7528\u5BF9\u8C61\u3002</p><p>\u5176\u610F\u4E49\u5728\u4E8E\uFF1A\u8BF4\u660E\u4E00\u4E2A\u5BF9\u8C61\u5DF2\u7ECF\u8FDB\u5165finalization\u9636\u6BB5\uFF0C\u53EF\u4EE5\u88ABgc\u56DE\u6536\uFF0C\u7528\u6765\u5B9E\u73B0\u6BD4finalization\u673A\u5236\u66F4\u7075\u6D3B\u7684\u56DE\u6536\u64CD\u4F5C\u3002</p><p>\u6362\u53E5\u8BDD\u8BF4\uFF0C\u8BBE\u7F6E\u865A\u5F15\u7528\u5173\u8054\u7684\u552F\u4E00\u76EE\u7684\uFF0C\u5C31\u662F\u5728\u8FD9\u4E2A\u5BF9\u8C61\u88AB\u6536\u96C6\u5668\u56DE\u6536\u7684\u65F6\u5019\u6536\u5230\u4E00\u4E2A\u7CFB\u7EDF\u901A\u77E5\u6216\u8005\u540E\u7EED\u6DFB\u52A0\u8FDB\u4E00\u6B65\u7684\u5904\u7406\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927224455350.png" alt="image-20210927224455350"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927224500569.png" alt="image-20210927224500569"></p><p>\u6211\u88AB\u56DE\u6536\u524D\u9700\u8981\u88AB\u5F15\u7528\u961F\u5217\u4FDD\u5B58\u4E0B\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">MyObject</span>
<span class="token punctuation">{</span>
    <span class="token comment">//\u4E00\u822C\u5F00\u53D1\u4E2D\u4E0D\u7528\u8C03\u7528\u8FD9\u4E2A\u65B9\u6CD5\uFF0C\u672C\u6B21\u53EA\u662F\u4E3A\u4E86\u6F14\u793A</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;---finalize method invoked....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReferenceDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">ReferenceQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyObject</span><span class="token punctuation">&gt;</span></span> referenceQueue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyObject</span><span class="token punctuation">&gt;</span></span> phantomReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PhantomReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>referenceQueue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//System.out.println(phantomReference.get());</span>

        <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>phantomReference<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">Reference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">MyObject</span><span class="token punctuation">&gt;</span></span> reference <span class="token operator">=</span> referenceQueue<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>reference <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;***********\u6709\u865A\u5BF9\u8C61\u52A0\u5165\u961F\u5217\u4E86&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">weakReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyObject</span><span class="token punctuation">&gt;</span></span> weakReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----gc before\u5185\u5B58\u591F\u7528: &quot;</span><span class="token operator">+</span>weakReference<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----gc after\u5185\u5B58\u591F\u7528: &quot;</span><span class="token operator">+</span>weakReference<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">softReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//\u5F53\u6211\u4EEC\u5185\u5B58\u4E0D\u591F\u7528\u7684\u65F6\u5019\uFF0Csoft\u4F1A\u88AB\u56DE\u6536\u7684\u60C5\u51B5\uFF0C\u8BBE\u7F6E\u6211\u4EEC\u7684\u5185\u5B58\u5927\u5C0F\uFF1A-Xms10m -Xmx10m</span>
        <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MyObject</span><span class="token punctuation">&gt;</span></span> softReference <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoftReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----gc after\u5185\u5B58\u591F\u7528: &quot;</span><span class="token operator">+</span>softReference<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">9</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----gc after\u5185\u5B58\u4E0D\u591F: &quot;</span><span class="token operator">+</span>softReference<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">strongReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">MyObject</span> myObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----gc before: &quot;</span><span class="token operator">+</span>myObject<span class="token punctuation">)</span><span class="token punctuation">;</span>

        myObject <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----gc after: &quot;</span><span class="token operator">+</span>myObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5\u3001gcroots\u548C\u56DB\u5927\u5F15\u7528\u5C0F\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#_5\u3001gcroots\u548C\u56DB\u5927\u5F15\u7528\u5C0F\u603B\u7ED3" aria-hidden="true">#</a> 5\u3001GCRoots\u548C\u56DB\u5927\u5F15\u7528\u5C0F\u603B\u7ED3</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927224539900.png" alt="image-20210927224539900"></p><h4 id="_4\u3001\u5173\u7CFB" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u5173\u7CFB" aria-hidden="true">#</a> 4\u3001\u5173\u7CFB</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927224633866.png" alt="image-20210927224633866"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927224637416.png" alt="image-20210927224637416"></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>\u6BCF\u4E2AThread\u5BF9\u8C61\u7EF4\u62A4\u7740\u4E00\u4E2AThreadLocalMap\u7684\u5F15\u7528
ThreadLocalMap\u662FThreadLocal\u7684\u5185\u90E8\u7C7B\uFF0C\u7528Entry\u6765\u8FDB\u884C\u5B58\u50A8
\u8C03\u7528ThreadLocal\u7684set()\u65B9\u6CD5\u65F6\uFF0C\u5B9E\u9645\u4E0A\u5C31\u662F\u5F80ThreadLocalMap\u8BBE\u7F6E\u503C\uFF0Ckey\u662FThreadLocal\u5BF9\u8C61\uFF0C\u503CValue\u662F\u4F20\u9012\u8FDB\u6765\u7684\u5BF9\u8C61
\u8C03\u7528ThreadLocal\u7684get()\u65B9\u6CD5\u65F6\uFF0C\u5B9E\u9645\u4E0A\u5C31\u662F\u5F80ThreadLocalMap\u83B7\u53D6\u503C\uFF0Ckey\u662FThreadLocal\u5BF9\u8C61
ThreadLocal\u672C\u8EAB\u5E76\u4E0D\u5B58\u50A8\u503C\uFF0C\u5B83\u53EA\u662F\u81EA\u5DF1\u4F5C\u4E3A\u4E00\u4E2Akey\u6765\u8BA9\u7EBF\u7A0B\u4ECEThreadLocalMap\u83B7\u53D6value\uFF0C\u6B63\u56E0\u4E3A\u8FD9\u4E2A\u539F\u7406\uFF0C\u6240\u4EE5ThreadLocal\u80FD\u591F\u5B9E\u73B0\u201C\u6570\u636E\u9694\u79BB\u201D\uFF0C\u83B7\u53D6\u5F53\u524D\u7EBF\u7A0B\u7684\u5C40\u90E8\u53D8\u91CF\u503C\uFF0C\u4E0D\u53D7\u5176\u4ED6\u7EBF\u7A0B\u5F71\u54CD\uFF5E
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6\u3001\u4E3A\u4EC0\u4E48\u8981\u7528\u5F31\u5F15\u7528-\u4E0D\u7528\u5982\u4F55" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u4E3A\u4EC0\u4E48\u8981\u7528\u5F31\u5F15\u7528-\u4E0D\u7528\u5982\u4F55" aria-hidden="true">#</a> 6\u3001\u4E3A\u4EC0\u4E48\u8981\u7528\u5F31\u5F15\u7528?\u4E0D\u7528\u5982\u4F55\uFF1F</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">function01</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name">ThreadLocal</span> tl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//line1</span>
    tl<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                   <span class="token comment">//line2</span>
    tl<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                       <span class="token comment">//line3</span>
<span class="token punctuation">}</span>
<span class="token comment">//line1\u65B0\u5EFA\u4E86\u4E00\u4E2AThreadLocal\u5BF9\u8C61\uFF0Ct1 \u662F\u5F3A\u5F15\u7528\u6307\u5411\u8FD9\u4E2A\u5BF9\u8C61\uFF1B</span>
<span class="token comment">//line2\u8C03\u7528set()\u65B9\u6CD5\u540E\u65B0\u5EFA\u4E00\u4E2AEntry\uFF0C\u901A\u8FC7\u6E90\u7801\u53EF\u77E5Entry\u5BF9\u8C61\u91CC\u7684k\u662F\u5F31\u5F15\u7528\u6307\u5411\u8FD9\u4E2A\u5BF9\u8C61\u3002</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927224731712.png" alt="image-20210927224731712"></p><p>\u200B \u5F53function01\u65B9\u6CD5\u6267\u884C\u5B8C\u6BD5\u540E\uFF0C\u6808\u5E27\u9500\u6BC1\u5F3A\u5F15\u7528 tl \u4E5F\u5C31\u6CA1\u6709\u4E86\u3002\u4F46\u6B64\u65F6\u7EBF\u7A0B\u7684ThreadLocalMap\u91CC\u67D0\u4E2Aentry\u7684key\u5F15\u7528\u8FD8\u6307\u5411\u8FD9\u4E2A\u5BF9\u8C61,\u82E5\u8FD9\u4E2Akey\u5F15\u7528\u662F\u5F3A\u5F15\u7528\uFF0C\u5C31\u4F1A\u5BFC\u81F4key\u6307\u5411\u7684ThreadLocal\u5BF9\u8C61\u53CAv\u6307\u5411\u7684\u5BF9\u8C61\u4E0D\u80FD\u88ABgc\u56DE\u6536\uFF0C\u9020\u6210\u5185\u5B58\u6CC4\u6F0F\uFF1B\u82E5\u8FD9\u4E2Akey\u5F15\u7528\u662F\u5F31\u5F15\u7528\u5C31\u5927\u6982\u7387\u4F1A\u51CF\u5C11\u5185\u5B58\u6CC4\u6F0F\u7684\u95EE\u9898(\u8FD8\u6709\u4E00\u4E2Akey\u4E3Anull\u7684\u96F7)\u3002\u4F7F\u7528\u5F31\u5F15\u7528\uFF0C\u5C31\u53EF\u4EE5\u4F7FThreadLocal\u5BF9\u8C61\u5728\u65B9\u6CD5\u6267\u884C\u5B8C\u6BD5\u540E\u987A\u5229\u88AB\u56DE\u6536\u4E14Entry\u7684key\u5F15\u7528\u6307\u5411\u4E3Anull\u3002</p><p><strong>\u6B64\u540E\u6211\u4EEC\u8C03\u7528get,set\u6216remove\u65B9\u6CD5\u65F6\uFF0C\u5C31\u4F1A\u5C1D\u8BD5\u5220\u9664key\u4E3Anull\u7684entry\uFF0C\u53EF\u4EE5\u91CA\u653Evalue\u5BF9\u8C61\u6240\u5360\u7528\u7684\u5185\u5B58\u3002</strong></p><h5 id="_1\u3001\u5F31\u5F15\u7528\u5C31\u4E07\u4E8B\u5927\u5409\u4E86\u5417" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5F31\u5F15\u7528\u5C31\u4E07\u4E8B\u5927\u5409\u4E86\u5417" aria-hidden="true">#</a> 1\u3001\u5F31\u5F15\u7528\u5C31\u4E07\u4E8B\u5927\u5409\u4E86\u5417\uFF1F</h5><ol><li><p>\u5F53\u6211\u4EEC\u4E3AthreadLocal\u53D8\u91CF\u8D4B\u503C\uFF0C\u5B9E\u9645\u4E0A\u5C31\u662F\u5F53\u524D\u7684Entry(threadLocal\u5B9E\u4F8B\u4E3Akey\uFF0C\u503C\u4E3Avalue)\u5F80\u8FD9\u4E2AthreadLocalMap\u4E2D\u5B58\u653E\u3002Entry\u4E2D\u7684key\u662F\u5F31\u5F15\u7528\uFF0C\u5F53threadLocal\u5916\u90E8\u5F3A\u5F15\u7528\u88AB\u7F6E\u4E3Anull(tl=null),\u90A3\u4E48\u7CFB\u7EDF GC \u7684\u65F6\u5019\uFF0C\u6839\u636E\u53EF\u8FBE\u6027\u5206\u6790\uFF0C\u8FD9\u4E2AthreadLocal\u5B9E\u4F8B\u5C31\u6CA1\u6709\u4EFB\u4F55\u4E00\u6761\u94FE\u8DEF\u80FD\u591F\u5F15\u7528\u5230\u5B83\uFF0C\u8FD9\u4E2AThreadLocal\u52BF\u5FC5\u4F1A\u88AB\u56DE\u6536\uFF0C\u8FD9\u6837\u4E00\u6765\uFF0CThreadLocalMap\u4E2D\u5C31\u4F1A\u51FA\u73B0key\u4E3Anull\u7684Entry\uFF0C\u5C31\u6CA1\u6709\u529E\u6CD5\u8BBF\u95EE\u8FD9\u4E9Bkey\u4E3Anull\u7684Entry\u7684value\uFF0C\u5982\u679C\u5F53\u524D\u7EBF\u7A0B\u518D\u8FDF\u8FDF\u4E0D\u7ED3\u675F\u7684\u8BDD\uFF0C\u8FD9\u4E9Bkey\u4E3Anull\u7684Entry\u7684value\u5C31\u4F1A\u4E00\u76F4\u5B58\u5728\u4E00\u6761\u5F3A\u5F15\u7528\u94FE\uFF1AThread Ref -&gt; Thread -&gt; ThreaLocalMap -&gt; Entry -&gt; value\u6C38\u8FDC\u65E0\u6CD5\u56DE\u6536\uFF0C\u9020\u6210\u5185\u5B58\u6CC4\u6F0F\u3002</p></li><li><p>\u5F53\u7136\uFF0C\u5982\u679C\u5F53\u524Dthread\u8FD0\u884C\u7ED3\u675F\uFF0CthreadLocal\uFF0CthreadLocalMap,Entry\u6CA1\u6709\u5F15\u7528\u94FE\u53EF\u8FBE\uFF0C\u5728\u5783\u573E\u56DE\u6536\u7684\u65F6\u5019\u90FD\u4F1A\u88AB\u7CFB\u7EDF\u8FDB\u884C\u56DE\u6536\u3002</p></li><li><p>\u4F46\u5728\u5B9E\u9645\u4F7F\u7528\u4E2D\u6211\u4EEC\u6709\u65F6\u5019\u4F1A\u7528\u7EBF\u7A0B\u6C60\u53BB\u7EF4\u62A4\u6211\u4EEC\u7684\u7EBF\u7A0B\uFF0C\u6BD4\u5982\u5728Executors.newFixedThreadPool()\u65F6\u521B\u5EFA\u7EBF\u7A0B\u7684\u65F6\u5019\uFF0C\u4E3A\u4E86\u590D\u7528\u7EBF\u7A0B\u662F\u4E0D\u4F1A\u7ED3\u675F\u7684\uFF0C\u6240\u4EE5threadLocal\u5185\u5B58\u6CC4\u6F0F\u5C31\u503C\u5F97\u6211\u4EEC\u5C0F\u5FC3</p></li></ol><h5 id="_2\u3001key\u4E3Anull\u7684entry-\u539F\u7406\u89E3\u6790" tabindex="-1"><a class="header-anchor" href="#_2\u3001key\u4E3Anull\u7684entry-\u539F\u7406\u89E3\u6790" aria-hidden="true">#</a> 2\u3001key\u4E3Anull\u7684entry\uFF0C\u539F\u7406\u89E3\u6790</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927224633866.png" alt="image-20210927224633866"></p><p>\u200B ThreadLocalMap\u4F7F\u7528ThreadLocal\u7684\u5F31\u5F15\u7528\u4F5C\u4E3Akey\uFF0C\u5982\u679C\u4E00\u4E2AThreadLocal\u6CA1\u6709\u5916\u90E8\u5F3A\u5F15\u7528\u5F15\u7528\u4ED6\uFF0C\u90A3\u4E48\u7CFB\u7EDFgc\u7684\u65F6\u5019\uFF0C\u8FD9\u4E2AThreadLocal\u52BF\u5FC5\u4F1A\u88AB\u56DE\u6536\uFF0C\u8FD9\u6837\u4E00\u6765\uFF0CThreadLocalMap\u4E2D\u5C31\u4F1A\u51FA\u73B0key\u4E3Anull\u7684Entry\uFF0C\u5C31\u6CA1\u6709\u529E\u6CD5\u8BBF\u95EE\u8FD9\u4E9Bkey\u4E3Anull\u7684Entry\u7684value\uFF0C\u5982\u679C\u5F53\u524D\u7EBF\u7A0B\u518D\u8FDF\u8FDF\u4E0D\u7ED3\u675F\u7684\u8BDD(\u6BD4\u5982\u6B63\u597D\u7528\u5728\u7EBF\u7A0B\u6C60)\uFF0C\u8FD9\u4E9Bkey\u4E3Anull\u7684Entry\u7684value\u5C31\u4F1A\u4E00\u76F4\u5B58\u5728\u4E00\u6761\u5F3A\u5F15\u7528\u94FE\u3002</p><p>\u200B \u867D\u7136\u5F31\u5F15\u7528\uFF0C\u4FDD\u8BC1\u4E86key\u6307\u5411\u7684ThreadLocal\u5BF9\u8C61\u80FD\u88AB\u53CA\u65F6\u56DE\u6536\uFF0C\u4F46\u662Fv\u6307\u5411\u7684value\u5BF9\u8C61\u662F\u9700\u8981ThreadLocalMap\u8C03\u7528get\u3001set\u65F6\u53D1\u73B0key\u4E3Anull\u65F6\u624D\u4F1A\u53BB\u56DE\u6536\u6574\u4E2Aentry\u3001value\uFF0C\u56E0\u6B64\u5F31\u5F15\u7528\u4E0D\u80FD100%\u4FDD\u8BC1\u5185\u5B58\u4E0D\u6CC4\u9732\u3002\u6211\u4EEC\u8981\u5728\u4E0D\u4F7F\u7528\u67D0\u4E2AThreadLocal\u5BF9\u8C61\u540E\uFF0C\u624B\u52A8\u8C03\u7528remoev\u65B9\u6CD5\u6765\u5220\u9664\u5B83\uFF0C\u5C24\u5176\u662F\u5728\u7EBF\u7A0B\u6C60\u4E2D\uFF0C\u4E0D\u4EC5\u4EC5\u662F\u5185\u5B58\u6CC4\u9732\u7684\u95EE\u9898\uFF0C\u56E0\u4E3A\u7EBF\u7A0B\u6C60\u4E2D\u7684\u7EBF\u7A0B\u662F\u91CD\u590D\u4F7F\u7528\u7684\uFF0C\u610F\u5473\u7740\u8FD9\u4E2A\u7EBF\u7A0B\u7684ThreadLocalMap\u5BF9\u8C61\u4E5F\u662F\u91CD\u590D\u4F7F\u7528\u7684\uFF0C\u5982\u679C\u6211\u4EEC\u4E0D\u624B\u52A8\u8C03\u7528remove\u65B9\u6CD5\uFF0C\u90A3\u4E48\u540E\u9762\u7684\u7EBF\u7A0B\u5C31\u6709\u53EF\u80FD\u83B7\u53D6\u5230\u4E0A\u4E2A\u7EBF\u7A0B\u9057\u7559\u4E0B\u6765\u7684value\u503C\uFF0C\u9020\u6210bug\u3002</p><h5 id="_3\u3001set\u3001get\u65B9\u6CD5\u4F1A\u53BB\u68C0\u67E5\u6240\u6709\u952E\u4E3Anull\u7684entry\u5BF9\u8C61" tabindex="-1"><a class="header-anchor" href="#_3\u3001set\u3001get\u65B9\u6CD5\u4F1A\u53BB\u68C0\u67E5\u6240\u6709\u952E\u4E3Anull\u7684entry\u5BF9\u8C61" aria-hidden="true">#</a> 3\u3001set\u3001get\u65B9\u6CD5\u4F1A\u53BB\u68C0\u67E5\u6240\u6709\u952E\u4E3Anull\u7684Entry\u5BF9\u8C61</h5><p>set()</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927224959196.png" alt="image-20210927224959196"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927225002054.png" alt="image-20210927225002054"></p><p>get()</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927225105228.png" alt=""></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927225110265.png" alt="image-20210927225110265"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927225059412.png" alt="image-20210927225059412"></p><p>remove()</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927225121559.png" alt="image-20210927225121559"></p><p>\u7ED3\u8BBA</p><p>\u200B \u4ECE\u524D\u9762\u7684set,getEntry,remove\u65B9\u6CD5\u770B\u51FA\uFF0C\u5728threadLocal\u7684\u751F\u547D\u5468\u671F\u91CC\uFF0C\u9488\u5BF9threadLocal\u5B58\u5728\u7684\u5185\u5B58\u6CC4\u6F0F\u7684\u95EE\u9898\uFF0C \u90FD\u4F1A\u901A\u8FC7expungeStaleEntry\uFF0CcleanSomeSlots,replaceStaleEntry\u8FD9\u4E09\u4E2A\u65B9\u6CD5\u6E05\u7406\u6389key\u4E3Anull\u7684\u810Fentry\u3002</p><h5 id="_4\u3001\u7ED3\u8BBA" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u7ED3\u8BBA" aria-hidden="true">#</a> 4\u3001\u7ED3\u8BBA</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927225235846.png" alt="image-20210927225235846"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927225238663.png" alt="image-20210927225238663"></p><h3 id="_7\u3001\u6700\u4F73\u5B9E\u8DF5" tabindex="-1"><a class="header-anchor" href="#_7\u3001\u6700\u4F73\u5B9E\u8DF5" aria-hidden="true">#</a> 7\u3001\u6700\u4F73\u5B9E\u8DF5</h3><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927225409632.png" alt="image-20210927225409632"></p><p>\u7528\u5B8C\u8BB0\u5F97\u624B\u52A8remove</p><h3 id="_8\u3001\u5C0F\u603B\u7ED3" tabindex="-1"><a class="header-anchor" href="#_8\u3001\u5C0F\u603B\u7ED3" aria-hidden="true">#</a> 8\u3001\u5C0F\u603B\u7ED3</h3><ul><li>ThreadLocal \u5E76\u4E0D\u89E3\u51B3\u7EBF\u7A0B\u95F4\u5171\u4EAB\u6570\u636E\u7684\u95EE\u9898</li><li>ThreadLocal \u9002\u7528\u4E8E\u53D8\u91CF\u5728\u7EBF\u7A0B\u95F4\u9694\u79BB\u4E14\u5728\u65B9\u6CD5\u95F4\u5171\u4EAB\u7684\u573A\u666F</li><li>ThreadLocal \u901A\u8FC7\u9690\u5F0F\u7684\u5728\u4E0D\u540C\u7EBF\u7A0B\u5185\u521B\u5EFA\u72EC\u7ACB\u5B9E\u4F8B\u526F\u672C\u907F\u514D\u4E86\u5B9E\u4F8B\u7EBF\u7A0B\u5B89\u5168\u7684\u95EE\u9898</li><li>\u6BCF\u4E2A\u7EBF\u7A0B\u6301\u6709\u4E00\u4E2A\u53EA\u5C5E\u4E8E\u81EA\u5DF1\u7684\u4E13\u5C5EMap\u5E76\u7EF4\u62A4\u4E86ThreadLocal\u5BF9\u8C61\u4E0E\u5177\u4F53\u5B9E\u4F8B\u7684\u6620\u5C04\uFF0C\u8BE5Map\u7531\u4E8E\u53EA\u88AB\u6301\u6709\u5B83\u7684\u7EBF\u7A0B\u8BBF\u95EE\uFF0C\u6545\u4E0D\u5B58\u5728\u7EBF\u7A0B\u5B89\u5168\u4EE5\u53CA\u9501\u7684\u95EE\u9898</li><li>ThreadLocalMap\u7684Entry\u5BF9ThreadLocal\u7684\u5F15\u7528\u4E3A\u5F31\u5F15\u7528\uFF0C\u907F\u514D\u4E86ThreadLocal\u5BF9\u8C61\u65E0\u6CD5\u88AB\u56DE\u6536\u7684\u95EE\u9898</li><li>\u90FD\u4F1A\u901A\u8FC7expungeStaleEntry\uFF0CcleanSomeSlots,replaceStaleEntry\u8FD9\u4E09\u4E2A\u65B9\u6CD5\u56DE\u6536\u952E\u4E3A null \u7684 Entry \u5BF9\u8C61\u7684\u503C\uFF08\u5373\u4E3A\u5177\u4F53\u5B9E\u4F8B\uFF09\u4EE5\u53CA Entry \u5BF9\u8C61\u672C\u8EAB\u4ECE\u800C\u9632\u6B62\u5185\u5B58\u6CC4\u6F0F\uFF0C\u5C5E\u4E8E\u5B89\u5168\u52A0\u56FA\u7684\u65B9\u6CD5</li><li>\u7FA4\u96C4\u9010\u9E7F\u8D77\u7EB7\u4E89\uFF0C\u4EBA\u5404\u4E00\u4EFD\u5929\u4E0B\u5B89</li></ul><h3 id="_9\u3001threadlocal\u548Cinheritablethreadlocal" tabindex="-1"><a class="header-anchor" href="#_9\u3001threadlocal\u548Cinheritablethreadlocal" aria-hidden="true">#</a> 9\u3001ThreadLocal\u548CInheritableThreadLocal</h3><p>\u9700\u8981\u89E3\u51B3\u7684\u95EE\u9898</p><blockquote><p>\u6211\u4EEC\u8FD8\u662F\u4EE5\u89E3\u51B3\u95EE\u9898\u7684\u65B9\u5F0F\u6765\u5F15\u51FA<code>ThreadLocal</code>\u3001<code>InheritableThreadLocal</code>\uFF0C\u8FD9\u6837\u5370\u8C61\u4F1A\u6DF1\u523B\u4E00\u4E9B\u3002</p></blockquote><p>\u76EE\u524Djava\u5F00\u53D1web\u7CFB\u7EDF\u4E00\u822C\u67093\u5C42\uFF0Ccontroller\u3001service\u3001dao\uFF0C\u8BF7\u6C42\u5230\u8FBEcontroller\uFF0Ccontroller\u8C03\u7528service\uFF0Cservice\u8C03\u7528dao\uFF0C\u7136\u540E\u8FDB\u884C\u5904\u7406\u3002</p><p>\u6211\u4EEC\u5199\u4E00\u4E2A\u7B80\u5355\u7684\u4F8B\u5B50\uFF0C\u67093\u4E2A\u65B9\u6CD5\u5206\u522B\u6A21\u62DFcontroller\u3001service\u3001dao\u3002\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">LinkedBlockingDeque</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadPoolExecutor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token class-name">AtomicInteger</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo1</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">AtomicInteger</span> threadIndex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u521B\u5EFA\u5904\u7406\u8BF7\u6C42\u7684\u7EBF\u7A0B\u6C60\u5B50</span>
    <span class="token keyword">static</span> <span class="token class-name">ThreadPoolExecutor</span> disposeRequestExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token number">60</span><span class="token punctuation">,</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            r <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                thread<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;disposeRequestThread-&quot;</span> <span class="token operator">+</span> threadIndex<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> thread<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u8BB0\u5F55\u65E5\u5FD7</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StackTraceElement</span> stack<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Throwable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;****&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;,[\u7EBF\u7A0B:&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;],&quot;</span> <span class="token operator">+</span> stack<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6A21\u62DFcontroller</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u63A5\u53D7\u8BF7\u6C42&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">service</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6A21\u62DFservice</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C\u4E1A\u52A1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">dao</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6A21\u62DFdao</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u6A21\u62DF\u63D2\u5165\u6570\u636E</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> s <span class="token operator">:</span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u63D2\u5165\u6570\u636E&quot;</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">&quot;\u6210\u529F&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u9700\u8981\u63D2\u5165\u7684\u6570\u636E</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dataList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;\u6570\u636E&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//\u6A21\u62DF5\u4E2A\u8BF7\u6C42</span>
        <span class="token keyword">int</span> requestCount <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> requestCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            disposeRequestExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">controller</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        disposeRequestExecutor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891286</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63A5\u53D7\u8BF7\u6C42
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891286</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63A5\u53D7\u8BF7\u6C42
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891287</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u4E1A\u52A1
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891287</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u4E1A\u52A1
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891287</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63A5\u53D7\u8BF7\u6C42
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891287</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891287</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">0</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891287</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">1</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891287</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891287</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">2</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891287</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u4E1A\u52A1
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891288</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63A5\u53D7\u8BF7\u6C42
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891287</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">0</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891288</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u4E1A\u52A1
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891288</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891288</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891288</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">1</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891288</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">0</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891288</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">0</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891288</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">1</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891288</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">2</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891288</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">2</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891288</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">1</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891288</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63A5\u53D7\u8BF7\u6C42
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891288</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">2</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891288</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u4E1A\u52A1
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891289</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891289</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">0</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891289</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">1</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565338891289</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo1</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo1</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">2</span>\u6210\u529F
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4EE3\u7801\u4E2D\u8C03\u7528controller\u3001service\u3001dao 3\u4E2A\u65B9\u6CD5\u65F6\uFF0C\u6765\u6A21\u62DF\u5904\u7406\u4E00\u4E2A\u8BF7\u6C42\u3002main\u65B9\u6CD5\u4E2D\u5FAA\u73AF\u4E865\u6B21\u6A21\u62DF\u53D1\u8D775\u6B21\u8BF7\u6C42\uFF0C\u7136\u540E\u4EA4\u7ED9\u7EBF\u7A0B\u6C60\u53BB\u5904\u7406\u8BF7\u6C42\uFF0Cdao\u4E2D\u6A21\u62DF\u5FAA\u73AF\u63D2\u5165\u4F20\u5165\u7684dataList\u6570\u636E\u3002</p><p><strong>\u95EE\u9898\u6765\u4E86\uFF1A\u5F00\u53D1\u8005\u60F3\u770B\u4E00\u4E0B\u54EA\u4E9B\u5730\u65B9\u8017\u65F6\u6BD4\u8F83\u591A\uFF0C\u60F3\u901A\u8FC7\u65E5\u5FD7\u6765\u5206\u6790\u8017\u65F6\u60C5\u51B5\uFF0C\u60F3\u8FFD\u8E2A\u67D0\u4E2A\u8BF7\u6C42\u7684\u5B8C\u6574\u65E5\u5FD7\uFF0C\u600E\u4E48\u641E\uFF1F</strong></p><p>\u4E0A\u9762\u7684\u8BF7\u6C42\u91C7\u7528\u7EBF\u7A0B\u6C60\u7684\u65B9\u5F0F\u5904\u7406\u7684\uFF0C\u591A\u4E2A\u8BF7\u6C42\u53EF\u80FD\u4F1A\u88AB\u4E00\u4E2A\u7EBF\u7A0B\u5904\u7406\uFF0C\u901A\u8FC7\u65E5\u5FD7\u5F88\u96BE\u770B\u51FA\u90A3\u4E9B\u65E5\u5FD7\u662F\u540C\u4E00\u4E2A\u8BF7\u6C42\uFF0C\u6211\u4EEC\u80FD\u4E0D\u80FD\u7ED9\u8BF7\u6C42\u52A0\u4E00\u4E2A\u552F\u4E00\u6807\u5FD7\uFF0C\u65E5\u5FD7\u4E2D\u8F93\u51FA\u8FD9\u4E2A\u552F\u4E00\u6807\u5FD7\uFF0C\u5F53\u7136\u53EF\u4EE5\u3002</p><p>\u5982\u679C\u6211\u4EEC\u7684\u4EE3\u7801\u5C31\u53EA\u6709\u4E0A\u9762\u793A\u4F8B\u8FD9\u4E48\u7B80\u5355\uFF0C\u6211\u60F3\u8FD8\u662F\u5F88\u5BB9\u6613\u7684\uFF0C\u4E0A\u9762\u5C313\u4E2A\u65B9\u6CD5\uFF0C\u7ED9\u6BCF\u4E2A\u65B9\u6CD5\u52A0\u4E2AtraceId\u53C2\u6570\uFF0Clog\u65B9\u6CD5\u4E5F\u52A0\u4E2AtraceId\u53C2\u6570\uFF0C\u5C31\u89E3\u51B3\u4E86\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">LinkedBlockingDeque</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadPoolExecutor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token class-name">AtomicInteger</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo2</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">AtomicInteger</span> threadIndex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u521B\u5EFA\u5904\u7406\u8BF7\u6C42\u7684\u7EBF\u7A0B\u6C60\u5B50</span>
    <span class="token keyword">static</span> <span class="token class-name">ThreadPoolExecutor</span> disposeRequestExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token number">60</span><span class="token punctuation">,</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            r <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                thread<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;disposeRequestThread-&quot;</span> <span class="token operator">+</span> threadIndex<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> thread<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u8BB0\u5F55\u65E5\u5FD7</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">,</span> <span class="token class-name">String</span> traceId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StackTraceElement</span> stack<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Throwable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;****&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;[traceId:&quot;</span> <span class="token operator">+</span> traceId <span class="token operator">+</span> <span class="token string">&quot;],[\u7EBF\u7A0B:&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;],&quot;</span> <span class="token operator">+</span> stack<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6A21\u62DFcontroller</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList<span class="token punctuation">,</span> <span class="token class-name">String</span> traceId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u63A5\u53D7\u8BF7\u6C42&quot;</span><span class="token punctuation">,</span> traceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">service</span><span class="token punctuation">(</span>dataList<span class="token punctuation">,</span> traceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6A21\u62DFservice</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList<span class="token punctuation">,</span> <span class="token class-name">String</span> traceId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C\u4E1A\u52A1&quot;</span><span class="token punctuation">,</span> traceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">dao</span><span class="token punctuation">(</span>dataList<span class="token punctuation">,</span> traceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6A21\u62DFdao</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList<span class="token punctuation">,</span> <span class="token class-name">String</span> traceId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C&quot;</span><span class="token punctuation">,</span> traceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u6A21\u62DF\u63D2\u5165\u6570\u636E</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> s <span class="token operator">:</span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u63D2\u5165\u6570\u636E&quot;</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">&quot;\u6210\u529F&quot;</span><span class="token punctuation">,</span> traceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u9700\u8981\u63D2\u5165\u7684\u6570\u636E</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dataList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;\u6570\u636E&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//\u6A21\u62DF5\u4E2A\u8BF7\u6C42</span>
        <span class="token keyword">int</span> requestCount <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> requestCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> traceId <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            disposeRequestExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">controller</span><span class="token punctuation">(</span>dataList<span class="token punctuation">,</span> traceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        disposeRequestExecutor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559773</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63A5\u53D7\u8BF7\u6C42
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559773</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63A5\u53D7\u8BF7\u6C42
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559773</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63A5\u53D7\u8BF7\u6C42
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559774</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u4E1A\u52A1
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559774</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u4E1A\u52A1
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559774</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559774</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u4E1A\u52A1
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559774</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">0</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559774</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559774</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">1</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559774</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559774</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">2</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559774</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">0</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559775</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63A5\u53D7\u8BF7\u6C42
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559775</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">0</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559775</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u4E1A\u52A1
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559775</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">1</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559775</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559775</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">1</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559775</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">0</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559775</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">2</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559775</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">1</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559775</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">2</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559775</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">2</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559775</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63A5\u53D7\u8BF7\u6C42
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559776</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u4E1A\u52A1
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559776</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559776</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">0</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559776</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">1</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339559776</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo2</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo2</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">2</span>\u6210\u529F
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E0A\u9762\u6211\u4EEC\u901A\u8FC7\u4FEE\u6539\u4EE3\u7801\u7684\u65B9\u5F0F\uFF0C\u628A\u95EE\u9898\u89E3\u51B3\u4E86\uFF0C\u4F46\u524D\u63D0\u662F\u4F60\u4EEC\u7684\u7CFB\u7EDF\u90FD\u50CF\u4E0A\u9762\u8FD9\u4E48\u7B80\u5355\uFF0C\u529F\u80FD\u5F88\u5C11\uFF0C\u9700\u8981\u6539\u7684\u4EE3\u7801\u5F88\u5C11\uFF0C\u53EF\u4EE5\u8FD9\u4E48\u53BB\u6539\u3002\u4F46\u4E8B\u4E0E\u613F\u8FDD\uFF0C\u6211\u4EEC\u7684\u7CFB\u7EDF\u4E00\u822C\u529F\u80FD\u90FD\u662F\u6BD4\u8F83\u591A\u7684\uFF0C\u5982\u679C\u6211\u4EEC\u90FD\u4E00\u4E2A\u4E2A\u53BB\u6539\uFF0C\u5C82\u4E0D\u662F\u8981\u75AF\u6389\uFF0C\u6539\u4EE3\u7801\u8FD8\u6D89\u53CA\u5230\u91CD\u65B0\u6D4B\u8BD5\uFF0C\u98CE\u9669\u4E5F\u4E0D\u53EF\u63A7\u3002\u90A3\u6709\u4EC0\u4E48\u597D\u529E\u6CD5\u4E48\uFF1F</p><p><strong>ThreadLocal</strong></p><p>\u8FD8\u662F\u62FF\u4E0A\u9762\u7684\u95EE\u9898\uFF0C\u6211\u4EEC\u6765\u5206\u6790\u4E00\u4E0B\uFF0C\u6BCF\u4E2A\u8BF7\u6C42\u90FD\u662F\u7531\u4E00\u4E2A\u7EBF\u7A0B\u5904\u7406\u7684\uFF0C\u7EBF\u7A0B\u5C31\u76F8\u5F53\u4E8E\u4E00\u4E2A\u4EBA\u4E00\u6837\uFF0C\u6BCF\u4E2A\u8BF7\u6C42\u76F8\u5F53\u4E8E\u4E00\u4E2A\u4EFB\u52A1\uFF0C\u4EFB\u52A1\u6765\u4E86\uFF0C\u4EBA\u6765\u5904\u7406\uFF0C\u5904\u7406\u5B8C\u6BD5\u4E4B\u540E\uFF0C\u518D\u5904\u7406\u4E0B\u4E00\u4E2A\u8BF7\u6C42\u4EFB\u52A1\u3002\u4EBA\u8EAB\u4E0A\u662F\u4E0D\u662F\u6709\u5F88\u591A\u53E3\u888B\uFF0C\u4EBA\u521A\u5F00\u59CB\u51C6\u5907\u5904\u7406\u4EFB\u52A1\u7684\u65F6\u5019\uFF0C\u6211\u4EEC\u628A\u4EFB\u52A1\u7684\u7F16\u53F7\u653E\u5728\u5904\u7406\u8005\u7684\u53E3\u888B\u4E2D\uFF0C\u7136\u540E\u5904\u7406\u4E2D\u4E00\u8DEF\u643A\u5E26\u8005\uFF0C\u5904\u7406\u8FC7\u7A0B\u4E2D\u5982\u679C\u9700\u8981\u7528\u5230\u8FD9\u4E2A\u7F16\u53F7\uFF0C\u76F4\u63A5\u4ECE\u53E3\u888B\u4E2D\u83B7\u53D6\u5C31\u53EF\u4EE5\u4E86\u3002\u90A3\u4E48\u521A\u597Djava\u4E2D\u7EBF\u7A0B\u8BBE\u8BA1\u7684\u65F6\u5019\u4E5F\u8003\u8651\u5230\u4E86\u8FD9\u4E9B\u95EE\u9898\uFF0CThread\u5BF9\u8C61\u4E2D\u5C31\u6709\u5F88\u591A\u53E3\u888B\uFF0C\u7528\u6765\u653E\u4E1C\u897F\u3002Thread\u7C7B\u4E2D\u6709\u8FD9\u4E48\u4E00\u4E2A\u53D8\u91CF\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ThreadLocal<span class="token punctuation">.</span>ThreadLocalMap</span> threadLocals <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5982\u4F55\u6765\u64CD\u4F5CThread\u4E2D\u7684\u8FD9\u4E9B\u53E3\u888B\u5462\uFF0Cjava\u4E3A\u6211\u4EEC\u63D0\u4F9B\u4E86\u4E00\u4E2A\u7C7B<code>ThreadLocal</code>\uFF0CThreadLocal\u5BF9\u8C61\u7528\u6765\u64CD\u4F5CThread\u4E2D\u7684\u67D0\u4E00\u4E2A\u53E3\u888B\uFF0C\u53EF\u4EE5\u5411\u8FD9\u4E2A\u53E3\u888B\u4E2D\u653E\u4E1C\u897F\u3001\u83B7\u53D6\u91CC\u9762\u7684\u4E1C\u897F\u3001\u6E05\u9664\u91CC\u9762\u7684\u4E1C\u897F\uFF0C\u8FD9\u4E2A\u53E3\u888B\u4E00\u6B21\u6027\u53EA\u80FD\u653E\u4E00\u4E2A\u4E1C\u897F\uFF0C\u91CD\u590D\u653E\u4E1C\u897F\u4F1A\u5C06\u91CC\u9762\u5DF2\u7ECF\u5B58\u5728\u7684\u4E1C\u897F\u8986\u76D6\u6389\u3002</p><p>\u5E38\u7528\u76843\u4E2A\u65B9\u6CD5\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//\u5411Thread\u4E2D\u67D0\u4E2A\u53E3\u888B\u4E2D\u653E\u4E1C\u897F</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u83B7\u53D6\u8FD9\u4E2A\u53E3\u888B\u4E2D\u76EE\u524D\u653E\u7684\u4E1C\u897F</span>
<span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u6E05\u7A7A\u8FD9\u4E2A\u53E3\u888B\u4E2D\u653E\u7684\u4E1C\u897F</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6211\u4EEC\u4F7F\u7528ThreadLocal\u6765\u6539\u9020\u4E00\u4E0B\u4E0A\u9762\u7684\u4EE3\u7801\uFF0C\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">LinkedBlockingDeque</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadPoolExecutor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token class-name">AtomicInteger</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo3</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u521B\u5EFA\u4E00\u4E2A\u64CD\u4F5CThread\u4E2D\u5B58\u653E\u8BF7\u6C42\u4EFB\u52A1\u8FFD\u8E2Aid\u53E3\u888B\u7684\u5BF9\u8C61</span>
    <span class="token keyword">static</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> traceIdKD <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">AtomicInteger</span> threadIndex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u521B\u5EFA\u5904\u7406\u8BF7\u6C42\u7684\u7EBF\u7A0B\u6C60\u5B50</span>
    <span class="token keyword">static</span> <span class="token class-name">ThreadPoolExecutor</span> disposeRequestExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token number">60</span><span class="token punctuation">,</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            r <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                thread<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;disposeRequestThread-&quot;</span> <span class="token operator">+</span> threadIndex<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> thread<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u8BB0\u5F55\u65E5\u5FD7</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StackTraceElement</span> stack<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Throwable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u83B7\u53D6\u5F53\u524D\u7EBF\u7A0B\u5B58\u653EtranceId\u53E3\u888B\u4E2D\u7684\u5185\u5BB9</span>
        <span class="token class-name">String</span> traceId <span class="token operator">=</span> traceIdKD<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;****&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;[traceId:&quot;</span> <span class="token operator">+</span> traceId <span class="token operator">+</span> <span class="token string">&quot;],[\u7EBF\u7A0B:&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;],&quot;</span> <span class="token operator">+</span> stack<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6A21\u62DFcontroller</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u63A5\u53D7\u8BF7\u6C42&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">service</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6A21\u62DFservice</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C\u4E1A\u52A1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">dao</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6A21\u62DFdao</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u6A21\u62DF\u63D2\u5165\u6570\u636E</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> s <span class="token operator">:</span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u63D2\u5165\u6570\u636E&quot;</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">&quot;\u6210\u529F&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u9700\u8981\u63D2\u5165\u7684\u6570\u636E</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dataList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;\u6570\u636E&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//\u6A21\u62DF5\u4E2A\u8BF7\u6C42</span>
        <span class="token keyword">int</span> requestCount <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> requestCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> traceId <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            disposeRequestExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u628AtraceId\u653E\u5165\u53E3\u888B\u4E2D</span>
                traceIdKD<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>traceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token function">controller</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    <span class="token comment">//\u5C06tranceId\u4ECE\u53E3\u888B\u4E2D\u79FB\u9664</span>
                    traceIdKD<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        disposeRequestExecutor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644214</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">41</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63A5\u53D7\u8BF7\u6C42
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644214</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">41</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63A5\u53D7\u8BF7\u6C42
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644214</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">41</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63A5\u53D7\u8BF7\u6C42
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644214</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u4E1A\u52A1
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644214</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u4E1A\u52A1
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644214</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">53</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644214</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u4E1A\u52A1
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644214</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">0</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644214</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">53</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644214</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">53</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">0</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">1</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">1</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">0</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">2</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">2</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">1</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">41</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63A5\u53D7\u8BF7\u6C42
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">41</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63A5\u53D7\u8BF7\u6C42
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u4E1A\u52A1
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">2</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">53</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">47</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u4E1A\u52A1
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">0</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">53</span><span class="token punctuation">)</span><span class="token operator">:</span>\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">1</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">0</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">2</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">1</span>\u6210\u529F
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1565339644215</span><span class="token punctuation">[</span>traceId<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>\u7EBF\u7A0B<span class="token operator">:</span>disposeRequestThread<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>itsoku<span class="token punctuation">.</span>chat24<span class="token punctuation">.</span></span>Demo3</span><span class="token punctuation">.</span><span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">Demo3</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token operator">:</span>\u63D2\u5165\u6570\u636E\u6570\u636E<span class="token number">2</span>\u6210\u529F
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u4EE5\u770B\u51FA\u8F93\u51FA\u548C\u521A\u624D\u4F7F\u7528traceId\u53C2\u6570\u7684\u65B9\u5F0F\u7ED3\u679C\u4E00\u81F4\uFF0C\u4F46\u662F\u5374\u7B80\u5355\u4E86\u5F88\u591A\u3002\u4E0D\u7528\u53BB\u4FEE\u6539controller\u3001service\u3001dao\u4EE3\u7801\u4E86\uFF0C\u98CE\u9669\u4E5F\u51CF\u5C11\u4E86\u5F88\u591A\u3002</p><p>\u4EE3\u7801\u4E2D\u521B\u5EFA\u4E86\u4E00\u4E2A<code>ThreadLocal traceIdKD</code>\uFF0C\u8FD9\u4E2A\u5BF9\u8C61\u7528\u6765\u64CD\u4F5CThread\u4E2D\u4E00\u4E2A\u53E3\u888B\uFF0C\u7528\u8FD9\u4E2A\u53E3\u888B\u6765\u5B58\u653EtranceId\u3002\u5728main\u65B9\u6CD5\u4E2D\u901A\u8FC7<code>traceIdKD.set(traceId)</code>\u65B9\u6CD5\u5C06traceId\u653E\u5165\u53E3\u888B\uFF0Clog\u65B9\u6CD5\u4E2D\u901A<code>traceIdKD.get()</code>\u83B7\u53D6\u53E3\u888B\u4E2D\u7684traceId\uFF0C\u6700\u540E\u4EFB\u52A1\u5904\u7406\u5B8C\u4E4B\u540E\uFF0Cmain\u4E2D\u7684finally\u4E2D\u8C03\u7528<code>traceIdKD.remove();</code>\u5C06\u53E3\u888B\u4E2D\u7684traceId\u6E05\u9664\u3002</p><p><strong>ThreadLocal\u7684\u5B98\u65B9API\u89E3\u91CA\u4E3A\uFF1A</strong></p><blockquote><p>\u201C\u8BE5\u7C7B\u63D0\u4F9B\u4E86\u7EBF\u7A0B\u5C40\u90E8 (thread-local) \u53D8\u91CF\u3002\u8FD9\u4E9B\u53D8\u91CF\u4E0D\u540C\u4E8E\u5B83\u4EEC\u7684\u666E\u901A\u5BF9\u5E94\u7269\uFF0C\u56E0\u4E3A\u8BBF\u95EE\u67D0\u4E2A\u53D8\u91CF\uFF08\u901A\u8FC7\u5176 get \u6216 set \u65B9\u6CD5\uFF09\u7684\u6BCF\u4E2A\u7EBF\u7A0B\u90FD\u6709\u81EA\u5DF1\u7684\u5C40\u90E8\u53D8\u91CF\uFF0C\u5B83\u72EC\u7ACB\u4E8E\u53D8\u91CF\u7684\u521D\u59CB\u5316\u526F\u672C\u3002ThreadLocal \u5B9E\u4F8B\u901A\u5E38\u662F\u7C7B\u4E2D\u7684 private static \u5B57\u6BB5\uFF0C\u5B83\u4EEC\u5E0C\u671B\u5C06\u72B6\u6001\u4E0E\u67D0\u4E00\u4E2A\u7EBF\u7A0B\uFF08\u4F8B\u5982\uFF0C\u7528\u6237 ID \u6216\u4E8B\u52A1 ID\uFF09\u76F8\u5173\u8054\u3002\u201D</p></blockquote><p><strong>InheritableThreadLocal</strong></p><p>\u7EE7\u7EED\u4E0A\u9762\u7684\u5B9E\u4F8B\uFF0Cdao\u4E2D\u5FAA\u73AF\u5904\u7406dataList\u7684\u5185\u5BB9\uFF0C\u5047\u5982dataList\u5904\u7406\u6BD4\u8F83\u8017\u65F6\uFF0C\u6211\u4EEC\u60F3\u52A0\u5FEB\u5904\u7406\u901F\u5EA6\u6709\u4EC0\u4E48\u529E\u6CD5\u4E48\uFF1F\u5927\u5BB6\u5DF2\u7ECF\u60F3\u5230\u4E86\uFF0C\u7528\u591A\u7EBF\u7A0B\u5E76\u884C\u5904\u7406<code>dataList</code>\uFF0C\u90A3\u4E48\u6211\u4EEC\u628A\u4EE3\u7801\u6539\u4E00\u4E0B\uFF0C\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">LinkedBlockingDeque</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadPoolExecutor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token class-name">AtomicInteger</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo4</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u521B\u5EFA\u4E00\u4E2A\u64CD\u4F5CThread\u4E2D\u5B58\u653E\u8BF7\u6C42\u4EFB\u52A1\u8FFD\u8E2Aid\u53E3\u888B\u7684\u5BF9\u8C61</span>
    <span class="token keyword">static</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> traceIdKD <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">AtomicInteger</span> threadIndex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u521B\u5EFA\u5904\u7406\u8BF7\u6C42\u7684\u7EBF\u7A0B\u6C60\u5B50</span>
    <span class="token keyword">static</span> <span class="token class-name">ThreadPoolExecutor</span> disposeRequestExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token number">60</span><span class="token punctuation">,</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            r <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                thread<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;disposeRequestThread-&quot;</span> <span class="token operator">+</span> threadIndex<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> thread<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u8BB0\u5F55\u65E5\u5FD7</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StackTraceElement</span> stack<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Throwable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u83B7\u53D6\u5F53\u524D\u7EBF\u7A0B\u5B58\u653EtranceId\u53E3\u888B\u4E2D\u7684\u5185\u5BB9</span>
        <span class="token class-name">String</span> traceId <span class="token operator">=</span> traceIdKD<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;****&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;[traceId:&quot;</span> <span class="token operator">+</span> traceId <span class="token operator">+</span> <span class="token string">&quot;],[\u7EBF\u7A0B:&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;],&quot;</span> <span class="token operator">+</span> stack<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6A21\u62DFcontroller</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u63A5\u53D7\u8BF7\u6C42&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">service</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6A21\u62DFservice</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C\u4E1A\u52A1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">dao</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6A21\u62DFdao</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span>dataList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> threadName <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u6A21\u62DF\u63D2\u5165\u6570\u636E</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> s <span class="token operator">:</span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">//\u6A21\u62DF\u6570\u636E\u5E93\u64CD\u4F5C\u8017\u65F6100\u6BEB\u79D2</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u63D2\u5165\u6570\u636E&quot;</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">&quot;\u6210\u529F,\u4E3B\u7EBF\u7A0B\uFF1A&quot;</span> <span class="token operator">+</span> threadName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//\u7B49\u5F85\u4E0A\u9762\u7684dataList\u5904\u7406\u5B8C\u6BD5</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u9700\u8981\u63D2\u5165\u7684\u6570\u636E</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dataList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;\u6570\u636E&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//\u6A21\u62DF5\u4E2A\u8BF7\u6C42</span>
        <span class="token keyword">int</span> requestCount <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> requestCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> traceId <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            disposeRequestExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u628AtraceId\u653E\u5165\u53E3\u888B\u4E2D</span>
                traceIdKD<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>traceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token function">controller</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    <span class="token comment">//\u5C06tranceId\u4ECE\u53E3\u888B\u4E2D\u79FB\u9664</span>
                    traceIdKD<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        disposeRequestExecutor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u770B\u4E00\u4E0B\u4E0A\u9762\u7684\u8F93\u51FA\uFF0C\u6709\u4E9BtraceId\u4E3Anull\uFF0C\u8FD9\u662F\u4E3A\u4EC0\u4E48\u5462\uFF1F\u8FD9\u662F\u56E0\u4E3Adao\u4E2D\u4E3A\u4E86\u63D0\u5347\u5904\u7406\u901F\u5EA6\uFF0C\u521B\u5EFA\u4E86\u5B50\u7EBF\u7A0B\u6765\u5E76\u884C\u5904\u7406\uFF0C\u5B50\u7EBF\u7A0B\u8C03\u7528log\u7684\u65F6\u5019\uFF0C\u53BB\u81EA\u5DF1\u7684\u5B58\u653EtraceId\u7684\u53E3\u888B\u4E2D\u62FF\u53BB\u4E1C\u897F\uFF0C\u80AF\u5B9A\u662F\u7A7A\u7684\u4E86\u3002</p><p>\u90A3\u6709\u4EC0\u4E48\u529E\u6CD5\u4E48\uFF1F\u53EF\u4E0D\u53EF\u4EE5\u8FD9\u6837\uFF1F</p><p>\u7236\u7EBF\u7A0B\u76F8\u5F53\u4E8E\u4E3B\u7BA1\uFF0C\u5B50\u7EBF\u7A0B\u76F8\u5F53\u4E8E\u5E72\u6D3B\u7684\u5C0F\u5F1F\uFF0C\u4E3B\u7BA1\u8BA9\u5C0F\u5F1F\u4EEC\u5E72\u6D3B\u7684\u65F6\u5019\uFF0C\u5C06\u81EA\u5DF1\u515C\u91CC\u9762\u7684\u4E1C\u897F\u590D\u5236\u4E00\u4EFD\u7ED9\u5C0F\u5F1F\u4EEC\u4F7F\u7528\uFF0C\u4E3B\u7BA1\u515C\u91CC\u9762\u53EF\u80FD\u6709\u5F88\u591A\u725B\u903C\u7684\u5DE5\u5177\uFF0C\u4E3A\u4E86\u63D0\u5347\u5C0F\u5F1F\u4EEC\u7684\u5DE5\u4F5C\u6548\u7387\uFF0C\u7ED9\u5C0F\u5F1F\u4EEC\u90FD\u590D\u5236\u4E00\u4E2A\uFF0C\u4E22\u5230\u5C0F\u5F1F\u4EEC\u7684\u515C\u91CC\uFF0C\u7136\u540E\u5C0F\u5F1F\u5C31\u53EF\u4EE5\u4ECE\u81EA\u5DF1\u7684\u515C\u91CC\u62FF\u53BB\u8FD9\u4E9B\u4E1C\u897F\u4F7F\u7528\u4E86\uFF0C\u4E5F\u53EF\u4EE5\u6E05\u7A7A\u81EA\u5DF1\u515C\u91CC\u9762\u7684\u4E1C\u897F\u3002</p><p><code>Thread</code>\u5BF9\u8C61\u4E2D\u6709\u4E2A<code>inheritableThreadLocals</code>\u53D8\u91CF\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ThreadLocal<span class="token punctuation">.</span>ThreadLocalMap</span> inheritableThreadLocals <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>inheritableThreadLocals\u76F8\u5F53\u4E8E\u7EBF\u7A0B\u4E2D\u53E6\u5916\u4E00\u79CD\u515C\uFF0C\u8FD9\u79CD\u515C\u6709\u4EC0\u4E48\u7279\u5F81\u5462\uFF0C\u5F53\u521B\u5EFA\u5B50\u7EBF\u7A0B\u7684\u65F6\u5019\uFF0C\u5B50\u7EBF\u7A0B\u4F1A\u5C06\u7236\u7EBF\u7A0B\u8FD9\u79CD\u7C7B\u578B\u515C\u7684\u4E1C\u897F\u5168\u90E8\u590D\u5236\u4E00\u4EFD\u653E\u5230\u81EA\u5DF1\u7684<code>inheritableThreadLocals</code>\u515C\u4E2D\uFF0C\u4F7F\u7528<code>InheritableThreadLocal</code>\u5BF9\u8C61\u53EF\u4EE5\u64CD\u4F5C\u7EBF\u7A0B\u4E2D\u7684<code>inheritableThreadLocals</code>\u515C\u3002</p><p><code>InheritableThreadLocal</code>\u5E38\u7528\u7684\u65B9\u6CD5\u4E5F\u67093\u4E2A\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//\u5411Thread\u4E2D\u67D0\u4E2A\u53E3\u888B\u4E2D\u653E\u4E1C\u897F</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u83B7\u53D6\u8FD9\u4E2A\u53E3\u888B\u4E2D\u76EE\u524D\u653E\u7684\u4E1C\u897F</span>
<span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//\u6E05\u7A7A\u8FD9\u4E2A\u53E3\u888B\u4E2D\u653E\u7684\u4E1C\u897F</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F7F\u7528<code>InheritableThreadLocal</code>\u89E3\u51B3\u4E0A\u9762\u5B50\u7EBF\u7A0B\u4E2D\u65E0\u6CD5\u8F93\u51FAtraceId\u7684\u95EE\u9898\uFF0C\u53EA\u9700\u8981\u5C06\u4E0A\u4E00\u4E2A\u793A\u4F8B\u4EE3\u7801\u4E2D\u7684<code>ThreadLocal</code>\u66FF\u6362\u6210<code>InheritableThreadLocal</code>\u5373\u53EF\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CountDownLatch</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">LinkedBlockingDeque</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ThreadPoolExecutor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token class-name">AtomicInteger</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * \u8DDF\u7740\u963F\u91CCp7\u5B66\u5E76\u53D1\uFF0C\u5FAE\u4FE1\u516C\u4F17\u53F7\uFF1Ajavacode2018
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo4</span> <span class="token punctuation">{</span>
    <span class="token comment">//\u521B\u5EFA\u4E00\u4E2A\u64CD\u4F5CThread\u4E2D\u5B58\u653E\u8BF7\u6C42\u4EFB\u52A1\u8FFD\u8E2Aid\u53E3\u888B\u7684\u5BF9\u8C61,\u5B50\u7EBF\u7A0B\u53EF\u4EE5\u7EE7\u627F\u7236\u7EBF\u7A0B\u4E2D\u5185\u5BB9</span>
    <span class="token keyword">static</span> <span class="token class-name">InheritableThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> traceIdKD <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InheritableThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">AtomicInteger</span> threadIndex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u521B\u5EFA\u5904\u7406\u8BF7\u6C42\u7684\u7EBF\u7A0B\u6C60\u5B50</span>
    <span class="token keyword">static</span> <span class="token class-name">ThreadPoolExecutor</span> disposeRequestExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token number">60</span><span class="token punctuation">,</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">LinkedBlockingDeque</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            r <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                thread<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">&quot;disposeRequestThread-&quot;</span> <span class="token operator">+</span> threadIndex<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> thread<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//\u8BB0\u5F55\u65E5\u5FD7</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StackTraceElement</span> stack<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Throwable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u83B7\u53D6\u5F53\u524D\u7EBF\u7A0B\u5B58\u653EtranceId\u53E3\u888B\u4E2D\u7684\u5185\u5BB9</span>
        <span class="token class-name">String</span> traceId <span class="token operator">=</span> traceIdKD<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;****&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;[traceId:&quot;</span> <span class="token operator">+</span> traceId <span class="token operator">+</span> <span class="token string">&quot;],[\u7EBF\u7A0B:&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;],&quot;</span> <span class="token operator">+</span> stack<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6A21\u62DFcontroller</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">controller</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u63A5\u53D7\u8BF7\u6C42&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">service</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6A21\u62DFservice</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C\u4E1A\u52A1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">dao</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u6A21\u62DFdao</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">dao</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span>dataList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u6267\u884C\u6570\u636E\u5E93\u64CD\u4F5C&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> threadName <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u6A21\u62DF\u63D2\u5165\u6570\u636E</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> s <span class="token operator">:</span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">//\u6A21\u62DF\u6570\u636E\u5E93\u64CD\u4F5C\u8017\u65F6100\u6BEB\u79D2</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u63D2\u5165\u6570\u636E&quot;</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">&quot;\u6210\u529F,\u4E3B\u7EBF\u7A0B\uFF1A&quot;</span> <span class="token operator">+</span> threadName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//\u7B49\u5F85\u4E0A\u9762\u7684dataList\u5904\u7406\u5B8C\u6BD5</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u9700\u8981\u63D2\u5165\u7684\u6570\u636E</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> dataList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dataList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;\u6570\u636E&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//\u6A21\u62DF5\u4E2A\u8BF7\u6C42</span>
        <span class="token keyword">int</span> requestCount <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> requestCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> traceId <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            disposeRequestExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u628AtraceId\u653E\u5165\u53E3\u888B\u4E2D</span>
                traceIdKD<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>traceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token function">controller</span><span class="token punctuation">(</span>dataList<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    <span class="token comment">//\u5C06tranceId\u4ECE\u53E3\u888B\u4E2D\u79FB\u9664</span>
                    traceIdKD<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        disposeRequestExecutor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5341\u56DB\u3001java\u5BF9\u8C61\u5185\u5B58\u5E03\u5C40\u548C\u5BF9\u8C61\u5934" tabindex="-1"><a class="header-anchor" href="#\u5341\u56DB\u3001java\u5BF9\u8C61\u5185\u5B58\u5E03\u5C40\u548C\u5BF9\u8C61\u5934" aria-hidden="true">#</a> \u5341\u56DB\u3001Java\u5BF9\u8C61\u5185\u5B58\u5E03\u5C40\u548C\u5BF9\u8C61\u5934</h2><h3 id="_1\u3001\u5BF9\u8C61\u5728\u5806\u5185\u5B58\u4E2D\u5E03\u5C40" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5BF9\u8C61\u5728\u5806\u5185\u5B58\u4E2D\u5E03\u5C40" aria-hidden="true">#</a> 1\u3001\u5BF9\u8C61\u5728\u5806\u5185\u5B58\u4E2D\u5E03\u5C40</h3><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927225655948.png" alt="image-20210927225655948"></p><h4 id="_1\u3001\u5BF9\u8C61\u5728\u5806\u5185\u5B58\u4E2D\u7684\u5B58\u50A8\u5E03\u5C40" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5BF9\u8C61\u5728\u5806\u5185\u5B58\u4E2D\u7684\u5B58\u50A8\u5E03\u5C40" aria-hidden="true">#</a> 1\u3001\u5BF9\u8C61\u5728\u5806\u5185\u5B58\u4E2D\u7684\u5B58\u50A8\u5E03\u5C40</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927225734825.png" alt="image-20210927225734825"></p><p>\u5BF9\u8C61\u5185\u90E8\u7ED3\u6784\u5206\u4E3A\uFF1A\u5BF9\u8C61\u5934\u3001\u5B9E\u4F8B\u6570\u636E\u3001\u5BF9\u9F50\u586B\u5145\uFF08\u4FDD\u8BC18\u4E2A\u5B57\u8282\u7684\u500D\u6570\uFF09\u3002 \u5BF9\u8C61\u5934\u5206\u4E3A\u5BF9\u8C61\u6807\u8BB0\uFF08markOop\uFF09\u548C\u7C7B\u5143\u4FE1\u606F\uFF08klassOop\uFF09\uFF0C\u7C7B\u5143\u4FE1\u606F\u5B58\u50A8\u7684\u662F\u6307\u5411\u8BE5\u5BF9\u8C61\u7C7B\u5143\u6570\u636E\uFF08klass\uFF09\u7684\u9996\u5730\u5740\u3002</p><h4 id="_2\u3001\u5BF9\u8C61\u5934" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5BF9\u8C61\u5934" aria-hidden="true">#</a> 2\u3001\u5BF9\u8C61\u5934</h4><h5 id="_1\u3001\u5BF9\u8C61\u6807\u8BB0mark-word" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5BF9\u8C61\u6807\u8BB0mark-word" aria-hidden="true">#</a> 1\u3001\u5BF9\u8C61\u6807\u8BB0Mark Word</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927225858356.png" alt="image-20210927225858356"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927225903931.png" alt="image-20210927225903931"></p><p>\u572864\u4F4D\u7CFB\u7EDF\u4E2D\uFF0CMark Word\u5360\u4E868\u4E2A\u5B57\u8282\uFF0C\u7C7B\u578B\u6307\u9488\u5360\u4E868\u4E2A\u5B57\u8282\uFF0C\u4E00\u5171\u662F16\u4E2A\u5B57\u8282</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927225919957.png" alt="image-20210927225919957"></p><p>\u200B \u9ED8\u8BA4\u5B58\u50A8\u5BF9\u8C61\u7684HashCode\u3001\u5206\u4EE3\u5E74\u9F84\u548C\u9501\u6807\u5FD7\u4F4D\u7B49\u4FE1\u606F\u3002\u8FD9\u4E9B\u4FE1\u606F\u90FD\u662F\u4E0E\u5BF9\u8C61\u81EA\u8EAB\u5B9A\u4E49\u65E0\u5173\u7684\u6570\u636E\uFF0C\u6240\u4EE5MarkWord\u88AB\u8BBE\u8BA1\u6210\u4E00\u4E2A\u975E\u56FA\u5B9A\u7684\u6570\u636E\u7ED3\u6784\u4EE5\u4FBF\u5728\u6781\u5C0F\u7684\u7A7A\u95F4\u5185\u5B58\u5B58\u50A8\u5C3D\u91CF\u591A\u7684\u6570\u636E\u3002\u5B83\u4F1A\u6839\u636E\u5BF9\u8C61\u7684\u72B6\u6001\u590D\u7528\u81EA\u5DF1\u7684\u5B58\u50A8\u7A7A\u95F4\uFF0C\u4E5F\u5C31\u662F\u8BF4\u5728\u8FD0\u884C\u671F\u95F4MarkWord\u91CC\u5B58\u50A8\u7684\u6570\u636E\u4F1A\u968F\u7740\u9501\u6807\u5FD7\u4F4D\u7684\u53D8\u5316\u800C\u53D8\u5316\u3002</p><h5 id="_2\u3001\u7C7B\u5143\u4FE1\u606F-\u53C8\u53EB\u7C7B\u578B\u6307\u9488" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u7C7B\u5143\u4FE1\u606F-\u53C8\u53EB\u7C7B\u578B\u6307\u9488" aria-hidden="true">#</a> 2\u3001\u7C7B\u5143\u4FE1\u606F(\u53C8\u53EB\u7C7B\u578B\u6307\u9488)</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927230011055.png" alt="image-20210927230011055"></p><p>\u5BF9\u8C61\u6307\u5411\u5B83\u7684\u7C7B\u5143\u6570\u636E\u7684\u6307\u9488\uFF0C\u865A\u62DF\u673A\u901A\u8FC7\u8FD9\u4E2A\u6307\u9488\u6765\u786E\u5B9A\u8FD9\u4E2A\u5BF9\u8C61\u662F\u54EA\u4E2A\u7C7B\u7684\u5B9E\u4F8B\u3002</p><h5 id="_3\u3001\u5BF9\u8C61\u5934\u591A\u5927" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5BF9\u8C61\u5934\u591A\u5927" aria-hidden="true">#</a> 3\u3001\u5BF9\u8C61\u5934\u591A\u5927</h5><p>\u572864\u4F4D\u7CFB\u7EDF\u4E2D\uFF0CMark Word\u5360\u4E868\u4E2A\u5B57\u8282\uFF0C\u7C7B\u578B\u6307\u9488\u5360\u4E868\u4E2A\u5B57\u8282\uFF0C\u4E00\u5171\u662F16\u4E2A\u5B57\u8282\u3002</p><h4 id="_3\u3001\u5B9E\u4F8B\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u5B9E\u4F8B\u6570\u636E" aria-hidden="true">#</a> 3\u3001\u5B9E\u4F8B\u6570\u636E</h4><p>\u5B58\u653E\u7C7B\u7684\u5C5E\u6027(Field)\u6570\u636E\u4FE1\u606F\uFF0C\u5305\u62EC\u7236\u7C7B\u7684\u5C5E\u6027\u4FE1\u606F\uFF0C\u5982\u679C\u662F\u6570\u7EC4\u7684\u5B9E\u4F8B\u90E8\u5206\u8FD8\u5305\u62EC\u6570\u7EC4\u7684\u957F\u5EA6\uFF0C\u8FD9\u90E8\u5206\u5185\u5B58\u63094\u5B57\u8282\u5BF9\u9F50\u3002</p><h4 id="_4\u3001\u5BF9\u9F50\u586B\u5145" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u5BF9\u9F50\u586B\u5145" aria-hidden="true">#</a> 4\u3001\u5BF9\u9F50\u586B\u5145</h4><p>\u865A\u62DF\u673A\u8981\u6C42\u5BF9\u8C61\u8D77\u59CB\u5730\u5740\u5FC5\u987B\u662F8\u5B57\u8282\u7684\u6574\u6570\u500D\u3002\u586B\u5145\u6570\u636E\u4E0D\u662F\u5FC5\u987B\u5B58\u5728\u7684\uFF0C\u4EC5\u4EC5\u662F\u4E3A\u4E86\u5B57\u8282\u5BF9\u9F50\u8FD9\u90E8\u5206\u5185\u5B58\u63098\u5B57\u8282\u8865\u5145\u5BF9\u9F50\u3002</p>`,1320),v={href:"http://openjdk.java.net/groups/hotspot/docs/HotSpotGlossary.html",target:"_blank",rel:"noopener noreferrer"},b=s("http://openjdk.java.net/groups/hotspot/docs/HotSpotGlossary.html"),g={href:"http://hg.openjdk.java.net/jdk8u/jdk8u/hotspot/file/89fb452b3688/src/share/vm/oops/oop.hpp",target:"_blank",rel:"noopener noreferrer"},h=s("http://hg.openjdk.java.net/jdk8u/jdk8u/hotspot/file/89fb452b3688/src/share/vm/oops/oop.hpp"),y=t(`<p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927230137020.png" alt="image-20210927230137020"></p><p>_mark\u5B57\u6BB5\u662Fmark word\uFF0C_metadata\u662F\u7C7B\u6307\u9488klass pointer\uFF0C \u5BF9\u8C61\u5934\uFF08object header\uFF09\u5373\u662F\u7531\u8FD9\u4E24\u4E2A\u5B57\u6BB5\u7EC4\u6210\uFF0C\u8FD9\u4E9B\u672F\u8BED\u53EF\u4EE5\u53C2\u8003Hotspot\u672F\u8BED\u8868\uFF0C</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927230150668.png" alt="image-20210927230150668"></p><h3 id="_2\u3001markword" tabindex="-1"><a class="header-anchor" href="#_2\u3001markword" aria-hidden="true">#</a> 2\u3001MarkWord</h3><h4 id="_1\u3001oop-hpp" tabindex="-1"><a class="header-anchor" href="#_1\u3001oop-hpp" aria-hidden="true">#</a> 1\u3001oop.hpp</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927230137020.png" alt="image-20210927230137020"></p><h4 id="_2\u3001markoop-hpp" tabindex="-1"><a class="header-anchor" href="#_2\u3001markoop-hpp" aria-hidden="true">#</a> 2\u3001markOop.hpp</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>hash\uFF1A \u4FDD\u5B58\u5BF9\u8C61\u7684\u54C8\u5E0C\u7801
age\uFF1A \u4FDD\u5B58\u5BF9\u8C61\u7684\u5206\u4EE3\u5E74\u9F84
biased_lock\uFF1A \u504F\u5411\u9501\u6807\u8BC6\u4F4D
lock\uFF1A \u9501\u72B6\u6001\u6807\u8BC6\u4F4D
JavaThread* \uFF1A\u4FDD\u5B58\u6301\u6709\u504F\u5411\u9501\u7684\u7EBF\u7A0BID
epoch\uFF1A \u4FDD\u5B58\u504F\u5411\u65F6\u95F4\u6233
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927230308057.png" alt="image-20210927230308057"></p><p>markword(64\u4F4D)\u5206\u5E03\u56FE\uFF0C\u5BF9\u8C61\u5E03\u5C40\u3001GC\u56DE\u6536\u548C\u540E\u9762\u7684\u9501\u5347\u7EA7\u5C31\u662F\u5BF9\u8C61\u6807\u8BB0MarkWord\u91CC\u9762\u6807\u5FD7\u4F4D\u7684\u53D8\u5316</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927230321279.png" alt="image-20210927230321279"></p><h3 id="_3\u3001\u804A\u804Aobject-obj-new-object" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u804A\u804Aobject-obj-new-object" aria-hidden="true">#</a> 3\u3001\u804A\u804AObject obj = new Object()</h3><h4 id="_1\u3001jol\u8BC1\u660E" tabindex="-1"><a class="header-anchor" href="#_1\u3001jol\u8BC1\u660E" aria-hidden="true">#</a> 1\u3001JOL\u8BC1\u660E</h4>`,13),w={href:"http://openjdk.java.net/projects/code-tools/jol/",target:"_blank",rel:"noopener noreferrer"},f=s("http://openjdk.java.net/projects/code-tools/jol/"),S=t(`<div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!--
\u5B98\u7F51\uFF1Ahttp://openjdk.java.net/projects/code-tools/jol/
\u5B9A\u4F4D\uFF1A\u5206\u6790\u5BF9\u8C61\u5728JVM\u7684\u5927\u5C0F\u548C\u5206\u5E03
--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.openjdk.jol<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jol-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyObject</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//VM\u7684\u7EC6\u8282\u8BE6\u7EC6\u60C5\u51B5</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>VM<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">details</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u6240\u6709\u7684\u5BF9\u8C61\u5206\u914D\u7684\u5B57\u8282\u90FD\u662F8\u7684\u6574\u6570\u500D\u3002</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>VM<span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">objectAlignment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927230415577.png" alt="image-20210927230415577"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JOLDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927230442184.png" alt="image-20210927230442184"></p><table><thead><tr><th>OFFSET</th><th>\u504F\u79FB\u91CF\uFF0C\u4E5F\u5C31\u662F\u5230\u8FD9\u4E2A\u5B57\u6BB5\u4F4D\u7F6E\u6240\u5360\u7528\u7684byte\u6570</th></tr></thead><tbody><tr><td>SIZE</td><td>\u540E\u9762\u7C7B\u578B\u7684\u5B57\u8282\u5927\u5C0F</td></tr><tr><td>TYPE</td><td>\u662FClass\u4E2D\u5B9A\u4E49\u7684\u7C7B\u578B</td></tr><tr><td>DESCRIPTION</td><td>DESCRIPTION\u662F\u7C7B\u578B\u7684\u63CF\u8FF0</td></tr><tr><td>VALUE</td><td>VALUE\u662FTYPE\u5728\u5185\u5B58\u4E2D\u7684\u503C</td></tr></tbody></table><p><strong>GC\u5E74\u9F84\u91C7\u75284\u4F4Dbit\u5B58\u50A8\uFF0C\u6700\u5927\u4E3A15\uFF0C\u4F8B\u5982MaxTenuringThreshold\u53C2\u6570\u9ED8\u8BA4\u503C\u5C31\u662F15</strong></p><p>-XX:MaxTenuringThreshold=16</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927230617433.png" alt="image-20210927230617433"></p><h4 id="_2\u3001\u9ED8\u8BA4\u5F00\u542F\u538B\u7F29\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u9ED8\u8BA4\u5F00\u542F\u538B\u7F29\u8BF4\u660E" aria-hidden="true">#</a> 2\u3001\u9ED8\u8BA4\u5F00\u542F\u538B\u7F29\u8BF4\u660E</h4><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>java -XX:+PrintCommandLineFlags -version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927230700348.png" alt="image-20210927230700348"></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-XX:+UseCompressedClassPointers
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927230717948.png" alt="image-20210927230717948"></p><p>\u4E0A\u8FF0\u8868\u793A\u5F00\u542F\u4E86\u7C7B\u578B\u6307\u9488\u7684\u538B\u7F29\uFF0C\u4EE5\u8282\u7EA6\u7A7A\u95F4\uFF0C\u5047\u5982\u4E0D\u52A0\u538B\u7F29\uFF1F\uFF1F\uFF1F</p><p><strong>\u624B\u52A8\u5173\u95ED\u538B\u7F29\u518D\u770B\u770B</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>-XX:-UseCompressedClassPointers
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927230743485.png" alt="image-20210927230743485"></p><h3 id="_4\u3001\u6362\u6210\u5176\u4ED6\u5BF9\u8C61\u8BD5\u8BD5" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u6362\u6210\u5176\u4ED6\u5BF9\u8C61\u8BD5\u8BD5" aria-hidden="true">#</a> 4\u3001\u6362\u6210\u5176\u4ED6\u5BF9\u8C61\u8BD5\u8BD5</h3><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927230805766.png" alt="image-20210927230805766"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210927230808775.png" alt="image-20210927230808775"></p><h2 id="\u5341\u4E94\u3001synchronized\u4E0E\u9501\u5347\u7EA7" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E94\u3001synchronized\u4E0E\u9501\u5347\u7EA7" aria-hidden="true">#</a> \u5341\u4E94\u3001Synchronized\u4E0E\u9501\u5347\u7EA7</h2><h3 id="_1\u3001synchronized-\u9501\u4F18\u5316\u7684\u80CC\u666F" tabindex="-1"><a class="header-anchor" href="#_1\u3001synchronized-\u9501\u4F18\u5316\u7684\u80CC\u666F" aria-hidden="true">#</a> 1\u3001Synchronized \u9501\u4F18\u5316\u7684\u80CC\u666F</h3><p>\u7528\u9501\u80FD\u591F\u5B9E\u73B0\u6570\u636E\u7684\u5B89\u5168\u6027\uFF0C\u4F46\u662F\u4F1A\u5E26\u6765\u6027\u80FD\u4E0B\u964D\u3002 \u65E0\u9501\u80FD\u591F\u57FA\u4E8E\u7EBF\u7A0B\u5E76\u884C\u63D0\u5347\u7A0B\u5E8F\u6027\u80FD\uFF0C\u4F46\u662F\u4F1A\u5E26\u6765\u5B89\u5168\u6027\u4E0B\u964D\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929210812273.png" alt="image-20210929210812273"></p><p>synchronized\u9501\uFF1A\u7531\u5BF9\u8C61\u5934\u4E2D\u7684Mark Word\u6839\u636E\u9501\u6807\u5FD7\u4F4D\u7684\u4E0D\u540C\u800C\u88AB\u590D\u7528\u53CA\u9501\u5347\u7EA7\u7B56\u7565</p><h3 id="_2\u3001synchronized\u7684\u6027\u80FD\u53D8\u5316" tabindex="-1"><a class="header-anchor" href="#_2\u3001synchronized\u7684\u6027\u80FD\u53D8\u5316" aria-hidden="true">#</a> 2\u3001Synchronized\u7684\u6027\u80FD\u53D8\u5316</h3><p>java5\u4EE5\u524D\uFF0C\u53EA\u6709Synchronized\uFF0C\u8FD9\u4E2A\u662F\u64CD\u4F5C\u7CFB\u7EDF\u7EA7\u522B\u7684\u91CD\u91CF\u7EA7\u64CD\u4F5C\uFF0C\u91CD\u91CF\u7EA7\u9501\uFF0C\u5047\u5982\u9501\u7684\u7ADE\u4E89\u6BD4\u8F83\u6FC0\u70C8\u7684\u8BDD\uFF0C\u6027\u80FD\u4E0B\u964D</p><h4 id="_1\u3001java5\u4E4B\u524D-\u7528\u6237\u6001\u548C\u5185\u6838\u6001\u4E4B\u95F4\u7684\u5207\u6362" tabindex="-1"><a class="header-anchor" href="#_1\u3001java5\u4E4B\u524D-\u7528\u6237\u6001\u548C\u5185\u6838\u6001\u4E4B\u95F4\u7684\u5207\u6362" aria-hidden="true">#</a> 1\u3001Java5\u4E4B\u524D\uFF0C\u7528\u6237\u6001\u548C\u5185\u6838\u6001\u4E4B\u95F4\u7684\u5207\u6362</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929210932836.png" alt="image-20210929210932836"></p><p>\u200B java\u7684\u7EBF\u7A0B\u662F\u6620\u5C04\u5230\u64CD\u4F5C\u7CFB\u7EDF\u539F\u751F\u7EBF\u7A0B\u4E4B\u4E0A\u7684\uFF0C\u5982\u679C\u8981\u963B\u585E\u6216\u5524\u9192\u4E00\u4E2A\u7EBF\u7A0B\u5C31\u9700\u8981\u64CD\u4F5C\u7CFB\u7EDF\u4ECB\u5165\uFF0C\u9700\u8981\u5728\u6237\u6001\u4E0E\u6838\u5FC3\u6001\u4E4B\u95F4\u5207\u6362\uFF0C\u8FD9\u79CD\u5207\u6362\u4F1A\u6D88\u8017\u5927\u91CF\u7684\u7CFB\u7EDF\u8D44\u6E90\uFF0C\u56E0\u4E3A\u7528\u6237\u6001\u4E0E\u5185\u6838\u6001\u90FD\u6709\u5404\u81EA\u4E13\u7528\u7684\u5185\u5B58\u7A7A\u95F4\uFF0C\u4E13\u7528\u7684\u5BC4\u5B58\u5668\u7B49\uFF0C\u7528\u6237\u6001\u5207\u6362\u81F3\u5185\u6838\u6001\u9700\u8981\u4F20\u9012\u7ED9\u8BB8\u591A\u53D8\u91CF\u3001\u53C2\u6570\u7ED9\u5185\u6838\uFF0C\u5185\u6838\u4E5F\u9700\u8981\u4FDD\u62A4\u597D\u7528\u6237\u6001\u5728\u5207\u6362\u65F6\u7684\u4E00\u4E9B\u5BC4\u5B58\u5668\u503C\u3001\u53D8\u91CF\u7B49\uFF0C\u4EE5\u4FBF\u5185\u6838\u6001\u8C03\u7528\u7ED3\u675F\u540E\u5207\u6362\u56DE\u7528\u6237\u6001\u7EE7\u7EED\u5DE5\u4F5C\u3002</p><p>\u200B \u5728Java\u65E9\u671F\u7248\u672C\u4E2D\uFF0Csynchronized\u5C5E\u4E8E\u91CD\u91CF\u7EA7\u9501\uFF0C\u6548\u7387\u4F4E\u4E0B\uFF0C\u56E0\u4E3A\u76D1\u89C6\u5668\u9501\uFF08monitor\uFF09\u662F\u4F9D\u8D56\u4E8E\u5E95\u5C42\u7684\u64CD\u4F5C\u7CFB\u7EDF\u7684Mutex Lock\u6765\u5B9E\u73B0\u7684\uFF0C\u6302\u8D77\u7EBF\u7A0B\u548C\u6062\u590D\u7EBF\u7A0B\u90FD\u9700\u8981\u8F6C\u5165\u5185\u6838\u6001\u53BB\u5B8C\u6210\uFF0C\u963B\u585E\u6216\u5524\u9192\u4E00\u4E2AJava\u7EBF\u7A0B\u9700\u8981\u64CD\u4F5C\u7CFB\u7EDF\u5207\u6362CPU\u72B6\u6001\u6765\u5B8C\u6210\uFF0C\u8FD9\u79CD\u72B6\u6001\u5207\u6362\u9700\u8981\u8017\u8D39\u5904\u7406\u5668\u65F6\u95F4\uFF0C\u5982\u679C\u540C\u6B65\u4EE3\u7801\u5757\u4E2D\u5185\u5BB9\u8FC7\u4E8E\u7B80\u5355\uFF0C\u8FD9\u79CD\u5207\u6362\u7684\u65F6\u95F4\u53EF\u80FD\u6BD4\u7528\u6237\u4EE3\u7801\u6267\u884C\u7684\u65F6\u95F4\u8FD8\u957F\u201D\uFF0C\u65F6\u95F4\u6210\u672C\u76F8\u5BF9\u8F83\u9AD8\uFF0C\u8FD9\u4E5F\u662F\u4E3A\u4EC0\u4E48\u65E9\u671F\u7684synchronized\u6548\u7387\u4F4E\u7684\u539F\u56E0 Java 6\u4E4B\u540E\uFF0C\u4E3A\u4E86\u51CF\u5C11\u83B7\u5F97\u9501\u548C\u91CA\u653E\u9501\u6240\u5E26\u6765\u7684\u6027\u80FD\u6D88\u8017\uFF0C\u5F15\u5165\u4E86\u8F7B\u91CF\u7EA7\u9501\u548C\u504F\u5411\u9501</p><h4 id="_2\u3001\u4E3A\u4EC0\u4E48\u6BCF\u4E00\u4E2A\u5BF9\u8C61\u90FD\u53EF\u4EE5\u6210\u4E3A\u4E00\u4E2A\u9501" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u4E3A\u4EC0\u4E48\u6BCF\u4E00\u4E2A\u5BF9\u8C61\u90FD\u53EF\u4EE5\u6210\u4E3A\u4E00\u4E2A\u9501" aria-hidden="true">#</a> 2\u3001\u4E3A\u4EC0\u4E48\u6BCF\u4E00\u4E2A\u5BF9\u8C61\u90FD\u53EF\u4EE5\u6210\u4E3A\u4E00\u4E2A\u9501\uFF1F\uFF1F\uFF1F\uFF1F</h4><p>markOop.hpp</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929211015422.png" alt="image-20210929211015422"></p><p>\u200B Monitor\u53EF\u4EE5\u7406\u89E3\u4E3A\u4E00\u79CD\u540C\u6B65\u5DE5\u5177\uFF0C\u4E5F\u53EF\u7406\u89E3\u4E3A\u4E00\u79CD\u540C\u6B65\u673A\u5236\uFF0C\u5E38\u5E38\u88AB\u63CF\u8FF0\u4E3A\u4E00\u4E2AJava\u5BF9\u8C61\u3002Java\u5BF9\u8C61\u662F\u5929\u751F\u7684Monitor\uFF0C\u6BCF\u4E00\u4E2AJava\u5BF9\u8C61\u90FD\u6709\u6210\u4E3AMonitor\u7684\u6F5C\u8D28\uFF0C\u56E0\u4E3A\u5728Java\u7684\u8BBE\u8BA1\u4E2D \uFF0C\u6BCF\u4E00\u4E2AJava\u5BF9\u8C61\u81EA\u6253\u5A18\u80CE\u91CC\u51FA\u6765\u5C31\u5E26\u4E86\u4E00\u628A\u770B\u4E0D\u89C1\u7684\u9501\uFF0C\u5B83\u53EB\u505A\u5185\u90E8\u9501\u6216\u8005Monitor\u9501\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929211037543.png" alt="image-20210929211037543"></p><p>Monitor\u7684\u672C\u8D28\u662F\u4F9D\u8D56\u4E8E\u5E95\u5C42\u64CD\u4F5C\u7CFB\u7EDF\u7684Mutex Lock\u5B9E\u73B0\uFF0C\u64CD\u4F5C\u7CFB\u7EDF\u5B9E\u73B0\u7EBF\u7A0B\u4E4B\u95F4\u7684\u5207\u6362\u9700\u8981\u4ECE\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u7684\u8F6C\u6362\uFF0C\u6210\u672C\u975E\u5E38\u9AD8\u3002</p><p>Monitor(\u76D1\u89C6\u5668\u9501)</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929211107964.png" alt="image-20210929211107964"></p><p>Mutex Lock Monitor\u662F\u5728jvm\u5E95\u5C42\u5B9E\u73B0\u7684\uFF0C\u5E95\u5C42\u4EE3\u7801\u662Fc++\u3002\u672C\u8D28\u662F\u4F9D\u8D56\u4E8E\u5E95\u5C42\u64CD\u4F5C\u7CFB\u7EDF\u7684Mutex Lock\u5B9E\u73B0\uFF0C\u64CD\u4F5C\u7CFB\u7EDF\u5B9E\u73B0\u7EBF\u7A0B\u4E4B\u95F4\u7684\u5207\u6362\u9700\u8981\u4ECE\u7528\u6237\u6001\u5230\u5185\u6838\u6001\u7684\u8F6C\u6362\uFF0C\u72B6\u6001\u8F6C\u6362\u9700\u8981\u8017\u8D39\u5F88\u591A\u7684\u5904\u7406\u5668\u65F6\u95F4\u6210\u672C\u975E\u5E38\u9AD8\u3002\u6240\u4EE5synchronized\u662FJava\u8BED\u8A00\u4E2D\u7684\u4E00\u4E2A\u91CD\u91CF\u7EA7\u64CD\u4F5C\u3002</p><p>Monitor\u4E0Ejava\u5BF9\u8C61\u4EE5\u53CA\u7EBF\u7A0B\u662F\u5982\u4F55\u5173\u8054 \uFF1F 1.\u5982\u679C\u4E00\u4E2Ajava\u5BF9\u8C61\u88AB\u67D0\u4E2A\u7EBF\u7A0B\u9501\u4F4F\uFF0C\u5219\u8BE5java\u5BF9\u8C61\u7684Mark Word\u5B57\u6BB5\u4E2DLockWord\u6307\u5411monitor\u7684\u8D77\u59CB\u5730\u5740 2.Monitor\u7684Owner\u5B57\u6BB5\u4F1A\u5B58\u653E\u62E5\u6709\u76F8\u5173\u8054\u5BF9\u8C61\u9501\u7684\u7EBF\u7A0Bid</p><p>Mutex Lock \u7684\u5207\u6362\u9700\u8981\u4ECE\u7528\u6237\u6001\u8F6C\u6362\u5230\u6838\u5FC3\u6001\u4E2D\uFF0C\u56E0\u6B64\u72B6\u6001\u8F6C\u6362\u9700\u8981\u8017\u8D39\u5F88\u591A\u7684\u5904\u7406\u5668\u65F6\u95F4\u3002</p><h4 id="_3\u3001java6\u5F00\u59CB-\u4F18\u5316synchronized" tabindex="-1"><a class="header-anchor" href="#_3\u3001java6\u5F00\u59CB-\u4F18\u5316synchronized" aria-hidden="true">#</a> 3\u3001java6\u5F00\u59CB\uFF0C\u4F18\u5316Synchronized</h4><p>Java 6\u4E4B\u540E\uFF0C\u4E3A\u4E86\u51CF\u5C11\u83B7\u5F97\u9501\u548C\u91CA\u653E\u9501\u6240\u5E26\u6765\u7684\u6027\u80FD\u6D88\u8017\uFF0C\u5F15\u5165\u4E86\u8F7B\u91CF\u7EA7\u9501\u548C\u504F\u5411\u9501</p><p>\u9700\u8981\u6709\u4E2A\u9010\u6B65\u5347\u7EA7\u7684\u8FC7\u7A0B\uFF0C\u522B\u4E00\u5F00\u59CB\u5C31\u6345\u5230\u91CD\u91CF\u7EA7\u9501</p><h3 id="_3\u3001synchronized\u9501\u79CD\u7C7B\u53CA\u5347\u7EA7\u6B65\u9AA4" tabindex="-1"><a class="header-anchor" href="#_3\u3001synchronized\u9501\u79CD\u7C7B\u53CA\u5347\u7EA7\u6B65\u9AA4" aria-hidden="true">#</a> 3\u3001Synchronized\u9501\u79CD\u7C7B\u53CA\u5347\u7EA7\u6B65\u9AA4</h3><h4 id="_1\u3001\u591A\u7EBF\u7A0B\u8BBF\u95EE\u60C5\u51B5-3\u79CD" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u591A\u7EBF\u7A0B\u8BBF\u95EE\u60C5\u51B5-3\u79CD" aria-hidden="true">#</a> 1\u3001\u591A\u7EBF\u7A0B\u8BBF\u95EE\u60C5\u51B5\uFF0C3\u79CD</h4><ul><li>\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B\u6765\u8BBF\u95EE\uFF0C\u6709\u4E14\u552F\u4E00Only One</li><li>\u67092\u4E2A\u7EBF\u7A0BA\u3001B\u6765\u4EA4\u66FF\u8BBF\u95EE</li><li>\u7ADE\u4E89\u6FC0\u70C8\uFF0C\u591A\u4E2A\u7EBF\u7A0B\u6765\u8BBF\u95EE</li></ul><h4 id="_2\u3001\u5347\u7EA7\u6D41\u7A0B" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5347\u7EA7\u6D41\u7A0B" aria-hidden="true">#</a> 2\u3001\u5347\u7EA7\u6D41\u7A0B</h4><p>synchronized\u7528\u7684\u9501\u662F\u5B58\u5728Java\u5BF9\u8C61\u5934\u91CC\u7684Mark Word\u4E2D\u9501\u5347\u7EA7\u529F\u80FD\u4E3B\u8981\u4F9D\u8D56MarkWord\u4E2D\u9501\u6807\u5FD7\u4F4D\u548C\u91CA\u653E\u504F\u5411\u9501\u6807\u5FD7\u4F4D</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929211353978.png" alt="image-20210929211353978"></p><h4 id="_3\u3001\u65E0\u9501" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u65E0\u9501" aria-hidden="true">#</a> 3\u3001\u65E0\u9501</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyObject</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;10\u8FDB\u5236hash\u7801\uFF1A&quot;</span><span class="token operator">+</span>o<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;16\u8FDB\u5236hash\u7801\uFF1A&quot;</span><span class="token operator">+</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;2\u8FDB\u5236hash\u7801\uFF1A&quot;</span><span class="token operator">+</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toBinaryString</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span> <span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929211429008.png" alt="image-20210929211429008"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929211444490.png" alt="image-20210929211444490"></p><h4 id="_4\u3001\u504F\u5411\u9501" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u504F\u5411\u9501" aria-hidden="true">#</a> 4\u3001\u504F\u5411\u9501</h4><ul><li>\u5F53\u4E00\u6BB5\u540C\u6B65\u4EE3\u7801\u4E00\u76F4\u88AB\u540C\u4E00\u4E2A\u7EBF\u7A0B\u591A\u6B21\u8BBF\u95EE\uFF0C\u7531\u4E8E\u53EA\u6709\u4E00\u4E2A\u7EBF\u7A0B\u90A3\u4E48\u8BE5\u7EBF\u7A0B\u5728\u540E\u7EED\u8BBF\u95EE\u65F6\u4FBF\u4F1A\u81EA\u52A8\u83B7\u5F97\u9501</li><li>\u540C\u4E00\u4E2A\u8001\u987E\u5BA2\u6765\u8BBF\uFF0C\u76F4\u63A5\u8001\u89C4\u77E9\u884C\u65B9\u4FBF</li></ul><blockquote><p>Hotspot \u7684\u4F5C\u8005\u7ECF\u8FC7\u7814\u7A76\u53D1\u73B0\uFF0C\u5927\u591A\u6570\u60C5\u51B5\u4E0B\uFF1A</p><p>\u591A\u7EBF\u7A0B\u7684\u60C5\u51B5\u4E0B\uFF0C\u9501\u4E0D\u4EC5\u4E0D\u5B58\u5728\u591A\u7EBF\u7A0B\u7ADE\u4E89\uFF0C\u8FD8\u5B58\u5728\u9501\u7531\u540C\u4E00\u7EBF\u7A0B\u591A\u6B21\u83B7\u5F97\u7684\u60C5\u51B5\uFF0C</p><p>\u504F\u5411\u9501\u5C31\u662F\u5728\u8FD9\u79CD\u60C5\u51B5\u4E0B\u51FA\u73B0\u7684\uFF0C\u5B83\u7684\u51FA\u73B0\u662F\u4E3A\u4E86\u89E3\u51B3\u53EA\u6709\u5728\u4E00\u4E2A\u7EBF\u7A0B\u6267\u884C\u540C\u6B65\u65F6\u63D0\u9AD8\u6027\u80FD\u3002</p></blockquote><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929211553962.png" alt="image-20210929211553962"></p><p>\u901A\u8FC7CAS\u65B9\u5F0F\u4FEE\u6539markword\u4E2D\u7684\u7EBF\u7A0BID</p><h5 id="_1\u3001\u504F\u5411\u9501\u7684\u6301\u6709" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u504F\u5411\u9501\u7684\u6301\u6709" aria-hidden="true">#</a> 1\u3001\u504F\u5411\u9501\u7684\u6301\u6709</h5><p>\u7406\u8BBA\u843D\u5730\uFF1A \u5728\u5B9E\u9645\u5E94\u7528\u8FD0\u884C\u8FC7\u7A0B\u4E2D\u53D1\u73B0\uFF0C\u201C\u9501\u603B\u662F\u540C\u4E00\u4E2A\u7EBF\u7A0B\u6301\u6709\uFF0C\u5F88\u5C11\u53D1\u751F\u7ADE\u4E89\u201D\uFF0C\u4E5F\u5C31\u662F\u8BF4\u9501\u603B\u662F\u88AB\u7B2C\u4E00\u4E2A\u5360\u7528\u4ED6\u7684\u7EBF\u7A0B\u62E5\u6709\uFF0C\u8FD9\u4E2A\u7EBF\u7A0B\u5C31\u662F\u9501\u7684\u504F\u5411\u7EBF\u7A0B\u3002</p><p>\u200B \u90A3\u4E48\u53EA\u9700\u8981\u5728\u9501\u7B2C\u4E00\u6B21\u88AB\u62E5\u6709\u7684\u65F6\u5019\uFF0C\u8BB0\u5F55\u4E0B\u504F\u5411\u7EBF\u7A0BID\u3002\u8FD9\u6837\u504F\u5411\u7EBF\u7A0B\u5C31\u4E00\u76F4\u6301\u6709\u7740\u9501(\u540E\u7EED\u8FD9\u4E2A\u7EBF\u7A0B\u8FDB\u5165\u548C\u9000\u51FA\u8FD9\u6BB5\u52A0\u4E86\u540C\u6B65\u9501\u7684\u4EE3\u7801\u5757\u65F6\uFF0C\u4E0D\u9700\u8981\u518D\u6B21\u52A0\u9501\u548C\u91CA\u653E\u9501\u3002\u800C\u662F\u76F4\u63A5\u6BD4\u8F83\u5BF9\u8C61\u5934\u91CC\u9762\u662F\u5426\u5B58\u50A8\u4E86\u6307\u5411\u5F53\u524D\u7EBF\u7A0B\u7684\u504F\u5411\u9501)\u3002 \u5982\u679C\u76F8\u7B49\u8868\u793A\u504F\u5411\u9501\u662F\u504F\u5411\u4E8E\u5F53\u524D\u7EBF\u7A0B\u7684\uFF0C\u5C31\u4E0D\u9700\u8981\u518D\u5C1D\u8BD5\u83B7\u5F97\u9501\u4E86\uFF0C\u76F4\u5230\u7ADE\u4E89\u53D1\u751F\u624D\u91CA\u653E\u9501\u3002\u4EE5\u540E\u6BCF\u6B21\u540C\u6B65\uFF0C\u68C0\u67E5\u9501\u7684\u504F\u5411\u7EBF\u7A0BID\u4E0E\u5F53\u524D\u7EBF\u7A0BID\u662F\u5426\u4E00\u81F4\uFF0C\u5982\u679C\u4E00\u81F4\u76F4\u63A5\u8FDB\u5165\u540C\u6B65\u3002\u65E0\u9700\u6BCF\u6B21\u52A0\u9501\u89E3\u9501\u90FD\u53BBCAS\u66F4\u65B0\u5BF9\u8C61\u5934\u3002\u5982\u679C\u81EA\u59CB\u81F3\u7EC8\u4F7F\u7528\u9501\u7684\u7EBF\u7A0B\u53EA\u6709\u4E00\u4E2A\uFF0C\u5F88\u660E\u663E\u504F\u5411\u9501\u51E0\u4E4E\u6CA1\u6709\u989D\u5916\u5F00\u9500\uFF0C\u6027\u80FD\u6781\u9AD8\u3002</p><p>\u200B \u5047\u5982\u4E0D\u4E00\u81F4\u610F\u5473\u7740\u53D1\u751F\u4E86\u7ADE\u4E89\uFF0C\u9501\u5DF2\u7ECF\u4E0D\u662F\u603B\u662F\u504F\u5411\u4E8E\u540C\u4E00\u4E2A\u7EBF\u7A0B\u4E86\uFF0C\u8FD9\u65F6\u5019\u53EF\u80FD\u9700\u8981\u5347\u7EA7\u53D8\u4E3A\u8F7B\u91CF\u7EA7\u9501\uFF0C\u624D\u80FD\u4FDD\u8BC1\u7EBF\u7A0B\u95F4\u516C\u5E73\u7ADE\u4E89\u9501\u3002\u504F\u5411\u9501\u53EA\u6709\u9047\u5230\u5176\u4ED6\u7EBF\u7A0B\u5C1D\u8BD5\u7ADE\u4E89\u504F\u5411\u9501\u65F6\uFF0C\u6301\u6709\u504F\u5411\u9501\u7684\u7EBF\u7A0B\u624D\u4F1A\u91CA\u653E\u9501\uFF0C\u7EBF\u7A0B\u662F\u4E0D\u4F1A\u4E3B\u52A8\u91CA\u653E\u504F\u5411\u9501\u7684\u3002</p><p>\u6280\u672F\u5B9E\u73B0\uFF1A \u4E00\u4E2Asynchronized\u65B9\u6CD5\u88AB\u4E00\u4E2A\u7EBF\u7A0B\u62A2\u5230\u4E86\u9501\u65F6\uFF0C\u90A3\u8FD9\u4E2A\u65B9\u6CD5\u6240\u5728\u7684\u5BF9\u8C61\u5C31\u4F1A\u5728\u5176\u6240\u5728\u7684Mark Word\u4E2D\u5C06\u504F\u5411\u9501\u4FEE\u6539\u72B6\u6001\u4F4D\uFF0C\u540C\u65F6\u8FD8 \u4F1A\u6709\u5360\u7528\u524D54\u4F4D\u6765\u5B58\u50A8\u7EBF\u7A0B\u6307\u9488\u4F5C\u4E3A\u6807\u8BC6\u3002\u82E5\u8BE5\u7EBF\u7A0B\u518D\u6B21\u8BBF\u95EE\u540C\u4E00\u4E2Asynchronized\u65B9\u6CD5\u65F6\uFF0C\u8BE5\u7EBF\u7A0B\u53EA\u9700\u53BB\u5BF9\u8C61\u5934\u7684Mark Word \u4E2D\u53BB\u5224\u65AD\u4E00\u4E0B\u662F\u5426\u6709\u504F\u5411\u9501\u6307\u5411\u672C\u8EAB\u7684ID\uFF0C\u65E0\u9700\u518D\u8FDB\u5165 Monitor \u53BB\u7ADE\u4E89\u5BF9\u8C61\u4E86\u3002</p><h5 id="_2\u3001\u7EC6\u5316\u6848\u4F8Baccount\u5BF9\u8C61\u4E3E\u4F8B\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u7EC6\u5316\u6848\u4F8Baccount\u5BF9\u8C61\u4E3E\u4F8B\u8BF4\u660E" aria-hidden="true">#</a> 2\u3001\u7EC6\u5316\u6848\u4F8BAccount\u5BF9\u8C61\u4E3E\u4F8B\u8BF4\u660E</h5><p>\u504F\u5411\u9501\u7684\u64CD\u4F5C\u4E0D\u7528\u76F4\u63A5\u6345\u5230\u64CD\u4F5C\u7CFB\u7EDF\uFF0C\u4E0D\u6D89\u53CA\u7528\u6237\u5230\u5185\u6838\u8F6C\u6362\uFF0C\u4E0D\u5FC5\u8981\u76F4\u63A5\u5347\u7EA7\u4E3A\u6700\u9AD8\u7EA7\uFF0C\u6211\u4EEC\u4EE5\u4E00\u4E2Aaccount\u5BF9\u8C61\u7684\u201C\u5BF9\u8C61\u5934\u201D\u4E3A\u4F8B\uFF0C</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929211754329.png" alt="image-20210929211754329"></p><p>\u200B \u5047\u5982\u6709\u4E00\u4E2A\u7EBF\u7A0B\u6267\u884C\u5230synchronized\u4EE3\u7801\u5757\u7684\u65F6\u5019\uFF0CJVM\u4F7F\u7528CAS\u64CD\u4F5C\u628A\u7EBF\u7A0B\u6307\u9488ID\u8BB0\u5F55\u5230Mark Word\u5F53\u4E2D\uFF0C\u5E76\u4FEE\u6539\u6807\u504F\u5411\u6807\u793A\uFF0C\u6807\u793A\u5F53\u524D\u7EBF\u7A0B\u5C31\u83B7\u5F97\u8BE5\u9501\u3002\u9501\u5BF9\u8C61\u53D8\u6210\u504F\u5411\u9501\uFF08\u901A\u8FC7CAS\u4FEE\u6539\u5BF9\u8C61\u5934\u91CC\u7684\u9501\u6807\u5FD7\u4F4D\uFF09\uFF0C\u5B57\u9762\u610F\u601D\u662F\u201C\u504F\u5411\u4E8E\u7B2C\u4E00\u4E2A\u83B7\u5F97\u5B83\u7684\u7EBF\u7A0B\u201D\u7684\u9501\u3002\u6267\u884C\u5B8C\u540C\u6B65\u4EE3\u7801\u5757\u540E\uFF0C\u7EBF\u7A0B\u5E76\u4E0D\u4F1A\u4E3B\u52A8\u91CA\u653E\u504F\u5411\u9501\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929211803269.png" alt="image-20210929211803269"></p><p>\u200B \u8FD9\u65F6\u7EBF\u7A0B\u83B7\u5F97\u4E86\u9501\uFF0C\u53EF\u4EE5\u6267\u884C\u540C\u6B65\u4EE3\u7801\u5757\u3002\u5F53\u8BE5\u7EBF\u7A0B\u7B2C\u4E8C\u6B21\u5230\u8FBE\u540C\u6B65\u4EE3\u7801\u5757\u65F6\u4F1A\u5224\u65AD\u6B64\u65F6\u6301\u6709\u9501\u7684\u7EBF\u7A0B\u662F\u5426\u8FD8\u662F\u81EA\u5DF1\uFF08\u6301\u6709\u9501\u7684\u7EBF\u7A0BID\u4E5F\u5728\u5BF9\u8C61\u5934\u91CC\uFF09\uFF0CJVM\u901A\u8FC7account\u5BF9\u8C61\u7684Mark Word\u5224\u65AD\uFF1A\u5F53\u524D\u7EBF\u7A0BID\u8FD8\u5728\uFF0C\u8BF4\u660E\u8FD8\u6301\u6709\u7740\u8FD9\u4E2A\u5BF9\u8C61\u7684\u9501\uFF0C\u5C31\u53EF\u4EE5\u7EE7\u7EED\u8FDB\u5165\u4E34\u754C\u533A\u5DE5\u4F5C\u3002\u7531\u4E8E\u4E4B\u524D\u6CA1\u6709\u91CA\u653E\u9501\uFF0C\u8FD9\u91CC\u4E5F\u5C31\u4E0D\u9700\u8981\u91CD\u65B0\u52A0\u9501\u3002 \u5982\u679C\u81EA\u59CB\u81F3\u7EC8\u4F7F\u7528\u9501\u7684\u7EBF\u7A0B\u53EA\u6709\u4E00\u4E2A\uFF0C\u5F88\u660E\u663E\u504F\u5411\u9501\u51E0\u4E4E\u6CA1\u6709\u989D\u5916\u5F00\u9500\uFF0C\u6027\u80FD\u6781\u9AD8\u3002</p><p>\u200B <strong>\u7ED3\u8BBA</strong>\uFF1AJVM\u4E0D\u7528\u548C\u64CD\u4F5C\u7CFB\u7EDF\u534F\u5546\u8BBE\u7F6EMutex(\u4E89\u53D6\u5185\u6838)\uFF0C\u5B83\u53EA\u9700\u8981\u8BB0\u5F55\u4E0B\u7EBF\u7A0BID\u5C31\u6807\u793A\u81EA\u5DF1\u83B7\u5F97\u4E86\u5F53\u524D\u9501\uFF0C\u4E0D\u7528\u64CD\u4F5C\u7CFB\u7EDF\u63A5\u5165\u3002 \u4E0A\u8FF0\u5C31\u662F\u504F\u5411\u9501\uFF1A\u5728\u6CA1\u6709\u5176\u4ED6\u7EBF\u7A0B\u7ADE\u4E89\u7684\u65F6\u5019\uFF0C\u4E00\u76F4\u504F\u5411\u504F\u5FC3\u5F53\u524D\u7EBF\u7A0B\uFF0C\u5F53\u524D\u7EBF\u7A0B\u53EF\u4EE5\u4E00\u76F4\u6267\u884C\u3002</p><h5 id="_3\u3001\u504F\u5411\u9501jvm\u547D\u4EE4" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u504F\u5411\u9501jvm\u547D\u4EE4" aria-hidden="true">#</a> 3\u3001\u504F\u5411\u9501JVM\u547D\u4EE4</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>java -XX:+PrintFlagsInitial <span class="token operator">|</span><span class="token function">grep</span> BiasedLock*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929211909262.png" alt="image-20210929211909262"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929211918843.png" alt="image-20210929211918843"></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>* \u5B9E\u9645\u4E0A\u504F\u5411\u9501\u5728JDK1.6\u4E4B\u540E\u662F\u9ED8\u8BA4\u5F00\u542F\u7684\uFF0C\u4F46\u662F\u542F\u52A8\u65F6\u95F4\u6709\u5EF6\u8FDF\uFF0C
* \u6240\u4EE5\u9700\u8981\u6DFB\u52A0\u53C2\u6570-XX:BiasedLockingStartupDelay=0\uFF0C\u8BA9\u5176\u5728\u7A0B\u5E8F\u542F\u52A8\u65F6\u7ACB\u523B\u542F\u52A8\u3002
*
* \u5F00\u542F\u504F\u5411\u9501\uFF1A
* -XX:+UseBiasedLocking -XX:BiasedLockingStartupDelay=0
*
* \u5173\u95ED\u504F\u5411\u9501\uFF1A\u5173\u95ED\u4E4B\u540E\u7A0B\u5E8F\u9ED8\u8BA4\u4F1A\u76F4\u63A5\u8FDB\u5165------------------------------------------&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;   \u8F7B\u91CF\u7EA7\u9501\u72B6\u6001\u3002
* -XX:-UseBiasedLocking
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4\u3001code\u6F14\u793A" tabindex="-1"><a class="header-anchor" href="#_4\u3001code\u6F14\u793A" aria-hidden="true">#</a> 4\u3001Code\u6F14\u793A</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyObject</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929212100730.png" alt="image-20210929212100730"></p><p>\u4E00\u5207\u9ED8\u8BA4\uFF0C\u6F14\u793A\u65E0\u6548\u679C,\u56E0\u4E3A\u53C2\u6570\u7CFB\u7EDF\u9ED8\u8BA4\u5F00\u542F</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929212916026.png" alt="image-20210929212916026"></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>-XX:+UseBiasedLocking                       <span class="token comment"># \u5F00\u542F\u504F\u5411\u9501(\u9ED8\u8BA4)           </span>
-XX:-UseBiasedLocking                       <span class="token comment"># \u5173\u95ED\u504F\u5411\u9501</span>
-XX:BiasedLockingStartupDelay<span class="token operator">=</span><span class="token number">0</span>             <span class="token comment"># \u5173\u95ED\u5EF6\u8FDF(\u6F14\u793A\u504F\u5411\u9501\u65F6\u9700\u8981\u5F00\u542F)</span>

<span class="token comment">#\u53C2\u6570\u8BF4\u660E\uFF1A</span>
<span class="token comment">#\u504F\u5411\u9501\u5728JDK1.6\u4EE5\u4E0A\u9ED8\u8BA4\u5F00\u542F\uFF0C\u5F00\u542F\u540E\u7A0B\u5E8F\u542F\u52A8\u51E0\u79D2\u540E\u624D\u4F1A\u88AB\u6FC0\u6D3B\uFF0C\u53EF\u4EE5\u4F7F\u7528JVM\u53C2\u6570\u6765\u5173\u95ED\u5EF6\u8FDF -XX:BiasedLockingStartupDelay=0</span>
 
<span class="token comment">#\u5982\u679C\u786E\u5B9A\u9501\u901A\u5E38\u5904\u4E8E\u7ADE\u4E89\u72B6\u6001\u5219\u53EF\u901A\u8FC7JVM\u53C2\u6570 -XX:-UseBiasedLocking \u5173\u95ED\u504F\u5411\u9501\uFF0C\u90A3\u4E48\u9ED8\u8BA4\u4F1A\u8FDB\u5165\u8F7B\u91CF\u7EA7\u9501</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5173\u95ED\u5EF6\u65F6\u53C2\u6570\uFF0C\u542F\u7528\u8BE5\u529F\u80FD</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>-XX:BiasedLockingStartupDelay<span class="token operator">=</span><span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929212953054.png" alt="image-20210929212953054"></p><h5 id="_5\u3001\u504F\u5411\u9501\u7684\u64A4\u9500" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u504F\u5411\u9501\u7684\u64A4\u9500" aria-hidden="true">#</a> 5\u3001\u504F\u5411\u9501\u7684\u64A4\u9500</h5><p>\u5F53\u6709\u53E6\u5916\u7EBF\u7A0B\u9010\u6B65\u6765\u7ADE\u4E89\u9501\u7684\u65F6\u5019\uFF0C\u5C31\u4E0D\u80FD\u518D\u4F7F\u7528\u504F\u5411\u9501\u4E86\uFF0C\u8981\u5347\u7EA7\u4E3A\u8F7B\u91CF\u7EA7\u9501</p><p>\u7ADE\u4E89\u7EBF\u7A0B\u5C1D\u8BD5CAS\u66F4\u65B0\u5BF9\u8C61\u5934\u5931\u8D25\uFF0C\u4F1A\u7B49\u5F85\u5230\u5168\u5C40\u5B89\u5168\u70B9\uFF08\u6B64\u65F6\u4E0D\u4F1A\u6267\u884C\u4EFB\u4F55\u4EE3\u7801\uFF09\u64A4\u9500\u504F\u5411\u9501\u3002</p><blockquote><p>\u504F\u5411\u9501\u4F7F\u7528\u4E00\u79CD\u7B49\u5230\u7ADE\u4E89\u51FA\u73B0\u624D\u91CA\u653E\u9501\u7684\u673A\u5236\uFF0C\u53EA\u6709\u5F53\u5176\u4ED6\u7EBF\u7A0B\u7ADE\u4E89\u9501\u65F6\uFF0C\u6301\u6709\u504F\u5411\u9501\u7684\u539F\u6765\u7EBF\u7A0B\u624D\u4F1A\u88AB\u64A4\u9500\u3002 \u64A4\u9500\u9700\u8981\u7B49\u5F85\u5168\u5C40\u5B89\u5168\u70B9(\u8BE5\u65F6\u95F4\u70B9\u4E0A\u6CA1\u6709\u5B57\u8282\u7801\u6B63\u5728\u6267\u884C)\uFF0C\u540C\u65F6\u68C0\u67E5\u6301\u6709\u504F\u5411\u9501\u7684\u7EBF\u7A0B\u662F\u5426\u8FD8\u5728\u6267\u884C\uFF1A</p><p>\u2460 \u7B2C\u4E00\u4E2A\u7EBF\u7A0B\u6B63\u5728\u6267\u884Csynchronized\u65B9\u6CD5(\u5904\u4E8E\u540C\u6B65\u5757)\uFF0C\u5B83\u8FD8\u6CA1\u6709\u6267\u884C\u5B8C\uFF0C\u5176\u5B83\u7EBF\u7A0B\u6765\u62A2\u593A\uFF0C\u8BE5\u504F\u5411\u9501\u4F1A\u88AB\u53D6\u6D88\u6389\u5E76\u51FA\u73B0\u9501\u5347\u7EA7\u3002 \u6B64\u65F6\u8F7B\u91CF\u7EA7\u9501\u7531\u539F\u6301\u6709\u504F\u5411\u9501\u7684\u7EBF\u7A0B\u6301\u6709\uFF0C\u7EE7\u7EED\u6267\u884C\u5176\u540C\u6B65\u4EE3\u7801\uFF0C\u800C\u6B63\u5728\u7ADE\u4E89\u7684\u7EBF\u7A0B\u4F1A\u8FDB\u5165\u81EA\u65CB\u7B49\u5F85\u83B7\u5F97\u8BE5\u8F7B\u91CF\u7EA7\u9501\u3002 \u2461 \u7B2C\u4E00\u4E2A\u7EBF\u7A0B\u6267\u884C\u5B8C\u6210synchronized\u65B9\u6CD5(\u9000\u51FA\u540C\u6B65\u5757)\uFF0C\u5219\u5C06\u5BF9\u8C61\u5934\u8BBE\u7F6E\u6210\u65E0\u9501\u72B6\u6001\u5E76\u64A4\u9500\u504F\u5411\u9501\uFF0C\u91CD\u65B0\u504F\u5411 \u3002</p></blockquote><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929213113133.png" alt=""></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929213128855.png" alt="image-20210929213128855"></p><h4 id="_5\u3001\u8F7B\u9501" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u8F7B\u9501" aria-hidden="true">#</a> 5\u3001\u8F7B\u9501</h4><p>\u6709\u7EBF\u7A0B\u6765\u53C2\u4E0E\u9501\u7684\u7ADE\u4E89\uFF0C\u4F46\u662F\u83B7\u53D6\u9501\u7684\u51B2\u7A81\u65F6\u95F4\u6781\u77ED</p><p>\u672C\u8D28\u5C31\u662F\u81EA\u65CB\u9501</p><h5 id="_1\u3001\u8F7B\u91CF\u7EA7\u9501\u7684\u83B7\u53D6" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u8F7B\u91CF\u7EA7\u9501\u7684\u83B7\u53D6" aria-hidden="true">#</a> 1\u3001\u8F7B\u91CF\u7EA7\u9501\u7684\u83B7\u53D6</h5><p>\u8F7B\u91CF\u7EA7\u9501\u662F\u4E3A\u4E86\u5728\u7EBF\u7A0B\u8FD1\u4E4E\u4EA4\u66FF\u6267\u884C\u540C\u6B65\u5757\u65F6\u63D0\u9AD8\u6027\u80FD\u3002 \u4E3B\u8981\u76EE\u7684\uFF1A \u5728\u6CA1\u6709\u591A\u7EBF\u7A0B\u7ADE\u4E89\u7684\u524D\u63D0\u4E0B\uFF0C\u901A\u8FC7CAS\u51CF\u5C11\u91CD\u91CF\u7EA7\u9501\u4F7F\u7528\u64CD\u4F5C\u7CFB\u7EDF\u4E92\u65A5\u91CF\u4EA7\u751F\u7684\u6027\u80FD\u6D88\u8017\uFF0C\u8BF4\u767D\u4E86\u5148\u81EA\u65CB\u518D\u963B\u585E\u3002 \u5347\u7EA7\u65F6\u673A\uFF1A \u5F53\u5173\u95ED\u504F\u5411\u9501\u529F\u80FD\u6216\u591A\u7EBF\u7A0B\u7ADE\u4E89\u504F\u5411\u9501\u4F1A\u5BFC\u81F4\u504F\u5411\u9501\u5347\u7EA7\u4E3A\u8F7B\u91CF\u7EA7\u9501</p><p>\u5047\u5982\u7EBF\u7A0BA\u5DF2\u7ECF\u62FF\u5230\u9501\uFF0C\u8FD9\u65F6\u7EBF\u7A0BB\u53C8\u6765\u62A2\u8BE5\u5BF9\u8C61\u7684\u9501\uFF0C\u7531\u4E8E\u8BE5\u5BF9\u8C61\u7684\u9501\u5DF2\u7ECF\u88AB\u7EBF\u7A0BA\u62FF\u5230\uFF0C\u5F53\u524D\u8BE5\u9501\u5DF2\u662F\u504F\u5411\u9501\u4E86\u3002 \u800C\u7EBF\u7A0BB\u5728\u4E89\u62A2\u65F6\u53D1\u73B0\u5BF9\u8C61\u5934Mark Word\u4E2D\u7684\u7EBF\u7A0BID\u4E0D\u662F\u7EBF\u7A0BB\u81EA\u5DF1\u7684\u7EBF\u7A0BID(\u800C\u662F\u7EBF\u7A0BA)\uFF0C\u90A3\u7EBF\u7A0BB\u5C31\u4F1A\u8FDB\u884CCAS\u64CD\u4F5C\u5E0C\u671B\u80FD\u83B7\u5F97\u9501\u3002 \u6B64\u65F6\u7EBF\u7A0BB\u64CD\u4F5C\u4E2D\u6709\u4E24\u79CD\u60C5\u51B5\uFF1A \u5982\u679C\u9501\u83B7\u53D6\u6210\u529F\uFF0C\u76F4\u63A5\u66FF\u6362Mark Word\u4E2D\u7684\u7EBF\u7A0BID\u4E3AB\u81EA\u5DF1\u7684ID(A \u2192 B)\uFF0C\u91CD\u65B0\u504F\u5411\u4E8E\u5176\u4ED6\u7EBF\u7A0B(\u5373\u5C06\u504F\u5411\u9501\u4EA4\u7ED9\u5176\u4ED6\u7EBF\u7A0B\uFF0C\u76F8\u5F53\u4E8E\u5F53\u524D\u7EBF\u7A0B&quot;\u88AB&quot;\u91CA\u653E\u4E86\u9501)\uFF0C\u8BE5\u9501\u4F1A\u4FDD\u6301\u504F\u5411\u9501\u72B6\u6001\uFF0CA\u7EBF\u7A0BOver\uFF0CB\u7EBF\u7A0B\u4E0A\u4F4D\uFF1B</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929213253052.png" alt="image-20210929213253052"></p><p>\u200B \u5982\u679C\u9501\u83B7\u53D6\u5931\u8D25\uFF0C\u5219\u504F\u5411\u9501\u5347\u7EA7\u4E3A\u8F7B\u91CF\u7EA7\u9501\uFF0C\u6B64\u65F6\u8F7B\u91CF\u7EA7\u9501\u7531\u539F\u6301\u6709\u504F\u5411\u9501\u7684\u7EBF\u7A0B\u6301\u6709\uFF0C\u7EE7\u7EED\u6267\u884C\u5176\u540C\u6B65\u4EE3\u7801\uFF0C\u800C\u6B63\u5728\u7ADE\u4E89\u7684\u7EBF\u7A0BB\u4F1A\u8FDB\u5165\u81EA\u65CB\u7B49\u5F85\u83B7\u5F97\u8BE5\u8F7B\u91CF\u7EA7\u9501\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929213304246.png" alt="image-20210929213304246"></p><h5 id="_2\u3001code\u6F14\u793A" tabindex="-1"><a class="header-anchor" href="#_2\u3001code\u6F14\u793A" aria-hidden="true">#</a> 2\u3001Code\u6F14\u793A</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929213324762.png" alt="image-20210929213324762"></p><p>\u5982\u679C\u5173\u95ED\u504F\u5411\u9501\uFF0C\u5C31\u53EF\u4EE5\u76F4\u63A5\u8FDB\u5165\u8F7B\u91CF\u7EA7\u9501</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>-XX:-UseBiasedLocking
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="_3\u3001\u81EA\u65CB\u8FBE\u5230\u4E00\u5B9A\u6B21\u6570\u548C\u7A0B\u5EA6" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u81EA\u65CB\u8FBE\u5230\u4E00\u5B9A\u6B21\u6570\u548C\u7A0B\u5EA6" aria-hidden="true">#</a> 3\u3001\u81EA\u65CB\u8FBE\u5230\u4E00\u5B9A\u6B21\u6570\u548C\u7A0B\u5EA6</h5><p>java6\u4E4B\u524D</p><p>\u9ED8\u8BA4\u542F\u7528\uFF0C\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u81EA\u65CB\u7684\u6B21\u6570\u662F 10 \u6B21 -XX:PreBlockSpin=10\u6765\u4FEE\u6539\uFF0C\u6216\u8005\u81EA\u65CB\u7EBF\u7A0B\u6570\u8D85\u8FC7cpu\u6838\u6570\u4E00\u534A</p><p>Java6\u4E4B\u540E</p><p>\u81EA\u9002\u5E94\uFF0C\u81EA\u9002\u5E94\u610F\u5473\u7740\u81EA\u65CB\u7684\u6B21\u6570\u4E0D\u662F\u56FA\u5B9A\u4E0D\u53D8\u7684</p><p>\u800C\u662F\u6839\u636E\uFF1A\u540C\u4E00\u4E2A\u9501\u4E0A\u4E00\u6B21\u81EA\u65CB\u7684\u65F6\u95F4\uFF0C\u62E5\u6709\u9501\u7EBF\u7A0B\u7684\u72B6\u6001\u6765\u51B3\u5B9A\u3002</p><h5 id="_4\u3001\u8F7B\u91CF\u9501\u4E0E\u504F\u5411\u9501\u7684\u533A\u522B\u548C\u4E0D\u540C" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u8F7B\u91CF\u9501\u4E0E\u504F\u5411\u9501\u7684\u533A\u522B\u548C\u4E0D\u540C" aria-hidden="true">#</a> 4\u3001\u8F7B\u91CF\u9501\u4E0E\u504F\u5411\u9501\u7684\u533A\u522B\u548C\u4E0D\u540C</h5><p>\u4E89\u593A\u8F7B\u91CF\u7EA7\u9501\u5931\u8D25\u65F6\uFF0C\u81EA\u65CB\u5C1D\u8BD5\u62A2\u5360\u9501</p><p>\u8F7B\u91CF\u7EA7\u9501\u6BCF\u6B21\u9000\u51FA\u540C\u6B65\u5757\u90FD\u9700\u8981\u91CA\u653E\u9501\uFF0C\u800C\u504F\u5411\u9501\u662F\u5728\u7ADE\u4E89\u53D1\u751F\u65F6\u624D\u91CA\u653E\u9501</p><h4 id="_6\u3001\u91CD\u9501" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u91CD\u9501" aria-hidden="true">#</a> 6\u3001\u91CD\u9501</h4><p>\u6709\u5927\u91CF\u7684\u7EBF\u7A0B\u53C2\u4E0E\u9501\u7684\u7ADE\u4E89\uFF0C\u51B2\u7A81\u6027\u5F88\u9AD8</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929213558173.png" alt="image-20210929213558173"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929213604489.png" alt="image-20210929213604489"></p><h4 id="_7\u3001\u5404\u79CD\u9501\u4F18\u7F3A\u70B9\u3001synchronized\u9501\u5347\u7EA7\u548C\u5B9E\u73B0\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_7\u3001\u5404\u79CD\u9501\u4F18\u7F3A\u70B9\u3001synchronized\u9501\u5347\u7EA7\u548C\u5B9E\u73B0\u539F\u7406" aria-hidden="true">#</a> 7\u3001\u5404\u79CD\u9501\u4F18\u7F3A\u70B9\u3001synchronized\u9501\u5347\u7EA7\u548C\u5B9E\u73B0\u539F\u7406</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929213623068.png" alt="image-20210929213623068"></p><p>synchronized\u9501\u5347\u7EA7\u8FC7\u7A0B\u603B\u7ED3\uFF1A\u4E00\u53E5\u8BDD\uFF0C\u5C31\u662F\u5148\u81EA\u65CB\uFF0C\u4E0D\u884C\u518D\u963B\u585E\u3002 \u5B9E\u9645\u4E0A\u662F\u628A\u4E4B\u524D\u7684\u60B2\u89C2\u9501(\u91CD\u91CF\u7EA7\u9501)\u53D8\u6210\u5728\u4E00\u5B9A\u6761\u4EF6\u4E0B\u4F7F\u7528\u504F\u5411\u9501\u4EE5\u53CA\u4F7F\u7528\u8F7B\u91CF\u7EA7(\u81EA\u65CB\u9501CAS)\u7684\u5F62\u5F0F</p><p>\u200B synchronized\u5728\u4FEE\u9970\u65B9\u6CD5\u548C\u4EE3\u7801\u5757\u5728\u5B57\u8282\u7801\u4E0A\u5B9E\u73B0\u65B9\u5F0F\u6709\u5F88\u5927\u5DEE\u5F02\uFF0C\u4F46\u662F\u5185\u90E8\u5B9E\u73B0\u8FD8\u662F\u57FA\u4E8E\u5BF9\u8C61\u5934\u7684MarkWord\u6765\u5B9E\u73B0\u7684\u3002 JDK1.6\u4E4B\u524Dsynchronized\u4F7F\u7528\u7684\u662F\u91CD\u91CF\u7EA7\u9501\uFF0CJDK1.6\u4E4B\u540E\u8FDB\u884C\u4E86\u4F18\u5316\uFF0C\u62E5\u6709\u4E86\u65E0\u9501-&gt;\u504F\u5411\u9501-&gt;\u8F7B\u91CF\u7EA7\u9501-&gt;\u91CD\u91CF\u7EA7\u9501\u7684\u5347\u7EA7\u8FC7\u7A0B\uFF0C\u800C\u4E0D\u662F\u65E0\u8BBA\u4EC0\u4E48\u60C5\u51B5\u90FD\u4F7F\u7528\u91CD\u91CF\u7EA7\u9501\u3002</p><p>\u200B \u504F\u5411\u9501:\u9002\u7528\u4E8E\u5355\u7EBF\u7A0B\u9002\u7528\u7684\u60C5\u51B5\uFF0C\u5728\u4E0D\u5B58\u5728\u9501\u7ADE\u4E89\u7684\u65F6\u5019\u8FDB\u5165\u540C\u6B65\u65B9\u6CD5/\u4EE3\u7801\u5757\u5219\u4F7F\u7528\u504F\u5411\u9501\u3002 \u8F7B\u91CF\u7EA7\u9501\uFF1A\u9002\u7528\u4E8E\u7ADE\u4E89\u8F83\u4E0D\u6FC0\u70C8\u7684\u60C5\u51B5(\u8FD9\u548C\u4E50\u89C2\u9501\u7684\u4F7F\u7528\u8303\u56F4\u7C7B\u4F3C)\uFF0C \u5B58\u5728\u7ADE\u4E89\u65F6\u5347\u7EA7\u4E3A\u8F7B\u91CF\u7EA7\u9501\uFF0C\u8F7B\u91CF\u7EA7\u9501\u91C7\u7528\u7684\u662F\u81EA\u65CB\u9501\uFF0C\u5982\u679C\u540C\u6B65\u65B9\u6CD5/\u4EE3\u7801\u5757\u6267\u884C\u65F6\u95F4\u5F88\u77ED\u7684\u8BDD\uFF0C\u91C7\u7528\u8F7B\u91CF\u7EA7\u9501\u867D\u7136\u4F1A\u5360\u7528cpu\u8D44\u6E90\u4F46\u662F\u76F8\u5BF9\u6BD4\u4F7F\u7528\u91CD\u91CF\u7EA7\u9501\u8FD8\u662F\u66F4\u9AD8\u6548\u3002 \u200B \u91CD\u91CF\u7EA7\u9501\uFF1A\u9002\u7528\u4E8E\u7ADE\u4E89\u6FC0\u70C8\u7684\u60C5\u51B5\uFF0C\u5982\u679C\u540C\u6B65\u65B9\u6CD5/\u4EE3\u7801\u5757\u6267\u884C\u65F6\u95F4\u5F88\u957F\uFF0C\u90A3\u4E48\u4F7F\u7528\u8F7B\u91CF\u7EA7\u9501\u81EA\u65CB\u5E26\u6765\u7684\u6027\u80FD\u6D88\u8017\u5C31\u6BD4\u4F7F\u7528\u91CD\u91CF\u7EA7\u9501\u66F4\u4E25\u91CD\uFF0C\u8FD9\u65F6\u5019\u5C31\u9700\u8981\u5347\u7EA7\u4E3A\u91CD\u91CF\u7EA7\u9501\u3002</p><h3 id="_4\u3001jit\u7F16\u8BD1\u5668\u5BF9\u9501\u7684\u4F18\u5316" tabindex="-1"><a class="header-anchor" href="#_4\u3001jit\u7F16\u8BD1\u5668\u5BF9\u9501\u7684\u4F18\u5316" aria-hidden="true">#</a> 4\u3001JIT\u7F16\u8BD1\u5668\u5BF9\u9501\u7684\u4F18\u5316</h3><p>Just In Time Compiler\uFF0C\u4E00\u822C\u7FFB\u8BD1\u4E3A\u5373\u65F6\u7F16\u8BD1\u5668</p><h4 id="_1\u3001\u9501\u6D88\u9664" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u9501\u6D88\u9664" aria-hidden="true">#</a> 1\u3001\u9501\u6D88\u9664</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u9501\u6D88\u9664
 * \u4ECEJIT\u89D2\u5EA6\u770B\u76F8\u5F53\u4E8E\u65E0\u89C6\u5B83\uFF0Csynchronized (o)\u4E0D\u5B58\u5728\u4E86,\u8FD9\u4E2A\u9501\u5BF9\u8C61\u5E76\u6CA1\u6709\u88AB\u5171\u7528\u6269\u6563\u5230\u5176\u5B83\u7EBF\u7A0B\u4F7F\u7528\uFF0C
 * \u6781\u7AEF\u7684\u8BF4\u5C31\u662F\u6839\u672C\u6CA1\u6709\u52A0\u8FD9\u4E2A\u9501\u5BF9\u8C61\u7684\u5E95\u5C42\u673A\u5668\u7801\uFF0C\u6D88\u9664\u4E86\u9501\u7684\u4F7F\u7528
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockClearUPDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Object</span> objectLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//\u6B63\u5E38\u7684</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//\u9501\u6D88\u9664,JIT\u4F1A\u65E0\u89C6\u5B83\uFF0Csynchronized(\u5BF9\u8C61\u9501)\u4E0D\u5B58\u5728\u4E86\u3002\u4E0D\u6B63\u5E38\u7684</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>o<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----hello LockClearUPDemo&quot;</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>o<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>objectLock<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">LockClearUPDemo</span> demo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LockClearUPDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                demo<span class="token punctuation">.</span><span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2\u3001\u9501\u7C97\u5316" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u9501\u7C97\u5316" aria-hidden="true">#</a> 2\u3001\u9501\u7C97\u5316</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u9501\u7C97\u5316
 * \u5047\u5982\u65B9\u6CD5\u4E2D\u9996\u5C3E\u76F8\u63A5\uFF0C\u524D\u540E\u76F8\u90BB\u7684\u90FD\u662F\u540C\u4E00\u4E2A\u9501\u5BF9\u8C61\uFF0C\u90A3JIT\u7F16\u8BD1\u5668\u5C31\u4F1A\u628A\u8FD9\u51E0\u4E2Asynchronized\u5757\u5408\u5E76\u6210\u4E00\u4E2A\u5927\u5757\uFF0C
 * \u52A0\u7C97\u52A0\u5927\u8303\u56F4\uFF0C\u4E00\u6B21\u7533\u8BF7\u9501\u4F7F\u7528\u5373\u53EF\uFF0C\u907F\u514D\u6B21\u6B21\u7684\u7533\u8BF7\u548C\u91CA\u653E\u9501\uFF0C\u63D0\u5347\u4E86\u6027\u80FD
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockBigDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">Object</span> objectLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;11111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;22222&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;33333&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;44444&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;55555&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;66666&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="\u5341\u516D\u3001abstractqueuedsynchronizer\u4E4Baqs" tabindex="-1"><a class="header-anchor" href="#\u5341\u516D\u3001abstractqueuedsynchronizer\u4E4Baqs" aria-hidden="true">#</a> \u5341\u516D\u3001AbstractQueuedSynchronizer\u4E4BAQS</h2><h3 id="_1\u3001aqs\u662F\u4EC0\u4E48" tabindex="-1"><a class="header-anchor" href="#_1\u3001aqs\u662F\u4EC0\u4E48" aria-hidden="true">#</a> 1\u3001AQS\u662F\u4EC0\u4E48</h3><p>\u5B57\u9762\u610F\u601D:\u62BD\u8C61\u7684\u961F\u5217\u540C\u6B65\u5668</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929214004518.png" alt="image-20210929214004518"></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">AbstractOwnableSynchronizer</span>
<span class="token class-name">AbstractQueuedLongSynchronizer</span>
<span class="token class-name">AbstractQueuedSynchronizer</span>                  
\u901A\u5E38\u5730\uFF1A<span class="token class-name">AbstractQueuedSynchronizer</span>\u7B80\u79F0\u4E3AAQS
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u6280\u672F\u89E3\u91CA</strong></p><p>\u200B \u662F\u7528\u6765\u6784\u5EFA\u9501\u6216\u8005\u5176\u5B83\u540C\u6B65\u5668\u7EC4\u4EF6\u7684\u91CD\u91CF\u7EA7\u57FA\u7840\u6846\u67B6\u53CA\u6574\u4E2AJUC\u4F53\u7CFB\u7684\u57FA\u77F3\uFF0C\u901A\u8FC7\u5185\u7F6E\u7684FIFO\u961F\u5217\u6765\u5B8C\u6210\u8D44\u6E90\u83B7\u53D6\u7EBF\u7A0B\u7684\u6392\u961F\u5DE5\u4F5C\uFF0C\u5E76\u901A\u8FC7\u4E00\u4E2Aint\u7C7B\u53D8\u91CF\u8868\u793A\u6301\u6709\u9501\u7684\u72B6\u6001</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929214041662.png" alt="image-20210929214041662"></p><p>CLH\uFF1ACraig\u3001Landin and Hagersten \u961F\u5217\uFF0C\u662F\u4E00\u4E2A\u5355\u5411\u94FE\u8868\uFF0CAQS\u4E2D\u7684\u961F\u5217\u662FCLH\u53D8\u4F53\u7684\u865A\u62DF\u53CC\u5411\u961F\u5217FIFO</p><h3 id="_2\u3001aqs\u4E3A\u4EC0\u4E48\u662Fjuc\u5185\u5BB9\u4E2D\u6700\u91CD\u8981\u7684\u57FA\u77F3" tabindex="-1"><a class="header-anchor" href="#_2\u3001aqs\u4E3A\u4EC0\u4E48\u662Fjuc\u5185\u5BB9\u4E2D\u6700\u91CD\u8981\u7684\u57FA\u77F3" aria-hidden="true">#</a> 2\u3001AQS\u4E3A\u4EC0\u4E48\u662FJUC\u5185\u5BB9\u4E2D\u6700\u91CD\u8981\u7684\u57FA\u77F3</h3><h4 id="_1\u3001\u548Caqs\u6709\u5173\u7684" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u548Caqs\u6709\u5173\u7684" aria-hidden="true">#</a> 1\u3001\u548CAQS\u6709\u5173\u7684</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929214144170.png" alt="image-20210929214144170"></p><h4 id="_2\u3001reentrantlock" tabindex="-1"><a class="header-anchor" href="#_2\u3001reentrantlock" aria-hidden="true">#</a> 2\u3001ReentrantLock</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929214213703.png" alt="image-20210929214213703"></p><h4 id="_3\u3001countdownlatch" tabindex="-1"><a class="header-anchor" href="#_3\u3001countdownlatch" aria-hidden="true">#</a> 3\u3001CountDownLatch</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929214224423.png" alt="image-20210929214224423"></p><h4 id="_4\u3001reentrantreadwritelock" tabindex="-1"><a class="header-anchor" href="#_4\u3001reentrantreadwritelock" aria-hidden="true">#</a> 4\u3001ReentrantReadWriteLock</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929214237561.png" alt="image-20210929214237561"></p><h4 id="_5\u3001semaphore" tabindex="-1"><a class="header-anchor" href="#_5\u3001semaphore" aria-hidden="true">#</a> 5\u3001Semaphore</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929214249848.png" alt="image-20210929214249848"></p><h4 id="_6\u3001\u8FDB\u4E00\u6B65\u7406\u89E3\u9501\u548C\u540C\u6B65\u5668\u7684\u5173\u7CFB" tabindex="-1"><a class="header-anchor" href="#_6\u3001\u8FDB\u4E00\u6B65\u7406\u89E3\u9501\u548C\u540C\u6B65\u5668\u7684\u5173\u7CFB" aria-hidden="true">#</a> 6\u3001\u8FDB\u4E00\u6B65\u7406\u89E3\u9501\u548C\u540C\u6B65\u5668\u7684\u5173\u7CFB</h4><p>\u9501\uFF0C\u9762\u5411\u9501\u7684\u4F7F\u7528\u8005</p><p>\u5B9A\u4E49\u4E86\u7A0B\u5E8F\u5458\u548C\u9501\u4EA4\u4E92\u7684\u4F7F\u7528\u5C42API\uFF0C\u9690\u85CF\u4E86\u5B9E\u73B0\u7EC6\u8282\uFF0C\u4F60\u8C03\u7528\u5373\u53EF\u3002</p><p>\u540C\u6B65\u5668\uFF0C\u9762\u5411\u9501\u7684\u5B9E\u73B0\u8005</p><p>\u6BD4\u5982Java\u5E76\u53D1\u5927\u795EDougLee\uFF0C\u63D0\u51FA\u7EDF\u4E00\u89C4\u8303\u5E76\u7B80\u5316\u4E86\u9501\u7684\u5B9E\u73B0\uFF0C\u5C4F\u853D\u4E86\u540C\u6B65\u72B6\u6001\u7BA1\u7406\u3001\u963B\u585E\u7EBF\u7A0B\u6392\u961F\u548C\u901A\u77E5\u3001\u5524\u9192\u673A\u5236\u7B49\u3002</p><h3 id="_3\u3001aqs\u80FD\u5E72\u561B" tabindex="-1"><a class="header-anchor" href="#_3\u3001aqs\u80FD\u5E72\u561B" aria-hidden="true">#</a> 3\u3001AQS\u80FD\u5E72\u561B</h3><p>\u52A0\u9501\u4F1A\u5BFC\u81F4\u963B\u585E\uFF0C\u6709\u963B\u585E\u5C31\u9700\u8981\u6392\u961F\uFF0C\u5B9E\u73B0\u6392\u961F\u5FC5\u7136\u9700\u8981\u961F\u5217</p><p>\u200B \u62A2\u5230\u8D44\u6E90\u7684\u7EBF\u7A0B\u76F4\u63A5\u4F7F\u7528\u5904\u7406\u4E1A\u52A1\uFF0C\u62A2\u4E0D\u5230\u8D44\u6E90\u7684\u5FC5\u7136\u6D89\u53CA\u4E00\u79CD\u6392\u961F\u7B49\u5019\u673A\u5236\u3002\u62A2\u5360\u8D44\u6E90\u5931\u8D25\u7684\u7EBF\u7A0B\u7EE7\u7EED\u53BB\u7B49\u5F85(\u7C7B\u4F3C\u94F6\u884C\u4E1A\u52A1\u529E\u7406\u7A97\u53E3\u90FD\u6EE1\u4E86\uFF0C\u6682\u65F6\u6CA1\u6709\u53D7\u7406\u7A97\u53E3\u7684\u987E\u5BA2\u53EA\u80FD\u53BB\u5019\u5BA2\u533A\u6392\u961F\u7B49\u5019)\uFF0C\u4F46\u7B49\u5019\u7EBF\u7A0B\u4ECD\u7136\u4FDD\u7559\u83B7\u53D6\u9501\u7684\u53EF\u80FD\u4E14\u83B7\u53D6\u9501\u6D41\u7A0B\u4ECD\u5728\u7EE7\u7EED(\u5019\u5BA2\u533A\u7684\u987E\u5BA2\u4E5F\u5728\u7B49\u7740\u53EB\u53F7\uFF0C\u8F6E\u5230\u4E86\u518D\u53BB\u53D7\u7406\u7A97\u53E3\u529E\u7406\u4E1A\u52A1)\u3002</p><p>\u65E2\u7136\u8BF4\u5230\u4E86\u6392\u961F\u7B49\u5019\u673A\u5236\uFF0C\u90A3\u4E48\u5C31\u4E00\u5B9A\u4F1A\u6709\u67D0\u79CD\u961F\u5217\u5F62\u6210\uFF0C\u8FD9\u6837\u7684\u961F\u5217\u662F\u4EC0\u4E48\u6570\u636E\u7ED3\u6784\u5462\uFF1F</p><p>\u200B \u5982\u679C\u5171\u4EAB\u8D44\u6E90\u88AB\u5360\u7528\uFF0C\u5C31\u9700\u8981\u4E00\u5B9A\u7684\u963B\u585E\u7B49\u5F85\u5524\u9192\u673A\u5236\u6765\u4FDD\u8BC1\u9501\u5206\u914D\u3002\u8FD9\u4E2A\u673A\u5236\u4E3B\u8981\u7528\u7684\u662FCLH\u961F\u5217\u7684\u53D8\u4F53\u5B9E\u73B0\u7684\uFF0C\u5C06\u6682\u65F6\u83B7\u53D6\u4E0D\u5230\u9501\u7684\u7EBF\u7A0B\u52A0\u5165\u5230\u961F\u5217\u4E2D\uFF0C\u8FD9\u4E2A\u961F\u5217\u5C31\u662FAQS\u7684\u62BD\u8C61\u8868\u73B0\u3002\u5B83\u5C06\u8BF7\u6C42\u5171\u4EAB\u8D44\u6E90\u7684\u7EBF\u7A0B\u5C01\u88C5\u6210\u961F\u5217\u7684\u7ED3\u70B9\uFF08Node\uFF09\uFF0C\u901A\u8FC7CAS\u3001\u81EA\u65CB\u4EE5\u53CA<code>LockSupport.park()</code>\u7684\u65B9\u5F0F\uFF0C\u7EF4\u62A4state\u53D8\u91CF\u7684\u72B6\u6001\uFF0C\u4F7F\u5E76\u53D1\u8FBE\u5230\u540C\u6B65\u7684\u6548\u679C\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929214426330.png" alt="image-20210929214426330"></p><h3 id="_4\u3001aqs\u521D\u6B65" tabindex="-1"><a class="header-anchor" href="#_4\u3001aqs\u521D\u6B65" aria-hidden="true">#</a> 4\u3001AQS\u521D\u6B65</h3><h4 id="_1\u3001\u5B98\u7F51\u89E3\u91CA" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5B98\u7F51\u89E3\u91CA" aria-hidden="true">#</a> 1\u3001\u5B98\u7F51\u89E3\u91CA</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929214506123.png" alt="image-20210929214506123"></p><p>\u6709\u963B\u585E\u5C31\u9700\u8981\u6392\u961F\uFF0C\u5B9E\u73B0\u6392\u961F\u5FC5\u7136\u9700\u8981\u961F\u5217</p><p>\u200B AQS\u4F7F\u7528\u4E00\u4E2Avolatile\u7684int\u7C7B\u578B\u7684\u6210\u5458\u53D8\u91CF\u6765\u8868\u793A\u540C\u6B65\u72B6\u6001\uFF0C\u901A\u8FC7\u5185\u7F6E\u7684FIFO\u961F\u5217\u6765\u5B8C\u6210\u8D44\u6E90\u83B7\u53D6\u7684\u6392\u961F\u5DE5\u4F5C\u5C06\u6BCF\u6761\u8981\u53BB\u62A2\u5360\u8D44\u6E90\u7684\u7EBF\u7A0B\u5C01\u88C5\u6210\u4E00\u4E2ANode\u8282\u70B9\u6765\u5B9E\u73B0\u9501\u7684\u5206\u914D\uFF0C\u901A\u8FC7CAS\u5B8C\u6210\u5BF9State\u503C\u7684\u4FEE\u6539\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929214546424.png" alt="image-20210929214546424"></p><h4 id="_2\u3001aqs\u5185\u90E8\u4F53\u7CFB\u67B6\u6784" tabindex="-1"><a class="header-anchor" href="#_2\u3001aqs\u5185\u90E8\u4F53\u7CFB\u67B6\u6784" aria-hidden="true">#</a> 2\u3001AQS\u5185\u90E8\u4F53\u7CFB\u67B6\u6784</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929214605895.png" alt="image-20210929214605895"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929214622747.png" alt="image-20210929214622747"></p><h5 id="_1\u3001aqs\u81EA\u8EAB" tabindex="-1"><a class="header-anchor" href="#_1\u3001aqs\u81EA\u8EAB" aria-hidden="true">#</a> 1\u3001AQS\u81EA\u8EAB</h5><ol><li>AQS\u7684int\u53D8\u91CF</li></ol><p>AQS\u7684\u540C\u6B65\u72B6\u6001State\u6210\u5458\u53D8\u91CF</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929214734697.png" alt="image-20210929214734697"></p><p>\u94F6\u884C\u529E\u7406\u4E1A\u52A1\u7684\u53D7\u7406\u7A97\u53E3\u72B6\u6001</p><p>\u96F6\u5C31\u662F\u6CA1\u4EBA\uFF0C\u81EA\u7531\u72B6\u6001\u53EF\u4EE5\u529E\u7406</p><p>\u5927\u4E8E\u7B49\u4E8E1\uFF0C\u6709\u4EBA\u5360\u7528\u7A97\u53E3\uFF0C\u7B49\u7740\u53BB</p><ol start="2"><li>AQS\u7684CLH\u961F\u5217</li></ol><p>CLH\u961F\u5217(\u4E09\u4E2A\u5927\u725B\u7684\u540D\u5B57\u7EC4\u6210)\uFF0C\u4E3A\u4E00\u4E2A\u53CC\u5411\u961F\u5217</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929214808112.png" alt="image-20210929214808112"></p><p><strong>\u5C0F\u603B\u7ED3</strong></p><p>\u6709\u963B\u585E\u5C31\u9700\u8981\u6392\u961F\uFF0C\u5B9E\u73B0\u6392\u961F\u5FC5\u7136\u9700\u8981\u961F\u5217</p><p>state\u53D8\u91CF+CLH\u53CC\u7AEF\u961F\u5217</p><h5 id="_2\u3001\u5185\u90E8\u7C7Bnode-node\u7C7B\u5728aqs\u7C7B\u5185\u90E8" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5185\u90E8\u7C7Bnode-node\u7C7B\u5728aqs\u7C7B\u5185\u90E8" aria-hidden="true">#</a> 2\u3001\u5185\u90E8\u7C7BNode(Node\u7C7B\u5728AQS\u7C7B\u5185\u90E8)</h5><ol><li>Node\u7684int\u53D8\u91CF</li></ol><p>Node\u7684\u7B49\u5F85\u72B6\u6001waitState\u6210\u5458\u53D8\u91CF</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">volatile</span> <span class="token keyword">int</span> waitStatus
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u7B49\u5019\u533A\u5176\u5B83\u987E\u5BA2(\u5176\u5B83\u7EBF\u7A0B)\u7684\u7B49\u5F85\u72B6\u6001</p><p>\u961F\u5217\u4E2D\u6BCF\u4E2A\u6392\u961F\u7684\u4E2A\u4F53\u5C31\u662F\u4E00\u4E2A Node</p><ol start="2"><li>Node\u6B64\u7C7B\u7684\u8BB2\u89E3</li></ol><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929214940522.png" alt="image-20210929214940522"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929214949657.png" alt="image-20210929214949657"></p><h5 id="_3\u3001aqs\u540C\u6B65\u961F\u5217\u7684\u57FA\u672C\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#_3\u3001aqs\u540C\u6B65\u961F\u5217\u7684\u57FA\u672C\u7ED3\u6784" aria-hidden="true">#</a> 3\u3001AQS\u540C\u6B65\u961F\u5217\u7684\u57FA\u672C\u7ED3\u6784</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929215024937.png" alt="image-20210929215024937"></p><p>CLH\uFF1ACraig\u3001Landin and Hagersten \u961F\u5217\uFF0C\u662F\u4E2A\u5355\u5411\u94FE\u8868\uFF0CAQS\u4E2D\u7684\u961F\u5217\u662FCLH\u53D8\u4F53\u7684\u865A\u62DF\u53CC\u5411\u961F\u5217\uFF08FIFO\uFF09</p><h3 id="_5\u3001\u4ECEreentrantlock\u5F00\u59CB\u89E3\u8BFBaqs" tabindex="-1"><a class="header-anchor" href="#_5\u3001\u4ECEreentrantlock\u5F00\u59CB\u89E3\u8BFBaqs" aria-hidden="true">#</a> 5\u3001\u4ECEReentrantLock\u5F00\u59CB\u89E3\u8BFBAQS</h3><p>Lock\u63A5\u53E3\u7684\u5B9E\u73B0\u7C7B\uFF0C\u57FA\u672C\u90FD\u662F\u901A\u8FC7\u3010\u805A\u5408\u3011\u4E86\u4E00\u4E2A\u3010\u961F\u5217\u540C\u6B65\u5668\u3011\u7684\u5B50\u7C7B\u5B8C\u6210\u7EBF\u7A0B\u8BBF\u95EE\u63A7\u5236\u7684</p><h4 id="_1\u3001reentrantlock\u7684\u539F\u7406" tabindex="-1"><a class="header-anchor" href="#_1\u3001reentrantlock\u7684\u539F\u7406" aria-hidden="true">#</a> 1\u3001ReentrantLock\u7684\u539F\u7406</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929215121096.png" alt="image-20210929215121096"></p><h4 id="_2\u3001\u4ECE\u6700\u7B80\u5355\u7684lock\u65B9\u6CD5\u5F00\u59CB\u770B\u770B\u516C\u5E73\u548C\u975E\u516C\u5E73" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u4ECE\u6700\u7B80\u5355\u7684lock\u65B9\u6CD5\u5F00\u59CB\u770B\u770B\u516C\u5E73\u548C\u975E\u516C\u5E73" aria-hidden="true">#</a> 2\u3001\u4ECE\u6700\u7B80\u5355\u7684lock\u65B9\u6CD5\u5F00\u59CB\u770B\u770B\u516C\u5E73\u548C\u975E\u516C\u5E73</h4><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929215157532.png" alt="image-20210929215157532"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929215208921.png" alt="image-20210929215208921"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929215217723.png" alt="image-20210929215217723"></p><blockquote><p>\u53EF\u4EE5\u660E\u663E\u770B\u51FA\u516C\u5E73\u9501\u4E0E\u975E\u516C\u5E73\u9501\u7684lock()\u65B9\u6CD5\u552F\u4E00\u7684\u533A\u522B\u5C31\u5728\u4E8E\u516C\u5E73\u9501\u5728\u83B7\u53D6\u540C\u6B65\u72B6\u6001\u65F6\u591A\u4E86\u4E00\u4E2A\u9650\u5236\u6761\u4EF6\uFF1A <code>hasQueuedPredecessors()</code><code>hasQueuedPredecessors</code>\u662F\u516C\u5E73\u9501\u52A0\u9501\u65F6\u5224\u65AD\u7B49\u5F85\u961F\u5217\u4E2D\u662F\u5426\u5B58\u5728\u6709\u6548\u8282\u70B9\u7684\u65B9\u6CD5</p></blockquote><h4 id="_3\u3001\u975E\u516C\u5E73\u9501-\u65B9\u6CD5lock" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u975E\u516C\u5E73\u9501-\u65B9\u6CD5lock" aria-hidden="true">#</a> 3\u3001\u975E\u516C\u5E73\u9501 \u65B9\u6CD5lock()</h4><p>\u5BF9\u6BD4\u516C\u5E73\u9501\u548C\u975E\u516C\u5E73\u9501\u7684 tryAcquire()\u65B9\u6CD5\u7684\u5B9E\u73B0\u4EE3\u7801\uFF0C\u5176\u5B9E\u5DEE\u522B\u5C31\u5728\u4E8E\u975E\u516C\u5E73\u9501\u83B7\u53D6\u9501\u65F6\u6BD4\u516C\u5E73\u9501\u4E2D\u5C11\u4E86\u4E00\u4E2A\u5224\u65AD <code>!hasQueuedPredecessors()</code></p><p><code>hasQueuedPredecessors()</code> \u4E2D\u5224\u65AD\u4E86\u662F\u5426\u9700\u8981\u6392\u961F\uFF0C\u5BFC\u81F4\u516C\u5E73\u9501\u548C\u975E\u516C\u5E73\u9501\u7684\u5DEE\u5F02\u5982\u4E0B\uFF1A</p><p>\u516C\u5E73\u9501\uFF1A\u516C\u5E73\u9501\u8BB2\u7A76\u5148\u6765\u5148\u5230\uFF0C\u7EBF\u7A0B\u5728\u83B7\u53D6\u9501\u65F6\uFF0C\u5982\u679C\u8FD9\u4E2A\u9501\u7684\u7B49\u5F85\u961F\u5217\u4E2D\u5DF2\u7ECF\u6709\u7EBF\u7A0B\u5728\u7B49\u5F85\uFF0C\u90A3\u4E48\u5F53\u524D\u7EBF\u7A0B\u5C31\u4F1A\u8FDB\u5165\u7B49\u5F85\u961F\u5217\u4E2D\uFF1B</p><p>\u975E\u516C\u5E73\u9501\uFF1A\u4E0D\u7BA1\u662F\u5426\u6709\u7B49\u5F85\u961F\u5217\uFF0C\u5982\u679C\u53EF\u4EE5\u83B7\u53D6\u9501\uFF0C\u5219\u7ACB\u523B\u5360\u6709\u9501\u5BF9\u8C61\u3002\u4E5F\u5C31\u662F\u8BF4\u961F\u5217\u7684\u7B2C\u4E00\u4E2A\u6392\u961F\u7EBF\u7A0B\u5728unpark()\uFF0C\u4E4B\u540E\u8FD8\u662F\u9700\u8981\u7ADE\u4E89\u9501\uFF08\u5B58\u5728\u7EBF\u7A0B\u7ADE\u4E89\u7684\u60C5\u51B5\u4E0B\uFF09</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929215348250.png" alt="image-20210929215348250"></p><h4 id="_4\u3001\u6E90\u7801\u89E3\u8BFB" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u6E90\u7801\u89E3\u8BFB" aria-hidden="true">#</a> 4\u3001\u6E90\u7801\u89E3\u8BFB</h4><h5 id="_1\u3001lock-1" tabindex="-1"><a class="header-anchor" href="#_1\u3001lock-1" aria-hidden="true">#</a> 1\u3001lock()</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929215500057.png" alt="image-20210929215500057"></p><h5 id="_2\u3001acquire" tabindex="-1"><a class="header-anchor" href="#_2\u3001acquire" aria-hidden="true">#</a> 2\u3001acquire()</h5><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929215527782.png" alt="image-20210929215527782"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929215532317.png" alt="image-20210929215532317"></p><h5 id="_3\u3001tryacquire-arg" tabindex="-1"><a class="header-anchor" href="#_3\u3001tryacquire-arg" aria-hidden="true">#</a> 3\u3001tryAcquire(arg)</h5><p>\u975E\u516C\u5E73\u9501</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929215617239.png" alt="image-20210929215617239"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929215622470.png" alt="image-20210929215622470"></p><p>nonfairTryAcquire(acquires)</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929215636783.png" alt="image-20210929215636783"></p><p>return false; \u7EE7\u7EED\u63A8\u8FDB\u6761\u4EF6\uFF0C\u8D70\u4E0B\u4E00\u4E2A\u65B9\u6CD5</p><p>return true; \u7ED3\u675F</p><h5 id="_4\u3001addwaiter-node-exclusive" tabindex="-1"><a class="header-anchor" href="#_4\u3001addwaiter-node-exclusive" aria-hidden="true">#</a> 4\u3001addWaiter(Node.EXCLUSIVE)</h5><p>addWaiter(Node mode)</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929215721311.png" alt="image-20210929215721311"></p><p>enq(node);</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929215749207.png" alt="image-20210929215749207"></p><p>\u53CC\u5411\u94FE\u8868\u4E2D\uFF0C\u7B2C\u4E00\u4E2A\u8282\u70B9\u4E3A\u865A\u8282\u70B9(\u4E5F\u53EB\u54E8\u5175\u8282\u70B9)\uFF0C\u5176\u5B9E\u5E76\u4E0D\u5B58\u50A8\u4EFB\u4F55\u4FE1\u606F\uFF0C\u53EA\u662F\u5360\u4F4D\u3002 \u771F\u6B63\u7684\u7B2C\u4E00\u4E2A\u6709\u6570\u636E\u7684\u8282\u70B9\uFF0C\u662F\u4ECE\u7B2C\u4E8C\u4E2A\u8282\u70B9\u5F00\u59CB\u7684\u3002</p><p>\u5047\u59823\u53F7ThreadC\u7EBF\u7A0B\u8FDB\u6765</p><p>prev - compareAndSetTail - next</p><h5 id="_5\u3001acquirequeued-addwaiter-node-exclusive-arg" tabindex="-1"><a class="header-anchor" href="#_5\u3001acquirequeued-addwaiter-node-exclusive-arg" aria-hidden="true">#</a> 5\u3001acquireQueued(addWaiter(Node.EXCLUSIVE), arg)</h5><p>acquireQueued</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929215842781.png" alt="image-20210929215842781"></p><p>\u5047\u5982\u518D\u62A2\u62A2\u5931\u8D25\u5C31\u4F1A\u8FDB\u5165</p><p>shouldParkAfterFailedAcquire \u548C parkAndCheckInterrupt \u65B9\u6CD5\u4E2D</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929215859160.png" alt="image-20210929215859160"></p><p>shouldParkAfterFailedAcquire</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929215907481.png" alt="image-20210929215907481"></p><p>\u200B \u5982\u679C\u524D\u9A71\u8282\u70B9\u7684 <code>waitStatus</code> \u662F <code>SIGNAL</code>\u72B6\u6001\uFF0C\u5373 <code>shouldParkAfterFailedAcquire</code> \u65B9\u6CD5\u4F1A\u8FD4\u56DE <code>true</code> \u7A0B\u5E8F\u4F1A\u7EE7\u7EED\u5411\u4E0B\u6267\u884C <code>parkAndCheckInterrupt</code> \u65B9\u6CD5\uFF0C\u7528\u4E8E\u5C06\u5F53\u524D\u7EBF\u7A0B\u6302\u8D77</p><p><code>parkAndCheckInterrupt </code></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929215923254.png" alt="image-20210929215923254"></p><h4 id="_5\u3001unlock" tabindex="-1"><a class="header-anchor" href="#_5\u3001unlock" aria-hidden="true">#</a> 5\u3001unlock</h4><p>sync.release(1);</p><p>tryRelease(arg)</p><p>unparkSuccessor</p><h2 id="\u5341\u4E03\u3001reentrantlock\u3001reentrantreadwritelock\u3001stampedlock" tabindex="-1"><a class="header-anchor" href="#\u5341\u4E03\u3001reentrantlock\u3001reentrantreadwritelock\u3001stampedlock" aria-hidden="true">#</a> \u5341\u4E03\u3001ReentrantLock\u3001ReentrantReadWriteLock\u3001StampedLock</h2><h3 id="_1\u3001reentrantreadwritelock" tabindex="-1"><a class="header-anchor" href="#_1\u3001reentrantreadwritelock" aria-hidden="true">#</a> 1\u3001ReentrantReadWriteLock</h3><p>\u8BFB\u5199\u9501\u5B9A\u4E49\u4E3A\uFF1A\u4E00\u4E2A\u8D44\u6E90\u80FD\u591F\u88AB\u591A\u4E2A\u8BFB\u7EBF\u7A0B\u8BBF\u95EE\uFF0C\u6216\u8005\u88AB\u4E00\u4E2A\u5199\u7EBF\u7A0B\u8BBF\u95EE\uFF0C\u4F46\u662F\u4E0D\u80FD\u540C\u65F6\u5B58\u5728\u8BFB\u5199\u7EBF\u7A0B\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929220234946.png" alt="image-20210929220234946"></p><h4 id="_1\u3001\u8BFB\u5199\u9501\u610F\u4E49\u548C\u7279\u70B9" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u8BFB\u5199\u9501\u610F\u4E49\u548C\u7279\u70B9" aria-hidden="true">#</a> 1\u3001\u8BFB\u5199\u9501\u610F\u4E49\u548C\u7279\u70B9</h4><p>\u200B \u8BFB\u5199\u9501<code>ReentrantReadWriteLock</code>\u5E76\u4E0D\u662F\u771F\u6B63\u610F\u4E49\u4E0A\u7684\u8BFB\u5199\u5206\u79BB\uFF0C\u5B83\u53EA\u5141\u8BB8\u8BFB\u8BFB\u5171\u5B58\uFF0C\u800C\u8BFB\u5199\u548C\u5199\u5199\u4F9D\u7136\u662F\u4E92\u65A5\u7684\uFF0C \u5927\u591A\u5B9E\u9645\u573A\u666F\u662F\u201C\u8BFB/\u8BFB\u201D\u7EBF\u7A0B\u95F4\u5E76\u4E0D\u5B58\u5728\u4E92\u65A5\u5173\u7CFB\uFF0C\u53EA\u6709&quot;\u8BFB/\u5199&quot;\u7EBF\u7A0B\u6216&quot;\u5199/\u5199&quot;\u7EBF\u7A0B\u95F4\u7684\u64CD\u4F5C\u9700\u8981\u4E92\u65A5\u7684\u3002\u56E0\u6B64\u5F15\u5165ReentrantReadWriteLock\u3002</p><p>\u200B \u4E00\u4E2A<code>ReentrantReadWriteLock</code>\u540C\u65F6\u53EA\u80FD\u5B58\u5728\u4E00\u4E2A\u5199\u9501\u4F46\u662F\u53EF\u4EE5\u5B58\u5728\u591A\u4E2A\u8BFB\u9501\uFF0C\u4F46\u4E0D\u80FD\u540C\u65F6\u5B58\u5728\u5199\u9501\u548C\u8BFB\u9501(\u5207\u83DC\u8FD8\u662F\u62CD\u849C\u9009\u4E00\u4E2A)\u3002\u4E5F\u5373\u4E00\u4E2A\u8D44\u6E90\u53EF\u4EE5\u88AB\u591A\u4E2A\u8BFB\u64CD\u4F5C\u8BBF\u95EE\u6216\u4E00\u4E2A\u5199\u64CD\u4F5C\u8BBF\u95EE\uFF0C\u4F46\u4E24\u8005\u4E0D\u80FD\u540C\u65F6\u8FDB\u884C\u3002</p><p>\u53EA\u6709\u5728\u8BFB\u591A\u5199\u5C11\u60C5\u5883\u4E4B\u4E0B\uFF0C\u8BFB\u5199\u9501\u624D\u5177\u6709\u8F83\u9AD8\u7684\u6027\u80FD\u4F53\u73B0\u3002</p><h4 id="_2\u3001\u7279\u70B9" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u7279\u70B9" aria-hidden="true">#</a> 2\u3001\u7279\u70B9</h4><ul><li>\u53EF\u91CD\u5165</li><li>\u8BFB\u5199\u5206\u79BB</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReentrantReadWriteLockDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">MyResource</span> myResource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> finalI <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                myResource<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>finalI <span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> finalI <span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> finalI <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                myResource<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>finalI <span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">//\u8BFB\u5168\u90E8over\u624D\u53EF\u4EE5\u7EE7\u7EED\u5199</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> finalI <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                myResource<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>finalI <span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> finalI <span class="token operator">+</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;newWriteThread===&quot;</span><span class="token operator">+</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3\u3001\u4ECE\u5199\u9501\u2192\u8BFB\u9501-reentrantreadwritelock\u53EF\u4EE5\u964D\u7EA7" tabindex="-1"><a class="header-anchor" href="#_3\u3001\u4ECE\u5199\u9501\u2192\u8BFB\u9501-reentrantreadwritelock\u53EF\u4EE5\u964D\u7EA7" aria-hidden="true">#</a> 3\u3001\u4ECE\u5199\u9501\u2192\u8BFB\u9501\uFF0CReentrantReadWriteLock\u53EF\u4EE5\u964D\u7EA7</h4><p>\u300AJava \u5E76\u53D1\u7F16\u7A0B\u7684\u827A\u672F\u300B\u4E2D\u5173\u4E8E\u9501\u964D\u7EA7\u7684\u8BF4\u660E\uFF1A</p><p>\u9501\u7684\u4E25\u82DB\u7A0B\u5EA6\u53D8\u5F3A\u53EB\u505A\u5347\u7EA7\uFF0C\u53CD\u4E4B\u53EB\u505A\u964D\u7EA7</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929220521703.png" alt="image-20210929220521703"></p><p>\u9501\u964D\u7EA7\uFF1A\u5C06\u5199\u5165\u9501\u964D\u7EA7\u4E3A\u8BFB\u9501(\u7C7B\u4F3CLinux\u6587\u4EF6\u8BFB\u5199\u6743\u9650\u7406\u89E3\uFF0C\u5C31\u50CF\u5199\u6743\u9650\u8981\u9AD8\u4E8E\u8BFB\u6743\u9650\u4E00\u6837)</p><h5 id="_1\u3001\u8BFB\u5199\u9501\u964D\u7EA7\u6F14\u793A" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u8BFB\u5199\u9501\u964D\u7EA7\u6F14\u793A" aria-hidden="true">#</a> 1\u3001\u8BFB\u5199\u9501\u964D\u7EA7\u6F14\u793A</h5><p>\u53EF\u4EE5\u964D\u7EA7</p><p>\u9501\u964D\u7EA7\uFF1A\u9075\u5FAA\u83B7\u53D6\u5199\u9501\u2192\u518D\u83B7\u53D6\u8BFB\u9501\u2192\u518D\u91CA\u653E\u5199\u9501\u7684\u6B21\u5E8F\uFF0C\u5199\u9501\u80FD\u591F\u964D\u7EA7\u6210\u4E3A\u8BFB\u9501\u3002 \u5982\u679C\u4E00\u4E2A\u7EBF\u7A0B\u5360\u6709\u4E86\u5199\u9501\uFF0C\u5728\u4E0D\u91CA\u653E\u5199\u9501\u7684\u60C5\u51B5\u4E0B\uFF0C\u5B83\u8FD8\u80FD\u5360\u6709\u8BFB\u9501\uFF0C\u5373\u5199\u9501\u964D\u7EA7\u4E3A\u8BFB\u9501\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929220618332.png" alt="image-20210929220618332"></p><p>Java8 \u5B98\u7F51\u8BF4\u660E</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929220638216.png" alt="image-20210929220638216"></p><p>\u91CD\u5165\u8FD8\u5141\u8BB8\u901A\u8FC7\u83B7\u53D6\u5199\u5165\u9501\u5B9A\uFF0C\u7136\u540E\u8BFB\u53D6\u9501\u7136\u540E\u91CA\u653E\u5199\u9501\u4ECE\u5199\u9501\u5230\u8BFB\u53D6\u9501, \u4F46\u662F\uFF0C\u4ECE\u8BFB\u9501\u5B9A\u5347\u7EA7\u5230\u5199\u9501\u662F\u4E0D\u53EF\u80FD\u7684\u3002</p><p><strong>\u9501\u964D\u7EA7\u662F\u4E3A\u4E86\u8BA9\u5F53\u524D\u7EBF\u7A0B\u611F\u77E5\u5230\u6570\u636E\u7684\u53D8\u5316\uFF0C\u76EE\u7684\u662F\u4FDD\u8BC1\u6570\u636E\u53EF\u89C1\u6027</strong></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * \u9501\u964D\u7EA7\uFF1A\u9075\u5FAA\u83B7\u53D6\u5199\u9501\u2192\u518D\u83B7\u53D6\u8BFB\u9501\u2192\u518D\u91CA\u653E\u5199\u9501\u7684\u6B21\u5E8F\uFF0C\u5199\u9501\u80FD\u591F\u964D\u7EA7\u6210\u4E3A\u8BFB\u9501\u3002
 *
 * \u5982\u679C\u4E00\u4E2A\u7EBF\u7A0B\u5360\u6709\u4E86\u5199\u9501\uFF0C\u5728\u4E0D\u91CA\u653E\u5199\u9501\u7684\u60C5\u51B5\u4E0B\uFF0C\u5B83\u8FD8\u80FD\u5360\u6709\u8BFB\u9501\uFF0C\u5373\u5199\u9501\u964D\u7EA7\u4E3A\u8BFB\u9501\u3002
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockDownGradingDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">ReentrantReadWriteLock</span> readWriteLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ReentrantReadWriteLock<span class="token punctuation">.</span>ReadLock</span> readLock <span class="token operator">=</span> readWriteLock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ReentrantReadWriteLock<span class="token punctuation">.</span>WriteLock</span> writeLock <span class="token operator">=</span> readWriteLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        writeLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------\u6B63\u5728\u5199\u5165&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        readLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-------\u6B63\u5728\u8BFB\u53D6&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        writeLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u5982\u679C\u6709\u7EBF\u7A0B\u5728\u8BFB\uFF0C\u90A3\u4E48\u5199\u7EBF\u7A0B\u662F\u65E0\u6CD5\u83B7\u53D6\u5199\u9501\u7684\uFF0C\u662F\u60B2\u89C2\u9501\u7684\u7B56\u7565</strong></p><p>\u4E0D\u53EF\u9501\u5347\u7EA7</p><p>\u7EBF\u7A0B\u83B7\u53D6\u8BFB\u9501\u662F\u4E0D\u80FD\u76F4\u63A5\u5347\u7EA7\u4E3A\u5199\u5165\u9501\u7684\u3002</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929220808008.png" alt="image-20210929220808008"></p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929220811350.png" alt="image-20210929220811350"></p><p>\u5728ReentrantReadWriteLock\u4E2D\uFF0C\u5F53\u8BFB\u9501\u88AB\u4F7F\u7528\u65F6\uFF0C\u5982\u679C\u6709\u7EBF\u7A0B\u5C1D\u8BD5\u83B7\u53D6\u5199\u9501\uFF0C\u8BE5\u5199\u7EBF\u7A0B\u4F1A\u88AB\u963B\u585E\u3002\u6240\u4EE5\uFF0C\u9700\u8981\u91CA\u653E\u6240\u6709\u8BFB\u9501\uFF0C\u624D\u53EF\u83B7\u53D6\u5199\u9501\uFF0C</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929220821174.png" alt="image-20210929220821174"></p><h5 id="_2\u3001\u5199\u9501\u548C\u8BFB\u9501\u662F\u4E92\u65A5\u7684" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5199\u9501\u548C\u8BFB\u9501\u662F\u4E92\u65A5\u7684" aria-hidden="true">#</a> 2\u3001\u5199\u9501\u548C\u8BFB\u9501\u662F\u4E92\u65A5\u7684</h5><p>\u200B \u5199\u9501\u548C\u8BFB\u9501\u662F\u4E92\u65A5\u7684\uFF08\u8FD9\u91CC\u7684\u4E92\u65A5\u662F\u6307\u7EBF\u7A0B\u95F4\u7684\u4E92\u65A5\uFF0C\u5F53\u524D\u7EBF\u7A0B\u53EF\u4EE5\u83B7\u53D6\u5230\u5199\u9501\u53C8\u83B7\u53D6\u5230\u8BFB\u9501\uFF0C\u4F46\u662F\u83B7\u53D6\u5230\u4E86\u8BFB\u9501\u4E0D\u80FD\u7EE7\u7EED\u83B7\u53D6\u5199\u9501\uFF09\uFF0C\u8FD9\u662F\u56E0\u4E3A\u8BFB\u5199\u9501\u8981\u4FDD\u6301\u5199\u64CD\u4F5C\u7684\u53EF\u89C1\u6027\u3002\u56E0\u4E3A\uFF0C\u5982\u679C\u5141\u8BB8\u8BFB\u9501\u5728\u88AB\u83B7\u53D6\u7684\u60C5\u51B5\u4E0B\u5BF9\u5199\u9501\u7684\u83B7\u53D6\uFF0C\u90A3\u4E48\u6B63\u5728\u8FD0\u884C\u7684\u5176\u4ED6\u8BFB\u7EBF\u7A0B\u65E0\u6CD5\u611F\u77E5\u5230\u5F53\u524D\u5199\u7EBF\u7A0B\u7684\u64CD\u4F5C</p><p>\u200B \u56E0\u6B64\uFF0C\u5206\u6790\u8BFB\u5199\u9501ReentrantReadWriteLock\uFF0C\u4F1A\u53D1\u73B0\u5B83\u6709\u4E2A\u6F5C\u5728\u7684\u95EE\u9898\uFF1A\u8BFB\u9501\u5168\u5B8C\uFF0C\u5199\u9501\u6709\u671B\uFF1B\u5199\u9501\u72EC\u5360\uFF0C\u8BFB\u5199\u5168\u5835\uFF1B\u5982\u679C\u6709\u7EBF\u7A0B\u6B63\u5728\u8BFB\uFF0C\u5199\u7EBF\u7A0B\u9700\u8981\u7B49\u5F85\u8BFB\u7EBF\u7A0B\u91CA\u653E\u9501\u540E\u624D\u80FD\u83B7\u53D6\u5199\u9501\uFF0C\u89C1\u524D\u9762Case\u300Acode\u6F14\u793ALockDownGradingDemo\u300B\u5373ReadWriteLock\u8BFB\u7684\u8FC7\u7A0B\u4E2D\u4E0D\u5141\u8BB8\u5199\uFF0C\u53EA\u6709\u7B49\u5F85\u7EBF\u7A0B\u90FD\u91CA\u653E\u4E86\u8BFB\u9501\uFF0C\u5F53\u524D\u7EBF\u7A0B\u624D\u80FD\u83B7\u53D6\u5199\u9501\uFF0C\u4E5F\u5C31\u662F\u5199\u5165\u5FC5\u987B\u7B49\u5F85\uFF0C\u8FD9\u662F\u4E00\u79CD\u60B2\u89C2\u7684\u8BFB\u9501\uFF0Co(\u2565\uFE4F\u2565)o\uFF0C\u4EBA\u5BB6\u8FD8\u5728\u8BFB\u7740\u90A3\uFF0C\u4F60\u5148\u522B\u53BB\u5199\uFF0C\u7701\u7684\u6570\u636E\u4E71\u3002</p><p>\u200B \u5206\u6790StampedLock(\u540E\u9762\u8BE6\u7EC6\u8BB2\u89E3)\uFF0C\u4F1A\u53D1\u73B0\u5B83\u6539\u8FDB\u4E4B\u5904\u5728\u4E8E\uFF1A\u8BFB\u7684\u8FC7\u7A0B\u4E2D\u4E5F\u5141\u8BB8\u83B7\u53D6\u5199\u9501\u4ECB\u5165(\u76F8\u5F53\u725BB\uFF0C\u8BFB\u548C\u5199\u4E24\u4E2A\u64CD\u4F5C\u4E5F\u8BA9\u4F60\u201C\u5171\u4EAB\u201D(\u6CE8\u610F\u5F15\u53F7))\uFF0C\u8FD9\u6837\u4F1A\u5BFC\u81F4\u6211\u4EEC\u8BFB\u7684\u6570\u636E\u5C31\u53EF\u80FD\u4E0D\u4E00\u81F4\uFF01\u6240\u4EE5\uFF0C\u9700\u8981\u989D\u5916\u7684\u65B9\u6CD5\u6765\u5224\u65AD\u8BFB\u7684\u8FC7\u7A0B\u4E2D\u662F\u5426\u6709\u5199\u5165\uFF0C\u8FD9\u662F\u4E00\u79CD\u4E50\u89C2\u7684\u8BFB\u9501\uFF0CO(\u2229_\u2229)O\u54C8\u54C8~\u3002 \u663E\u7136\u4E50\u89C2\u9501\u7684\u5E76\u53D1\u6548\u7387\u66F4\u9AD8\uFF0C\u4F46\u4E00\u65E6\u6709\u5C0F\u6982\u7387\u7684\u5199\u5165\u5BFC\u81F4\u8BFB\u53D6\u7684\u6570\u636E\u4E0D\u4E00\u81F4\uFF0C\u9700\u8981\u80FD\u68C0\u6D4B\u51FA\u6765\uFF0C\u518D\u8BFB\u4E00\u904D\u5C31\u884C\u3002</p><h4 id="_4\u3001\u8BFB\u5199\u9501\u4E4B\u8BFB\u5199\u89C4\u77E9-\u518D\u8BF4\u964D\u7EA7" tabindex="-1"><a class="header-anchor" href="#_4\u3001\u8BFB\u5199\u9501\u4E4B\u8BFB\u5199\u89C4\u77E9-\u518D\u8BF4\u964D\u7EA7" aria-hidden="true">#</a> 4\u3001\u8BFB\u5199\u9501\u4E4B\u8BFB\u5199\u89C4\u77E9\uFF0C\u518D\u8BF4\u964D\u7EA7</h4><p>\u9501\u964D\u7EA7 \u4E0B\u9762\u7684\u793A\u4F8B\u4EE3\u7801\u6458\u81EAReentrantWriteReadLock\u6E90\u7801\u4E2D\uFF1A ReentrantWriteReadLock\u652F\u6301\u9501\u964D\u7EA7\uFF0C\u9075\u5FAA\u6309\u7167\u83B7\u53D6\u5199\u9501\uFF0C\u83B7\u53D6\u8BFB\u9501\u518D\u91CA\u653E\u5199\u9501\u7684\u6B21\u5E8F\uFF0C\u5199\u9501\u80FD\u591F\u964D\u7EA7\u6210\u4E3A\u8BFB\u9501\uFF0C\u4E0D\u652F\u6301\u9501\u5347\u7EA7\u3002 \u89E3\u8BFB\u5728\u6700\u4E0B\u9762:</p><p><img src="http://122.9.159.116:5244/d/ecloud180/images/blogImage/JUC\u5E76\u53D1\u7F16\u7A0B/image-20210929221016416.png" alt="image-20210929221016416"></p><ol><li><p>\u4EE3\u7801\u4E2D\u58F0\u660E\u4E86\u4E00\u4E2Avolatile\u7C7B\u578B\u7684cacheValid\u53D8\u91CF\uFF0C\u4FDD\u8BC1\u5176\u53EF\u89C1\u6027\u3002</p></li><li><p>\u9996\u5148\u83B7\u53D6\u8BFB\u9501\uFF0C\u5982\u679Ccache\u4E0D\u53EF\u7528\uFF0C\u5219\u91CA\u653E\u8BFB\u9501\uFF0C\u83B7\u53D6\u5199\u9501\uFF0C\u5728\u66F4\u6539\u6570\u636E\u4E4B\u524D\uFF0C\u518D\u68C0\u67E5\u4E00\u6B21cacheValid\u7684\u503C\uFF0C\u7136\u540E\u4FEE\u6539\u6570\u636E\uFF0C\u5C06cacheValid\u7F6E\u4E3Atrue\uFF0C\u7136\u540E\u5728\u91CA\u653E\u5199\u9501\u524D\u83B7\u53D6\u8BFB\u9501\uFF1B\u6B64\u65F6\uFF0Ccache\u4E2D\u6570\u636E\u53EF\u7528\uFF0C\u5904\u7406cache\u4E2D\u6570\u636E\uFF0C\u6700\u540E\u91CA\u653E\u8BFB\u9501\u3002\u8FD9\u4E2A\u8FC7\u7A0B\u5C31\u662F\u4E00\u4E2A\u5B8C\u6574\u7684\u9501\u964D\u7EA7\u7684\u8FC7\u7A0B\uFF0C\u76EE\u7684\u662F\u4FDD\u8BC1\u6570\u636E\u53EF\u89C1\u6027\u3002</p></li></ol><ul><li><p>\u5982\u679C\u8FDD\u80CC\u9501\u964D\u7EA7\u7684\u6B65\u9AA4</p><ul><li>\u5982\u679C\u5F53\u524D\u7684\u7EBF\u7A0BC\u5728\u4FEE\u6539\u5B8Ccache\u4E2D\u7684\u6570\u636E\u540E\uFF0C\u6CA1\u6709\u83B7\u53D6\u8BFB\u9501\u800C\u662F\u76F4\u63A5\u91CA\u653E\u4E86\u5199\u9501\uFF0C\u90A3\u4E48\u5047\u8BBE\u6B64\u65F6\u53E6\u4E00\u4E2A\u7EBF\u7A0BD\u83B7\u53D6\u4E86\u5199\u9501\u5E76\u4FEE\u6539\u4E86\u6570\u636E\uFF0C\u90A3\u4E48C\u7EBF\u7A0B\u65E0\u6CD5\u611F\u77E5\u5230\u6570\u636E\u5DF2\u88AB\u4FEE\u6539\uFF0C\u5219\u6570\u636E\u51FA\u73B0\u9519\u8BEF\u3002</li></ul></li><li><p>\u5982\u679C\u9075\u5FAA\u9501\u964D\u7EA7\u7684\u6B65\u9AA4</p><ul><li>\u7EBF\u7A0BC\u5728\u91CA\u653E\u5199\u9501\u4E4B\u524D\u83B7\u53D6\u8BFB\u9501\uFF0C\u90A3\u4E48\u7EBF\u7A0BD\u5728\u83B7\u53D6\u5199\u9501\u65F6\u5C06\u88AB\u963B\u585E\uFF0C\u76F4\u5230\u7EBF\u7A0BC\u5B8C\u6210\u6570\u636E\u5904\u7406\u8FC7\u7A0B\uFF0C\u91CA\u653E\u8BFB\u9501\u3002\u8FD9\u6837\u53EF\u4EE5\u4FDD\u8BC1\u8FD4\u56DE\u7684\u6570\u636E\u662F\u8FD9\u6B21\u66F4\u65B0\u7684\u6570\u636E\uFF0C\u8BE5\u673A\u5236\u662F\u4E13\u95E8\u4E3A\u4E86\u7F13\u5B58\u8BBE\u8BA1\u7684\u3002</li></ul></li></ul><h3 id="_2\u3001\u90AE\u6233\u9501stampedlock" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u90AE\u6233\u9501stampedlock" aria-hidden="true">#</a> 2\u3001\u90AE\u6233\u9501StampedLock</h3><p>\u65E0\u9501\u2192\u72EC\u5360\u9501\u2192\u8BFB\u5199\u9501\u2192\u90AE\u6233\u9501</p><h4 id="_1\u3001stampedlock\u662F\u4EC0\u4E48" tabindex="-1"><a class="header-anchor" href="#_1\u3001stampedlock\u662F\u4EC0\u4E48" aria-hidden="true">#</a> 1\u3001StampedLock\u662F\u4EC0\u4E48</h4><p>StampedLock\u662FJDK1.8\u4E2D\u65B0\u589E\u7684\u4E00\u4E2A\u8BFB\u5199\u9501\uFF0C\u4E5F\u662F\u5BF9JDK1.5\u4E2D\u7684\u8BFB\u5199\u9501ReentrantReadWriteLock\u7684\u4F18\u5316\u3002</p><p>\u90AE\u6233\u9501 - \u4E5F\u53EB\u7968\u636E\u9501</p><blockquote><p>stamp\uFF08\u6233\u8BB0\uFF0Clong\u7C7B\u578B\uFF09</p><p>\u4EE3\u8868\u4E86\u9501\u7684\u72B6\u6001\u3002\u5F53stamp\u8FD4\u56DE\u96F6\u65F6\uFF0C\u8868\u793A\u7EBF\u7A0B\u83B7\u53D6\u9501\u5931\u8D25\u3002\u5E76\u4E14\uFF0C\u5F53\u91CA\u653E\u9501\u6216\u8005\u8F6C\u6362\u9501\u7684\u65F6\u5019\uFF0C\u90FD\u8981\u4F20\u5165\u6700\u521D\u83B7\u53D6\u7684stamp\u503C\u3002</p></blockquote><h4 id="_2\u3001\u5B83\u662F\u7531\u9501\u9965\u997F\u95EE\u9898\u5F15\u51FA" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u5B83\u662F\u7531\u9501\u9965\u997F\u95EE\u9898\u5F15\u51FA" aria-hidden="true">#</a> 2\u3001\u5B83\u662F\u7531\u9501\u9965\u997F\u95EE\u9898\u5F15\u51FA</h4><p>\u200B ReentrantReadWriteLock\u5B9E\u73B0\u4E86\u8BFB\u5199\u5206\u79BB\uFF0C\u4F46\u662F\u4E00\u65E6\u8BFB\u64CD\u4F5C\u6BD4\u8F83\u591A\u7684\u65F6\u5019\uFF0C\u60F3\u8981\u83B7\u53D6\u5199\u9501\u5C31\u53D8\u5F97\u6BD4\u8F83\u56F0\u96BE\u4E86\uFF0C\u5047\u5982\u5F53\u524D1000\u4E2A\u7EBF\u7A0B\uFF0C999\u4E2A\u8BFB\uFF0C1\u4E2A\u5199\uFF0C\u6709\u53EF\u80FD999\u4E2A\u8BFB\u53D6\u7EBF\u7A0B\u957F\u65F6\u95F4\u62A2\u5230\u4E86\u9501\uFF0C\u90A31\u4E2A\u5199\u7EBF\u7A0B\u5C31\u60B2\u5267\u4E86 \u56E0\u4E3A\u5F53\u524D\u6709\u53EF\u80FD\u4F1A\u4E00\u76F4\u5B58\u5728\u8BFB\u9501\uFF0C\u800C\u65E0\u6CD5\u83B7\u5F97\u5199\u9501\uFF0C\u6839\u672C\u6CA1\u673A\u4F1A\u5199\uFF0C</p><h5 id="_1\u3001\u5982\u4F55\u7F13\u89E3\u9501\u9965\u997F\u95EE\u9898" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5982\u4F55\u7F13\u89E3\u9501\u9965\u997F\u95EE\u9898" aria-hidden="true">#</a> 1\u3001\u5982\u4F55\u7F13\u89E3\u9501\u9965\u997F\u95EE\u9898\uFF1F</h5><p>\u4F7F\u7528\u201C\u516C\u5E73\u201D\u7B56\u7565\u53EF\u4EE5\u4E00\u5B9A\u7A0B\u5EA6\u4E0A\u7F13\u89E3\u8FD9\u4E2A\u95EE\u9898</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u4F46\u662F\u201C\u516C\u5E73\u201D\u7B56\u7565\u662F\u4EE5\u727A\u7272\u7CFB\u7EDF\u541E\u5410\u91CF\u4E3A\u4EE3\u4EF7\u7684</p><p><strong>StampedLock\u7C7B\u7684\u4E50\u89C2\u8BFB\u9501\u95EA\u4EAE\u767B\u573A</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ReentrantReadWriteLock
\u5141\u8BB8\u591A\u4E2A\u7EBF\u7A0B\u540C\u65F6\u8BFB\uFF0C\u4F46\u662F\u53EA\u5141\u8BB8\u4E00\u4E2A\u7EBF\u7A0B\u5199\uFF0C\u5728\u7EBF\u7A0B\u83B7\u53D6\u5230\u5199\u9501\u7684\u65F6\u5019\uFF0C\u5176\u4ED6\u5199\u64CD\u4F5C\u548C\u8BFB\u64CD\u4F5C\u90FD\u4F1A\u5904\u4E8E\u963B\u585E\u72B6\u6001\uFF0C
\u8BFB\u9501\u548C\u5199\u9501\u4E5F\u662F\u4E92\u65A5\u7684\uFF0C\u6240\u4EE5\u5728\u8BFB\u7684\u65F6\u5019\u662F\u4E0D\u5141\u8BB8\u5199\u7684\uFF0C\u8BFB\u5199\u9501\u6BD4\u4F20\u7EDF\u7684synchronized\u901F\u5EA6\u8981\u5FEB\u5F88\u591A\uFF0C
\u539F\u56E0\u5C31\u662F\u5728\u4E8EReentrantReadWriteLock\u652F\u6301\u8BFB\u5E76\u53D1

StampedLock\u6A2A\u7A7A\u51FA\u4E16
ReentrantReadWriteLock\u7684\u8BFB\u9501\u88AB\u5360\u7528\u7684\u65F6\u5019\uFF0C\u5176\u4ED6\u7EBF\u7A0B\u5C1D\u8BD5\u83B7\u53D6\u5199\u9501\u7684\u65F6\u5019\u4F1A\u88AB\u963B\u585E\u3002
\u4F46\u662F\uFF0CStampedLock\u91C7\u53D6\u4E50\u89C2\u83B7\u53D6\u9501\u540E\uFF0C\u5176\u4ED6\u7EBF\u7A0B\u5C1D\u8BD5\u83B7\u53D6\u5199\u9501\u65F6\u4E0D\u4F1A\u88AB\u963B\u585E\uFF0C\u8FD9\u5176\u5B9E\u662F\u5BF9\u8BFB\u9501\u7684\u4F18\u5316\uFF0C
\u6240\u4EE5\uFF0C\u5728\u83B7\u53D6\u4E50\u89C2\u8BFB\u9501\u540E\uFF0C\u8FD8\u9700\u8981\u5BF9\u7ED3\u679C\u8FDB\u884C\u6821\u9A8C\u3002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3\u3001stampedlock\u7684\u7279\u70B9" tabindex="-1"><a class="header-anchor" href="#_3\u3001stampedlock\u7684\u7279\u70B9" aria-hidden="true">#</a> 3\u3001StampedLock\u7684\u7279\u70B9</h4><ul><li>\u6240\u6709\u83B7\u53D6\u9501\u7684\u65B9\u6CD5\uFF0C\u90FD\u8FD4\u56DE\u4E00\u4E2A\u90AE\u6233\uFF08Stamp\uFF09\uFF0CStamp\u4E3A\u96F6\u8868\u793A\u83B7\u53D6\u5931\u8D25\uFF0C\u5176\u4F59\u90FD\u8868\u793A\u6210\u529F\uFF1B</li><li>\u6240\u6709\u91CA\u653E\u9501\u7684\u65B9\u6CD5\uFF0C\u90FD\u9700\u8981\u4E00\u4E2A\u90AE\u6233\uFF08Stamp\uFF09\uFF0C\u8FD9\u4E2AStamp\u5FC5\u987B\u662F\u548C\u6210\u529F\u83B7\u53D6\u9501\u65F6\u5F97\u5230\u7684Stamp\u4E00\u81F4\uFF1B</li><li>StampedLock\u662F\u4E0D\u53EF\u91CD\u5165\u7684\uFF0C\u5371\u9669(\u5982\u679C\u4E00\u4E2A\u7EBF\u7A0B\u5DF2\u7ECF\u6301\u6709\u4E86\u5199\u9501\uFF0C\u518D\u53BB\u83B7\u53D6\u5199\u9501\u7684\u8BDD\u5C31\u4F1A\u9020\u6210\u6B7B\u9501)</li></ul><h5 id="_1\u3001stampedlock\u6709\u4E09\u79CD\u8BBF\u95EE\u6A21\u5F0F" tabindex="-1"><a class="header-anchor" href="#_1\u3001stampedlock\u6709\u4E09\u79CD\u8BBF\u95EE\u6A21\u5F0F" aria-hidden="true">#</a> 1\u3001StampedLock\u6709\u4E09\u79CD\u8BBF\u95EE\u6A21\u5F0F</h5><ol><li><p>Reading\uFF08\u8BFB\u6A21\u5F0F\uFF09\uFF1A\u529F\u80FD\u548CReentrantReadWriteLock\u7684\u8BFB\u9501\u7C7B\u4F3C</p></li><li><p>Writing\uFF08\u5199\u6A21\u5F0F\uFF09\uFF1A\u529F\u80FD\u548CReentrantReadWriteLock\u7684\u5199\u9501\u7C7B\u4F3C</p></li><li><p>Optimistic reading\uFF08\u4E50\u89C2\u8BFB\u6A21\u5F0F\uFF09\uFF1A\u65E0\u9501\u673A\u5236\uFF0C\u7C7B\u4F3C\u4E8E\u6570\u636E\u5E93\u4E2D\u7684\u4E50\u89C2\u9501\uFF0C\u652F\u6301\u8BFB\u5199\u5E76\u53D1\uFF0C\u5F88\u4E50\u89C2\u8BA4\u4E3A\u8BFB\u53D6\u65F6\u6CA1\u4EBA\u4FEE\u6539\uFF0C\u5047\u5982\u88AB\u4FEE\u6539\u518D\u5B9E\u73B0\u5347\u7EA7\u4E3A\u60B2\u89C2\u8BFB\u6A21\u5F0F</p></li></ol><h5 id="_2\u3001\u4E50\u89C2\u8BFB\u6A21\u5F0Fcode\u6F14\u793A" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u4E50\u89C2\u8BFB\u6A21\u5F0Fcode\u6F14\u793A" aria-hidden="true">#</a> 2\u3001\u4E50\u89C2\u8BFB\u6A21\u5F0Fcode\u6F14\u793A</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StampedLockDemo</span>
<span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> number <span class="token operator">=</span> <span class="token number">37</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token class-name">StampedLock</span> stampedLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StampedLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">long</span> stamp <span class="token operator">=</span> stampedLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;=====\u5199\u7EBF\u7A0B\u51C6\u5907\u4FEE\u6539&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span>
        <span class="token punctuation">{</span>
            number <span class="token operator">=</span> number <span class="token operator">+</span> <span class="token number">13</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            stampedLock<span class="token punctuation">.</span><span class="token function">unlockWrite</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot;=====\u5199\u7EBF\u7A0B\u7ED3\u675F\u4FEE\u6539&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//\u60B2\u89C2\u8BFB</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">long</span> stamp <span class="token operator">=</span> stampedLock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t come in readlock block,4 seconds continue...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u6682\u505C\u51E0\u79D2\u949F\u7EBF\u7A0B</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">4</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t \u6B63\u5728\u8BFB\u53D6\u4E2D......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">int</span> result <span class="token operator">=</span> number<span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span><span class="token string">&quot; \u83B7\u5F97\u6210\u5458\u53D8\u91CF\u503Cresult\uFF1A&quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u5199\u7EBF\u7A0B\u6CA1\u6709\u4FEE\u6539\u503C\uFF0C\u56E0\u4E3A stampedLock.readLock()\u8BFB\u7684\u65F6\u5019\uFF0C\u4E0D\u53EF\u4EE5\u5199\uFF0C\u8BFB\u5199\u4E92\u65A5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
            stampedLock<span class="token punctuation">.</span><span class="token function">unlockRead</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//\u4E50\u89C2\u8BFB</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">tryOptimisticRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">long</span> stamp <span class="token operator">=</span> stampedLock<span class="token punctuation">.</span><span class="token function">tryOptimisticRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> result <span class="token operator">=</span> number<span class="token punctuation">;</span>
        <span class="token comment">//\u95F4\u96944\u79D2\u949F\uFF0C\u6211\u4EEC\u5F88\u4E50\u89C2\u7684\u8BA4\u4E3A\u6CA1\u6709\u5176\u4ED6\u7EBF\u7A0B\u4FEE\u6539\u8FC7number\u503C\uFF0C\u5B9E\u9645\u9760\u5224\u65AD\u3002</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;4\u79D2\u524DstampedLock.validate\u503C(true\u65E0\u4FEE\u6539\uFF0Cfalse\u6709\u4FEE\u6539)&quot;</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span><span class="token operator">+</span>stampedLock<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">4</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t \u6B63\u5728\u8BFB\u53D6\u4E2D......&quot;</span><span class="token operator">+</span>i<span class="token operator">+</span>
                    <span class="token string">&quot;\u79D2\u540EstampedLock.validate\u503C(true\u65E0\u4FEE\u6539\uFF0Cfalse\u6709\u4FEE\u6539)&quot;</span><span class="token operator">+</span><span class="token string">&quot;\\t&quot;</span>
                    <span class="token operator">+</span>stampedLock<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>stampedLock<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u6709\u4EBA\u52A8\u8FC7--------\u5B58\u5728\u5199\u64CD\u4F5C\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            stamp <span class="token operator">=</span> stampedLock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u4ECE\u4E50\u89C2\u8BFB \u5347\u7EA7\u4E3A \u60B2\u89C2\u8BFB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                result <span class="token operator">=</span> number<span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u91CD\u65B0\u60B2\u89C2\u8BFB\u9501\u901A\u8FC7\u83B7\u53D6\u5230\u7684\u6210\u5458\u53D8\u91CF\u503Cresult\uFF1A&quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                stampedLock<span class="token punctuation">.</span><span class="token function">unlockRead</span><span class="token punctuation">(</span>stamp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;\\t finally value: &quot;</span><span class="token operator">+</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">StampedLockDemo</span> resource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StampedLockDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            resource<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//resource.tryOptimisticRead();</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;readThread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2\u79D2\u949F\u65F6\u4E50\u89C2\u8BFB\u5931\u8D25\uFF0C6\u79D2\u949F\u4E50\u89C2\u8BFB\u53D6\u6210\u529Fresource.tryOptimisticRead();\uFF0C\u4FEE\u6539\u5207\u6362\u6F14\u793A</span>
        <span class="token comment">//try { TimeUnit.SECONDS.sleep(6); } catch (InterruptedException e) { e.printStackTrace(); }</span>

        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            resource<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;writeThread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u8BFB\u7684\u8FC7\u7A0B\u4E2D\u4E5F\u5141\u8BB8\u83B7\u53D6\u5199\u9501\u4ECB\u5165</strong></p><h4 id="_4\u3001stampedlock\u7684\u7F3A\u70B9" tabindex="-1"><a class="header-anchor" href="#_4\u3001stampedlock\u7684\u7F3A\u70B9" aria-hidden="true">#</a> 4\u3001StampedLock\u7684\u7F3A\u70B9</h4><ul><li>StampedLock \u4E0D\u652F\u6301\u91CD\u5165\uFF0C\u6CA1\u6709Re\u5F00\u5934</li><li>StampedLock \u7684\u60B2\u89C2\u8BFB\u9501\u548C\u5199\u9501\u90FD\u4E0D\u652F\u6301\u6761\u4EF6\u53D8\u91CF\uFF08Condition\uFF09\uFF0C\u8FD9\u4E2A\u4E5F\u9700\u8981\u6CE8\u610F\u3002</li><li>\u4F7F\u7528 StampedLock\u4E00\u5B9A\u4E0D\u8981\u8C03\u7528\u4E2D\u65AD\u64CD\u4F5C\uFF0C\u5373\u4E0D\u8981\u8C03\u7528<code>interrupt()</code> \u65B9\u6CD5 <ul><li>\u5982\u679C\u9700\u8981\u652F\u6301\u4E2D\u65AD\u529F\u80FD\uFF0C\u4E00\u5B9A\u4F7F\u7528\u53EF\u4E2D\u65AD\u7684\u60B2\u89C2\u8BFB\u9501 <code>readLockInterruptibly()</code>\u548C\u5199\u9501<code>writeLockInterruptibly()</code></li></ul></li></ul>`,311);function T(j,q){const a=l("ExternalLinkIcon");return o(),c("div",null,[i,n("blockquote",null,[n("p",null,[k,n("a",r,[d,p(a)])])]),m,n("p",null,[n("a",v,[b,p(a)])]),n("p",null,[n("a",g,[h,p(a)])]),y,n("p",null,[n("a",w,[f,p(a)])]),S])}var I=e(u,[["render",T],["__file","JUC\u5E76\u53D1\u7F16\u7A0B.html.vue"]]);export{I as default};
