(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{567:function(e,n,t){"use strict";t.r(n);var r=t(1),a=Object(r.a)({},(function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"springboot-拦截器-自定义异常-自定义注解-全局异常处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#springboot-拦截器-自定义异常-自定义注解-全局异常处理"}},[e._v("#")]),e._v(" SpringBoot+拦截器+自定义异常+自定义注解+全局异常处理")]),e._v(" "),t("ul",[t("li",[t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("前言"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("资源权限"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("ul",[t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("1.静态资源准备"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("2.自定义一个异常，便于拦截抛出"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.全局异常处理"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("4.controller层"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("5.拦截器创建"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("6.将拦截器注入应用"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("7.验证查看结果"),t("OutboundLink")],1)])])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("操作权限"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("ul",[t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("1.和上面一样使用静态资源"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("2.自定义注解"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.controller层"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("4.修改一下之前的拦截器"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("5.验证结果"),t("OutboundLink")],1)])])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("角色权限"),t("OutboundLink")],1)])]),e._v(" "),t("li",[t("ul",[t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("1.静态对应关系"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("2.修改controller"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.修改一下拦截器"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("4.结果测试"),t("OutboundLink")],1)])])]),e._v(" "),t("li",[t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&chksm=fa496f8ecd3ee698f4954c00efb80fe955ec9198fff3ef4011e331aa37f55a6a17bc8c0335a8&scene=21&token=899450012&lang=zh_CN#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("总结"),t("OutboundLink")],1)])])]),e._v(" "),t("hr"),e._v(" "),t("h2",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("前言"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("提到权限管理这块肯定很多人第一想到的就是Springboot Security或者是Shiro安全框架，但本文介绍的并不是这两种，不是因为他们不好用，实在是自己太懒了，我觉得一个拦截器加上其他的一些处理就能满足项目的需求，我又何必去多用一个框架呢，这篇文章也不是去对比谁好谁坏，各位自行抉择。")]),e._v(" "),t("p",[e._v("我将权限管理分为三块：")]),e._v(" "),t("ol",[t("li",[t("strong",[e._v("资源权限")]),e._v(" ：将url当做资源，可以给每个账号动态划分Url权限，访问不同的URl；")]),e._v(" "),t("li",[t("strong",[e._v("操作权限")]),e._v(" ：将所有URL分为增、删、改、查4种操作权限，给用户分配对应的操作权限，如某个用户只有查操作权限那么他就无法做其他的操作；")]),e._v(" "),t("li",[t("strong",[e._v("角色权限")]),e._v(" ：系统有多个角色，每个角色的权限都不同，如一个管理后台有着账号管理模块、商品模块等，为超级管理员的角色就可以看到所有模块并操作，而为售后的角色就只能看到商品模块，即使他知道账号管理模块下的URL也无权限操作。然后为用户设置角色就有对应的权限；")])]),e._v(" "),t("blockquote",[t("p",[e._v("“")]),e._v(" "),t("p",[e._v("推荐下自己做的 Spring Boot 的实战项目：")]),e._v(" "),t("p",[e._v("https://github.com/YunaiV/ruoyi-vue-pro")])]),e._v(" "),t("h2",{attrs:{id:"资源权限"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#资源权限"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("资源权限"),t("OutboundLink")],1)]),e._v(" "),t("h3",{attrs:{id:"_1-静态资源准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-静态资源准备"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("1.静态资源准备"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("这里方便演示就不直接操作数据库了，对应的权限建表关系也很简单，这里直接建立静态的用户对应的URL关系。")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('public class Constant {\n    /**\n     * 权限管理\n     */\n    public static Map<Integer,String[]> permission=new HashMap<>();\n    static {\n        String[] frist={"/url1","/url2","/url3","/url4","/url5","/url6","/url7"};//用户1所拥有的URL权限\n        String[] second={"/url1","/url2","/url3","/url4","/url5"};//用户2所拥有的URL权限\n        String[] third={"/url1","/url2","/url3"};//用户3所拥有的URL权限\n        permission.put(1,frist);\n        permission.put(2,second);\n        permission.put(3,third);\n\n    }\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br"),t("span",{staticClass:"line-number"},[e._v("15")]),t("br")])]),t("h3",{attrs:{id:"_2-自定义一个异常-便于拦截抛出"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-自定义一个异常-便于拦截抛出"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("2.自定义一个异常，便于拦截抛出"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("public class APIException extends RuntimeException {\n    private static final long serialVersionUID = 1L;\n    private String msg;\n    public APIException(String msg) {\n        super(msg);\n        this.msg = msg;\n    }\n\n}\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br")])]),t("h3",{attrs:{id:"_3-全局异常处理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-全局异常处理"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.全局异常处理"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("便于异常后返回统一规范的结果,正常应该是正常返回自定义Vo，但这里目标是为了演示结果，再加上各位应该都有自己的Vo类，所以这里就不用了")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("@RestControllerAdvice\npublic class WebExceptionControl {\n    \n    @ExceptionHandler(APIException.class)\n    public String APIExceptionHandler(APIException e) {\n        return e.getMessage();\n    }\n}\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br")])]),t("h3",{attrs:{id:"_4-controller层"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-controller层"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("4.controller层"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("很简单创建对应的URL就好")]),e._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/640-164346343241051.webp",alt:"图片",loading:"lazy"}})]),e._v(" "),t("h3",{attrs:{id:"_5-拦截器创建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-拦截器创建"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("5.拦截器创建"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("一般是要先验证token，后根据token取到用户对应信息，这里没有登录所以就直接在token里传对应用户的key值了")]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('/**\n * 权限管理URL拦截器\n */\npublic class URLInterceptor implements HandlerInterceptor {\n\n    // 预处理回调方法，在接口调用之前使用  true代表放行  false代表不放行\n    @Override\n    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {\n        HttpServletRequest httpServletRequest = (HttpServletRequest) request;\n        String token = httpServletRequest.getHeader("token");\n        String requestURL = httpServletRequest.getRequestURI();\n        //1.根据token判断用户是否登录\n        if (token==null){   //正常情况下这里还需判断与redis中的token是否匹配\n            // 如果没有token或者token不匹配, 直接抛出异常  提示未登录\n            throw  new APIException("当前用户未登录");\n        }\n        //2.登录成功后 根据用户token中的信息获取到用户对应的URL权限集合\n        String[] strings = Constant.permission.get(Integer.valueOf(token));\n        boolean hasPermission = false;\n        //3.再根据用户对应的URL集合去与当前请求的URL对比  有匹配的则放行  反之则抛出异常\n        for (int i =0;i<strings.length;i++) {\n            if (strings[i].equals(requestURL)){\n                hasPermission = true;\n                break;\n            }\n        }\n        if (hasPermission){\n            return true;\n        }else {\n            throw  new APIException("当前用户没有访问路径" + requestURL + "的权限");\n        }\n    }\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br"),t("span",{staticClass:"line-number"},[e._v("15")]),t("br"),t("span",{staticClass:"line-number"},[e._v("16")]),t("br"),t("span",{staticClass:"line-number"},[e._v("17")]),t("br"),t("span",{staticClass:"line-number"},[e._v("18")]),t("br"),t("span",{staticClass:"line-number"},[e._v("19")]),t("br"),t("span",{staticClass:"line-number"},[e._v("20")]),t("br"),t("span",{staticClass:"line-number"},[e._v("21")]),t("br"),t("span",{staticClass:"line-number"},[e._v("22")]),t("br"),t("span",{staticClass:"line-number"},[e._v("23")]),t("br"),t("span",{staticClass:"line-number"},[e._v("24")]),t("br"),t("span",{staticClass:"line-number"},[e._v("25")]),t("br"),t("span",{staticClass:"line-number"},[e._v("26")]),t("br"),t("span",{staticClass:"line-number"},[e._v("27")]),t("br"),t("span",{staticClass:"line-number"},[e._v("28")]),t("br"),t("span",{staticClass:"line-number"},[e._v("29")]),t("br"),t("span",{staticClass:"line-number"},[e._v("30")]),t("br"),t("span",{staticClass:"line-number"},[e._v("31")]),t("br"),t("span",{staticClass:"line-number"},[e._v("32")]),t("br"),t("span",{staticClass:"line-number"},[e._v("33")]),t("br")])]),t("h3",{attrs:{id:"_6-将拦截器注入应用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-将拦截器注入应用"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("6.将拦截器注入应用"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('@Configuration\npublic class WebMvcConfg implements WebMvcConfigurer {\n\n    @Override\n    public void addInterceptors(InterceptorRegistry registry) {\n        //权限拦截器\n        registry.addInterceptor(urlInterceptor()).addPathPatterns("/**");\n    }\n    @Bean\n    public URLInterceptor urlInterceptor(){\n        return new URLInterceptor();\n    }\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br")])]),t("h3",{attrs:{id:"_7-验证查看结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-验证查看结果"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("7.验证查看结果"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("分别在token中传入用户1-3的key，访问不同url就可以看到效果，如下")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/640-164346343241052.webp",alt:"图片",loading:"lazy"}}),t("OutboundLink")],1)]),e._v(" "),t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/640-164346343241053.webp",alt:"图片",loading:"lazy"}}),t("OutboundLink")],1)]),e._v(" "),t("blockquote",[t("p",[e._v("“")]),e._v(" "),t("p",[e._v("推荐下自己做的 Spring Cloud 的实战项目：")]),e._v(" "),t("p",[e._v("https://github.com/YunaiV/onemall")])]),e._v(" "),t("h2",{attrs:{id:"操作权限"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#操作权限"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("操作权限"),t("OutboundLink")],1)]),e._v(" "),t("h3",{attrs:{id:"_1-和上面一样使用静态资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-和上面一样使用静态资源"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("1.和上面一样使用静态资源"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('public class Constant {\n    /**\n     * 权限管理\n     */\n    public static Map<Integer,String[]> permission=new HashMap<>();\n    static {\n        String[] frist={"insert","delete","select","update"};//用户1所拥有的操作权限\n        String[] second={"insert","select","update"};//用户2所拥有的URL权限\n        String[] third={"select"};//用户3所拥有的URL权限\n        permission.put(1,frist);\n        permission.put(2,second);\n        permission.put(3,third);\n\n    }\n}\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br"),t("span",{staticClass:"line-number"},[e._v("15")]),t("br")])]),t("h3",{attrs:{id:"_2-自定义注解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-自定义注解"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("2.自定义注解"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("@Target(ElementType.METHOD)\n@Retention(RetentionPolicy.RUNTIME)\npublic @interface UrlAnnotation {\n    /**\n     * 操作类型(type):添加,删除,修改,插入\n     * \n     */\n    String type();\n}\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br")])]),t("h3",{attrs:{id:"_3-controller层"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-controller层"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.controller层"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("打上自定义的注解，代表对应方法是什么操作")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/640-164346343241054.webp",alt:"图片",loading:"lazy"}}),t("OutboundLink")],1)]),e._v(" "),t("h3",{attrs:{id:"_4-修改一下之前的拦截器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-修改一下之前的拦截器"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("4.修改一下之前的拦截器"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("添加对注解上面的操作类型的获取，并用type类型去对比判断")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/640-164346343241055.webp",alt:"图片",loading:"lazy"}}),t("OutboundLink")],1)]),e._v(" "),t("h3",{attrs:{id:"_5-验证结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-验证结果"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("5.验证结果"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("其他都不变")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/640-164346343241056.webp",alt:"图片",loading:"lazy"}}),t("OutboundLink")],1)]),e._v(" "),t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/640-164346343241157.webp",alt:"图片",loading:"lazy"}}),t("OutboundLink")],1)]),e._v(" "),t("h2",{attrs:{id:"角色权限"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#角色权限"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("角色权限"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("这里其实和上面的操作大同小异，我这里简单演示一下，以两个模块为例")]),e._v(" "),t("h3",{attrs:{id:"_1-静态对应关系"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-静态对应关系"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("1.静态对应关系"),t("OutboundLink")],1)]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('public class Constant {\n    /**\n     * 权限管理\n     */\n    public static Map<Integer,String[]> permission=new HashMap<>();\n    static {\n        String[] frist={"test","test1"};//用户1所拥有的模块权限  这里的test是模块URL入口  例如：test模块下所有URL都是/test/**\n        String[] second={"test"};//用户2所拥有的模块权限\n        permission.put(1,frist); //这里的1其实是用户对应ID为1的角色\n        permission.put(2,second);//这个2同理\n\n    }\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br")])]),t("h3",{attrs:{id:"_2-修改controller"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-修改controller"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("2.修改controller"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("模拟两个模块")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/640-164346343241158.webp",alt:"图片",loading:"lazy"}}),t("OutboundLink")],1)]),e._v(" "),t("h3",{attrs:{id:"_3-修改一下拦截器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-修改一下拦截器"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("3.修改一下拦截器"),t("OutboundLink")],1)]),e._v(" "),t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/640-164346343241159.webp",alt:"图片",loading:"lazy"}}),t("OutboundLink")],1)]),e._v(" "),t("h3",{attrs:{id:"_4-结果测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-结果测试"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("4.结果测试"),t("OutboundLink")],1)]),e._v(" "),t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/640-164346343241160.webp",alt:"图片",loading:"lazy"}}),t("OutboundLink")],1)]),e._v(" "),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[e._v("#")]),e._v(" "),t("a",{attrs:{href:"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247487551&idx=1&sn=18f64ba49f3f0f9d8be9d1fdef8857d9&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("总结"),t("OutboundLink")],1)]),e._v(" "),t("p",[e._v("其实用自定义的拦截器去做权限，不管是什么类型其实都大同小异，根据需求灵活的去处理才是最重要的，上面的静态权限变通一下，建立角色表、用户表、路径表以及对应关系，就很容易做出URL的动态权限配置了，灵活运用自定义注解搭配可以做到更细致。")])])}),[],!1,null,null,null);n.default=a.exports}}]);