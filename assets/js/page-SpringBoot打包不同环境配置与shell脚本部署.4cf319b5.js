(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{573:function(s,n,a){"use strict";a.r(n);var e=a(1),i=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"springboot打包不同环境配置与shell脚本部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#springboot打包不同环境配置与shell脚本部署"}},[s._v("#")]),s._v(" SpringBoot打包不同环境配置与shell脚本部署")]),s._v(" "),a("p",[s._v("本篇和大家分享的是springboot打包并结合shell脚本命令部署，重点在分享一个shell程序启动工具，希望能便利工作；")]),s._v(" "),a("ul",[a("li",[s._v("profiles指定不同环境的配置")]),s._v(" "),a("li",[s._v("maven-assembly-plugin打发布压缩包")]),s._v(" "),a("li",[s._v("分享shenniu_publish.sh程序启动工具")]),s._v(" "),a("li",[s._v("linux上使用shenniu_publish.sh启动程序")])]),s._v(" "),a("h1",{attrs:{id:"profiles指定不同环境的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#profiles指定不同环境的配置"}},[s._v("#")]),s._v(" profiles指定不同环境的配置")]),s._v(" "),a("p",[s._v("通常一套程序分为了很多个部署环境：开发，测试，uat，线上 等，我们要想对这些环境区分配置文件，可以通过两种方式：")]),s._v(" "),a("ul",[a("li",[s._v("通过application.yml中编码指定 profile.active=uat 方式指定")]),s._v(" "),a("li",[s._v("通过mvn中profiles来区分不同环境对应的配置文件夹，人工可以手动在idea勾选生成不同环境的包(推荐)")])]),s._v(" "),a("p",[s._v("这里我们要讲的是第二种，首先在mvn中配置如下内容：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" 1     <profiles>\n 2         <profile>\n 3             <id>node</id>\n 4             <properties>\n 5                 \x3c!--传递给脚本的参数值--\x3e\n 6                 <activeProfile>node</activeProfile>\n 7                 <package-name>${scripts_packageName}</package-name>\n 8                 <boot-main>${scripts_bootMain}</boot-main>\n 9             </properties>\n10             <activation>\n11                 <activeByDefault>true</activeByDefault>\n12             </activation>\n13         </profile>\n14         <profile>\n15             <id>node1</id>\n16             <properties>\n17                 <activeProfile>node1</activeProfile>\n18                 <package-name>${scripts_packageName}</package-name>\n19                 <boot-main>${scripts_bootMain}</boot-main>\n20             </properties>\n21         </profile>\n22         <profile>\n23             <id>node2</id>\n24             <properties>\n25                 <activeProfile>node2</activeProfile>\n26                 <package-name>${scripts_packageName}</package-name>\n27                 <boot-main>${scripts_bootMain}</boot-main>\n28             </properties>\n29         </profile>\n30     </profiles>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("p",[s._v("节点粗解：")]),s._v(" "),a("ul",[a("li",[s._v("id：用来指定不同环境配置文件所在的目录，如下我这里：\n"),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/fe69f622e6fd659b563e79a848403dcac97db44d.png",alt:"image",loading:"lazy"}})]),s._v(" "),a("li",[s._v("properties：该节点中的节点是可作为参数传递给其他配置文件，如我这里的package-name节点值就可以在另外的assembly.xml或者shell脚本文件中通过${package-name}获取到，如下：\n"),a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/fd2638a541ecddb2844197770587337bfa4bcc29.png",alt:"image",loading:"lazy"}})]),s._v(" "),a("li",[s._v("activeByDefault：指定默认环境配置文件夹")])]),s._v(" "),a("h1",{attrs:{id:"maven-assembly-plugin打发布压缩包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#maven-assembly-plugin打发布压缩包"}},[s._v("#")]),s._v(" maven-assembly-plugin打发布压缩包")]),s._v(" "),a("p",[s._v("对于springboot程序打包，可以分为jar和war，这里是jar包；有场景是咋们配置文件或者第三方等依赖包不想放到工程jar中，并且把这些文件压缩成一个zip包，方便上传到linux；此时通过maven-assembly-plugin和maven-jar-plugin就可以做到，mvn的配置如：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" 1            <plugin>\n 2                 <groupId>org.apache.maven.plugins</groupId>\n 3                 <artifactId>maven-jar-plugin</artifactId>\n 4                 <version>2.6</version>\n 5                 <configuration>\n 6                     <archive>\n 7                         <addMavenDescriptor>false</addMavenDescriptor>\n 8                         <manifest>\n 9                             <addClasspath>true</addClasspath>\n10                             <classpathPrefix>lib/</classpathPrefix>\n11                             <mainClass>${scripts_bootMain}</mainClass>\n12                         </manifest>\n13                     </archive>\n14                     \x3c!--打包排除项--\x3e\n15                     <excludes>\n16                         <exclude>**/*.yml</exclude>\n17                         <exclude>**/*.properties</exclude>\n18                         <exclude>**/*.xml</exclude>\n19                         <exclude>**/*.sh</exclude>\n20                     </excludes>\n21                 </configuration>\n22                 <executions>\n23                     <execution>\n24                         <id>make-a-jar</id>\n25                         <phase>compile</phase>\n26                         <goals>\n27                             <goal>jar</goal>\n28                         </goals>\n29                     </execution>\n30                 </executions>\n31             </plugin>\n32 \n33             <plugin>\n34                 <groupId>org.apache.maven.plugins</groupId>\n35                 <artifactId>maven-assembly-plugin</artifactId>\n36                 <version>2.4</version>\n37                 \x3c!-- The configuration of the plugin --\x3e\n38                 <configuration>\n39                     \x3c!-- Specifies the configuration file of the assembly plugin --\x3e\n40                     <descriptors>\n41                         <descriptor>${project.basedir}/src/main/assembly/assembly.xml</descriptor>\n42                     </descriptors>\n43                 </configuration>\n44                 <executions>\n45                     <execution>\n46                         <id>make-assembly</id>\n47                         <phase>package</phase>\n48                         <goals>\n49                             <goal>single</goal>\n50                         </goals>\n51                     </execution>\n52                 </executions>\n53             </plugin>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br")])]),a("p",[s._v("值得注意的地方如下几点：")]),s._v(" "),a("ul",[a("li",[s._v("mainClass节点：用来指定启动main函数入口类路径，如这里的：com.sm.EurekaServerApplication")]),s._v(" "),a("li",[s._v("excludes节点：排除主jar包中配置等一些列后缀文件，因为我们要包这些配置文件放到主包外面")]),s._v(" "),a("li",[s._v("descriptor节点：用来指定assembly插件对应的assembly.xml配置文件")])]),s._v(" "),a("p",[s._v("有了上面mvn配置，我们还需要assembly.xml的配置，这里提取了结合shell脚本发布程序的配置：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(' 1 <assembly xmlns="http://maven.apache.org/ASSEMBLY/2.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n 2           xsi:schemaLocation="http://maven.apache.org/ASSEMBLY/2.0.0 http://maven.apache.org/xsd/assembly-2.0.0.xsd\n 3 http://maven.apache.org/ASSEMBLY/2.0.0 ">\n 4     <id>${activeProfile}</id>\n 5     \x3c!--打包成一个用于发布的zip文件--\x3e\n 6     <formats>\n 7         <format>zip</format>\n 8     </formats>\n 9     \x3c!--true：zip中生成一级目录(此处屏蔽，配合脚本需要profiles后缀)--\x3e\n10     <includeBaseDirectory>false</includeBaseDirectory>\n11     <dependencySets>\n12         <dependencySet>\n13             \x3c!--打包进zip文件的lib目录--\x3e\n14             <useProjectArtifact>false</useProjectArtifact>\n15             <outputDirectory>${package-name}-${activeProfile}/lib</outputDirectory>\n16             <unpack>false</unpack>\n17         </dependencySet>\n18     </dependencySets>\n19 \n20     <fileSets>\n21         \x3c!-- 配置文件打包进zip文件的conf目录 --\x3e\n22         <fileSet>\n23             <directory>${project.basedir}/src/main/profiles/${activeProfile}</directory>\n24             <outputDirectory>${package-name}-${activeProfile}/conf</outputDirectory>\n25             <includes>\n26                 <include>**/*</include>\n27                 \x3c!--<include>*.xml</include>--\x3e\n28                 \x3c!--<include>*.properties</include>--\x3e\n29                 \x3c!--<include>*.yml</include>--\x3e\n30             </includes>\n31         </fileSet>\n32 \n33         \x3c!--启动脚本打包进zip文件--\x3e\n34         <fileSet>\n35             <directory>${project.basedir}/src/main/scripts</directory>\n36             <outputDirectory></outputDirectory>\n37             <includes>\n38                 <include>**/*</include>\n39             </includes>\n40             \x3c!-- 文件文件权限为777 --\x3e\n41             <fileMode>777</fileMode>\n42             \x3c!-- 目录权限为777  --\x3e\n43             <directoryMode>777</directoryMode>\n44             \x3c!--脚本中参数变量为pom中的值 关键--\x3e\n45             <filtered>true</filtered>\n46         </fileSet>\n47 \n48         \x3c!-- 项目编译出来的jar打包进zip文件 --\x3e\n49         <fileSet>\n50             <directory>${project.build.directory}</directory>\n51             <outputDirectory>${package-name}-${activeProfile}/</outputDirectory>\n52             <includes>\n53                 <include>*.jar</include>\n54             </includes>\n55         </fileSet>\n56     </fileSets>\n57 </assembly>\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br")])]),a("p",[s._v("重点节点介绍：")]),s._v(" "),a("ul",[a("li",[s._v("formats节点：把配置文件和jar包等压缩成什么文件格式，这里可以有：zip，tar等")]),s._v(" "),a("li",[s._v("fileMode节点：指定scripts目录下脚本文件(这里是：shenniu_publish.sh)在linux上文件权限为777")]),s._v(" "),a("li",[s._v("filtered节点：脚本中参数变量为pom的profiles中properties的值(该配置，是把mvn中属性值映射生成到sh文件中，如：${package-name})")])]),s._v(" "),a("p",[s._v("完成上面配置后，此时我们可以通过idea上勾选切换不同环境来打zip包，如图：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/348819-20190309170559272-1005982868.png",alt:"img",loading:"lazy"}})]),s._v(" "),a("h1",{attrs:{id:"分享shenniu-publish-sh程序启动工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分享shenniu-publish-sh程序启动工具"}},[s._v("#")]),s._v(" 分享shenniu_publish.sh程序启动工具")]),s._v(" "),a("p",[s._v("上面步骤完成了zip格式的发布包，我们再分享下启动程序的shell脚本，该脚本具有的功能如：")]),s._v(" "),a("ul",[a("li",[s._v("解压zip+启动jar包")]),s._v(" "),a("li",[s._v("启动jar包")]),s._v(" "),a("li",[s._v("停止对应jar运行")]),s._v(" "),a("li",[s._v("重启jar程序")])]),s._v(" "),a("p",[s._v("目前该shell中封装了两种启动jar命令的方式：")]),s._v(" "),a("ul",[a("li",[s._v("java -cp")]),s._v(" "),a("li",[s._v("java -jar")])]),s._v(" "),a("p",[s._v("如图命令格式：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/348819-20190309170514140-1638598831.png",alt:"img",loading:"lazy"}})]),s._v(" "),a("p",[s._v("来看全部的shell代码：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('  1 #!/usr/bin/env bash\n  2 #可变参数变量\n  3 languageType="javac" #支持 java,javac,netcore 发布\n  4 #参数值由pom文件传递\n  5 baseZipName="${package-name}-${activeProfile}" #压缩包名称  publish-test.zip的publish\n  6 packageName="${package-name}" #命令启动包名 xx.jar的xx\n  7 mainclass="${boot-main}" #java -cp启动时，指定main入口类;命令：java -cp conf;lib\\*.jar;${packageName}.jar ${mainclass}\n  8 \n  9 #例子\n 10 # baseZipName="publish-test" #压缩包名称  publish-test.zip的publish\n 11 # packageName="publish" #命令启动包名 publish.jar的xx\n 12 \n 13 #固定变量\n 14 basePath=$(cd `dirname $0`/; pwd)\n 15 baseZipPath="${basePath}/${baseZipName}.zip"  #压缩包路径\n 16 baseDirPath="${basePath}" #解压部署磁盘路径\n 17 pid= #进程pid\n 18 \n 19 #解压\n 20 function shenniu_unzip()\n 21 {\n 22     echo "解压---------------------------------------------"\n 23     echo "压缩包路径：${baseZipPath}"\n 24     if [ ! `find ${baseZipPath}` ]\n 25     then\n 26         echo "不存在压缩包：${baseZipPath}"\n 27     else\n 28         echo "解压磁盘路径：${baseDirPath}/${baseZipName}"\n 29         echo "开始解压..."\n 30 \n 31         #解压命令\n 32         unzip -od ${baseDirPath}/${baseZipName} ${baseZipPath}\n 33 \n 34         #设置执行权限\n 35         chmod +x ${baseDirPath}/${baseZipName}/${packageName}\n 36 \n 37         echo "解压完成。"  \n 38     fi\n 39 }\n 40 \n 41 #检测pid\n 42 function getPid()\n 43 {\n 44     echo "检测状态---------------------------------------------"\n 45     pid=`ps -ef | grep -n ${packageName} | grep -v grep | awk \'{print $2}\'`\n 46     if [ ${pid} ] \n 47     then\n 48         echo "运行pid：${pid}"\n 49     else\n 50         echo "未运行"\n 51     fi\n 52 }\n 53 \n 54 #启动程序\n 55 function start()\n 56 {\n 57     #启动前，先停止之前的\n 58     stop\n 59     if [ ${pid} ]\n 60     then\n 61         echo "停止程序失败，无法启动"\n 62     else\n 63         echo "启动程序---------------------------------------------"\n 64         \n 65         #选择语言类型\n 66         read -p "输入程序类型(java,javac,netcore)，下一步按回车键(默认：${languageType})：" read_languageType\n 67         if [ ${read_languageType} ]\n 68         then\n 69             languageType=${read_languageType}\n 70         fi\n 71         echo "选择程序类型：${languageType}"\n 72 \n 73         #进入运行包目录\n 74         cd ${baseDirPath}/${baseZipName}\n 75 \n 76         #分类启动\n 77         if [ "${languageType}" == "javac" ] \n 78         then\n 79             if [ ${mainclass} ] \n 80             then\n 81                 nohup java -cp conf:lib\\*.jar:${packageName}.jar ${mainclass} >${baseDirPath}/${packageName}.out 2>&1 &\n 82                #nohup java -cp conf:lib\\*.jar:${packageName}.jar ${mainclass} >/dev/null 2>&1 &\n 83             fi\n 84         elif [ "${languageType}" == "java" ] \n 85         then\n 86             nohup java -jar ${baseDirPath}/${baseZipName}/${packageName}.jar >/dev/null 2>&1 &\n 87             # java -jar ${baseDirPath}/${baseZipName}/${packageName}.jar\n 88         elif [ "${languageType}" == "netcore" ] \n 89         then\n 90             #nohup dotnet run ${baseDirPath}/${baseZipName}/${packageName} >/dev/null 2>&1 &\n 91             nohup ${baseDirPath}/${baseZipName}/${packageName} >/dev/null 2>&1 &\n 92         fi\n 93 \n 94         #查询是否有启动进程\n 95         getPid\n 96         if [ ${pid} ]\n 97         then\n 98             echo "已启动"\n 99             #nohup日志\n100             tail -n 50 -f ${baseDirPath}/${packageName}.out\n101         else\n102             echo "启动失败"\n103         fi\n104     fi\n105 }\n106 \n107 #停止程序\n108 function stop()\n109 {\n110     getPid\n111     if [ ${pid} ] \n112     then\n113         echo "停止程序---------------------------------------------"\n114         kill -9 ${pid}\n115         \n116         getPid\n117         if [ ${pid} ] \n118         then\n119             #stop\n120             echo "停止失败"\n121         else\n122             echo "停止成功"\n123         fi\n124     fi\n125 }\n126 \n127 #启动时带参数，根据参数执行\n128 if [ ${#} -ge 1 ] \n129 then\n130     case ${1} in\n131         "start") \n132             start\n133         ;;\n134         "restart") \n135             start\n136         ;;\n137         "stop") \n138             stop\n139         ;;\n140         "unzip") \n141             #执行解压\n142             shenniu_unzip\n143             #执行启动\n144             start\n145         ;;\n146         *) \n147             echo "${1}无任何操作"\n148         ;;\n149     esac\n150 else\n151     echo "\n152     command如下命令：\n153     unzip：解压并启动\n154     start：启动\n155     stop：停止进程\n156     restart：重启\n157 \n158     示例命令如：./shenniu_publish start\n159     "\n160 fi\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br"),a("span",{staticClass:"line-number"},[s._v("116")]),a("br"),a("span",{staticClass:"line-number"},[s._v("117")]),a("br"),a("span",{staticClass:"line-number"},[s._v("118")]),a("br"),a("span",{staticClass:"line-number"},[s._v("119")]),a("br"),a("span",{staticClass:"line-number"},[s._v("120")]),a("br"),a("span",{staticClass:"line-number"},[s._v("121")]),a("br"),a("span",{staticClass:"line-number"},[s._v("122")]),a("br"),a("span",{staticClass:"line-number"},[s._v("123")]),a("br"),a("span",{staticClass:"line-number"},[s._v("124")]),a("br"),a("span",{staticClass:"line-number"},[s._v("125")]),a("br"),a("span",{staticClass:"line-number"},[s._v("126")]),a("br"),a("span",{staticClass:"line-number"},[s._v("127")]),a("br"),a("span",{staticClass:"line-number"},[s._v("128")]),a("br"),a("span",{staticClass:"line-number"},[s._v("129")]),a("br"),a("span",{staticClass:"line-number"},[s._v("130")]),a("br"),a("span",{staticClass:"line-number"},[s._v("131")]),a("br"),a("span",{staticClass:"line-number"},[s._v("132")]),a("br"),a("span",{staticClass:"line-number"},[s._v("133")]),a("br"),a("span",{staticClass:"line-number"},[s._v("134")]),a("br"),a("span",{staticClass:"line-number"},[s._v("135")]),a("br"),a("span",{staticClass:"line-number"},[s._v("136")]),a("br"),a("span",{staticClass:"line-number"},[s._v("137")]),a("br"),a("span",{staticClass:"line-number"},[s._v("138")]),a("br"),a("span",{staticClass:"line-number"},[s._v("139")]),a("br"),a("span",{staticClass:"line-number"},[s._v("140")]),a("br"),a("span",{staticClass:"line-number"},[s._v("141")]),a("br"),a("span",{staticClass:"line-number"},[s._v("142")]),a("br"),a("span",{staticClass:"line-number"},[s._v("143")]),a("br"),a("span",{staticClass:"line-number"},[s._v("144")]),a("br"),a("span",{staticClass:"line-number"},[s._v("145")]),a("br"),a("span",{staticClass:"line-number"},[s._v("146")]),a("br"),a("span",{staticClass:"line-number"},[s._v("147")]),a("br"),a("span",{staticClass:"line-number"},[s._v("148")]),a("br"),a("span",{staticClass:"line-number"},[s._v("149")]),a("br"),a("span",{staticClass:"line-number"},[s._v("150")]),a("br"),a("span",{staticClass:"line-number"},[s._v("151")]),a("br"),a("span",{staticClass:"line-number"},[s._v("152")]),a("br"),a("span",{staticClass:"line-number"},[s._v("153")]),a("br"),a("span",{staticClass:"line-number"},[s._v("154")]),a("br"),a("span",{staticClass:"line-number"},[s._v("155")]),a("br"),a("span",{staticClass:"line-number"},[s._v("156")]),a("br"),a("span",{staticClass:"line-number"},[s._v("157")]),a("br"),a("span",{staticClass:"line-number"},[s._v("158")]),a("br"),a("span",{staticClass:"line-number"},[s._v("159")]),a("br"),a("span",{staticClass:"line-number"},[s._v("160")]),a("br")])]),a("p",[s._v("正如上面小节说的，shell中的参数 package-name，activeProfile，boot-main 都是由mvn中profiles的properties中提供，是可变的参数，脚本代码本身不需要人工去修改，只需要变的是mvn的参数即可；其实在我们生成zip包的时候，shell中的参数就被替换了，可以看zip中shell文件内容如：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/348819-20190309170701655-1208411312.png",alt:"img",loading:"lazy"}})]),s._v(" "),a("h1",{attrs:{id:"linux上使用shenniu-publish-sh启动程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux上使用shenniu-publish-sh启动程序"}},[s._v("#")]),s._v(" linux上使用shenniu_publish.sh启动程序")]),s._v(" "),a("p",[s._v("把生成的zip上传到linux上，通过命令解压：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1 unzip -od eureka-server-0.0.1-node eureka-server-0.0.1-node.zip\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("其实shell脚本中包含有解压命令，但是我在打包时放在了zip中，所以只能通过手动解压了，当然可以调整；此时进入加压目录如此：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/348819-20190309170918126-491643739.png",alt:"img",loading:"lazy"}})]),s._v(" "),a("p",[s._v("注：这里第一次执行./shenniu_publish.sh脚本时候，提示了错误信息；是由于我是在windows上编辑的这个脚本，其空格等和linux上不一样，所以运行会有问题，要解决可以使用vim命令在linux把该文件转成linux格式，如下命令：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("1 vim shenniu_publish.sh\n2 set ff=unix\n3 :wq\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("执行完后，再来运行脚本./shenniu_publish.sh，此时有如下提示:")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/348819-20190309171107977-1319405631.png",alt:"img",loading:"lazy"}})]),s._v(" "),a("p",[s._v("此刻我们文件是解压状态，因此只需要start命令启动程序即可：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/348819-20190309171127604-1971799892.png",alt:"img",loading:"lazy"}})]),s._v(" "),a("p",[s._v("到这里shenniu_publish.sh脚本使用就完成了，只要脚本没有提示错误，基本都能启动jar服务；其他restart和stop命令也如此执行就行：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/xlc520/MyImage/MdImg/348819-20190309171150215-294116419.png",alt:"img",loading:"lazy"}})]),s._v(" "),a("p",[s._v("可以去研究下shell代码，希望该脚本能给你带来效率和好的学习思路，下面是测试用例git地址，脚本在eureka-server项目中：https://github.com/shenniubuxing3/springcloud-Finchley.SR2")])])}),[],!1,null,null,null);n.default=i.exports}}]);